<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(14)</title>
      <link href="/2020/10/05/rasa-wen-dang-zhi-nan-14/"/>
      <url>/2020/10/05/rasa-wen-dang-zhi-nan-14/</url>
      
        <content type="html"><![CDATA[<h1 id="Rasaæ ¸å¿ƒå¯¹è¯å¼•æ“"><a href="#Rasaæ ¸å¿ƒå¯¹è¯å¼•æ“" class="headerlink" title="Rasaæ ¸å¿ƒå¯¹è¯å¼•æ“"></a>Rasaæ ¸å¿ƒå¯¹è¯å¼•æ“</h1><h1 id="stories"><a href="#stories" class="headerlink" title="stories"></a>stories</h1><ul><li><a href="#">æ ¼å¼</a><ul><li><a href="#">storiesæ˜¯ç”±ä»€ä¹ˆç»„æˆçš„ï¼Ÿ</a></li><li><a href="#">ç”¨æˆ·ç•™è¨€</a></li><li><a href="#">åŠ¨ä½œ</a></li><li><a href="#">å¤§äº‹ä»¶</a><ul><li><a href="#">slotäº‹ä»¶</a></li><li><a href="#">è¡¨å•äº‹ä»¶</a></li></ul></li></ul></li><li><a href="#">checkpointså’Œor_statements</a><ul><li><a href="#">checkpoints</a></li><li><a href="#">statements</a></li></ul></li><li><a href="#">ç«¯åˆ°ç«¯storyè¯„ä¼°æ ¼å¼</a></li></ul><p>Rasa storyæ˜¯ä¸€ç§ç”¨äºè®­ç»ƒRasaå¯¹è¯ç®¡ç†æ¨¡å‹çš„è®­ç»ƒæ•°æ®ã€‚</p><p>storyæ˜¯ç”¨æˆ·ä¸AIåŠ©æ‰‹ä¹‹é—´å¯¹è¯çš„è¡¨ç¤ºï¼Œå·²è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼ï¼Œå…¶ä¸­ç”¨æˆ·è¾“å…¥è¡¨ç¤ºä¸ºç›¸åº”çš„æ„å›¾ï¼ˆå¿…è¦æ—¶åŒ…æ‹¬å®ä½“ï¼‰ï¼Œè€ŒåŠ©æ‰‹çš„å“åº”è¡¨ç¤ºä¸ºç›¸åº”çš„åŠ¨ä½œåç§°ã€‚</p><p>Rasa Coreå¯¹è¯ç³»ç»Ÿçš„è®­ç»ƒç¤ºä¾‹ç§°ä¸º<strong>story</strong>ã€‚è¿™æ˜¯storyæ•°æ®æ ¼å¼çš„æŒ‡å—ã€‚</p><blockquote><p>æ³¨æ„</p><p>æ‚¨è¿˜å¯ä»¥<strong>å°†storyåˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œ</strong>å¹¶ä¸ºå¤§å¤šæ•°è„šæœ¬ï¼ˆä¾‹å¦‚ï¼ŒåŸ¹è®­ï¼Œå¯è§†åŒ–ï¼‰æŒ‡å®šåŒ…å«æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚è¿™äº›storyå°†è¢«è§†ä¸ºä¸€ä¸ªå¤§æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><p>è¿™æ˜¯Rasa storyæ ¼å¼çš„å¯¹è¯ç¤ºä¾‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> greet + location/price + cuisine + num people    </span><span class="token comment" spellcheck="true">&lt;!-- name of the story - just for debugging --></span><span class="token list punctuation">*</span> greet   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>howcanhelp<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"location": "rome", "price": "cheap"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token comment" spellcheck="true">&lt;!-- user utterance, in format intent&amp;#123;entities&amp;#125; --></span>   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>on<span class="token punctuation">_</span></span>it   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"cuisine": "spanish"<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>numpeople        <span class="token comment" spellcheck="true">&lt;!-- action that the bot should execute --></span><span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "six"<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ack<span class="token punctuation">_</span></span>dosearch</code></pre><h3 id="story"><a href="#story" class="headerlink" title="story"></a>story</h3><ul><li>storyä»¥ä¸€ä¸ªåå­—å¼€å¤´ï¼Œåé¢å¸¦æœ‰ä¸¤ä¸ªå“ˆå¸Œã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥å‘½åè¯¥storyï¼Œä½†æ˜¯å¯¹äºè°ƒè¯•æ¥è¯´ï¼Œä¸ºå®ƒä»¬æŒ‡å®šæè¿°æ€§åç§°å¯èƒ½éå¸¸æœ‰ç”¨ï¼<code>## story_03248462</code></li><li>storyçš„ç»“å°¾ç”¨æ¢è¡Œç¬¦è¡¨ç¤ºï¼Œç„¶åæ–°çš„storyå†æ¬¡ä»¥å¼€å¤´<code>##</code>ã€‚</li><li>ç”¨æˆ·å‘é€çš„æ¶ˆæ¯<code>*</code> ä»¥æ ¼å¼å¼€å¤´ä»¥è¡Œå¼€å¤´ã€‚<code>intent{"entity1": "value", "entity2": "value"}</code></li><li>æœºå™¨äººæ‰§è¡Œçš„åŠ¨ä½œä»¥ä»¥å¼€å¤´çš„è¡Œæ˜¾ç¤ºï¼Œ<code>-</code> å¹¶åŒ…å«åŠ¨ä½œçš„åç§°ã€‚</li><li>åŠ¨ä½œè¿”å›çš„äº‹ä»¶åœ¨è¯¥åŠ¨ä½œä¹‹åç«‹å³åœ¨çº¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œè¿”å›ä¸€ä¸ª<code>SlotSet</code>äº‹ä»¶ï¼Œåˆ™æ˜¾ç¤ºä¸º ã€‚<code>slot{"slot_name": "value"}</code></li></ul><h3 id="ç”¨æˆ·æ¶ˆæ¯"><a href="#ç”¨æˆ·æ¶ˆæ¯" class="headerlink" title="ç”¨æˆ·æ¶ˆæ¯"></a>ç”¨æˆ·æ¶ˆæ¯</h3><p>åœ¨ç¼–å†™storyæ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯çš„ç‰¹å®šå†…å®¹ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥åˆ©ç”¨NLUç®¡é“çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºä½¿æ‚¨å¯ä»¥ä»…ä½¿ç”¨æ„å›¾å’Œå®ä½“çš„ç»„åˆæ¥å¼•ç”¨ç”¨æˆ·å¯ä»¥å‘é€çš„æ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯ï¼Œè¡¨ç¤ºåŒä¸€ä»¶äº‹ã€‚</p><p>åœ¨æ­¤å¤„ä¹ŸåŒ…å«å®ä½“ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºç­–ç•¥ä¼šæ ¹æ®æ„å›¾å’Œå®ä½“çš„<em>ç»„åˆ</em>æ¥å­¦ä¹ é¢„æµ‹ä¸‹ä¸€ä¸ªåŠ¨ä½œï¼ˆä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="#">use_entities</a>å±æ€§æ›´æ”¹æ­¤è¡Œä¸º ï¼‰ã€‚</p><blockquote><p>è­¦å‘Š</p><p><code>/</code>ç¬¦å·ä¿ç•™ä¸ºåˆ†éš”ç¬¦ï¼Œç”¨äºå°†æ£€ç´¢æ„å›¾ä¸å“åº”æ–‡æœ¬æ ‡è¯†ç¬¦åˆ†å¼€ã€‚æœ‰å…³æ­¤æ ¼å¼çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ<a href="#">æ£€ç´¢æ“ä½œâ€</a>éƒ¨åˆ†ã€‚å¦‚æœä»»ä½•æ„å›¾åç§°åŒ…å«åˆ†éš”ç¬¦ï¼Œåˆ™åŒ…å«è¿™äº›storiesçš„æ–‡ä»¶å°†è¢«è§†ä¸º<a href="#">ResponseSelector</a>æ¨¡å‹çš„è®­ç»ƒæ–‡ä»¶ï¼Œè€Œå¯¹äºCoreæ¨¡å‹çš„è®­ç»ƒå°†è¢«å¿½ç•¥ã€‚`Training Data Format</p></blockquote><h3 id="åŠ¨ä½œ"><a href="#åŠ¨ä½œ" class="headerlink" title="åŠ¨ä½œ"></a>åŠ¨ä½œ</h3><p>åœ¨ç¼–å†™storiesæ—¶ï¼Œæ‚¨ä¼šé‡åˆ°ä¸¤ç§ç±»å‹çš„åŠ¨ä½œï¼šå‘å£°åŠ¨ä½œå’Œè‡ªå®šä¹‰åŠ¨ä½œã€‚è¯è¯­æ“ä½œæ˜¯æœºå™¨äººå¯ä»¥å“åº”çš„ç¡¬ç¼–ç æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼Œè‡ªå®šä¹‰æ“ä½œæ¶‰åŠæ­£åœ¨æ‰§è¡Œçš„è‡ªå®šä¹‰ä»£ç ã€‚</p><p>æœºå™¨äººæ‰§è¡Œçš„æ‰€æœ‰åŠ¨ä½œï¼ˆè¯è¯­åŠ¨ä½œå’Œè‡ªå®šä¹‰åŠ¨ä½œï¼‰å‡ä»¥è¡Œå¼€å¤´ï¼Œ<code>-</code>åè·ŸåŠ¨ä½œåç§°ã€‚</p><p>è¯­éŸ³æ“ä½œçš„å“åº”å¿…é¡»ä»¥å‰ç¼€å¼€å¤´<code>utter_</code>ï¼Œå¹¶ä¸”å¿…é¡»ä¸åŸŸä¸­å®šä¹‰çš„å“åº”åç§°åŒ¹é…ã€‚</p><p>å¯¹äºè‡ªå®šä¹‰æ“ä½œï¼Œæ“ä½œåç§°æ˜¯æ‚¨é€‰æ‹©ä»<code>name</code>è‡ªå®šä¹‰æ“ä½œç±»çš„æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ã€‚å°½ç®¡å¯¹è‡ªå®šä¹‰åŠ¨ä½œï¼ˆä¸è¯è¯­åŠ¨ä½œä¸åŒï¼‰è¿›è¡Œå‘½åæ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯æœ€ä½³åšæ³•æ˜¯åœ¨åç§°å‰åŠ ä¸Š<code>action_</code>ã€‚</p><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>è¯¸å¦‚è®¾ç½®æ§½ä½æˆ–æ¿€æ´»/å–æ¶ˆæ¿€æ´»è¡¨æ ¼ä¹‹ç±»çš„äº‹ä»¶å¿…é¡»ä½œä¸ºstoriesçš„ä¸€éƒ¨åˆ†æ˜ç¡®åœ°å†™å‡ºã€‚å½“è‡ªå®šä¹‰åŠ¨ä½œå·²ç»æˆä¸ºstoriesçš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå¿…é¡»å•ç‹¬åŒ…å«è‡ªå®šä¹‰åŠ¨ä½œè¿”å›çš„äº‹ä»¶ï¼Œè¿™ä¼¼ä¹æ˜¯å¤šä½™çš„ã€‚ä½†æ˜¯ï¼Œç”±äºRasaåœ¨è®­ç»ƒæœŸé—´æ— æ³•ç¡®å®šè¿™ä¸€äº‹å®ï¼Œå› æ­¤æ­¤æ­¥éª¤æ˜¯å¿…éœ€çš„ã€‚</p><p>æ‚¨å¯ä»¥<a href="https://legacy-docs-v1.rasa.com/api/events/#events">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³äº‹ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚</p><h4 id="slotäº‹ä»¶"><a href="#slotäº‹ä»¶" class="headerlink" title="slotäº‹ä»¶"></a>slotäº‹ä»¶</h4><p>å¹¿å‘Šä½äº‹ä»¶è®°ä¸ºã€‚å¦‚æœåœ¨è‡ªå®šä¹‰åŠ¨ä½œä¸­è®¾ç½®äº†è¯¥æ’æ§½ï¼Œåˆ™ä¼šåœ¨è‡ªå®šä¹‰åŠ¨ä½œäº‹ä»¶ä¹‹åç«‹å³å°†å…¶å†™å…¥è¡Œä¸­ã€‚å¦‚æœæ‚¨çš„è‡ªå®šä¹‰æ“ä½œå°†å¹¿å‘Šä½å€¼é‡ç½®ä¸ºâ€œæ— â€ï¼Œåˆ™å¯¹åº”çš„äº‹ä»¶å°†æ˜¯ã€‚<code>- slot{"slot_name": "value"}``-slot{"slot_name": null}</code></p><h4 id="è¡¨å•äº‹ä»¶"><a href="#è¡¨å•äº‹ä»¶" class="headerlink" title="è¡¨å•äº‹ä»¶"></a>è¡¨å•äº‹ä»¶</h4><p>å¤„ç†storiesä¸­çš„è¡¨å•æ—¶ï¼Œéœ€è¦ç‰¢è®°ä¸‰ç§äº‹ä»¶ã€‚</p><ul><li>è¡¨å•åŠ¨ä½œäº‹ä»¶ï¼ˆä¾‹å¦‚ï¼‰åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨è¡¨å•æ—¶å°±å¼€å§‹ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨è¡¨å•å·²ç»å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶åˆç»§ç»­ä½¿ç”¨è¡¨å•åŠ¨ä½œã€‚<code>- restaurant_form</code></li><li>åœ¨ç¬¬ä¸€ä¸ªè¡¨å•æ“ä½œäº‹ä»¶ä¹‹åç«‹å³ä½¿ç”¨è¡¨å•æ¿€æ´»äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼‰ã€‚<code>- form{"name": "restaurant_form"}</code></li><li>è¡¨å•åœç”¨äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼‰ï¼Œç”¨äºåœç”¨è¡¨å•ã€‚<code>- form{"name": null}</code></li></ul><blockquote><p>æ³¨æ„</p><p>ä¸ºäº†è§£å†³å¿˜è®°æ·»åŠ äº‹ä»¶çš„é™·é˜±ï¼Œå»ºè®®ç¼–å†™è¿™äº›æ•…äº‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨<a href="#">äº¤äº’å¼å­¦ä¹ </a>ã€‚</p></blockquote><h3 id="checkpointså’ŒOR-statements"><a href="#checkpointså’ŒOR-statements" class="headerlink" title="checkpointså’ŒOR statements"></a>checkpointså’ŒOR statements</h3><p>å¦‚æœæœ‰æ£€æŸ¥ç‚¹å’ŒORè¯­å¥ï¼Œéƒ½åº”è°¨æ…ä½¿ç”¨ã€‚é€šå¸¸ï¼Œæœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥é€šè¿‡ä½¿ç”¨è¡¨å•å’Œ/æˆ–æ£€ç´¢æ“ä½œæ¥å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚</p><h4 id="checkpoints"><a href="#checkpoints" class="headerlink" title="checkpoints"></a>checkpoints</h4><p>æ‚¨å¯ä»¥ç”¨æ¥æ¨¡å—åŒ–å’Œç®€åŒ–æ‚¨çš„è®­ç»ƒæ•°æ®ã€‚æ£€æŸ¥ç‚¹å¯èƒ½æœ‰ç”¨ï¼Œä½†<strong>ä¸è¦è¿‡åº¦ä½¿ç”¨å®ƒä»¬</strong>ã€‚ä½¿ç”¨å¤§é‡æ£€æŸ¥ç‚¹å¯ä»¥è¿…é€Ÿä½¿æ‚¨çš„ç¤ºä¾‹æ•…äº‹éš¾ä»¥ç†è§£ã€‚å¦‚æœç»å¸¸åœ¨ä¸åŒçš„æ•…äº‹ä¸­é‡å¤æ‰§è¡Œæ•…äº‹å—ï¼Œåˆ™ä½¿ç”¨å®ƒä»¬å¾ˆæœ‰æ„ä¹‰ï¼Œä½†æ˜¯<em>æ²¡æœ‰</em>æ£€æŸ¥ç‚¹çš„æ•…äº‹æ›´æ˜“äºé˜…è¯»å’Œç¼–å†™ã€‚è¿™æ˜¯ä¸€ä¸ªåŒ…å«æ£€æŸ¥ç‚¹çš„ç¤ºä¾‹æ•…äº‹æ–‡ä»¶ï¼ˆè¯·æ³¨æ„ï¼Œæ‚¨ä¸€æ¬¡å¯ä»¥é™„åŠ å¤šä¸ªæ£€æŸ¥ç‚¹ï¼‰ï¼š<code>&gt; checkpoints</code></p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> first story</span><span class="token list punctuation">*</span> greet   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>user_question<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token title important"><span class="token punctuation">##</span> user affirms question</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token list punctuation">*</span> affirm  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation<span class="token title important"><span class="token punctuation">##</span> user denies question</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token list punctuation">*</span> deny  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>denial<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial<span class="token title important"><span class="token punctuation">##</span> user leaves</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation<span class="token list punctuation">*</span> goodbye  <span class="token list punctuation">-</span> utter_goodbye</code></pre><blockquote><p>æ³¨æ„</p><p>ä¸å¸¸è§„æ•…äº‹ä¸åŒï¼Œæ£€æŸ¥ç‚¹ä¸é™äºä»ç”¨æˆ·è¾“å…¥å¼€å§‹ã€‚åªè¦åœ¨ä¸»è¦æ•…äº‹ä¸­çš„æ­£ç¡®ä½ç½®æ’å…¥æ£€æŸ¥ç‚¹ï¼Œç¬¬ä¸€ä¸ªäº‹ä»¶å°±å¯ä»¥æ˜¯è‡ªå®šä¹‰åŠ¨ä½œæˆ–å“åº”åŠ¨ä½œã€‚</p></blockquote><h4 id="OR-Statements"><a href="#OR-Statements" class="headerlink" title="OR Statements"></a>OR Statements</h4><p>ç¼–å†™ç®€çŸ­æ•…äº‹æˆ–ä»¥ç›¸åŒæ–¹å¼å¤„ç†å¤šä¸ªæ„å›¾çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>OR</code>è¯­å¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦æ±‚ç”¨æˆ·ç¡®è®¤æŸä»¶äº‹ï¼Œå¹¶ä¸”æ‚¨æƒ³ä»¥ç›¸åŒçš„æ–¹å¼å¯¹å¾…<code>affirm</code> å’Œ<code>thankyou</code>æ„å›¾ã€‚ä»¥ä¸‹æ•…äº‹å°†åœ¨åŸ¹è®­æ—¶è½¬æ¢ä¸ºä¸¤ä¸ªæ•…äº‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> story</span>...  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>confirm<span class="token list punctuation">*</span> affirm OR thankyou  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation</code></pre><p>å°±åƒæ£€æŸ¥ç‚¹ä¸€æ ·ï¼Œ<code>OR</code>è¯­å¥å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨äº†å¾ˆå¤šæ£€æŸ¥ç‚¹ï¼Œåˆ™é‡ç»„åŸŸå’Œ/æˆ–æ„å›¾å¯èƒ½ä¼šæ›´å¥½ã€‚</p><blockquote><p>è­¦å‘Š</p><p>è¿‡åº¦ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼ˆcheckpointså’ŒOR statementsï¼‰ä¼šå‡æ…¢è®­ç»ƒé€Ÿåº¦ã€‚</p></blockquote><h3 id="ç«¯åˆ°ç«¯storiesè¯„ä¼°æ ¼å¼"><a href="#ç«¯åˆ°ç«¯storiesè¯„ä¼°æ ¼å¼" class="headerlink" title="ç«¯åˆ°ç«¯storiesè¯„ä¼°æ ¼å¼"></a>ç«¯åˆ°ç«¯storiesè¯„ä¼°æ ¼å¼</h3><p>ç«¯åˆ°ç«¯æ•…äº‹æ ¼å¼æ˜¯ä¸€ç§å°†NLUå’ŒCoreåŸ¹è®­æ•°æ®éƒ½åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ä»¥è¿›è¡Œè¯„ä¼°çš„æ ¼å¼ã€‚é˜…è¯»æœ‰å…³<a href="#">æµ‹è¯•åŠ©æ‰‹çš„</a>æ›´å¤šä¿¡æ¯</p><blockquote><p>è­¦å‘Š</p><p>æ­¤æ ¼å¼ä»…ç”¨äºç«¯åˆ°ç«¯è¯„ä¼°ï¼Œè€Œä¸èƒ½ç”¨äºè®­ç»ƒã€‚</p></blockquote><h2 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h2><p>è¯¥<code>Domain</code>å®šä¹‰äº†ä½ çš„åŠ©æ‰‹å·¥ä½œçš„å®‡å®™ã€‚å®ƒè§„å®šäº†<code>intents</code>ï¼Œ<code>entities</code>ï¼Œ<code>slots</code>å’Œ<code>actions</code> ä½ çš„æœºå™¨äººåº”è¯¥çŸ¥é“ã€‚ï¼ˆå¯é€‰ï¼‰å®ƒè¿˜å¯ä»¥åŒ…å«<code>responses</code> æœºå™¨äººå¯ä»¥è¯´çš„å†…å®¹ã€‚</p><ul><li><a href="#">Domainçš„ç¤ºä¾‹</a></li><li><a href="#">è‡ªå®šä¹‰åŠ¨ä½œå’Œslot</a></li><li><a href="#">å“åº”</a></li><li><a href="#">å›¾åƒå’ŒæŒ‰é’®</a></li><li><a href="#">è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè´Ÿè½½</a></li><li><a href="#">ç‰¹å®šé€šé“çš„å“åº”</a></li><li><a href="#">å› ç´ </a></li><li><a href="#">å˜ä½“</a></li><li><a href="#">å¿½ç•¥æŸäº›æ„å›¾å®ä½“</a></li><li><a href="#">ä¼šè¯é…ç½®</a></li></ul><h3 id="domainä¾‹å­"><a href="#domainä¾‹å­" class="headerlink" title="domainä¾‹å­"></a>domainä¾‹å­</h3><p>ä¾‹å¦‚ï¼Œç”±åˆ›å»ºçš„åŸŸå…·æœ‰ä»¥ä¸‹yamlå®šä¹‰ï¼š<code>rasa init</code></p><pre class=" language-markdown"><code class="language-markdown">intents:  <span class="token list punctuation">-</span> greet  <span class="token list punctuation">-</span> goodbye  <span class="token list punctuation">-</span> affirm  <span class="token list punctuation">-</span> deny  <span class="token list punctuation">-</span> mood_great  <span class="token list punctuation">-</span> mood_unhappy  <span class="token list punctuation">-</span> bot_challengeresponses:  utter_greet:  <span class="token list punctuation">-</span> text: "Hey! How are you?"  utter<span class="token italic"><span class="token punctuation">_</span>cheer<span class="token punctuation">_</span></span>up:  <span class="token list punctuation">-</span> text: "Here is something to cheer you up:"<span class="token code keyword">    image: "https://i.imgur.com/nGF1K8f.jpg"</span>  utter<span class="token italic"><span class="token punctuation">_</span>did<span class="token punctuation">_</span></span>that_help:  <span class="token list punctuation">-</span> text: "Did that help you?"  utter_happy:  <span class="token list punctuation">-</span> text: "Great, carry on!"  utter_goodbye:  <span class="token list punctuation">-</span> text: "Bye"  utter_iamabot:  <span class="token list punctuation">-</span> text: "I am a bot, powered by Rasa."session<span class="token italic"><span class="token punctuation">_</span>config:  session<span class="token punctuation">_</span></span>expiration<span class="token italic"><span class="token punctuation">_</span>time: 60  carry<span class="token punctuation">_</span></span>over<span class="token italic"><span class="token punctuation">_</span>slots<span class="token punctuation">_</span></span>to<span class="token italic"><span class="token punctuation">_</span>new<span class="token punctuation">_</span></span>session: true</code></pre><p><strong>è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</strong></p><p>æ‚¨çš„NLUæ¨¡å‹å°†å®šä¹‰<code>intents</code>å’Œ<code>entities</code>ï¼Œæ‚¨éœ€è¦å°†å…¶åŒ…æ‹¬åœ¨åŸŸä¸­ã€‚æœ¬<code>entities</code>èŠ‚åˆ—å‡ºäº†æ‚¨çš„NLUç®¡é“ä¸­ä»»ä½•<a href="#">å®ä½“æå–å™¨</a>æå–çš„æ‰€æœ‰<a href="#">å®ä½“</a>ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">entities:   <span class="token list punctuation">-</span> PERSON          # entity extracted by SpacyEntityExtractor   <span class="token list punctuation">-</span> time            # entity extracted by DucklingHTTPExtractor   <span class="token list punctuation">-</span> membership_type # custom entity extracted by CRFEntityExtractor   <span class="token list punctuation">-</span> priority        # custom entity extracted by CRFEntityExtractor</code></pre><p><a href="#">slotä¸­åŒ…å«</a>æ‚¨è¦åœ¨å¯¹è¯æœŸé—´è·Ÿè¸ªçš„ä¿¡æ¯ã€‚ç§°ä¸ºç±»åˆ«slotçš„<code>risk_level</code>å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown">slots:   risk_level:<span class="token code keyword">      type: categorical</span><span class="token code keyword">      values:</span><span class="token code keyword">      - low</span><span class="token code keyword">      - medium</span><span class="token code keyword">      - high</span></code></pre><p><a href="#">åœ¨è¿™é‡Œï¼Œ</a>æ‚¨å¯ä»¥æ‰¾åˆ°Rasa Coreå®šä¹‰çš„æ’æ§½ç±»å‹çš„å®Œæ•´åˆ—è¡¨ï¼Œä»¥åŠå°†å…¶åŒ…å«åœ¨åŸŸæ–‡ä»¶ä¸­çš„è¯­æ³•ã€‚</p><p><a href="#">åŠ¨ä½œ</a>æ˜¯æ‚¨çš„æœºå™¨äººå®é™…ä¸Šå¯ä»¥åšçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ¨ä½œå¯ä»¥ï¼š</p><ul><li>å›åº”ç”¨æˆ·</li><li>è¿›è¡Œå¤–éƒ¨APIè°ƒç”¨ï¼Œ</li><li>æŸ¥è¯¢æ•°æ®åº“ï¼Œæˆ–</li><li>å‡ ä¹ä»»ä½•ä¸œè¥¿ï¼</li></ul><h3 id="è‡ªå®šä¹‰åŠ¨ä½œå’Œæ§½ä½"><a href="#è‡ªå®šä¹‰åŠ¨ä½œå’Œæ§½ä½" class="headerlink" title="è‡ªå®šä¹‰åŠ¨ä½œå’Œæ§½ä½"></a>è‡ªå®šä¹‰åŠ¨ä½œå’Œæ§½ä½</h3><p>è¦å¼•ç”¨æ‚¨åŸŸä¸­çš„æ’æ§½ï¼Œæ‚¨éœ€è¦æŒ‰å…¶<strong>æ¨¡å—è·¯å¾„</strong>å¯¹å…¶è¿›è¡Œå¼•ç”¨ã€‚è¦å¼•ç”¨è‡ªå®šä¹‰æ“ä½œï¼Œè¯·ä½¿ç”¨å…¶<strong>åç§°</strong>ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåä¸ºæ¨¡å—<code>my_actions</code>åŒ…å«ä¸€ä¸ªç±»<code>MyAwesomeAction</code>å’Œæ¨¡å—<code>my_slots</code>åŒ…å« <code>MyAwesomeSlot</code>ï¼Œå°†æ·»åŠ è¿™äº›è¡Œåˆ°åŸŸæ–‡ä»¶ï¼š</p><pre class=" language-markdown"><code class="language-markdown">actions:  <span class="token list punctuation">-</span> my<span class="token italic"><span class="token punctuation">_</span>custom<span class="token punctuation">_</span></span>action  ...slots:  <span class="token list punctuation">-</span> my_slots.MyAwesomeSlot</code></pre><p>åœ¨æ­¤ç¤ºä¾‹<code>name</code>ä¸­<code>MyAwesomeAction</code>éœ€è¦è¿”å› çš„åŠŸèƒ½<code>my_custom_action</code>ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">Custom Actions</a>ï¼‰ã€‚</p><h3 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h3><p>å“åº”æ˜¯æœºå™¨äººå°†å‘å›ç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚æœ‰ä¸¤ç§ä½¿ç”¨è¿™äº›å“åº”çš„æ–¹æ³•ï¼š</p><ol><li><p>å¦‚æœå“åº”çš„åç§°ä»¥å¼€å¤´<code>utter_</code>ï¼Œåˆ™è¯¥å“åº”å¯ä»¥ç›´æ¥ç”¨ä½œæ“ä½œã€‚æ‚¨å¯ä»¥å°†å“åº”æ·»åŠ åˆ°åŸŸä¸­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">responses:  utter_greet:  <span class="token list punctuation">-</span> text: "Hey! How are you?"</code></pre><p>ä¹‹åï¼Œæ‚¨å¯ä»¥å°†å“åº”ç”¨ä½œæ•…äº‹ä¸­çš„åŠ¨ä½œï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> greet the user</span><span class="token list punctuation">*</span> intent_greet  <span class="token list punctuation">-</span> utter_greet</code></pre><p>å½“<code>utter_greet</code>ä½œä¸ºæ“ä½œè¿è¡Œæ—¶ï¼Œå®ƒå°†æŠŠå“åº”ä¸­çš„æ¶ˆæ¯å‘é€å›ç”¨æˆ·ã€‚</p></li><li><p>æ‚¨å¯ä»¥ä½¿ç”¨å“åº”ï¼Œä½¿ç”¨è°ƒåº¦ç¨‹åºä»æ‚¨çš„è‡ªå®šä¹‰æ“ä½œç”Ÿæˆå“åº”æ¶ˆæ¯ï¼š <code>dispatcher.utter_message(template="utter_greet")</code>ã€‚è¿™ä½¿æ‚¨å¯ä»¥ä»å®é™…å‰¯æœ¬ä¸­åˆ†ç¦»å‡ºç”Ÿæˆæ¶ˆæ¯çš„é€»è¾‘ã€‚åœ¨æ‚¨çš„è‡ªå®šä¹‰æ“ä½œä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥æ ¹æ®ä»¥ä¸‹å“åº”å‘é€æ¶ˆæ¯ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>actions <span class="token keyword">import</span> Action<span class="token keyword">class</span> <span class="token class-name">ActionGreet</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>      <span class="token keyword">return</span> <span class="token string">'action_greet'</span>  <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>      dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_greet"</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre></li></ol><h3 id="å›¾åƒå’ŒæŒ‰é’®"><a href="#å›¾åƒå’ŒæŒ‰é’®" class="headerlink" title="å›¾åƒå’ŒæŒ‰é’®"></a>å›¾åƒå’ŒæŒ‰é’®</h3><p>Domainçš„yamlæ–‡ä»¶ä¸­å®šä¹‰çš„å“åº”ä¹Ÿå¯ä»¥åŒ…å«å›¾åƒå’ŒæŒ‰é’®ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">responses</span><span class="token punctuation">:</span>  <span class="token key atrule">utter_greet</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Hey! How are you?"</span>    <span class="token key atrule">buttons</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"great"</span>      <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token string">"great"</span>    <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"super sad"</span>      <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token string">"super sad"</span>  <span class="token key atrule">utter_cheer_up</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Here is something to cheer you up:"</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"https://i.imgur.com/nGF1K8f.jpg"</span></code></pre><blockquote><p>æ³¨æ„</p><p>è¯·è®°ä½ï¼Œå¦‚ä½•æ˜¾ç¤ºå®šä¹‰çš„æŒ‰é’®å–å†³äºè¾“å‡ºé€šé“çš„å®ç°ã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤è¡Œæ— æ³•æ˜¾ç¤ºæŒ‰é’®æˆ–å›¾åƒï¼Œè€Œæ˜¯å°è¯•é€šè¿‡æ‰“å°é€‰é¡¹æ¥æ¨¡ä»¿å®ƒä»¬ã€‚</p></blockquote><h3 id="è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè½½è·"><a href="#è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè½½è·" class="headerlink" title="è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè½½è·"></a>è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè½½è·</h3><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>custom:</code>é”®å°†ä»»æ„è¾“å‡ºå‘é€åˆ°è¾“å‡ºé€šé“ ã€‚è¯·æ³¨æ„ï¼Œç”±äºåŸŸä¸ºyamlæ ¼å¼ï¼Œå› æ­¤jsonæœ‰æ•ˆè´Ÿè½½åº”é¦–å…ˆè½¬æ¢ä¸ºyamlæ ¼å¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå°½ç®¡æ—¥æœŸé€‰æ‹©å™¨ä¸æ˜¯å“åº”ä¸­å®šä¹‰çš„å‚æ•°ï¼Œå› ä¸ºå¤§å¤šæ•°æ¸ é“ä¸æ”¯æŒå®ƒä»¬ï¼Œä½†æ˜¯å¯ä»¥åƒè¿™æ ·å‘é€Slackæ—¥æœŸé€‰æ‹©å™¨ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">responses</span><span class="token punctuation">:</span>  <span class="token key atrule">utter_take_bet</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">custom</span><span class="token punctuation">:</span>      <span class="token key atrule">blocks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> section        <span class="token key atrule">text</span><span class="token punctuation">:</span>          <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Make a bet on when the world will end:"</span>          <span class="token key atrule">type</span><span class="token punctuation">:</span> mrkdwn        <span class="token key atrule">accessory</span><span class="token punctuation">:</span>          <span class="token key atrule">type</span><span class="token punctuation">:</span> datepicker          <span class="token key atrule">initial_date</span><span class="token punctuation">:</span> <span class="token string">'2019-05-21'</span>          <span class="token key atrule">placeholder</span><span class="token punctuation">:</span>            <span class="token key atrule">type</span><span class="token punctuation">:</span> plain_text            <span class="token key atrule">text</span><span class="token punctuation">:</span> Select a date</code></pre><h3 id="é€šé“ç‰¹å¼‚æ€§åº”ç­”"><a href="#é€šé“ç‰¹å¼‚æ€§åº”ç­”" class="headerlink" title="é€šé“ç‰¹å¼‚æ€§åº”ç­”"></a>é€šé“ç‰¹å¼‚æ€§åº”ç­”</h3><p>å¯¹äºæ¯ä¸ªå“åº”ï¼Œæ‚¨å¯ä»¥æœ‰å¤šä¸ª<strong>å“åº”æ¨¡æ¿</strong>ï¼ˆè¯·å‚é˜…<a href="#">å˜ä½“</a>ï¼‰ã€‚å¦‚æœæ‚¨æœ‰æŸäº›ä»…å¸Œæœ›å‘é€åˆ°ç‰¹å®šé¢‘é“çš„å“åº”æ¨¡æ¿ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>channel:</code>é”®æŒ‡å®šæ­¤æ¨¡æ¿ã€‚è¯¥å€¼åº”ä¸<code>name()</code>é€šé“<code>OutputChannel</code> ç±»çš„æ–¹æ³•ä¸­å®šä¹‰çš„åç§°åŒ¹é…ã€‚å¦‚æœåˆ›å»ºä»…åœ¨æŸäº›é€šé“ä¸­èµ·ä½œç”¨çš„è‡ªå®šä¹‰è¾“å‡ºæœ‰æ•ˆè´Ÿè½½ï¼Œåˆ™ç‰¹å®šäºé€šé“çš„å“åº”ç‰¹åˆ«æœ‰ç”¨ã€‚</p><pre class=" language-markdown"><code class="language-markdown">responses:  utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>game:  <span class="token list punctuation">-</span> text: "Which game would you like to play?"<span class="token code keyword">    channel: "slack"</span><span class="token code keyword">    custom:</span><span class="token code keyword">      - # payload for Slack dropdown menu to choose a game</span>  <span class="token list punctuation">-</span> text: "Which game would you like to play?"<span class="token code keyword">    buttons:</span><span class="token code keyword">    - title: "Chess"</span><span class="token code keyword">      payload: '/inform&amp;#123;"game": "chess"&amp;#125;'</span><span class="token code keyword">    - title: "Checkers"</span><span class="token code keyword">      payload: '/inform&amp;#123;"game": "checkers"&amp;#125;'</span><span class="token code keyword">    - title: "Fortnite"</span><span class="token code keyword">      payload: '/inform&amp;#123;"game": "fortnite"&amp;#125;'</span></code></pre><p>æ¯æ¬¡æ‚¨çš„æ¼«æ¸¸å™¨å¯»æ‰¾å“åº”æ—¶ï¼Œå®ƒå°†é¦–å…ˆæ£€æŸ¥ä»¥æŸ¥çœ‹æ‰€è¿æ¥é€šé“æ˜¯å¦æœ‰ä»»ä½•ç‰¹å®šäºé€šé“çš„å“åº”æ¨¡æ¿ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°†<strong>ä»…ä»</strong>è¿™äº›å“åº”æ¨¡æ¿ä¸­è¿›è¡Œé€‰æ‹©ã€‚å¦‚æœæœªæ‰¾åˆ°ç‰¹å®šäºé€šé“çš„å“åº”æ¨¡æ¿ï¼Œå®ƒå°†ä»ä»»ä½•æœªå®šä¹‰çš„å“åº”æ¨¡æ¿ä¸­è¿›è¡Œé€‰æ‹©<code>channel</code>ã€‚å› æ­¤ï¼Œä¼˜è‰¯ä½œæ³•æ˜¯å§‹ç»ˆä¸ºæ¯ä¸ªæœª<code>channel</code>æŒ‡å®šçš„å“åº”è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªå“åº”æ¨¡æ¿ï¼Œä»¥ä¾¿æ‚¨çš„æœºå™¨äººå¯ä»¥åœ¨æ‰€æœ‰ç¯å¢ƒä¸­åšå‡ºå“åº”ï¼ŒåŒ…æ‹¬åœ¨Shellå’Œäº¤äº’å¼å­¦ä¹ ä¸­ã€‚</p><h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a><a href="https://legacy-docs-v1.rasa.com/core/domains/#id9">å˜é‡</a></h2><p>æ‚¨è¿˜å¯ä»¥åœ¨å“åº”ä¸­ä½¿ç”¨<strong>å˜é‡</strong>æ¥æ’å…¥å¯¹è¯æœŸé—´æ”¶é›†çš„ä¿¡æ¯ã€‚æ‚¨å¯ä»¥åœ¨è‡ªå®šä¹‰pythonä»£ç ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ’æ§½å¡«å……æœºåˆ¶æ‰§è¡Œæ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰è¿™æ ·çš„ç­”å¤ï¼š</p><pre><code>responses:  utter_greet:  - text: "Hey, &amp;#123;name&amp;#125;. How are you?"</code></pre><p>Rasaä¼šè‡ªåŠ¨ä½¿ç”¨åœ¨åä¸ºçš„æ’æ§½ä¸­æ‰¾åˆ°çš„å€¼å¡«å……è¯¥å˜é‡ <code>name</code>ã€‚</p><p>åœ¨è‡ªå®šä¹‰ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ£€ç´¢å“åº”ï¼š</p><pre><code>class ActionCustom(Action):   def name(self):      return "action_custom"   def run(self, dispatcher, tracker, domain):      # send utter default response to user      dispatcher.utter_message(template="utter_default")      # ... other code      return []</code></pre><p>å¦‚æœå“åº”åŒ…å«ç”¨è¡¨ç¤ºçš„å˜é‡ï¼Œåˆ™<code>{my_variable}</code> å¯ä»¥é€šè¿‡å°†å®ƒä»¬ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¥æä¾›å­—æ®µçš„å€¼<code>utter_message</code>ï¼š</p><pre><code>dispatcher.utter_message(template="utter_greet", my_variable="my text")</code></pre><h3 id="å˜ä½“"><a href="#å˜ä½“" class="headerlink" title="å˜ä½“"></a>å˜ä½“</h3><p>å¦‚æœè¦éšæœºæ›´æ”¹å‘é€ç»™ç”¨æˆ·çš„å“åº”ï¼Œåˆ™å¯ä»¥åˆ—å‡ºå¤šä¸ª<strong>å“åº”æ¨¡æ¿</strong>ï¼ŒRasaä¼šéšæœºé€‰æ‹©å…¶ä¸­ä¹‹ä¸€ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">responses:  utter_greeting:  <span class="token list punctuation">-</span> text: "Hey, <span class="token entity" title="&#123;">&amp;#123;</span>name<span class="token entity" title="&#125;">&amp;#125;</span>. How are you?"  <span class="token list punctuation">-</span> text: "Hey, <span class="token entity" title="&#123;">&amp;#123;</span>name<span class="token entity" title="&#125;">&amp;#125;</span>. How is your day going?"</code></pre><h3 id="å¿½ç•¥æŸäº›æ„å›¾çš„å®ä½“"><a href="#å¿½ç•¥æŸäº›æ„å›¾çš„å®ä½“" class="headerlink" title="å¿½ç•¥æŸäº›æ„å›¾çš„å®ä½“"></a>å¿½ç•¥æŸäº›æ„å›¾çš„å®ä½“</h3><p>å¦‚æœå¸Œæœ›æŸäº›æ„å›¾å¿½ç•¥æ‰€æœ‰å®ä½“ï¼Œåˆ™å¯ä»¥å°†å‚æ•°æ·»åŠ åˆ°åŸŸæ–‡ä»¶ä¸­çš„æ„å›¾ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<code>use_entities: []</code></p><pre><code>intents:  - greet:      use_entities: []</code></pre><p>è¦å¿½ç•¥æŸäº›å®ä½“æˆ–æ˜ç¡®åœ°åªè€ƒè™‘æŸäº›å®ä½“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p><pre><code>intents:- greet:    use_entities:      - name      - first_name    ignore_entities:      - location      - age</code></pre><p>è¿™æ„å‘³ç€é’ˆå¯¹è¿™äº›æ„å›¾çš„æ’é™¤å®ä½“å°†ä¸å…·æœ‰åŠŸèƒ½ï¼Œå› æ­¤ä¸ä¼šå½±å“ä¸‹ä¸€ä¸ªåŠ¨ä½œé¢„æµ‹ã€‚å½“æ‚¨æœ‰æ„ä¸åœ¨æ„è¦æ‹¾å–çš„å®ä½“æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚å¦‚æœæ‚¨åœ¨æ²¡æœ‰æ­¤å‚æ•°çš„æƒ…å†µä¸‹æŒ‰å¸¸è§„åˆ—å‡ºæ‚¨çš„æ„å›¾ï¼Œåˆ™å®ä½“å°†æ­£å¸¸åŒ–ã€‚</p><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨ç¡®å®å¸Œæœ›è¿™äº›å®ä½“ä¸å½±å“åŠ¨ä½œé¢„æµ‹ï¼Œå»ºè®®æ‚¨ä½¿ç”¨ç›¸åŒçš„typeåç§°åˆ¶ä½œå¹¿å‘Šä½<code>unfeaturized</code>ã€‚</p></blockquote><h3 id="ä¼šè¯é…ç½®"><a href="#ä¼šè¯é…ç½®" class="headerlink" title="ä¼šè¯é…ç½®"></a>ä¼šè¯é…ç½®</h3><p>å¯¹è¯ä¼šè¯ä»£è¡¨åŠ©æ‰‹å’Œç”¨æˆ·ä¹‹é—´çš„å¯¹è¯ã€‚ä¼šè¯ä¼šè¯å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼å¼€å§‹ï¼š</p><blockquote><ol><li>ç”¨æˆ·å¼€å§‹ä¸åŠ©æ‰‹è¿›è¡Œå¯¹è¯ï¼Œ</li><li>ç”¨æˆ·åœ¨ä¸€æ®µå¯é…ç½®çš„ä¸æ´»åŠ¨æ—¶é—´åå‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ–è€…</li><li>æ‰‹åŠ¨ä¼šè¯å¼€å§‹ç”±<code>/session_start</code>æ„å›¾æ¶ˆæ¯è§¦å‘ã€‚</li></ol></blockquote><p>æ‚¨å¯ä»¥åœ¨<code>session_config</code>å¯†é’¥ä¸‹çš„åŸŸä¸­å®šä¹‰é—²ç½®æ—¶é—´æ®µï¼Œä¹‹ååœ¨è¯¥é—²ç½®æ—¶é—´æ®µå†…è§¦å‘æ–°çš„ä¼šè¯ä¼šè¯ã€‚ <code>session_expiration_time</code>å®šä¹‰é—²ç½®æ—¶é—´ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰ï¼Œä¹‹åæ–°ä¼šè¯å°†å¼€å§‹ã€‚<code>carry_over_slots_to_new_session</code>ç¡®å®šæ˜¯å¦åº”å°†ç°æœ‰è®¾ç½®çš„æ—¶éš™è½¬å…¥æ–°ä¼šè¯ã€‚</p><p>é»˜è®¤ä¼šè¯é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown">session<span class="token italic"><span class="token punctuation">_</span>config:  session<span class="token punctuation">_</span></span>expiration<span class="token italic"><span class="token punctuation">_</span>time: 60  # value in minutes, 0 means infinitely long  carry<span class="token punctuation">_</span></span>over<span class="token italic"><span class="token punctuation">_</span>slots<span class="token punctuation">_</span></span>to<span class="token italic"><span class="token punctuation">_</span>new<span class="token punctuation">_</span></span>session: true  # set to false to forget slots between sessions</code></pre><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœç”¨æˆ·åœ¨é—²ç½®60åˆ†é’Ÿåå‘é€äº†ä»–ä»¬çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™ä¼šè§¦å‘ä¸€ä¸ªæ–°çš„ä¼šè¯ä¼šè¯ï¼Œå¹¶ä¸”æ‰€æœ‰ç°æœ‰çš„æ—¶éš™éƒ½å°†è¢«å¸¦å…¥æ–°çš„ä¼šè¯ä¸­ã€‚å°†å€¼è®¾ç½®<code>session_expiration_time</code>ä¸º0æ„å‘³ç€ä¼šè¯å°†ä¸ä¼šç»“æŸï¼ˆè¯·æ³¨æ„ï¼Œè¯¥<code>action_session_start</code>æ“ä½œä»å°†åœ¨ä¼šè¯å¼€å§‹æ—¶è§¦å‘ï¼‰ã€‚</p><blockquote><p>æ³¨æ„</p><p>ä¼šè¯å¼€å§‹ä¼šè§¦å‘é»˜è®¤æ“ä½œ<code>action_session_start</code>ã€‚å®ƒçš„é»˜è®¤å®ç°å°†æ‰€æœ‰ç°æœ‰çš„æ’æ§½ç§»åˆ°æ–°ä¼šè¯ä¸­ã€‚è¯·æ³¨æ„ï¼Œæ‰€æœ‰å¯¹è¯å‡ä»¥å¼€å¤´<code>action_session_start</code>ã€‚è¦†ç›–æ­¤æ“ä½œå¯ä»¥ä¾‹å¦‚ç”¨äºä½¿ç”¨æ¥è‡ªå¤–éƒ¨APIè°ƒç”¨çš„æ’æ§½åˆå§‹åŒ–è·Ÿè¸ªå™¨ï¼Œæˆ–ä½¿ç”¨æ¼«æ¸¸å™¨æ¶ˆæ¯å¼€å§‹å¯¹è¯ã€‚æœ‰å…³<a href="#">è‡ªå®šä¹‰ä¼šè¯å¼€å§‹æ“ä½œ</a>çš„æ–‡æ¡£ å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚</p></blockquote><h2 id="å“åº”-1"><a href="#å“åº”-1" class="headerlink" title="å“åº”"></a>å“åº”</h2><p>å¦‚æœæ‚¨å¸Œæœ›åŠ©æ‰‹å“åº”ç”¨æˆ·æ¶ˆæ¯ï¼Œåˆ™éœ€è¦ç®¡ç†è¿™äº›å“åº”ã€‚åœ¨æ‚¨çš„æœºå™¨äººçš„è®­ç»ƒæ•°æ®ä¸­ï¼Œæ‚¨çš„æ•…äº‹ä¸­ï¼Œæ‚¨æŒ‡å®šäº†æœºå™¨äººåº”è¯¥æ‰§è¡Œçš„åŠ¨ä½œã€‚è¿™äº›æ“ä½œå¯ä»¥ä½¿ç”¨å“åº”å°†æ¶ˆæ¯å‘é€å›ç”¨æˆ·ã€‚</p><p>æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥ç®¡ç†è¿™äº›å“åº”ï¼š</p><ol><li>å›å¤é€šå¸¸å­˜å‚¨åœ¨æ‚¨çš„åŸŸæ–‡ä»¶ä¸­ï¼Œè¯·å‚è§<a href="#">æ­¤å¤„</a></li><li>æ£€ç´¢åŠ¨ä½œå“åº”æ˜¯è®­ç»ƒæ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œè¯·å‚è§<a href="#">æ­¤å¤„</a></li><li>æ‚¨è¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰NLGæœåŠ¡ä»¥ç”Ÿæˆå“åº”ï¼Œè¯·å‚è§<a href="#">æ­¤å¤„</a></li></ol><h3 id="åœ¨åŸŸä¸­åŒ…æ‹¬å“åº”"><a href="#åœ¨åŸŸä¸­åŒ…æ‹¬å“åº”" class="headerlink" title="åœ¨åŸŸä¸­åŒ…æ‹¬å“åº”"></a>åœ¨åŸŸä¸­åŒ…æ‹¬å“åº”</h3><p>é»˜è®¤æ ¼å¼æ˜¯å°†å“åº”åŒ…å«åœ¨åŸŸæ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œè¯¥æ–‡ä»¶åŒ…å«å¯¹æ‰€æœ‰è‡ªå®šä¹‰æ“ä½œï¼Œå¯ç”¨å®ä½“ï¼Œæ’æ§½å’Œæ„å›¾çš„å¼•ç”¨ã€‚</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> all hashtags are comments :)</span>intents: <span class="token list punctuation">-</span> greet <span class="token list punctuation">-</span> default <span class="token list punctuation">-</span> goodbye <span class="token list punctuation">-</span> affirm <span class="token list punctuation">-</span> thank_you <span class="token list punctuation">-</span> change<span class="token italic"><span class="token punctuation">_</span>bank<span class="token punctuation">_</span></span>details <span class="token list punctuation">-</span> simple <span class="token list punctuation">-</span> hello <span class="token list punctuation">-</span> why <span class="token list punctuation">-</span> next_intententities: <span class="token list punctuation">-</span> nameslots:  name:<span class="token code keyword">    type: text</span>responses:  utter_greet:<span class="token code keyword">    - text: "hey there &amp;#123;name&amp;#125;!"  # &amp;#123;name&amp;#125; will be filled by slot (same name) or by custom action</span>  utter_channel:<span class="token code keyword">    - text: "this is a default channel"</span><span class="token code keyword">    - text: "you're talking to me on slack!"  # if you define channel-specific utterances, the bot will pick</span><span class="token code keyword">      channel: "slack"                        # from those when talking on that specific channel</span>  utter_goodbye:<span class="token code keyword">    - text: "goodbye ğŸ˜¢"   # multiple responses - bot will randomly pick one of them</span><span class="token code keyword">    - text: "bye bye ğŸ˜¢"</span>  utter<span class="token italic"><span class="token punctuation">_</span>default:   # utterance sent by action<span class="token punctuation">_</span></span>default_fallback<span class="token code keyword">    - text: "sorry, I didn't get that, can you rephrase it?"</span></code></pre><p>åœ¨æ­¤ç¤ºä¾‹åŸŸæ–‡ä»¶ä¸­ï¼Œè¯¥éƒ¨åˆ†<code>responses</code>åŒ…å«åŠ©æ‰‹ç”¨äºå‘ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å“åº”ã€‚</p><blockquote><p>æ³¨æ„</p><p>å¦‚æœè¦æ›´æ”¹æ–‡æœ¬æˆ–æ¼«æ¸¸å™¨å“åº”çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ï¼Œåˆ™éœ€è¦é‡æ–°åŸ¹è®­åŠ©æ‰‹ï¼Œç„¶åæ‰èƒ½æ¥å—è¿™äº›æ›´æ”¹ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>æ•…äº‹ä¸­ä½¿ç”¨çš„å“åº”åº”<code>stories</code> åœ¨domain.ymlæ–‡ä»¶çš„éƒ¨åˆ†ä¸­åˆ—å‡ºã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>utter_channel</code> æ•…äº‹ä¸­æœªä½¿ç”¨å“åº”ï¼Œå› æ­¤è¯¥éƒ¨åˆ†ä¸­æœªåˆ—å‡ºè¯¥å“åº”ã€‚</p></blockquote><p>æœ‰å…³è¿™äº›å“åº”æ ¼å¼çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æœ‰å…³åŸŸæ–‡ä»¶æ ¼å¼çš„æ–‡æ¡£ï¼š<a href="https://legacy-docs-v1.rasa.com/core/domains/#domain-responses">Responses</a>ã€‚</p><h3 id="ä¸ºæœºå™¨äººå“åº”åˆ›å»ºè‡ªå·±çš„NLGæœåŠ¡"><a href="#ä¸ºæœºå™¨äººå“åº”åˆ›å»ºè‡ªå·±çš„NLGæœåŠ¡" class="headerlink" title="ä¸ºæœºå™¨äººå“åº”åˆ›å»ºè‡ªå·±çš„NLGæœåŠ¡"></a>ä¸ºæœºå™¨äººå“åº”åˆ›å»ºè‡ªå·±çš„NLGæœåŠ¡</h3><p>åœ¨æŸäº›å·¥ä½œæµç¨‹ä¸­ï¼Œä»…å¯¹æœºå™¨äººè¿›è¡Œå†åŸ¹è®­ä»¥æ›´æ”¹æ–‡æœ¬å‰¯æœ¬å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚å› æ­¤ï¼ŒCoreè¿˜å…è®¸æ‚¨å°†å“åº”ç”Ÿæˆå¤–åŒ…å¹¶å°†å…¶ä¸å¯¹è¯å­¦ä¹ åŒºåˆ†å¼€ã€‚</p><p>åŠ©æ‰‹ä»å°†å­¦ä¹ é¢„æµ‹åŠ¨ä½œå¹¶æ ¹æ®è¿‡å»çš„å¯¹è¯å¯¹ç”¨æˆ·è¾“å…¥åšå‡ºååº”ï¼Œä½†æ˜¯åŠ©æ‰‹å‘é€å›ç”¨æˆ·çš„å“åº”æ˜¯åœ¨Rasa Coreä¹‹å¤–ç”Ÿæˆçš„ã€‚</p><p>å¦‚æœåŠ©æ‰‹æƒ³å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå®ƒå°†é€šè¿‡<code>POST</code>è¯·æ±‚è°ƒç”¨å¤–éƒ¨HTTPæœåŠ¡å™¨ã€‚è¦é…ç½®æ­¤ç«¯ç‚¹ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª<code>endpoints.yml</code>å¹¶å°†å…¶ä¼ é€’ç»™<code>run</code> æˆ–<code>server</code>è„šæœ¬ã€‚çš„å†…å®¹<code>endpoints.yml</code>åº”ä¸º</p><pre class=" language-markdown"><code class="language-markdown">nlg:  url: http://localhost:5055/nlg    # url of the nlg endpoint  <span class="token title important"><span class="token punctuation">#</span> you can also specify additional parameters, if you need them:</span>  <span class="token title important"><span class="token punctuation">#</span> headers:</span>  <span class="token title important"><span class="token punctuation">#</span>   my-custom-header: value</span>  <span class="token title important"><span class="token punctuation">#</span> token: "my_authentication_token"    # will be passed as a get parameter</span>  <span class="token title important"><span class="token punctuation">#</span> basic_auth:</span>  <span class="token title important"><span class="token punctuation">#</span>   username: user</span>  <span class="token title important"><span class="token punctuation">#</span>   password: pass</span><span class="token title important"><span class="token punctuation">#</span> example of redis external tracker store config</span>tracker<span class="token italic"><span class="token punctuation">_</span>store:  type: redis  url: localhost  port: 6379  db: 0  password: password  record<span class="token punctuation">_</span></span>exp: 30000<span class="token title important"><span class="token punctuation">#</span> example of mongoDB external tracker store config</span><span class="token title important"><span class="token punctuation">#</span>tracker_store:</span>  <span class="token title important"><span class="token punctuation">#</span>type: mongod</span>  <span class="token title important"><span class="token punctuation">#</span>url: mongodb://localhost:27017</span>  <span class="token title important"><span class="token punctuation">#</span>db: rasa</span>  <span class="token title important"><span class="token punctuation">#</span>user: username</span>  <span class="token title important"><span class="token punctuation">#</span>password: password</span></code></pre><p>ç„¶ååœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶å°†<code>enable-api</code>æ ‡å¿—ä¼ é€’ç»™å‘½ä»¤ï¼š<code>rasa run</code></p><pre class=" language-shell"><code class="language-shell">rasa run \   --enable-api \   -m examples/babi/models \   --log-file out.log \   --endpoints endpoints.yml</code></pre><p><code>POST</code>å‘é€åˆ°ç«¯ç‚¹çš„è¯·æ±‚çš„ä¸»ä½“å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"tracker"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"latest_message"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span><span class="token punctuation">,</span>      <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>          <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>          <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>      <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    <span class="token property">"sender_id"</span><span class="token operator">:</span> <span class="token string">"22ae96a6-85cd-11e8-b1c3-f40f241f6547"</span><span class="token punctuation">,</span>    <span class="token property">"paused"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"latest_event_time"</span><span class="token operator">:</span> <span class="token number">1531397673.293572</span><span class="token punctuation">,</span>    <span class="token property">"slots"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token null">null</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    <span class="token property">"events"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1531397673.291998</span><span class="token punctuation">,</span>        <span class="token property">"event"</span><span class="token operator">:</span> <span class="token string">"action"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"action_listen"</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1531397673.293572</span><span class="token punctuation">,</span>        <span class="token property">"parse_data"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>          <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span><span class="token punctuation">,</span>          <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            &amp;#<span class="token number">123</span><span class="token punctuation">;</span>              <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>            &amp;#<span class="token number">125</span><span class="token punctuation">;</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>          &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>          <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        <span class="token property">"event"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>        <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>  <span class="token property">"arguments"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>  <span class="token property">"template"</span><span class="token operator">:</span> <span class="token string">"utter_greet"</span><span class="token punctuation">,</span>  <span class="token property">"channel"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"collector"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>ç„¶åï¼Œç«¯ç‚¹éœ€è¦ä½¿ç”¨ç”Ÿæˆçš„å“åº”è¿›è¡Œå“åº”ï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"hey there"</span><span class="token punctuation">,</span>    <span class="token property">"buttons"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"image"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>    <span class="token property">"elements"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"attachments"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>ç„¶åï¼ŒRasaå°†ä½¿ç”¨æ­¤å“åº”å¹¶å°†å…¶å‘é€å›ç”¨æˆ·ã€‚</p><h2 id="ä¸»åŠ¨é€šè¿‡å¤–éƒ¨äº‹ä»¶ä¸ç”¨æˆ·è”ç³»"><a href="#ä¸»åŠ¨é€šè¿‡å¤–éƒ¨äº‹ä»¶ä¸ç”¨æˆ·è”ç³»" class="headerlink" title="ä¸»åŠ¨é€šè¿‡å¤–éƒ¨äº‹ä»¶ä¸ç”¨æˆ·è”ç³»"></a>ä¸»åŠ¨é€šè¿‡å¤–éƒ¨äº‹ä»¶ä¸ç”¨æˆ·è”ç³»</h2><p>æ‚¨å¯èƒ½å¸Œæœ›ä¸»åŠ¨ä¸ç”¨æˆ·è”ç³»ï¼Œä¾‹å¦‚æ˜¾ç¤ºé•¿æ—¶é—´è¿è¡Œçš„åå°æ“ä½œçš„è¾“å‡ºæˆ–å°†å¤–éƒ¨äº‹ä»¶é€šçŸ¥ç»™ç”¨æˆ·ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·<a href="https://github.com/RasaHQ/rasa/tree/master/examples/reminderbot/README.md">reminderbot</a>åœ¨èä¾‹å­ç›®å½•æˆ–å¯è€ƒè™‘<a href="#">æé†’å’Œå¤–éƒ¨äº‹ä»¶</a>ã€‚</p><h2 id="åŠ¨ä½œ-1"><a href="#åŠ¨ä½œ-1" class="headerlink" title="åŠ¨ä½œ"></a>åŠ¨ä½œ</h2><p>åŠ¨ä½œæ˜¯æ‚¨çš„æœºå™¨äººæ ¹æ®ç”¨æˆ·è¾“å…¥è¿è¡Œçš„ä¸œè¥¿ã€‚Rasaä¸­æœ‰å››ç§åŠ¨ä½œï¼š</p><blockquote><ol><li><strong>è¯è¯­æ“ä½œ</strong>ï¼šä»å¼€å§‹<code>utter_</code>å¹¶å‘ç”¨æˆ·å‘é€ç‰¹å®šæ¶ˆæ¯ã€‚</li><li><strong>æ£€ç´¢åŠ¨ä½œ</strong>ï¼š<code>respond_</code>ä»¥æ£€ç´¢æ¨¡å‹é€‰æ‹©çš„æ¶ˆæ¯å¼€å¤´å¹¶å‘é€æ¶ˆæ¯ã€‚</li><li><strong>è‡ªå®šä¹‰æ“ä½œ</strong>ï¼šè¿è¡Œä»»æ„ä»£ç å¹¶å‘é€ä»»æ„æ•°é‡çš„æ¶ˆæ¯ï¼ˆæˆ–ä¸å‘é€ä»»ä½•æ¶ˆæ¯ï¼‰ã€‚</li><li><strong>é»˜è®¤åŠ¨ä½œ</strong>ï¼šä¾‹å¦‚<code>action_listen</code>ï¼Œ<code>action_restart</code>ï¼Œ <code>action_default_fallback</code>ã€‚</li></ol></blockquote><ul><li><a href="#">è¯è¯­åŠ¨ä½œ</a></li><li><a href="#">æ£€ç´¢åŠ¨ä½œ</a></li><li><a href="#">è‡ªå®šä¹‰åŠ¨ä½œ</a><ul><li><a href="#">ç”¨Pythonç¼–å†™çš„è‡ªå®šä¹‰åŠ¨ä½œ</a></li></ul></li><li><a href="#">ç”¨å…¶ä»–ä»£ç æ‰§è¡ŒåŠ¨ä½œ</a></li><li><a href="#">é»˜è®¤åŠ¨ä½œ</a></li></ul><h3 id="è¯è¯­åŠ¨ä½œ"><a href="#è¯è¯­åŠ¨ä½œ" class="headerlink" title="è¯è¯­åŠ¨ä½œ"></a>è¯è¯­åŠ¨ä½œ</h3><p>è¦å®šä¹‰è¯­éŸ³æ“ä½œï¼ˆ<code>ActionUtterTemplate</code>ï¼‰ï¼Œè¯·å‘ä»¥ä»¥ä¸‹å†…å®¹å¼€å¤´çš„åŸŸæ–‡ä»¶æ·»åŠ å“åº”<code>utter_</code>ï¼š</p><pre><code>responses:  utter_my_message:    - "this is what I want my action to say!"</code></pre><p>é€šå¸¸ç”¨æ¥å¼€å¤´å‘å£°åŠ¨ä½œçš„åç§°<code>utter_</code>ã€‚å¦‚æœç¼ºå°‘æ­¤å‰ç¼€ï¼Œæ‚¨ä»ç„¶å¯ä»¥åœ¨è‡ªå®šä¹‰æ“ä½œä¸­ä½¿ç”¨å“åº”ï¼Œä½†æ˜¯ä¸èƒ½å°†å“åº”ç›´æ¥é¢„æµ‹ä¸ºå®ƒè‡ªå·±çš„æ“ä½œã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">å“åº”</a>ã€‚</p><p>å¦‚æœä½¿ç”¨å¤–éƒ¨NLGæœåŠ¡ï¼Œåˆ™æ— éœ€åœ¨åŸŸä¸­æŒ‡å®šå“åº”ï¼Œä½†ä»éœ€è¦å°†è¯è¯­åç§°æ·»åŠ åˆ°åŸŸçš„æ“ä½œåˆ—è¡¨ä¸­ã€‚</p><h3 id="æ£€ç´¢æ“ä½œ"><a href="#æ£€ç´¢æ“ä½œ" class="headerlink" title="æ£€ç´¢æ“ä½œ"></a>æ£€ç´¢æ“ä½œ</h3><p>æ£€ç´¢æ“ä½œä½¿å¤„ç†è¯¸å¦‚chitchatå’ŒFAQä¹‹ç±»çš„å¤§é‡ç›¸ä¼¼æ„å›¾å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¯·å‚é˜…<a href="#">æ£€ç´¢æ“ä½œ</a>ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="è‡ªå®šä¹‰åŠ¨ä½œ"><a href="#è‡ªå®šä¹‰åŠ¨ä½œ" class="headerlink" title="è‡ªå®šä¹‰åŠ¨ä½œ"></a>è‡ªå®šä¹‰åŠ¨ä½œ</h3><p>ä¸€ä¸ªåŠ¨ä½œå¯ä»¥è¿è¡Œæ‚¨æƒ³è¦çš„ä»»ä½•ä»£ç ã€‚è‡ªå®šä¹‰æ“ä½œå¯ä»¥æ‰“å¼€ç¯ï¼Œå°†äº‹ä»¶æ·»åŠ åˆ°æ—¥å†ï¼Œæ£€æŸ¥ç”¨æˆ·çš„é“¶è¡Œä½™é¢ï¼Œæˆ–è€…æ‚¨å¯ä»¥æƒ³è±¡çš„å…¶ä»–ä»»ä½•äº‹æƒ…ã€‚</p><p>å½“é¢„æµ‹åˆ°è‡ªå®šä¹‰æ“ä½œæ—¶ï¼ŒRasaä¼šè°ƒç”¨æ‚¨å¯ä»¥æŒ‡å®šçš„ç«¯ç‚¹ã€‚è¯¥ç»ˆç»“ç‚¹åº”è¯¥æ˜¯å“åº”æ­¤è°ƒç”¨ï¼Œè¿è¡Œä»£ç å¹¶æœ‰é€‰æ‹©åœ°è¿”å›ä¿¡æ¯ä»¥ä¿®æ”¹å¯¹è¯çŠ¶æ€çš„WebæœåŠ¡å™¨ã€‚</p><p>è¦æŒ‡å®šï¼Œæ‚¨çš„åŠ¨ä½œæœåŠ¡å™¨ä½¿ç”¨<code>endpoints.yml</code>ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">action_endpoint</span><span class="token punctuation">:</span>  <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"http://localhost:5055/webhook"</span></code></pre><p>å¹¶ä½¿ç”¨å°†å…¶ä¼ é€’ç»™è„šæœ¬ã€‚<code>--endpoints endpoints.yml</code></p><p>æ‚¨å¯ä»¥ä½¿ç”¨node.jsï¼Œ.NETï¼Œjavaæˆ–ä»»ä½•å…¶ä»–è¯­è¨€åˆ›å»ºåŠ¨ä½œæœåŠ¡å™¨ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰æ‚¨çš„åŠ¨ä½œ-ä½†æ˜¯æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå°å‹python SDKï¼Œå¯ä»¥ä½¿åœ¨é‚£é‡Œçš„å¼€å‘æ›´åŠ è½»æ¾ã€‚</p><blockquote><p>æ³¨æ„</p><p>Rasaä½¿ç”¨ç¥¨è¯é”å®šæœºåˆ¶æ¥ç¡®ä¿æ¥è‡ªç›¸åŒå¯¹è¯IDçš„ä¼ å…¥æ¶ˆæ¯ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œå¹¶ä¸”ä¼šä»¥æ­£ç¡®çš„é¡ºåºè¿›è¡Œå¤„ç†ã€‚å¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„è‡ªå®šä¹‰æ“ä½œéœ€è¦60ç§’é’Ÿä»¥ä¸Šæ‰èƒ½è¿è¡Œï¼Œè¯·å°†<code>TICKET_LOCK_LIFETIME</code>ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæ‚¨çš„æœŸæœ›å€¼ã€‚</p></blockquote><h4 id="ç”¨Pythonç¼–å†™çš„è‡ªå®šä¹‰åŠ¨ä½œ"><a href="#ç”¨Pythonç¼–å†™çš„è‡ªå®šä¹‰åŠ¨ä½œ" class="headerlink" title="ç”¨Pythonç¼–å†™çš„è‡ªå®šä¹‰åŠ¨ä½œ"></a>ç”¨Pythonç¼–å†™çš„è‡ªå®šä¹‰åŠ¨ä½œ</h4><p>å¯¹äºç”¨pythonç¼–å†™çš„åŠ¨ä½œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„<a href="#">Rasa SDK</a>ï¼Œå¯ä¸ºæ‚¨å¯åŠ¨è¯¥åŠ¨ä½œæœåŠ¡å™¨ã€‚</p><h3 id="ç”¨å…¶ä»–ä»£ç æ‰§è¡ŒåŠ¨ä½œ"><a href="#ç”¨å…¶ä»–ä»£ç æ‰§è¡ŒåŠ¨ä½œ" class="headerlink" title="ç”¨å…¶ä»–ä»£ç æ‰§è¡ŒåŠ¨ä½œ"></a>ç”¨å…¶ä»–ä»£ç æ‰§è¡ŒåŠ¨ä½œ</h3><p>Rasaä¼šå°†HTTP<code>POST</code>è¯·æ±‚å‘é€åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³è¦è¿è¡Œçš„æ“ä½œçš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæ­¤è¯·æ±‚å°†åŒ…å«æœ‰å…³å¯¹è¯çš„æ‰€æœ‰ä¿¡æ¯ã€‚<a href="#">Action Server</a>æ˜¾ç¤ºäº†è¯¦ç»†çš„APIè§„èŒƒã€‚</p><p>ä½œä¸ºå¯¹æ¥è‡ªRasaçš„æ“ä½œè°ƒç”¨çš„å“åº”ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹è·Ÿè¸ªå™¨ï¼Œä¾‹å¦‚é€šè¿‡è®¾ç½®æ’æ§½å¹¶å°†å“åº”å‘é€å›ç”¨æˆ·ã€‚æ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯ä½¿ç”¨äº‹ä»¶å®Œæˆçš„ã€‚åœ¨<a href="#">Events</a>ä¸­æœ‰æ‰€æœ‰å¯èƒ½çš„äº‹ä»¶ç±»å‹çš„åˆ—è¡¨ã€‚</p><h3 id="é»˜è®¤åŠ¨ä½œ"><a href="#é»˜è®¤åŠ¨ä½œ" class="headerlink" title="é»˜è®¤åŠ¨ä½œ"></a>é»˜è®¤åŠ¨ä½œ</h3><p>å¯ç”¨çš„é»˜è®¤æ“ä½œæ˜¯ï¼š</p><table><thead><tr><th><code>action_listen</code></th><th>åœæ­¢é¢„æµ‹æ›´å¤šåŠ¨ä½œå¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥ã€‚</th></tr></thead><tbody><tr><td><code>action_restart</code></td><td>é‡è®¾æ•´ä¸ªå¯¹è¯ã€‚å¯ä»¥åœ¨å¯¹è¯æœŸé—´é€šè¿‡è¾“å…¥<code>/restart</code> æ˜¯å¦åœ¨ç­–ç•¥é…ç½®ä¸­åŒ…æ‹¬<a href="#">æ˜ å°„ç­–ç•¥</a>æ¥è§¦å‘ã€‚</td></tr><tr><td><code>action_session_start</code></td><td>å¼€å§‹ä¸€ä¸ªæ–°çš„å¯¹è¯ä¼šè¯ã€‚å ç”¨æ‰€æœ‰å·²è®¾ç½®çš„æ—¶æ®µï¼Œæ ‡è®°æ–°å¯¹è¯ä¼šè¯çš„å¼€å§‹å¹¶é‡æ–°åº”ç”¨ç°æœ‰<code>SlotSet</code> äº‹ä»¶ã€‚<code>session_expiration_time</code>åœ¨åŸŸçš„â€œ<a href="#">ä¼šè¯â€é…ç½®ä¸­</a>çš„å‚æ•°å®šä¹‰çš„ä¸æ´»åŠ¨æ—¶é—´è¿‡åï¼Œå°†è‡ªåŠ¨è§¦å‘æ­¤æ“ä½œ ã€‚å¯ä»¥åœ¨é€šè¯è¿‡ç¨‹ä¸­é€šè¿‡è¾“å…¥æ‰‹åŠ¨è§¦å‘<code>/session_start</code>ã€‚æ‰€æœ‰å¯¹è¯å‡ä»¥å¼€å¤´<code>action_session_start</code>ã€‚</td></tr><tr><td><code>action_default_fallback</code></td><td>æ’¤æ¶ˆä¸Šä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼ˆå¥½åƒç”¨æˆ·æœªå‘é€è¯¥æ¶ˆæ¯ï¼Œå¹¶ä¸”æ¼«æ¸¸å™¨æœªåšå‡ºååº”ï¼‰ï¼Œå¹¶è¯´å‡ºæ¼«æ¸¸å™¨ä¸ç†è§£çš„æ¶ˆæ¯ã€‚è¯·å‚é˜…<a href="#">åå¤‡æ“ä½œ</a>ã€‚</td></tr><tr><td><code>action_deactivate_form</code></td><td>åœç”¨æ´»åŠ¨è¡¨æ ¼å¹¶é‡ç½®è¯·æ±‚çš„æ’æ§½ã€‚å¦è¯·å‚é˜…<a href="#">å¤„ç†ä¸æ„‰å¿«çš„é“è·¯</a>ã€‚</td></tr><tr><td><code>action_revert_fallback_events</code></td><td>è¿˜åŸåœ¨TwoStageFallbackPolicyæœŸé—´å‘ç”Ÿçš„äº‹ä»¶ã€‚è¯·å‚é˜…<a href="#">åå¤‡æ“ä½œ</a>ã€‚</td></tr><tr><td><code>action_default_ask_affirmation</code></td><td>è¦æ±‚ç”¨æˆ·ç¡®è®¤å…¶æ„å›¾ã€‚å»ºè®®ä½¿ç”¨è‡ªå®šä¹‰æ“ä½œè¦†ç›–æ­¤é»˜è®¤æ“ä½œï¼Œä»¥è·å–æ›´æœ‰æ„ä¹‰çš„æç¤ºã€‚</td></tr><tr><td><code>action_default_ask_rephrase</code></td><td>è¦æ±‚ç”¨æˆ·é‡æ–°è¡¨è¾¾è‡ªå·±çš„æ„å›¾ã€‚</td></tr><tr><td><code>action_back</code></td><td>æ’¤æ¶ˆä¸Šä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼ˆå¥½åƒç”¨æˆ·æœªå‘é€è¯¥æ¶ˆæ¯ï¼Œå¹¶ä¸”æ¼«æ¸¸å™¨æœªåšå‡ºååº”ï¼‰ã€‚å¯ä»¥åœ¨å¯¹è¯æœŸé—´é€šè¿‡è¾“å…¥<code>/back</code>æ˜¯å¦åœ¨ç­–ç•¥é…ç½®ä¸­åŒ…å«MappingPolicyæ¥è§¦å‘ã€‚</td></tr></tbody></table><p>å¯ä»¥è¦†ç›–æ‰€æœ‰é»˜è®¤æ“ä½œã€‚ä¸ºæ­¤ï¼Œè¯·å°†æ“ä½œåç§°æ·»åŠ åˆ°æ‚¨åŸŸä¸­çš„æ“ä½œåˆ—è¡¨ä¸­ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">actions</span><span class="token punctuation">:</span><span class="token punctuation">-</span> action_default_ask_affirmation</code></pre><p>ç„¶åï¼ŒRasaå°†è°ƒç”¨æ‚¨çš„æ“ä½œç»ˆç»“ç‚¹ï¼Œå¹¶å°†å…¶è§†ä¸ºå…¶ä»–æ‰€æœ‰è‡ªå®šä¹‰æ“ä½œã€‚</p><h2 id="æé†’å’Œå¤–éƒ¨äº‹ä»¶"><a href="#æé†’å’Œå¤–éƒ¨äº‹ä»¶" class="headerlink" title="æé†’å’Œå¤–éƒ¨äº‹ä»¶"></a>æé†’å’Œå¤–éƒ¨äº‹ä»¶</h2><p>è¯¥<code>ReminderScheduled</code>äº‹ä»¶å’Œ <a href="#">trigger_intentç«¯ç‚¹</a>ä½¿æ‚¨çš„åŠ©æ‰‹å¯ä»¥åœ¨ç»™å®šæ—¶é—´æ®µå†…æé†’æ‚¨æœ‰å…³äº‹ç‰©çš„ä¿¡æ¯ï¼Œæˆ–å“åº”å¤–éƒ¨äº‹ä»¶ï¼ˆå…¶ä»–åº”ç”¨ç¨‹åºï¼Œä¼ æ„Ÿå™¨ç­‰ï¼‰ã€‚æ‚¨å¯ä»¥<a href="https://github.com/RasaHQ/rasa/tree/master/examples/reminderbot/README.md">åœ¨æ­¤å¤„</a>æ‰¾åˆ°å®ç°è¿™äº›åŠŸèƒ½çš„å®Œæ•´ç¤ºä¾‹åŠ©æ‰‹ ã€‚</p><ul><li><a href="#">æé†’äº‹é¡¹</a><ul><li><a href="#">å®‰æ’æé†’</a></li><li><a href="#">å–æ¶ˆæé†’</a></li></ul></li><li><a href="#">å¤–éƒ¨æ´»åŠ¨</a><ul><li><a href="#">è·å–å¯¹è¯ID</a></li><li><a href="#">åº”å¯¹å¤–éƒ¨äº‹ä»¶</a></li></ul></li></ul><h3 id="æé†’"><a href="#æé†’" class="headerlink" title="æé†’"></a>æé†’</h3><p>å¯èƒ½éœ€è¦åœ¨ä¸€æ®µæ—¶é—´åæé†’æ‚¨ä¸€äº›äº‹æƒ…ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤–éƒ¨ä¼ æ„Ÿå™¨ã€‚ä¸ºæ­¤ï¼ŒRasaæä¾›äº†ç‰¹æ®Šäº‹ä»¶<code>ReminderScheduled</code>å’Œå¦ä¸€ä¸ªäº‹ä»¶<code>ReminderCancelled</code>ï¼Œä»¥å–æ¶ˆå®‰æ’æé†’æ—¶é—´ã€‚</p><h3 id="è®¡åˆ’æé†’"><a href="#è®¡åˆ’æé†’" class="headerlink" title="è®¡åˆ’æé†’"></a>è®¡åˆ’æé†’</h3><p>å‡è®¾æ‚¨å¸Œæœ›åŠ©æ‰‹æé†’æ‚¨åœ¨5ç§’é’Ÿå†…æ‰“ç”µè¯ç»™æœ‹å‹ã€‚ï¼ˆæ‚¨å¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´è·¨åº¦ï¼Œä½†æ˜¯ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œå°†å…¶è®¾ä¸º5ç§’ã€‚ï¼‰å› æ­¤ï¼Œæˆ‘ä»¬<code>ask_remind_call</code>ä½¿ç”¨ä¸€äº›NLUæ•°æ®å®šä¹‰äº†ä¸€ä¸ªæ„å›¾ï¼Œ</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:ask_remind_call</span><span class="token list punctuation">-</span> remind me to call <span class="token url">[Albert](name)</span><span class="token list punctuation">-</span> remind me to call <span class="token url">[Susan](name)</span><span class="token list punctuation">-</span> later I have to call <span class="token url">[Daksh](name)</span><span class="token list punctuation">-</span> later I have to call <span class="token url">[Anna](name)</span>...</code></pre><p>å¹¶å°†æ­¤æ„å›¾ä¸æ–°çš„è‡ªå®šä¹‰æ“ä½œç›¸å…³è”<code>action_set_reminder</code>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æä¾›åŸ¹è®­æ•…äº‹ï¼ˆæ¨èç»™æ›´å¤æ‚çš„åŠ©æ‰‹ï¼‰æˆ–ä½¿ç”¨<a href="#">Mapping Policyå»ºç«‹è”ç³»</a>ã€‚</p><p>è‡ªå®šä¹‰æ“ä½œ<code>action_set_reminder</code>åº”å®‰æ’ä¸€ä¸ªæé†’ï¼Œè¯¥æé†’åœ¨5ç§’é’Ÿåè§¦å‘<code>EXTERNAL_reminder</code>ç”¨æˆ·åœ¨å…¶ä¸Šä¸€æ¡æ¶ˆæ¯ä¸­æä¾›çš„æ‰€æœ‰å®ä½“çš„æ„å›¾ï¼ˆç±»ä¼¼äºå¤–éƒ¨äº‹ä»¶ï¼‰ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionSetReminder</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Schedules a reminder, supplied with the last message's entities."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"action_set_reminder"</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span><span class="token string">"I will remind you in 5 seconds."</span><span class="token punctuation">)</span>        date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>        entities <span class="token operator">=</span> tracker<span class="token punctuation">.</span>latest_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"entities"</span><span class="token punctuation">)</span>        reminder <span class="token operator">=</span> ReminderScheduled<span class="token punctuation">(</span>            <span class="token string">"EXTERNAL_reminder"</span><span class="token punctuation">,</span>            trigger_date_time<span class="token operator">=</span>date<span class="token punctuation">,</span>            entities<span class="token operator">=</span>entities<span class="token punctuation">,</span>            name<span class="token operator">=</span><span class="token string">"my_reminder"</span><span class="token punctuation">,</span>            kill_on_user_message<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>reminder<span class="token punctuation">]</span></code></pre><p>è¯·æ³¨æ„ï¼Œè¿™éœ€è¦<code>datetime</code>å’Œ<code>rasa_sdk.events</code>è½¯ä»¶åŒ…ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰å¦ä¸€ä¸ªè‡ªå®šä¹‰åŠ¨ä½œ<code>action_react_to_reminder</code>å¹¶å°†å…¶é“¾æ¥åˆ°<code>EXTERNAL_reminder</code>æ„å›¾ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> EXTERNAL<span class="token italic"><span class="token punctuation">_</span>reminder:  triggers: action<span class="token punctuation">_</span></span>react<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>reminder</code></pre><p>å…¶ä¸­ï¼Œ<code>action_react_to_reminder</code>ä¸º</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionReactToReminder</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Reminds the user to call someone."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"action_react_to_reminder"</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        name <span class="token operator">=</span> next<span class="token punctuation">(</span>tracker<span class="token punctuation">.</span>get_latest_entity_values<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"someone"</span><span class="token punctuation">)</span>        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Remember to call &amp;#123;name&amp;#125;!"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>é™¤äº†è‡ªå®šä¹‰æ“ä½œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç®€å•çš„å“åº”æ¨¡æ¿ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¦åˆ©ç”¨æé†’å¯ä»¥æºå¸¦å®ä½“çš„äº‹å®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨æ­¤è‡ªå®šä¹‰æ“ä½œä¸­å¤„ç†å®ä½“ã€‚</p><blockquote><p>è­¦å‘Š</p><p>æ¯å½“æ‚¨å…³é—­RasaæœåŠ¡å™¨æ—¶ï¼Œæé†’éƒ½ä¼šè¢«å–æ¶ˆã€‚</p></blockquote><blockquote><p>è­¦å‘Š</p><p>å½“å‰æé†’ï¼ˆRasa 1.8ï¼‰ä¸é€‚ç”¨äºrasa shellã€‚æ‚¨å¿…é¡»ä½¿ç”¨<a href="#">æ­£åœ¨è¿è¡Œçš„Rasa XæœåŠ¡å™¨</a>æ¥æµ‹è¯•å®ƒä»¬ ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>ä¸»åŠ¨è”ç³»ç”¨æˆ·å–å†³äºæ¸ é“çš„èƒ½åŠ›ï¼Œå› æ­¤å¹¶éæ¯ä¸ªæ¸ é“éƒ½æ”¯æŒã€‚å¦‚æœæ‚¨çš„é¢‘é“ä¸æ”¯æŒå®ƒï¼Œè¯·è€ƒè™‘ä½¿ç”¨<a href="#">CallbackInput</a>é¢‘é“å°†æ¶ˆæ¯å‘é€åˆ°<a href="https://en.wikipedia.org/wiki/Webhook">webhook</a>ã€‚</p></blockquote><h3 id="å–æ¶ˆæé†’"><a href="#å–æ¶ˆæé†’" class="headerlink" title="å–æ¶ˆæé†’"></a>å–æ¶ˆæé†’</h3><p>æœ‰æ—¶ï¼Œç”¨æˆ·å¯èƒ½æƒ³å–æ¶ˆä»–ä¹‹å‰å·²å®‰æ’çš„æé†’ã€‚å‘åŠ©æ‰‹æ·»åŠ æ­¤åŠŸèƒ½çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ„å›¾ï¼Œ<code>ask_forget_reminders</code>ç„¶åè®©åŠ©æ‰‹é€šè¿‡è‡ªå®šä¹‰æ“ä½œï¼ˆä¾‹å¦‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ForgetReminders</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Cancels all reminders."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"action_forget_reminders"</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Okay, I'll cancel all your reminders."</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Cancel all reminders</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>ReminderCancelled<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>åœ¨è¿™é‡Œï¼Œ<code>ReminderCancelled()</code>åªéœ€å–æ¶ˆå½“å‰é¢„å®šçš„æ‰€æœ‰æé†’ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥æä¾›ä¸€äº›å‚æ•°æ¥ç¼©å°è¦å–æ¶ˆçš„æé†’çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ</p><ul><li><code>ReminderCancelled(intent="greet")</code> æ•…æ„å–æ¶ˆæ‰€æœ‰æé†’ <code>greet</code></li><li><code>ReminderCancelled(entities={...})</code> å–æ¶ˆç»™å®šå®ä½“çš„æ‰€æœ‰æé†’</li><li><code>ReminderCancelled("...")</code>å–æ¶ˆ<code>...</code>æ‚¨åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­æä¾›çš„å…·æœ‰ç»™å®šåç§°â€œ â€çš„å”¯ä¸€æé†’</li></ul><h3 id="å¤–éƒ¨äº‹ä»¶"><a href="#å¤–éƒ¨äº‹ä»¶" class="headerlink" title="å¤–éƒ¨äº‹ä»¶"></a>å¤–éƒ¨äº‹ä»¶</h3><p>å‡è®¾æ‚¨è¦ä»å…¶ä»–è®¾å¤‡å‘é€æ¶ˆæ¯ä»¥æ›´æ”¹æ­£åœ¨è¿›è¡Œçš„å¯¹è¯çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œè¿æ¥åˆ°Raspberry Piçš„ä¸€äº›æ¹¿åº¦ä¼ æ„Ÿå™¨åº”é€šçŸ¥æ‚¨çš„ç§äººåŠ©ç†æ‚¨æœ€å–œæ¬¢çš„æ¤ç‰©éœ€è¦æµ‡æ°´ï¼Œç„¶åæ‚¨çš„åŠ©ç†åº”å°†æ­¤æ¶ˆæ¯è½¬å‘ç»™æ‚¨ã€‚</p><p>ä¸ºæ­¤ï¼Œæ‚¨çš„Raspberry Piéœ€è¦å‘å¯¹è¯çš„<a href="#">trigger_intentç«¯ç‚¹</a>å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™å°†ç”¨æˆ·æ„å›¾ï¼ˆå¯èƒ½ä¸å®ä½“ï¼‰æ³¨å…¥åˆ°æ‚¨çš„å¯¹è¯ä¸­ã€‚å› æ­¤ï¼Œå¯¹äºRasaæ¥è¯´ï¼Œå‡ ä¹å°±åƒæ‚¨è¾“å…¥çš„æ¶ˆæ¯ä¸€æ ·ï¼Œæ ¹æ®æ­¤æ„å›¾å’Œè¿™äº›å®ä½“è¿›è¡Œäº†åˆ†ç±»ã€‚ç„¶åï¼ŒRasaéœ€è¦ä½¿ç”¨è¯¸å¦‚çš„æ“ä½œæ¥å“åº”æ­¤è¾“å…¥<code>action_warn_dry</code>ã€‚å°†æ­¤æ“ä½œä¸æ„å›¾è”ç³»èµ·æ¥çš„æœ€ç®€å•ï¼Œæœ€å¯é çš„æ–¹æ³•æ˜¯é€šè¿‡â€œ<a href="#">æ˜ å°„ç­–ç•¥â€</a>ã€‚</p><h3 id="è·å–ä¼šè¯"><a href="#è·å–ä¼šè¯" class="headerlink" title="è·å–ä¼šè¯"></a>è·å–ä¼šè¯</h3><p>æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¼ æ„Ÿå™¨åº”å‘å…¶å‘é€é€šçŸ¥çš„ä¼šè¯çš„ä¼šè¯IDã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰åŠ¨ä½œï¼ˆè¯·å‚é˜…<a href="#">Custom Actions</a>ï¼‰ï¼Œè¯¥<a href="#">åŠ¨ä½œ</a>åœ¨å¯¹è¯ä¸­æ˜¾ç¤ºIDã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionTellID</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Informs the user about the conversation ID."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"action_tell_id"</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        conversation_id <span class="token operator">=</span> tracker<span class="token punctuation">.</span>sender_id        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>            f<span class="token string">"The ID of this conversation is: "</span> f<span class="token string">"&amp;#123;conversation_id&amp;#125;."</span>        <span class="token punctuation">)</span>        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>            f<span class="token string">"Trigger an intent with "</span>            f<span class="token string">'curl -H "Content-Type: application/json" '</span>            f<span class="token string">'-X POST -d \'&amp;#123;&amp;#123;"name": "EXTERNAL_dry_plant", '</span>            f'<span class="token string">"entities"</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#123;"plant": "Orchid"&amp;#125;&amp;#125;&amp;#125;&amp;#125;\' '</span>            f<span class="token string">"http://localhost:5005/conversations/&amp;#123;conversation_id&amp;#125;/"</span>            f<span class="token string">"trigger_intent"</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å£°æ˜ä¸€ä¸ªintent <code>ask_id</code>ï¼Œä¸ºå…¶å®šä¹‰ä¸€äº›NLUæ•°æ®ï¼Œå¹¶å°†ä¸¤è€…<code>action_tell_id</code>å’Œ æ·»åŠ <code>ask_id</code>åˆ°åŸŸæ–‡ä»¶ä¸­ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªåº”è§¦å‘å¦ä¸€ä¸ªï¼š</p><pre class=" language-markdown"><code class="language-markdown">intents:  <span class="token list punctuation">-</span> ask_id:<span class="token code keyword">    triggers: action_tell_id</span></code></pre><p>ç°åœ¨ï¼Œå½“æ‚¨è¯¢é—®â€œæ­¤å¯¹è¯çš„IDæ˜¯ä»€ä¹ˆï¼Ÿâ€æ—¶ï¼ŒåŠ©æ‰‹å°†å›ç­”â€œè¯¥å¯¹è¯çš„IDä¸ºï¼š38cc25d7e23e4dde800353751b7c2d3eâ€ã€‚</p><p>å¦‚æœæ‚¨å¸Œæœ›åŠ©æ‰‹è‡ªåŠ¨é“¾æ¥åˆ°Raspberry Piï¼Œåˆ™å¿…é¡»ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œï¼Œä»¥åœ¨å¯¹è¯å¼€å§‹æ—¶é€šçŸ¥Piæœ‰å…³å¯¹è¯çš„IDï¼ˆè¯·å‚é˜…<a href="#">è‡ªå®šä¹‰ä¼šè¯å¼€å§‹æ“ä½œ</a>ï¼‰ã€‚</p><h3 id="å“åº”å¤–éƒ¨äº‹ä»¶"><a href="#å“åº”å¤–éƒ¨äº‹ä»¶" class="headerlink" title="å“åº”å¤–éƒ¨äº‹ä»¶"></a>å“åº”å¤–éƒ¨äº‹ä»¶</h3><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¼šè¯IDï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡åŠ©æ‰‹ï¼Œä»¥ä¾¿åŠ©æ‰‹å“åº”æ¥è‡ªä¼ æ„Ÿå™¨çš„æ¶ˆæ¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>EXTERNAL_dry_plant</code>æ²¡æœ‰ä»»ä½•NLUæ•°æ®çš„æ–°æ„å›¾ã€‚æ­¤æ„å›¾ç¨åå°†ç”±å¤–éƒ¨ä¼ æ„Ÿå™¨è§¦å‘ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥æ„å›¾åç§°å¼€å¤´ï¼Œ<code>EXTERNAL_</code>ä»¥è¡¨æ˜è¿™ä¸æ˜¯ç”¨æˆ·è¦è¯´çš„ï¼Œä½†æ˜¯æ‚¨å¯ä»¥éšæ„å‘½åè¯¥æ„å›¾ã€‚</p><p>åœ¨åŸŸæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å°†æ„å›¾<code>EXTERNAL_dry_plant</code>ä¸å¦ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œ<code>action_warn_dry</code>ï¼ˆä¾‹å¦‚ï¼Œ</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionWarnDry</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Informs the user that a plant needs water."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"action_warn_dry"</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        plant <span class="token operator">=</span> next<span class="token punctuation">(</span>tracker<span class="token punctuation">.</span>get_latest_entity_values<span class="token punctuation">(</span><span class="token string">"plant"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"someone"</span><span class="token punctuation">)</span>        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Your &amp;#123;plant&amp;#125; needs some water!"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>ç°åœ¨ï¼Œå½“æ‚¨ä¸idè¿›è¡Œå¯¹è¯æ—¶<code>38cc25d7e23e4dde800353751b7c2d3e</code>ï¼Œç„¶åè¿è¡Œ</p><pre class=" language-shell"><code class="language-shell">curl -H "Content-Type: application/json" -X POST -d '&#123;"name": "EXTERNAL_dry_plant", "entities": &#123;"plant": "Orchid"&#125;&#125;' http://localhost:5005/conversations/38cc25d7e23e4dde800353751b7c2d3e/trigger_intent</code></pre><p>åœ¨ç»ˆç«¯ä¸Šï¼Œæ‚¨çš„åŠ©æ‰‹ä¼šè¯´ï¼šâ€œæ‚¨çš„å…°èŠ±éœ€è¦ä¸€äº›æ°´ï¼â€ã€‚</p><h2 id="Policies"><a href="#Policies" class="headerlink" title="Policies"></a>Policies</h2><ul><li><a href="#">é…ç½®ç­–ç•¥</a><ul><li><a href="%EF%BC%83">æœ€å¤§å†å²</a></li><li><a href="#">æ•°æ®æ‰©å……</a></li></ul></li><li><a href="#">åŠ¨ä½œé€‰æ‹©</a></li><li><a href="#">å‡¯æ‹‰æ–¯æ”¿ç­–</a></li><li><a href="#">è¯å‘é‡ç­–ç•¥</a></li><li><a href="#">TEDç­–ç•¥</a></li><li><a href="#">æ˜ å°„ç­–ç•¥</a></li><li><a href="#">è®°å¿†ç­–ç•¥</a></li><li><a href="#">å¢å¼ºè®°å¿†ç­–ç•¥</a></li><li><a href="#">å›é€€ç­–ç•¥</a></li><li><a href="#">ä¸¤é˜¶æ®µå›é€€ç­–ç•¥</a></li><li><a href="#">è¡¨æ ¼ç­–ç•¥</a></li></ul><h3 id="é…ç½®ç­–ç•¥"><a href="#é…ç½®ç­–ç•¥" class="headerlink" title="é…ç½®ç­–ç•¥"></a>é…ç½®ç­–ç•¥</h3><p>è¯¥<code>rasa.core.policies.Policy</code>ç­å†³å®šé‡‡å–åœ¨è°ˆè¯çš„æ¯ä¸€æ­¥ä½•ç§è¡ŒåŠ¨ã€‚</p><p>æœ‰å¤šç§ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªä¸­åŒ…å«å¤šä¸ªç­–ç•¥<a href="https://legacy-docs-v1.rasa.com/api/agent/#rasa.core.agent.Agent"><code>rasa.core.agent.Agent</code></a>ã€‚</p><blockquote><p>æ³¨æ„</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»£ç†åœ¨æ¯æ¡ç”¨æˆ·æ¶ˆæ¯ä¹‹åæœ€å¤šå¯ä»¥é¢„æµ‹10ä¸ªä¸‹ä¸€æ­¥æ“ä½œã€‚è¦æ›´æ–°æ­¤å€¼ï¼Œå¯ä»¥å°†ç¯å¢ƒå˜é‡<code>MAX_NUMBER_OF_PREDICTIONS</code> è®¾ç½®ä¸ºæ‰€éœ€çš„æœ€å¤§é¢„æµ‹æ•°ã€‚</p></blockquote><p>é¡¹ç›®çš„<code>config.yml</code>æ–‡ä»¶å¸¦æœ‰ä¸€ä¸ª<code>policies</code>å¯†é’¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å¯†é’¥æ¥è‡ªå®šä¹‰åŠ©æ‰‹ä½¿ç”¨çš„ç­–ç•¥ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæœ€åä¸¤è¡Œæ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥ç±»å¹¶å°†å‚æ•°ä¼ é€’ç»™å®ƒã€‚</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: "KerasPolicy"<span class="token code keyword">    featurizer:</span><span class="token code keyword">    - name: MaxHistoryTrackerFeaturizer</span><span class="token code keyword">      max_history: 5</span><span class="token code keyword">      state_featurizer:</span><span class="token code keyword">        - name: BinarySingleStateFeaturizer</span>  <span class="token list punctuation">-</span> name: "MemoizationPolicy"<span class="token code keyword">    max_history: 5</span>  <span class="token list punctuation">-</span> name: "FallbackPolicy"<span class="token code keyword">    nlu_threshold: 0.4</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_action_name: "my_fallback_action"</span>  <span class="token list punctuation">-</span> name: "path.to.your.policy.class"<span class="token code keyword">    arg1: "..."</span></code></pre><h4 id="æœ€å¤§å†å²"><a href="#æœ€å¤§å†å²" class="headerlink" title="æœ€å¤§å†å²"></a>æœ€å¤§å†å²</h4><p>Rasaæ ¸å¿ƒç­–ç•¥çš„ä¸€ä¸ªé‡è¦è¶…å‚æ•°æ˜¯<code>max_history</code>ã€‚è¿™å¯æ§åˆ¶æ¨¡å‹æŸ¥çœ‹å¤šå°‘å¯¹è¯å†å²è®°å½•ï¼Œä»¥å†³å®šä¸‹ä¸€æ­¥åº”é‡‡å–çš„è¡ŒåŠ¨ã€‚</p><p>æ‚¨å¯ä»¥<code>max_history</code>é€šè¿‡å°†å…¶ä¼ é€’åˆ°<code>Featurizer</code> ç­–ç•¥é…ç½®yamlæ–‡ä»¶ä¸­çš„ç­–ç•¥æ¥è¿›è¡Œè®¾ç½®ã€‚</p><blockquote><p>æ³¨æ„</p><p>ä»…ä¼š<code>MaxHistoryTrackerFeaturizer</code>ä½¿ç”¨æœ€é•¿å†å²è®°å½•ï¼Œè€Œ<code>FullDialogueTrackerFeaturizer</code>æ€»æ˜¯ä¼šæŸ¥çœ‹å®Œæ•´çš„å¯¹è¯å†å²è®°å½•ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">ä¼šè¯</a>åŠŸèƒ½åŒ–ã€‚</p></blockquote><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ª<code>out_of_scope</code>æè¿°ç¦»é¢˜ç”¨æˆ·æ¶ˆæ¯çš„æ„å›¾ã€‚å¦‚æœæ‚¨çš„æœºå™¨äººè¿ç»­å¤šæ¬¡çœ‹åˆ°æ­¤æ„å›¾ï¼Œåˆ™å¯èƒ½è¦å‘Šè¯‰ç”¨æˆ·æ‚¨å¯ä»¥æä¾›å“ªäº›å¸®åŠ©ã€‚å› æ­¤æ‚¨çš„æ•…äº‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope   <span class="token list punctuation">-</span> utter_default<span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope   <span class="token list punctuation">-</span> utter_default<span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>help<span class="token punctuation">_</span></span>message</code></pre><p>ä¸ºäº†ä½¿Rasa Coreå­¦ä¹ è¿™ç§æ¨¡å¼ï¼Œ<code>max_history</code> å¿…é¡»è‡³å°‘ä¸º4ã€‚</p><p>å¦‚æœå¢åŠ <code>max_history</code>ï¼Œæ‚¨çš„æ¨¡å‹å°†å˜å¾—æ›´å¤§ï¼Œå¹¶ä¸”è®­ç»ƒå°†èŠ±è´¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœæ‚¨æŒæ¡ä¸€äº›å°†æ¥å¯èƒ½ä¼šå½±å“å¯¹è¯çš„ä¿¡æ¯ï¼Œåˆ™åº”å°†å…¶å­˜å‚¨ä¸ºæ’æ§½ã€‚æ’æ§½ä¿¡æ¯å§‹ç»ˆå¯ç”¨äºæ¯ä¸ªåŠŸèƒ½å—ã€‚</p><h4 id="æ•°æ®æ‰©å……"><a href="#æ•°æ®æ‰©å……" class="headerlink" title="æ•°æ®æ‰©å……"></a>æ•°æ®æ‰©å……</h4><p>è®­ç»ƒæ¨¡å‹æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒRasa Coreå°†é€šè¿‡éšæœºå°†æ•…äº‹æ–‡ä»¶ä¸­çš„æ•…äº‹ç²˜åˆåœ¨ä¸€èµ·æ¥åˆ›å»ºæ›´é•¿çš„æ•…äº‹ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ‚¨æœ‰ä»¥ä¸‹æ•…äº‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> thanks</span><span class="token list punctuation">*</span> thankyou   <span class="token list punctuation">-</span> utter_youarewelcome<span class="token title important"><span class="token punctuation">#</span> bye</span><span class="token list punctuation">*</span> goodbye   <span class="token list punctuation">-</span> utter_goodbye</code></pre><p>å®é™…ä¸Šï¼Œæ‚¨å®é™…ä¸Šæƒ³æ•™è‡ªå·±çš„ç­–ç•¥åœ¨ä¸ç›¸å…³æ—¶<strong>å¿½ç•¥</strong>å¯¹è¯å†å²è®°å½•ï¼Œè€Œæ— è®ºä»¥å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Œéƒ½åªéœ€ä»¥ç›¸åŒçš„åŠ¨ä½œè¿›è¡Œå“åº”å³å¯ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>--augmentation</code>æ ‡å¿—æ›´æ”¹æ­¤è¡Œä¸ºã€‚å…è®¸æ‚¨è®¾ç½®<code>augmentation_factor</code>ã€‚è¯¥<code>augmentation_factor</code>å†³å®šè®¸å¤šå¢å¼ºçš„æ•…äº‹æ˜¯å¦‚ä½•è®­ç»ƒä¸­çš„å­é‡‡æ ·ã€‚æ‰©å¢åçš„æ•…äº‹åœ¨è®­ç»ƒä¹‹å‰ä¼šè¿›è¡ŒäºŒæ¬¡æŠ½æ ·ï¼Œå› ä¸ºå®ƒä»¬çš„æ•°é‡ä¼šå¾ˆå¿«å˜å¾—éå¸¸å¤§ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹å…¶è¿›è¡Œé™åˆ¶ã€‚æ ·æœ¬æ•…äº‹çš„æ•°é‡æ˜¯<code>augmentation_factor</code>x10ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰©å……è®¾ç½®ä¸º20ï¼Œæœ€å¤šå¯ç”Ÿæˆ200ä¸ªæ‰©å……æ•…äº‹ã€‚</p><p><code>--augmentation 0</code>ç¦ç”¨æ‰€æœ‰å¢å¼ºè¡Œä¸ºã€‚åŸºäºå¤‡å¿˜å½•çš„ç­–ç•¥ä¸å—æ‰©å……çš„å½±å“ï¼ˆä¸æ— å…³<code>augmentation_factor</code>ï¼‰ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¿½ç•¥æ‰€æœ‰æ‰©å……çš„æ•…äº‹ã€‚</p><h3 id="è¡ŒåŠ¨é€‰æ‹©"><a href="#è¡ŒåŠ¨é€‰æ‹©" class="headerlink" title="è¡ŒåŠ¨é€‰æ‹©"></a>è¡ŒåŠ¨é€‰æ‹©</h3><p>åœ¨ä»»ä½•æ—¶å€™ï¼Œé…ç½®ä¸­å®šä¹‰çš„æ¯ä¸ªç­–ç•¥éƒ½ä¼šä»¥ä¸€å®šçš„ç½®ä¿¡åº¦é¢„æµ‹ä¸‹ä¸€ä¸ªåŠ¨ä½œã€‚æœ‰å…³æ¯ä¸ªç­–ç•¥å¦‚ä½•åšå‡ºå†³ç­–çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ä¸‹é¢çš„ç­–ç•¥è¯´æ˜ã€‚ç„¶åï¼Œæœºå™¨äººçš„ä¸‹ä¸€ä¸ªåŠ¨ä½œç”±å…·æœ‰æœ€é«˜ç½®ä¿¡åº¦çš„é¢„æµ‹ç­–ç•¥å†³å®šã€‚</p><p>åœ¨ä¸¤ä¸ªç­–ç•¥ä»¥ç›¸åŒçš„ç½®ä¿¡åº¦è¿›è¡Œé¢„æµ‹çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œâ€œå¤‡å¿˜å’Œæ˜ å°„ç­–ç•¥â€å§‹ç»ˆä»¥0æˆ–1çš„ç½®ä¿¡åº¦è¿›è¡Œé¢„æµ‹ï¼‰ï¼Œå°†è€ƒè™‘ç­–ç•¥çš„ä¼˜å…ˆçº§ã€‚Rasaç­–ç•¥å…·æœ‰é»˜è®¤ä¼˜å…ˆçº§ï¼Œè¿™äº›é»˜è®¤ä¼˜å…ˆçº§è¢«è®¾ç½®ä¸ºç¡®ä¿å¹³å±€æ—¶çš„é¢„æœŸç»“æœã€‚å®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·ï¼Œæ•°å­—è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜ï¼š</p><p>5ï¼Œ <code>FormPolicy</code></p><p>4.<code>FallbackPolicy</code>å’Œ<code>TwoStageFallbackPolicy</code></p><p>3.<code>MemoizationPolicy</code>å’Œ<code>AugmentedMemoizationPolicy</code></p><p>2ã€‚ <code>MappingPolicy</code></p><p>1.<code>TEDPolicy</code>ï¼Œ<code>EmbeddingPolicy</code>ï¼Œ<code>KerasPolicy</code>ï¼Œå’Œ<code>SklearnPolicy</code></p><p>æ­¤ä¼˜å…ˆçº§å±‚æ¬¡ç»“æ„å¯ç¡®ä¿ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæœ‰æ„å›¾ä¸æ˜ å°„çš„åŠ¨ä½œï¼Œä½†NLUç½®ä¿¡åº¦ä¸åœ¨ä¹‹ä¸Š<code>nlu_threshold</code>ï¼Œåˆ™è¯¥æ¼«æ¸¸å™¨ä»å°†å›é€€ã€‚é€šå¸¸ï¼Œä¸å»ºè®®æ¯ä¸ªä¼˜å…ˆçº§ä½¿ç”¨ä¸€ä¸ªä»¥ä¸Šçš„ç­–ç•¥ï¼Œå¹¶ä¸”æŸäº›ä¼˜å…ˆçº§ç›¸åŒçš„ç­–ç•¥ï¼ˆä¾‹å¦‚ä¸¤ä¸ªåå¤‡ç­–ç•¥ï¼‰ä¸¥æ ¼ä¸èƒ½ä¸€å¹¶ä½¿ç”¨ã€‚</p><p>å¦‚æœæ‚¨åˆ›å»ºè‡ªå·±çš„ç­–ç•¥ï¼Œè¯·ä½¿ç”¨è¿™äº›ä¼˜å…ˆçº§ä½œä¸ºç¡®å®šç­–ç•¥ä¼˜å…ˆçº§çš„æŒ‡å—ã€‚å¦‚æœæ‚¨çš„ç­–ç•¥æ˜¯æœºå™¨å­¦ä¹ ç­–ç•¥ï¼Œåˆ™å®ƒå¾ˆå¯èƒ½åº”è¯¥å…·æœ‰ä¼˜å…ˆçº§1ï¼Œä¸Rasaæœºå™¨å­¦ä¹ ç­–ç•¥ç›¸åŒã€‚</p><blockquote><p>è­¦å‘Š</p><p>æ‰€æœ‰ç­–ç•¥ä¼˜å…ˆçº§éƒ½å¯ä»¥é€šè¿‡é…ç½®ä¸­çš„<code>priority:</code>å‚æ•°è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬<strong>ä¸å»ºè®®</strong>åœ¨ç‰¹å®šæƒ…å†µï¼ˆä¾‹å¦‚è‡ªå®šä¹‰ç­–ç•¥ï¼‰ä¹‹å¤–æ›´æ”¹å®ƒä»¬ã€‚è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„æœºå™¨äººè¡Œä¸ºã€‚</p></blockquote><h3 id="Kerasæ”¿ç­–"><a href="#Kerasæ”¿ç­–" class="headerlink" title="Kerasæ”¿ç­–"></a>Kerasæ”¿ç­–</h3><p>åœ¨<code>KerasPolicy</code>ä½¿ç”¨ä¸­å®ç°çš„ç¥ç»ç½‘ç»œ <a href="http://keras.io/">Keras</a>é€‰æ‹©ä¸‹ä¸€ä¸ªåŠ¨ä½œã€‚é»˜è®¤ä½“ç³»ç»“æ„åŸºäºLSTMï¼Œä½†æ˜¯æ‚¨å¯ä»¥è¦†ç›–è¯¥ <code>KerasPolicy.model_architecture</code>æ–¹æ³•ä»¥å®ç°è‡ªå·±çš„ä½“ç³»ç»“æ„ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">model_architecture</span><span class="token punctuation">(</span>    self<span class="token punctuation">,</span> input_shape<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">,</span> output_shape<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> Optional<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>Sequential<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Build a keras model and return a compiled model."""</span>    <span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential    <span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> <span class="token punctuation">(</span>        Masking<span class="token punctuation">,</span>        LSTM<span class="token punctuation">,</span>        Dense<span class="token punctuation">,</span>        TimeDistributed<span class="token punctuation">,</span>        Activation<span class="token punctuation">,</span>    <span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Build Model</span>    model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># the shape of the y vector of the labels,</span>    <span class="token comment" spellcheck="true"># determines which output from rnn will be used</span>    <span class="token comment" spellcheck="true"># to calculate the loss</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># y is (num examples, num features) so</span>        <span class="token comment" spellcheck="true"># only the last output from the rnn is used to</span>        <span class="token comment" spellcheck="true"># calculate the loss</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Masking<span class="token punctuation">(</span>mask_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span>input_shape<span class="token punctuation">)</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> units<span class="token operator">=</span>output_shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># y is (num examples, max_dialogue_len, num features) so</span>        <span class="token comment" spellcheck="true"># all the outputs from the rnn are used to</span>        <span class="token comment" spellcheck="true"># calculate the loss, therefore a sequence is returned and</span>        <span class="token comment" spellcheck="true"># time distributed layer is used</span>        <span class="token comment" spellcheck="true"># the first value in input_shape is max dialogue_len,</span>        <span class="token comment" spellcheck="true"># it is set to None, to allow dynamic_rnn creation</span>        <span class="token comment" spellcheck="true"># during prediction</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Masking<span class="token punctuation">(</span>mask_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span> input_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> return_sequences<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>TimeDistributed<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span>units<span class="token operator">=</span>output_shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>            <span class="token string">"Cannot construct the model because"</span>            <span class="token string">"length of output_shape = &amp;#123;&amp;#125; "</span>            <span class="token string">"should be 1 or 2."</span>            <span class="token string">""</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Activation<span class="token punctuation">(</span><span class="token string">"softmax"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    model<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>        loss<span class="token operator">=</span><span class="token string">"categorical_crossentropy"</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span><span class="token string">"rmsprop"</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"accuracy"</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span>    <span class="token keyword">if</span> common_utils<span class="token punctuation">.</span>obtain_verbosity<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> model</code></pre><p>è®­ç»ƒåœ¨è¿™é‡Œè¿›è¡Œï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>    self<span class="token punctuation">,</span>    training_trackers<span class="token punctuation">:</span> List<span class="token punctuation">[</span>DialogueStateTracker<span class="token punctuation">]</span><span class="token punctuation">,</span>    domain<span class="token punctuation">:</span> Domain<span class="token punctuation">,</span>    <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>self<span class="token punctuation">.</span>random_seed<span class="token punctuation">)</span>    tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>set_seed<span class="token punctuation">(</span>self<span class="token punctuation">.</span>random_seed<span class="token punctuation">)</span>    training_data <span class="token operator">=</span> self<span class="token punctuation">.</span>featurize_for_training<span class="token punctuation">(</span>training_trackers<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># noinspection PyPep8Naming</span>    shuffled_X<span class="token punctuation">,</span> shuffled_y <span class="token operator">=</span> training_data<span class="token punctuation">.</span>shuffled_X_y<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>model <span class="token keyword">is</span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>model <span class="token operator">=</span> self<span class="token punctuation">.</span>model_architecture<span class="token punctuation">(</span>            shuffled_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shuffled_y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span>    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>        f<span class="token string">"Fitting model with &amp;#123;training_data.num_examples()&amp;#125; total samples and a "</span>        f<span class="token string">"validation split of &amp;#123;self.validation_split&amp;#125;."</span>    <span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># filter out kwargs that cannot be passed to fit</span>    self<span class="token punctuation">.</span>_train_params <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_valid_params<span class="token punctuation">(</span>        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_train_params    <span class="token punctuation">)</span>    self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>        shuffled_X<span class="token punctuation">,</span>        shuffled_y<span class="token punctuation">,</span>        epochs<span class="token operator">=</span>self<span class="token punctuation">.</span>epochs<span class="token punctuation">,</span>        batch_size<span class="token operator">=</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>        shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>        verbose<span class="token operator">=</span>common_utils<span class="token punctuation">.</span>obtain_verbosity<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">**</span>self<span class="token punctuation">.</span>_train_params<span class="token punctuation">,</span>    <span class="token punctuation">)</span>    self<span class="token punctuation">.</span>current_epoch <span class="token operator">=</span> self<span class="token punctuation">.</span>epochs    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"Done fitting Keras Policy model."</span><span class="token punctuation">)</span></code></pre><p>æ‚¨å¯ä»¥é€šè¿‡è¦†ç›–è¿™äº›æ–¹æ³•æ¥å®ç°æ‚¨é€‰æ‹©çš„æ¨¡å‹ï¼Œæˆ–è€…<code>KerasPolicy</code>ä½¿ç”¨pre-definedè¿›è¡Œåˆå§‹åŒ–ã€‚<code>keras model</code></p><p>ä¸ºäº†è·å¾—ç›¸åŒè¾“å…¥çš„å¯é‡å¤è®­ç»ƒç»“æœï¼Œæ‚¨å¯ä»¥å°†çš„<code>random_seed</code>å±æ€§è®¾ç½®<code>KerasPolicy</code>ä¸ºä»»ä½•æ•´æ•°ã€‚</p><h3 id="åµŒå…¥ç­–ç•¥"><a href="#åµŒå…¥ç­–ç•¥" class="headerlink" title="åµŒå…¥ç­–ç•¥"></a>åµŒå…¥ç­–ç•¥</h3><blockquote><p>è­¦å‘Š</p><p><code>EmbeddingPolicy</code>å·²é‡å‘½åä¸º<code>TEDPolicy</code>ã€‚è¯·ä½¿ç”¨<a href="#">TEDç­–ç•¥ï¼Œ</a>è€Œä¸è¦<code>EmbeddingPolicy</code> åœ¨ç­–ç•¥é…ç½®ä¸­ä½¿ç”¨ã€‚è¯¥ç­–ç•¥çš„åŠŸèƒ½ä¿æŒä¸å˜ã€‚</p></blockquote><h3 id="TEDç­–ç•¥"><a href="#TEDç­–ç•¥" class="headerlink" title="TEDç­–ç•¥"></a>TEDç­–ç•¥</h3><p>è¯¥å˜å‹å™¨åµŒå…¥å¯¹è¯ï¼ˆTEDï¼‰çš„æ”¿ç­–æ˜¯åœ¨æè¿° <a href="https://arxiv.org/abs/1910.00486">æˆ‘ä»¬çš„è®ºæ–‡</a>ã€‚</p><p>è¯¥ç­–ç•¥å…·æœ‰é¢„å®šä¹‰çš„ä½“ç³»ç»“æ„ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><blockquote><ul><li>å°†æ¯ä¸ªæ—¶é—´æ­¥éª¤çš„ç”¨æˆ·è¾“å…¥ï¼ˆç”¨æˆ·æ„å›¾å’Œå®ä½“ï¼‰ï¼Œå…ˆå‰çš„ç³»ç»ŸåŠ¨ä½œï¼Œæ—¶éš™å’Œæ´»åŠ¨å½¢å¼è¿æ¥åˆ°è¾“å…¥å‘é‡ä¸­ï¼Œä»¥ä¼ é€’ç»™é¢„å˜å‹å™¨åµŒå…¥å±‚ï¼›</li><li>é¦ˆå…¥å˜å‹å™¨ï¼›</li><li>åœ¨å˜å‹å™¨çš„è¾“å‡ºä¸Šæ–½åŠ ä¸€ä¸ªå¯†é›†å±‚ï¼Œä»¥ä¾¿åœ¨æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸­åµŒå…¥å¯¹è¯ï¼›</li><li>åœ¨æ¯ä¸ªæ—¶é—´æ­¥éª¤åº”ç”¨å¯†é›†å±‚ä¸ºç³»ç»Ÿæ“ä½œåˆ›å»ºåµŒå…¥ï¼›</li><li>è®¡ç®—å¯¹è¯åµŒå…¥å’ŒåµŒå…¥å¼ç³»ç»ŸåŠ¨ä½œä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚æ­¤æ­¥éª¤åŸºäº<a href="https://arxiv.org/abs/1709.03856">StarSpaceçš„</a>æƒ³æ³•ã€‚</li></ul></blockquote><p>å»ºè®®ä½¿ç”¨<code>state_featurizer=LabelTokenizerSingleStateFeaturizer(...)</code> ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">å¯¹è¯</a>åŠŸèƒ½ï¼‰ã€‚</p><p><strong>ç»„æ€ï¼š</strong></p><p>å¯ä»¥å°†é…ç½®å‚æ•°ä½œä¸ºå‚æ•°ä¼ é€’åˆ°<code>TEDPolicy</code>é…ç½®æ–‡ä»¶ä¸­ã€‚å¦‚æœè¦è°ƒæ•´æ¨¡å‹ï¼Œè¯·é¦–å…ˆä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><code>epochs</code>ï¼šæ­¤å‚æ•°è®¾ç½®ç®—æ³•æŸ¥çœ‹è®­ç»ƒæ•°æ®çš„æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>1</code>ã€‚ä¸€ä¸ª<code>epoch</code>æ˜¯ç­‰äºä¸€ä¸ªç›´ä¼ å’Œæ‰€æœ‰çš„è®­ç»ƒä¾‹å­ä¹‹ä¸€å‘é€šè¡Œã€‚æœ‰æ—¶ï¼Œæ¨¡å‹éœ€è¦æ›´å¤šçš„æ—¶æœŸæ‰èƒ½æ­£ç¡®å­¦ä¹ ã€‚æœ‰æ—¶æ›´å¤šçš„æ—¶æœŸä¸ä¼šå½±å“æ€§èƒ½ã€‚æ—¶æœŸæ•°è¶Šå°‘ï¼Œæ¨¡å‹è®­ç»ƒè¶Šå¿«ã€‚</li><li><code>hidden_layers_sizes</code>ï¼šæ­¤å‚æ•°å…è®¸æ‚¨å®šä¹‰å¯¹è¯å’Œæ„å›¾çš„å‰é¦ˆå±‚æ•°åŠå…¶è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¯¹åº”ä¸€ä¸ªå‰é¦ˆå±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ï¼Œæˆ‘ä»¬å°†åœ¨å˜å‹å™¨å‰é¢æ·»åŠ ä¸¤ä¸ªå‰é¦ˆå±‚ã€‚è¾“å…¥ä»¤ç‰Œçš„çŸ¢é‡ï¼ˆæ¥è‡ªå¯¹è¯ï¼‰å°†ä¼ é€’åˆ°è¿™äº›å±‚ã€‚ç¬¬ä¸€å±‚çš„è¾“å‡ºå°ºå¯¸ä¸º256ï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºå°ºå¯¸ä¸º128ã€‚å¦‚æœä½¿ç”¨ç©ºåˆ—è¡¨ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™ä¸ä¼šæ·»åŠ å‰é¦ˆå±‚ã€‚ç¡®ä¿ä»…ä½¿ç”¨æ­£æ•´æ•°ã€‚é€šå¸¸ï¼Œä½¿ç”¨2çš„å¹‚æ•°ã€‚åŒæ ·ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨åˆ—è¡¨ä¸­å‡å°å€¼ï¼šä¸‹ä¸€ä¸ªå€¼å°äºæˆ–ç­‰äºå‰ä¸€ä¸ªå€¼ã€‚<code>dialogue: [], label: []  dialogue: [256, 128]</code></li><li><code>number_of_transformer_layers</code>ï¼šæ­¤å‚æ•°è®¾ç½®è¦ä½¿ç”¨çš„å˜å‹å™¨å±‚æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>1</code>ã€‚å˜å‹å™¨å±‚çš„æ•°é‡ä¸è¦ç”¨äºæ¨¡å‹çš„å˜å‹å™¨å—ç›¸å¯¹åº”ã€‚</li><li><code>transformer_size</code>ï¼šæ­¤å‚æ•°è®¾ç½®å˜å‹å™¨ä¸­çš„å•ä½æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>128</code>ã€‚ä»å˜å‹å™¨å‡ºæ¥çš„çŸ¢é‡å°†å…·æœ‰ç»™å®šçš„<code>transformer_size</code>ã€‚</li><li><code>weight_sparsity</code>ï¼šæ­¤å‚æ•°å®šä¹‰äº†æ¨¡å‹ä¸­æ‰€æœ‰å‰é¦ˆå±‚çš„å†…æ ¸æƒé‡çš„åˆ†æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º0ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0.8</code>ã€‚è¯¥å€¼åº”ä»‹äº0å’Œ1ä¹‹é—´ã€‚å¦‚æœè®¾ç½®<code>weight_sparsity</code> ä¸º0ï¼Œåˆ™æ²¡æœ‰å†…æ ¸æƒé‡å°†è®¾ç½®ä¸º0ï¼Œè¯¥å±‚å°†å……å½“æ ‡å‡†å‰é¦ˆå±‚ã€‚æ‚¨ä¸åº”å°†å…¶è®¾ç½®<code>weight_sparsity</code>ä¸º1ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´æ‰€æœ‰å†…æ ¸æƒé‡å‡ä¸º0ï¼Œå³æ¨¡å‹æ— æ³•å­¦ä¹ ã€‚</li></ul><blockquote><p>è­¦å‘Š</p><p>å°†é€‚å½“çš„æ•°å­—ï¼ˆä¾‹å¦‚50ï¼‰<code>epochs</code>ä¼ é€’ç»™<code>TEDPolicy</code>ï¼Œå¦åˆ™è¯¥ç­–ç•¥å°†ä»…é’ˆå¯¹<code>1</code>æ—¶ä»£è¿›è¡Œè®­ç»ƒã€‚</p></blockquote><blockquote><p>è­¦å‘Š</p><p><code>max_history</code>æ­¤æ”¿ç­–çš„é»˜è®¤è®¾ç½®ä¸º<code>None</code>ï¼Œå®ƒå°†ä½¿ç”¨ <code>FullDialogueTrackerFeaturizer</code>ã€‚æˆ‘ä»¬å»ºè®®å°†<code>max_history</code>å€¼è®¾ç½®ä¸ºä¸€å®šçš„å€¼ï¼Œä»¥ä¾¿<code>MaxHistoryTrackerFeaturizer</code>ç”¨äº<strong>æ›´å¿«çš„è®­ç»ƒ</strong>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">ä¼šè¯</a>åŠŸèƒ½åŒ–ã€‚æˆ‘ä»¬å»ºè®®å¢åŠ <code>batch_size</code>çš„<code>MaxHistoryTrackerFeaturizer</code> ï¼ˆä¾‹å¦‚ï¼‰`â€batch_sizeâ€: [32, 64]</p></blockquote><p>ä¸Šé¢çš„é…ç½®å‚æ•°æ˜¯æ‚¨åº”è¯¥é…ç½®çš„å‚æ•°ï¼Œä»¥ä½¿æ¨¡å‹é€‚åˆæ•°æ®ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨å¯ä»¥è°ƒæ•´çš„å…¶ä»–å‚æ•°ã€‚</p><h3 id="æ˜ å°„ç­–ç•¥"><a href="#æ˜ å°„ç­–ç•¥" class="headerlink" title="æ˜ å°„ç­–ç•¥"></a>æ˜ å°„ç­–ç•¥</h3><p>è¯¥<code>MappingPolicy</code>å¯ç”¨äºç›´æ¥æ˜ å°„åˆ°æ„å›¾åŠ¨ä½œã€‚é€šè¿‡ç»™æ„å›¾èµ‹äºˆå±æ€§æ¥åˆ†é…æ˜ å°„<code>triggers</code>ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">intents: <span class="token list punctuation">-</span> ask<span class="token italic"><span class="token punctuation">_</span>is<span class="token punctuation">_</span></span>bot:<span class="token code keyword">     triggers: action_is_bot</span></code></pre><p>ä¸€ä¸ªæ„å›¾æœ€å¤šåªèƒ½æ˜ å°„åˆ°ä¸€ä¸ªåŠ¨ä½œã€‚ä¸€æ—¦æœºå™¨äººæ”¶åˆ°è§¦å‘æ„å›¾çš„æ¶ˆæ¯ï¼Œå®ƒå°†è¿è¡Œæ˜ å°„çš„åŠ¨ä½œã€‚ä¹‹åï¼Œå®ƒå°†ç›‘å¬ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚éšç€ä¸‹ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ï¼Œå°†æ¢å¤æ­£å¸¸é¢„æµ‹ã€‚</p><p>å¦‚æœæ‚¨ä¸å¸Œæœ›æ„å›¾åŠ¨ä½œæ˜ å°„å½±å“å¯¹è¯å†å²è®°å½•ï¼Œåˆ™æ˜ å°„åŠ¨ä½œå¿…é¡»è¿”å›ä¸€ä¸ª<code>UserUtteranceReverted()</code> äº‹ä»¶ã€‚è¿™å°†ä»å¯¹è¯å†å²è®°å½•ä¸­åˆ é™¤ç”¨æˆ·çš„æœ€æ–°æ¶ˆæ¯åŠå…¶åå‘ç”Ÿçš„ä»»ä½•äº‹ä»¶ã€‚è¿™æ„å‘³ç€æ‚¨ä¸åº”åœ¨æ•…äº‹ä¸­åŒ…æ‹¬æ„å›¾-è¡ŒåŠ¨äº’åŠ¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·é—®â€œæ‚¨æ˜¯æœºå™¨äººå—ï¼Ÿâ€ åœ¨æµç¨‹ä¸­é—´åç¦»ä¸»é¢˜çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½æƒ³è¦å›ç­”è€Œä¸ä¼šå½±å“ä¸‹ä¸€åŠ¨ä½œé¢„æµ‹çš„äº¤äº’ä½œç”¨ã€‚è§¦å‘çš„è‡ªå®šä¹‰æ“ä½œå¯ä»¥æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä½†è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹è°ƒåº¦æœºå™¨äººçš„è¯è¯­ï¼Œç„¶åè¿˜åŸäº¤äº’ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionIsBot</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token triple-quoted-string string">"""Revertible mapped action for utter_is_bot"""</span><span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"action_is_bot"</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>    dispatcher<span class="token punctuation">.</span>utter_template<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_is_bot"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>UserUtteranceReverted<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨<code>MappingPolicy</code>ç›´æ¥ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼‰æ¥é¢„æµ‹æœºå™¨äººè¯´è¯çš„è¡Œä¸º ï¼Œåˆ™è¿™äº›äº¤äº’å¿…é¡»è¿›å…¥æ‚¨çš„æ•…äº‹ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰äº¤äº’ä½œç”¨ï¼Œå¹¶ä¸”æ„å›¾å’Œæ˜ å°„çš„å“åº”åŠ¨ä½œå°†å‡ºç°åœ¨å¯¹è¯å†å²è®°å½•ä¸­ã€‚<code>triggers: utter_{} UserUtteranceReverted()</code></p></blockquote><blockquote><p>æ³¨æ„</p><p>è¯¥MappingPolicyè¿˜è´Ÿè´£æ‰§è¡Œé»˜è®¤æ“ä½œ<code>action_back</code> å’Œ<code>action_restart</code>å“åº”<code>/back</code>å’Œ<code>/restart</code>ã€‚å¦‚æœæ‚¨çš„ç­–ç•¥ç¤ºä¾‹ä¸­æœªåŒ…å«æ­¤å†…å®¹ï¼Œåˆ™è¿™äº›æ„å›¾å°†æ— æ•ˆã€‚</p></blockquote><h3 id="è®°å¿†æ”¿ç­–"><a href="#è®°å¿†æ”¿ç­–" class="headerlink" title="è®°å¿†æ”¿ç­–"></a>è®°å¿†æ”¿ç­–</h3><p>åœ¨<code>MemoizationPolicy</code>åˆšåˆšè®°ä½åœ¨ä½ çš„è®­ç»ƒæ•°æ®çš„è°ˆè¯ã€‚å®ƒé¢„æµ‹æœ‰ä¿¡å¿ƒä¸‹ä¸€ä¸ªåŠ¨ä½œ<code>1.0</code> ï¼Œå¦‚æœåœ¨è®­ç»ƒæ•°æ®ä¸­å­˜åœ¨è¿™ä¸€ç¡®åˆ‡çš„è°ˆè¯ï¼Œå¦åˆ™é¢„æµ‹<code>None</code>å……æ»¡ä¿¡å¿ƒ<code>0.0</code>ã€‚</p><h3 id="å¢å¼ºè®°å¿†ç­–ç•¥"><a href="#å¢å¼ºè®°å¿†ç­–ç•¥" class="headerlink" title="å¢å¼ºè®°å¿†ç­–ç•¥"></a>å¢å¼ºè®°å¿†ç­–ç•¥</h3><p>è¯¥<code>AugmentedMemoizationPolicy</code>è®°å¾—ä»è®­ç»ƒçš„æ•…äº‹é•¿è¾¾ä¾‹å­<code>max_history</code>è½¬å¼¯ï¼Œå°±åƒ<code>MemoizationPolicy</code>ã€‚æ­¤å¤–ï¼Œå®ƒå…·æœ‰é—å¿˜æœºåˆ¶ï¼Œå¯ä»¥é—å¿˜å¯¹è¯å†å²è®°å½•ä¸­çš„æŸäº›æ­¥éª¤ï¼Œå¹¶å°è¯•åœ¨å†å²å‡å°‘çš„æ•…äº‹ä¸­æ‰¾åˆ°åŒ¹é…é¡¹ã€‚å®ƒé¢„æµ‹æœ‰ä¿¡å¿ƒä¸‹ä¸€ä¸ªåŠ¨ä½œ<code>1.0</code> ï¼Œå¦‚æœå‘ç°åŒ¹é…ï¼Œå¦åˆ™å°±é¢„æµ‹<code>None</code>æœ‰ä¿¡å¿ƒ<code>0.0</code>ã€‚</p><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨åœ¨å¯¹è¯ä¸­æ— æ³•åœ¨è®­ç»ƒæ•…äº‹ä¸­è®¾ç½®åœ¨é¢„æµ‹æ—¶é—´å†…è®¾ç½®çš„æŸäº›æ—¶æ®µï¼ˆä¾‹å¦‚ï¼Œåœ¨ä»¥æé†’å¼€å¤´çš„è®­ç»ƒæ•…äº‹ä¸­ï¼Œæœªè®¾ç½®æ‰€æœ‰å…ˆå‰çš„æ—¶æ®µï¼‰ï¼Œè¯·ç¡®ä¿å°†æ²¡æœ‰æ’æ§½çš„ç›¸å…³æ•…äº‹æ·»åŠ åˆ°è®­ç»ƒæ•°æ®ä¸­ä¹Ÿä¸€æ ·ã€‚</p></blockquote><h3 id="åå¤‡æ”¿ç­–"><a href="#åå¤‡æ”¿ç­–" class="headerlink" title="åå¤‡æ”¿ç­–"></a>åå¤‡æ”¿ç­–</h3><p>æ‰€è¿°<code>FallbackPolicy</code>Aè°ƒç”¨<a href="#">å›é€€æ“ä½œ</a>ï¼Œå¦‚æœå‘ç”Ÿä»¥ä¸‹æƒ…å†µä¸­çš„è‡³å°‘ä¸€ä¸ªï¼š</p><ol><li>æ„å›¾è¯†åˆ«åœ¨ä¸‹é¢æœ‰ä¿¡å¿ƒ<code>nlu_threshold</code>ã€‚</li><li>æ’åæœ€é«˜çš„æ„å›¾çš„ç½®ä¿¡åº¦ä¸æ’åç¬¬äºŒçš„æ„å›¾ç›¸å·®å°äº<code>ambiguity_threshold</code>ã€‚</li><li>æ²¡æœ‰ä¸€é¡¹å¯¹è¯æ”¿ç­–èƒ½å¤Ÿé¢„æµ‹é‡‡å–é«˜äºä¿¡å¿ƒçš„è¡ŒåŠ¨<code>core_threshold</code>ã€‚</li></ol><p><strong>ç»„æ€ï¼š</strong></p><p>é˜ˆå€¼å’Œå›é€€æ“ä½œå¯ä»¥åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­ä½œä¸ºä»¥ä¸‹å‚æ•°è¿›è¡Œè°ƒæ•´<code>FallbackPolicy</code>ï¼š</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: "FallbackPolicy"<span class="token code keyword">    nlu_threshold: 0.3</span><span class="token code keyword">    ambiguity_threshold: 0.1</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_action_name: 'action_default_fallback'</span></code></pre><table><thead><tr><th><code>nlu_threshold</code></th><th>æ¥å—NLUé¢„æµ‹æ‰€éœ€çš„æœ€ä½ç½®ä¿¡åº¦</th></tr></thead><tbody><tr><td><code>ambiguity_threshold</code></td><td>æœ€é«˜æ„å›¾çš„ç½®ä¿¡åº¦å¿…é¡»è¶…è¿‡ç¬¬äºŒé«˜æ„å›¾çš„ç½®ä¿¡åº¦çš„æœ€å°æ•°é‡ã€‚</td></tr><tr><td><code>core_threshold</code></td><td>æ¥å—Rasa Coreçš„åŠ¨ä½œé¢„æµ‹æ‰€éœ€çš„æœ€ä½ç½®ä¿¡åº¦</td></tr><tr><td><code>fallback_action_name</code></td><td>å¦‚æœæ„å›¾æˆ–æ“ä½œçš„ç½®ä¿¡åº¦ä½äºå„è‡ªçš„é˜ˆå€¼ï¼Œåˆ™è°ƒç”¨<a href="#">åå¤‡æ“ä½œçš„</a>åç§°</td></tr></tbody></table><p>æ‚¨è¿˜å¯ä»¥<code>FallbackPolicy</code>åœ¨pythonä»£ç ä¸­é…ç½®ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>fallback <span class="token keyword">import</span> FallbackPolicy<span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>keras_policy <span class="token keyword">import</span> KerasPolicy<span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>agent <span class="token keyword">import</span> Agentfallback <span class="token operator">=</span> FallbackPolicy<span class="token punctuation">(</span>fallback_action_name<span class="token operator">=</span><span class="token string">"action_default_fallback"</span><span class="token punctuation">,</span>                          core_threshold<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>                          nlu_threshold<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>                          ambiguity_threshold<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>agent <span class="token operator">=</span> Agent<span class="token punctuation">(</span><span class="token string">"domain.yml"</span><span class="token punctuation">,</span> policies<span class="token operator">=</span><span class="token punctuation">[</span>KerasPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fallback<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><blockquote><p>æ³¨æ„</p><p>æ‚¨å¯ä»¥åœ¨é…ç½®ä¸­åŒ…å«<code>FallbackPolicy</code>æˆ– <code>TwoStageFallbackPolicy</code>ï¼Œä½†ä¸èƒ½åŒæ—¶åŒ…å«ä¸¤è€…ã€‚</p></blockquote><h3 id="ä¸¤é˜¶æ®µå›é€€ç­–ç•¥"><a href="#ä¸¤é˜¶æ®µå›é€€ç­–ç•¥" class="headerlink" title="ä¸¤é˜¶æ®µå›é€€ç­–ç•¥"></a>ä¸¤é˜¶æ®µå›é€€ç­–ç•¥</h3><p>è¯¥<code>TwoStageFallbackPolicy</code>æ‰‹æŸ„ä½NLUä¿¡å¿ƒå¤šä¸ªé˜¶æ®µï¼Œè¯•å›¾æ¾„æ¸…å¯¹ç”¨æˆ·è¾“å…¥ã€‚</p><ul><li>å¦‚æœNLUé¢„æµ‹çš„ç½®ä¿¡åº¦å¾—åˆ†ä½æˆ–ä¸æ˜æ˜¾é«˜äºæ’åç¬¬äºŒçš„é¢„æµ‹ï¼Œåˆ™è¦æ±‚ç”¨æˆ·ç¡®è®¤æ„å›¾çš„åˆ†ç±»ã€‚<ul><li>å¦‚æœä»–ä»¬è‚¯å®šäº†ï¼Œé‚£ä¹ˆæ•…äº‹å°†ç»§ç»­ï¼Œå°±å¥½åƒä»ä¸€å¼€å§‹å°±å¯¹æ„å›¾è¿›è¡Œäº†é«˜åº¦è‡ªä¿¡çš„åˆ†ç±»ã€‚</li><li>å¦‚æœä»–ä»¬æ‹’ç»ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¡¨è¾¾ä»–ä»¬çš„æ¶ˆæ¯ã€‚</li></ul></li><li>æ”¹å†™<ul><li>å¦‚æœé‡æ–°è¡¨è¾¾æ„å›¾çš„åˆ†ç±»æ˜¯ç¡®å®šçš„ï¼Œåˆ™æ•…äº‹å°†ç»§ç»­ï¼Œå°±å¥½åƒç”¨æˆ·ä»ä¸€å¼€å§‹å°±å…·æœ‰æ­¤æ„å›¾ã€‚</li><li>å¦‚æœæªè¾çš„æ„å›¾æ²¡æœ‰è¢«é«˜å¯ä¿¡åº¦åˆ†ç±»ï¼Œåˆ™è¦æ±‚ç”¨æˆ·ç¡®è®¤åˆ†ç±»çš„æ„å›¾ã€‚</li></ul></li><li>ç¬¬äºŒæ¬¡ç¡®è®¤<ul><li>å¦‚æœç”¨æˆ·ç¡®è®¤äº†æ­¤æ„å›¾ï¼Œåˆ™æ•…äº‹å°†ç»§ç»­ï¼Œå°±åƒç”¨æˆ·ä»ä¸€å¼€å§‹å°±å…·æœ‰æ­¤æ„å›¾ä¸€æ ·ã€‚</li><li>å¦‚æœç”¨æˆ·æ‹’ç»ï¼Œåˆ™å°†åŸå§‹æ„å›¾åˆ†ç±»ä¸ºæŒ‡å®šçš„ <code>deny_suggestion_intent_name</code>ï¼Œå¹¶è§¦å‘æœ€ç»ˆçš„åå¤‡æ“ä½œï¼ˆä¾‹å¦‚ï¼Œç§»äº¤ç»™äººç±»ï¼‰ã€‚</li></ul></li></ul><p><strong>ç»„æ€ï¼š</strong></p><p>è¦ä½¿ç”¨<code>TwoStageFallbackPolicy</code>ï¼Œè¯·åœ¨æ‚¨çš„ç­–ç•¥é…ç½®ä¸­åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ã€‚</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: TwoStageFallbackPolicy<span class="token code keyword">    nlu_threshold: 0.3</span><span class="token code keyword">    ambiguity_threshold: 0.1</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_core_action_name: "action_default_fallback"</span><span class="token code keyword">    fallback_nlu_action_name: "action_default_fallback"</span><span class="token code keyword">    deny_suggestion_intent_name: "out_of_scope"</span></code></pre><table><thead><tr><th><code>nlu_threshold</code></th><th>æ¥å—NLUé¢„æµ‹æ‰€éœ€çš„æœ€ä½ç½®ä¿¡åº¦</th></tr></thead><tbody><tr><td><code>ambiguity_threshold</code></td><td>æœ€é«˜æ„å›¾çš„ç½®ä¿¡åº¦å¿…é¡»è¶…è¿‡ç¬¬äºŒé«˜æ„å›¾çš„ç½®ä¿¡åº¦çš„æœ€å°æ•°é‡ã€‚</td></tr><tr><td><code>core_threshold</code></td><td>æ¥å—Rasa Coreçš„åŠ¨ä½œé¢„æµ‹æ‰€éœ€çš„æœ€ä½ç½®ä¿¡åº¦</td></tr><tr><td><code>fallback_core_action_name</code></td><td>å¦‚æœRasa CoreåŠ¨ä½œé¢„æµ‹çš„å¯ä¿¡åº¦ä½äºï¼Œåˆ™è°ƒç”¨ çš„<a href="#">åå¤‡åŠ¨ä½œçš„</a>åç§°<code>core_threshold</code>ã€‚è¯¥è¡ŒåŠ¨æ˜¯ä¸ºäº†æå‡ºå…¬è®¤çš„æ„å›¾</td></tr><tr><td><code>fallback_nlu_action_name</code></td><td>å¦‚æœRasa NLUæ„å‘åˆ†ç±»çš„ç½®ä¿¡åº¦ä½äºï¼Œåˆ™è°ƒç”¨ çš„<a href="#">åå¤‡æ“ä½œçš„</a>åç§°<code>nlu_threshold</code>ã€‚ç”¨æˆ·ç¬¬äºŒæ¬¡æ‹’ç»æ—¶è°ƒç”¨æ­¤æ“ä½œ</td></tr><tr><td><code>deny_suggestion_intent_name</code></td><td>æ„å‘çš„åç§°ï¼Œç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æ‹’ç»å»ºè®®çš„æ„å‘</td></tr></tbody></table><blockquote><p>æ³¨æ„</p><p>æ‚¨å¯ä»¥åœ¨é…ç½®ä¸­åŒ…å«<code>FallbackPolicy</code>æˆ– <code>TwoStageFallbackPolicy</code>ï¼Œä½†ä¸èƒ½åŒæ—¶åŒ…å«ä¸¤è€…ã€‚</p></blockquote><h3 id="è¡¨å•ç­–ç•¥"><a href="#è¡¨å•ç­–ç•¥" class="headerlink" title="è¡¨å•ç­–ç•¥"></a>è¡¨å•ç­–ç•¥</h3><p>çš„<code>FormPolicy</code>æ˜¯çš„ä¸€ä¸ªæ‰©å±•<code>MemoizationPolicy</code>ï¼Œå…¶å¤„ç†çš„å½¢å¼å¡«å……ã€‚ä¸€æ—¦<code>FormAction</code>è¢«è°ƒç”¨æ—¶ï¼Œ <code>FormPolicy</code>å°†ä¸æ–­é¢„æµ‹<code>FormAction</code>ï¼Œç›´åˆ°è¡¨æ ¼ä¸­çš„æ‰€æœ‰å¿…éœ€çš„æ§½åˆ†é…ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">Forms</a>ã€‚</p><h2 id="æ§½ä½"><a href="#æ§½ä½" class="headerlink" title="æ§½ä½"></a>æ§½ä½</h2><ul><li><a href="#">ä»€ä¹ˆæ˜¯æ§½ä½ï¼Ÿ</a></li><li><a href="#">Rasaå¦‚ä½•ä½¿ç”¨æ§½ä½</a></li><li><a href="#">æ§½ä½å¦‚ä½•è®¾ç½®</a><ul><li><a href="#">ä»NLUè®¾ç½®çš„æ§½ä½</a></li><li><a href="#">ç‚¹å‡»æŒ‰é’®æ§½ä½è®¾ç½®</a></li><li><a href="#">åŠ¨ä½œè®¾å®šçš„æ§½ä½</a></li></ul></li><li><a href="#">æ§½ä½ç±»å‹</a><ul><li><a href="#">æ–‡å­—æ§½ä½</a></li><li><a href="#">å¸ƒå°”æ§½ä½</a></li><li><a href="#">åˆ†ç±»æ§½ä½</a></li><li><a href="#">æµ®ç‚¹æ§½ä½</a></li><li><a href="#">æ•°ç»„æ§½ä½</a></li><li><a href="#">Unfeaturizedæ§½ä½</a></li></ul></li><li><a href="#">è‡ªå®šä¹‰å¹¿å‘Šä½ç±»å‹</a></li></ul><h3 id="ä»€ä¹ˆæ˜¯æ§½ä½ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ§½ä½ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ§½ä½ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ§½ä½ï¼Ÿ</h3><p><strong>æ’æ§½æ˜¯æ‚¨çš„æœºå™¨äººçš„è®°å¿†ã€‚</strong>å®ƒä»¬å……å½“é”®å€¼å­˜å‚¨ï¼Œå¯ç”¨äºå­˜å‚¨ç”¨æˆ·æä¾›çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œä»–ä»¬çš„å®¶ä¹¡åŸå¸‚ï¼‰ä»¥åŠæœ‰å…³å¤–ç•Œçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ•°æ®åº“æŸ¥è¯¢çš„ç»“æœï¼‰ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›å¹¿å‘Šä½å½±å“å¯¹è¯çš„è¿›è¡Œæ–¹å¼ã€‚å¯¹äºä¸åŒçš„è¡Œä¸ºï¼Œæœ‰ä¸åŒçš„æ’æ§½ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç”¨æˆ·æä¾›äº†ä»–ä»¬çš„å±…ä½åŸå¸‚ï¼Œåˆ™æ‚¨å¯èƒ½æœ‰ä¸€ä¸ª<code>text</code>åä¸ºçš„å¹¿å‘Šä½<code>home_city</code>ã€‚å¦‚æœç”¨æˆ·è¦æ±‚å¤©æ°”ï¼Œè€Œæ‚¨<em>ä¸</em>çŸ¥é“ä»–ä»¬çš„å®¶ä¹¡ï¼Œåˆ™å¿…é¡»å‘ä»–ä»¬è¯¢é—®ã€‚ä¸€ä¸ª<code>text</code>æ’æ§½åªå‘Šè¯‰èæ ¸å¿ƒçš„æ’æ§½æ˜¯å¦å…·æœ‰ä»·å€¼ã€‚å¹¿å‘Šä½çš„å…·ä½“å€¼<code>text</code>ï¼ˆä¾‹å¦‚ç­åŠ ç½—å°”ï¼Œçº½çº¦æˆ–é¦™æ¸¯ï¼‰æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>å¦‚æœè¯¥å€¼æœ¬èº«å¾ˆé‡è¦ï¼Œè¯·ä½¿ç”¨<code>categorical</code>æˆ–<code>bool</code>æ’æ§½ã€‚ä¹Ÿæœ‰<code>float</code>å’Œ<code>list</code>æ’æ§½ã€‚å¦‚æœæ‚¨åªæƒ³å­˜å‚¨ä¸€äº›æ•°æ®ï¼Œä½†åˆä¸æƒ³å½±å“å¯¹è¯çš„æµç¨‹ï¼Œè¯·ä½¿ç”¨<code>unfeaturized</code>æ’æ§½ã€‚</p><h3 id="Rasaå¦‚ä½•ä½¿ç”¨æ§½ä½"><a href="#Rasaå¦‚ä½•ä½¿ç”¨æ§½ä½" class="headerlink" title="Rasaå¦‚ä½•ä½¿ç”¨æ§½ä½"></a>Rasaå¦‚ä½•ä½¿ç”¨æ§½ä½</h3><p>åœ¨<code>Policy</code>æ²¡æœ‰è®¿é—®æ‚¨çš„æ’æ§½çš„ä»·å€¼ã€‚å®ƒæ”¶åˆ°ä¸€ä¸ªç‰¹å¾åŒ–çš„è¡¨ç¤ºã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äº<code>text</code>æ’æ§½ï¼Œè¯¥å€¼æ— å…³ç´§è¦ã€‚è¯¥ç­–ç•¥åªä¼šæ˜¾ç¤ºä¸€ä¸ª<code>1</code>æˆ–<code>0</code>å–å†³äºå®ƒæ˜¯å¦è®¾ç½®ã€‚</p><p><strong>æ‚¨åº”è¯¥ä»”ç»†é€‰æ‹©æ§½ä½ç±»å‹ï¼</strong></p><h4 id="æ§½ä½å¦‚ä½•è®¾ç½®"><a href="#æ§½ä½å¦‚ä½•è®¾ç½®" class="headerlink" title="æ§½ä½å¦‚ä½•è®¾ç½®"></a>æ§½ä½å¦‚ä½•è®¾ç½®</h4><p>æ‚¨å¯ä»¥ä¸ºåŸŸæ–‡ä»¶ä¸­çš„å¹¿å‘Šä½æä¾›åˆå§‹å€¼ï¼š</p><pre class=" language-markdown"><code class="language-markdown">slots:  name:<span class="token code keyword">    type: text</span><span class="token code keyword">    initial_value: "human"</span></code></pre><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>.get_slot()</code>inside<code>actions.py</code>è·å–æ’æ§½çš„å€¼ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">data = tracker.get_slot("slot-name")</code></pre><p>åœ¨å¯¹è¯æœŸé—´å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼è®¾ç½®å¹¿å‘Šä½ï¼š</p><h4 id="NLUè®¾ç½®çš„æ§½ä½"><a href="#NLUè®¾ç½®çš„æ§½ä½" class="headerlink" title="NLUè®¾ç½®çš„æ§½ä½"></a>NLUè®¾ç½®çš„æ§½ä½</h4><p>å¦‚æœæ‚¨çš„NLUæ¨¡å‹é€‰æ‹©ä¸€ä¸ªå®ä½“ï¼Œå¹¶ä¸”æ‚¨çš„åŸŸä¸­åŒ…å«ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„æ’æ§½ï¼Œåˆ™è¯¥æ’æ§½å°†è‡ªåŠ¨è®¾ç½®ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> story_01</span><span class="token list punctuation">*</span> greet<span class="token entity" title="&#123;">&amp;#123;</span>"name": "Ali"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"name": "Ali"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> utter_greet</code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å¿…åœ¨æ•…äº‹ä¸­åŒ…æ‹¬è¯¥é›¶ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯è‡ªåŠ¨æ‹¾å–çš„ã€‚<code>- slot{}</code></p><p>è¦ä¸ºç‰¹å®šæ’æ§½ç¦ç”¨æ­¤è¡Œä¸ºï¼Œå¯ä»¥åœ¨åŸŸæ–‡ä»¶ä¸­å°†<code>auto_fill</code>å±æ€§è®¾ç½®ä¸º <code>False</code>ï¼š</p><pre class=" language-markdown"><code class="language-markdown">slots:  name:<span class="token code keyword">    type: text</span><span class="token code keyword">    auto_fill: False</span></code></pre><h4 id="ç‚¹å‡»æŒ‰é’®æ§½ä½è®¾ç½®"><a href="#ç‚¹å‡»æŒ‰é’®æ§½ä½è®¾ç½®" class="headerlink" title="ç‚¹å‡»æŒ‰é’®æ§½ä½è®¾ç½®"></a>ç‚¹å‡»æŒ‰é’®æ§½ä½è®¾ç½®</h4><p>æ‚¨å¯ä»¥å°†æŒ‰é’®ç”¨ä½œå¿«æ·æ–¹å¼ã€‚Rasa Coreå°†ä»¥å¼€å¤´çš„æ¶ˆæ¯å‘é€<code>/</code>åˆ° <code>RegexInterpreter</code>ï¼ŒæœŸæœ›NLUè¾“å…¥çš„æ ¼å¼ä¸æ•…äº‹æ–‡ä»¶ä¸­çš„æ ¼å¼ç›¸åŒï¼Œä¾‹å¦‚<code>/intent{entities}</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®©ç”¨æˆ·é€šè¿‡å•å‡»æŒ‰é’®æ¥é€‰æ‹©é¢œè‰²ï¼Œåˆ™æŒ‰é’®çš„æœ‰æ•ˆè½½è·å¯èƒ½æ˜¯å’Œã€‚<code>/choose{"color": "blue"}``/choose{"color": "red"}</code></p><p>æ‚¨å¯ä»¥åœ¨åŸŸæ–‡ä»¶ä¸­æŒ‡å®šä»¥ä¸‹å†…å®¹ï¼šï¼ˆè¯·å‚é˜…<a href="https://legacy-docs-v1.rasa.com/core/domains/#domains">Domainsä¸­çš„</a>è¯¦ç»†ä¿¡æ¯ï¼‰</p><pre class=" language-markdown"><code class="language-markdown">utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>color:<span class="token list punctuation">-</span> text: "what color would you like?"  buttons:  <span class="token list punctuation">-</span> title: "blue"<span class="token code keyword">    payload: '/choose&amp;#123;"color": "blue"&amp;#125;'</span>  <span class="token list punctuation">-</span> title: "red"<span class="token code keyword">    payload: '/choose&amp;#123;"color": "red"&amp;#125;'</span></code></pre><h4 id="åŠ¨ä½œæ§½ä½è®¾ç½®"><a href="#åŠ¨ä½œæ§½ä½è®¾ç½®" class="headerlink" title="åŠ¨ä½œæ§½ä½è®¾ç½®"></a>åŠ¨ä½œæ§½ä½è®¾ç½®</h4><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯é€šè¿‡è¿”å›<a href="https://legacy-docs-v1.rasa.com/core/actions/#custom-actions">è‡ªå®šä¹‰æ“ä½œä¸­çš„</a>äº‹ä»¶æ¥è®¾ç½®å¹¿å‘Šä½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„æ•…äº‹éœ€è¦åŒ…å«å¹¿å‘Šä½ã€‚ä¾‹å¦‚ï¼Œæ‚¨æœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œæ¥è·å–ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª<code>categorical</code>åä¸ºçš„å¹¿å‘Šä½<code>account_type</code>ã€‚å½“<code>fetch_profile</code>è¿è¡ŒåŠ¨ä½œï¼Œå®ƒè¿”å›ä¸€ä¸ª <a href="https://legacy-docs-v1.rasa.com/api/events/#rasa.core.events.SlotSet"><code>rasa.core.events.SlotSet</code></a>äº‹ä»¶ï¼š</p><pre class=" language-markdown"><code class="language-markdown">slots:   account_type:<span class="token code keyword">      type: categorical</span><span class="token code keyword">      values:</span><span class="token code keyword">      - premium</span><span class="token code keyword">      - basic</span>from rasa<span class="token italic"><span class="token punctuation">_</span>sdk.actions import Actionfrom rasa<span class="token punctuation">_</span></span>sdk.events import SlotSetimport requestsclass FetchProfileAction(Action):<span class="token code keyword">    def name(self):</span><span class="token code keyword">        return "fetch_profile"</span><span class="token code keyword">    def run(self, dispatcher, tracker, domain):</span><span class="token code keyword">        url = "http://myprofileurl.com"</span><span class="token code keyword">        data = requests.get(url).json</span><span class="token code keyword">        return [SlotSet("account_type", data["account_type"])]</span><span class="token title important"><span class="token punctuation">#</span> story_01</span><span class="token list punctuation">*</span> greet  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>fetch<span class="token punctuation">_</span></span>profile  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"account_type" : "premium"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>welcome<span class="token punctuation">_</span></span>premium<span class="token title important"><span class="token punctuation">#</span> story_02</span><span class="token list punctuation">*</span> greet  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>fetch<span class="token punctuation">_</span></span>profile  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"account_type" : "basic"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>welcome<span class="token punctuation">_</span></span>basic</code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ <strong>å°±</strong>å¿…é¡»åŒ…æ‹¬åœ¨ä½ çš„æ•…äº‹çš„ä¸€éƒ¨åˆ†ã€‚Rasa Coreå°†å­¦ä¹ ä½¿ç”¨æ­¤ä¿¡æ¯æ¥å†³å®šè¦é‡‡å–çš„æ­£ç¡®æªæ–½ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºæˆ–ï¼‰ã€‚<code>- slot{}``utter_welcome_premium``utter_welcome_basic</code></p><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨æ‰‹åŠ¨ç¼–å†™æ•…äº‹ï¼Œåˆ™<strong>å¾ˆå®¹æ˜“</strong>å¿˜è®°æ’æ§½ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨<a href="#">å¸¦è¡¨å•çš„äº¤äº’å¼å­¦ä¹ </a>æ¥æ„å»ºè¿™äº›æ•…äº‹<a href="https://legacy-docs-v1.rasa.com/core/interactive-learning/#section-interactive-learning-forms">ï¼Œ</a>è€Œä¸è¦ç¼–å†™å®ƒä»¬ã€‚</p></blockquote><h3 id="æ’æ§½ç±»å‹"><a href="#æ’æ§½ç±»å‹" class="headerlink" title="æ’æ§½ç±»å‹"></a>æ’æ§½ç±»å‹</h3><p><strong>text</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>æ‚¨åªå…³å¿ƒæ˜¯å¦å·²æŒ‡å®šç”¨æˆ·é¦–é€‰é¡¹çš„ä½ç½®ã€‚</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:    <br>     cuisine:      <br>            type: text</td></tr><tr><td><strong>Description</strong></td><td><code>1</code>å¦‚æœè®¾ç½®äº†ä»»ä½•å€¼ï¼Œåˆ™å°†æ’æ§½çš„åŠŸèƒ½è®¾ç½®ä¸ºã€‚å¦åˆ™ï¼ŒåŠŸèƒ½å°†è®¾ç½®ä¸º<code>0</code>ï¼ˆæœªè®¾ç½®ä»»ä½•å€¼ï¼‰ã€‚</td></tr></tbody></table><p><strong>bool</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>æ‚¨åªå…³å¿ƒæ˜¯å¦å·²æŒ‡å®šç”¨æˆ·é¦–é€‰é¡¹çš„ä½ç½®ã€‚</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:    <br>     cuisine:      <br>            type: text</td></tr><tr><td><strong>Description</strong></td><td><code>1</code>å¦‚æœè®¾ç½®äº†ä»»ä½•å€¼ï¼Œåˆ™å°†æ’æ§½çš„åŠŸèƒ½è®¾ç½®ä¸ºã€‚å¦åˆ™ï¼ŒåŠŸèƒ½å°†è®¾ç½®ä¸º<code>0</code>ï¼ˆæœªè®¾ç½®ä»»ä½•å€¼ï¼‰ã€‚</td></tr></tbody></table><p><strong>categorical</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>æ’æ§½å¯ä»¥é‡‡ç”¨Nä¸ªå€¼ä¹‹ä¸€</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:    <br>    risk_level:      <br>          type: categorical     <br>           values:       <br>            - low  <br>            - medium <br>            - high</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºä¸€ä¸ªå•ç¼–ç ï¼Œæè¿°å“ªä¸ª<code>values</code>åŒ¹é…ã€‚é»˜è®¤å€¼<code>__other__</code>ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç”¨æˆ·å®šä¹‰çš„å€¼ä¸­ã€‚é‡åˆ°çš„æ‰€æœ‰æœªåœ¨åŸŸä¸­æ˜ç¡®å®šä¹‰çš„å€¼éƒ½å°†æ˜ å°„åˆ°<code>__other__</code>ç‰¹å¾ã€‚è¯¥å€¼ <code>__other__</code>ä¸åº”ç”¨ä½œç”¨æˆ·å®šä¹‰çš„å€¼ï¼›å¦‚æœæ˜¯è¿™æ ·ï¼Œå®ƒå°†ä»ç„¶æ˜¯æ‰€æœ‰æœªæ˜¾ç¤ºå€¼æ˜ å°„åˆ°çš„é»˜è®¤å€¼ã€‚</td></tr></tbody></table><p><strong>float</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>è¿ç»­å€¼</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:   <br>     temperature:  <br>              type: float  <br>              min_value: -100.0 <br>              max_value:  100.0</td></tr><tr><td><strong>Defaults</strong></td><td>max_value=1.0<code>ï¼Œ </code>min_value=0.0</td></tr><tr><td><strong>Description</strong></td><td>ä¸‹é¢çš„æ‰€æœ‰å€¼éƒ½<code>min_value</code>å°†è¢«è§†ä¸º<code>min_value</code>ï¼Œä¸Šé¢çš„å€¼ä¹Ÿä¸€æ ·<code>max_value</code>ã€‚å› æ­¤ï¼Œå¦‚æœ<code>max_value</code>å°†å…¶è®¾ç½®ä¸º <code>1</code>ï¼Œåˆ™æ’æ§½å€¼ä¹‹é—´<code>2</code>å’Œ<code>3.5</code>åœ¨åŠŸèƒ½åŒ–æ–¹é¢æ²¡æœ‰åŒºåˆ«ï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªå€¼å°†ä»¥ç›¸åŒçš„æ–¹å¼å½±å“å¯¹è¯ï¼Œå¹¶ä¸”æ¨¡å‹æ— æ³•å­¦ä¼šåŒºåˆ†å®ƒä»¬ï¼‰ã€‚</td></tr></tbody></table><p><strong>list</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>å€¼æ¸…å•</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:   <br>     shopping_items:      <br>              type: list</td></tr><tr><td><strong>Description</strong></td><td><code>1</code>å¦‚æœè®¾ç½®äº†å¸¦æœ‰åˆ—è¡¨çš„å€¼ï¼ˆåˆ—è¡¨ä¸ä¸ºç©ºï¼‰ï¼Œåˆ™è®¾ç½®æ­¤æ’æ§½çš„åŠŸèƒ½ã€‚å¦‚æœæœªè®¾ç½®ä»»ä½•å€¼ï¼Œæˆ–è€…ç©ºç™½åˆ—è¡¨ä¸ºè®¾ç½®å€¼ï¼Œåˆ™è¯¥åŠŸèƒ½å°†ä¸º<code>0</code>ã€‚<strong>å­˜å‚¨åœ¨æ’æ§½ä¸­çš„åˆ—è¡¨</strong>çš„<strong>é•¿åº¦ä¸å½±å“å¯¹è¯</strong>ã€‚</td></tr></tbody></table><p><strong>unfeaturized</strong></p><table><thead><tr><th><strong>Use For</strong></th><th>æ‚¨è¦å­˜å‚¨çš„æ•°æ®ä¸åº”å½±å“å¯¹è¯æµç¨‹</th></tr></thead><tbody><tr><td><strong>Example</strong></td><td>slots:    <br>      internal_user_id:     <br>               type: unfeaturized</td></tr><tr><td><strong>Description</strong></td><td>è¯¥æ’æ§½ä¸ä¼šå…·æœ‰ä»»ä½•ç‰¹å¾ï¼Œå› æ­¤å…¶å€¼ä¸ä¼šå½±å“å¯¹è¯æµç¨‹ï¼Œåœ¨é¢„æµ‹æœºå™¨äººåº”æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªåŠ¨ä½œæ—¶ä¼šè¢«å¿½ç•¥ã€‚</td></tr></tbody></table><h3 id="è‡ªå®šä¹‰æ’æ§½ç±»å‹"><a href="#è‡ªå®šä¹‰æ’æ§½ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰æ’æ§½ç±»å‹"></a>è‡ªå®šä¹‰æ’æ§½ç±»å‹</h3><p>ä¹Ÿè®¸æ‚¨çš„é¤å…é¢„è®¢ç³»ç»Ÿæœ€å¤šåªèƒ½å¤„ç†6äººçš„é¢„è®¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›å¹¿å‘Šä½çš„<em>å€¼</em>å½±å“ä¸‹ä¸€ä¸ªé€‰å®šçš„æ“ä½œï¼ˆè€Œä¸åªæ˜¯å½±å“æ˜¯å¦å·²æŒ‡å®šï¼‰ã€‚æ‚¨å¯ä»¥é€šè¿‡å®šä¹‰è‡ªå®šä¹‰æ’æ§½ç±»æ¥å®ç°ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºçš„æ’æ§½ç±»<code>NumberOfPeopleSlot</code>ã€‚åŠŸèƒ½åŒ–å®šä¹‰äº†å¦‚ä½•å°†æ­¤æ’æ§½çš„å€¼è½¬æ¢ä¸ºå‘é‡ä»¥ä¾›æˆ‘ä»¬çš„æœºå™¨å­¦ä¹ æ¨¡å‹å¤„ç†ã€‚æˆ‘ä»¬çš„å¹¿å‘Šä½æœ‰ä¸‰ä¸ªå¯èƒ½çš„â€œå€¼â€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨lengthçš„å‘é‡è¡¨ç¤ºå®ƒä»¬<code>2</code>ã€‚</p><table><thead><tr><th><code>(0,0)</code></th><th>å°šæœªè®¾å®š</th></tr></thead><tbody><tr><td><code>(1,0)</code></td><td>1è‡³6</td></tr><tr><td><code>(0,1)</code></td><td>è¶…è¿‡6</td></tr></tbody></table><pre class=" language-markdown"><code class="language-markdown">from rasa.core.slots import Slotclass NumberOfPeopleSlot(Slot):<span class="token code keyword">    def feature_dimensionality(self):</span><span class="token code keyword">        return 2</span><span class="token code keyword">    def as_feature(self):</span><span class="token code keyword">        r = [0.0] * self.feature_dimensionality()</span><span class="token code keyword">        if self.value:</span><span class="token code keyword">            if self.value &lt;= 6:</span><span class="token code keyword">                r[0] = 1.0</span><span class="token code keyword">            else:</span><span class="token code keyword">                r[1] = 1.0</span><span class="token code keyword">        return r</span></code></pre><p>ç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›åŸ¹è®­æ•…äº‹ï¼Œä»¥ä¾¿Rasa Coreå¯ä»¥ä»ä¸­å­¦ä¹ å¦‚ä½•å¤„ç†ä¸åŒæƒ…å†µï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> story1</span>...<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "3"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>book<span class="token punctuation">_</span></span>table...<span class="token title important"><span class="token punctuation">#</span> story2</span><span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "9"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>table_limit</code></pre><h2 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h2><blockquote><p>æ³¨æ„</p><p>æœ‰ä¸€ä¸ªæ·±å…¥çš„æ•™ç¨‹<a href="#">ç‚¹å‡»è¿™é‡Œ</a>äº†è§£å¦‚ä½•ä½¿ç”¨èå½¢å¼çš„æ§½åˆ†é…ã€‚</p></blockquote><ul><li><a href="#">é…ç½®æ–‡ä»¶</a></li><li><a href="#">è¡¨æ ¼åŸºç¡€</a></li><li><a href="#">è‡ªå®šä¹‰æ’æ§½æ˜ å°„</a></li><li><a href="#">éªŒè¯ç”¨æˆ·è¾“å…¥</a></li><li><a href="#">å¤„ç†ä¸æ„‰å¿«è·¯å¾„</a></li><li><a href="#">request_slotæ§½ä½</a></li><li><a href="#">å¤„ç†æ¡ä»¶æ—¶éš™é€»è¾‘</a></li><li><a href="#">è°ƒè¯•</a></li></ul><p>æœ€å¸¸è§çš„å¯¹è¯æ¨¡å¼ä¹‹ä¸€æ˜¯ä»ç”¨æˆ·é‚£é‡Œæ”¶é›†ä¸€äº›ä¿¡æ¯ï¼Œä»¥ä¾¿åšæŸäº‹ï¼ˆé¢„è®¢é¤å…ï¼Œè°ƒç”¨APIï¼Œæœç´¢æ•°æ®åº“ç­‰ï¼‰ã€‚è¿™ä¹Ÿç§°ä¸º<strong>æ’æ§½å¡«å……</strong>ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦è¿ç»­æ”¶é›†å¤šæ¡ä¿¡æ¯ï¼Œå»ºè®®æ‚¨åˆ›å»ºä¸€ä¸ª<code>FormAction</code>ã€‚è¿™æ˜¯ä¸€ä¸ªå•ä¸€æ“ä½œï¼ŒåŒ…å«å¾ªç¯éå†æ‰€éœ€æ’æ§½å¹¶è¦æ±‚ç”¨æˆ·æä¾›æ­¤ä¿¡æ¯çš„é€»è¾‘ã€‚åœ¨<code>examples/formbot</code>Rasa Coreç›®å½•ä¸­æœ‰ä¸€ä¸ªä½¿ç”¨è¡¨å•çš„å®Œæ•´ç¤ºä¾‹ã€‚</p><p>å®šä¹‰è¡¨å•æ—¶ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°åŸŸæ–‡ä»¶ä¸­ã€‚å¦‚æœæ‚¨çš„è¡¨å•åç§°ä¸º<code>restaurant_form</code>ï¼Œåˆ™æ‚¨çš„åŸŸå°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown">forms:  <span class="token list punctuation">-</span> restaurant_formactions:  ...</code></pre><p>è¯·å‚é˜…<code>examples/formbot/domain.yml</code>ç¤ºä¾‹ã€‚</p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>è¦ä½¿ç”¨è¡¨æ ¼ï¼Œæ‚¨è¿˜éœ€è¦<code>FormPolicy</code>åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­åŒ…å«ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: "FormPolicy"</code></pre><p>è¯·å‚é˜…<code>examples/formbot/config.yml</code>ç¤ºä¾‹ã€‚</p><h3 id="è¡¨æ ¼åŸºç¡€çŸ¥è¯†"><a href="#è¡¨æ ¼åŸºç¡€çŸ¥è¯†" class="headerlink" title="è¡¨æ ¼åŸºç¡€çŸ¥è¯†"></a>è¡¨æ ¼åŸºç¡€çŸ¥è¯†</h3><p>ä½¿ç”¨<code>FormAction</code>ï¼Œæ‚¨å¯ä»¥ç”¨ä¸€ä¸ªæ•…äº‹æè¿°<em>æ‰€æœ‰</em>å¿«ä¹çš„é“è·¯ã€‚æ‰€è°“â€œå¹¸ç¦ä¹‹è·¯â€ï¼Œæ˜¯æŒ‡æ¯å½“æ‚¨å‘ç”¨æˆ·è¯¢é—®æŸäº›ä¿¡æ¯æ—¶ï¼Œä»–ä»¬éƒ½ä¼šç”¨æ‚¨æ‰€è¦æ±‚çš„ä¿¡æ¯è¿›è¡Œå“åº”ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»¥é¤å…æœºå™¨äººä¸ºä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¸€çš„æ•…äº‹å°†æè¿°æ‰€æœ‰å¿«ä¹çš„é“è·¯ã€‚</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> happy path</span><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre><p>åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œç”¨æˆ·çš„æ„å›¾æ˜¯<code>request_restaurant</code>ï¼Œå…¶æ¬¡æ˜¯è¡¨å•åŠ¨ä½œ<code>restaurant_form</code>ã€‚éšç€å½¢å¼è¢«æ¿€æ´»ï¼Œå¹¶ä¸å½¢å¼å†æ¬¡æ¿€æ´»ã€‚å¦‚<a href="#">å¤„ç†ä¸æ„‰å¿«è·¯å¾„</a>éƒ¨åˆ†ä¸­æ‰€ç¤ºï¼Œå½“è¡¨å•ä»å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæœºå™¨äººå¯ä»¥åœ¨è¡¨å•å¤–æ‰§è¡Œä»»ä½•ç±»å‹çš„æ“ä½œã€‚åœ¨ç”¨æˆ·åˆä½œè‰¯å¥½ä¸”ç³»ç»Ÿæ­£ç¡®ç†è§£ç”¨æˆ·è¾“å…¥çš„â€œå¿«ä¹ä¹‹è·¯â€ä¸Šï¼Œè¡¨æ ¼å°†ä¸é—´æ–­åœ°å¡«å†™æ‰€æœ‰è¯·æ±‚çš„ç©ºä½ã€‚<code>form{"name": "restaurant_form"}  form{"name": null}</code></p><p>åœ¨<code>FormAction</code>å°†ä»…è¯·æ±‚å·²å°šæœªè®¾ç½®æ§½ã€‚å¦‚æœç”¨æˆ·ä¸æˆ‘æƒ³è¦ä¸€å®¶8äººç´ é£Ÿçš„ä¸­é¤é¦†å¼€å§‹å¯¹è¯ ï¼Œåˆ™ä¸ä¼šè¯¢é—®ä»–ä»¬æœ‰å…³<code>cuisine</code>å’Œçš„ä¿¡æ¯<code>num_people</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¦ä½¿è¯¥æ•…äº‹æ­£å¸¸è¿è¡Œï¼Œæ‚¨çš„å¹¿å‘Šä½åº”æœªè®¾ç½®<a href="#">ç‰¹è‰²</a>ã€‚å¦‚æœè¿™äº›ä½ç½®ä¸­çš„ä»»ä½•ä¸€ä¸ªå¤„äºæ­£å¸¸çŠ¶æ€ï¼Œåˆ™æ‚¨çš„æ•…äº‹éœ€è¦åŒ…æ‹¬<code>slot{}</code>äº‹ä»¶ä»¥æ˜¾ç¤ºå·²è®¾ç½®çš„è¿™äº›ä½ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ›å»ºæœ‰æ•ˆæ•…äº‹çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨â€œ<a href="#">äº¤äº’å¼å­¦ä¹ â€</a>ã€‚</p><p>åœ¨ä¸Šé¢çš„æ•…äº‹ä¸­ï¼Œ<code>restaurant_form</code>æ˜¯æˆ‘ä»¬è¡¨å•åŠ¨ä½œçš„åç§°ã€‚è¿™æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥åƒçš„ä¾‹å­ã€‚æ‚¨éœ€è¦å®šä¹‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li><code>name</code>ï¼šæ­¤æ“ä½œçš„åç§°</li><li><code>required_slots</code>ï¼šè¦ä½¿ç”¨è¯¥<code>submit</code>æ–¹æ³•ï¼Œå¿…é¡»å¡«å†™çš„æ’æ§½åˆ—è¡¨ã€‚</li><li><code>submit</code>ï¼šå¡«å†™å®Œæ‰€æœ‰å¹¿å‘Šä½åï¼Œè¡¨æ ¼æœ«å°¾çš„æ“ä½œã€‚</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Unique identifier of the form"""</span>    <span class="token keyword">return</span> <span class="token string">"restaurant_form"</span>@staticmethod<span class="token keyword">def</span> <span class="token function">required_slots</span><span class="token punctuation">(</span>tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A list of required slots that the form has to fill"""</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span> <span class="token string">"outdoor_seating"</span><span class="token punctuation">,</span> <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">submit</span><span class="token punctuation">(</span>    self<span class="token punctuation">,</span>    dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>    tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>    domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Define what the form has to do        after all required slots are filled"""</span>    <span class="token comment" spellcheck="true"># utter submit template</span>    dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_submit"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><p>ç¬¬ä¸€æ¬¡è°ƒç”¨è¡¨å•åŠ¨ä½œåï¼Œè¡¨å•å°†è¢«æ¿€æ´»å¹¶<code>FormPolicy</code>è·³è½¬ã€‚<code>FormPolicy</code>æå…¶ç®€å•ï¼Œå®ƒæ€»æ˜¯å¯ä»¥é¢„æµ‹è¡¨å•åŠ¨ä½œã€‚è¯·å‚é˜…<a href="#">å¤„ç†ä¸æ»¡æ„çš„è·¯å¾„</a>ä»¥äº†è§£å¦‚ä½•<a href="#">å¤„ç†</a>æ„å¤–çš„ç”¨æˆ·è¾“å…¥ã€‚</p><p>æ¯æ¬¡è°ƒç”¨è¡¨å•æ“ä½œæ—¶ï¼Œå®ƒå°†è¯¢é—®ç”¨æˆ·<code>required_slots</code>å°šæœªè®¾ç½®çš„ä¸‹ä¸€ä¸ªæ’æ§½ ã€‚å®ƒé€šè¿‡æŸ¥æ‰¾åä¸ºçš„å“åº”æ¥å®Œæˆæ­¤æ“ä½œ<code>utter_ask_{slot_name}</code>ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨åŸŸæ–‡ä»¶ä¸­ä¸ºæ¯ä¸ªæ‰€éœ€çš„æ’æ§½å®šä¹‰å®ƒä»¬ã€‚</p><p>ä¸€æ—¦æ‰€æœ‰æ’æ§½éƒ½è£…æ»¡ï¼Œ<code>submit()</code>ä¾¿ä¼šè°ƒç”¨æ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨æ‰€æ”¶é›†çš„ä¿¡æ¯ä¸ºç”¨æˆ·åšæŸäº‹ï¼Œä¾‹å¦‚æŸ¥è¯¢é¤å…APIã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›è¡¨å•æœ€ååšä»»ä½•äº‹æƒ…ï¼Œåªéœ€å°†å…¶ ç”¨ä½œæ‚¨çš„Submitæ–¹æ³•ã€‚è°ƒç”¨Submitæ–¹æ³•ä¹‹åï¼Œå°†åœç”¨è¡¨å•ï¼Œå¹¶å°†ä½¿ç”¨Coreæ¨¡å‹ä¸­çš„å…¶ä»–ç­–ç•¥æ¥é¢„æµ‹ä¸‹ä¸€æ­¥æ“ä½œã€‚<code>return []</code></p><h3 id="è‡ªå®šä¹‰æ’æ§½æ˜ å°„"><a href="#è‡ªå®šä¹‰æ’æ§½æ˜ å°„" class="headerlink" title="è‡ªå®šä¹‰æ’æ§½æ˜ å°„"></a>è‡ªå®šä¹‰æ’æ§½æ˜ å°„</h3><p>å¦‚æœæœªå®šä¹‰æ’æ§½æ˜ å°„ï¼Œåˆ™æ’æ§½å°†ä»…ç”±ä¸ä»ç”¨æˆ·è¾“å…¥ä¸­æ‹¾å–çš„æ’æ§½åç§°ç›¸åŒçš„å®ä½“å¡«å……ã€‚æŸäº›æ§½ä½ï¼ˆä¾‹å¦‚<code>cuisine</code>ï¼‰å¯ä»¥ä½¿ç”¨å•ä¸ªå®ä½“è·å–ï¼Œä½†æ˜¯ <code>FormAction</code>ä¹Ÿå¯ä»¥æ”¯æŒæ˜¯/å¦é—®é¢˜å’Œè‡ªç”±æ–‡æœ¬è¾“å…¥ã€‚è¯¥<code>slot_mappings</code>æ–¹æ³•å®šä¹‰äº†å¦‚ä½•ä»ç”¨æˆ·å“åº”ä¸­æå–å¹¿å‘Šä½å€¼ã€‚</p><p>è¿™æ˜¯é¤å…æœºå™¨äººçš„ç¤ºä¾‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">slot_mappings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Union<span class="token punctuation">[</span>Dict<span class="token punctuation">,</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A dictionary to map required slots to        - an extracted entity        - intent: value pairs        - a whole message        or a list of them, where a first match will be picked"""</span>    <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">"cuisine"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> not_intent<span class="token operator">=</span><span class="token string">"chitchat"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"num_people"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>            self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>                entity<span class="token operator">=</span><span class="token string">"number"</span><span class="token punctuation">,</span> intent<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"inform"</span><span class="token punctuation">,</span> <span class="token string">"request_restaurant"</span><span class="token punctuation">]</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"outdoor_seating"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>            self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"seating"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"affirm"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"deny"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"preferences"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"deny"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">"no additional preferences"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            self<span class="token punctuation">.</span>from_text<span class="token punctuation">(</span>not_intent<span class="token operator">=</span><span class="token string">"affirm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"feedback"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"feedback"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>from_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p>é¢„å®šä¹‰çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li><code>self.from_entity(entity=entity_name, intent=intent_name, role=role_name, group=group_name)</code> å°†æŸ¥æ‰¾ç§°ä¸ºå®ä½“<code>entity_name</code>ï¼Œä»¥å¡«è¡¥æ’æ§½ <code>slot_name</code>ï¼Œæ— è®ºç”¨æˆ·çš„æ„å›¾ï¼Œå¦‚æœ<code>intent_name</code>æ˜¯<code>None</code> å…¶ä»–äººåªæœ‰æ„å‘çš„ç”¨æˆ·æ˜¯<code>intent_name</code>ã€‚å¦‚æœæä¾›<code>role_name</code>å’Œ/æˆ–<code>group_name</code> ï¼Œåˆ™å®ä½“çš„è§’è‰²/ç»„æ ‡ç­¾ä¹Ÿéœ€è¦åŒ¹é…ç»™å®šçš„å€¼ã€‚</li><li><code>self.from_intent(intent=intent_name, value=value)</code> å°†å¡«è¡¥ç¼éš™<code>slot_name</code>ç”¨<code>value</code>ï¼Œå¦‚æœç”¨æˆ·æ„å›¾<code>intent_name</code>ã€‚è¦åˆ›å»ºä¸€ä¸ªå¸ƒå°”å‹æ’æ§½ï¼Œè¯·çœ‹<code>outdoor_seating</code> ä¸Šé¢çš„å®šä¹‰ã€‚æ³¨æ„ï¼šæ’æ§½ä¸ä¼šå¡«å……è§¦å‘è¡¨å•æ“ä½œçš„æ¶ˆæ¯çš„ç”¨æˆ·æ„å›¾ã€‚<code>self.from_trigger_intent</code>åœ¨ä¸‹é¢ä½¿ç”¨ã€‚</li><li><code>self.from_trigger_intent(intent=intent_name, value=value)</code> å°†å¡«è¡¥ç¼éš™<code>slot_name</code>ç”¨<code>value</code>ï¼Œå¦‚æœå½¢å¼ä¸ç”¨æˆ·æ„å›¾è§¦å‘<code>intent_name</code>ã€‚</li><li><code>self.from_text(intent=intent_name)</code>å°†ä½¿ç”¨ä¸‹ä¸€ä¸ªä½¿ç”¨è€…è¯´è¯å¡«å†™æ–‡æœ¬æ’æ§½<code>slot_name</code>ï¼Œæ— è®ºç”¨æˆ·çš„æ„å›¾ï¼Œå¦‚æœ<code>intent_name</code>æ˜¯<code>None</code>å…¶ä»–äººåªæœ‰å½“ç”¨æˆ·æ„å›¾<code>intent_name</code>ã€‚</li><li>å¦‚æœè¦å…è®¸è¿™äº›ç»„åˆï¼Œè¯·åƒä¸Šé¢çš„ç¤ºä¾‹ä¸€æ ·å°†å®ƒä»¬æä¾›ä¸ºåˆ—è¡¨ã€‚</li></ul><h3 id="éªŒè¯ç”¨æˆ·è¾“å…¥"><a href="#éªŒè¯ç”¨æˆ·è¾“å…¥" class="headerlink" title="éªŒè¯ç”¨æˆ·è¾“å…¥"></a>éªŒè¯ç”¨æˆ·è¾“å…¥</h3><p>ä»ç”¨æˆ·è¾“å…¥ä¸­æå–å¹¿å‘Šä½å€¼åï¼Œè¡¨å•å°†å°è¯•éªŒè¯å¹¿å‘Šä½çš„å€¼ã€‚è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»…åœ¨ç”¨æˆ·è¾“å…¥åç«‹å³æ‰§è¡Œè¡¨å•æ“ä½œæ—¶æ‰è¿›è¡ŒéªŒè¯ã€‚å¯ä»¥åœ¨Rasa SDK<code>_validate_if_required()</code>ä¸­çš„<code>FormAction</code>ç±»çš„å‡½æ•°ä¸­å¯¹æ­¤è¿›è¡Œæ›´æ”¹ ã€‚æ¿€æ´»è¡¨å•åï¼Œè¿˜å°†éªŒè¯åœ¨è¡¨å•åˆæ¬¡æ¿€æ´»ä¹‹å‰å¡«å†™çš„æ‰€æœ‰å¿…éœ€æ’æ§½ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒéªŒè¯ä»…æ£€æŸ¥è¯·æ±‚çš„æ’æ§½æ˜¯å¦æˆåŠŸä»æ’æ§½æ˜ å°„ä¸­æå–ã€‚å¦‚æœè¦æ·»åŠ è‡ªå®šä¹‰éªŒè¯ï¼ˆä¾‹å¦‚ï¼Œé’ˆå¯¹æ•°æ®åº“æ£€æŸ¥å€¼ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™åç§°ä¸ºhelperçš„éªŒè¯å‡½æ•°æ¥å®ç°<code>validate_{slot-name}</code>ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹<code>validate_cuisine()</code>æ£€æŸ¥æå–çš„ç¾é£Ÿæ’æ§½æ˜¯å¦å±äºå—æ”¯æŒç¾é£Ÿåˆ—è¡¨ã€‚</p><pre class=" language-python"><code class="language-python">    @staticmethod    <span class="token keyword">def</span> <span class="token function">cuisine_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Database of supported cuisines"""</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>            <span class="token string">"caribbean"</span><span class="token punctuation">,</span>            <span class="token string">"chinese"</span><span class="token punctuation">,</span>            <span class="token string">"french"</span><span class="token punctuation">,</span>            <span class="token string">"greek"</span><span class="token punctuation">,</span>            <span class="token string">"indian"</span><span class="token punctuation">,</span>            <span class="token string">"italian"</span><span class="token punctuation">,</span>            <span class="token string">"mexican"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">validate_cuisine</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        value<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Validate cuisine value."""</span>        <span class="token keyword">if</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>cuisine_db<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># validation succeeded, set the value of the "cuisine" slot to value</span>            <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"cuisine": value&amp;#125;</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_wrong_cuisine"</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># validation failed, set this slot to None, meaning the</span>            <span class="token comment" spellcheck="true"># user will be asked for the slot again</span>            <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"cuisine": None&amp;#125;</span></code></pre><p>å½“å¸®åŠ©ç¨‹åºéªŒè¯åŠŸèƒ½è¿”å›è¦è®¾ç½®çš„æ’æ§½åç§°å’Œå€¼çš„å­—å…¸æ—¶ï¼Œæ‚¨å¯ä»¥è®¾ç½®çš„æ’æ§½æ¯”åœ¨å¸®åŠ©ç¨‹åºéªŒè¯æ–¹æ³•ä¸­è¦éªŒè¯çš„æ’æ§½è¦å¤šã€‚ä½†æ˜¯ï¼Œæ‚¨æœ‰è´£ä»»ç¡®ä¿è¿™äº›é¢å¤–çš„æ’æ§½å€¼æœ‰æ•ˆã€‚</p><p>å¦‚æœæ’æ§½ä¸­å……æ»¡äº†æ‚¨ç¡®å®šæ— æ³•å¤„ç†çš„ä¸œè¥¿ï¼Œå¹¶ä¸”æ‚¨æƒ³ç›´æ¥åœç”¨è¡¨å•ï¼Œåˆ™å¯ä»¥è¦†ç›–æ­¤<code>request_next_slot()</code>æ–¹æ³•ã€‚ä¸‹é¢çš„ç¤ºä¾‹<code>cuisine</code>ç›´æ¥æ£€æŸ¥æ’æ§½çš„å€¼ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æƒ³è¦è§¦å‘åœç”¨çš„é€»è¾‘ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">request_next_slot</span><span class="token punctuation">(</span>    self<span class="token punctuation">,</span>    dispatcher<span class="token punctuation">:</span> <span class="token string">"CollectingDispatcher"</span><span class="token punctuation">,</span>    tracker<span class="token punctuation">:</span> <span class="token string">"Tracker"</span><span class="token punctuation">,</span>    domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>EventType<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Request the next slot and utter template if needed,        else return None"""</span>    <span class="token keyword">for</span> slot <span class="token keyword">in</span> self<span class="token punctuation">.</span>required_slots<span class="token punctuation">(</span>tracker<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_should_request_slot<span class="token punctuation">(</span>tracker<span class="token punctuation">,</span> slot<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">## Condition of validated slot that triggers deactivation</span>            <span class="token keyword">if</span> slot <span class="token operator">==</span> <span class="token string">"cuisine"</span> <span class="token operator">and</span> tracker<span class="token punctuation">.</span>get_slot<span class="token punctuation">(</span><span class="token string">"cuisine"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"caribbean"</span><span class="token punctuation">:</span>                dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"Sorry, I can't help you with that"</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>deactivate<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">## For all other slots, continue as usual</span>            logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>f<span class="token string">"Request next slot '&amp;#123;slot&amp;#125;'"</span><span class="token punctuation">)</span>            dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>                template<span class="token operator">=</span>f<span class="token string">"utter_ask_&amp;#123;slot&amp;#125;"</span><span class="token punctuation">,</span> <span class="token operator">**</span>tracker<span class="token punctuation">.</span>slots            <span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>SlotSet<span class="token punctuation">(</span>REQUESTED_SLOT<span class="token punctuation">,</span> slot<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> None</code></pre><p>å¦‚æœå¯¹äºä»»ä½•æ‰€éœ€çš„æ—¶é—´æ®µï¼Œä»ç”¨æˆ·çš„å‘è¨€ä¸­æœªæå–ä»»ä½•å†…å®¹ï¼Œ <code>ActionExecutionRejection</code>åˆ™ä¼šå¼•å‘é”™è¯¯ï¼Œè¿™æ„å‘³ç€æ“ä½œæ‰§è¡Œè¢«æ‹’ç»ï¼Œå› æ­¤Coreå°†é€€å›åˆ°å…¶ä»–ç­–ç•¥ä¸Šä»¥é¢„æµ‹å…¶ä»–æ“ä½œã€‚</p><h3 id="å¤„ç†ä¸æ„‰å¿«è·¯å¾„"><a href="#å¤„ç†ä¸æ„‰å¿«è·¯å¾„" class="headerlink" title="å¤„ç†ä¸æ„‰å¿«è·¯å¾„"></a>å¤„ç†ä¸æ„‰å¿«è·¯å¾„</h3><p>å½“ç„¶ï¼Œæ‚¨çš„ç”¨æˆ·å°†ä¸ä¼šæ€»æ˜¯ç”¨æ‚¨è¦æ±‚ä»–ä»¬æä¾›çš„ä¿¡æ¯æ¥å›åº”ã€‚é€šå¸¸ï¼Œç”¨æˆ·ä¼šé—®é—®é¢˜ï¼Œæ‰“æ‹›å‘¼ï¼Œæ”¹å˜ä¸»æ„æˆ–ä»¥å…¶ä»–æ–¹å¼åç¦»å¹¸ç¦çš„é“è·¯ã€‚è¡¨å•çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œ<code>ActionExecutionRejection</code>å¦‚æœç”¨æˆ·æœªæä¾›æ‰€è¯·æ±‚çš„ä¿¡æ¯ï¼Œè¡¨å•å°†å¼•å‘ã€‚æ‚¨éœ€è¦å¤„ç†å¯èƒ½å¯¼è‡´<code>ActionExecutionRejection</code>æ•…äº‹å‡ºé”™çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„ç”¨æˆ·é€‰æ‹©ä¸æ‚¨çš„æœºå™¨äººèŠå¤©ï¼Œåˆ™å¯ä»¥æ·»åŠ å¦‚ä¸‹æ•…äº‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token list punctuation">*</span> chitchat<span class="token code keyword">    - utter_chitchat</span><span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šåœ¨è¡¨å•æ“ä½œè¿‡ç¨‹ä¸­æ”¹å˜ä¸»æ„ï¼Œå¹¶å†³å®šä¸ç»§ç»­å…¶æœ€åˆçš„è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŠ©æ‰‹åº”åœæ­¢è¯¢é—®æ‰€è¯·æ±‚çš„æ—¶æ®µã€‚æ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤æ“ä½œ<code>action_deactivate_form</code>æ¥ä¼˜é›…åœ°å¤„ç†æ­¤ç±»æƒ…å†µï¼Œè¯¥æ“ä½œå°†åœç”¨è¡¨å•å¹¶é‡ç½®è¯·æ±‚çš„æ’æ§½ã€‚æ­¤ç±»å¯¹è¯çš„ä¸€ä¸ªç¤ºä¾‹æ•…äº‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token list punctuation">*</span> stop<span class="token code keyword">    - utter_ask_continue</span><span class="token list punctuation">*</span> deny<span class="token code keyword">    - action_deactivate_form</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre><p>è¿™æ˜¯<strong>å¼ºçƒˆ</strong>å»ºè®®ä½ å»ºç«‹ä¸€ä¸ªä½¿ç”¨äº¤äº’å¼å­¦ä¹ è¿™äº›æ•…äº‹ã€‚å¦‚æœæ‚¨ç”¨æ‰‹å†™è¿™äº›æ•…äº‹ï¼Œæ‚¨å¯èƒ½ä¼šé”™è¿‡é‡è¦çš„äº‹æƒ…ã€‚è¯·é˜…è¯»â€œ<a href="#">é€šè¿‡è¡¨å•</a> è¿›è¡Œ<a href="#">äº¤äº’å¼å­¦ä¹ â€ï¼Œ</a>ä»¥äº†è§£å¦‚ä½•åœ¨<a href="#">è¡¨å•</a>ä¸­ä½¿ç”¨äº¤äº’å¼å­¦ä¹ ã€‚</p><h3 id="request-slotæ§½ä½"><a href="#request-slotæ§½ä½" class="headerlink" title="request_slotæ§½ä½"></a>request_slotæ§½ä½</h3><p>è¯¥æ’æ§½<code>requested_slot</code>å°†ä½œä¸ºæœªå®Œæˆçš„æ’æ§½è‡ªåŠ¨æ·»åŠ åˆ°åŸŸä¸­ã€‚å¦‚æœè¦ä½¿å…¶å…·æœ‰ç‰¹è‰²ï¼Œåˆ™éœ€è¦å°†å…¶ä½œä¸ºåˆ†ç±»æ’æ§½æ·»åŠ åˆ°åŸŸæ–‡ä»¶ä¸­ã€‚å¦‚æœè¦æ ¹æ®ç”¨æˆ·å½“å‰è¦æ±‚çš„æ’æ§½æ¥ä¸åŒåœ°å¤„ç†ä¸æ„‰å¿«çš„è·¯å¾„ï¼Œåˆ™å¯èƒ½éœ€è¦æ‰§è¡Œæ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„ç”¨æˆ·ç”¨å¦ä¸€ä¸ªé—®é¢˜å›ç­”äº†æœºå™¨äººçš„ä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚<em>æ‚¨ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“è¿™ä¸€ç‚¹ï¼Ÿ</em> å¯¹è¿™ä¸€<code>explain</code>æ„å›¾çš„ååº”å–å†³äºæˆ‘ä»¬åœ¨æ•…äº‹ä¸­æ‰€å¤„çš„ä½ç½®ã€‚åœ¨é¤å…çš„æƒ…å†µä¸‹ï¼Œæ‚¨çš„æ•…äº‹å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> explain cuisine slot</span><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "cuisine"&amp;#125;</span><span class="token list punctuation">*</span> explain<span class="token code keyword">    - utter_explain_cuisine</span><span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - slot&amp;#123;"cuisine": "greek"&amp;#125;</span><span class="token code keyword">    ( ... all other slots the form set ... )</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span><span class="token title important"><span class="token punctuation">##</span> explain num_people slot</span><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "num_people"&amp;#125;</span><span class="token list punctuation">*</span> explain<span class="token code keyword">    - utter_explain_num_people</span><span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - slot&amp;#123;"cuisine": "greek"&amp;#125;</span><span class="token code keyword">    ( ... all other slots the form set ... )</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre><p>åŒæ ·ï¼Œ<strong>å¼ºçƒˆ</strong>å»ºè®®æ‚¨ä½¿ç”¨äº¤äº’å¼å­¦ä¹ æ¥æ„å»ºè¿™äº›æ•…äº‹ã€‚è¯·é˜…è¯»â€œ<a href="#">é€šè¿‡è¡¨å•</a> è¿›è¡Œ<a href="#">äº¤äº’å¼å­¦ä¹ â€ï¼Œ</a>ä»¥äº†è§£å¦‚ä½•åœ¨<a href="#">è¡¨å•</a>ä¸­ä½¿ç”¨äº¤äº’å¼å­¦ä¹ ã€‚</p><h3 id="å¤„ç†æ¡ä»¶æ—¶éš™é€»è¾‘"><a href="#å¤„ç†æ¡ä»¶æ—¶éš™é€»è¾‘" class="headerlink" title="å¤„ç†æ¡ä»¶æ—¶éš™é€»è¾‘"></a>å¤„ç†æ¡ä»¶æ—¶éš™é€»è¾‘</h3><p>é™¤äº†è¯·æ±‚å­—æ®µåˆ—è¡¨ä¹‹å¤–ï¼Œè®¸å¤šè¡¨å•è¿˜éœ€è¦æ›´å¤šçš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰äººè¦æ±‚<code>greek</code>ä½œä¸ºä»–ä»¬çš„èœï¼Œæ‚¨å¯èƒ½æƒ³é—®ä»–ä»¬æ˜¯å¦æ­£åœ¨å¯»æ‰¾å¸¦æˆ·å¤–åº§ä½çš„åœ°æ–¹ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡å°†ä¸€äº›é€»è¾‘å†™å…¥<code>required_slots()</code>æ–¹æ³•æ¥å®ç°æ­¤ç›®çš„ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-python"><code class="language-python">@staticmethod<span class="token keyword">def</span> <span class="token function">required_slots</span><span class="token punctuation">(</span>tracker<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>   <span class="token triple-quoted-string string">"""A list of required slots that the form has to fill"""</span>   <span class="token keyword">if</span> tracker<span class="token punctuation">.</span>get_slot<span class="token punctuation">(</span><span class="token string">'cuisine'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'greek'</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span> <span class="token string">"outdoor_seating"</span><span class="token punctuation">,</span>             <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span>   <span class="token keyword">else</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span>             <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span></code></pre><p>è¿™ç§æœºåˆ¶éå¸¸é€šç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒåœ¨è¡¨å•ä¸­æ„å»ºè®¸å¤šä¸åŒç§ç±»çš„é€»è¾‘ã€‚</p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>é¦–å…ˆå°è¯•ç”¨<code>--debug</code>æ ‡å¿—è¿è¡Œæ‚¨çš„æœºå™¨äººï¼Œæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">å‘½ä»¤è¡Œç•Œé¢</a>ã€‚å¦‚æœæ‚¨åªæ˜¯å…¥é—¨ï¼Œåˆ™å¯èƒ½åªæœ‰å‡ ä¸ªæ‰‹å†™çš„æ•…äº‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œä½†ä½ åº”è¯¥ç»™ä½ çš„æœºå™¨äººç»™äººä»¥æµ‹è¯•<strong>å°½å¿«</strong>ã€‚Rasa Coreçš„æŒ‡å¯¼åŸåˆ™ä¹‹ä¸€æ˜¯ï¼š</p><p>â€‹       ä»çœŸå®çš„å¯¹è¯ä¸­å­¦ä¹ æ¯”è®¾è®¡å‡è®¾çš„å¯¹è¯æ›´ä¸ºé‡è¦</p><p>å› æ­¤ï¼Œåœ¨å°†å…¶æä¾›ç»™æµ‹è¯•äººå‘˜ä¹‹å‰ï¼Œè¯·å‹¿å°è¯•è¦†ç›–æ‰‹å†™æ•…äº‹ä¸­çš„æ‰€æœ‰å¯èƒ½æ€§ã€‚çœŸå®çš„ç”¨æˆ·è¡Œä¸ºå°†æ°¸è¿œè®©æ‚¨æ„Ÿåˆ°æƒŠè®¶ï¼</p><h2 id="æ£€ç´¢æ“ä½œ-1"><a href="#æ£€ç´¢æ“ä½œ-1" class="headerlink" title="æ£€ç´¢æ“ä½œ"></a>æ£€ç´¢æ“ä½œ</h2><blockquote><p>è­¦å‘Š</p><p>æ­¤åŠŸèƒ½æ˜¯å®éªŒæ€§çš„ã€‚æˆ‘ä»¬å¼•å…¥å®éªŒæ€§åŠŸèƒ½ä»¥è·å–ç¤¾åŒºçš„åé¦ˆï¼Œå› æ­¤æˆ‘ä»¬é¼“åŠ±æ‚¨å°è¯•ä¸€ä¸‹ï¼ä½†æ˜¯ï¼Œå°†æ¥å¯èƒ½ä¼šæ›´æ”¹æˆ–åˆ é™¤åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•åé¦ˆï¼ˆæ­£é¢æˆ–è´Ÿé¢ï¼‰ï¼Œè¯·åœ¨<a href="https://forum.rasa.com/">è®ºå›</a>ä¸Šä¸æˆ‘ä»¬åˆ†äº«ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®åŒ…å«æ£€ç´¢åŠ¨ä½œï¼Œå½“å‰æˆ‘ä»¬ä¸æ”¯æŒåœ¨Rasa Xä¸­æ·»åŠ æ–°çš„æ³¨é‡Šã€‚ä¸€æ—¦æ”¶é›†åˆ°è¶³å¤Ÿçš„åé¦ˆå¹¶ä¸”å¯¹åŸ¹è®­æ•°æ®æ ¼å¼æ„Ÿåˆ°æ»¡æ„ï¼Œæˆ‘ä»¬å°†åœ¨Rasa Xä¸­æ·»åŠ å¯¹åŸ¹è®­å“åº”æ£€ç´¢æ¨¡å‹çš„æ”¯æŒã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>è¿™é‡Œæœ‰ä¸€ç¯‡æ·±å…¥çš„åšå®¢æ–‡ç« <a href="https://blog.rasa.com/response-retrieval-models/">ï¼Œ</a>ä»‹ç»å¦‚ä½•ä½¿ç”¨æ£€ç´¢åŠ¨ä½œæ¥å¤„ç†å•å›åˆäº’åŠ¨ã€‚</p></blockquote><ul><li><a href="#">å…³äº</a></li><li><a href="#">è®­ç»ƒæ•°æ®</a></li><li><a href="#">é…ç½®æ–‡ä»¶</a></li><li><a href="#">åŸŸ</a></li><li><a href="#">å¤šä¸ªæ£€ç´¢åŠ¨ä½œ</a></li><li><a href="#">è§£æå“åº”é€‰æ‹©å™¨è¾“å‡º</a></li></ul><h3 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h3><p>æ£€ç´¢åŠ¨ä½œæ—¨åœ¨ç®€åŒ–ä½¿ç”¨<a href="https://legacy-docs-v1.rasa.com/dialogue-elements/small-talk/#small-talk">é—²èŠ</a>å’Œ<a href="https://legacy-docs-v1.rasa.com/dialogue-elements/completing-tasks/#simple-questions">ç®€å•é—®é¢˜çš„å·¥ä½œ</a>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åŠ©æ‰‹å¯ä»¥å¤„ç†100ä¸ªFAQå’Œ50ä¸ªä¸åŒçš„é—²èŠæ„å›¾ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ£€ç´¢æ“ä½œæ¥è¦†ç›–æ‰€æœ‰è¿™äº›å†…å®¹ã€‚ä»å¯¹è¯çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›å•å›åˆçš„äº¤æµéƒ½å¯ä»¥å¾—åˆ°åŒç­‰å¯¹å¾…ï¼Œå› æ­¤å¯ä»¥ç®€åŒ–æ‚¨çš„æ•…äº‹ã€‚</p><p>è€Œä¸æ˜¯åƒè¿™æ ·çš„å¾ˆå¤šæ•…äº‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> weather</span><span class="token list punctuation">*</span> ask_weather   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>weather<span class="token title important"><span class="token punctuation">##</span> introduction</span><span class="token list punctuation">*</span> ask_name   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>introduce<span class="token punctuation">_</span></span>myself...</code></pre><p>æ‚¨å¯ä»¥é€šè¿‡ä¸€ä¸ªæ•…äº‹æ¥æ¶µç›–æ‰€æœ‰è¿™äº›å†…å®¹ï¼Œå…¶ä¸­ä¸Šè¿°æ„å›¾å½’ä¸ºä¸€ä¸ªå…±åŒçš„<code>chitchat</code>æ„å›¾ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span><span class="token list punctuation">*</span> chitchat   <span class="token list punctuation">-</span> respond_chitchat</code></pre><p>æ£€ç´¢åŠ¨ä½œä½¿ç”¨NLUçš„<a href="#">ResponseSelector</a>ç»„ä»¶çš„è¾“å‡ºï¼Œè¯¥ç»„ä»¶å­¦ä¹ æ£€ç´¢æ¨¡å‹ä»¥ä»ç»™å®šç”¨æˆ·æ¶ˆæ¯æ–‡æœ¬çš„å€™é€‰å“åº”åˆ—è¡¨ä¸­é¢„æµ‹æ­£ç¡®çš„å“åº”ã€‚</p><h3 id="è®­ç»ƒæ•°æ®"><a href="#è®­ç»ƒæ•°æ®" class="headerlink" title="è®­ç»ƒæ•°æ®"></a>è®­ç»ƒæ•°æ®</h3><p>é¡¾åæ€ä¹‰ï¼Œæ£€ç´¢åŠ¨ä½œå°†å­¦ä¹ ä»å€™é€‰åˆ—è¡¨ä¸­é€‰æ‹©æ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸å…¶ä»–NLUæ•°æ®ä¸€æ ·ï¼Œæ‚¨éœ€è¦åœ¨ç”¨æˆ·çš„NLUæ–‡ä»¶ä¸­åŒ…æ‹¬ä¸€äº›ç¤ºä¾‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent: chitchat/ask_name</span><span class="token list punctuation">-</span> what's your name<span class="token list punctuation">-</span> who are you?<span class="token list punctuation">-</span> what are you called?<span class="token title important"><span class="token punctuation">##</span> intent: chitchat/ask_weather</span><span class="token list punctuation">-</span> how's weather?<span class="token list punctuation">-</span> is it sunny where you are?</code></pre><p>é¦–å…ˆï¼Œæ‰€æœ‰è¿™äº›ç¤ºä¾‹éƒ½å°†åˆå¹¶ä¸º<code>chitchat</code>NLUå°†é¢„æµ‹çš„å•ä¸ªæ£€ç´¢æ„å›¾ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹-<code>ask_name</code>å’Œä¸­ï¼Œæ‰€æœ‰æ£€ç´¢æ„å›¾éƒ½æœ‰ä¸€ä¸ªåç¼€ï¼Œè¯¥åç¼€æ ‡è¯†äº†æ‚¨åŠ©æ‰‹çš„ç‰¹å®šå“åº”æ–‡æœ¬<code>ask_weather</code>ã€‚åç¼€ç”±<code>/</code>å®šç•Œç¬¦ä¸æ„å›¾åç§°åˆ†éš”</p><p>æ¥ä¸‹æ¥ï¼Œå°†æ‰€æœ‰æ£€ç´¢æ„å›¾çš„å“åº”æ–‡æœ¬åŒ…å«åœ¨<strong>å•ç‹¬çš„</strong>è®­ç»ƒæ•°æ®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º<code>responses.md</code>ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> ask name</span><span class="token list punctuation">*</span> chitchat/ask_name<span class="token code keyword">    - my name is Sara, Rasa's documentation bot!</span><span class="token title important"><span class="token punctuation">##</span> ask weather</span><span class="token list punctuation">*</span> chitchat/ask_weather<span class="token code keyword">    - it's always sunny where I live</span></code></pre><p>æ£€ç´¢æ¨¡å‹ä½œä¸ºNLUè®­ç»ƒæµæ°´çº¿çš„ä¸€éƒ¨åˆ†è¿›è¡Œå•ç‹¬è®­ç»ƒï¼Œä»¥é€‰æ‹©æ­£ç¡®çš„å“åº”ã€‚è¦è®°ä½çš„é‡è¦ä¸€ä»¶äº‹æ˜¯ï¼Œæ£€ç´¢æ¨¡å‹ä½¿ç”¨å“åº”æ¶ˆæ¯çš„æ–‡æœ¬æ¥é€‰æ‹©æ­£ç¡®çš„æ¶ˆæ¯ã€‚å¦‚æœæ›´æ”¹è¿™äº›å“åº”çš„æ–‡æœ¬ï¼Œåˆ™å¿…é¡»é‡æ–°è®­ç»ƒæ‚¨çš„æ£€ç´¢æ¨¡å‹ï¼è¿™æ˜¯æ‚¨åŸŸæ–‡ä»¶ä¸­å“åº”æ¨¡æ¿çš„ä¸»è¦åŒºåˆ«ã€‚</p><blockquote><p>æ³¨æ„</p><p>åŒ…å«å“åº”æ–‡æœ¬çš„æ–‡ä»¶å¿…é¡»ä½œä¸ºå•ç‹¬çš„æ–‡ä»¶å­˜åœ¨äºä¼ é€’ç»™è®­ç»ƒè¿‡ç¨‹çš„è®­ç»ƒæ•°æ®ç›®å½•ä¸­ã€‚å®ƒçš„å†…å®¹ä¸èƒ½æ˜¯åŒ…å«NLUå…¶ä»–ç»„ä»¶çš„è®­ç»ƒæ•°æ®çš„æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>å¦‚ä»¥ä¸Šç¤ºä¾‹æ‰€ç¤ºï¼Œ<code>/</code>ä¿ç•™ç¬¦å·ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä»¥å°†æ£€ç´¢æ„å›¾ä¸å“åº”æ–‡æœ¬æ ‡è¯†ç¬¦åˆ†å¼€ã€‚ç¡®ä¿ä¸è¦ä»¥æ‚¨çš„æ„å›¾çš„åä¹‰ä½¿ç”¨å®ƒã€‚</p></blockquote><h3 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>æ‚¨éœ€è¦åœ¨é…ç½®ä¸­åŒ…æ‹¬<a href="#">ResponseSelector</a>ç»„ä»¶ã€‚è¯¥ç»„ä»¶éœ€è¦æ ‡è®°å™¨ï¼ŒåŠŸèƒ½åŒ–å™¨å’Œæ„å›¾åˆ†ç±»å™¨æ‰èƒ½å¯¹ç”¨æˆ·æ¶ˆæ¯è¿›è¡Œæ“ä½œï¼Œç„¶åæ‰èƒ½é¢„æµ‹å“åº”ï¼Œå› æ­¤åº”å°†è¿™äº›ç»„ä»¶æ”¾åœ¨<code>ResponseSelector</code>NLUé…ç½®ä¸­ã€‚ä¸€ä¸ªä¾‹å­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"<span class="token list punctuation">-</span> name: "ResponseSelector"</code></pre><h3 id="Domain-1"><a href="#Domain-1" class="headerlink" title="Domain"></a>Domain</h3><p>Rasaä½¿ç”¨å‘½åçº¦å®šå°†æ„å›¾åç§°<code>chitchat/ask_name</code> ä¸æ£€ç´¢åŠ¨ä½œè¿›è¡ŒåŒ¹é…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­£ç¡®çš„æ“ä½œåç§°æ˜¯<code>respond_chitchat</code>ã€‚å‰ç¼€<code>respond_</code>æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä»¥å°†å…¶æ ‡è¯†ä¸ºæ£€ç´¢åŠ¨ä½œã€‚å¦ä¸€ä¸ªç¤ºä¾‹-æ­£ç¡®çš„æ“ä½œåç§°<code>faq/ask_policy</code>å°†æ˜¯<code>respond_faq</code> è¦å°†å…¶åŒ…æ‹¬åœ¨æ‚¨çš„åŸŸä¸­ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°æ“ä½œåˆ—è¡¨ä¸­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">actions:  ...  <span class="token list punctuation">-</span> respond_chitchat  <span class="token list punctuation">-</span> respond_faq</code></pre><p>ç¡®ä¿åœ¨é€‰æ‹©æ„å›¾åå¯ä»¥é¢„æµ‹æ£€ç´¢åŠ¨ä½œçš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨â€œ<a href="#">æ˜ å°„ç­–ç•¥â€</a>ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æ‚¨çš„æ•…äº‹ä¸­åŒ…æ‹¬æ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å¤„ç†chitchatä¹‹åé‡å¤ä¸€ä¸ªé—®é¢˜ï¼ˆè¯·å‚é˜…<a href="#">ä¸å¿«ä¹çš„è·¯å¾„</a>ï¼‰</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> interruption</span><span class="token list punctuation">*</span> search_restaurant   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine<span class="token list punctuation">*</span> chitchat   <span class="token list punctuation">-</span> respond_chitchat   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine</code></pre><h3 id="å¤šä¸ªæ£€ç´¢åŠ¨ä½œ"><a href="#å¤šä¸ªæ£€ç´¢åŠ¨ä½œ" class="headerlink" title="å¤šä¸ªæ£€ç´¢åŠ¨ä½œ"></a>å¤šä¸ªæ£€ç´¢åŠ¨ä½œ</h3><p>å¦‚æœæ‚¨çš„åŠ©æ‰‹åŒæ—¶åŒ…å«FAQ<strong>å’Œ</strong>chitchatï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬åˆ†ä¸ºå•ç‹¬çš„æ£€ç´¢æ“ä½œï¼Œä¾‹å¦‚ï¼Œå…·æœ‰è¯¸å¦‚<code>chitchat/ask_weather</code>å’Œçš„æ„å›¾<code>faq/returns_policy</code>ã€‚Rasaæ”¯æŒæ·»åŠ å¤šä¸ª<code>RetrievalActions</code>like<code>respond_chitchat</code>å’Œ<code>respond_returns_policy</code> è‹¥è¦ä¸ºæ¯ç§ç›®çš„è®­ç»ƒå•ç‹¬çš„æ£€ç´¢æ¨¡å‹ï¼Œæ‚¨éœ€è¦<code>ResponseSelector</code> åœ¨é…ç½®ä¸­åŒ…æ‹¬ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"<span class="token list punctuation">-</span> name: "ResponseSelector"  retrieval_intent: chitchat<span class="token list punctuation">-</span> name: "ResponseSelector"  retrieval_intent: faq</code></pre><ul><li><p>æ‚¨ä»ç„¶å¯ä»¥æœ‰ä¸¤ä¸ªå•ç‹¬çš„æ£€ç´¢åŠ¨ä½œï¼Œä½†æ˜¯ä¸¤ä¸ªåŠ¨ä½œå¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªæ¥å…±äº«ç›¸åŒçš„æ£€ç´¢æ¨¡å‹</p><p><code>ResponseSelector</code>ç»„ä»¶å¹¶å°†å…¶ä¿ç•™<code>retrieval_intent</code>ä¸ºé»˜è®¤å€¼ï¼ˆæ— ï¼‰ï¼š</p></li></ul><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"<span class="token list punctuation">-</span> name: "ResponseSelector"</code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†å¯¹æ¥è‡ªä¸¤ä¸ªç¤ºä¾‹çš„å“åº”é€‰æ‹©å™¨è¿›è¡Œè®­ç»ƒ<code>chitchat/{x}</code>ï¼Œ<code>faq/{x}</code>å¹¶<code>default</code>ä»¥NLUè§£æè¾“å‡ºçš„åç§°è¿›è¡Œæ ‡è¯†ã€‚</p><p>åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå…·æœ‰ç‹¬ç«‹çš„æ£€ç´¢æ¨¡å‹å¹¶<strong>æ²¡æœ‰</strong>åšå‡ºæ£€ç´¢æ¯ä¸€ä¸ªåŠ¨ä½œçš„å‡†ç¡®æ€§ä»»ä½•åŒºåˆ«ã€‚å› æ­¤ï¼Œä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å¯¹chitchatå’ŒFAQä½¿ç”¨å•ä¸€çš„æ£€ç´¢æ¨¡å‹ã€‚å¦‚æœè·å¾—ä¸åŒçš„ç»“æœï¼Œè¯·åœ¨<a href="https://forum.rasa.com/">è®ºå›ä¸­</a>å‘Šè¯‰æˆ‘ä»¬ï¼</p><h3 id="è§£æå“åº”é€‰æ‹©å™¨è¾“å‡º"><a href="#è§£æå“åº”é€‰æ‹©å™¨è¾“å‡º" class="headerlink" title="è§£æå“åº”é€‰æ‹©å™¨è¾“å‡º"></a>è§£æå“åº”é€‰æ‹©å™¨è¾“å‡º</h3><p>æ¥è‡ªNLUçš„è§£æè¾“å‡ºå°†å…·æœ‰ä¸€ä¸ªåä¸ºå±æ€§ï¼Œ<code>response_selector</code>å…¶ä¸­åŒ…å«æ¯ä¸ªå“åº”é€‰æ‹©å™¨çš„è¾“å‡ºã€‚æ¯ä¸ªå“åº”é€‰æ‹©å™¨å‡ç”±<code>retrieval_intent</code>è¯¥å“åº”é€‰æ‹©å™¨çš„å‚æ•°æ ‡è¯†ï¼Œå¹¶å­˜å‚¨ä¸¤ä¸ªå±æ€§-</p><ul><li><code>response</code>ï¼šé¢„æµ‹çš„å“åº”æ–‡æœ¬å’Œé¢„æµ‹çš„ç½®ä¿¡åº¦ã€‚</li><li><code>ranking</code>ï¼šä»¥åå¤§å€™é€‰ç­”æ¡ˆçš„ä¿¡å¿ƒæ’åã€‚</li></ul><p>ç»“æœç¤ºä¾‹ï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"What is the recommend python version to install?"</span><span class="token punctuation">,</span>    <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"faq"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"faq"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.1416153159565678</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"response_selector"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"faq"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"response"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.7356462617</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Supports 3.5, 3.6 and 3.7, recommended version is 3.6"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        <span class="token property">"ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.7356462617</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Supports 3.5, 3.6 and 3.7, recommended version is 3.6"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>            &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.2134543431</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"You can ask me about how to get started"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token punctuation">]</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœå°†<code>retrieval_intent</code>ç‰¹å®šå“åº”é€‰æ‹©å™¨çš„å‚æ•°ä¿ç•™ä¸ºå…¶é»˜è®¤å€¼ï¼Œåˆ™å°†<code>default</code>åœ¨è¿”å›çš„è¾“å‡ºä¸­æ ‡è¯†ç›¸åº”çš„å“åº”é€‰æ‹©å™¨ã€‚</p><h2 id="äº¤äº’å­¦ä¹ "><a href="#äº¤äº’å­¦ä¹ " class="headerlink" title="äº¤äº’å­¦ä¹ "></a>äº¤äº’å­¦ä¹ </h2><p>æ­¤é¡µé¢æ˜¾ç¤ºäº†å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨äº¤äº’å¼å­¦ä¹ ã€‚</p><p>åœ¨äº¤äº’å¼å­¦ä¹ æ¨¡å¼ä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ä¸æœºå™¨äººèŠå¤©æ—¶å‘å…¶æä¾›åé¦ˆã€‚è¿™æ˜¯æ¢ç´¢æ‚¨çš„æœºå™¨äººå¯ä»¥åšä»€ä¹ˆçš„æœ‰åŠ›æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯ä¿®æ­£å…¶é”™è¯¯çš„æœ€ç®€å•æ–¹æ³•ã€‚åŸºäºæœºå™¨å­¦ä¹ çš„å¯¹è¯çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯ï¼Œå½“æ‚¨çš„æœºå™¨äººè¿˜ä¸çŸ¥é“å¦‚ä½•åšæ—¶ï¼Œæ‚¨å¯ä»¥æ•™å®ƒï¼æœ‰äººå°†æ­¤<a href="https://medium.com/@karpathy/software-2-0-a64152b37c35">è½¯ä»¶</a>ç§°ä¸º<a href="https://medium.com/@karpathy/software-2-0-a64152b37c35">2.0</a>ã€‚</p><blockquote><p>æ³¨æ„</p><p>Rasa Xæä¾›äº†ç”¨äºäº¤äº’å¼å­¦ä¹ çš„UIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•ç”¨æˆ·å¯¹è¯ä½œä¸ºèµ·ç‚¹ã€‚è¯·å‚é˜… Rasa Xæ–‡æ¡£ä¸­çš„ä¸<a href="#">æœºå™¨äººå¯¹è¯</a>ã€‚</p></blockquote><ul><li><a href="#">è¿›è¡Œäº’åŠ¨å­¦ä¹ </a></li><li><a href="#">æä¾›æœ‰å…³é”™è¯¯çš„åé¦ˆ</a></li><li><a href="#">å¯¹è¯å¯è§†åŒ–</a></li><li><a href="#">è¡¨æ ¼äº’åŠ¨å­¦ä¹ </a><ul><li><a href="#">è¯¥<code>form:</code>å‰ç¼€</a></li><li><a href="#">è¾“å…¥éªŒè¯</a></li></ul></li></ul><h3 id="è¿è¡Œäº’åŠ¨å­¦ä¹ "><a href="#è¿è¡Œäº’åŠ¨å­¦ä¹ " class="headerlink" title="è¿è¡Œäº’åŠ¨å­¦ä¹ "></a>è¿è¡Œäº’åŠ¨å­¦ä¹ </h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¼€å§‹äº¤äº’å¼å­¦ä¹ ï¼š</p><pre class=" language-shell"><code class="language-shell">rasa run actions --actions actions&rasa interactive \  -m models/20190515-135859.tar.gz \  --endpoints endpoints.yml</code></pre><p>ç¬¬ä¸€æ¡å‘½ä»¤å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨ï¼ˆè¯·å‚é˜…<a href="#">è‡ªå®šä¹‰åŠ¨ä½œ</a>ï¼‰ã€‚</p><p>ç¬¬äºŒä¸ªå‘½ä»¤å¯åŠ¨äº¤äº’å¼å­¦ä¹ æ¨¡å¼ã€‚</p><p>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼ŒRasaå°†è¦æ±‚æ‚¨ç¡®è®¤NLUå’ŒCoreæ‰€åšçš„æ¯ä¸ªé¢„æµ‹ï¼Œç„¶åå†ç»§ç»­ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><pre class=" language-text"><code class="language-text">Bot loaded. Type a message and press enter (use '/stop' to exit).? Next user input:  hello? Is the NLU classification for 'hello' with intent 'hello' correct?  Yes------Chat History #    Bot                        Youâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1    action_listenâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2                                    hello                         intent: hello 1.00------? The bot wants to run 'utter_greet', correct?  (Y/n)        </code></pre><p>èŠå¤©å†å²è®°å½•å’Œæ—¶æ®µå€¼ä¼šæ‰“å°åˆ°å±å¹•ä¸Šï¼Œè¿™åº”è¯¥æ˜¯å†³å®šæ­£ç¡®çš„ä¸‹ä¸€æ­¥æ“ä½œæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœºå™¨äººé€‰æ‹©äº†æ­£ç¡®çš„æ“ä½œï¼ˆ<code>utter_greet</code>ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬é”®å…¥<code>y</code>ã€‚ç„¶åæˆ‘ä»¬<code>y</code>å†æ¬¡é”®å…¥ï¼Œå› ä¸º<code>action_listen</code>é—®å€™è¯­ä¹‹åçš„æ“ä½œæ˜¯æ­£ç¡®çš„ã€‚æˆ‘ä»¬ç»§ç»­è¯¥å¾ªç¯ï¼Œä¸æœºå™¨äººèŠå¤©ï¼Œç›´åˆ°æœºå™¨äººé€‰æ‹©äº†é”™è¯¯çš„æ“ä½œã€‚</p><h3 id="æä¾›äº†å¯¹é”™è¯¯çš„åé¦ˆ"><a href="#æä¾›äº†å¯¹é”™è¯¯çš„åé¦ˆ" class="headerlink" title="æä¾›äº†å¯¹é”™è¯¯çš„åé¦ˆ"></a>æä¾›äº†å¯¹é”™è¯¯çš„åé¦ˆ</h3><p>å¯¹äºæœ¬ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥<code>concertbot</code>ç¤ºä¾‹ï¼Œå› æ­¤è¯·ç¡®ä¿æ‚¨å…·æœ‰è¯¥åŸŸå’Œæ•°æ®ã€‚æ‚¨å¯ä»¥ä»æˆ‘ä»¬çš„<a href="https://github.com/RasaHQ/rasa/tree/master/examples/concertbot">github repo</a>ä¸‹è½½æ•°æ®ã€‚</p><p>å¦‚æœæ‚¨è¯¢é—®<code>/search_concerts</code>ï¼Œåˆ™æ¼«æ¸¸å™¨åº”æå‡ºå»ºè®® <code>action_search_concerts</code>ï¼Œç„¶å<code>action_listen</code>ï¼ˆè¯¥ç­–ç•¥å°†åœ¨æ“ä½œåç§°æ—è¾¹æ˜¾ç¤ºè¯¥ç­–ç•¥é€‰æ‹©å…¶ä¸‹ä¸€ä¸ªæ“ä½œçš„ç½®ä¿¡åº¦ï¼‰ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¾“å…¥<code>/compare_reviews</code>ä¸‹ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ã€‚æœºå™¨äºº<em>å¯èƒ½ä¼š</em>ä»ä¸¤ç§å¯èƒ½æ€§ä¸­é€‰æ‹©é”™è¯¯çš„ä¸€ç§ï¼ˆå–å†³äºè®­ç»ƒçš„è¿è¡Œï¼Œå®ƒå¯èƒ½ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼‰ï¼š</p><pre class=" language-latex"><code class="language-latex">------Chat History #    Bot                                           Youâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1    action_listenâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2                                            /search_concerts                                  intent: search_concerts 1.00â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3    action_search_concerts 0.72      action_listen 0.78â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4                                            /compare_reviews                                  intent: compare_reviews 1.00Current slots:  concerts: None, venues: None------? The bot wants to run 'action_show_concert_reviews', correct?  No</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬é”®å…¥<code>n</code>ï¼Œå› ä¸ºå®ƒé€‰æ‹©äº†é”™è¯¯çš„æ“ä½œï¼Œç„¶åå‡ºç°ä¸€ä¸ªæ–°çš„æç¤ºï¼Œè¦æ±‚æ­£ç¡®çš„æ“ä½œã€‚è¿™ä¹Ÿæ˜¾ç¤ºäº†æ¨¡å‹åˆ†é…ç»™æ¯ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ï¼š</p><pre class=" language-text"><code class="language-text">? What is the next action of the bot?  (Use arrow keys) â¯ 0.53 action_show_venue_reviews   0.46 action_show_concert_reviews   0.00 utter_goodbye   0.00 action_search_concerts   0.00 utter_greet   0.00 action_search_venues   0.00 action_listen   0.00 utter_youarewelcome   0.00 utter_default   0.00 action_default_fallback   0.00 action_restart</code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœºå™¨äººåº”è¯¥<code>action_show_concert_reviews</code>ï¼ˆè€Œä¸æ˜¯åœºåœ°è¯„è®ºï¼ï¼‰æ¥é€‰æ‹©è¯¥åŠ¨ä½œã€‚</p><p>ç°åœ¨ï¼Œåªè¦æˆ‘ä»¬æ„¿æ„è¿›è¡Œæ›´é•¿çš„å¯¹è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä¸æœºå™¨äººå¯¹è¯ã€‚æ‚¨å¯ä»¥éšæ—¶æŒ‰<code>Ctrl-C</code>ï¼Œè¯¥botä¼šä¸ºæ‚¨æä¾›é€€å‡ºé€‰é¡¹ã€‚æ‚¨å¯ä»¥å°†æ–°åˆ›å»ºçš„æ•…äº‹å’ŒNLUæ•°æ®å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæä¾›åé¦ˆæ—¶å‡ºé”™ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸Šä¸€æ­¥ã€‚</p><p>ç¡®ä¿å°†è½¬å‚¨çš„æ•…äº‹å’ŒNLUç¤ºä¾‹ä¸æ‚¨çš„åŸå§‹åŸ¹è®­æ•°æ®ç»“åˆèµ·æ¥ï¼Œä»¥è¿›è¡Œä¸‹ä¸€æ¬¡è®­ç»ƒã€‚</p><h3 id="å¯¹è¯çš„å¯è§†åŒ–"><a href="#å¯¹è¯çš„å¯è§†åŒ–" class="headerlink" title="å¯¹è¯çš„å¯è§†åŒ–"></a>å¯¹è¯çš„å¯è§†åŒ–</h3><p>åœ¨äº¤äº’å¼å­¦ä¹ æœŸé—´ï¼ŒRasaå°†ä»è®­ç»ƒæ•°æ®ä¸­ç»˜åˆ¶å½“å‰å¯¹è¯å’Œä¸€äº›ç±»ä¼¼å¯¹è¯ï¼Œä»¥å¸®åŠ©æ‚¨è·Ÿè¸ªè‡ªå·±çš„ä½ç½®ã€‚</p><p>å¼€å§‹äº¤äº’å¼å­¦ä¹ åï¼Œæ‚¨å¯ä»¥åœ¨<a href="http://localhost:5005/visualization.html">httpï¼š// localhostï¼š5005 / visualization.htmlä¸Š</a>æŸ¥çœ‹å¯è§†åŒ–ã€‚</p><p>è¦è·³è¿‡å¯è§†åŒ–ï¼Œè¯·è¿è¡Œã€‚<code>rasa interactive --skip-visualization</code></p><p><img src="/2020/10/05/rasa-wen-dang-zhi-nan-14/1.gif"></p><h3 id="è¡¨å•äº’åŠ¨å­¦ä¹ "><a href="#è¡¨å•äº’åŠ¨å­¦ä¹ " class="headerlink" title="è¡¨å•äº’åŠ¨å­¦ä¹ "></a>è¡¨å•äº’åŠ¨å­¦ä¹ </h3><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯FormActionï¼Œåˆ™åœ¨ä½¿ç”¨äº¤äº’å¼å­¦ä¹ æ—¶è¿˜éœ€è¦è®°ä½ä¸€äº›å…¶ä»–äº‹é¡¹ã€‚</p><h4 id="form-å‰ç¼€"><a href="#form-å‰ç¼€" class="headerlink" title="form:å‰ç¼€"></a><code>form:</code>å‰ç¼€</h4><p>è¡¨å•é€»è¾‘æ˜¯ç”±æ‚¨çš„<code>FormAction</code>ç­çº§è€Œä¸æ˜¯æ•…äº‹æ¥æè¿°çš„ã€‚æœºå™¨å­¦ä¹ ç­–ç•¥åº”è¯¥ä¸å¿…å­¦ä¹ è¿™ç§è¡Œä¸ºï¼Œå¹¶ä¸”å¦‚æœä»¥åè¦æ›´æ”¹è¡¨å•æ“ä½œï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ·»åŠ æˆ–åˆ é™¤æ‰€éœ€çš„æ’æ§½ï¼‰ä¹Ÿä¸è¦æ„Ÿåˆ°å›°æƒ‘ã€‚å½“æ‚¨ä½¿ç”¨äº¤äº’å¼å­¦ä¹ ç”ŸæˆåŒ…å«è¡¨å•çš„æ•…äº‹æ—¶ï¼Œè¡¨å•å¤„ç†çš„å¯¹è¯æ­¥éª¤ä¼šè·å¾—<code>form:</code>å‰ç¼€ã€‚è¿™å‘Šè¯‰Rasa Coreåœ¨è®­ç»ƒå…¶ä»–ç­–ç•¥æ—¶å¿½ç•¥è¿™äº›æ­¥éª¤ã€‚æ‚¨ä¸å¿…åœ¨è¿™é‡Œåšä»»ä½•ç‰¹åˆ«çš„äº‹æƒ…ï¼Œ<a href="https://legacy-docs-v1.rasa.com/core/forms/#forms">Forms</a>ç»™å‡ºçš„åŸºæœ¬æ•…äº‹ä»ç„¶æ¶µç›–äº†è¡¨å•çš„æ‰€æœ‰å¿«ä¹è·¯å¾„ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> request_restaurant<span class="token code keyword">    - restaurant_form</span><span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "cuisine"&amp;#125;</span><span class="token list punctuation">*</span> form: inform<span class="token entity" title="&#123;">&amp;#123;</span>"cuisine": "mexican"<span class="token entity" title="&#125;">&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"cuisine": "mexican"&amp;#125;</span><span class="token code keyword">    - form: restaurant_form</span><span class="token code keyword">    - slot&amp;#123;"cuisine": "mexican"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "num_people"&amp;#125;</span><span class="token list punctuation">*</span> form: inform<span class="token entity" title="&#123;">&amp;#123;</span>"number": "2"<span class="token entity" title="&#125;">&amp;#125;</span><span class="token code keyword">    - form: restaurant_form</span><span class="token code keyword">    - slot&amp;#123;"num_people": "2"&amp;#125;</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": null&amp;#125;</span><span class="token code keyword">    - utter_slots_values</span></code></pre><h4 id="è¾“å…¥éªŒè¯"><a href="#è¾“å…¥éªŒè¯" class="headerlink" title="è¾“å…¥éªŒè¯"></a>è¾“å…¥éªŒè¯</h4><p>æ¯æ¬¡ç”¨æˆ·ä½¿ç”¨è¯·æ±‚çš„æ’æ§½æˆ–ä»»ä½•æ‰€éœ€çš„æ’æ§½ä»¥å¤–çš„<em>å…¶ä»–å†…å®¹è¿›è¡Œ</em>å“åº”æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šè¯¢é—®æ‚¨æ˜¯å¦è¦è®©è¡¨å•æ“ä½œåœ¨è¿”å›è¡¨å•æ—¶å°è¯•ä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–ä¸€ä¸ªæ’æ§½ã€‚æœ€å¥½ç”¨å’Œç¤ºä¾‹æ¥è§£é‡Šï¼š</p><pre class=" language-text"><code class="language-text"> 7    restaurant_form 1.00      slot&#123;"num_people": "3"&#125;      slot&#123;"requested_slot": "outdoor_seating"&#125;      do you want to sit outside?      action_listen 1.00â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 8                                                                             /stop                                                                   intent: stop 1.00â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 9    utter_ask_continue 1.00      do you want to continue?      action_listen 1.00â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10                                                                          /affirm                                                                 intent: affirm 1.00Current slots:    cuisine: greek, feedback: None, num_people: 3, outdoor_seating: None,  preferences: None, requested_slot: outdoor_seating------2018-11-05 21:36:53 DEBUG    rasa.core.tracker_store  - Recreating tracker for id 'default'? The bot wants to run 'restaurant_form', correct?  Yes2018-11-05 21:37:08 DEBUG    rasa.core.tracker_store  - Recreating tracker for id 'default'? Should 'restaurant_form' validate user input to fill the slot 'outdoor_seating'?  (Y/n)</code></pre><p>åœ¨è¿™é‡Œï¼Œç”¨æˆ·è¦æ±‚åœæ­¢è¡¨å•ï¼Œè€Œæ¼«æ¸¸å™¨åˆ™è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šä¸æƒ³ç»§ç»­ã€‚ç”¨æˆ·è¯´ä»–ä»¬æƒ³ç»§ç»­ï¼ˆ<code>/affirm</code>æ„å›¾ï¼‰ã€‚è¿™é‡Œ<code>outdoor_seating</code>æœ‰ä¸€ä¸ª<code>from_intent</code>æ’æ§½æ˜ å°„ï¼ˆ<code>/affirm</code>æ„å›¾æ˜ å°„åˆ°<code>True</code>ï¼‰ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ­¤ç”¨æˆ·è¾“å…¥æ¥å¡«å……è¯¥æ’æ§½ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·åªæ˜¯åœ¨å›ç­”â€œæ‚¨è¦ç»§ç»­å—ï¼Ÿâ€ é—®é¢˜ï¼Œå› æ­¤é€‰æ‹©<code>n</code>ï¼Œåˆ™ä¸åº”éªŒè¯ç”¨æˆ·è¾“å…¥ã€‚æœºå™¨äººéšåå°†ç»§ç»­è¦æ±‚è¯¥ <code>outdoor_seating</code>æ’æ§½ã€‚</p><blockquote><p>è­¦å‘Š</p><p>å¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®ä¸­æœ‰ä¸€ä¸ªçŸ›ç›¾çš„æ•…äº‹ï¼Œå³æ‚¨åªæ˜¯é€‰æ‹©éªŒè¯è¾“å…¥ï¼ˆæ„å‘³ç€å®ƒå°†ä»¥<code>forms:</code>å‰ç¼€æ‰“å°ï¼‰ï¼Œä½†æ˜¯æ‚¨çš„æ•…äº‹æ–‡ä»¶ä¸­åŒ…å«äº†æ‚¨ä¸éªŒè¯è¾“å…¥çš„ç›¸åŒæ•…äº‹ï¼ˆæ„å‘³ç€æ²¡æœ‰è¾“å…¥ï¼‰è¯¥<code>forms:</code>å‰ç¼€ï¼‰ï¼Œä½ å°†éœ€è¦ç¡®ä¿æ¶ˆé™¤è¿™ç§å†²çªçš„æ•…äº‹ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œä¼šå‡ºç°è­¦å‘Šæç¤ºï¼Œæé†’æ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p><strong>è­¦å‘Šï¼šFormPolicyæ ¹æ®ä»¥å‰çš„åŸ¹è®­ç»éªŒé¢„æµ‹ä¸ä¼šè¿›è¡Œè¡¨å•éªŒè¯ã€‚ç¡®ä¿ä»è®­ç»ƒæ•°æ®ä¸­åˆ é™¤çŸ›ç›¾çš„æ•…äº‹</strong></p><p>åˆ é™¤è¯¥æ•…äº‹åï¼Œæ‚¨å¯ä»¥æŒ‰Enteré”®å¹¶ç»§ç»­è¿›è¡Œäº¤äº’å¼å­¦ä¹ </p></blockquote><h2 id="FallbackåŠ¨ä½œ"><a href="#FallbackåŠ¨ä½œ" class="headerlink" title="FallbackåŠ¨ä½œ"></a>FallbackåŠ¨ä½œ</h2><p>æœ‰æ—¶æ‚¨æƒ³æ¢å¤ä¸ºå¤‡ç”¨æ“ä½œï¼Œä¾‹å¦‚å›ç­” â€œå¯¹ä¸èµ·ï¼Œæˆ‘ä¸æ˜ç™½â€ã€‚æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ æ— è®ºæ˜¯å¤„ç†å›é€€çš„æƒ…å†µä¸‹<code>FallbackPolicy</code>æˆ–<code>TwoStageFallbackPolicy</code>æ‚¨çš„ä¿å•åˆå¥ã€‚</p><h2 id="Fallbackç­–ç•¥"><a href="#Fallbackç­–ç•¥" class="headerlink" title="Fallbackç­–ç•¥"></a>Fallbackç­–ç•¥</h2><p>è¯¥<code>FallbackPolicy</code>æœ‰ä¸€ä¸ªå›é€€æ“ä½œï¼Œå¦‚æœæ„å›¾è¯†åˆ«ä¸‹æ–¹æœ‰ä¿¡å¿ƒï¼Œè¿™å°†è¢«æ‰§è¡Œ<code>nlu_threshold</code> æˆ–è€…å¦‚æœæ²¡æœ‰å¯¹è¯æ”¿ç­–çš„é¢„æµ‹æœ‰ä¿¡å¿ƒçš„ä½œç”¨å¤§äº<code>core_threshold</code>ã€‚</p><p>é˜ˆå€¼å’Œå›é€€æ“ä½œå¯ä»¥åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­ä½œä¸ºçš„å‚æ•°è¿›è¡Œè°ƒæ•´<code>FallbackPolicy</code>ã€‚</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: "FallbackPolicy"<span class="token code keyword">    nlu_threshold: 0.4</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_action_name: "action_default_fallback"</span></code></pre><p><code>action_default_fallback</code>æ˜¯Rasa Coreä¸­çš„é»˜è®¤æ“ä½œï¼Œå®ƒå°†<code>utter_default</code>å“åº”å‘é€ ç»™ç”¨æˆ·ã€‚ç¡®ä¿<code>utter_default</code>åœ¨æ‚¨çš„åŸŸæ–‡ä»¶ä¸­æŒ‡å®šã€‚å®ƒè¿˜å°†è¿˜åŸåˆ°å¯¼è‡´å›é€€çš„ç”¨æˆ·æ¶ˆæ¯ä¹‹å‰çš„ä¼šè¯çŠ¶æ€ï¼Œä»è€Œä¸ä¼šå½±å“å¯¹æœªæ¥æ“ä½œçš„é¢„æµ‹ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹æ“ä½œçš„æ¥æºï¼š</p><ul><li><p><em>ç±»</em><code>rasa.core.actions.action.``ActionDefaultFallback</code></p><p>æ‰§è¡Œåå¤‡æ“ä½œå¹¶è¿”å›åˆ°å¯¹è¯çš„å…ˆå‰çŠ¶æ€</p></li></ul><p>æ‚¨è¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œä»¥ç”¨ä½œåå¤‡å¹¿å‘Šï¼ˆæœ‰å…³<a href="#">è‡ªå®šä¹‰æ“ä½œ</a>çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="#">è‡ª</a>å®šä¹‰æ“ä½œï¼‰ã€‚å¦‚æœè¿™æ ·åšï¼Œè¯·ç¡®ä¿å°†è‡ªå®šä¹‰åå¤‡æ“ä½œä¼ é€’åˆ°<code>FallbackPolicy</code>ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: "FallbackPolicy"<span class="token code keyword">    nlu_threshold: 0.4</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_action_name: "my_fallback_action"</span></code></pre><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨çš„è‡ªå®šä¹‰åå¤‡æ“ä½œæœªè¿”å›<code>UserUtteranceReverted</code>äº‹ä»¶ï¼Œåˆ™æœºå™¨äººçš„ä¸‹ä¸€ä¸ªé¢„æµ‹å¯èƒ½ä¼šå˜å¾—ä¸å‡†ç¡®ï¼Œå› ä¸ºæ‚¨çš„æ•…äº‹ä¸­å¾ˆå¯èƒ½æ²¡æœ‰åå¤‡æ“ä½œã€‚</p></blockquote><p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç‰¹å®šçš„æ„å›¾ï¼ˆå‡è®¾å®ƒç§°ä¸ºï¼‰<code>out_of_scope</code>ï¼Œå®ƒåº”è¯¥å§‹ç»ˆè§¦å‘åå¤‡æ“ä½œï¼Œåˆ™åº”å°†å…¶æ·»åŠ ä¸ºæ•…äº‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> fallback story</span><span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>default<span class="token punctuation">_</span></span>fallback</code></pre><h3 id="ä¸¤é˜¶æ®µå›é€€ç­–ç•¥-1"><a href="#ä¸¤é˜¶æ®µå›é€€ç­–ç•¥-1" class="headerlink" title="ä¸¤é˜¶æ®µå›é€€ç­–ç•¥"></a>ä¸¤é˜¶æ®µå›é€€ç­–ç•¥</h3><p>æ‰€è¿°<code>TwoStageFallbackPolicy</code>æ‰‹æŸ„ä½NLUä¿¡å¿ƒåœ¨å¤šä¸ªé˜¶æ®µä¸­é€šè¿‡å°è¯•æ¥æ¶ˆé™¤æ­§ä¹‰æ‰€è¿°ç”¨æˆ·è¾“å…¥ï¼ˆä½èŠ¯çš„ä¿¡å¿ƒåœ¨ç›¸åŒçš„æ–¹å¼å¤„ç†<code>FallbackPolicy</code>ï¼‰ã€‚</p><ul><li>å¦‚æœNLUé¢„æµ‹çš„ç½®ä¿¡åº¦å¾—åˆ†ä½ï¼Œåˆ™è¦æ±‚ç”¨æˆ·ç¡®è®¤æ„å›¾çš„åˆ†ç±»ã€‚ï¼ˆé»˜è®¤æ“ä½œï¼š <code>action_default_ask_affirmation</code>ï¼‰<ul><li>å¦‚æœä»–ä»¬è‚¯å®šäº†ï¼Œé‚£ä¹ˆæ•…äº‹å°†ç»§ç»­ï¼Œå°±å¥½åƒä»ä¸€å¼€å§‹å°±å¯¹æ„å›¾è¿›è¡Œäº†é«˜åº¦è‡ªä¿¡çš„åˆ†ç±»ã€‚</li><li>å¦‚æœä»–ä»¬æ‹’ç»ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¡¨è¾¾ä»–ä»¬çš„æ¶ˆæ¯ã€‚</li></ul></li><li>æ”¹å†™ï¼ˆé»˜è®¤æ“ä½œï¼š<code>action_default_ask_rephrase</code>ï¼‰<ul><li>å¦‚æœé‡æ–°è¡¨è¾¾æ„å›¾çš„åˆ†ç±»æ˜¯ç¡®å®šçš„ï¼Œåˆ™æ•…äº‹å°†ç»§ç»­ï¼Œå°±å¥½åƒç”¨æˆ·ä»ä¸€å¼€å§‹å°±å…·æœ‰æ­¤æ„å›¾ã€‚</li><li>å¦‚æœæªè¾çš„æ„å›¾æ²¡æœ‰è¢«é«˜å¯ä¿¡åº¦åˆ†ç±»ï¼Œåˆ™è¦æ±‚ç”¨æˆ·ç¡®è®¤åˆ†ç±»çš„æ„å›¾ã€‚</li></ul></li><li>å…¶æ¬¡è‚¯å®šï¼ˆé»˜è®¤æ“ä½œï¼š<code>action_default_ask_affirmation</code>ï¼‰<ul><li>å¦‚æœç”¨æˆ·ç¡®è®¤äº†æ­¤æ„å›¾ï¼Œåˆ™æ•…äº‹å°†ç»§ç»­ï¼Œå°±åƒç”¨æˆ·ä»ä¸€å¼€å§‹å°±å…·æœ‰æ­¤æ„å›¾ä¸€æ ·ã€‚</li><li>å¦‚æœç”¨æˆ·æ‹’ç»ï¼Œåˆ™å°†åŸå§‹æ„å›¾åˆ†ç±»ä¸ºæŒ‡å®šçš„ <code>deny_suggestion_intent_name</code>ï¼Œå¹¶<code>fallback_nlu_action_name</code>è§¦å‘æœ€ç»ˆçš„åå¤‡æ“ä½œ ï¼ˆä¾‹å¦‚ï¼Œç§»äº¤ç»™äººç±»ï¼‰ã€‚</li></ul></li></ul><p>èæ ¸å¿ƒæä¾›äº†é»˜è®¤çš„å®ç° <code>action_default_ask_affirmation</code>å’Œ<code>action_default_ask_rephrase</code>ã€‚æ“ä½œçš„é»˜è®¤å®ç°ä¼š<code>action_default_ask_rephrase</code>å‘å‡ºå“åº”<code>utter_ask_rephrase</code>ï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨åŸŸæ–‡ä»¶ä¸­æŒ‡å®šæ­¤å“åº”ã€‚è¿™ä¸¤ä¸ªåŠ¨ä½œçš„å®ç°éƒ½å¯ä»¥ç”¨<a href="#">è‡ªå®šä¹‰åŠ¨ä½œ</a>è¦†ç›–ã€‚</p><p>æ‚¨å¯ä»¥<code>TwoStageFallbackPolicy</code>åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­å°†æ ¸å¿ƒå›é€€æ“ä½œä»¥åŠæœ€ç»ˆçš„NLUå›é€€æ“ä½œæŒ‡å®šä¸ºå‚æ•°ã€‚</p><pre class=" language-markdown"><code class="language-markdown">policies:  <span class="token list punctuation">-</span> name: TwoStageFallbackPolicy<span class="token code keyword">    nlu_threshold: 0.3</span><span class="token code keyword">    core_threshold: 0.3</span><span class="token code keyword">    fallback_core_action_name: "action_default_fallback"</span><span class="token code keyword">    fallback_nlu_action_name: "action_default_fallback"</span><span class="token code keyword">    deny_suggestion_intent_name: "out_of_scope"</span></code></pre><h2 id="çŸ¥è¯†åº“æ“ä½œ"><a href="#çŸ¥è¯†åº“æ“ä½œ" class="headerlink" title="çŸ¥è¯†åº“æ“ä½œ"></a>çŸ¥è¯†åº“æ“ä½œ</h2><blockquote><p>è­¦å‘Š</p><p>æ­¤åŠŸèƒ½æ˜¯å®éªŒæ€§çš„ã€‚æˆ‘ä»¬å¼•å…¥å®éªŒæ€§åŠŸèƒ½ä»¥è·å–ç¤¾åŒºçš„åé¦ˆï¼Œå› æ­¤æˆ‘ä»¬é¼“åŠ±æ‚¨å°è¯•ä¸€ä¸‹ï¼ä½†æ˜¯ï¼Œå°†æ¥å¯èƒ½ä¼šæ›´æ”¹æˆ–åˆ é™¤åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•åé¦ˆï¼ˆæ­£é¢æˆ–è´Ÿé¢ï¼‰ï¼Œè¯·åœ¨<a href="https://forum.rasa.com/">è®ºå›</a>ä¸Šä¸æˆ‘ä»¬åˆ†äº«ã€‚</p></blockquote><ul><li><a href="#">ä½¿ç”¨ <code>ActionQueryKnowledgeBase</code></a><ul><li><a href="#">å»ºç«‹çŸ¥è¯†åº“</a></li><li><a href="#">å®šä¹‰NLUæ•°æ®</a></li><li><a href="#">åˆ›å»ºä¸€ä¸ªæ“ä½œæ¥æŸ¥è¯¢æ‚¨çš„çŸ¥è¯†åº“</a></li></ul></li><li><a href="#">æ€ä¹ˆè¿è¡Œçš„</a><ul><li><a href="#">åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡</a></li><li><a href="#">åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡çš„å±æ€§</a></li><li><a href="#">è§£å†³æåŠ</a></li></ul></li><li><a href="#">å®¢åˆ¶åŒ–</a><ul><li><a href="#">å®¢åˆ¶åŒ– <code>ActionQueryKnowledgeBase</code></a></li><li><a href="#">åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œ</a></li><li><a href="#">è‡ªå®šä¹‰ <code>InMemoryKnowledgeBase</code></a></li><li><a href="#">åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“</a></li></ul></li></ul><p>çŸ¥è¯†åº“æ“ä½œä½¿æ‚¨èƒ½å¤Ÿå¤„ç†ä»¥ä¸‹ç±»å‹çš„å¯¹è¯ï¼š</p><p><img src="/2020/10/05/rasa-wen-dang-zhi-nan-14/12.png"></p><p>ä¼šè¯å¼AIä¸­çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ï¼Œç”¨æˆ·ä¸ä»…é€šè¿‡åç§°æ¥å¼•ç”¨æŸäº›å¯¹è±¡ï¼Œè€Œä¸”è¿˜ä½¿ç”¨è¯¸å¦‚â€œç¬¬ä¸€ä¸ªâ€æˆ–â€œå®ƒâ€ä¹‹ç±»çš„å¼•ç”¨æœ¯è¯­ã€‚æˆ‘ä»¬éœ€è¦è·Ÿè¸ªæä¾›çš„ä¿¡æ¯ï¼Œä»¥è§£å†³å¯¹æ­£ç¡®å¯¹è±¡çš„è¿™äº›æåŠã€‚</p><p>æ­¤å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›åœ¨å¯¹è¯è¿‡ç¨‹ä¸­è·å–æœ‰å…³å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œé¤å…æ˜¯å¦æœ‰æˆ·å¤–åº§ä½ï¼Œæˆ–æœ‰å¤šæ˜‚è´µã€‚ä¸ºäº†å“åº”é‚£äº›ç”¨æˆ·è¯·æ±‚ï¼Œéœ€è¦æœ‰å…³é¤å…åŸŸçš„çŸ¥è¯†ã€‚ç”±äºä¿¡æ¯éšæ—¶å¯èƒ½æ›´æ”¹ï¼Œå› æ­¤ç¡¬ç¼–ç ä¿¡æ¯ä¸æ˜¯è§£å†³æ–¹æ¡ˆã€‚</p><p>ä¸ºäº†åº”å¯¹ä¸Šè¿°æŒ‘æˆ˜ï¼ŒRasaå¯ä»¥ä¸çŸ¥è¯†åº“é›†æˆã€‚è¦ä½¿ç”¨è¿™ç§é›†æˆï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªçš„è‡ªå®šä¹‰æ“ä½œ<code>ActionQueryKnowledgeBase</code>ï¼Œè¯¥é¢„å†™çš„è‡ªå®šä¹‰æ“ä½œåŒ…å«ç”¨äºæŸ¥è¯¢çŸ¥è¯†åº“ä¸­å¯¹è±¡åŠå…¶å±æ€§çš„é€»è¾‘ã€‚</p><p>æ‚¨å¯ä»¥åœ¨<code>examples/knowledgebasebot</code> ï¼ˆ<a href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/">çŸ¥è¯†åº“bot</a>ï¼‰ä¸­æ‰¾åˆ°å®Œæ•´çš„ç¤ºä¾‹ï¼Œä»¥åŠä¸‹é¢æœ‰å…³å®ç°æ­¤è‡ªå®šä¹‰æ“ä½œçš„è¯´æ˜ã€‚</p><h3 id="ä½¿ç”¨ActionQueryKnowledgeBase"><a href="#ä½¿ç”¨ActionQueryKnowledgeBase" class="headerlink" title="ä½¿ç”¨ActionQueryKnowledgeBase"></a>ä½¿ç”¨<code>ActionQueryKnowledgeBase</code></h3><h4 id="åˆ›å»ºçŸ¥è¯†åº“"><a href="#åˆ›å»ºçŸ¥è¯†åº“" class="headerlink" title="åˆ›å»ºçŸ¥è¯†åº“"></a>åˆ›å»ºçŸ¥è¯†åº“</h4><p>ç”¨äºå›ç­”ç”¨æˆ·è¯·æ±‚çš„æ•°æ®å°†å­˜å‚¨åœ¨çŸ¥è¯†åº“ä¸­ã€‚çŸ¥è¯†åº“å¯ç”¨äºå­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ã€‚å»ºè®®æ‚¨å¼€å§‹ä½¿ç”¨<code>InMemoryKnowledgeBase</code>ã€‚ä¸€æ—¦è¦å¼€å§‹å¤„ç†å¤§é‡æ•°æ®ï¼Œå°±å¯ä»¥åˆ‡æ¢åˆ°è‡ªå®šä¹‰çŸ¥è¯†åº“ï¼ˆè¯·å‚é˜…<a href="#">åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“</a>ï¼‰ã€‚</p><p>è¦åˆå§‹åŒ–<code>InMemoryKnowledgeBase</code>ï¼Œæ‚¨éœ€è¦åœ¨jsonæ–‡ä»¶ä¸­æä¾›æ•°æ®ã€‚ä»¥ä¸‹ç¤ºä¾‹åŒ…å«æœ‰å…³é¤å…å’Œé…’åº—çš„æ•°æ®ã€‚jsonç»“æ„åº”åŒ…å«æ¯ä¸ªå¯¹è±¡ç±»å‹ï¼ˆå³<code>"restaurant"</code>å’Œï¼‰çš„é”®<code>"hotel"</code>ã€‚æ¯ä¸ªå¯¹è±¡ç±»å‹éƒ½æ˜ å°„åˆ°å¯¹è±¡åˆ—è¡¨â€“åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰3å®¶é¤å…çš„åˆ—è¡¨å’Œ3å®¶é…’åº—çš„åˆ—è¡¨ã€‚</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"restaurant"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Donath"</span><span class="token punctuation">,</span>            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Berlin Burrito Company"</span><span class="token punctuation">,</span>            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Mexican"</span><span class="token punctuation">,</span>            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"cheap"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"I due forni"</span><span class="token punctuation">,</span>            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"hotel"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hilton"</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"expensive"</span><span class="token punctuation">,</span>            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">true</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hilton"</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"expensive"</span><span class="token punctuation">,</span>            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Frankfurt am Main"</span><span class="token punctuation">,</span>            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">false</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"B&amp;B"</span><span class="token punctuation">,</span>            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span><span class="token punctuation">,</span>            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">false</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>ä¸€æ—¦åœ¨jsonæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼‰ä¸­å®šä¹‰äº†æ•°æ®<code>data.json</code>ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨æ­¤æ•°æ®æ–‡ä»¶æ¥åˆ›å»ºæ‚¨çš„<code>InMemoryKnowledgeBase</code>ï¼Œè¯¥æ–‡ä»¶ å°†ä¼ é€’ç»™æŸ¥è¯¢çŸ¥è¯†åº“çš„æ“ä½œã€‚</p><p>çŸ¥è¯†åº“ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½åº”è‡³å°‘å…·æœ‰<code>"name"</code>å’Œ<code>"id"</code>å­—æ®µä»¥ä½¿ç”¨é»˜è®¤å®ç°ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™å¿…é¡»<a href="#">è‡ªå®šä¹‰InMemoryKnowledgeBase</a>ã€‚</p><h4 id="å®šä¹‰NLUæ•°æ®"><a href="#å®šä¹‰NLUæ•°æ®" class="headerlink" title="å®šä¹‰NLUæ•°æ®"></a>å®šä¹‰NLUæ•°æ®</h4><p>åœ¨è¿™ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªæ–°çš„æ„å›¾ï¼Œ <code>query_knowledge_base</code></li><li>æˆ‘ä»¬å°†å¯¹<code>mention</code>å®ä½“è¿›è¡Œæ³¨é‡Šï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ¨¡å‹èƒ½å¤Ÿæ£€æµ‹åˆ°è¯¸å¦‚â€œç¬¬ä¸€ä¸ªâ€ä¹‹ç±»çš„å¯¹è±¡çš„é—´æ¥æåŠ</li><li>æˆ‘ä»¬å°†å¹¿æ³›ä½¿ç”¨<a href="#">åŒä¹‰è¯</a></li></ul><p>ä¸ºäº†ä½¿æœºå™¨äººç†è§£ç”¨æˆ·æƒ³è¦ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ä¿¡æ¯ï¼Œæ‚¨éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„æ„å›¾ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º<code>query_knowledge_base</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†<code>ActionQueryKnowledgeBase</code>å¯ä»¥å¤„ç†çš„è¯·æ±‚åˆ†ä¸ºä¸¤ç±»ï¼šï¼ˆ1ï¼‰ç”¨æˆ·æƒ³è¦è·å–ç‰¹å®šç±»å‹çš„å¯¹è±¡çš„åˆ—è¡¨ï¼Œæˆ–è€…ï¼ˆ2ï¼‰ç”¨æˆ·æƒ³è¦äº†è§£å¯¹è±¡çš„ç‰¹å®šå±æ€§ã€‚è¯¥æ„å›¾åº”åŒ…å«è¿™ä¸¤ä¸ªè¯·æ±‚çš„è®¸å¤šå˜ä½“ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:query_knowledge_base</span><span class="token list punctuation">-</span> what <span class="token url">[restaurants](object_type:restaurant)</span> can you recommend?<span class="token list punctuation">-</span> list some <span class="token url">[restaurants](object_type:restaurant)</span><span class="token list punctuation">-</span> can you name some <span class="token url">[restaurants](object_type:restaurant)</span> please?<span class="token list punctuation">-</span> can you show me some <span class="token url">[restaurant](object_type:restaurant)</span> options<span class="token list punctuation">-</span> list <span class="token url">[German](cuisine)</span> <span class="token url">[restaurants](object_type:restaurant)</span><span class="token list punctuation">-</span> do you have any <span class="token url">[mexican](cuisine)</span> <span class="token url">[restaurants](object_type:restaurant)</span>?<span class="token list punctuation">-</span> do you know the <span class="token url">[price range](attribute:price-range)</span> of <span class="token url">[that one](mention)</span>?<span class="token list punctuation">-</span> what <span class="token url">[cuisine](attribute)</span> is <span class="token url">[it](mention)</span>?<span class="token list punctuation">-</span> do you know what <span class="token url">[cuisine](attribute)</span> the <span class="token url">[last one](mention:LAST)</span> has?<span class="token list punctuation">-</span> does the <span class="token url">[first one](mention:1)</span> have <span class="token url">[outside seating](attribute:outside-seating)</span>?<span class="token list punctuation">-</span> what is the <span class="token url">[price range](attribute:price-range)</span> of <span class="token url">[Berlin Burrito Company](restaurant)</span>?<span class="token list punctuation">-</span> what about <span class="token url">[I due forni](restaurant)</span>?<span class="token list punctuation">-</span> can you tell me the <span class="token url">[price range](attribute)</span> of <span class="token url">[that restaurant](mention)</span>?<span class="token list punctuation">-</span> what <span class="token url">[cuisine](attribute)</span> do <span class="token url">[they](mention)</span> have? ...</code></pre><p>ä¸Šé¢çš„ç¤ºä¾‹ä»…æ˜¾ç¤ºäº†ä¸é¤å…åŸŸç›¸å…³çš„ç¤ºä¾‹ã€‚æ‚¨åº”è¯¥é’ˆå¯¹ç›¸åŒçš„<code>query_knowledge_base</code>æ„å›¾ä¸ºçŸ¥è¯†åº“ä¸­å­˜åœ¨çš„æ¯ç§å¯¹è±¡ç±»å‹æ·»åŠ ç¤ºä¾‹ã€‚</p><p>é™¤äº†ä¸ºæ¯ç§æŸ¥è¯¢ç±»å‹æ·»åŠ å„ç§è®­ç»ƒç¤ºä¾‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦åœ¨è®­ç»ƒç¤ºä¾‹ä¸­æŒ‡å®šå’Œæ³¨é‡Šä»¥ä¸‹å®ä½“ï¼š</p><ul><li><code>object_type</code>æ³¨æ„ï¼šæ¯å½“è®­ç»ƒç¤ºä¾‹ä»æ‚¨çš„çŸ¥è¯†åº“ä¸­å¼•ç”¨ç‰¹å®šçš„å¯¹è±¡ç±»å‹æ—¶ï¼Œéƒ½åº”å°†å¯¹è±¡ç±»å‹æ ‡è®°ä¸ºå®ä½“ã€‚ä½¿ç”¨<a href="#">åŒä¹‰è¯</a>å°†ä¾‹å¦‚æ˜ å°„<code>restaurants</code>ä¸º<code>restaurant</code>ï¼Œä½œä¸ºæ­£ç¡®çš„å¯¹è±¡ç±»å‹ä½œä¸ºçŸ¥è¯†åº“ä¸­çš„é”®åˆ—å‡ºã€‚</li><li><code>mention</code>ï¼šå¦‚æœç”¨æˆ·é€šè¿‡â€œç¬¬ä¸€ä¸ªâ€ï¼Œâ€œé‚£ä¸ªâ€æˆ–â€œå®ƒâ€æ¥å¼•ç”¨å¯¹è±¡ï¼Œåˆ™åº”å°†è¿™äº›æœ¯è¯­æ ‡è®°ä¸º<code>mention</code>ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨åŒä¹‰è¯å°†æŸäº›æåŠå†…å®¹æ˜ å°„åˆ°ç¬¦å·ã€‚æ‚¨å¯ä»¥é€šè¿‡<a href="#">è§£å†³æåŠ</a>æ¥äº†è§£æœ‰å…³å†…å®¹ã€‚</li><li><code>attribute</code>æ³¨æ„ï¼šçŸ¥è¯†åº“ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§åç§°åº”<code>attribute</code>ä¸NLUæ•°æ®ä¸­çš„åç§°ç›¸åŒã€‚åŒæ ·ï¼Œä½¿ç”¨åŒä¹‰è¯å°†å±æ€§åç§°çš„å˜ä½“æ˜ å°„åˆ°çŸ¥è¯†åº“ä¸­ä½¿ç”¨çš„å˜ä½“ã€‚</li></ul><p>è¯·è®°ä½å°†è¿™äº›å®ä½“æ·»åŠ åˆ°æ‚¨çš„åŸŸæ–‡ä»¶ä¸­ï¼ˆä½œä¸ºå®ä½“å’Œæ’æ§½ï¼‰ï¼š</p><pre class=" language-markdown"><code class="language-markdown">entities:  <span class="token list punctuation">-</span> object_type  <span class="token list punctuation">-</span> mention  <span class="token list punctuation">-</span> attributeslots:  object_type:<span class="token code keyword">    type: unfeaturized</span>  mention:<span class="token code keyword">    type: unfeaturized</span>  attribute:<span class="token code keyword">    type: unfeaturized</span></code></pre><h4 id="åˆ›å»ºä¸€ä¸ªæ“ä½œæ¥æŸ¥è¯¢æ‚¨çš„çŸ¥è¯†åº“"><a href="#åˆ›å»ºä¸€ä¸ªæ“ä½œæ¥æŸ¥è¯¢æ‚¨çš„çŸ¥è¯†åº“" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ“ä½œæ¥æŸ¥è¯¢æ‚¨çš„çŸ¥è¯†åº“"></a>åˆ›å»ºä¸€ä¸ªæ“ä½œæ¥æŸ¥è¯¢æ‚¨çš„çŸ¥è¯†åº“</h4><p>è¦åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œï¼Œæ‚¨éœ€è¦ç»§æ‰¿<code>ActionQueryKnowledgeBase</code>çŸ¥è¯†åº“å¹¶å°†å…¶ä¼ é€’ç»™çš„æ„é€ å‡½æ•°<code>ActionQueryKnowledgeBase</code>ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>knowledge_base<span class="token punctuation">.</span>storage <span class="token keyword">import</span> InMemoryKnowledgeBase<span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>knowledge_base<span class="token punctuation">.</span>actions <span class="token keyword">import</span> ActionQueryKnowledgeBase<span class="token keyword">class</span> <span class="token class-name">MyKnowledgeBaseAction</span><span class="token punctuation">(</span>ActionQueryKnowledgeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        knowledge_base <span class="token operator">=</span> InMemoryKnowledgeBase<span class="token punctuation">(</span><span class="token string">"data.json"</span><span class="token punctuation">)</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>knowledge_base<span class="token punctuation">)</span></code></pre><p>æ¯å½“åˆ›å»ºæ—¶<code>ActionQueryKnowledgeBase</code>ï¼Œéƒ½éœ€è¦å°†ä¼ é€’<code>KnowledgeBase</code>ç»™æ„é€ å‡½æ•°ã€‚å®ƒå¯ä»¥æ˜¯<code>InMemoryKnowledgeBase</code>æˆ–æ‚¨è‡ªå·±çš„å®ç°<code>KnowledgeBase</code> ï¼ˆè¯·å‚é˜…<a href="#">åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“</a>ï¼‰ã€‚æ‚¨åªèƒ½ä»ä¸€ä¸ªçŸ¥è¯†åº“ä¸­æå–ä¿¡æ¯ï¼Œå› ä¸ºä¸æ”¯æŒåŒæ—¶ä½¿ç”¨å¤šä¸ªçŸ¥è¯†åº“ã€‚</p><p>è¿™æ˜¯æ­¤æ“ä½œçš„å…¨éƒ¨ä»£ç ï¼åŠ¨ä½œçš„åç§°æ˜¯<code>action_query_knowledge_base</code>ã€‚ä¸è¦å¿˜è®°å°†å…¶æ·»åŠ åˆ°æ‚¨çš„åŸŸæ–‡ä»¶ä¸­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">actions:<span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>query<span class="token punctuation">_</span></span>knowledge_base</code></pre><p>æ³¨æ„</p><p>å¦‚æœè¦†ç›–äº†é»˜è®¤çš„åŠ¨ä½œåç§°<code>action_query_knowledge_base</code>ï¼Œä½ éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªunfeaturizedæ’æ§½æ·»åŠ åˆ°æ‚¨çš„åŸŸæ–‡ä»¶ï¼š<code>knowledge_base_objects</code>ï¼Œ<code>knowledge_base_last_object</code>ï¼Œå’Œ <code>knowledge_base_last_object_type</code>ã€‚æ’æ§½ç”±å†…éƒ¨ä½¿ç”¨<code>ActionQueryKnowledgeBase</code>ã€‚å¦‚æœä¿ç•™é»˜è®¤æ“ä½œåç§°ï¼Œè¿™äº›æ’æ§½å°†è‡ªåŠ¨ä¸ºæ‚¨æ·»åŠ ã€‚</p><p>æ‚¨è¿˜éœ€è¦ç¡®ä¿å°†ä¸€ä¸ªæ•…äº‹æ·»åŠ åˆ°æ‚¨çš„æ•…äº‹æ–‡ä»¶ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬æ„å›¾<code>query_knowledge_base</code>å’ŒåŠ¨ä½œ<code>action_query_knowledge_base</code>ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> Happy Path</span><span class="token list punctuation">*</span> greet  <span class="token list punctuation">-</span> utter_greet<span class="token list punctuation">*</span> query<span class="token italic"><span class="token punctuation">_</span>knowledge<span class="token punctuation">_</span></span>base  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>query<span class="token punctuation">_</span></span>knowledge_base<span class="token list punctuation">*</span> goodbye  <span class="token list punctuation">-</span> utter_goodbye</code></pre><p>æ‚¨éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯<code>utter_ask_rephrase</code>åœ¨åŸŸæ–‡ä»¶ä¸­å®šä¹‰å“åº”ã€‚å¦‚æœè¯¥æ“ä½œä¸çŸ¥é“å¦‚ä½•å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå®ƒå°†ä½¿ç”¨æ­¤å“åº”æ¥è¦æ±‚ç”¨æˆ·é‡æ–°æªè¾ã€‚ä¾‹å¦‚ï¼Œå°†ä»¥ä¸‹å“åº”æ·»åŠ åˆ°æ‚¨çš„åŸŸæ–‡ä»¶ä¸­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>rephrase:<span class="token list punctuation">-</span> text: "Sorry, I'm not sure I understand. Could you rephrase it?"<span class="token list punctuation">-</span> text: "Could you please rephrase your message? I didn't quite get that."</code></pre><p>æ·»åŠ æ‰€æœ‰ç›¸å…³éƒ¨åˆ†åï¼Œè¯¥æ“ä½œç°åœ¨å¯ä»¥æŸ¥è¯¢çŸ¥è¯†åº“ã€‚</p><h3 id="å¦‚ä½•å·¥ä½œ"><a href="#å¦‚ä½•å·¥ä½œ" class="headerlink" title="å¦‚ä½•å·¥ä½œ"></a>å¦‚ä½•å·¥ä½œ</h3><p><code>ActionQueryKnowledgeBase</code> æŸ¥çœ‹åœ¨è¯·æ±‚ä¸­é€‰å–çš„å®ä½“ä»¥åŠå…ˆå‰è®¾ç½®çš„å¹¿å‘Šä½ï¼Œä»¥å†³å®šè¦æŸ¥è¯¢çš„å†…å®¹ã€‚</p><h4 id="åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡"><a href="#åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡" class="headerlink" title="åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡"></a>åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡</h4><p>ä¸ºäº†æŸ¥è¯¢çŸ¥è¯†åº“ä¸­çš„ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œç”¨æˆ·çš„è¯·æ±‚éƒ½éœ€è¦åŒ…æ‹¬å¯¹è±¡ç±»å‹ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><ul><li>ä½ èƒ½è¯´å‡ºä¸€äº›é¤å…çš„åå­—å—ï¼Ÿ</li></ul><p>è¿™ä¸ªé—®é¢˜åŒ…æ‹¬æ„Ÿå…´è¶£çš„å¯¹è±¡ç±»å‹ï¼šâ€œé¤å…â€ã€‚æœºå™¨äººéœ€è¦æ‹¾å–è¯¥å®ä½“æ‰èƒ½æå‡ºæŸ¥è¯¢-å¦åˆ™æ“ä½œå°†ä¸çŸ¥é“ç”¨æˆ·æ„Ÿå…´è¶£çš„å¯¹è±¡ã€‚</p><p>å½“ç”¨æˆ·è¯´å‡ºç±»ä¼¼çš„å†…å®¹æ—¶ï¼š</p><ul><li>æˆ‘åœ¨æŸæ—æœ‰å“ªäº›æ„å¤§åˆ©é¤å…é€‰æ‹©ï¼Ÿ</li></ul><p>ç”¨æˆ·æƒ³è¦è·å¾—ï¼ˆ1ï¼‰æœ‰æ„å¤§åˆ©ç¾é£Ÿå’Œï¼ˆ2ï¼‰ä½äºæŸæ—çš„é¤å…åˆ—è¡¨ã€‚å¦‚æœNERåœ¨ç”¨æˆ·è¯·æ±‚ä¸­æ£€æµ‹åˆ°é‚£äº›å±æ€§ï¼Œåˆ™è¯¥æ“ä½œå°†ä½¿ç”¨é‚£äº›å±æ€§æ¥è¿‡æ»¤åœ¨çŸ¥è¯†åº“ä¸­æ‰¾åˆ°çš„é¤é¦†ã€‚</p><p>ä¸ºäº†ä½¿æœºå™¨äººèƒ½å¤Ÿæ£€æµ‹åˆ°è¿™äº›å±æ€§ï¼Œæ‚¨éœ€è¦åœ¨NLUæ•°æ®ä¸­å°†â€œ Italianâ€å’Œâ€œ Berlinâ€æ ‡è®°ä¸ºå®ä½“ï¼š</p><pre class=" language-markdown"><code class="language-markdown">What <span class="token url">[Italian](cuisine)</span> <span class="token url">[restaurant](object_type)</span> options in <span class="token url">[Berlin](city)</span> do I have?.</code></pre><p>å±æ€§çš„åç§°â€œç¾é£Ÿâ€å’Œâ€œåŸå¸‚â€åº”ä¸çŸ¥è¯†åº“ä¸­ä½¿ç”¨çš„åç§°ç›¸åŒã€‚æ‚¨è¿˜éœ€è¦å°†å®ƒä»¬ä½œä¸ºå®ä½“å’Œæ’æ§½æ·»åŠ åˆ°åŸŸæ–‡ä»¶ä¸­ã€‚</p><h4 id="åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡çš„å±æ€§"><a href="#åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡çš„å±æ€§" class="headerlink" title="åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡çš„å±æ€§"></a>åœ¨çŸ¥è¯†åº“ä¸­æŸ¥è¯¢å¯¹è±¡çš„å±æ€§</h4><p>å¦‚æœç”¨æˆ·å¸Œæœ›è·å–æœ‰å…³æŸä¸ªå¯¹è±¡çš„ç‰¹å®šä¿¡æ¯ï¼Œåˆ™è¯·æ±‚åº”åŒæ—¶åŒ…å«è¯¥å¯¹è±¡å’Œæ„Ÿå…´è¶£çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·é—®ç±»ä¼¼ï¼š</p><ul><li>æŸæ—å·é¥¼å…¬å¸çš„èœæ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><p>ç”¨æˆ·æƒ³è¦è·å¾—é¤å…â€œæŸæ—ç…é¥¼åº—å…¬å¸â€ï¼ˆæ„Ÿå…´è¶£çš„å¯¹è±¡ï¼‰çš„â€œç¾é£Ÿâ€ï¼ˆæ„Ÿå…´è¶£çš„å±æ€§ï¼‰ã€‚</p><p>NLUè®­ç»ƒæ•°æ®ä¸­åº”å°†æ„Ÿå…´è¶£çš„å±æ€§å’Œå¯¹è±¡æ ‡è®°ä¸ºå®ä½“ï¼š</p><pre class=" language-markdown"><code class="language-markdown">What is the <span class="token url">[cuisine](attribute)</span> of <span class="token url">[Berlin Burrito Company](restaurant)</span>?</code></pre><p>ç¡®ä¿å°†å¯¹è±¡ç±»å‹â€œé¤å…â€ä½œä¸ºå®ä½“å’Œæ’æ§½æ·»åŠ åˆ°åŸŸæ–‡ä»¶ä¸­ã€‚</p><h4 id="è§£å†³æåŠ"><a href="#è§£å†³æåŠ" class="headerlink" title="è§£å†³æåŠ"></a>è§£å†³æåŠ</h4><p>æ ¹æ®ä¸Šé¢çš„ç¤ºä¾‹ï¼Œç”¨æˆ·å¯èƒ½å¹¶ä¸æ€»æ˜¯ç”¨ä»–ä»¬çš„åå­—æ¥æŒ‡ä»£é¤é¦†ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å…¶åç§°å¼•ç”¨æ„Ÿå…´è¶£çš„å¯¹è±¡ï¼Œä¾‹å¦‚â€œ Berlin Burrito Companyâ€ï¼ˆå¯¹è±¡çš„è¡¨ç¤ºå­—ç¬¦ä¸²ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æåŠæ¥å¼•ç”¨å…ˆå‰åˆ—å‡ºçš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>æ‚¨æåˆ°çš„ç¬¬äºŒå®¶é¤å…çš„èœæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>æˆ‘ä»¬çš„è¡ŒåŠ¨èƒ½å¤Ÿå°†è¿™äº›æåŠè§£å†³ä¸ºçŸ¥è¯†åº“ä¸­çš„å®é™…å¯¹è±¡ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå®ƒå¯ä»¥è§£å†³ä¸¤ç§æåŠç±»å‹ï¼šï¼ˆ1ï¼‰é¡ºåºæåŠï¼Œä¾‹å¦‚â€œç¬¬ä¸€ä¸ªâ€ï¼Œä»¥åŠï¼ˆ2ï¼‰æåŠï¼Œä¾‹å¦‚â€œ itâ€æˆ–â€œé‚£ä¸ªâ€ã€‚</p><p><strong>é¡ºåºæåŠ</strong></p><p>å½“ç”¨æˆ·é€šè¿‡å¯¹è±¡åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®å¼•ç”¨å¯¹è±¡æ—¶ï¼Œç§°ä¸ºåºè´¯æåŠã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><ul><li>ç”¨æˆ·ï¼šæ‚¨çŸ¥é“æŸæ—çš„å“ªäº›é¤é¦†ï¼Ÿ</li><li>Botï¼šæ‰¾åˆ°äº†ä»¥ä¸‹ç±»å‹çš„â€œé¤å…â€å¯¹è±¡ï¼š1ï¼šæˆ‘åº”å¾—2ï¼šPastaBar 3ï¼šæŸæ—ç‰ç±³ç…é¥¼å…¬å¸</li><li>ä½¿ç”¨è€…ï¼šç¬¬ä¸€ä¸ªæœ‰æˆ·å¤–åº§ä½å—ï¼Ÿ</li></ul><p>ç”¨æˆ·ç”¨æœ¯è¯­â€œç¬¬ä¸€ä¸ªâ€æ¥ç§°å‘¼â€œæˆ‘åº”å¾—â€ã€‚å…¶ä»–é¡ºåºæåŠçš„å†…å®¹å¯èƒ½åŒ…æ‹¬â€œç¬¬äºŒä¸ªâ€ï¼Œâ€œæœ€åä¸€ä¸ªâ€ï¼Œâ€œä»»ä½•â€æˆ–â€œ 3â€ã€‚</p><p>å½“å‘ç”¨æˆ·å±•ç¤ºå¯¹è±¡åˆ—è¡¨æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨åºè¨€æåŠã€‚ä¸ºäº†è§£å†³å¯¹å®é™…å¯¹è±¡çš„æåŠï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨<code>KnowledgeBase</code>ç±»ä¸­è®¾ç½®çš„é¡ºåºæåŠæ˜ å°„ ã€‚é»˜è®¤æ˜ å°„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"1"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"2"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"3"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"4"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"5"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"6"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"7"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"8"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"9"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"10"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"ANY"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> random.choice(l<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token property">"LAST"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span>-<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>é¡ºåºæåŠæ˜ å°„å°†å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚â€œ 1â€ï¼‰æ˜ å°„åˆ°åˆ—è¡¨ä¸­çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œè¡¨ç¤ºç´¢å¼•å¤„çš„å¯¹è±¡ã€‚<code>lambda l: l[0]``0</code></p><p>ä¾‹å¦‚ï¼Œç”±äºåºå·æåŠæ˜ å°„ä¸åŒ…å«â€œç¬¬ä¸€ä¸ªâ€æ¡ç›®ï¼Œå› æ­¤ä½¿ç”¨<a href="#">å®ä½“åŒä¹‰è¯</a>å°†NLUæ•°æ®ä¸­çš„â€œç¬¬ä¸€ä¸ªâ€æ˜ å°„åˆ°â€œ 1â€éå¸¸é‡è¦ï¼š</p><pre class=" language-markdown"><code class="language-markdown">Does the <span class="token url">[first one](mention:1)</span> have <span class="token url">[outside seating](attribute:outside-seating)</span>?</code></pre><p>NERå°†â€œç¬¬ä¸€ä¸ªâ€æ£€æµ‹ä¸ºä¸€ä¸ª<code>mention</code>å®ä½“ï¼Œä½†å°†â€œ 1â€æ”¾å…¥<code>mention</code>æ’æ§½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ“ä½œå¯ä»¥å°†<code>mention</code>ç©ºæ¡£å’Œé¡ºåºæåŠæ˜ å°„ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å°†â€œç¬¬ä¸€ä¸ªâ€è§£æä¸ºå®é™…å¯¹è±¡â€œ I due forniâ€ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡<code>set_ordinal_mention_mapping()</code>åœ¨<code>KnowledgeBase</code>å®ç°ä¸Š è°ƒç”¨è¯¥å‡½æ•°æ¥è¦†ç›–é¡ºåºæåŠæ˜ å°„ï¼ˆè¯·å‚é˜…<a href="#">è‡ªå®šä¹‰InMemoryKnowledgeBase</a>ï¼‰ã€‚</p><p><strong>å…¶ä»–æåŠ</strong></p><p>çœ‹ä¸€ä¸‹ä¸‹é¢çš„å¯¹è¯ï¼š</p><ul><li>ç”¨æˆ·ï¼šPastaBarçš„èœæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Botï¼šPastaBaræä¾›æ„å¤§åˆ©ç¾é£Ÿã€‚</li><li>ç”¨æˆ·ï¼šå®ƒæœ‰wifiå—ï¼Ÿ</li><li>Botï¼šæ˜¯çš„ã€‚</li><li>ç”¨æˆ·ï¼šä½ èƒ½ç»™æˆ‘ä¸€ä¸ªåœ°å€å—ï¼Ÿ</li></ul><p>åœ¨â€œæ˜¯å¦æœ‰wifiå—ï¼Ÿâ€é—®é¢˜ä¸­ï¼Œç”¨æˆ·ä½¿ç”¨â€œ itâ€ä¸€è¯æ¥æŒ‡ä»£â€œ PastaBarâ€ã€‚å¦‚æœNERå°†â€œ itâ€æ£€æµ‹ä¸ºå®ä½“<code>mention</code>ï¼Œåˆ™çŸ¥è¯†åº“æ“ä½œä¼šå°†å…¶è§£æä¸ºå¯¹è¯ä¸­æœ€åæåˆ°çš„å¯¹è±¡â€œ PastaBarâ€ã€‚</p><p>åœ¨ä¸‹ä¸€ä¸ªè¾“å…¥ä¸­ï¼Œç”¨æˆ·é—´æ¥å¼•ç”¨å¯¹è±¡â€œ PastaBarâ€ï¼Œè€Œä¸æ˜¯æ˜ç¡®æåŠå®ƒã€‚çŸ¥è¯†åº“æ“ä½œå°†æ£€æµ‹åˆ°ç”¨æˆ·æƒ³è¦è·å–ç‰¹å®šå±æ€§çš„å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºåœ°å€ã€‚å¦‚æœNERæœªæ£€æµ‹åˆ°ä»»ä½•æåŠæˆ–å¯¹è±¡ï¼Œåˆ™è¯¥æ“ä½œå°†å‡å®šç”¨æˆ·æ­£åœ¨å¼•ç”¨æœ€è¿‘æåŠçš„å¯¹è±¡â€œ PastaBarâ€ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨åˆå§‹åŒ–æ“ä½œæ—¶å°†è®¾ç½®<code>use_last_object_mention</code>ä¸ºæ¥ç¦ç”¨æ­¤è¡Œä¸º<code>False</code>ã€‚</p><h3 id="å®šåˆ¶"><a href="#å®šåˆ¶" class="headerlink" title="å®šåˆ¶"></a>å®šåˆ¶</h3><h4 id="å®šåˆ¶ActionQueryKnowledgeBase"><a href="#å®šåˆ¶ActionQueryKnowledgeBase" class="headerlink" title="å®šåˆ¶ActionQueryKnowledgeBase"></a>å®šåˆ¶<code>ActionQueryKnowledgeBase</code></h4><p><code>ActionQueryKnowledgeBase</code>å¦‚æœè¦è‡ªå®šä¹‰æ¼«æ¸¸å™¨å¯¹ç”¨æˆ·è¯´çš„è¯ï¼Œå¯ä»¥è¦†ç›–ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ul><li><code>utter_objects()</code></li><li><code>utter_attribute_value()</code></li></ul><p><code>utter_objects()</code>å½“ç”¨æˆ·è¯·æ±‚å¯¹è±¡åˆ—è¡¨æ—¶ä½¿ç”¨ã€‚ä¸€æ—¦æœºå™¨äººä»çŸ¥è¯†åº“ä¸­æ£€ç´¢äº†å¯¹è±¡ï¼Œå®ƒå°†é»˜è®¤ä»¥ä¸€æ¡æ¶ˆæ¯å“åº”ç”¨æˆ·ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li>æ‰¾åˆ°ä»¥ä¸‹ç±»å‹çš„é¤å…ç±»å‹çš„å¯¹è±¡ï¼š 1ï¼šæˆ‘åº”å¾—çš„ 2ï¼šPastaBar 3ï¼šBerlin Burrito Company</li></ul><p>æˆ–è€…ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä»»ä½•å¯¹è±¡ï¼Œ</p><ul><li>æˆ‘æ‰¾ä¸åˆ°â€œé¤å…â€ç±»å‹çš„ä»»ä½•å¯¹è±¡ã€‚</li></ul><p>å¦‚æœè¦æ›´æ”¹å‘è¯æ ¼å¼ï¼Œåˆ™å¯ä»¥<code>utter_objects()</code>åœ¨æ“ä½œä¸­è¦†ç›–è¯¥æ–¹æ³•ã€‚</p><p>è¯¥åŠŸèƒ½<code>utter_attribute_value()</code>ç¡®å®šå½“ç”¨æˆ·è¦æ±‚æœ‰å…³å¯¹è±¡çš„ç‰¹å®šä¿¡æ¯æ—¶ï¼Œæœºå™¨äººä¼šè¯´äº›ä»€ä¹ˆã€‚</p><p>å¦‚æœåœ¨çŸ¥è¯†åº“ä¸­æ‰¾åˆ°äº†æ„Ÿå…´è¶£çš„å±æ€§ï¼Œåˆ™æ¼«æ¸¸å™¨å°†ä»¥ä»¥ä¸‹æ–¹å¼å›åº”ï¼š</p><ul><li>â€œæŸæ—ç‰ç±³ç…é¥¼å…¬å¸â€çš„å±æ€§â€œçƒ¹é¥ªâ€çš„å€¼ä¸ºâ€œå¢¨è¥¿å“¥â€ã€‚</li></ul><p>å¦‚æœæœªæ‰¾åˆ°æ‰€è¯·æ±‚å±æ€§çš„å€¼ï¼Œåˆ™æ¼«æ¸¸å™¨å°†ä»¥å“åº”</p><ul><li>æ‰¾ä¸åˆ°å¯¹è±¡â€œ Berlin Burrito Companyâ€çš„å±æ€§â€œ cuisineâ€çš„æœ‰æ•ˆå€¼ã€‚</li></ul><p>å¦‚æœè¦æ›´æ”¹è‡ªåŠ¨å‘å£°ï¼Œå¯ä»¥è¦†ç›–æ–¹æ³•<code>utter_attribute_value()</code>ã€‚</p><blockquote><p>æ³¨æ„</p><p>æˆ‘ä»¬çš„åšå®¢ä¸Šæœ‰ä¸€ä¸ª<a href="#">æ•™ç¨‹</a>ï¼Œä»‹ç»å¦‚ä½•åœ¨è‡ªå®šä¹‰æ“ä½œä¸­ä½¿ç”¨çŸ¥è¯†åº“ã€‚æœ¬æ•™ç¨‹è¯¦ç»†è§£é‡Šäº†åé¢çš„å®ç° <code>ActionQueryKnowledgeBase</code>ã€‚</p></blockquote><h4 id="åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œ"><a href="#åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œ" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œ"></a>åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“æ“ä½œ</h4><p><code>ActionQueryKnowledgeBase</code>åº”è¯¥å¯ä»¥è®©æ‚¨è½»æ¾åœ°å¼€å§‹å°†çŸ¥è¯†åº“é›†æˆåˆ°æ‚¨çš„æ“ä½œä¸­ã€‚ä½†æ˜¯ï¼Œè¯¥æ“ä½œåªèƒ½å¤„ç†ä¸¤ç§ç”¨æˆ·è¯·æ±‚ï¼š</p><ul><li>ç”¨æˆ·å¸Œæœ›ä»çŸ¥è¯†åº“ä¸­è·å–å¯¹è±¡åˆ—è¡¨</li><li>ç”¨æˆ·æƒ³è¦è·å–ç‰¹å®šå¯¹è±¡çš„å±æ€§å€¼</li></ul><p>è¯¥æ“ä½œæ— æ³•åœ¨çŸ¥è¯†åº“ä¸­æ¯”è¾ƒå¯¹è±¡æˆ–è€ƒè™‘å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚æ­¤å¤–ï¼Œè§£å†³å¯¹è¯ä¸­å¯¹æœ€åæåˆ°çš„å¯¹è±¡çš„ä»»ä½•æåŠå¯èƒ½å¹¶ä¸æ€»æ˜¯æœ€ä½³çš„ã€‚</p><p>å¦‚æœè¦å¤„ç†æ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œåˆ™å¯ä»¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œã€‚æˆ‘ä»¬åœ¨<code>rasa_sdk.knowledge_base.utils</code> ï¼ˆ<a href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">é“¾æ¥åˆ°ä»£ç </a>ï¼‰ä¸­æ·»åŠ äº†ä¸€äº›å¸®åŠ©ç¨‹åºåŠŸèƒ½ï¼Œä»¥åœ¨å®ç°è‡ªå·±çš„è§£å†³æ–¹æ¡ˆæ—¶ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨<code>KnowledgeBase</code>æ¥å£ï¼Œä»¥ä¾¿æ‚¨ä»å¯ä»¥åœ¨<code>ActionQueryKnowledgeBase</code> æ–°çš„è‡ªå®šä¹‰æ“ä½œæ—è¾¹ä½¿ç”¨ã€‚</p><p>å¦‚æœæ‚¨ç¼–å†™äº†è§£å†³ä¸Šè¿°ç”¨ä¾‹ä¹‹ä¸€æˆ–æ–°ç”¨ä¾‹çš„çŸ¥è¯†åº“æ“ä½œï¼Œè¯·åŠ¡å¿…åœ¨<a href="https://forum.rasa.com/">è®ºå›</a>ä¸Šå‘Šè¯‰æˆ‘ä»¬ï¼</p><h4 id="è‡ªå®šä¹‰InMemoryKnowledgeBase"><a href="#è‡ªå®šä¹‰InMemoryKnowledgeBase" class="headerlink" title="è‡ªå®šä¹‰InMemoryKnowledgeBase"></a>è‡ªå®šä¹‰<code>InMemoryKnowledgeBase</code></h4><p>è¯¥ç±»<code>InMemoryKnowledgeBase</code>ç»§æ‰¿<code>KnowledgeBase</code>ã€‚æ‚¨å¯ä»¥<code>InMemoryKnowledgeBase</code>é€šè¿‡è¦†ç›–ä»¥ä¸‹åŠŸèƒ½æ¥è‡ªå®šä¹‰æ‚¨çš„ï¼š</p><ul><li><p><code>get_key_attribute_of_object()</code>ï¼šä¸ºäº†è·Ÿè¸ªç”¨æˆ·æœ€è¿‘åœ¨è°ˆè®ºä»€ä¹ˆå¯¹è±¡ï¼Œæˆ‘ä»¬å°†keyå±æ€§çš„å€¼å­˜å‚¨åœ¨ç‰¹å®šçš„æ’æ§½ä¸­ã€‚æ¯ä¸ªå¯¹è±¡éƒ½åº”å…·æœ‰å”¯ä¸€çš„é”®å±æ€§ï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„ä¸»é”®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ç§å¯¹è±¡ç±»å‹çš„keyå±æ€§çš„åç§°éƒ½è®¾ç½®ä¸º<code>id</code>ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨è¦†ç›–ç‰¹å®šå¯¹è±¡ç±»å‹çš„keyå±æ€§åç§° <code>set_key_attribute_of_object()</code>ã€‚</p></li><li><p><code>get_representation_function_of_object()</code>ï¼šè®©æˆ‘ä»¬ä¸“æ³¨äºä»¥ä¸‹é¤å…ï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Donath"</span><span class="token punctuation">,</span>    <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>    <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>å½“ç”¨æˆ·è¦æ±‚æ¼«æ¸¸å™¨åˆ—å‡ºä»»ä½•æ„å¤§åˆ©é¤å…æ—¶ï¼Œå®ƒä¸éœ€è¦é¤å…çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚ç›¸åï¼Œæ‚¨æƒ³æä¾›ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°æ¥æ ‡è¯†é¤å…-åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡çš„åç§°å³å¯ã€‚è¯¥å‡½æ•°<code>get_representation_function_of_object()</code>è¿”å›ä¸€ä¸ªlambdaå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä¸Šè¿°é¤å…å¯¹è±¡æ˜ å°„ä¸ºå…¶åç§°ã€‚</p><pre><code>lambda obj: obj["name"]</code></pre><p>æœºå™¨äººåœ¨è°ˆè®ºç‰¹å®šå¯¹è±¡æ—¶éƒ½ä¼šä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œä»¥ä¾¿å‘ç”¨æˆ·æ˜¾ç¤ºè¯¥å¯¹è±¡çš„æœ‰æ„ä¹‰çš„åç§°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œlambdaå‡½æ•°è¿”å›<code>"name"</code>å¯¹è±¡å±æ€§çš„å€¼ã€‚å¦‚æœæ‚¨çš„å¯¹è±¡æ²¡æœ‰<code>"name"</code>å±æ€§ï¼Œæˆ–è€…è¯¥<code>"name"</code>å¯¹è±¡çš„æ¨¡æ£±ä¸¤å¯ï¼Œåˆ™åº”é€šè¿‡è°ƒç”¨ä¸ºè¯¥å¯¹è±¡ç±»å‹è®¾ç½®ä¸€ä¸ªæ–°çš„lambdaå‡½æ•° <code>set_representation_function_of_object()</code>ã€‚</p></li><li><p><code>set_ordinal_mention_mapping()</code>ï¼šéœ€è¦é¡ºåºæåŠæ˜ å°„æ‰èƒ½å°†é¡ºåºæåŠï¼ˆä¾‹å¦‚â€œç¬¬äºŒä¸ªâ€ï¼‰è§£æä¸ºåˆ—è¡¨ä¸­çš„å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåºæ•°æåŠæ˜ å°„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"1"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"2"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"3"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"4"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"5"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"6"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"7"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"8"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"9"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"10"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"ANY"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> random.choice(l<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token property">"LAST"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span>-<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨å‡½æ•°å°†å…¶è¦†ç›–<code>set_ordinal_mention_mapping()</code>ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³å¦‚ä½•ä½¿ç”¨æ­¤æ˜ å°„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="#">è§£å†³é—®é¢˜</a>ã€‚</p></li></ul><p>æœ‰å…³ä½¿ç”¨çš„æ–¹æ³•çš„ç¤ºä¾‹å®ç°ï¼Œè¯·å‚è§<a href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/actions.py">ç¤ºä¾‹bot</a>ï¼Œè¯¥ç¤ºä¾‹<code>InMemoryKnowledgeBase</code>ä½¿ç”¨è¯¥æ–¹æ³•<code>set_representation_function_of_object()</code> è¦†ç›–å¯¹è±¡ç±»å‹â€œ hotelâ€çš„é»˜è®¤è¡¨ç¤ºã€‚<code>InMemoryKnowledgeBase</code>æœ¬èº«çš„å®ç°å¯ä»¥åœ¨ <a href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">rasa-sdk</a>åŒ…ä¸­æ‰¾åˆ°ã€‚</p><h4 id="åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“"><a href="#åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“"></a>åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“</h4><p>å¦‚æœæ‚¨æœ‰æ›´å¤šæ•°æ®ï¼Œæˆ–è€…æƒ³è¦ä½¿ç”¨æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œæ¶‰åŠä¸åŒå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼‰ï¼Œåˆ™å¯ä»¥åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†åº“å®ç°ã€‚åªæ˜¯ç»§æ‰¿<code>KnowledgeBase</code>å’Œå®æ–½æ–¹æ³•<code>get_objects()</code>ï¼Œ<code>get_object()</code>ä»¥åŠ <code>get_attributes_of_object()</code>ã€‚è¯¥<a href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">çŸ¥è¯†åŸºç¡€ä»£ç </a> æä¾›ä»€ä¹ˆè¿™äº›æ–¹æ³•åº”è¯¥åšçš„æ›´å¤šä¿¡æ¯ã€‚</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡è°ƒæ•´â€œ<a href="#">è‡ªå®šä¹‰InMemoryKnowledgeBase</a> â€éƒ¨åˆ†ä¸­æåˆ°çš„æ–¹æ³•ï¼Œè¿›ä¸€æ­¥è‡ªå®šä¹‰çŸ¥è¯†åº“ ã€‚</p><blockquote><p>æ³¨æ„</p><p>æˆ‘ä»¬å†™äº†<a href="#">ä¸€ç¯‡åšå®¢æ–‡ç« </a> ï¼Œè§£é‡Šäº†å¦‚ä½•å»ºç«‹è‡ªå·±çš„çŸ¥è¯†åº“ã€‚</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chatito-ä½¿ç”¨ç®€å•DSLç”ŸæˆRasaæ•°æ®é›†</title>
      <link href="/2020/10/05/chatito-shi-yong-jian-dan-dsl-sheng-cheng-rasa-shu-ju-ji/"/>
      <url>/2020/10/05/chatito-shi-yong-jian-dan-dsl-sheng-cheng-rasa-shu-ju-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="Chatito"><a href="#Chatito" class="headerlink" title="Chatito"></a>Chatito</h1><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><p>Chatitoå¯å¸®åŠ©æ‚¨ä½¿ç”¨ç®€å•çš„DSLç”Ÿæˆç”¨äºè®­ç»ƒå’ŒéªŒè¯chatbotæ¨¡å‹çš„æ•°æ®é›†ã€‚</p><p>å¦‚æœæ‚¨è¦ä½¿ç”¨å•†ä¸šæ¨¡å‹ï¼Œå¼€æºæ¡†æ¶æˆ–ç¼–å†™è‡ªå·±çš„è‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹æ¥æ„å»ºèŠå¤©æœºå™¨äººï¼Œåˆ™éœ€è¦åŸ¹è®­å’Œæµ‹è¯•ç¤ºä¾‹ã€‚Chatitoåœ¨è¿™é‡Œä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚</p><p>è¯¥é¡¹ç›®åŒ…å«ï¼š</p><ul><li><a href="https://rodrigopivi.github.io/Chatito/">åœ¨çº¿chatito IDE</a></li><li><a href="https://github.com/rodrigopivi/Chatito/blob/master/spec.md">Chatito DSLè§„èŒƒ</a></li><li><a href="https://github.com/rodrigopivi/Chatito/blob/master/parser/chatito.pegjs">pegjsæ ¼å¼çš„DSL ASTè§£æå™¨</a></li><li><a href="https://github.com/rodrigopivi/Chatito/tree/master/src">ä½¿ç”¨Typescript + npmåŒ…å®ç°çš„ç”Ÿæˆå™¨</a></li></ul><h3 id="èŠå¤©è¯­è¨€"><a href="#èŠå¤©è¯­è¨€" class="headerlink" title="èŠå¤©è¯­è¨€"></a>èŠå¤©è¯­è¨€</h3><p>æœ‰å…³å®Œæ•´çš„è¯­è¨€è§„èŒƒå’Œæ–‡æ¡£ï¼Œè¯·å‚è€ƒ<a href="https://github.com/rodrigopivi/Chatito/blob/master/spec.md">DSLè§„èŒƒæ–‡æ¡£</a>ã€‚</p><h2 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h2><h3 id="é˜²æ­¢è¿‡åº¦æ‹Ÿåˆ"><a href="#é˜²æ­¢è¿‡åº¦æ‹Ÿåˆ" class="headerlink" title="é˜²æ­¢è¿‡åº¦æ‹Ÿåˆ"></a>é˜²æ­¢è¿‡åº¦æ‹Ÿåˆ</h3><p>å¦‚æœæˆ‘ä»¬æ­£ç¡®ä½¿ç”¨Chatitoï¼Œå°±å¯ä»¥é¿å…è¿‡åº¦<a href="https://en.wikipedia.org/wiki/Overfitting">æ‹Ÿåˆ</a>çš„é—®é¢˜ã€‚è¯¥å·¥å…·çš„æ€æƒ³æ˜¯åœ¨æ•°æ®æ‰©å……å’Œå¯èƒ½çš„å¥å­ç»„åˆçš„æè¿°ä¹‹é—´æœ‰ä¸€ä¸ªäº¤é›†ã€‚å®ƒä¸æ‰“ç®—ç”Ÿæˆå¯èƒ½é€‚åˆå•ä¸ªå¥å­æ¨¡å‹çš„ç¡®å®šæ€§æ•°æ®é›†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ§åˆ¶ç”Ÿæˆè·¯å¾„ï¼Œä»…æ ¹æ®éœ€è¦æå–æ ·æœ¬ã€‚</p><h3 id="å·¥å…·å’Œèµ„æº"><a href="#å·¥å…·å’Œèµ„æº" class="headerlink" title="å·¥å…·å’Œèµ„æº"></a>å·¥å…·å’Œèµ„æº</h3><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=nimfin.chatito">Visual Studioçš„ä»£ç è¯­æ³•é«˜äº®æ’ä»¶</a>æ„Ÿè°¢<a href="https://github.com/nimf">å°¤é‡ŒGolobokov</a>ä»–<a href="https://github.com/nimf/chatito-vscode">è¿™æ–¹é¢çš„å·¥ä½œ</a>ã€‚</li><li><a href="https://books.google.com.pe/books?id=sR2CDwAAQBAJ">AIè“å›¾ï¼šå¦‚ä½•æ„å»ºå’Œéƒ¨ç½²AIä¸šåŠ¡é¡¹ç›®</a>ä½¿ç”¨ç¬¬7ç« ä¸­çš„chatitoå®ç°äº†å®ç”¨çš„å®Œæ•´chatbotç¤ºä¾‹ã€‚</li><li><a href="https://medium.com/@benoit.alvarez/3-steps-to-convert-chatbot-training-data-between-different-nlp-providers-fa235f67617c">åœ¨ä¸åŒçš„NLPæä¾›ç¨‹åºä¹‹é—´è½¬æ¢èŠå¤©æœºå™¨äººè®­ç»ƒæ•°æ®çš„3ä¸ªæ­¥éª¤</a>è¯¦ç»†è¯´æ˜äº†ä¸€ç§å°†æ•°æ®æ ¼å¼è½¬æ¢ä¸ºæœªå®ç°çš„é€‚é…å™¨çš„ç®€å•æ–¹æ³•ã€‚æ‚¨å¯ä»¥å°†ç”Ÿæˆçš„æ•°æ®é›†ä¸DialogFlowï¼ŒWit.aiå’ŒWatsonç­‰æä¾›ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚</li><li><a href="https://github.com/rodrigopivi/aida">Aida-nlp</a>æ˜¯ä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ†ç±»å’ŒNERçš„å°å‹å®éªŒæ€§NLPæ·±åº¦å­¦ä¹ åº“ã€‚ä½¿ç”¨Tensorflow.jsï¼ŒKeraså’ŒChatitoæ„å»ºã€‚åœ¨JSå’ŒPythonä¸­å®ç°ã€‚</li></ul><h2 id="è½¬æ¥å™¨"><a href="#è½¬æ¥å™¨" class="headerlink" title="è½¬æ¥å™¨"></a>è½¬æ¥å™¨</h2><p>è¯¥è¯­è¨€ä¸ç”Ÿæˆçš„è¾“å‡ºæ ¼å¼æ— å…³ï¼Œå¹¶ä¸”ç”±äºæ¯ä¸ªæ¨¡å‹éƒ½å¯ä»¥æ¥æ”¶ä¸åŒçš„å‚æ•°å’Œè®¾ç½®ï¼Œå› æ­¤è¿™æ˜¯å½“å‰å®ç°çš„æ•°æ®æ ¼å¼ï¼Œå¦‚æœæœªåˆ—å‡ºæ‚¨çš„æä¾›è€…ï¼Œåˆ™åœ¨â€œå·¥å…·å’Œèµ„æºâ€éƒ¨åˆ†ä¸­å°†æä¾›æœ‰å…³å¦‚ä½•æ”¯æŒæ›´å¤šä¿¡æ¯çš„æ›´å¤šä¿¡æ¯ã€‚æ ¼å¼ã€‚</p><p>æ³¨æ„ï¼šæ ·æœ¬ä¸ä¼šåœ¨æ„å›¾ä¹‹é—´æ‰“ä¹±ï¼Œä»¥ä¾¿äºæŸ¥çœ‹ï¼Œå¹¶ä¸”å› ä¸ºæŸäº›é€‚é…å™¨å°†æ ·æœ¬ç›´æ¥æµåˆ°æ–‡ä»¶ä¸­ï¼Œå› æ­¤å»ºè®®å°†æ„å›¾æ‹†åˆ†åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿äºæŸ¥çœ‹å’Œç»´æŠ¤</p><h3 id="Rasa"><a href="#Rasa" class="headerlink" title="Rasa"></a><a href="https://rasa.com/docs/rasa/">Rasa</a></h3><p><a href="https://rasa.com/docs/rasa/">Rasa</a>æ˜¯ä¸€ä¸ªå¼€æºçš„æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œç”¨äºåŸºäºæ–‡æœ¬å’Œè¯­éŸ³çš„è‡ªåŠ¨å¯¹è¯ã€‚äº†è§£æ¶ˆæ¯ï¼Œè¿›è¡Œå¯¹è¯å¹¶è¿æ¥åˆ°æ¶ˆæ¯ä¼ é€’é€šé“å’ŒAPIã€‚Chatitoå¯ä»¥å¸®åŠ©æ‚¨ä¸º<a href="https://rasa.com/docs/rasa/nlu/about/">Rasa NLU</a>ç»„ä»¶æ„å»ºæ•°æ®é›†ã€‚</p><p>Rasaé€‚é…å™¨çš„ä¸€ç§ç‰¹æ®Šè¡Œä¸ºæ˜¯ï¼Œå½“æ’æ§½å®šä¹‰è¯­å¥ä»…åŒ…å«ä¸€ä¸ªåˆ«åï¼Œå¹¶ä¸”è¯¥åˆ«åå°†â€œ synonymâ€å‚æ•°å®šä¹‰ä¸ºâ€œ trueâ€æ—¶ï¼Œç”Ÿæˆçš„Rasaæ•°æ®é›†ä¼šå°†åˆ«åæ˜ å°„ä¸ºåŒä¹‰è¯ã€‚ä¾‹å¦‚ï¼š</p><pre><code>%[some intent]('training': '1')    @[some slot]@[some slot]    ~[some slot synonyms]~[some slot synonyms]('synonym': 'true')    synonym 1    synonym 2</code></pre><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç”Ÿæˆçš„Rasaæ•°æ®é›†å°†åŒ…å«<code>entity_synonyms</code>of<code>synonym 1</code>å¹¶<code>synonym 2</code>æ˜ å°„åˆ°<code>some slot synonyms</code>ã€‚</p><h3 id="Flair"><a href="#Flair" class="headerlink" title="Flair"></a><a href="https://github.com/zalandoresearch/flair">Flair</a></h3><p><a href="https://github.com/zalandoresearch/flair">Flair</a>æœ€å…ˆè¿›çš„NLPæ¡†æ¶ã€‚Zalando Researchå¼€å‘ã€‚å®ƒæä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„è¯­è¨€çš„æœ€æ–°æŠ€æœ¯<a href="https://github.com/zalandoresearch/flair/blob/master/resources/docs/TUTORIAL_4_ELMO_BERT_FLAIR_EMBEDDING.md">ï¼ˆGPTï¼ŒBERTï¼ŒRoBERTaï¼ŒXLNetï¼ŒELMoç­‰ï¼‰çš„</a>é¢„è®­ç»ƒåµŒå…¥ã€‚æ­¤é€‚é…å™¨æ”¯æŒ<code>text classification</code>FastTextæ ¼å¼çš„<code>named entity recognition</code>æ•°æ®é›†å’Œä¸¤åˆ—å¸¦æœ‰<a href="https://en.wikipedia.org/wiki/Inside%E2%80%93outside%E2%80%93beginning_(tagging)">BIO</a>æ³¨é‡Šçš„å•è¯çš„æ•°æ®é›†ï¼Œå¦‚<a href="https://github.com/zalandoresearch/flair/blob/master/resources/docs/TUTORIAL_6_CORPUS.md">flair corpusæ–‡æ¡£ä¸­æ‰€è¿°</a>ã€‚è¿™ä¸¤ç§æ•°æ®æ ¼å¼éå¸¸å¸¸è§ï¼Œå¹¶ä¸”åœ¨è®¸å¤šå…¶ä»–æä¾›ç¨‹åºæˆ–æ¨¡å‹ä¸­ä¹Ÿå¾ˆå¸¸è§ã€‚</p><p>NERæ•°æ®é›†éœ€è¦å•è¯åˆ†è¯å¤„ç†ï¼Œè¯¥å¤„ç†ç›®å‰ä½¿ç”¨<a href="https://github.com/rodrigopivi/Chatito/tree/master/src">ç®€å•çš„åˆ†è¯å™¨è¿›è¡Œ</a>ã€‚</p><p>æ³¨æ„ï¼šFlairé€‚é…å™¨ä»…é€‚ç”¨äºNodeJS NPM CLIè½¯ä»¶åŒ…ï¼Œä¸é€‚ç”¨äºIDEã€‚</p><h3 id="LUIS"><a href="#LUIS" class="headerlink" title="LUIS"></a><a href="https://www.luis.ai/">LUIS</a></h3><p><a href="https://www.luis.ai/">LUIS</a>æ˜¯Microsoftè®¤çŸ¥æœåŠ¡çš„ä¸€éƒ¨åˆ†ã€‚Chatitoæ”¯æŒé€šè¿‡å…¶<a href="https://westus.dev.cognitive.microsoft.com/docs/services/5890b47c39e2bb17b84a55ff/operations/5890b47c39e2bb052c5b9c09">æ‰¹å¤„ç†æ·»åŠ æ ‡è®°çš„è¯è¯­ç«¯ç‚¹</a>å’Œ<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/luis-how-to-batch-test">æ‰¹å¤„ç†æµ‹è¯•apiæ¥</a>è®­ç»ƒLUIS NLUæ¨¡å‹ã€‚</p><p>è¦è®­ç»ƒLUISæ¨¡å‹ï¼Œæ‚¨éœ€è¦å°†è¯­éŸ³åˆ†æ‰¹å‘å¸ƒåˆ°ç›¸å…³çš„APIè¿›è¡Œè®­ç»ƒæˆ–æµ‹è¯•ã€‚</p><p>å‚è€ƒé—®é¢˜ï¼š<a href="https://github.com/rodrigopivi/Chatito/issues/61">ï¼ƒ61</a></p><h3 id="SnipsNLU"><a href="#SnipsNLU" class="headerlink" title="SnipsNLU"></a><a href="https://snips-nlu.readthedocs.io/en/latest/">SnipsNLU</a></h3><p><a href="https://snips-nlu.readthedocs.io/en/latest/">Snips NLU</a>æ˜¯<a href="https://snips-nlu.readthedocs.io/en/latest/">NLU</a>çš„å¦ä¸€ä¸ªå¾ˆæ£’çš„å¼€æºæ¡†æ¶ã€‚Snipsé€‚é…å™¨çš„ä¸€ç§ç‰¹æ®Šè¡Œä¸ºæ˜¯å¯ä»¥ä¸ºæ’æ§½å®šä¹‰å®ä½“ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p><pre><code>%[date search]('training':'1')   for @[date]@[date]('entity': 'snips/datetime')    ~[today]    ~[tomorrow]</code></pre><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰<code>@[date]</code>å€¼éƒ½å°†ä½¿ç”¨<code>snips/datetime</code>å®ä½“æ ‡è®°è¿›è¡Œæ ‡è®°ã€‚</p><h3 id="é¢„è®¾æ ¼å¼"><a href="#é¢„è®¾æ ¼å¼" class="headerlink" title="é¢„è®¾æ ¼å¼"></a>é¢„è®¾æ ¼å¼</h3><p>å¦‚æœè®¡åˆ’è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹æˆ–æ­£åœ¨ç¼–å†™è‡ªå®šä¹‰é€‚é…å™¨ï¼Œè¯·ä½¿ç”¨é»˜è®¤æ ¼å¼ã€‚è¿™æ˜¯æœ€çµæ´»çš„æ ¼å¼ï¼Œå› ä¸ºæ‚¨å¯ä»¥æ³¨é‡Š<code>Slots</code>å¹¶<code>Intents</code>ä½¿ç”¨è‡ªå®šä¹‰å®ä½“å‚æ•°ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½å°†å‡ºç°åœ¨ç”Ÿæˆçš„è¾“å‡ºä¸­ï¼Œå› æ­¤ï¼Œä¾‹å¦‚ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨DSLä¸­åŒ…æ‹¬å¯¹è¯/å“åº”ç”Ÿæˆé€»è¾‘ã€‚ä¾‹å¦‚ï¼š</p><pre><code>%[some intent]('context': 'some annotation')    @[some slot] ~[please?]@[some slot]('required': 'true', 'type': 'some type')    ~[some alias here]</code></pre><p>è‡ªå®šä¹‰å®ä½“ï¼ˆä¾‹å¦‚â€œä¸Šä¸‹æ–‡â€ï¼Œâ€œå¿…éœ€â€å’Œâ€œç±»å‹â€ï¼‰å°†åœ¨è¾“å‡ºå¤„å¯ç”¨ï¼Œå› æ­¤æ‚¨å¯ä»¥æ ¹æ®éœ€è¦å¤„ç†æ­¤è‡ªå®šä¹‰å‚æ•°ã€‚</p><h2 id="NPMè½¯ä»¶åŒ…"><a href="#NPMè½¯ä»¶åŒ…" class="headerlink" title="NPMè½¯ä»¶åŒ…"></a>NPMè½¯ä»¶åŒ…</h2><p>Chatitoæ”¯æŒNode.jsçš„<code>&gt;= v8.11</code>ã€‚</p><p>ç”¨yarnæˆ–npmå®‰è£…ï¼š</p><pre><code>npm i chatito --save</code></pre><p>ç„¶å<code>trainClimateBot.chatito</code>ä½¿ç”¨æ‚¨çš„ä»£ç åˆ›å»ºä¸€ä¸ªå®šä¹‰æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šï¼‰ã€‚</p><p>è¿è¡Œnpmç”Ÿæˆå™¨ï¼š</p><pre><code>npx chatito trainClimateBot.chatito</code></pre><p>ç”Ÿæˆçš„æ•°æ®é›†åº”åœ¨å®šä¹‰æ–‡ä»¶æ—è¾¹å¯ç”¨ã€‚</p><p>è¿™æ˜¯å®Œæ•´çš„npmç”Ÿæˆå™¨é€‰é¡¹ï¼š</p><pre class=" language-shell"><code class="language-shell">npx chatito <pathToFileOrDirectory> --format=<format> --formatOptions=<formatOptions> --outputPath=<outputPath> --trainingFileName=<trainingFileName> --testingFileName=<testingFileName> --defaultDistribution=<defaultDistribution> --autoAliases=<autoAliases></code></pre><ul><li><code>&lt;pathToFileOrDirectory&gt;``.chatito</code>åŒ…å«chatitoæ–‡ä»¶çš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚å¦‚æœæ˜¯ç›®å½•ï¼Œå°†é€’å½’æœç´¢å…¶ä¸­çš„æ‰€æœ‰<code>*.chatito</code>æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬ç”Ÿæˆæ•°æ®é›†ã€‚ä¾‹å¦‚ï¼š<code>lightsChange.chatito</code>æˆ–<code>./chatitoFilesFolder</code></li><li><code>&lt;format&gt;</code>å¯é€‰çš„ã€‚<code>default</code>ï¼Œ<code>rasa</code>ï¼Œ<code>luis</code>ï¼Œ<code>flair</code>æˆ–<code>snips</code>ã€‚</li><li><code>&lt;formatOptions&gt;</code>å¯é€‰çš„ã€‚æ¯ä¸ªé€‚é…å™¨å¯ä»¥é€‰æ‹©ä½¿ç”¨çš„.jsonæ–‡ä»¶çš„è·¯å¾„</li><li><code>&lt;outputPath&gt;</code>å¯é€‰çš„ã€‚ä¿å­˜ç”Ÿæˆçš„æ•°æ®é›†çš„ç›®å½•ã€‚ä½¿ç”¨å½“å‰ç›®å½•ä½œä¸ºé»˜è®¤ç›®å½•ã€‚</li><li><code>&lt;trainingFileName&gt;</code>å¯é€‰çš„ã€‚ç”Ÿæˆçš„è®­ç»ƒæ•°æ®é›†æ–‡ä»¶çš„åç§°ã€‚ä¸è¦å¿˜è®°åœ¨æœ«å°¾æ·»åŠ .jsonæ‰©å±•åã€‚ä½¿ç”¨<code>&lt;format&gt;</code>_dataset_training.jsonä½œä¸ºé»˜è®¤æ–‡ä»¶åã€‚</li><li><code>&lt;testingFileName&gt;</code>å¯é€‰çš„ã€‚ç”Ÿæˆçš„æµ‹è¯•æ•°æ®é›†æ–‡ä»¶çš„åç§°ã€‚ä¸è¦å¿˜è®°åœ¨æœ«å°¾æ·»åŠ .jsonæ‰©å±•åã€‚ä½¿ç”¨<code>&lt;format&gt;</code>_dataset_testing.jsonä½œä¸ºé»˜è®¤æ–‡ä»¶åã€‚</li><li><code>&lt;defaultDistribution&gt;</code>å¯é€‰çš„ã€‚å¦‚æœæœªåœ¨å®ä½“çº§åˆ«å®šä¹‰é»˜è®¤é¢‘ç‡åˆ†å¸ƒã€‚é»˜è®¤ä¸º<code>regular</code>ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>even</code>ã€‚</li><li><code>&lt;autoAliases&gt;</code>å¯é€‰çš„ã€‚æŸ¥æ‰¾æœªå®šä¹‰åˆ«åæ—¶çš„å±å±è¡Œä¸ºã€‚æœ‰æ•ˆopionsæ˜¯<code>allow</code>ï¼Œ<code>warn</code>ï¼Œ<code>restrict</code>ã€‚å–æ¶ˆè®¾ç½®ä¸ºâ€œå…è®¸â€ã€‚</li></ul><h1 id="Chatitoè§„æ ¼"><a href="#Chatitoè§„æ ¼" class="headerlink" title="Chatitoè§„æ ¼"></a>Chatitoè§„æ ¼</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1-æ¦‚è¿°"></a>1-æ¦‚è¿°</h2><p>Chatitoæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œæ—¨åœ¨ç®€åŒ–åˆ›å»ºï¼Œæ‰©å±•å’Œç»´æŠ¤æ•°æ®é›†çš„è¿‡ç¨‹ï¼Œä»¥è®­ç»ƒå’ŒéªŒè¯ç”¨äºæ–‡æœ¬åˆ†ç±»ï¼Œå‘½åå®ä½“è¯†åˆ«ï¼Œæ’æ§½å¡«å……æˆ–ç­‰æ•ˆä»»åŠ¡çš„è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰æ¨¡å‹ã€‚</p><p>Chatitoè®¾è®¡åŸåˆ™ï¼š</p><ul><li>å®ç”¨æ€§ï¼šæ­¤å·¥å…·æ—¨åœ¨å¸®åŠ©ä½¿ç”¨å®ƒçš„äººï¼Œè®¾è®¡åº”ä»¥ç¤¾åŒºéœ€æ±‚ä¸ºæŒ‡å¯¼</li><li>é€Ÿåº¦ï¼šé€šè¿‡æŒ‰éœ€ä»æ¦‚ç‡äº‘ä¸­æŠ½å–æ ·æœ¬æ¥ç”Ÿæˆæ ·æœ¬</li><li>ç®€æ´æ€§ï¼šåˆæ¬¡çœ‹çš„äººåº”è¯¥å¯ä»¥ç†è§£</li></ul><p>éµå¾ªè¿™äº›åŸåˆ™ï¼Œè¿™æ˜¯è¯¥è¯­è¨€åŠå…¶ç”Ÿæˆçš„è¾“å‡ºçš„ç¤ºä¾‹ï¼š</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(13)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-13/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-13/</url>
      
        <content type="html"><![CDATA[<h1 id="å®ä½“æå–"><a href="#å®ä½“æå–" class="headerlink" title="å®ä½“æå–"></a>å®ä½“æå–</h1><p>å®ä½“æå–æ¶‰åŠè§£æç”¨æˆ·æ¶ˆæ¯ä»¥è·å–æ‰€éœ€çš„ä¿¡æ¯ã€‚Rasa Open Sourceæä¾›äº†ç”¨äºè‡ªå®šä¹‰å®ä½“ä»¥åŠæ—¥æœŸå’Œä½ç½®ç­‰ç»è¿‡é¢„å…ˆè®­ç»ƒçš„å®ä½“çš„å®ä½“æå–å™¨ã€‚ä»¥ä¸‹æ˜¯å¯ç”¨æå–å™¨åŠå…¶ç”¨é€”çš„æ‘˜è¦ï¼š</p><table><thead><tr><th align="left">é›¶ä»¶</th><th align="left">éœ€è¦</th><th align="left">æ¨¡å‹</th><th align="left"><strong>Notes</strong></th></tr></thead><tbody><tr><td align="left"><code>CRFEntityExtractor</code></td><td align="left">sklearn-crfsuite</td><td align="left">æ¡ä»¶éšæœºåœº</td><td align="left">é€‚åˆè®­ç»ƒè‡ªå®šä¹‰å®ä½“</td></tr><tr><td align="left"><code>SpacyEntityExtractor</code></td><td align="left">ç©ºé—´</td><td align="left">å¹³å‡æ„ŸçŸ¥å™¨</td><td align="left">æä¾›é¢„å…ˆè®­ç»ƒçš„å®ä½“</td></tr><tr><td align="left"><code>DucklingHTTPExtractor</code></td><td align="left">å°é¸­</td><td align="left">ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•</td><td align="left">æä¾›é¢„å…ˆè®­ç»ƒçš„å®ä½“</td></tr><tr><td align="left"><code>MitieEntityExtractor</code></td><td align="left">ä¸‰ç¾</td><td align="left">ç»“æ„åŒ–æ”¯æŒå‘é‡æœº</td><td align="left">é€‚åˆè®­ç»ƒè‡ªå®šä¹‰å®ä½“</td></tr><tr><td align="left"><code>EntitySynonymMapper</code></td><td align="left">ç°æœ‰å®ä½“</td><td align="left">N/A</td><td align="left">æ˜ å°„å·²çŸ¥çš„åŒä¹‰è¯</td></tr><tr><td align="left"><code>DIETClassifier</code></td><td align="left"></td><td align="left">å˜å‹å™¨é¡¶éƒ¨çš„æ¡ä»¶éšæœºåœº</td><td align="left">é€‚åˆè®­ç»ƒè‡ªå®šä¹‰å®ä½“</td></tr></tbody></table><ul><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#the-entity-object">â€œå®ä½“â€å¯¹è±¡</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#custom-entities">è‡ªå®šä¹‰å®ä½“</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#entities-roles-and-groups">å®ä½“è§’è‰²å’Œç¾¤ç»„</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#extracting-places-dates-people-organizations">æå–åœ°ç‚¹ï¼Œæ—¥æœŸï¼Œäººå‘˜ï¼Œç»„ç»‡</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#dates-amounts-of-money-durations-distances-ordinals">æ—¥æœŸï¼Œé‡‘é¢ï¼ŒæŒç»­æ—¶é—´ï¼Œè·ç¦»ï¼Œå¸¸è§„</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#regular-expressions-regex">æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/entity-extraction/#passing-custom-features-to-crfentityextractor">å°†è‡ªå®šä¹‰åŠŸèƒ½ä¼ é€’ç»™ <code>CRFEntityExtractor</code></a></li></ul><h2 id="å®ä½“â€å¯¹è±¡"><a href="#å®ä½“â€å¯¹è±¡" class="headerlink" title="å®ä½“â€å¯¹è±¡"></a>å®ä½“â€å¯¹è±¡</h2><p>è§£æåï¼Œå®ä½“ä½œä¸ºå­—å…¸è¿”å›ã€‚æœ‰ä¸¤ä¸ªå­—æ®µæ˜¾ç¤ºæœ‰å…³ç®¡é“å¦‚ä½•å½±å“è¿”å›çš„å®ä½“çš„ä¿¡æ¯ï¼š<code>extractor</code>ä¸€ä¸ªå®ä½“çš„å­—æ®µå‘Šè¯‰æ‚¨å“ªä¸ªå®ä½“æå–å™¨æ‰¾åˆ°äº†è¯¥ç‰¹å®šå®ä½“ï¼Œè€Œè¯¥<code>processors</code>å­—æ®µåŒ…å«æ›´æ”¹äº†è¯¥ç‰¹å®šå®ä½“çš„ç»„ä»¶çš„åç§°ã€‚</p><p>ä½¿ç”¨åŒä¹‰è¯å¯èƒ½ä¼šå¯¼è‡´<code>value</code>å­—æ®µä¸<code>text</code> å®Œå…¨åŒ¹é…ã€‚ç›¸åï¼Œå®ƒå°†è¿”å›ç»è¿‡è®­ç»ƒçš„åŒä¹‰è¯ã€‚</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"show me chinese restaurants"</span><span class="token punctuation">,</span>  <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"restaurant_search"</span><span class="token punctuation">,</span>  <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>      <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"chinese"</span><span class="token punctuation">,</span>      <span class="token property">"entity"</span><span class="token operator">:</span> <span class="token string">"cuisine"</span><span class="token punctuation">,</span>      <span class="token property">"extractor"</span><span class="token operator">:</span> <span class="token string">"CRFEntityExtractor"</span><span class="token punctuation">,</span>      <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.854</span><span class="token punctuation">,</span>      <span class="token property">"processors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span>  <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><blockquote><p>æ³¨æ„</p><p>åœ¨<code>confidence</code>å°†è¢«è®¾ç½®<code>CRFEntityExtractor</code>çš„ç»„ä»¶ã€‚åœ¨ <code>DucklingHTTPExtractor</code>å°†å§‹ç»ˆè¿”å›<code>1</code>ã€‚åœ¨<code>SpacyEntityExtractor</code>æå–å’Œ<code>DIETClassifier</code>ä¸æä¾›æ­¤ä¿¡æ¯å¹¶è¿”å›<code>null</code>ã€‚</p></blockquote><p>æŸäº›æå–å™¨ï¼ˆå¦‚<code>duckling</code>ï¼‰å¯èƒ½åŒ…å«å…¶ä»–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"additional_info"</span><span class="token operator">:</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"grain"</span><span class="token operator">:</span><span class="token string">"day"</span><span class="token punctuation">,</span>    <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"value"</span><span class="token punctuation">,</span>    <span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"2018-06-21T00:00:00.000-07:00"</span><span class="token punctuation">,</span>    <span class="token property">"values"</span><span class="token operator">:</span><span class="token punctuation">[</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"grain"</span><span class="token operator">:</span><span class="token string">"day"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"value"</span><span class="token punctuation">,</span>        <span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"2018-06-21T00:00:00.000-07:00"</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>  <span class="token property">"confidence"</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token property">"end"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>  <span class="token property">"entity"</span><span class="token operator">:</span><span class="token string">"time"</span><span class="token punctuation">,</span>  <span class="token property">"extractor"</span><span class="token operator">:</span><span class="token string">"DucklingHTTPExtractor"</span><span class="token punctuation">,</span>  <span class="token property">"start"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"today"</span><span class="token punctuation">,</span>  <span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"2018-06-21T00:00:00.000-07:00"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h2 id="è‡ªå®šä¹‰å®ä½“"><a href="#è‡ªå®šä¹‰å®ä½“" class="headerlink" title="è‡ªå®šä¹‰å®ä½“"></a>è‡ªå®šä¹‰å®ä½“</h2><p>å‡ ä¹æ¯ä¸ªèŠå¤©æœºå™¨äººå’Œè¯­éŸ³åº”ç”¨ç¨‹åºéƒ½ä¼šæœ‰ä¸€äº›è‡ªå®šä¹‰å®ä½“ã€‚é¤é¥®åŠ©ç†åº”è¯¥<code>chinese</code>å°†ç¾é£Ÿç†è§£ä¸ºç¾é£Ÿï¼Œä½†æ˜¯å¯¹äºè¯­è¨€å­¦ä¹ åŠ©æ‰‹æ¥è¯´ï¼Œæ„ä¹‰å´å¤§ä¸ç›¸åŒã€‚åœ¨<code>CRFEntityExtractor</code>å’Œ<code>DIETClassifier</code>ç»„ä»¶å¯ä»¥å­¦ä¹ ä»»ä½•è¯­è¨€çš„è‡ªå®šä¹‰å®ä½“ï¼Œç»™äºˆä¸€å®šçš„è®­ç»ƒæ•°æ®ã€‚æœ‰å…³å¦‚ä½•åœ¨è®­ç»ƒæ•°æ®ä¸­åŒ…æ‹¬å®ä½“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">è®­ç»ƒæ•°æ®æ ¼å¼</a>ã€‚</p><h2 id="å®ä½“è§’è‰²å’Œç»„"><a href="#å®ä½“è§’è‰²å’Œç»„" class="headerlink" title="å®ä½“è§’è‰²å’Œç»„"></a>å®ä½“è§’è‰²å’Œç»„</h2><blockquote><p>è­¦å‘Š</p><p>æ­¤åŠŸèƒ½æ˜¯å®éªŒæ€§çš„ã€‚æˆ‘ä»¬å¼•å…¥å®éªŒæ€§åŠŸèƒ½ä»¥è·å–ç¤¾åŒºçš„åé¦ˆï¼Œå› æ­¤æˆ‘ä»¬é¼“åŠ±æ‚¨å°è¯•ä¸€ä¸‹ï¼ä½†æ˜¯ï¼Œå°†æ¥å¯èƒ½ä¼šæ›´æ”¹æˆ–åˆ é™¤åŠŸèƒ½ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•åé¦ˆï¼ˆæ­£é¢æˆ–è´Ÿé¢ï¼‰ï¼Œè¯·åœ¨<a href="https://forum.rasa.com/">è®ºå›</a>ä¸Šä¸æˆ‘ä»¬åˆ†äº«ã€‚</p></blockquote><p>å°†è‡ªå®šä¹‰å®ä½“æ ‡ç­¾åˆ†é…ç»™å•è¯ï¼Œå¯ä»¥å®šä¹‰æ•°æ®ä¸­çš„æŸäº›æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŸå¸‚æ˜¯ä»€ä¹ˆï¼š</p><pre class=" language-text"><code class="language-text">I want to fly from [Berlin](city) to [San Francisco](city).</code></pre><p>ä½†æ˜¯ï¼Œæœ‰æ—¶æ‚¨æƒ³è¿›ä¸€æ­¥æŒ‡å®šå®ä½“ã€‚å‡è®¾æˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªå¯ä»¥ä¸ºæˆ‘ä»¬é¢„è®¢èˆªç­çš„åŠ©æ‰‹ã€‚åŠ©æ‰‹éœ€è¦çŸ¥é“ä¸Šä¾‹ä¸­çš„ä¸¤ä¸ªåŸå¸‚ä¸­çš„å“ªä¸ªæ˜¯å‡ºå‘åŸå¸‚ï¼Œå“ªä¸ªæ˜¯ç›®çš„åœ°åŸå¸‚ã€‚ <code>Berlin</code>å¹¶ä¸”è¿˜åœ¨åŸå¸‚ï¼Œä½†ä»–ä»¬åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å‘æŒ¥ä¸åŒçš„ä½œç”¨ã€‚ä¸ºäº†åŒºåˆ†ä¸åŒçš„è§’è‰²ï¼Œé™¤äº†å®ä½“æ ‡ç­¾ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åˆ†é…ä¸€ä¸ªè§’è‰²æ ‡ç­¾ã€‚<code>San Francisco</code></p><pre class=" language-text"><code class="language-text">- I want to fly from [Berlin]&#123;"entity": "city", "role": "departure"&#125; to [San Francisco]&#123;"entity": "city", "role": "destination"&#125;.</code></pre><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨å®ä½“æ ‡ç­¾æ—è¾¹æŒ‡å®šä¸€ä¸ªç»„æ ‡ç­¾æ¥å¯¹ä¸åŒçš„å®ä½“è¿›è¡Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œç»„æ ‡ç­¾å¯ç”¨äºå®šä¹‰ä¸åŒçš„é¡ºåºã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»„æ ‡ç­¾æ¥å¼•ç”¨å“ªç§æ¯”è¨é¥¼å¸¦æœ‰ä»€ä¹ˆæ ·çš„é…æ–™ä»¥åŠå“ªç§æ¯”è¨é¥¼å…·æœ‰å¤šå°‘å°ºå¯¸ã€‚</p><pre class=" language-text"><code class="language-text">Give me a [small]&#123;"entity": "size", "group": "1"&#125; pizza with [mushrooms]&#123;"entity": "topping", "group": "1"&#125; anda [large]&#123;"entity": "size", "group": "2"&#125; [pepperoni]&#123;"entity": "topping", "group": "2"&#125;</code></pre><p>æœ‰å…³å¦‚ä½•åœ¨åŸ¹è®­æ•°æ®ä¸­å®šä¹‰å…·æœ‰è§’è‰²å’Œç»„çš„å®ä½“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">åŸ¹è®­æ•°æ®æ ¼å¼</a>ã€‚</p><p>æå–ç¨‹åºè¿”å›çš„å®ä½“å¯¹è±¡å°†åŒ…å«æ£€æµ‹åˆ°çš„è§’è‰²/ç»„æ ‡ç­¾ã€‚</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Book a flight from Berlin to SF"</span><span class="token punctuation">,</span>  <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"book_flight"</span><span class="token punctuation">,</span>  <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>      <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>      <span class="token property">"entity"</span><span class="token operator">:</span> <span class="token string">"city"</span><span class="token punctuation">,</span>      <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"departure"</span><span class="token punctuation">,</span>      <span class="token property">"extractor"</span><span class="token operator">:</span> <span class="token string">"DIETClassifier"</span><span class="token punctuation">,</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    &amp;#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>      <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"San Francisco"</span><span class="token punctuation">,</span>      <span class="token property">"entity"</span><span class="token operator">:</span> <span class="token string">"city"</span><span class="token punctuation">,</span>      <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"destination"</span><span class="token punctuation">,</span>      <span class="token property">"extractor"</span><span class="token operator">:</span> <span class="token string">"DIETClassifier"</span><span class="token punctuation">,</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span>  <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><blockquote><p>æ³¨æ„</p><p>å½“å‰ä»…<a href="#">DIETClassifier</a>å’Œ<a href="#">CRFEntityExtractor</a>æ”¯æŒå¤åˆå®ä½“ã€‚</p></blockquote><p>ä¸ºäº†ä½¿ç”¨å…·æœ‰è§’è‰²/ç»„çš„å®ä½“æ­£ç¡®åœ°è®­ç»ƒæ¨¡å‹ï¼Œè¯·ç¡®ä¿ä¸ºå®ä½“å’Œè§’è‰²/ç»„æ ‡ç­¾çš„æ¯ç§ç»„åˆéƒ½åŒ…æ‹¬è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ç¤ºä¾‹ã€‚å¦å¤–ï¼Œè¯·ç¡®ä¿æ‚¨çš„è®­ç»ƒæ•°æ®æœ‰æ‰€ä¸åŒï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿæ¨å¹¿ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸ä»…åº”å…·æœ‰ç¤ºä¾‹è¿™æ ·çš„ç¤ºä¾‹ï¼Œè¿˜åº”åŒ…å«ç¤ºä¾‹ ã€‚<code>fly FROM x TO y``fly TO y FROM x</code></p><p>è¦ä»å…·æœ‰ç‰¹å®šè§’è‰²/ç»„çš„å®ä½“ä¸­å¡«å……æ’æ§½ï¼Œæ‚¨éœ€è¦ä½¿ç”¨â€œ<a href="#">è¡¨å•â€</a>å®šä¹‰è‡ªå®šä¹‰æ’æ§½æ˜ å°„ï¼Œ æˆ–ä½¿ç”¨â€œ<a href="#">è‡ªå®šä¹‰åŠ¨ä½œâ€</a>ç›´æ¥ä»è·Ÿè¸ªå™¨ä¸­æå–ç›¸åº”çš„å®ä½“ã€‚</p><h2 id="æå–åœ°ç‚¹ï¼Œæ—¥æœŸï¼Œäººï¼Œç»„ç»‡"><a href="#æå–åœ°ç‚¹ï¼Œæ—¥æœŸï¼Œäººï¼Œç»„ç»‡" class="headerlink" title="æå–åœ°ç‚¹ï¼Œæ—¥æœŸï¼Œäººï¼Œç»„ç»‡"></a>æå–åœ°ç‚¹ï¼Œæ—¥æœŸï¼Œäººï¼Œç»„ç»‡</h2><p>spaCyå…·æœ‰é’ˆå¯¹å‡ ç§ä¸åŒè¯­è¨€çš„å‡ºè‰²çš„ç»è¿‡é¢„å…ˆè®­ç»ƒçš„å‘½åå®ä½“è¯†åˆ«å™¨ã€‚æ‚¨å¯ä»¥åœ¨æ­¤<a href="https://demos.explosion.ai/displacy-ent/">äº¤äº’å¼æ¼”ç¤ºä¸­</a>å¯¹å…¶è¿›è¡Œæµ‹è¯• ã€‚æˆ‘ä»¬ä¸å»ºè®®æ‚¨å°è¯•ä½¿ç”¨spaCyæ¥è®­ç»ƒè‡ªå·±çš„NERï¼Œé™¤éæ‚¨æœ‰å¤§é‡æ•°æ®å¹¶ä¸”çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚è¯·æ³¨æ„ï¼ŒæŸäº›spaCyæ¨¡å‹é«˜åº¦åŒºåˆ†å¤§å°å†™ã€‚</p><h2 id="æ—¥æœŸï¼Œé‡‘é¢ï¼ŒæœŸé™ï¼Œè·ç¦»ï¼Œåºå·"><a href="#æ—¥æœŸï¼Œé‡‘é¢ï¼ŒæœŸé™ï¼Œè·ç¦»ï¼Œåºå·" class="headerlink" title="æ—¥æœŸï¼Œé‡‘é¢ï¼ŒæœŸé™ï¼Œè·ç¦»ï¼Œåºå·"></a>æ—¥æœŸï¼Œé‡‘é¢ï¼ŒæœŸé™ï¼Œè·ç¦»ï¼Œåºå·</h2><p>è¯¥<a href="https://duckling.wit.ai/">å°é¸­</a>åº“åšè½¬å¼¯ï¼Œå¦‚â€œæ™šä¸Š8ç‚¹ä¸‹å‘¨å››â€è¡¨è¿°ä¸ºå®é™…çš„datetimeå¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªäº†ä¸èµ·çš„å·¥ä½œ</p><pre><code>"next Thursday at 8pm"=&gt; &amp;#123;"value":"2018-05-31T20:00:00.000+01:00"&amp;#125;</code></pre><p>æ”¯æŒçš„è¯­è¨€åˆ—è¡¨å¯ä»¥åœ¨<a href="https://github.com/facebook/duckling/tree/master/Duckling/Dimensions">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚å°é¸­è¿˜å¯ä»¥å¤„ç†â€œä¸¤ä¸ªå°æ—¶â€ä¹‹ç±»çš„æŒç»­æ—¶é—´ï¼Œé‡‘é¢ï¼Œè·ç¦»å’Œå¸¸è§„æ—¶é—´ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªå°é¸­å­dockerå®¹å™¨å¯ä¾›ä½¿ç”¨ï¼Œæ‚¨åªéœ€è¦æ—‹è½¬å¹¶è¿æ¥åˆ°Rasa NLUï¼ˆè¯·å‚é˜…<a href="%EF%BC%83">DucklingHTTPExtractor</a>ï¼‰ã€‚</p><h2 id="æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰"><a href="#æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰"></a>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰</h2><p>æ‚¨å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å¸®åŠ©CRFæ¨¡å‹å­¦ä¹ è¯†åˆ«å®ä½“ã€‚åœ¨æ‚¨çš„è®­ç»ƒæ•°æ®ä¸­ï¼ˆè¯·å‚è§<a href="#">è®­ç»ƒæ•°æ®æ ¼å¼</a>ï¼‰ï¼Œæ‚¨å¯ä»¥æä¾›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨ï¼Œæ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æä¾›ä¸€ä¸ª<code>CRFEntityExtractor</code>å¸¦æœ‰é¢å¤–çš„äºŒè¿›åˆ¶åŠŸèƒ½çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯¥æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜æ˜¯å¦æ‰¾åˆ°äº†æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ1ï¼‰ï¼ˆ0ï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œå¾·å›½è¡—é“çš„åç§°é€šå¸¸ä»¥ç»“å°¾<code>strasse</code>ã€‚é€šè¿‡å°†å…¶æ·»åŠ ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å‘Šè¯‰æ¨¡å‹æ³¨æ„ä»¥è¿™ç§æ–¹å¼ç»“å°¾çš„å•è¯ï¼Œå¹¶å°†è¿…é€Ÿå­¦ä¹ å°†å…¶ä¸ä½ç½®å®ä½“ç›¸å…³è”ã€‚</p><p>å¦‚æœæ‚¨åªæƒ³ç²¾ç¡®åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™å¯ä»¥åœ¨æ”¶åˆ°Rasa NLUçš„å“åº”åï¼Œåœ¨ä»£ç ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œä½œä¸ºåå¤„ç†æ­¥éª¤ã€‚</p><h2 id="å°†è‡ªå®šä¹‰åŠŸèƒ½ä¼ é€’ç»™CRFEntityExtractor"><a href="#å°†è‡ªå®šä¹‰åŠŸèƒ½ä¼ é€’ç»™CRFEntityExtractor" class="headerlink" title="å°†è‡ªå®šä¹‰åŠŸèƒ½ä¼ é€’ç»™CRFEntityExtractor"></a>å°†è‡ªå®šä¹‰åŠŸèƒ½ä¼ é€’ç»™<code>CRFEntityExtractor</code></h2><p>å¦‚æœè¦å°†è‡ªå®šä¹‰åŠŸèƒ½ï¼ˆä¾‹å¦‚é¢„è®­ç»ƒçš„å•è¯åµŒå…¥ï¼‰ä¼ é€’ç»™<code>CRFEntityExtractor</code>ï¼Œåˆ™å¯ä»¥åœ¨ä¹‹å‰å‘ç®¡é“æ·»åŠ ä»»ä½•å¯†é›†çš„ç‰¹å¾åŒ–å™¨<code>CRFEntityExtractor</code>ã€‚ <code>CRFEntityExtractor</code>è‡ªåŠ¨æŸ¥æ‰¾å…¶ä»–å¯†é›†ç‰¹å¾ï¼Œå¹¶æ£€æŸ¥ç¨ å¯†ç‰¹å¾æ˜¯å¦ä¸ºçš„å¯è¿­ä»£é¡¹<code>len(tokens)</code>ï¼Œå…¶ä¸­æ¯ä¸ªæ¡ç›®å‡ä¸ºå‘é‡ã€‚å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå°†æ˜¾ç¤ºè­¦å‘Šã€‚ä½†æ˜¯ï¼Œ<code>CRFEntityExtractor</code>å°†ç»§ç»­è®­ç»ƒï¼Œè€Œæ— éœ€å…¶ä»–è‡ªå®šä¹‰åŠŸèƒ½ã€‚å¦‚æœå­˜åœ¨å¯†é›†ç‰¹å¾ï¼Œ<code>CRFEntityExtractor</code>å°†ä¼ é€’å¯†é›†ç‰¹å¾<code>sklearn_crfsuite</code> å¹¶å°†å…¶ç”¨äºè®­ç»ƒã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(12)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-12/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-12/</url>
      
        <content type="html"><![CDATA[<h1 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h1><p>è¿™æ˜¯Rasa Open Sourceä¸­æ¯ä¸ªå†…ç½®ç»„ä»¶çš„é…ç½®é€‰é¡¹çš„å‚è€ƒã€‚å¦‚æœè¦æ„å»ºè‡ªå®šä¹‰ç»„ä»¶ï¼Œè¯·æŸ¥è¯¢â€œ<a href="#">è‡ªå®šä¹‰</a></p><ul><li><a href="#">Word Vector Sources</a><ul><li><a href="#">MitieNLP</a></li><li><a href="#">SpacyNLP</a></li><li><a href="#">HFTransformersNLP</a></li></ul></li><li><a href="#">Tokenizers</a><ul><li><a href="#">WhitespaceTokenizer</a></li><li><a href="#">JiebaTokenizer</a></li><li><a href="#">MitieTokenizer</a></li><li><a href="#">SpacyTokenizer</a></li><li><a href="#">ConveRTTokenizer</a></li><li><a href="#">LanguageModelTokenizer</a></li></ul></li><li><a href="#">Text Featurizers</a><ul><li><a href="#">MitieFeaturizer</a></li><li><a href="#">SpacyFeaturizer</a></li><li><a href="#">ConveRTFeaturizer</a></li><li><a href="#">LanguageModelFeaturizer</a></li><li><a href="#">RegexFeaturizer</a></li><li><a href="#">CountVectorsFeaturizer</a></li><li><a href="#">LexicalSyntacticFeaturizer</a></li></ul></li><li><a href="#">Intent Classifiers</a><ul><li><a href="#">MitieIntentClassifier</a></li><li><a href="#">SklearnIntentClassifier</a></li><li><a href="#">EmbeddingIntentClassifier</a></li><li><a href="#">KeywordIntentClassifier</a></li><li><a href="#">DIETClassifier</a></li></ul></li><li><a href="#">Entity Extractors</a><ul><li><a href="#">MitieEntityExtractor</a></li><li><a href="#">SpacyEntityExtractor</a></li><li><a href="#">EntitySynonymMapper</a></li><li><a href="#">CRFEntityExtractor</a></li><li><a href="#">DucklingHTTPExtractor</a></li><li><a href="#">DIETClassifier</a></li></ul></li><li><a href="#">Selectors</a><ul><li><a href="#">ResponseSelector</a></li></ul></li><li><a href="#">Combined Entity Extractors and Intent Classifiers</a><ul><li><a href="#">DIETClassifier</a></li></ul></li></ul><h2 id="Word-Vector-Sources"><a href="#Word-Vector-Sources" class="headerlink" title="Word Vector Sources"></a>Word Vector Sources</h2><p>å¦‚æœè¦åœ¨ç®¡é“ä¸­ä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡ï¼Œä»¥ä¸‹ç»„ä»¶å°†åŠ è½½é¢„è®­ç»ƒçš„æ¨¡å‹ã€‚</p><h3 id="MitieNLP"><a href="#MitieNLP" class="headerlink" title="MitieNLP"></a>MitieNLP</h3><table><thead><tr><th>Short</th><th>MITIEåˆå§‹å€¼è®¾å®šé¡¹</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>åˆå§‹åŒ–MITIEç»“æ„ã€‚æ¯ä¸ªMITIEç»„ä»¶éƒ½ä¾èµ–äºæ­¤ï¼Œå› æ­¤åº”å°†å…¶æ”¾åœ¨ä½¿ç”¨ä»»ä½•MITIEç»„ä»¶çš„æ¯ä¸ªç®¡é“çš„å¼€å¤´ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>MITIEåº“éœ€è¦ä¸€ä¸ªè¯­è¨€æ¨¡å‹æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶<strong>å¿…é¡»</strong>åœ¨é…ç½®ä¸­æŒ‡å®šï¼š<br><br> pipeline: <br>- name: â€œMitieNLPâ€   # language model to load   <br>model: â€œdata/total_word_feature_extractor.datâ€<br><br>æœ‰å…³ä»ä½•å¤„è·å–è¯¥æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç»§ç»­ <a href="#">å®‰è£…MITIE</a>ã€‚</td></tr></tbody></table><h3 id="SpacyNLP"><a href="#SpacyNLP" class="headerlink" title="SpacyNLP"></a>SpacyNLP</h3><table><thead><tr><th>Short</th><th>SpacyNLPåˆå§‹å€¼è®¾å®šé¡¹</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>åˆå§‹åŒ–ç©ºé—´ç»“æ„ã€‚æ¯ä¸ªspaCyç»„ä»¶éƒ½ä¾èµ–äºæ­¤ï¼Œå› æ­¤åº”å°†å…¶æ”¾ç½®åœ¨ä½¿ç”¨ä»»ä½•spaCyç»„ä»¶çš„æ¯ä¸ªç®¡é“çš„å¼€å¤´ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>æ‚¨éœ€è¦æŒ‡å®šè¦ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡é“ä¸­é…ç½®çš„è¯­è¨€å°†ç”¨ä½œè¯­è¨€æ¨¡å‹åç§°ã€‚å¦‚æœè¦ä½¿ç”¨çš„æ¨¡å‹spaCyå…·æœ‰åç§°æ˜¯ä»è¯­è¨€æ ‡ç­¾ï¼ˆä¸åŒ<code>"en"</code>ï¼Œ<code>"de"</code>ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨é…ç½®å˜é‡æŒ‡å®šçš„å‹å·åç§°<code>model</code>ã€‚è¯¥åç§°å°†ä¼ é€’ç»™<code>spacy.load(name)</code>ã€‚<br><br> pipeline: <br>- name: â€œSpacyNLPâ€   # language model to load   <br>model: â€œen_core_web_mdâ€   <br>case_sensitive: False<br><br>æœ‰å…³å¦‚ä½•ä¸‹è½½spaCyæ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç»§ç»­ <a href="#">å®‰è£…SpaCy</a>ã€‚</td></tr></tbody></table><h3 id="HFTransformersNLP"><a href="#HFTransformersNLP" class="headerlink" title="HFTransformersNLP"></a>HFTransformersNLP</h3><table><thead><tr><th>Short</th><th>åŸºäºHuggingFaceçš„Transformersçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹åˆå§‹åŒ–ç¨‹åº</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>ä»HuggingFaceçš„<a href="https://huggingface.co/transformers/">Transformersåº“</a>åˆå§‹åŒ–æŒ‡å®šçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚è¯¥ç»„ä»¶åº”ç”¨ç‰¹å®šäºè¯­è¨€æ¨¡å‹çš„æ ‡è®°åŒ–å’Œç‰¹å¾åŒ–æ¥ä¸ºè®­ç»ƒæ•°æ®ä¸­çš„æ¯ä¸ªç¤ºä¾‹è®¡ç®—åºåˆ—å’Œå¥å­çº§åˆ«çš„è¡¨ç¤ºå½¢å¼ã€‚åŒ…æ‹¬<a href="https://legacy-docs-v1.rasa.com/nlu/components/#languagemodeltokenizer">LanguageModelTokenizer</a>å’Œ<a href="https://legacy-docs-v1.rasa.com/nlu/components/#languagemodelfeaturizer">LanguageModelFeaturizerï¼Œ</a>ä»¥å°†è¯¥ç»„ä»¶çš„è¾“å‡ºç”¨äºä¸‹æ¸¸NLUæ¨¡å‹ã€‚<br><br>**æ³¨æ„:**è¦ä½¿ç”¨<code>HFTransformersNLP</code>ç»„ä»¶ï¼Œè¯·é€šè¿‡å®‰è£…Rasa Open Source ã€‚<code>pip install rasa[transformers]</code></td></tr><tr><td><strong>Configuration</strong></td><td>æ‚¨åº”è¯¥é€šè¿‡å‚æ•°æŒ‡å®šè¦åŠ è½½çš„è¯­è¨€æ¨¡å‹<code>model_name</code>ã€‚æœ‰å…³å¯ç”¨çš„è¯­è¨€æ¨¡å‹ï¼Œè¯·å‚è§ä¸‹è¡¨ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•°æ¥æŒ‡å®šæ‰€é€‰è¯­è¨€æ¨¡å‹çš„ä½“ç³»ç»“æ„å˜ä½“<code>model_weights</code>ã€‚å¯åœ¨<a href="https://huggingface.co/transformers/pretrained_models.html">æ­¤å¤„</a>æ‰¾åˆ°æ”¯æŒçš„ä½“ç³»ç»“æ„çš„å®Œæ•´åˆ—è¡¨ ã€‚å¦‚æœä¿ç•™ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åŸå§‹Transformersåº“åŠ è½½çš„é»˜è®¤æ¨¡å‹æ¶æ„ï¼ˆè¯·å‚è§ä¸‹è¡¨ï¼‰ã€‚<br><br>pipeline:  <br>     - name: HFTransformersNLP    <br>       model_name: â€œbertâ€     <br>       model_weights: â€œbert-base-uncasedâ€      <br>       cache_dir: null</td></tr></tbody></table><h2 id="Tokenizers"><a href="#Tokenizers" class="headerlink" title="Tokenizers"></a>Tokenizers</h2><p>ä»¤ç‰Œç”Ÿæˆå™¨å°†æ–‡æœ¬æ‹†åˆ†ä¸ºä»¤ç‰Œã€‚å¦‚æœè¦å°†æ„å›¾æ‹†åˆ†ä¸ºå¤šä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚ï¼Œç”¨äºé¢„æµ‹å¤šä¸ªæ„å›¾æˆ–ä¸ºåˆ†å±‚çš„æ„å›¾ç»“æ„å»ºæ¨¡ï¼Œè¯·å¯¹ä»»ä½•æ ‡è®°å™¨ä½¿ç”¨ä»¥ä¸‹æ ‡å¿—ï¼š</p><ul><li><code>intent_tokenization_flag</code>æŒ‡ç¤ºæ˜¯å¦æ ‡è®°æ„å›¾æ ‡ç­¾ã€‚å°†å…¶è®¾ç½®ä¸º<code>True</code>ï¼Œä»¥ä¾¿æ ‡è®°æ„å›¾æ ‡ç­¾ã€‚</li><li><code>intent_split_symbol</code>è®¾ç½®åˆ†éš”ç¬¦å­—ç¬¦ä¸²ä»¥åˆ†å‰²æ„å›¾æ ‡ç­¾ï¼Œé»˜è®¤å€¼ä¸ºä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰ã€‚</li></ul><blockquote><p>æ³¨æ„</p><p><code>__CLS__</code>å½“æ ‡è®°æ–‡æœ¬å’Œå“åº”æ—¶ï¼Œæ‰€æœ‰æ ‡è®°ç”Ÿæˆå™¨éƒ½ä¼šåœ¨æ ‡è®°åˆ—è¡¨çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªé™„åŠ æ ‡è®°ã€‚</p></blockquote><h3 id="WhitespaceTokenizer"><a href="#WhitespaceTokenizer" class="headerlink" title="WhitespaceTokenizer"></a>WhitespaceTokenizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦çš„åˆ†è¯å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®š</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>ä¸ºæ¯ä¸ªç”±ç©ºæ ¼åˆ†éš”çš„å­—ç¬¦åºåˆ—åˆ›å»ºä»¤ç‰Œã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>é€šè¿‡æ·»åŠ é€‰é¡¹ï¼Œä½¿æ ‡è®°åŒ–å™¨ä¸åŒºåˆ†å¤§å°å†™ï¼Œé»˜è®¤ä¸ºã€‚<code>case_sensitive: False  case_sensitive: True</code><br><br> pipeline:<br>      - name: â€œWhitespaceTokenizerâ€     <br>       â€œintent_tokenization_flagâ€: False    <br>       â€œintent_split_symbolâ€: â€œ_â€    <br>       â€œcase_sensitiveâ€: True<br><br></td></tr></tbody></table><h3 id="JiebaTokenizer"><a href="#JiebaTokenizer" class="headerlink" title="JiebaTokenizer"></a>JiebaTokenizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨Jiebaä¸­æ–‡çš„åˆ†è¯å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®šï¼‰</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨ä¸“ç”¨äºä¸­æ–‡çš„Jiebaæ ‡è®°å™¨åˆ›å»ºæ ‡è®°ã€‚ä»…é€‚ç”¨äºä¸­æ–‡ã€‚<br><strong>æ³¨æ„</strong><br>è¦ä½¿ç”¨ï¼Œ<code>JiebaTokenizer</code>æ‚¨éœ€è¦ä½¿ç”¨æ¥å®‰è£…Jieba ã€‚<code>pip install jieba</code></td></tr><tr><td><strong>Configuration</strong></td><td>å¯ä»¥é€šè¿‡æŒ‡å®šæ–‡ä»¶çš„ç›®å½•è·¯å¾„æ¥è‡ªåŠ¨åŠ è½½ç”¨æˆ·çš„è‡ªå®šä¹‰è¯å…¸æ–‡ä»¶<code>dictionary_path</code>ã€‚å¦‚æœ<code>dictionary_path</code>æ˜¯<code>None</code>ï¼ˆé»˜è®¤ï¼‰ï¼Œåˆ™å°†ä¸ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰è¯å…¸ã€‚<br><br> pipeline: <br>      - name: â€œJiebaTokenizerâ€   <br>        dictionary_path: â€œpath/to/custom/dictionary/dirâ€   <br>        â€œintent_tokenization_flagâ€: False   <br>        â€œintent_split_symbolâ€: â€œ_â€<br></td></tr></tbody></table><h3 id="MitieTokenizer"><a href="#MitieTokenizer" class="headerlink" title="MitieTokenizer"></a>MitieTokenizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨MITIEçš„åˆ†è¯å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®šï¼‰</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">MitieNLP</a></td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨MITIE tokenç”Ÿæˆå™¨åˆ›å»ºtoken</td></tr><tr><td><strong>Configuration</strong></td><td><br> pipeline:<br>       - name: â€œMitieTokenizerâ€   <br>         â€œintent_tokenization_flagâ€: False  <br>         â€œintent_split_symbolâ€: â€œ_â€</td></tr></tbody></table><h3 id="SpacyTokenizer"><a href="#SpacyTokenizer" class="headerlink" title="SpacyTokenizer"></a>SpacyTokenizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨spaCyçš„tokenç”Ÿæˆå™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®šï¼‰</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">SpacyNLP</a></td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨spaCy tokenç”Ÿæˆå™¨åˆ›å»ºtokenã€‚</td></tr><tr><td><strong>Configuration</strong></td><td><br>pipeline: <br>     - name: â€œSpacyTokenizerâ€   <br>       â€œintent_tokenization_flagâ€: False   <br>       â€œintent_split_symbolâ€: â€œ_â€</td></tr></tbody></table><h3 id="ConveRTTokenizer"><a href="#ConveRTTokenizer" class="headerlink" title="ConveRTTokenizer"></a>ConveRTTokenizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨<a href="https://github.com/PolyAI-LDN/polyai-models#convert">ConveRT</a>æ¨¡å‹çš„åˆ†è¯å™¨ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®šï¼‰</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨ConveRTæ ‡è®°ç¨‹åºåˆ›å»ºæ ‡è®°ã€‚æ¯å½“ä½¿ç”¨<a href="#">ConveRTFeaturizer</a>æ—¶å¿…é¡»ä½¿ç”¨ã€‚<br><strong>æ³¨æ„</strong><br>ç”±äº<code>ConveRT</code>ä»…åœ¨è‹±è¯­ä¼šè¯è¯­æ–™åº“ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œå› æ­¤ä»…å½“æ‚¨çš„è®­ç»ƒæ•°æ®æ˜¯è‹±è¯­æ—¶æ‰åº”ä½¿ç”¨æ­¤æ ‡è®°å™¨ã€‚<br><strong>æ³¨æ„</strong><br>è¦ä½¿ç”¨<code>ConveRTTokenizer</code>ï¼Œè¯·ä½¿ç”¨æ¥å®‰è£…Rasa Open Source ã€‚<code>pip install rasa[convert]</code></td></tr><tr><td><strong>Configuration</strong></td><td>é€šè¿‡æ·»åŠ é€‰é¡¹ï¼Œä½¿æ ‡è®°åŒ–å™¨ä¸åŒºåˆ†å¤§å°å†™ï¼Œé»˜è®¤ä¸ºã€‚<code>case_sensitive: False  case_sensitive: True</code><br>pipeline: <br>     - name: â€œConveRTTokenizerâ€   <br>       â€œintent_tokenization_flagâ€: False  <br>       â€œintent_split_symbolâ€: â€œ_â€   <br>       â€œcase_sensitiveâ€: True  <br>       â€œmodel_urlâ€: â€œ<a href="https://github.com/PolyAI-LDN/polyai-models/releases/download/v1.0/model.tar.gz&quot;">https://github.com/PolyAI-LDN/polyai-models/releases/download/v1.0/model.tar.gz"</a></td></tr></tbody></table><h3 id="LanguageModelTokenizer"><a href="#LanguageModelTokenizer" class="headerlink" title="LanguageModelTokenizer"></a>LanguageModelTokenizer</h3><table><thead><tr><th>Short</th><th>é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ä¸­çš„åˆ†è¯å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>tokens</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œå“åº”ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å’Œæ„å›¾ï¼ˆå¦‚æœæŒ‡å®šï¼‰</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">HFTransformersNLP</a></td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨åœ¨ä¸Šæ¸¸<a href="#">HFTransformersNLP</a>ç»„ä»¶ä¸­æŒ‡å®šçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ¥åˆ›å»ºä»¤ç‰Œã€‚æ¯å½“ä½¿ç”¨<a href="#">LanguageModelFeaturizer</a>æ—¶å¿…é¡»ä½¿ç”¨ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>      - name: â€œLanguageModelTokenizerâ€   <br>        â€œintent_tokenization_flagâ€: False   <br>        â€œintent_split_symbolâ€: â€œ_â€</td></tr></tbody></table><h2 id="Text-Featurizers"><a href="#Text-Featurizers" class="headerlink" title="Text Featurizers"></a>Text Featurizers</h2><p>æ–‡æœ¬ä¿®é¥°ç¬¦åˆ†ä¸ºä¸¤ç±»ï¼šç¨€ç–ä¿®é¥°ç¬¦å’Œå¯†é›†ä¿®é¥°ç¬¦ã€‚ç¨€ç–ç‰¹å¾åŒ–å™¨æ˜¯è¿”å›å…·æœ‰å¾ˆå¤šç¼ºå¤±å€¼ï¼ˆä¾‹å¦‚é›¶ï¼‰çš„ç‰¹å¾å‘é‡çš„ç‰¹å¾åŒ–å™¨ã€‚ç”±äºè¿™äº›ç‰¹å¾å‘é‡é€šå¸¸ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬å­˜å‚¨ä¸ºç¨€ç–ç‰¹å¾ã€‚ç¨€ç–ç‰¹å¾ä»…å­˜å‚¨éé›¶å€¼åŠå…¶åœ¨å‘é‡ä¸­çš„ä½ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èŠ‚çœäº†å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æ›´å¤§çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç‰¹å¾å™¨å°†è¿”å›ä¸€ä¸ªlengthçŸ©é˜µã€‚å› æ­¤ï¼Œè¿”å›çš„çŸ©é˜µå°†ä¸ºæ¯ä¸ªä»¤ç‰Œéƒ½æœ‰ä¸€ä¸ªç‰¹å¾å‘é‡ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥è®­ç»ƒåºåˆ—æ¨¡å‹ã€‚ä½†æ˜¯ï¼Œæœ«å°¾çš„é™„åŠ æ ‡è®°ï¼ˆä¾‹å¦‚ï¼‰åŒ…å«ç”¨äºå®Œæ•´å‘éŸ³çš„åŠŸèƒ½ã€‚æ­¤ç‰¹å¾å‘é‡å¯ç”¨äºä»»ä½•è¯è¢‹æ¨¡å‹ã€‚å› æ­¤ï¼Œç›¸åº”çš„åˆ†ç±»å™¨å¯ä»¥å†³å®šä½¿ç”¨å“ªç§ç±»å‹çš„åŠŸèƒ½ã€‚<code>(number-of-tokens x feature-dimension)  __CLS__</code></p><h3 id="MitieFeaturizer"><a href="#MitieFeaturizer" class="headerlink" title="MitieFeaturizer"></a>MitieFeaturizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨MITIEåŠŸèƒ½åˆ›å»ºå™¨åˆ›å»ºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”ï¼ˆå¦‚æœæŒ‡å®šï¼‰çš„çŸ¢é‡è¡¨ç¤ºã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>dense_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">MitieNLP</a></td></tr><tr><td><strong>Type</strong></td><td>Dense featurizer</td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨MITIE featurizeråˆ›å»ºç”¨äºå®ä½“æå–ï¼Œæ„å›¾åˆ†ç±»å’Œå“åº”åˆ†ç±»çš„åŠŸèƒ½ã€‚<br><strong>æ³¨æ„</strong><br>ä¸ä½¿ç”¨çš„<code>MitieIntentClassifier</code>ç»„ä»¶ã€‚ä½†å¯ä»¥åœ¨ç¨åä½¿ç”¨çš„ç®¡é“ä¸­çš„ä»»ä½•ç»„ä»¶ä¸­ä½¿ç”¨<code>dense_features</code>ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td><code>__CLS__</code>å¯ä»¥é€šè¿‡å‡å€¼æˆ–æœ€å¤§æ± åŒ–ä¸¤ç§ä¸åŒæ–¹å¼æ¥è®¡ç®—å¥å­å‘é‡ï¼ˆå³ä»¤ç‰Œçš„å‘é‡ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é€‰é¡¹åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ± åŒ–æ–¹æ³•<code>pooling</code>ã€‚é»˜è®¤æ± åŒ–æ–¹æ³•è®¾ç½®ä¸º<code>mean</code>ã€‚<br>pipeline: <br>     - name: â€œMitieFeaturizerâ€ <br>      â€œpoolingâ€: â€œmeanâ€</td></tr></tbody></table><h3 id="SpacyFeaturizer"><a href="#SpacyFeaturizer" class="headerlink" title="SpacyFeaturizer"></a>SpacyFeaturizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨MITIEåŠŸèƒ½åˆ›å»ºå™¨åˆ›å»ºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”ï¼ˆå¦‚æœæŒ‡å®šï¼‰çš„çŸ¢é‡è¡¨ç¤ºã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>dense_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">SpacyNLP</a></td></tr><tr><td><strong>Type</strong></td><td>Dense featurizer</td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨spaCy featurizeråˆ›å»ºç”¨äºå®ä½“æå–ï¼Œæ„å›¾åˆ†ç±»å’Œå“åº”åˆ†ç±»çš„åŠŸèƒ½ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td><code>__CLS__</code>å¯ä»¥é€šè¿‡å‡å€¼æˆ–æœ€å¤§æ± åŒ–ä¸¤ç§ä¸åŒæ–¹å¼æ¥è®¡ç®—å¥å­å‘é‡ï¼ˆå³ä»¤ç‰Œçš„å‘é‡ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é€‰é¡¹åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ± åŒ–æ–¹æ³•<code>pooling</code>ã€‚é»˜è®¤æ± åŒ–æ–¹æ³•è®¾ç½®ä¸º<code>mean</code>ã€‚<br>pipeline: <br>     - name: â€œSpacyFeaturizerâ€   <br>       â€œpoolingâ€: â€œmeanâ€</td></tr></tbody></table><h3 id="ConveRTFeaturizer"><a href="#ConveRTFeaturizer" class="headerlink" title="ConveRTFeaturizer"></a>ConveRTFeaturizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨<a href="https://github.com/PolyAI-LDN/polyai-models">ConveRT</a>æ¨¡å‹åˆ›å»ºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”ï¼ˆå¦‚æœæŒ‡å®šï¼‰çš„çŸ¢é‡è¡¨ç¤º ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>dense_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">ConveRTTokenizer</a></td></tr><tr><td><strong>Type</strong></td><td>Dense featurizer</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºç”¨äºå®ä½“æå–ï¼Œæ„å›¾åˆ†ç±»å’Œå“åº”é€‰æ‹©çš„åŠŸèƒ½ã€‚å®ƒä½¿ç”¨<a href="https://github.com/PolyAI-LDN/polyai-models#tfhub-signatures">é»˜è®¤ç­¾å</a>æ¥è®¡ç®—è¾“å…¥æ–‡æœ¬çš„çŸ¢é‡è¡¨ç¤ºã€‚<br><strong>æ³¨æ„</strong><br>ç”±äº<code>ConveRT</code>ä»…åœ¨è‹±è¯­ä¼šè¯è¯­æ–™åº“ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œå› æ­¤ä»…å½“æ‚¨çš„è®­ç»ƒæ•°æ®æ˜¯è‹±è¯­æ—¶æ‰åº”ä½¿ç”¨æ­¤åŠŸèƒ½åŒ–å™¨ã€‚<br><strong>æ³¨æ„</strong><br>è¦ä½¿ç”¨<code>ConveRTTokenizer</code>ï¼Œè¯·ä½¿ç”¨æ¥å®‰è£…Rasa Open Source ã€‚<code>pip install rasa[convert]</code><br></td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>     - name: â€œConveRTFeaturizerâ€   <br>       â€œmodel_urlâ€: â€œ<a href="https://github.com/PolyAI-LDN/polyai-models/releases/download/v1.0/model.tar.gz&quot;">https://github.com/PolyAI-LDN/polyai-models/releases/download/v1.0/model.tar.gz"</a></td></tr></tbody></table><h3 id="LanguageModelFeaturizer"><a href="#LanguageModelFeaturizer" class="headerlink" title="LanguageModelFeaturizer"></a>LanguageModelFeaturizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„è¯­è¨€æ¨¡å‹åˆ›å»ºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”ï¼ˆå¦‚æœæŒ‡å®šï¼‰çš„çŸ¢é‡è¡¨ç¤ºã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>dense_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">HFTransformersNLP</a>å’Œ<a href="#">LanguageModelTokenizer</a></td></tr><tr><td><strong>Type</strong></td><td>Dense featurizer</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºç”¨äºå®ä½“æå–ï¼Œæ„å›¾åˆ†ç±»å’Œå“åº”é€‰æ‹©çš„åŠŸèƒ½ã€‚ä½¿ç”¨åœ¨ä¸Šæ¸¸<a href="https://legacy-docs-v1.rasa.com/nlu/components/#hftransformersnlp">HFTransformersNLP</a>ç»„ä»¶ä¸­æŒ‡å®šçš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ¥è®¡ç®—è¾“å…¥æ–‡æœ¬çš„çŸ¢é‡è¡¨ç¤ºã€‚<br><strong>æ³¨æ„</strong><br>è¯·ç¡®ä¿æ‚¨ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹å·²ç»ä¸æ‚¨çš„è®­ç»ƒæ•°æ®åœ¨ç›¸åŒçš„è¯­è¨€è¯­æ–™åº“ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒã€‚<br></td></tr><tr><td><strong>Configuration</strong></td><td>åœ¨æ­¤ç»„ä»¶ä¹‹å‰åŒ…æ‹¬<a href="#">HFTransformersNLP</a>å’Œ<a href="#">LanguageModelTokenizer</a>ç»„ä»¶ã€‚ä½¿ç”¨ <a href="#">LanguageModelTokenizer</a>ç¡®ä¿ä¸ºæ•´ä¸ªç®¡é“ä¸­çš„æ‰€æœ‰ç»„ä»¶æ­£ç¡®è®¾ç½®ä»¤ç‰Œã€‚<br>pipeline:<br>     - name: â€œLanguageModelFeaturizerâ€</td></tr></tbody></table><h3 id="RegexFeaturizer"><a href="#RegexFeaturizer" class="headerlink" title="RegexFeaturizer"></a>RegexFeaturizer</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ›å»ºç”¨æˆ·æ¶ˆæ¯çš„çŸ¢é‡è¡¨ç¤ºã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>sparse_features<code>ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œ</code>tokens.pattern</td></tr><tr><td><strong>Requires</strong></td><td>tokens</td></tr><tr><td><strong>Type</strong></td><td>Sparse featurizer</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºç”¨äºå®ä½“æå–å’Œæ„å›¾åˆ†ç±»çš„åŠŸèƒ½ã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œ<code>RegexFeaturizer</code>ä¼šåˆ›å»ºä¸€ä¸ªä»¥è®­ç»ƒæ•°æ®æ ¼å¼å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨ã€‚å¯¹äºæ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå°†è®¾ç½®ä¸€ä¸ªåŠŸèƒ½ï¼Œä»¥æ ‡è®°æ˜¯å¦åœ¨ç”¨æˆ·æ¶ˆæ¯ä¸­æ‰¾åˆ°äº†æ­¤è¡¨è¾¾å¼ã€‚ç¨åï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å°†è¢«è¾“å…¥åˆ°æ„å›¾åˆ†ç±»å™¨/å®ä½“æå–å™¨ä¸­ä»¥ç®€åŒ–åˆ†ç±»ï¼ˆå‡è®¾åˆ†ç±»å™¨åœ¨è®­ç»ƒé˜¶æ®µå·²è·æ‚‰ï¼Œæ­¤è®¾ç½®çš„åŠŸèƒ½æŒ‡ç¤ºç‰¹å®šçš„æ„å›¾/å®ä½“ï¼‰ã€‚å½“å‰ä»…<a href="#">CRFEntityExtractor</a>å’Œ <a href="#">DIETClassifier</a>ç»„ä»¶æ”¯æŒç”¨äºå®ä½“æå–çš„æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ï¼</td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>    - name: â€œRegexFeaturizerâ€</td></tr></tbody></table><h3 id="CountVectorsFeaturizer"><a href="#CountVectorsFeaturizer" class="headerlink" title="CountVectorsFeaturizer"></a>CountVectorsFeaturizer</h3><table><thead><tr><th>Short</th><th>åˆ›å»ºç”¨æˆ·æ¶ˆæ¯ï¼Œæ„å›¾å’Œå“åº”çš„è¯è¢‹è¡¨ç¤ºã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>sparse_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œæ„å›¾å’Œå“åº”</td></tr><tr><td><strong>Requires</strong></td><td>tokens</td></tr><tr><td><strong>Type</strong></td><td>Sparse featurizer</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºç”¨äºæ„å›¾åˆ†ç±»å’Œå“åº”é€‰æ‹©çš„åŠŸèƒ½ã€‚ä½¿ç”¨<a href="#">sklearnçš„CountVectorizer</a>åˆ›å»ºç”¨æˆ·æ¶ˆæ¯ï¼Œæ„å›¾å’Œå“åº” <a href="#">çš„å…³é”®è¯è¡¨ç¤º</a>ã€‚æ‰€æœ‰ä»…ç”±æ•°å­—ç»„æˆçš„ä»¤ç‰Œï¼ˆä¾‹å¦‚123å’Œ99ï¼Œä½†ä¸åŒ…æ‹¬a123dï¼‰å°†åˆ†é…ç»™åŒä¸€åŠŸèƒ½ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>æœ‰å…³ é…ç½®å‚æ•°çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è§<a href="http://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">sklearnçš„CountVectorizeræ–‡æ¡£</a>ã€‚<br>å¯ä»¥ä½¿ç”¨<code>analyzer</code>é…ç½®å‚æ•°å°†æ­¤åŠŸèƒ½é…ç½®ä¸ºä½¿ç”¨å•è¯æˆ–å­—ç¬¦n-gram ã€‚é»˜è®¤æƒ…å†µä¸‹<code>analyzer</code>è®¾ç½®ä¸ºï¼Œ<code>word</code>å› æ­¤å•è¯æ ‡è®°è®¡æ•°ç”¨ä½œåŠŸèƒ½ã€‚å¦‚æœè¦ä½¿ç”¨å­—ç¬¦n-gramï¼Œè¯·å°†è®¾ç½®<code>analyzer</code>ä¸º<code>char</code>æˆ–<code>char_wb</code>ã€‚å¯ä»¥é€šè¿‡å‚æ•°<code>min_ngram</code>å’Œæ¥é…ç½®nå…ƒè¯­æ³•çš„ä¸Šä¸‹è¾¹ç•Œ<code>max_ngram</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½è®¾ç½®ä¸º<code>1</code>ã€‚<br>æ³¨æ„<br>Option<code>char_wb</code>ä»…ä»å•è¯è¾¹ç•Œå†…çš„æ–‡æœ¬åˆ›å»ºå­—ç¬¦n-gramï¼›å•è¯è¾¹ç¼˜çš„n-gramç”¨ç©ºæ ¼å¡«å……ã€‚æ­¤é€‰é¡¹å¯ç”¨äºåˆ›å»ºå­<a href="https://arxiv.org/abs/1810.07150">è¯è¯­ä¹‰æ•£åˆ—</a>ã€‚<br><strong>æ³¨æ„</strong><br>å¯¹äºå­—ç¬¦n-gramï¼Œä¸è¦å¿˜è®°å¢åŠ <code>min_ngram</code>å’Œ<code>max_ngram</code>å‚æ•°ã€‚å¦åˆ™ï¼Œè¯æ±‡è¡¨å°†ä»…åŒ…å«å•ä¸ªå­—æ¯ã€‚<br>å¤„ç†è¯æ±‡é‡ï¼ˆOOVï¼‰è¯ï¼š<br><strong>æ³¨æ„</strong><br>å¯ç”¨ä»…<code>analyzer</code>æ˜¯<code>word</code>ã€‚<br>ç”±äºè®­ç»ƒæ˜¯åœ¨æœ‰é™çš„è¯æ±‡æ•°æ®ä¸Šè¿›è¡Œçš„ï¼Œå› æ­¤ä¸èƒ½ä¿è¯ç®—æ³•åœ¨é¢„æµ‹æœŸé—´ä¸ä¼šé‡åˆ°æœªçŸ¥è¯ï¼ˆè®­ç»ƒä¸­æœªçœ‹åˆ°çš„è¯ï¼‰ã€‚ä¸ºäº†æ•™æˆä¸€ç§ç®—æ³•å¦‚ä½•å¤„ç†æœªçŸ¥å•è¯ï¼Œå¯ä»¥å°†è®­ç»ƒæ•°æ®ä¸­çš„æŸäº›å•è¯æ›¿æ¢ä¸ºé€šç”¨å•è¯<code>OOV_token</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨é¢„æµ‹æœŸé—´ï¼Œæ‰€æœ‰æœªçŸ¥å•è¯éƒ½å°†è¢«è§†ä¸ºè¯¥é€šç”¨å•è¯<code>OOV_token</code>ã€‚<br>ä¾‹å¦‚ï¼Œä¸€ä¸ªäººå¯èƒ½ä¼š<code>outofscope</code>åœ¨è®­ç»ƒæ•°æ®ä¸­åˆ›å»ºå•ç‹¬çš„æ„å›¾ï¼Œå…¶ä¸­åŒ…å«ä¸åŒæ•°é‡<code>OOV_token</code>sçš„æ¶ˆæ¯ä»¥åŠå¯èƒ½åŒ…å«ä¸€äº›å…¶ä»–å¸¸è§„è¯ã€‚ç„¶åï¼Œç®—æ³•å¯èƒ½ä¼šå°†å¸¦æœ‰æœªçŸ¥å•è¯çš„æ¶ˆæ¯åˆ†ç±»ä¸ºæ­¤æ„å›¾<code>outofscope</code>ã€‚<br>æ‚¨å¯ä»¥è®¾ç½®<code>OOV_token</code>æˆ–å•è¯åˆ—è¡¨<code>OOV_words</code>ï¼š<br>     <code>OOV_token</code>ä¸ºçœ‹ä¸è§çš„å•è¯è®¾ç½®å…³é”®å­—ï¼›å¦‚æœè®­ç»ƒæ•°æ®<code>OOV_token</code>åœ¨æŸäº›æ¶ˆæ¯ä¸­åŒ…å«å•è¯ï¼Œåˆ™åœ¨é¢„æµ‹æœŸé—´ï¼Œå°†ä½¿ç”¨æä¾›æ›¿æ¢åœ¨è®­ç»ƒæœŸé—´æœªçœ‹åˆ°çš„å•è¯<code>OOV_token</code>ï¼›å¦‚æœ<code>OOV_token=None</code>ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰è®­ç»ƒæœŸé—´æœªçœ‹åˆ°çš„å•è¯åœ¨é¢„æµ‹æ—¶é—´å†…å°†è¢«å¿½ç•¥ï¼›<br>     <code>OOV_words</code>è®¾å®š<code>OOV_token</code>è®­ç»ƒæœŸé—´è¦å¤„ç†çš„å•è¯æ¸…å•ï¼›å¦‚æœå·²çŸ¥åº”è§†ä¸ºè¯æ±‡é‡ä¸è¶³çš„å•è¯åˆ—è¡¨ï¼Œåˆ™å¯ä»¥å°†å…¶è®¾ç½®ä¸ºï¼Œ<code>OOV_words</code>è€Œä¸æ˜¯åœ¨è®­ç»ƒæ•°æ®ä¸­æ‰‹åŠ¨æ›´æ”¹å®ƒæˆ–ä½¿ç”¨è‡ªå®šä¹‰é¢„å¤„ç†å™¨ã€‚<br><strong>æ³¨æ„</strong><br>è¿™ä¸ªfeaturizeré€šè¿‡å¯¹å•è¯<strong>è®¡æ•°</strong>æ¥åˆ›å»ºå•è¯è¢‹è¡¨ç¤ºï¼Œå› æ­¤<code>OOV_token</code>å¥å­ä¸­çš„æ•°é‡å¯èƒ½å¾ˆé‡è¦ã€‚<br><strong>æ³¨æ„</strong><br>æä¾›<code>OOV_words</code>æ˜¯å¯é€‰çš„ï¼ŒåŸ¹è®­æ•°æ®å¯ä»¥åŒ…å«<code>OOV_token</code>æ‰‹åŠ¨è¾“å…¥ï¼Œä¹Ÿå¯ä»¥åŒ…å«è‡ªå®šä¹‰çš„é™„åŠ é¢„å¤„ç†å™¨ã€‚<code>OOV_token</code> <strong>åªæœ‰</strong>åœ¨è®­ç»ƒæ•°æ®æˆ–<code>OOV_words</code>åˆ—è¡¨ä¸­å­˜åœ¨æ­¤æ ‡è®°æ—¶ï¼Œçœ‹ä¸è§çš„å•è¯æ‰ä¼šè¢«æ›¿æ¢ã€‚<br>å¦‚æœè¦åœ¨ç”¨æˆ·æ¶ˆæ¯å’Œæ„å›¾ä¹‹é—´å…±äº«è¯æ±‡ï¼Œåˆ™éœ€è¦å°†é€‰é¡¹è®¾ç½® <code>use_shared_vocab</code>ä¸º<code>True</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†å»ºç«‹æ„å›¾ä»¤ç‰Œå’Œç”¨æˆ·æ¶ˆæ¯ä¹‹é—´çš„é€šç”¨è¯æ±‡é›†<br>pipeline: <br>      - name: â€œCountVectorsFeaturizerâ€ <br>        â€œanalyzerâ€: â€œwordâ€  <br>        â€œmin_ngramâ€: 1  <br>        â€œmax_ngramâ€: 1   <br>        â€œOOV_tokenâ€: â€œ<em>oov</em>â€œ <br>        â€œuse_shared_vocabâ€: False<br>ä¸Šé¢çš„é…ç½®å‚æ•°æ˜¯æ‚¨åº”è¯¥é…ç½®çš„å‚æ•°ï¼Œä»¥ä½¿æ¨¡å‹é€‚åˆæ•°æ®ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨å¯ä»¥è°ƒæ•´çš„å…¶ä»–å‚æ•°ã€‚</td></tr></tbody></table><img src="/2020/10/04/rasa-wen-dang-zhi-nan-12/9.png" style="zoom:90%;"><h3 id="LexicalSyntacticFeaturizer"><a href="#LexicalSyntacticFeaturizer" class="headerlink" title="LexicalSyntacticFeaturizer"></a>LexicalSyntacticFeaturizer</h3><table><thead><tr><th>Short</th><th>ä¸ºç”¨æˆ·æ¶ˆæ¯åˆ›å»ºè¯æ±‡å’Œå¥æ³•åŠŸèƒ½ä»¥æ”¯æŒå®ä½“æå–ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td><code>sparse_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯</td></tr><tr><td><strong>Requires</strong></td><td>tokens</td></tr><tr><td><strong>Type</strong></td><td>Sparse featurizer</td></tr><tr><td><strong>Description</strong></td><td>åˆ›å»ºç”¨äºå®ä½“æå–çš„åŠŸèƒ½ã€‚ä½¿ç”¨æ»‘åŠ¨çª—å£åœ¨ç”¨æˆ·æ¶ˆæ¯ä¸­çš„æ¯ä¸ªä»¤ç‰Œä¸Šç§»åŠ¨ï¼Œå¹¶æ ¹æ®é…ç½®åˆ›å»ºåŠŸèƒ½ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚ç”±äºå­˜åœ¨é»˜è®¤é…ç½®ï¼Œå› æ­¤æ‚¨æ— éœ€æŒ‡å®šé…ç½®ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>æ‚¨å¯ä»¥é…ç½®featurizeråº”è¯¥æå–å“ªç§è¯æ±‡å’Œå¥æ³•åŠŸèƒ½ã€‚æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š<br><img src="/2020/10/04/rasa-wen-dang-zhi-nan-12/10.png" style="zoom:50%;"><br>å½“åŠŸèƒ½åŒ–å™¨åœ¨å¸¦æœ‰æ»‘åŠ¨çª—å£çš„ç”¨æˆ·æ¶ˆæ¯ä¸­ç§»åŠ¨æ ‡è®°æ—¶ï¼Œæ‚¨å¯ä»¥ä¸ºæ»‘åŠ¨çª—å£ä¸­çš„å…ˆå‰æ ‡è®°ï¼Œå½“å‰æ ‡è®°å’Œä¸‹ä¸€ä¸ªæ ‡è®°å®šä¹‰åŠŸèƒ½ã€‚æ‚¨å°†è¦ç´ å®šä¹‰ä¸º[beforeï¼Œtokenï¼Œafter]æ•°ç»„ã€‚å¦‚æœè¦ä¸ºä¹‹å‰çš„ä»¤ç‰Œï¼Œå½“å‰ä»¤ç‰Œå’Œä¹‹åçš„ä»¤ç‰Œå®šä¹‰åŠŸèƒ½ï¼Œåˆ™åŠŸèƒ½é…ç½®åº”å¦‚ä¸‹æ‰€ç¤ºï¼š<br>pipeline: <br>      - name: LexicalSyntacticFeaturizer   <br>        â€œfeaturesâ€: [  <br>              [â€œlowâ€, â€œtitleâ€, â€œupperâ€],  <br>              [â€œBOSâ€, â€œEOSâ€, â€œlowâ€, â€œupperâ€, â€œtitleâ€, â€œdigitâ€],    <br>              [â€œlowâ€, â€œtitleâ€, â€œupperâ€],  <br>            ]<br>æ­¤é…ç½®ä¹Ÿæ˜¯é»˜è®¤é…ç½®ã€‚<br> <strong>æ³¨æ„</strong><br>å¦‚æœè¦ä½¿ç”¨<code>pos</code>æˆ–<code>pos2</code>éœ€è¦æ·»åŠ <code>SpacyTokenizer</code>åˆ°ç®¡é“ä¸­ã€‚</td></tr></tbody></table><h2 id="Intent-Classifiers"><a href="#Intent-Classifiers" class="headerlink" title="Intent Classifiers"></a>Intent Classifiers</h2><p>æ„å›¾åˆ†ç±»å™¨å°†åŸŸæ–‡ä»¶ä¸­å®šä¹‰çš„æ„å›¾ä¹‹ä¸€åˆ†é…ç»™ä¼ å…¥çš„ç”¨æˆ·æ¶ˆæ¯ã€‚</p><h3 id="MitieIntentClassifier"><a href="#MitieIntentClassifier" class="headerlink" title="MitieIntentClassifier"></a>MitieIntentClassifier</h3><table><thead><tr><th>Short</th><th>MITIEæ„å‘åˆ†ç±»å™¨ï¼ˆä½¿ç”¨ <a href="https://github.com/mit-nlp/MITIE/blob/master/examples/python/text_categorizer_pure_model.py">æ–‡æœ¬åˆ†ç±»å™¨</a>ï¼‰</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>intent</td></tr><tr><td><strong>Requires</strong></td><td><code>tokens</code>ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œ<a href="https://legacy-docs-v1.rasa.com/nlu/components/#mitienlp">MitieNLP</a></td></tr><tr><td><strong>Output-Example</strong></td><td>{     <br>â€œintentâ€: {â€œnameâ€: â€œgreetâ€, â€œconfidenceâ€: 0.98343} <br>}</td></tr><tr><td><strong>Description</strong></td><td>è¯¥åˆ†ç±»å™¨ä½¿ç”¨MITIEè¿›è¡Œæ„å›¾åˆ†ç±»ã€‚åº•å±‚åˆ†ç±»å™¨æ­£åœ¨ä½¿ç”¨å…·æœ‰ç¨€ç–çº¿æ€§å†…æ ¸çš„å¤šç±»çº¿æ€§SVMï¼ˆè¯·å‚é˜… <a href="https://github.com/mit-nlp/MITIE/blob/master/mitielib/src/text_categorizer_trainer.cpp#L222">MITIEè®­ç»ƒä»£ç </a>ï¼‰ã€‚<br><strong>æ³¨æ„</strong><br>è¯¥åˆ†ç±»å™¨ä¸ä¾èµ–ä»»ä½•ç‰¹å¾åŒ–å™¨ï¼Œå› ä¸ºå®ƒè‡ªå·±æå–ç‰¹å¾ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>pipeline:<br>    - name: â€œMitieIntentClassifierâ€</td></tr></tbody></table><h3 id="SklearnIntentClassifier"><a href="#SklearnIntentClassifier" class="headerlink" title="SklearnIntentClassifier"></a>SklearnIntentClassifier</h3><table><thead><tr><th>Short</th><th>Sklearnæ„å›¾åˆ†ç±»å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>intent<code>å’Œ</code>intent_ranking</td></tr><tr><td><strong>Requires</strong></td><td><code>dense_features</code> ç”¨äºç”¨æˆ·æ¶ˆæ¯</td></tr><tr><td><strong>Output-Example</strong></td><td>{    <br> â€œintentâ€: {â€œnameâ€: â€œgreetâ€, â€œconfidenceâ€: 0.78343},  <br>   â€œintent_rankingâ€: [   {    <br>                          â€œconfidenceâ€: 0.1485910906220309,         <br>                         â€œnameâ€: â€œgoodbyeâ€         },         <br>                      { â€œconfidenceâ€: 0.08161531595656784,   <br>                         â€œnameâ€: â€œrestaurant_searchâ€         }     ]<br> }</td></tr><tr><td><strong>Description</strong></td><td>sklearnç›®çš„åˆ†ç±»å™¨è®­ç»ƒäº†ä¸€ä¸ªçº¿æ€§SVMï¼Œè¯¥SVMä½¿ç”¨ç½‘æ ¼æœç´¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚å®ƒè¿˜æä¾›äº†æœªâ€œè·èƒœâ€çš„æ ‡ç­¾çš„æ’åã€‚å°†<code>SklearnIntentClassifier</code>é€šè¿‡åœ¨ç®¡é“å¯†é›†featurizerå‰é¢çš„éœ€æ±‚ã€‚è¿™ç§å¯†é›†çš„ç‰¹å¾åŒ–å™¨åˆ›å»ºäº†ç”¨äºåˆ†ç±»çš„åŠŸèƒ½ã€‚æœ‰å…³ç®—æ³•æœ¬èº«çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html">GridSearchCV</a> æ–‡æ¡£ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>åœ¨SVMè®­ç»ƒæœŸé—´ï¼Œå°†è¿è¡Œè¶…å‚æ•°æœç´¢ä»¥æ‰¾åˆ°æœ€ä½³å‚æ•°é›†ã€‚åœ¨é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå°†å°è¯•çš„å‚æ•°ã€‚<br>pipeline: <br>      - name: â€œSklearnIntentClassifierâ€   <br>        C: [1, 2, 5, 10, 20, 100]   <br>        kernels: [â€œlinearâ€]  <br>        â€œgammaâ€: [0.1]   <br>        â€œmax_cross_validation_foldsâ€: 5   <br>        â€œscoring_functionâ€: â€œf1_weightedâ€</td></tr></tbody></table><h3 id="EmbeddingIntentClassifier"><a href="#EmbeddingIntentClassifier" class="headerlink" title="EmbeddingIntentClassifier"></a>EmbeddingIntentClassifier</h3><blockquote><p>è­¦å‘Š</p><p><code>EmbeddingIntentClassifier</code>å·²å¼ƒç”¨ï¼Œåº”ä»¥ä»£æ›¿<code>DIETClassifier</code>ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="#">è¿ç§»æŒ‡å—</a>ã€‚</p></blockquote><table><thead><tr><th>Short</th><th>åµŒå…¥æ„å›¾åˆ†ç±»å™¨ä»¥è¿›è¡Œæ„å›¾åˆ†ç±»</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>intent<code>å’Œ</code>intent_ranking</td></tr><tr><td><strong>Requires</strong></td><td><code>dense_features</code>å’Œ/æˆ–<code>sparse_features</code>ç”¨äºç”¨æˆ·æ¶ˆæ¯ï¼Œä»¥åŠå¯é€‰çš„æ„å›¾</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œintentâ€: {â€œnameâ€: â€œgreetâ€, â€œconfidenceâ€: 0.78343},     â€œintent_rankingâ€: [         {             â€œconfidenceâ€: 0.1485910906220309,             â€œnameâ€: â€œgoodbyeâ€         },         {             â€œconfidenceâ€: 0.08161531595656784,             â€œnameâ€: â€œrestaurant_searchâ€         }     ] }</td></tr><tr><td><strong>Description</strong></td><td>è¯¥<code>EmbeddingIntentClassifier</code>åµŒå…¥ç”¨æˆ·è¾“å…¥å’Œæ„å›¾çš„æ ‡ç­¾åœ¨åŒä¸€ä¸ªç©ºé—´ã€‚é€šè¿‡æœ€å¤§åŒ–åµŒå…¥ä¹‹é—´çš„ç›¸ä¼¼æ€§æ¥è®­ç»ƒæœ‰ç›‘ç£çš„åµŒå…¥ã€‚è¯¥ç®—æ³•åŸºäº<a href="https://arxiv.org/abs/1709.03856">StarSpace</a>ã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤å®ç°ä¸­ï¼ŒæŸå¤±å‡½æ•°ç•¥æœ‰ä¸åŒï¼Œå¹¶ä¸”å…¶ä»–é™„åŠ çš„éšè—å±‚ä¸ä¸¢å¤±ä¸€èµ·æ·»åŠ ã€‚è¯¥ç®—æ³•è¿˜æä¾›äº†æœªâ€œè·èƒœâ€çš„æ ‡ç­¾çš„ç›¸ä¼¼æ€§æ’åã€‚<br><strong>æ³¨æ„</strong><br>å¦‚æœåœ¨é¢„æµ‹æ—¶é—´å†…ï¼Œä¸€æ¡æ¶ˆæ¯<strong>ä»…</strong>åŒ…å«è®­ç»ƒä¸­çœ‹ä¸è§çš„å•è¯ï¼Œå¹¶ä¸”æœªä½¿ç”¨è¯æ±‡é‡å¤–é¢„å¤„ç†å™¨ï¼Œåˆ™å¯ä»¥æœ‰æŠŠæ¡åœ°<code>None</code>é¢„æµ‹ å‡ºä¸€ä¸ªç©ºçš„æ„å›¾<code>0.0</code>ã€‚å¦‚æœä»…å°†<a href="https://legacy-docs-v1.rasa.com/nlu/components/#countvectorsfeaturizer">CountVectorsFeaturizer</a>ä¸<code>word</code>åˆ†æä»ªä¸€èµ·ç”¨ä½œç‰¹å¾åŒ–å™¨ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœä½¿ç”¨<code>char_wb</code>åˆ†æä»ªï¼Œåˆ™åº”å§‹ç»ˆè·å¾—å…·æœ‰ç½®ä¿¡åº¦å€¼çš„æ„å›¾ã€‚<code>&gt; 0.0</code></td></tr><tr><td><strong>Configuration</strong></td><td>æ‚¨å¯ä»¥å®šä¹‰è®¸å¤šè¶…å‚æ•°æ¥é€‚åº”æ¨¡å‹ã€‚å¦‚æœè¦è°ƒæ•´æ¨¡å‹ï¼Œè¯·é¦–å…ˆä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š<br> <code>epochs</code> ï¼šæ­¤å‚æ•°è®¾ç½®ç®—æ³•æŸ¥çœ‹è®­ç»ƒæ•°æ®çš„æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>300</code>ã€‚ä¸€ä¸ª<code>epoch</code>æ˜¯ç­‰äºä¸€ä¸ªç›´ä¼ å’Œæ‰€æœ‰çš„è®­ç»ƒä¾‹å­ä¹‹ä¸€å‘é€šè¡Œã€‚æœ‰æ—¶ï¼Œæ¨¡å‹éœ€è¦æ›´å¤šçš„æ—¶æœŸæ‰èƒ½æ­£ç¡®å­¦ä¹ ã€‚æœ‰æ—¶æ›´å¤šçš„æ—¶æœŸä¸ä¼šå½±å“æ€§èƒ½ã€‚æ—¶æœŸæ•°è¶Šå°‘ï¼Œæ¨¡å‹è®­ç»ƒè¶Šå¿«ã€‚<br><code>hidden_layers_sizes</code> ï¼šæ­¤å‚æ•°å…è®¸æ‚¨ä¸ºç”¨æˆ·æ¶ˆæ¯å’Œæ„å›¾å®šä¹‰å‰é¦ˆå±‚çš„æ•°é‡åŠå…¶è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¯¹åº”ä¸€ä¸ªå‰é¦ˆå±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ï¼Œæˆ‘ä»¬å°†åœ¨å˜å‹å™¨å‰é¢æ·»åŠ ä¸¤ä¸ªå‰é¦ˆå±‚ã€‚è¾“å…¥ä»¤ç‰Œçš„çŸ¢é‡ï¼ˆæ¥è‡ªç”¨æˆ·æ¶ˆæ¯ï¼‰å°†ä¼ é€’åˆ°è¿™äº›å±‚ã€‚ç¬¬ä¸€å±‚çš„è¾“å‡ºå°ºå¯¸ä¸º256ï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºå°ºå¯¸ä¸º128ã€‚å¦‚æœä½¿ç”¨ç©ºåˆ—è¡¨ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™ä¸ä¼šæ·»åŠ å‰é¦ˆå±‚ã€‚ç¡®ä¿ä»…ä½¿ç”¨æ­£æ•´æ•°ã€‚é€šå¸¸ï¼Œä½¿ç”¨2çš„å¹‚æ•°ã€‚åŒæ ·ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨åˆ—è¡¨ä¸­å‡å°å€¼ï¼šä¸‹ä¸€ä¸ªå€¼å°äºæˆ–ç­‰äºå‰ä¸€ä¸ªå€¼ã€‚ text: [256, 128], label: []  text: [256, 128]<br> <code>embedding_dimension </code>ï¼šæ­¤å‚æ•°å®šä¹‰æ¨¡å‹å†…éƒ¨ä½¿ç”¨çš„åµŒå…¥å±‚çš„è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>20</code>ã€‚æˆ‘ä»¬åœ¨æ¨¡å‹æ¶æ„å†…éƒ¨ä½¿ç”¨äº†å¤šä¸ªåµŒå…¥å±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”è¾ƒ<code>__CLS__</code>ä»¤ç‰Œå’Œè®¡ç®—æŸå¤±ä¹‹å‰ï¼Œå°†ä»¤ç‰Œçš„çŸ¢é‡å’Œæ„å›¾ä¼ é€’ç»™åµŒå…¥å±‚ã€‚<br><code>weight_sparsity</code>ï¼šæ­¤å‚æ•°å®šä¹‰äº†æ¨¡å‹ä¸­æ‰€æœ‰å‰é¦ˆå±‚çš„å†…æ ¸æƒé‡çš„åˆ†æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º0ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0.0</code>ã€‚è¯¥å€¼åº”åœ¨0åˆ°1ä¹‹é—´ã€‚å¦‚æœè®¾ç½®<code>weight_sparsity</code> ä¸º0ï¼Œåˆ™æ²¡æœ‰å†…æ ¸æƒé‡å°†è®¾ç½®ä¸º0ï¼Œè¯¥å±‚å°†å……å½“æ ‡å‡†å‰é¦ˆå±‚ã€‚æ‚¨ä¸åº”å°†å…¶è®¾ç½®<br><code>weight_sparsity</code>ï¼šæ­¤å‚æ•°å®šä¹‰äº†æ¨¡å‹ä¸­æ‰€æœ‰å‰é¦ˆå±‚çš„å†…æ ¸æƒé‡çš„åˆ†æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º0ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0.0</code>ã€‚è¯¥å€¼åº”åœ¨0åˆ°1ä¹‹é—´ã€‚å¦‚æœè®¾ç½®<code>weight_sparsity</code> ä¸º0ï¼Œåˆ™æ²¡æœ‰å†…æ ¸æƒé‡å°†è®¾ç½®ä¸º0ï¼Œè¯¥å±‚å°†å……å½“æ ‡å‡†å‰é¦ˆå±‚ã€‚æ‚¨ä¸åº”å°†å…¶è®¾ç½®<br><code>weight_sparsity</code>ä¸º1ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´æ‰€æœ‰å†…æ ¸æƒé‡å‡ä¸º0ï¼Œå³æ¨¡å‹æ— æ³•å­¦ä¹ ã€‚<br>ä¸Šé¢çš„é…ç½®å‚æ•°æ˜¯æ‚¨åº”è¯¥é…ç½®çš„å‚æ•°ï¼Œä»¥ä½¿æ¨¡å‹é€‚åˆæ•°æ®ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨å¯ä»¥è°ƒæ•´çš„å…¶ä»–å‚æ•°<br>*<em>æ³¨æ„</em><br>å‡ºäº<code>cosine</code>ç›¸ä¼¼æ€§<code>maximum_positive_similarity</code>ï¼Œ<code>maximum_negative_similarity</code>åº”åœ¨<code>-1</code>å’Œä¹‹é—´<code>1</code><br><strong>æ³¨æ„</strong><br>æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥ä½¿ç”¨çº¿æ€§å¢åŠ çš„æ‰¹é‡å¤§å°ã€‚è¿™ä¸ªæƒ³æ³•æ¥è‡ª <a href="https://arxiv.org/abs/1711.00489%E3%80%82%E4%B8%BA%E6%AD%A4%EF%BC%8C%E5%B0%86%E4%B8%80%E4%B8%AA%E5%88%97%E8%A1%A8%E4%BC%A0%E9%80%92%E7%BB%99">https://arxiv.org/abs/1711.00489ã€‚ä¸ºæ­¤ï¼Œå°†ä¸€ä¸ªåˆ—è¡¨ä¼ é€’ç»™</a> batch_sizeï¼Œä¾‹å¦‚ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ã€‚å¦‚æœéœ€è¦å¸¸é‡ï¼Œè¯·ä¼ é€’ï¼Œä¾‹å¦‚ã€‚â€batch_sizeâ€: [64, 256] batch_size int  â€œbatch_sizeâ€: 64 <br><strong>æ³¨æ„</strong><br>å‚æ•°<code>maximum_negative_similarity</code>è¢«è®¾å®šä¸ºè´Ÿå€¼çš„æƒ…å†µä¸‹æ¨¡æ‹ŸåŸå§‹starspaceç®—æ³• å’Œã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://arxiv.org/abs/1709.03856">æ˜Ÿç©ºçº¸</a>ã€‚<code>maximum_negative_similarity = maximum_positive_similarity``use_maximum_negative_similarity = False</code></td></tr></tbody></table><h3 id="KeywordIntentClassifier"><a href="#KeywordIntentClassifier" class="headerlink" title="KeywordIntentClassifier"></a>KeywordIntentClassifier</h3><table><thead><tr><th>Short</th><th>ç®€å•çš„å…³é”®å­—åŒ¹é…æ„å›¾åˆ†ç±»å™¨ï¼Œé€‚ç”¨äºå°å‹çŸ­æœŸé¡¹ç›®ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>intent</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œintentâ€: {â€œnameâ€: â€œgreetâ€, â€œconfidenceâ€: 1.0} }</td></tr><tr><td><strong>Description</strong></td><td>è¯¥åˆ†ç±»å™¨é€šè¿‡åœ¨æ¶ˆæ¯ä¸­æœç´¢å…³é”®å­—æ¥å·¥ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¹é…é¡¹åŒºåˆ†å¤§å°å†™ï¼Œå¹¶ä¸”ä»…æœç´¢ç”¨æˆ·æ¶ˆæ¯ä¸­å…³é”®å­—å­—ç¬¦ä¸²çš„å®Œå…¨åŒ¹é…é¡¹ã€‚æ„å›¾çš„å…³é”®å­—æ˜¯NLUè®­ç»ƒæ•°æ®ä¸­è¯¥æ„å›¾çš„ç¤ºä¾‹ã€‚è¿™æ„å‘³ç€æ•´ä¸ªç¤ºä¾‹éƒ½æ˜¯å…³é”®å­—ï¼Œè€Œä¸æ˜¯ç¤ºä¾‹ä¸­çš„å•ä¸ªå•è¯ã€‚<br><strong>æ³¨æ„</strong><br>æ­¤åˆ†ç±»å™¨ä»…é€‚ç”¨äºå°å‹é¡¹ç›®æˆ–å…¥é—¨ã€‚å¦‚æœæ‚¨å‡ ä¹æ²¡æœ‰NLUåŸ¹è®­æ•°æ®ï¼Œåˆ™å¯ä»¥åœ¨<a href="https://legacy-docs-v1.rasa.com/nlu/choosing-a-pipeline/#choosing-a-pipeline">é€‰æ‹©</a>ç®¡é“ä¸­æŸ¥çœ‹æ¨è <a href="#">çš„ç®¡é“</a>ã€‚<br></td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>      - name: â€œKeywordIntentClassifierâ€  <br>        case_sensitive: True</td></tr></tbody></table><h3 id="DIETClassifier"><a href="#DIETClassifier" class="headerlink" title="DIETClassifier"></a>DIETClassifier</h3><table><thead><tr><th>Short</th><th>åŒæ„å›¾å®ä½“å˜å‹å™¨ï¼ˆDIETï¼‰ç”¨äºæ„å›¾åˆ†ç±»å’Œå®ä½“æå–</th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>æ‚¨å¯ä»¥åœ¨â€œç»„åˆå®ä½“æå–å™¨å’Œæ„å›¾åˆ†ç±»å™¨â€éƒ¨åˆ†ä¸‹ æ‰¾åˆ°<a href="#">DIETClassifier</a>çš„è¯¦ç»†æè¿°ã€‚</td></tr></tbody></table><h2 id="Entity-Extractors"><a href="#Entity-Extractors" class="headerlink" title="Entity Extractors"></a>Entity Extractors</h2><p>å®ä½“æå–å™¨ä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–å®ä½“ï¼Œä¾‹å¦‚äººåæˆ–ä½ç½®ã€‚</p><h3 id="MitieEntityExtractor"><a href="#MitieEntityExtractor" class="headerlink" title="MitieEntityExtractor"></a>MitieEntityExtractor</h3><table><thead><tr><th>Short</th><th>MITIEå®ä½“æå–ï¼ˆä½¿ç”¨<a href="https://github.com/mit-nlp/MITIE/blob/master/mitielib/src/ner_trainer.cpp">MITIE NERè®­ç»ƒ</a>ï¼‰</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>entities</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">MitieNLP</a>å’Œ<code>tokens</code></td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œentitiesâ€: [{         â€œvalueâ€: â€œNew York Cityâ€,         â€œstartâ€: 20,         â€œendâ€: 33,         â€œconfidenceâ€: null,         â€œentityâ€: â€œcityâ€,         â€œextractorâ€: â€œMitieEntityExtractorâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td><code>MitieEntityExtractor</code>ä½¿ç”¨MITIEå®ä½“æå–æ¥æŸ¥æ‰¾æ¶ˆæ¯ä¸­çš„å®ä½“ã€‚åº•å±‚åˆ†ç±»å™¨ä½¿ç”¨å…·æœ‰ç¨€ç–çº¿æ€§å†…æ ¸å’Œè‡ªå®šä¹‰åŠŸèƒ½çš„å¤šç±»çº¿æ€§SVMã€‚MITIEç»„ä»¶ä¸æä¾›å®ä½“ç½®ä¿¡åº¦å€¼ã€‚<br><strong>æ³¨æ„</strong><br>è¯¥å®ä½“æå–å™¨ä¸ä¾èµ–ä»»ä½•ç‰¹å¾åŒ–å™¨ï¼Œå› ä¸ºå®ƒè‡ªå·±æå–ç‰¹å¾ã€‚<br></td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>    - name: â€œMitieEntityExtractorâ€</td></tr></tbody></table><h3 id="SpacyEntityExtractor"><a href="#SpacyEntityExtractor" class="headerlink" title="SpacyEntityExtractor"></a>SpacyEntityExtractor</h3><table><thead><tr><th>Short</th><th>Spacyå®ä½“æå–</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>entities</td></tr><tr><td><strong>Requires</strong></td><td><a href="#">SpacyNLP</a></td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œentitiesâ€: [{         â€œvalueâ€: â€œNew York Cityâ€,         â€œstartâ€: 20,         â€œendâ€: 33,         â€œconfidenceâ€: null,         â€œentityâ€: â€œcityâ€,         â€œextractorâ€: â€œSpacyEntityExtractorâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td>ä½¿ç”¨spaCyï¼Œæ­¤ç»„ä»¶å¯ä»¥é¢„æµ‹æ¶ˆæ¯çš„å®ä½“ã€‚spaCyä½¿ç”¨ç»Ÿè®¡çš„BILOUè½¬æ¢æ¨¡å‹ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ­¤ç»„ä»¶åªèƒ½ä½¿ç”¨spaCyå†…ç½®çš„å®ä½“æå–æ¨¡å‹ï¼Œå¹¶ä¸”ä¸èƒ½è¿›è¡Œé‡æ–°è®­ç»ƒã€‚è¯¥æå–å™¨ä¸æä¾›ä»»ä½•ç½®ä¿¡åº¦åˆ†æ•°ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td>é…ç½®spaCyç»„ä»¶åº”æå–çš„ç»´åº¦ï¼ˆå³å®ä½“ç±»å‹ï¼‰ã€‚å¯ç”¨å°ºå¯¸çš„å®Œæ•´åˆ—è¡¨å¯åœ¨<a href="#">spaCyæ–‡æ¡£ä¸­</a>æ‰¾åˆ°ã€‚ä¸æŒ‡å®šå°ºå¯¸é€‰é¡¹å°†æå–æ‰€æœ‰å¯ç”¨å°ºå¯¸ã€‚<br>pipeline: <br>      - name: â€œSpacyEntityExtractorâ€   <br>        dimensions: [â€œPERSONâ€, â€œLOCâ€, â€œORGâ€, â€œPRODUCTâ€]</td></tr></tbody></table><h3 id="EntitySynonymMapper"><a href="#EntitySynonymMapper" class="headerlink" title="EntitySynonymMapper"></a>EntitySynonymMapper</h3><table><thead><tr><th>Short</th><th>å°†åŒä¹‰å®ä½“å€¼æ˜ å°„åˆ°ç›¸åŒçš„å€¼ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>ä¿®æ”¹å…ˆå‰çš„å®ä½“æå–ç»„ä»¶æ‰¾åˆ°çš„ç°æœ‰å®ä½“ã€‚</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œentitiesâ€: [{         â€œvalueâ€: â€œNew York Cityâ€,         â€œstartâ€: 20,         â€œendâ€: 33,         â€œconfidenceâ€: null,         â€œentityâ€: â€œcityâ€,         â€œextractorâ€: â€œSpacyEntityExtractorâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td>å¦‚æœè®­ç»ƒæ•°æ®åŒ…å«å·²å®šä¹‰çš„åŒä¹‰è¯ï¼Œåˆ™æ­¤ç»„ä»¶å°†ç¡®ä¿å°†æ£€æµ‹åˆ°çš„å®ä½“å€¼æ˜ å°„åˆ°ç›¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®åŒ…å«ä»¥ä¸‹ç¤ºä¾‹ï¼š<br>[     {       â€œtextâ€: â€œI moved to New York Cityâ€,       â€œintentâ€: â€œinform_relocationâ€,       â€œentitiesâ€: [{         â€œvalueâ€: â€œnycâ€,         â€œstartâ€: 11,         â€œendâ€: 24,         â€œentityâ€: â€œcityâ€,       }]     },     {       â€œtextâ€: â€œI got a new flat in NYC.â€,       â€œintentâ€: â€œinform_relocationâ€,       â€œentitiesâ€: [{         â€œvalueâ€: â€œnycâ€,         â€œstartâ€: 20,         â€œendâ€: 23,         â€œentityâ€: â€œcityâ€,       }]     } ]<br>æ­¤ç»„ä»¶å°†å…è®¸ä½ åœ¨å®ä½“æ˜ å°„å’Œåˆ°ã€‚å³ä½¿æ¶ˆæ¯åŒ…å«ï¼Œå®ä½“æå–ä¹Ÿå°†è¿”å›ã€‚å½“æ­¤ç»„ä»¶æ›´æ”¹ç°æœ‰å®ä½“æ—¶ï¼Œä¼šå°†å…¶è‡ªèº«é™„åŠ åˆ°è¯¥å®ä½“çš„å¤„ç†å™¨åˆ—è¡¨ä¸­ã€‚<code>New York City``NYC``nyc``nyc``NYC</code></td></tr><tr><td><strong>Configuration</strong></td><td>pipeline: <br>    - name: â€œEntitySynonymMapperâ€<br><strong>æ³¨æ„</strong><br>å½“<code>EntitySynonymMapper</code>å°†Nç”¨ä½œNLUç®¡é“çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œéœ€è¦å°†å…¶æ”¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ä»»ä½•å®ä½“æå–å™¨çš„ä¸‹æ–¹ã€‚</td></tr></tbody></table><h3 id="CRFEntityExtractor"><a href="#CRFEntityExtractor" class="headerlink" title="CRFEntityExtractor"></a>CRFEntityExtractor</h3><table><thead><tr><th>Short</th><th>æ¡ä»¶éšæœºåœºï¼ˆCRFï¼‰å®ä½“æå–</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>ä¿®æ”¹å…ˆå‰çš„å®ä½“æå–ç»„ä»¶æ‰¾åˆ°çš„ç°æœ‰å®ä½“ã€‚</td></tr><tr><td><strong>Requires</strong></td><td><code>tokens</code>å’Œ<code>dense_features</code>ï¼ˆå¯é€‰ï¼‰</td></tr><tr><td><strong>Output-Example</strong></td><td>â€œentitiesâ€: [{         â€œvalueâ€: â€œNew York Cityâ€,         â€œstartâ€: 20,         â€œendâ€: 33,         â€œentityâ€: â€œcityâ€,         â€œconfidenceâ€: 0.874,         â€œextractorâ€: â€œCRFEntityExtractorâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td>è¯¥ç»„ä»¶å®ç°æ¡ä»¶éšæœºå­—æ®µï¼ˆCRFï¼‰ä»¥è¿›è¡Œå‘½åå®ä½“è¯†åˆ«ã€‚å¯ä»¥å°†CRFè§†ä¸ºæ— å‘é©¬å°”å¯å¤«é“¾ï¼Œå…¶ä¸­æ—¶é—´æ­¥é•¿æ˜¯å•è¯ï¼ŒçŠ¶æ€æ˜¯å®ä½“ç±»ã€‚å•è¯çš„ç‰¹å¾ï¼ˆå¤§å†™ï¼ŒPOSæ ‡è®°ç­‰ï¼‰èµ‹äºˆæŸäº›å®ä½“ç±»å‡ ç‡ï¼Œç›¸é‚»å®ä½“æ ‡ç­¾ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ˜¯å¦‚æ­¤ï¼šç„¶åè®¡ç®—å¹¶è¿”å›æœ€å¯èƒ½çš„ä¸€ç»„æ ‡ç­¾ã€‚</td></tr><tr><td><strong>Configuration</strong></td><td><code> CRFEntityExtractor</code>åˆ—å‡ºäº†è¦ä½¿ç”¨çš„é»˜è®¤åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è¦†ç›–é»˜è®¤é…ç½®ã€‚æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š<br>å½“åŠŸèƒ½åŒ–å™¨åœ¨å¸¦æœ‰æ»‘åŠ¨çª—å£çš„ç”¨æˆ·æ¶ˆæ¯ä¸­ç§»åŠ¨æ ‡è®°æ—¶ï¼Œæ‚¨å¯ä»¥ä¸ºæ»‘åŠ¨çª—å£ä¸­çš„å…ˆå‰æ ‡è®°ï¼Œå½“å‰æ ‡è®°å’Œä¸‹ä¸€ä¸ªæ ‡è®°å®šä¹‰åŠŸèƒ½ã€‚æ‚¨å¯ä»¥å°†ç‰¹å¾å®šä¹‰ä¸º[beforeï¼Œtokenï¼Œafter]æ•°ç»„ã€‚<br>BILOU_flag<code>ç¡®å®šæ˜¯å¦ä½¿ç”¨BILOUæ ‡è®°ã€‚é»˜è®¤</code>True<br>pipeline: <br>      - name: â€œCRFEntityExtractorâ€  <br>        â€œBILOU_flagâ€: True   <br>        â€œfeaturesâ€: [     [â€œlowâ€, â€œtitleâ€, â€œupperâ€],   <br>                         [  <br>                             â€œbiasâ€,    <br>                             â€œlowâ€,       <br>                             â€œprefix5â€,      <br>                             â€œprefix2â€,      <br>                             â€œsuffix5â€,    <br>                              â€œsuffix3â€,   <br>                              â€œsuffix2â€,     <br>                              â€œupperâ€,     <br>                             â€œtitleâ€,    <br>                             â€œdigitâ€,    <br>                              â€œpatternâ€,     ],   <br>                      [<br>                             â€œlowâ€, <br>                            â€œtitleâ€, <br>                           â€œupperâ€],    ]  <br>             â€œmax_iterationsâ€: 50   <br>              â€œL1_câ€: 0.1  <br>             â€œL2_câ€: 0.1<br><strong>æ³¨æ„</strong><br>å¦‚æœä½¿ç”¨POSåŠŸèƒ½ï¼ˆ<code>pos</code>æˆ–<code>pos2</code>ï¼‰ï¼Œåˆ™éœ€è¦<code>SpacyTokenizer</code>åœ¨ç®¡é“ä¸­ä½¿ç”¨ã€‚<br><strong>æ³¨æ„</strong><br>å¦‚æœä½¿ç”¨<code>pattern</code>åŠŸèƒ½ï¼Œåˆ™éœ€è¦åŒ…å«<code>RegexFeaturizer</code>åœ¨ç®¡é“ä¸­ã€‚</td></tr></tbody></table><h3 id="DucklingHTTPExtractor"><a href="#DucklingHTTPExtractor" class="headerlink" title="DucklingHTTPExtractor"></a>DucklingHTTPExtractor</h3><table><thead><tr><th>Short</th><th>ä½¿ç”¨Ducklingï¼Œæ‚¨å¯ä»¥ç”¨å¤šç§è¯­è¨€æå–å¸¸è§çš„å®ä½“ï¼Œä¾‹å¦‚æ—¥æœŸï¼Œé‡‘é¢ï¼Œè·ç¦»å’Œå…¶ä»–å®ä½“ã€‚</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>entities</td></tr><tr><td><strong>Requires</strong></td><td>æ²¡æœ‰</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œentitiesâ€: [{         â€œendâ€: 53,         â€œentityâ€: â€œtimeâ€,         â€œstartâ€: 48,         â€œvalueâ€: â€œ2017-04-10T00:00:00.000+02:00â€,         â€œconfidenceâ€: 1.0,         â€œextractorâ€: â€œDucklingHTTPExtractorâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td>è¦ä½¿ç”¨æ­¤ç»„ä»¶ï¼Œæ‚¨éœ€è¦è¿è¡Œä¸€ä¸ªå°é¸­æœåŠ¡å™¨ã€‚æœ€ç®€å•çš„é€‰æ‹©æ˜¯ä½¿ç”¨æ¥å¯åŠ¨dockerå®¹å™¨ ã€‚<code>docker run -p 8000:8000 rasa/duckling</code><br>å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥<a href="https://github.com/facebook/duckling#quickstart">ç›´æ¥åœ¨è®¡ç®—æœºä¸Šå®‰è£…Ducklingï¼Œ</a>ç„¶åå¯åŠ¨æœåŠ¡å™¨ã€‚<br>å°é¸­å¯ä»¥è¯†åˆ«æ—¥æœŸï¼Œæ•°å­—ï¼Œè·ç¦»å’Œå…¶ä»–ç»“æ„åŒ–å®ä½“å¹¶å°†å…¶æ ‡å‡†åŒ–ã€‚è¯·æ³¨æ„ï¼Œå°é¸­ä¼šå°è¯•åœ¨ä¸æä¾›æ’åçš„æƒ…å†µä¸‹æå–å°½å¯èƒ½å¤šçš„å®ä½“ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåŒæ—¶æŒ‡å®š<code>number</code>å’Œ<code>time</code>ä½œä¸ºå°é¸­ç»„ä»¶çš„å°ºå¯¸ï¼Œè¯¥ç»„ä»¶å°†æå–ä¸¤ä¸ªå®ä½“ï¼š<code>10</code>ä½œä¸ºæ•°å­—å’Œ ä½œä¸ºæ—¶é—´ä»textä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¿…é¡»ç¡®å®šå“ªç§å®ä½“ç±»å‹æ˜¯æ­£ç¡®çš„ã€‚æå–ç¨‹åºå°†å§‹ç»ˆè¿”å›1.0ä½œä¸ºç½®ä¿¡åº¦ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºè§„åˆ™çš„ç³»ç»Ÿã€‚<code>in 10 minutes``I will be there in 10 minutes</code></td></tr><tr><td><strong>Configuration</strong></td><td>é…ç½®å°é¸­ç»„ä»¶åº”æå–çš„å°ºå¯¸ï¼Œå³å®ä½“ç±»å‹ã€‚<a href="https://duckling.wit.ai/">å°é¸­æ–‡æ¡£</a>ä¸­æä¾›äº†å¯ç”¨å°ºå¯¸çš„å®Œæ•´åˆ—è¡¨ã€‚ä¸æŒ‡å®šå°ºå¯¸é€‰é¡¹å°†æå–æ‰€æœ‰å¯ç”¨å°ºå¯¸ã€‚<br>pipeline: <br>       - name: â€œDucklingHTTPExtractorâ€   <br>         url: â€œâ€  <br>         dimensions: [â€œtimeâ€, â€œnumberâ€, â€œamount-of-moneyâ€, â€œdistanceâ€]  <br>         locale: â€œde_DEâ€  <br>         timezone: â€œEurope/Berlinâ€   <br>         timeout : 3</td></tr></tbody></table><h3 id="DIETClassifier-1"><a href="#DIETClassifier-1" class="headerlink" title="DIETClassifier"></a>DIETClassifier</h3><table><thead><tr><th>Short</th><th>åŒæ„å›¾å®ä½“åˆ†ç±»å™¨ï¼ˆDIETï¼‰ç”¨äºæ„å›¾åˆ†ç±»å’Œå®ä½“æå–</th></tr></thead><tbody><tr><td><strong>Description</strong></td><td>æ‚¨å¯ä»¥åœ¨â€œç»„åˆå®ä½“æå–å™¨å’Œæ„å›¾åˆ†ç±»å™¨â€éƒ¨åˆ†ä¸‹ æ‰¾åˆ°<a href="https://legacy-docs-v1.rasa.com/nlu/components/#diet-classifier">DIETClassifier</a>çš„è¯¦ç»†æè¿°ã€‚</td></tr></tbody></table><h2 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h2><h3 id="ResponseSelector"><a href="#ResponseSelector" class="headerlink" title="ResponseSelector"></a>ResponseSelector</h3><table><thead><tr><th>Short</th><th>å“åº”é€‰æ‹©å™¨</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>å…³é”®å­—ä¸º<code>direct_response_intent</code>å’Œä¸”åŒ…å«<code>response</code>å’Œçš„å­—å…¸<code>ranking</code></td></tr><tr><td><strong>Requires</strong></td><td><code>dense_features</code>å’Œ/æˆ–<code>sparse_features</code>ç”¨äºç”¨æˆ·æ¶ˆæ¯å’Œå“åº”</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œresponse_selectorâ€: {       â€œfaqâ€: {         â€œresponseâ€: {â€œconfidenceâ€: 0.7356462617, â€œnameâ€: â€œSupports 3.5, 3.6 and 3.7, recommended version is 3.6â€},         â€œrankingâ€: [             {â€œconfidenceâ€: 0.7356462617, â€œnameâ€: â€œSupports 3.5, 3.6 and 3.7, recommended version is 3.6â€},             {â€œconfidenceâ€: 0.2134543431, â€œnameâ€: â€œYou can ask me about how to get startedâ€}         ]       }     } }</td></tr><tr><td><strong>Description</strong></td><td>å“åº”é€‰æ‹©å™¨ç»„ä»¶å¯ç”¨äºæ„å»ºå“åº”æ£€ç´¢æ¨¡å‹ï¼Œä»¥æ ¹æ®ä¸€ç»„å€™é€‰å“åº”ç›´æ¥é¢„æµ‹æœºå™¨äººå“åº”ã€‚è¯¥æ¨¡å‹çš„é¢„æµ‹ç”±<a href="https://legacy-docs-v1.rasa.com/core/retrieval-actions/#retrieval-actions">æ£€ç´¢åŠ¨ä½œä½¿ç”¨</a>ã€‚å®ƒå°†ç”¨æˆ·è¾“å…¥å’Œå“åº”æ ‡ç­¾åµŒå…¥åˆ°åŒä¸€ç©ºé—´ï¼Œå¹¶éµå¾ªä¸<a href="https://legacy-docs-v1.rasa.com/nlu/components/#diet-classifier">DIETClassifier</a>å®Œå…¨ç›¸åŒçš„ç¥ç»ç½‘ç»œæ¶æ„å’Œä¼˜åŒ–ã€‚<br><strong>æ³¨æ„</strong><br>å¦‚æœåœ¨é¢„æµ‹æ—¶é—´å†…ï¼Œä¸€æ¡æ¶ˆæ¯<strong>ä»…</strong>åŒ…å«è®­ç»ƒä¸­çœ‹ä¸è§çš„å•è¯ï¼Œå¹¶ä¸”æœªä½¿ç”¨è¯æ±‡é‡å¤–é¢„å¤„ç†å™¨ï¼Œåˆ™å¯ä»¥æœ‰æŠŠæ¡åœ°<code>None</code>é¢„æµ‹ ä¸€ä¸ªç©ºå“åº”<code>0.0</code>ã€‚å¦‚æœä»…å°†<a href="https://legacy-docs-v1.rasa.com/nlu/components/#countvectorsfeaturizer">CountVectorsFeaturizer</a>ä¸<code>word</code>åˆ†æä»ªä¸€èµ·ç”¨ä½œç‰¹å¾åŒ–å™¨ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœä½¿ç”¨<code>char_wb</code>åˆ†æä»ªï¼Œåˆ™åº”å§‹ç»ˆè·å¾—å¸¦æœ‰ç½®ä¿¡åº¦å€¼çš„å“åº”ã€‚<code>&gt; 0.0</code></td></tr><tr><td><strong>Configuration</strong></td><td>è¯¥ç®—æ³•å‡ ä¹åŒ…æ‹¬<a href="https://legacy-docs-v1.rasa.com/nlu/components/#diet-classifier">DIETClassifier</a>ä½¿ç”¨çš„æ‰€æœ‰è¶…å‚æ•°ã€‚å¦‚æœè¦è°ƒæ•´æ¨¡å‹ï¼Œè¯·é¦–å…ˆä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š<br><code>epochs</code>ï¼šæ­¤å‚æ•°è®¾ç½®ç®—æ³•æŸ¥çœ‹è®­ç»ƒæ•°æ®çš„æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>300</code>ã€‚ä¸€ä¸ª<code>epoch</code>æ˜¯ç­‰äºä¸€ä¸ªç›´ä¼ å’Œæ‰€æœ‰çš„è®­ç»ƒä¾‹å­ä¹‹ä¸€å‘é€šè¡Œã€‚æœ‰æ—¶ï¼Œæ¨¡å‹éœ€è¦æ›´å¤šçš„æ—¶æœŸæ‰èƒ½æ­£ç¡®å­¦ä¹ ã€‚æœ‰æ—¶æ›´å¤šçš„æ—¶æœŸä¸ä¼šå½±å“æ€§èƒ½ã€‚æ—¶æœŸæ•°è¶Šå°‘ï¼Œæ¨¡å‹è®­ç»ƒè¶Šå¿«ã€‚<br><code>hidden_layers_sizes</code>ï¼šæ­¤å‚æ•°å…è®¸æ‚¨ä¸ºç”¨æˆ·æ¶ˆæ¯å’Œæ„å›¾å®šä¹‰å‰é¦ˆå±‚çš„æ•°é‡åŠå…¶è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¯¹åº”ä¸€ä¸ªå‰é¦ˆå±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ï¼Œæˆ‘ä»¬å°†åœ¨å˜å‹å™¨å‰é¢æ·»åŠ ä¸¤ä¸ªå‰é¦ˆå±‚ã€‚è¾“å…¥ä»¤ç‰Œçš„çŸ¢é‡ï¼ˆæ¥è‡ªç”¨æˆ·æ¶ˆæ¯ï¼‰å°†ä¼ é€’åˆ°è¿™äº›å±‚ã€‚ç¬¬ä¸€å±‚çš„è¾“å‡ºå°ºå¯¸ä¸º256ï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºå°ºå¯¸ä¸º128ã€‚å¦‚æœä½¿ç”¨ç©ºåˆ—è¡¨ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™ä¸ä¼šæ·»åŠ å‰é¦ˆå±‚ã€‚ç¡®ä¿ä»…ä½¿ç”¨æ­£æ•´æ•°ã€‚é€šå¸¸ï¼Œä½¿ç”¨2çš„å¹‚æ•°ã€‚åŒæ ·ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨åˆ—è¡¨ä¸­å‡å°å€¼ï¼šä¸‹ä¸€ä¸ªå€¼å°äºæˆ–ç­‰äºå‰ä¸€ä¸ªå€¼ã€‚text: [256, 128], label: [256, 128]ã€€text: [256, 128]<br><code>embedding_dimension</code>ï¼šæ­¤å‚æ•°å®šä¹‰æ¨¡å‹å†…éƒ¨ä½¿ç”¨çš„åµŒå…¥å±‚çš„è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>20</code>ã€‚æˆ‘ä»¬åœ¨æ¨¡å‹æ¶æ„å†…éƒ¨ä½¿ç”¨äº†å¤šä¸ªåµŒå…¥å±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”è¾ƒ<code>__CLS__</code>ä»¤ç‰Œå’Œè®¡ç®—æŸå¤±ä¹‹å‰ï¼Œå°†ä»¤ç‰Œçš„çŸ¢é‡å’Œæ„å›¾ä¼ é€’ç»™åµŒå…¥å±‚ã€‚<br><code>number_of_transformer_layers</code>ï¼šæ­¤å‚æ•°è®¾ç½®è¦ä½¿ç”¨çš„å˜å‹å™¨å±‚æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0</code>ã€‚å˜å‹å™¨å±‚çš„æ•°é‡ä¸è¦ç”¨äºæ¨¡å‹çš„å˜å‹å™¨å—ç›¸å¯¹åº”<br><code>transformer_size</code>ï¼šæ­¤å‚æ•°è®¾ç½®å˜å‹å™¨ä¸­çš„å•ä½æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>None</code>ã€‚ä»å˜å‹å™¨å‡ºæ¥çš„çŸ¢é‡å°†å…·æœ‰ç»™å®šå€¼<code>transformer_size</code>ã€‚<br><code>weight_sparsity</code>ï¼šæ­¤å‚æ•°å®šä¹‰äº†æ¨¡å‹ä¸­æ‰€æœ‰å‰é¦ˆå±‚çš„å†…æ ¸æƒé‡çš„åˆ†æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º0ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0.8</code>ã€‚è¯¥å€¼åº”åœ¨0åˆ°1ä¹‹é—´ã€‚å¦‚æœè®¾ç½®<code>weight_sparsity</code> ä¸º0ï¼Œåˆ™æ²¡æœ‰å†…æ ¸æƒé‡å°†è®¾ç½®ä¸º0ï¼Œè¯¥å±‚å°†å……å½“æ ‡å‡†å‰é¦ˆå±‚ã€‚æ‚¨ä¸åº”å°†å…¶è®¾ç½®<code>weight_sparsity</code>ä¸º1ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´æ‰€æœ‰å†…æ ¸æƒé‡å‡ä¸º0ï¼Œå³æ¨¡å‹æ— æ³•å­¦ä¹ ã€‚<br>æ­¤å¤–ï¼Œè¯¥ç»„ä»¶è¿˜å¯ä»¥é…ç½®ä¸ºè®­ç»ƒé’ˆå¯¹ç‰¹å®šæ£€ç´¢æ„å›¾çš„å“åº”é€‰æ‹©å™¨ã€‚å‚æ•°<code>retrieval_intent</code>è®¾ç½®ä¸ºæ­¤å“åº”é€‰æ‹©å™¨æ¨¡å‹è®­ç»ƒçš„æ„å›¾çš„åç§°ã€‚é»˜è®¤å€¼ä¸º<code>None</code>ï¼Œå³æ¨¡å‹é’ˆå¯¹æ‰€æœ‰æ£€ç´¢æ„å›¾è¿›è¡Œäº†è®­ç»ƒã€‚</td></tr></tbody></table><h2 id="Combined-Entity-Extractors-and-Intent-Classifiers"><a href="#Combined-Entity-Extractors-and-Intent-Classifiers" class="headerlink" title="Combined Entity Extractors and Intent Classifiers"></a>Combined Entity Extractors and Intent Classifiers</h2><h3 id="DIETClassifier-2"><a href="#DIETClassifier-2" class="headerlink" title="DIETClassifier"></a>DIETClassifier</h3><table><thead><tr><th>Short</th><th>åŒæ„å›¾å®ä½“åˆ†ç±»å™¨ï¼ˆDIETï¼‰ç”¨äºæ„å›¾åˆ†ç±»å’Œå®ä½“æå–</th></tr></thead><tbody><tr><td><strong>Outputs</strong></td><td>entities<code>ï¼Œ</code>intent<code>å’Œ</code>intent_ranking</td></tr><tr><td><strong>Requires</strong></td><td><code>dense_features</code>å’Œ/æˆ–<code>sparse_features</code>ç”¨äºç”¨æˆ·æ¶ˆæ¯ä»¥åŠå¯é€‰çš„æ„å›¾</td></tr><tr><td><strong>Output-Example</strong></td><td>{     â€œintentâ€: {â€œnameâ€: â€œgreetâ€, â€œconfidenceâ€: 0.8343},     â€œintent_rankingâ€: [         {             â€œconfidenceâ€: 0.385910906220309,             â€œnameâ€: â€œgoodbyeâ€         },         {             â€œconfidenceâ€: 0.28161531595656784,             â€œnameâ€: â€œrestaurant_searchâ€         }     ],     â€œentitiesâ€: [{         â€œendâ€: 53,         â€œentityâ€: â€œtimeâ€,         â€œstartâ€: 48,         â€œvalueâ€: â€œ2017-04-10T00:00:00.000+02:00â€,         â€œconfidenceâ€: 1.0,         â€œextractorâ€: â€œDIETClassifierâ€     }] }</td></tr><tr><td><strong>Description</strong></td><td>DIETï¼ˆåŒé‡æ„å›¾å’Œå®ä½“è½¬æ¢å™¨ï¼‰æ˜¯ç”¨äºæ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«çš„å¤šä»»åŠ¡ä½“ç³»ç»“æ„ã€‚è¯¥æ¶æ„åŸºäºä¸¤ä¸ªä»»åŠ¡å…±äº«çš„å˜å‹å™¨ã€‚å®ä½“æ ‡ç­¾çš„åºåˆ—æ˜¯é€šè¿‡åœ¨ä¸ä»¤ç‰Œçš„è¾“å…¥åºåˆ—ç›¸å¯¹åº”çš„è½¬æ¢å™¨è¾“å‡ºåºåˆ—ä¹‹ä¸Šçš„æ¡ä»¶éšæœºå­—æ®µï¼ˆCRFï¼‰æ ‡è®°å±‚è¿›è¡Œé¢„æµ‹çš„ã€‚å¯¹äºæ„å›¾æ ‡ç­¾ï¼Œ<code>__CLS__</code>ä»¤ç‰Œå’Œæ„å›¾æ ‡ç­¾çš„è½¬æ¢å™¨è¾“å‡ºè¢«åµŒå…¥åˆ°å•ä¸ªè¯­ä¹‰å‘é‡ç©ºé—´ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ç‚¹ç§¯æŸå¤±æ¥æœ€å¤§åŒ–ä¸ç›®æ ‡æ ‡ç­¾çš„ç›¸ä¼¼æ€§ï¼Œå¹¶æœ€å°åŒ–ä¸é˜´æ€§æ ·å“çš„ç›¸ä¼¼æ€§ã€‚<br>å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è§‚çœ‹æˆ‘ä»¬çš„ <a href="https://www.youtube.com/playlist?list=PL75e0qA87dlG-za8eLI6t0_Pbxafk-cxb">è§†é¢‘</a>ï¼Œå…¶ä¸­æˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†æ¨¡å‹æ¶æ„ã€‚<br><strong>æ³¨æ„</strong><br>å¦‚æœåœ¨é¢„æµ‹æ—¶é—´å†…ï¼Œä¸€æ¡æ¶ˆæ¯<strong>ä»…</strong>åŒ…å«è®­ç»ƒä¸­çœ‹ä¸è§çš„å•è¯ï¼Œå¹¶ä¸”æœªä½¿ç”¨è¯æ±‡é‡å¤–é¢„å¤„ç†å™¨ï¼Œåˆ™å¯ä»¥æœ‰æŠŠæ¡åœ°<code>None</code>é¢„æµ‹ å‡ºä¸€ä¸ªç©ºçš„æ„å›¾<code>0.0</code>ã€‚å¦‚æœä»…å°†<a href="https://legacy-docs-v1.rasa.com/nlu/components/#countvectorsfeaturizer">CountVectorsFeaturizer</a>ä¸<code>word</code>åˆ†æä»ªä¸€èµ·ç”¨ä½œç‰¹å¾åŒ–å™¨ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœä½¿ç”¨<code>char_wb</code>åˆ†æä»ªï¼Œåˆ™åº”å§‹ç»ˆè·å¾—å…·æœ‰ç½®ä¿¡åº¦å€¼çš„æ„å›¾ã€‚<code>&gt; 0.0</code></td></tr><tr><td><strong>Configuration</strong></td><td>å¦‚æœè¦ä½¿ç”¨â€œ<code>DIETClassifier</code>ä»…ç”¨äºæ„å›¾åˆ†ç±»â€ï¼Œè¯·è®¾ç½®<code>entity_recognition</code>ä¸º<code>False</code>ã€‚å¦‚æœåªæƒ³è¿›è¡Œå®ä½“è¯†åˆ«ï¼Œè¯·è®¾ç½®<code>intent_classification</code>ä¸º<code>False</code>ã€‚é»˜è®¤æƒ…å†µä¸‹<code>DIETClassifier</code>ï¼Œä¸¤è€…éƒ½è®¾ç½®ï¼Œå³<code>entity_recognition</code>å’Œ<code>intent_classification</code>éƒ½è®¾ç½®ä¸º <code>True</code>ã€‚<br>æ‚¨å¯ä»¥å®šä¹‰è®¸å¤šè¶…å‚æ•°æ¥é€‚åº”æ¨¡å‹ã€‚å¦‚æœè¦è°ƒæ•´æ¨¡å‹ï¼Œè¯·é¦–å…ˆä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š<br><code>epochs</code>ï¼šæ­¤å‚æ•°è®¾ç½®ç®—æ³•æŸ¥çœ‹è®­ç»ƒæ•°æ®çš„æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>300</code>ã€‚ä¸€ä¸ª<code>epoch</code>æ˜¯ç­‰äºä¸€ä¸ªç›´ä¼ å’Œæ‰€æœ‰çš„è®­ç»ƒä¾‹å­ä¹‹ä¸€å‘é€šè¡Œã€‚æœ‰æ—¶ï¼Œæ¨¡å‹éœ€è¦æ›´å¤šçš„æ—¶æœŸæ‰èƒ½æ­£ç¡®å­¦ä¹ ã€‚æœ‰æ—¶æ›´å¤šçš„æ—¶æœŸä¸ä¼šå½±å“æ€§èƒ½ã€‚æ—¶æœŸæ•°è¶Šå°‘ï¼Œæ¨¡å‹è®­ç»ƒè¶Šå¿«ã€‚<br><code>hidden_layers_sizes</code>ï¼šæ­¤å‚æ•°å…è®¸æ‚¨ä¸ºç”¨æˆ·æ¶ˆæ¯å’Œæ„å›¾å®šä¹‰å‰é¦ˆå±‚çš„æ•°é‡åŠå…¶è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¯¹åº”ä¸€ä¸ªå‰é¦ˆå±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ï¼Œæˆ‘ä»¬å°†åœ¨å˜å‹å™¨å‰é¢æ·»åŠ ä¸¤ä¸ªå‰é¦ˆå±‚ã€‚è¾“å…¥ä»¤ç‰Œçš„çŸ¢é‡ï¼ˆæ¥è‡ªç”¨æˆ·æ¶ˆæ¯ï¼‰å°†ä¼ é€’åˆ°è¿™äº›å±‚ã€‚ç¬¬ä¸€å±‚çš„è¾“å‡ºå°ºå¯¸ä¸º256ï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºå°ºå¯¸ä¸º128ã€‚å¦‚æœä½¿ç”¨ç©ºåˆ—è¡¨ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œåˆ™ä¸ä¼šæ·»åŠ å‰é¦ˆå±‚ã€‚ç¡®ä¿ä»…ä½¿ç”¨æ­£æ•´æ•°ã€‚é€šå¸¸ï¼Œä½¿ç”¨2çš„å¹‚æ•°ã€‚åŒæ ·ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨åˆ—è¡¨ä¸­å‡å°å€¼ï¼šä¸‹ä¸€ä¸ªå€¼å°äºæˆ–ç­‰äºå‰ä¸€ä¸ªå€¼ã€‚text: [], label: []ã€€text: [256, 128]<br><code>embedding_dimension</code>ï¼šæ­¤å‚æ•°å®šä¹‰æ¨¡å‹å†…éƒ¨ä½¿ç”¨çš„åµŒå…¥å±‚çš„è¾“å‡ºå°ºå¯¸ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>20</code>ã€‚æˆ‘ä»¬åœ¨æ¨¡å‹æ¶æ„å†…éƒ¨ä½¿ç”¨äº†å¤šä¸ªåµŒå…¥å±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”è¾ƒ<code>__CLS__</code>ä»¤ç‰Œå’Œè®¡ç®—æŸå¤±ä¹‹å‰ï¼Œå°†ä»¤ç‰Œçš„çŸ¢é‡å’Œæ„å›¾ä¼ é€’ç»™åµŒå…¥å±‚ã€‚<br><code>number_of_transformer_layers</code>ï¼šæ­¤å‚æ•°è®¾ç½®è¦ä½¿ç”¨çš„å˜å‹å™¨å±‚æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>2</code>ã€‚å˜å‹å™¨å±‚çš„æ•°é‡ä¸è¦ç”¨äºæ¨¡å‹çš„å˜å‹å™¨å—ç›¸å¯¹åº”ã€‚<br><code>transformer_size</code>ï¼šæ­¤å‚æ•°è®¾ç½®å˜å‹å™¨ä¸­çš„å•ä½æ•°ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>256</code>ã€‚ä»å˜å‹å™¨å‡ºæ¥çš„çŸ¢é‡å°†å…·æœ‰ç»™å®šå€¼<code>transformer_size</code>ã€‚<br><code>weight_sparsity</code>ï¼šæ­¤å‚æ•°å®šä¹‰äº†æ¨¡å‹ä¸­æ‰€æœ‰å‰é¦ˆå±‚çš„å†…æ ¸æƒé‡çš„åˆ†æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º0ï¼ˆé»˜è®¤å€¼ï¼šï¼‰<code>0.8</code>ã€‚è¯¥å€¼åº”åœ¨0åˆ°1ä¹‹é—´ã€‚å¦‚æœè®¾ç½®<code>weight_sparsity</code> ä¸º0ï¼Œåˆ™æ²¡æœ‰å†…æ ¸æƒé‡å°†è®¾ç½®ä¸º0ï¼Œè¯¥å±‚å°†å……å½“æ ‡å‡†å‰é¦ˆå±‚ã€‚æ‚¨ä¸åº”å°†å…¶è®¾ç½®ï¼<code>weight_sparsity</code>ä¸º1ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´æ‰€æœ‰å†…æ ¸æƒé‡å‡ä¸º0ï¼Œå³æ¨¡å‹æ— æ³•å­¦ä¹ ã€‚<br>ä¸Šé¢çš„é…ç½®å‚æ•°æ˜¯æ‚¨åº”è¯¥é…ç½®çš„å‚æ•°ï¼Œä»¥ä½¿æ¨¡å‹é€‚åˆæ•°æ®ã€‚ä½†æ˜¯ï¼Œå­˜åœ¨å¯ä»¥è°ƒæ•´çš„å…¶ä»–å‚æ•°</td></tr></tbody></table><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(11)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-11/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-11/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="#">å…³äº</a></li><li><a href="#">ä»…ä½¿ç”¨NLU</a></li><li><a href="#">è®­ç»ƒæ•°æ®æ ¼å¼</a></li><li><a href="#">è¯­è¨€æ”¯æ´</a></li><li><a href="#">é€‰æ‹©ç®¡é“</a></li><li><a href="#">ç»„ä»¶</a></li><li><a href="#">å®ä½“æå–</a></li></ul><h1 id="NLU"><a href="#NLU" class="headerlink" title="NLU"></a>NLU</h1><h2 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h2><h3 id="Rasa-NLUï¼šèŠå¤©æœºå™¨äººå’ŒAIåŠ©æ‰‹çš„è¯­è¨€ç†è§£"><a href="#Rasa-NLUï¼šèŠå¤©æœºå™¨äººå’ŒAIåŠ©æ‰‹çš„è¯­è¨€ç†è§£" class="headerlink" title="Rasa NLUï¼šèŠå¤©æœºå™¨äººå’ŒAIåŠ©æ‰‹çš„è¯­è¨€ç†è§£"></a>Rasa NLUï¼šèŠå¤©æœºå™¨äººå’ŒAIåŠ©æ‰‹çš„è¯­è¨€ç†è§£</h3><p>Rasa NLUæ˜¯ä¸€ç§å¼€æºè‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·ï¼Œç”¨äºèŠå¤©æœºå™¨äººä¸­çš„æ„å›¾åˆ†ç±»ï¼Œå“åº”æ£€ç´¢å’Œå®ä½“æå–ã€‚ä¾‹å¦‚ï¼Œåƒè¿™æ ·çš„å¥å­</p><pre><code>"I am looking for a Mexican restaurant in the center of town"</code></pre><p>å¹¶è¿”å›ç»“æ„åŒ–æ•°æ®ï¼Œä¾‹å¦‚</p><pre><code>&amp;#123;  "intent": "search_restaurant",  "entities": &amp;#123;    "cuisine" : "Mexican",    "location" : "center"  &amp;#125;&amp;#125;</code></pre><p>å¦‚æœè¦å•ç‹¬ä½¿ç”¨Rasa NLUï¼Œè¯·å‚é˜…<a href="#">ä»…ä½¿ç”¨NLU</a>ã€‚</p><h2 id="ä»…ä½¿ç”¨NLU"><a href="#ä»…ä½¿ç”¨NLU" class="headerlink" title="ä»…ä½¿ç”¨NLU"></a>ä»…ä½¿ç”¨NLU</h2><p>å¦‚æœæ‚¨åªæƒ³å°†Rasaç”¨ä½œNLUç»„ä»¶ï¼Œåˆ™å¯ä»¥ï¼</p><h3 id="è®­ç»ƒä»…NLUæ¨¡å‹"><a href="#è®­ç»ƒä»…NLUæ¨¡å‹" class="headerlink" title="è®­ç»ƒä»…NLUæ¨¡å‹"></a>è®­ç»ƒä»…NLUæ¨¡å‹</h3><p>è¦ä»…è®­ç»ƒNLUæ¨¡å‹ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa train nlu</code></pre><p>è¿™å°†åœ¨<code>data/</code>ç›®å½•ä¸­æŸ¥æ‰¾NLUè®­ç»ƒæ•°æ®æ–‡ä»¶ï¼Œå¹¶å°†è®­ç»ƒåçš„æ¨¡å‹ä¿å­˜åœ¨<code>models/</code>ç›®å½•ä¸­ã€‚æ¨¡å‹çš„åç§°å°†ä»¥å¼€å¤´<code>nlu-</code>ã€‚</p><h3 id="æµ‹è¯•åœ¨å‘½ä»¤è¡Œä¸Šæ‚¨çš„NLUæ¨¡å‹"><a href="#æµ‹è¯•åœ¨å‘½ä»¤è¡Œä¸Šæ‚¨çš„NLUæ¨¡å‹" class="headerlink" title="æµ‹è¯•åœ¨å‘½ä»¤è¡Œä¸Šæ‚¨çš„NLUæ¨¡å‹"></a>æµ‹è¯•åœ¨å‘½ä»¤è¡Œä¸Šæ‚¨çš„NLUæ¨¡å‹</h3><p>è¦åœ¨å‘½ä»¤è¡Œä¸Šè¯•ç”¨æ‚¨çš„NLUæ¨¡å‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<code>rasa shell nlu</code></p><pre><code>rasa shell nlu</code></pre><p>è¿™å°†å¯åŠ¨rasa shellï¼Œå¹¶è¦æ±‚æ‚¨è¾“å…¥æ¶ˆæ¯è¿›è¡Œæµ‹è¯•ã€‚æ‚¨å¯ä»¥ç»§ç»­è¾“å…¥ä»»æ„å¤šçš„é‚®ä»¶ã€‚</p><p>å¦å¤–ï¼Œæ‚¨å¯ä»¥çœç•¥<code>nlu</code>å‚æ•°å¹¶ç›´æ¥ä¼ å…¥ä»…nlu-modelï¼š</p><pre><code>rasa shell -m models/nlu-20190515-144445.tar.gz</code></pre><h3 id="è¿è¡ŒNLUæœåŠ¡å™¨"><a href="#è¿è¡ŒNLUæœåŠ¡å™¨" class="headerlink" title="è¿è¡ŒNLUæœåŠ¡å™¨"></a>è¿è¡ŒNLUæœåŠ¡å™¨</h3><p>è¦ä½¿ç”¨æ‚¨çš„NLUæ¨¡å‹å¯åŠ¨æœåŠ¡å™¨ï¼Œè¯·åœ¨è¿è¡Œæ—¶ä¼ é€’æ¨¡å‹åç§°ï¼š</p><pre><code>rasa run --enable-api -m models/nlu-20190515-144445.tar.gz</code></pre><p>ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>/model/parse</code>ç«¯ç‚¹ä»æ¨¡å‹ä¸­è¯·æ±‚é¢„æµ‹ã€‚ä¸ºæ­¤ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>curl localhost:5005/model/parse -d '&amp;#123;"text":"hello"&amp;#125;'</code></pre><h2 id="è®­ç»ƒæ•°æ®æ ¼å¼"><a href="#è®­ç»ƒæ•°æ®æ ¼å¼" class="headerlink" title="è®­ç»ƒæ•°æ®æ ¼å¼"></a>è®­ç»ƒæ•°æ®æ ¼å¼</h2><h3 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h3><p>æ‚¨å¯ä»¥å°†åŸ¹è®­æ•°æ®ä½œä¸ºMarkdownæˆ–JSONï¼Œå•ä¸ªæ–‡ä»¶æˆ–åŒ…å«å¤šä¸ªæ–‡ä»¶çš„ç›®å½•æä¾›ã€‚è¯·æ³¨æ„ï¼ŒMarkdowné€šå¸¸æ›´æ˜“äºä½¿ç”¨ã€‚</p><h3 id="Markdownæ ¼å¼"><a href="#Markdownæ ¼å¼" class="headerlink" title="Markdownæ ¼å¼"></a>Markdownæ ¼å¼</h3><p>Markdownæ˜¯äººç±»æœ€å®¹æ˜“é˜…è¯»å’Œä¹¦å†™çš„Rasa NLUæ ¼å¼ã€‚ç¤ºä¾‹ä½¿ç”¨æ— åºåˆ—è¡¨è¯­æ³•åˆ—å‡ºï¼Œä¾‹å¦‚minus <code>-</code>ï¼Œæ˜Ÿå·<code>*</code>æˆ–plus <code>+</code>ã€‚ç¤ºä¾‹æŒ‰æ„å‘è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸”å®ä½“é€šè¿‡ä¾‹å¦‚æˆ–ä½¿ç”¨ä»¥ä¸‹è¯­æ³•æ³¨é‡Šä¸ºMarkdowné“¾æ¥ã€‚ä½¿ç”¨åä¸€ç§è¯­æ³•ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºå®ä½“åˆ†é…åŒä¹‰è¯ï¼Œè§’è‰²æˆ–ç»„ï¼Œä¾‹å¦‚ ã€‚å…³é”®å­—ï¼Œå’Œåœ¨æ­¤ç¬¦å·ä¸­æ˜¯å¯é€‰çš„ã€‚è¦äº†è§£æ ‡ç­¾åŠå…¶ç”¨é€”ï¼Œè¯·å‚é˜…â€œ<a href="#">å®ä½“è§’è‰²å’Œç»„â€éƒ¨åˆ†</a>ã€‚<code>[&lt;entity text&gt;](&lt;entity name&gt;)``[&lt;entity-text&gt;]{"entity": "&lt;entity name&gt;"}``[&lt;entity-text&gt;]{"entity": "&lt;entity name&gt;", "role": "&lt;role name&gt;", "group": "&lt;group name&gt;", "value": "&lt;entity synonym&gt;"}``role``group``value``role``group</code></p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:check_balance</span><span class="token list punctuation">-</span> what is my balance <span class="token comment" spellcheck="true">&lt;!-- no entity --></span><span class="token list punctuation">-</span> how much do I have on my <span class="token url">[savings](source_account)</span> <span class="token comment" spellcheck="true">&lt;!-- entity "source_account" has value "savings" --></span><span class="token list punctuation">-</span> how much do I have on my [savings account]<span class="token entity" title="&#123;">&amp;#123;</span>"entity": "source_account", "value": "savings"<span class="token entity" title="&#125;">&amp;#125;</span> <span class="token comment" spellcheck="true">&lt;!-- synonyms, method 1--></span><span class="token list punctuation">-</span> Could I pay in <span class="token url">[yen](currency)</span>?  <span class="token comment" spellcheck="true">&lt;!-- entity matched by lookup table --></span><span class="token title important"><span class="token punctuation">##</span> intent:greet</span><span class="token list punctuation">-</span> hey<span class="token list punctuation">-</span> hello<span class="token title important"><span class="token punctuation">##</span> synonym:savings   </span><span class="token comment" spellcheck="true">&lt;!-- synonyms, method 2 --></span><span class="token list punctuation">-</span> pink pig<span class="token title important"><span class="token punctuation">##</span> regex:zipcode</span><span class="token list punctuation">-</span> [0-9]<span class="token entity" title="&#123;">&amp;#123;</span>5<span class="token entity" title="&#125;">&amp;#125;</span><span class="token title important"><span class="token punctuation">##</span> lookup:additional_currencies  </span><span class="token comment" spellcheck="true">&lt;!-- specify lookup tables in an external file --></span>path/to/currencies.txt</code></pre><p>Rasa NLUçš„åŸ¹è®­æ•°æ®åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¸¸è§çš„ä¾‹å­</li><li>åŒä¹‰è¯</li><li>æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½å’Œ</li><li>æŸ¥æ‰¾è¡¨</li></ul><p>å°½ç®¡é€šç”¨ç¤ºä¾‹æ˜¯å”¯ä¸€å¿…éœ€çš„éƒ¨åˆ†ï¼Œä½†åŒ…æ‹¬å…¶ä»–ç¤ºä¾‹å°†å¸®åŠ©NLUæ¨¡å‹ä»¥æ›´å°‘çš„ç¤ºä¾‹æ¥å­¦ä¹ é¢†åŸŸï¼Œå¹¶å¸®åŠ©å…¶å¯¹è‡ªå·±çš„é¢„æµ‹æ›´æœ‰ä¿¡å¿ƒã€‚</p><p>åŒä¹‰è¯ä¼šå°†æå–çš„å®ä½“æ˜ å°„åˆ°ç›¸åŒçš„åç§°ï¼Œä¾‹å¦‚ï¼Œå°†â€œæˆ‘çš„å‚¨è“„å¸æˆ·â€æ˜ å°„ä¸ºç®€å•çš„â€œå‚¨è“„â€ã€‚ä½†æ˜¯ï¼Œè¿™ä»…<em>åœ¨</em>æå–å®ä½“<em>ä¹‹å</em>æ‰å‘ç”Ÿï¼Œå› æ­¤æ‚¨éœ€è¦æä¾›å¸¦æœ‰åŒä¹‰è¯çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿Rasaå¯ä»¥å­¦ä¹ å°†å…¶æå–ã€‚</p><p>æŸ¥æ‰¾è¡¨å¯ä»¥æŒ‡å®šä¸ºåŒ…å«æ¢è¡Œç¬¦åˆ†éš”çš„å•è¯æˆ–çŸ­è¯­çš„çº¯æ–‡æœ¬æ–‡ä»¶ã€‚åŠ è½½è®­ç»ƒæ•°æ®åï¼Œè¿™äº›æ–‡ä»¶å°†ç”¨äºç”Ÿæˆä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¼šæ·»åŠ åˆ°æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ä¸­ã€‚</p><blockquote><p>æ³¨æ„</p><p>è¿™é‡Œçš„å…±åŒä¸»é¢˜æ˜¯ï¼Œå…±åŒçš„ç¤ºä¾‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½å’ŒæŸ¥æ‰¾è¡¨ä»…é€šè¿‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸ºæœºå™¨å­¦ä¹ ç®—æ³•æä¾›å…¶ä»–åŠŸèƒ½ï¼Œæ¥å……å½“æœ€ç»ˆNLUæ¨¡å‹çš„çº¿ç´¢ã€‚å› æ­¤ï¼Œä¸èƒ½è®¤ä¸ºåªæœ‰ä¸€ä¸ªç¤ºä¾‹è¶³ä»¥ä½¿æ¨¡å‹åœ¨è¯¥ç¤ºä¾‹çš„æ‰€æœ‰å˜ä½“ä¸­å¯é åœ°æ ‡è¯†æ„å›¾å’Œ/æˆ–å®ä½“ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p><code>/</code>ç¬¦å·ä¿ç•™ä¸ºåˆ†éš”ç¬¦ï¼Œç”¨äºå°†æ£€ç´¢æ„å›¾ä¸å“åº”æ–‡æœ¬æ ‡è¯†ç¬¦åˆ†å¼€ã€‚ç¡®ä¿ä¸è¦ä»¥æ‚¨çš„æ„å›¾çš„åä¹‰ä½¿ç”¨å®ƒã€‚</p></blockquote><blockquote><p>è­¦å‘Š</p><p>ä¸æ¨èä½¿ç”¨ç”¨äºæŒ‡å®šåŒä¹‰è¯çš„åŒä¹‰è¯æ ¼å¼ã€‚è¯·ä½¿ç”¨æ–°æ ¼å¼ã€‚<code>[savings account](source_account:savings)``[savings account]{"entity": "source_account", "value": "savings"}</code></p><p>è¦æ›´æ–°æ‚¨çš„è®­ç»ƒæ•°æ®æ–‡ä»¶ï¼Œè¯·åœ¨æ‚¨é€‰æ‹©çš„ç»ˆç«¯ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œæ‚¨çš„NLUè®­ç»ƒæ•°æ®æ–‡ä»¶å°†åŒ…å«æ–°çš„è®­ç»ƒæ•°æ®æ ¼å¼ã€‚æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´æ–°sedå‘½ä»¤çš„è¯­æ³•ã€‚<code>sed -i -E 's/\[([^)]+)\]\(([^)]+):([^)]+)\)/[\1]{"entity": "\2", "value": "\3"}/g' &lt;nlu training data file&gt;</code></p></blockquote><h3 id="JSONæ ¼å¼"><a href="#JSONæ ¼å¼" class="headerlink" title="JSONæ ¼å¼"></a>JSONæ ¼å¼</h3><p>JSONæ ¼å¼ç”±è¢«ç§°ä¸ºé¡¶å±‚å¯¹è±¡çš„<code>rasa_nlu_data</code>ï¼Œä¸é”® <code>common_examples</code>ï¼Œ<code>entity_synonyms</code>å’Œ<code>regex_features</code>ã€‚æœ€é‡è¦çš„æ˜¯<code>common_examples</code>ã€‚</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"rasa_nlu_data"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"common_examples"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"regex_features"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"lookup_tables"</span>  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"entity_synonyms"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>æœ¬<code>common_examples</code>æ˜¯ç”¨æ¥è®­ç»ƒæ¨¡å‹ã€‚æ‚¨åº”è¯¥å°†æ‰€æœ‰è®­ç»ƒç¤ºä¾‹æ”¾åœ¨<code>common_examples</code>æ•°ç»„ä¸­ã€‚æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯å¸®åŠ©åˆ†ç±»å™¨æ£€æµ‹å®ä½“æˆ–æ„å›¾å¹¶æé«˜æ€§èƒ½ã€‚</p><h3 id="æé«˜æ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«"><a href="#æé«˜æ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«" class="headerlink" title="æé«˜æ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«"></a>æé«˜æ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«</h3><h4 id="å¸¸è§çš„ä¾‹å­"><a href="#å¸¸è§çš„ä¾‹å­" class="headerlink" title="å¸¸è§çš„ä¾‹å­"></a>å¸¸è§çš„ä¾‹å­</h4><p>å¸¸è§çš„ä¾‹å­æœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š<code>text</code>ï¼Œ<code>intent</code>å’Œ<code>entities</code>ã€‚å‰ä¸¤ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œæœ€åä¸€ä¸ªæ˜¯æ•°ç»„ã€‚</p><blockquote><ul><li>è¯¥<em>æ–‡æœ¬</em>æ˜¯ç”¨æˆ·æ¶ˆæ¯[éœ€è¦]</li><li>çš„<em>æ„å›¾</em>æ˜¯ï¼Œåº”ä¸æ–‡å­—ç›¸å…³çš„æ„å›¾[å¯é€‰]</li><li>è¯¥<em>å®ä½“</em>æ˜¯éœ€è¦è¢«è¯†åˆ«çš„æ–‡æœ¬çš„ç‰¹å®šéƒ¨åˆ†[å¯é€‰]</li></ul></blockquote><p>å®ä½“ç”¨<code>start</code>å’Œ<code>end</code>å€¼æŒ‡å®šï¼Œå®ƒä»¬ä¸€èµ·æ„æˆäº†è¦åº”ç”¨äºå­—ç¬¦ä¸²çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ï¼Œç„¶åæ˜¯ ã€‚å®ä½“å¯ä»¥è·¨è¶Šå¤šä¸ªå•è¯ï¼Œå®é™…ä¸Šï¼Œè¯¥å­—æ®µä¸å¿…ä¸ç¤ºä¾‹ä¸­çš„å­å­—ç¬¦ä¸²å®Œå…¨å¯¹åº”ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥å°†åŒä¹‰è¯æˆ–æ‹¼å†™é”™è¯¯æ˜ å°„åˆ°åŒä¸€ä¸ªã€‚<code>text="show me chinese restaurants"``text[8:15] == 'chinese'``value``value</code></p><pre><code>## intent:restaurant_search- show me [chinese](cuisine) restaurants</code></pre><h4 id="æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½"><a href="#æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½"></a>æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½</h4><p>æ­£åˆ™è¡¨è¾¾å¼å¯ç”¨äºæ”¯æŒæ„å›¾åˆ†ç±»å’Œå®ä½“æå–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„å®ä½“å…·æœ‰ç¡®å®šæ€§ç»“æ„ï¼ˆä¾‹å¦‚é‚®æ”¿ç¼–ç æˆ–ç”µå­é‚®ä»¶åœ°å€ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥ç®€åŒ–å¯¹è¯¥å®ä½“çš„æ£€æµ‹ã€‚å¯¹äºé‚®æ”¿ç¼–ç ç¤ºä¾‹ï¼Œå®ƒå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-reStructuredText"><code class="language-reStructuredText">## regex:zipcode- [0-9]&#123;5&#125;## regex:greet- hey[^\\s]*</code></pre><p>åç§°å¹¶æ²¡æœ‰å®šä¹‰å®ä½“æˆ–æ„å›¾ï¼Œå®ƒåªæ˜¯äººç±»å¯è¯»çš„æè¿°ï¼Œæ‚¨å¯ä»¥è®°ä½è¯¥æ­£åˆ™è¡¨è¾¾å¼çš„ç”¨é€”ï¼Œå¹¶ä¸”æ˜¯ç›¸åº”æ¨¡å¼ç‰¹å¾çš„æ ‡é¢˜ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½æ¥æ”¹å–„æ„å›¾åˆ†ç±»æ€§èƒ½ã€‚</p><p>å°è¯•ä»¥ä½¿å…¶ä¸å°½å¯èƒ½å°‘çš„å•è¯åŒ¹é…çš„æ–¹å¼åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>hey[^\s]*</code> è€Œä¸æ˜¯<code>hey.*</code>ï¼Œå› ä¸ºåé¢çš„å¯èƒ½åŒ¹é…æ•´ä¸ªæ¶ˆæ¯ï¼Œè€Œç¬¬ä¸€ä¸ªå¯èƒ½åªåŒ¹é…ä¸€ä¸ªå•è¯ã€‚</p><p>è¯¥<code>CRFEntityExtractor</code>ç»„ä»¶å½“å‰ä»…æ”¯æŒç”¨äºå®ä½“æå–çš„æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ï¼å› æ­¤ï¼Œå…¶ä»–å®ä½“æå–å™¨ï¼ˆå–œæ¬¢<code>MitieEntityExtractor</code>æˆ–<code>SpacyEntityExtractor</code>ä¸ä½¿ç”¨ç”Ÿæˆçš„ç‰¹å¾ï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬çš„å­˜åœ¨ä¸ä¼šæé«˜è¿™äº›æå–å™¨çš„å®ä½“è¯†åˆ«åº¦ã€‚å½“å‰ï¼Œæ‰€æœ‰æ„å›¾åˆ†ç±»å™¨éƒ½ä½¿ç”¨å¯ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ã€‚</p><blockquote><p>æ³¨æ„</p><p>æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½æ— æ³•å®šä¹‰å®ä½“æˆ–æ„å›¾ï¼å®ƒä»¬ä»…æä¾›æ¨¡å¼æ¥å¸®åŠ©åˆ†ç±»å™¨è¯†åˆ«å®ä½“å’Œç›¸å…³æ„å›¾ã€‚å› æ­¤ï¼Œæ‚¨ä»ç„¶éœ€è¦åœ¨è®­ç»ƒæ•°æ®ä¸­æä¾›æ„å›¾å’Œå®ä½“ç¤ºä¾‹ï¼</p></blockquote><h4 id="æŸ¥æ‰¾è¡¨"><a href="#æŸ¥æ‰¾è¡¨" class="headerlink" title="æŸ¥æ‰¾è¡¨"></a>æŸ¥æ‰¾è¡¨</h4><p>æŸ¥æ‰¾è¡¨æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥æä¾›å®ä½“ç¤ºä¾‹çš„åˆ—è¡¨ã€‚æä¾›çš„æŸ¥æ‰¾è¡¨æ–‡ä»¶å¿…é¡»é‡‡ç”¨æ¢è¡Œç¬¦åˆ†éš”çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œ<code>data/test/lookup_tables/plates.txt</code>å¯èƒ½åŒ…å«ï¼š</p><pre class=" language-markdown"><code class="language-markdown">tacosbeefmapo tofuburritolettuce wrap</code></pre><p>å¹¶å¯ä»¥æŒ‰å¦‚ä¸‹æ‰€ç¤ºåŠ è½½å’Œä½¿ç”¨ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> lookup:plates</span>data/test/lookup_tables/plates.txt<span class="token title important"><span class="token punctuation">##</span> intent:food_request</span><span class="token list punctuation">-</span> I'd like beef <span class="token url">[tacos](plates)</span> and a <span class="token url">[burrito](plates)</span><span class="token list punctuation">-</span> How about some <span class="token url">[mapo tofu](plates)</span></code></pre><p>åœ¨è®­ç»ƒæ•°æ®ä¸­æä¾›æŸ¥æ‰¾è¡¨æ—¶ï¼Œå†…å®¹å°†ç»„åˆæˆä¸€ä¸ªå¤§å†™ï¼Œä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œè¯¥æ¨¡å¼åœ¨è®­ç»ƒç¤ºä¾‹ä¸­æŸ¥æ‰¾å®Œå…¨åŒ¹é…çš„å†…å®¹ã€‚è¿™äº›æ­£åˆ™è¡¨è¾¾å¼å¯åŒ¹é…å¤šä¸ªä»¤ç‰Œï¼Œå› æ­¤ å°†åŒ¹é…ä¸ºã€‚è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†æ–¹å¼ä¸ç›´æ¥åœ¨è®­ç»ƒæ•°æ®ä¸­æŒ‡å®šçš„å¸¸è§„æ­£åˆ™è¡¨è¾¾å¼æ ·å¼ç›¸åŒã€‚<code>lettuce wrap``get me a lettuce wrap ASAP``[0 0 0 1 1 0]</code></p><blockquote><p>æ³¨æ„</p><p>ä¸ºäº†ä½¿æŸ¥è¯¢è¡¨æœ‰æ•ˆï¼Œæ‚¨çš„è®­ç»ƒæ•°æ®ä¸­å¿…é¡»æœ‰ä¸€äº›åŒ¹é…ç¤ºä¾‹ã€‚å¦åˆ™ï¼Œæ¨¡å‹å°†ä¸ä¼šå­¦ä¹ ä½¿ç”¨æŸ¥æ‰¾è¡¨åŒ¹é…åŠŸèƒ½ã€‚</p></blockquote><blockquote><p>è­¦å‘Š</p><p>å°†æ•°æ®æ·»åŠ åˆ°æŸ¥æ‰¾è¡¨æ—¶ï¼Œå¿…é¡»å°å¿ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨è¯¯æŠ¥æˆ–å…¶ä»–æ‚éŸ³ï¼Œåˆ™å¯èƒ½ä¼šæŸå®³æ€§èƒ½ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‚¨çš„æŸ¥è¯¢è¡¨åŒ…å«å¹²å‡€çš„æ•°æ®ã€‚</p></blockquote><h3 id="æ•°æ®æ ‡å‡†åŒ–"><a href="#æ•°æ®æ ‡å‡†åŒ–" class="headerlink" title="æ•°æ®æ ‡å‡†åŒ–"></a>æ•°æ®æ ‡å‡†åŒ–</h3><h3 id="å®ä½“åˆ«å"><a href="#å®ä½“åˆ«å" class="headerlink" title="å®ä½“åˆ«å"></a>å®ä½“åˆ«å</h3><p>å¦‚æœæ‚¨å°†å®ä½“å®šä¹‰ä¸ºå…·æœ‰ç›¸åŒçš„å€¼ï¼Œåˆ™å®ƒä»¬å°†è¢«è§†ä¸ºåŒä¹‰è¯ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>## intent:search- in the center of [NYC]&amp;#123;"entity": "city", "value": "New York City"&amp;#125;- in the centre of [New York City](city)</code></pre><p>å¦‚æ‚¨æ‰€è§ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çš„æ–‡æœ¬ä¸ºï¼Œå®ä½“åœ¨ä¸¤ä¸ªç¤ºä¾‹ä¸­å‡<code>city</code>å…·æœ‰å€¼ã€‚é€šè¿‡å°†valueå±æ€§å®šä¹‰ä¸ºä¸å®ä½“çš„å¼€å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ä¹‹é—´çš„æ–‡æœ¬ä¸­æ‰¾åˆ°çš„å€¼ä¸åŒï¼Œå¯ä»¥å®šä¹‰åŒä¹‰è¯ã€‚æ¯å½“æ‰¾åˆ°ç›¸åŒçš„æ–‡æœ¬æ—¶ï¼Œè¯¥å€¼å°†ä½¿ç”¨åŒä¹‰è¯ä»£æ›¿æ¶ˆæ¯ä¸­çš„å®é™…æ–‡æœ¬ã€‚<code>New York City``NYC</code></p><p>è¦ä½¿ç”¨è®­ç»ƒæ•°æ®ä¸­å®šä¹‰çš„åŒä¹‰è¯ï¼Œæ‚¨éœ€è¦ç¡®ä¿ç®¡é“åŒ…å« <code>EntitySynonymMapper</code>ç»„ä»¶ï¼ˆè¯·å‚é˜…<a href="#">Components</a>ï¼‰ã€‚</p><p>å¦å¤–ï¼Œæ‚¨å¯ä»¥æ·»åŠ â€œ entity_synonymsâ€æ•°ç»„æ¥ä¸ºä¸€ä¸ªå®ä½“å€¼å®šä¹‰å¤šä¸ªåŒä¹‰è¯ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> synonym:New York City</span><span class="token list punctuation">-</span> NYC<span class="token list punctuation">-</span> nyc<span class="token list punctuation">-</span> the big apple</code></pre><blockquote><p>æ³¨æ„</p><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨ä¸Šè¿°æ ¼å¼æ·»åŠ åŒä¹‰è¯ä¸ä¼šæ”¹å–„è¿™äº›å®ä½“çš„æ¨¡å‹åˆ†ç±»ã€‚ <strong>åœ¨å°†å®ä½“æ›¿æ¢ä¸ºåŒä¹‰è¯å€¼ä¹‹å‰ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œæ­£ç¡®åˆ†ç±»ã€‚</strong></p></blockquote><h2 id="è¯­è¨€æ”¯æŒ"><a href="#è¯­è¨€æ”¯æŒ" class="headerlink" title="è¯­è¨€æ”¯æŒ"></a>è¯­è¨€æ”¯æŒ</h2><p>æ‚¨å¯ä»¥ä½¿ç”¨Rasaä»¥æ‰€éœ€çš„ä»»ä½•è¯­è¨€æ„å»ºåŠ©æ‰‹ï¼Rasaçš„ <code>supervised_embeddings</code>ç®¡é“å¯ä»¥ç”¨äº<strong>ä»»ä½•è¯­è¨€çš„</strong>è®­ç»ƒæ•°æ®ã€‚è¯¥ç®¡é“ä½¿ç”¨æ‚¨æä¾›çš„æ•°æ®ä»å¤´å¼€å§‹åˆ›å»ºå•è¯åµŒå…¥ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒé¢„è®­ç»ƒçš„å•è¯åµŒå…¥ï¼Œä¾‹å¦‚spaCyã€‚æœ‰å…³å“ªç§ç®¡é“æœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="#">é€‰æ‹©ç®¡é“</a>ã€‚</p><h3 id="åœ¨ä»»ä½•è¯­è¨€åŸ¹è®­æ¨¡å‹"><a href="#åœ¨ä»»ä½•è¯­è¨€åŸ¹è®­æ¨¡å‹" class="headerlink" title="åœ¨ä»»ä½•è¯­è¨€åŸ¹è®­æ¨¡å‹"></a>åœ¨ä»»ä½•è¯­è¨€åŸ¹è®­æ¨¡å‹</h3><p>Rasaçš„<code>supervised_embeddings</code>ç®¡é“å¯ç”¨äºä»¥ä»»ä½•è¯­è¨€è®­ç»ƒæ¨¡å‹ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ‚¨è‡ªå·±çš„è®­ç»ƒæ•°æ®æ¥åˆ›å»ºè‡ªå®šä¹‰å•è¯åµŒå…¥ã€‚è¿™æ„å‘³ç€ä»»ä½•ç‰¹å®šå•è¯çš„å‘é‡è¡¨ç¤ºå½¢å¼éƒ½å°†å–å†³äºå…¶ä¸è®­ç»ƒæ•°æ®ä¸­å…¶ä»–å•è¯çš„å…³ç³»ã€‚è¿™ç§å®šåˆ¶è¿˜æ„å‘³ç€ï¼Œè¯¥ç®¡é“éå¸¸é€‚åˆä¾èµ–ç‰¹å®šäºåŸŸçš„æ•°æ®çš„ç”¨ä¾‹ï¼Œä¾‹å¦‚é‚£äº›éœ€è¦æå–ç‰¹å®šäº§å“åç§°çš„ç”¨ä¾‹ã€‚</p><p>è¦ä½¿ç”¨æ‚¨çš„é¦–é€‰è¯­è¨€è®­ç»ƒRasaæ¨¡å‹ï¼Œè¯·é€šè¿‡<a href="#">æ­¤å¤„</a>çš„è¯´æ˜<code>supervised_embeddings</code>å°†ç®¡é“å®šä¹‰ ä¸ºæ‚¨<code>config.yml</code>æˆ–å…¶ä»–é…ç½®æ–‡ä»¶ä¸­çš„ç®¡é“ã€‚</p><p>å®šä¹‰<code>supervised_embeddings</code>å¤„ç†ç®¡é“å¹¶ ä»¥æ‚¨é€‰æ‹©çš„è¯­è¨€ç”Ÿæˆä¸€äº›<a href="#">NLUè®­ç»ƒæ•°æ®å</a>ï¼Œè¯·ä½¿ç”¨è®­ç»ƒæ¨¡å‹ã€‚è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥æµ‹è¯•æ¨¡å‹çš„è¯­è¨€æŠ€èƒ½ã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ¨¡å‹å¦‚ä½•è§£é‡Šä¸åŒçš„è¾“å…¥æ¶ˆæ¯ï¼š<code>rasa train nlu</code></p><pre class=" language-shell"><code class="language-shell">rasa shell nlu</code></pre><blockquote><p>æ³¨æ„</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œä»å¤´å¼€å§‹è®­ç»ƒå•è¯åµŒå…¥æ—¶ï¼Œæ›´å¤šçš„è®­ç»ƒæ•°æ®å°†å¯¼è‡´æ›´å¥½çš„æ¨¡å‹ï¼å¦‚æœæ‚¨å‘ç°æ¨¡å‹æ— æ³•è¯†åˆ«è¾“å…¥ï¼Œè¯·å°è¯•ä½¿ç”¨æ›´å¤šä¾‹å¥è¿›è¡Œè®­ç»ƒã€‚</p></blockquote><h3 id="é¢„è®­ç»ƒè¯å‘é‡"><a href="#é¢„è®­ç»ƒè¯å‘é‡" class="headerlink" title="é¢„è®­ç»ƒè¯å‘é‡"></a>é¢„è®­ç»ƒè¯å‘é‡</h3><p>å¦‚æœå¯ä»¥ç”¨æ‚¨çš„è¯­è¨€æ‰¾åˆ°å®ƒä»¬ï¼Œåˆ™ç»è¿‡è®­ç»ƒçš„å•è¯å‘é‡æ˜¯ä»è¾ƒå°‘çš„æ•°æ®å…¥æ‰‹çš„å¥½æ–¹æ³•ï¼Œå› ä¸ºå•è¯å‘é‡æ˜¯æ ¹æ®å¤§é‡æ•°æ®ï¼ˆä¾‹å¦‚Wikipediaï¼‰è¿›è¡Œè®­ç»ƒçš„ã€‚</p><h4 id="spaCy"><a href="#spaCy" class="headerlink" title="spaCy"></a>spaCy</h4><p>é€šè¿‡<code>pretrained_embeddings_spacy</code> <a href="#">ç®¡é“</a>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨spaCyçš„ <a href="https://spacy.io/usage/models#languages">é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹</a>æˆ–åŠ è½½fastTextå‘é‡ï¼Œè¿™äº›å‘é‡å¯ç”¨äº<a href="https://github.com/facebookresearch/fastText/blob/master/docs/crawl-vectors.md">æ•°ç™¾ç§è¯­è¨€</a>ã€‚å¦‚æœæ‚¨æƒ³å°†æ‰¾åˆ°çš„è‡ªå®šä¹‰æ¨¡å‹åˆå¹¶åˆ°spaCyä¸­ï¼Œè¯·æŸ¥çœ‹å…¶æœ‰å…³<a href="https://spacy.io/docs/usage/adding-languages">æ·»åŠ è¯­è¨€</a>çš„é¡µé¢ ã€‚å¦‚æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œæ‚¨éœ€è¦æ³¨å†Œæ‚¨çš„è¯­è¨€æ¨¡å‹å¹¶å°†å…¶é“¾æ¥åˆ°è¯­è¨€æ ‡è¯†ç¬¦ï¼Œè¿™å°†å…è®¸Rasaé€šè¿‡ä¼ é€’è¯­è¨€æ ‡è¯†ç¬¦ä½œä¸º<code>language</code>é€‰é¡¹æ¥åŠ è½½å’Œä½¿ç”¨æ‚¨çš„æ–°è¯­è¨€ã€‚</p><h4 id="MITIE"><a href="#MITIE" class="headerlink" title="MITIE"></a>MITIE</h4><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<a href="#">MITIE</a>ä»è¯­è¨€è¯­æ–™åº“ä¸­é¢„å…ˆè®­ç»ƒè‡ªå·±çš„å•è¯å‘é‡ã€‚ä¸ºæ­¤ï¼š</p><ol><li>è·å¾—å¹²å‡€çš„è¯­è¨€è¯­æ–™åº“ï¼ˆWikipediaè½¬å‚¨æœ‰æ•ˆï¼‰ä½œä¸ºä¸€ç»„æ–‡æœ¬æ–‡ä»¶ã€‚</li><li>åœ¨è¯­æ–™åº“ä¸Šæ„å»ºå¹¶è¿è¡Œ<a href="#">MITIE Wordrepå·¥å…·</a>ã€‚è¿™å¯èƒ½éœ€è¦å‡ ä¸ªå°æ—¶/å¤©ï¼Œå…·ä½“å–å†³äºæ‚¨çš„æ•°æ®é›†å’Œå·¥ä½œç«™ã€‚æ‚¨éœ€è¦å¤§çº¦128GBçš„RAMæ‰èƒ½è¿è¡Œwordrep â€“æ˜¯çš„ï¼Œè¿™å¾ˆå¤šï¼šå°è¯•æ‰©å±•äº¤æ¢ã€‚</li><li>å°†newçš„è·¯å¾„è®¾ç½®<code>total_word_feature_extractor.dat</code>ä¸º<a href="#">é…ç½®ä¸­</a>çš„<code>model</code>å‚æ•° ã€‚</li></ol><p>æœ‰å…³å¦‚ä½•è®­ç»ƒMITIEå•è¯å‘é‡çš„å®Œæ•´ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹ <a href="#">æ­¤åšå®¢æ–‡ç« </a> ï¼Œ<a href="#">è¯¥æ–‡ç« </a>æ˜¯ä»ä¸­æ–‡ç»´åŸºç™¾ç§‘è½¬å‚¨ä¸­åˆ›å»ºMITIEæ¨¡å‹çš„ã€‚</p><h2 id="é€‰æ‹©ä¸€ä¸ªç®¡é“"><a href="#é€‰æ‹©ä¸€ä¸ªç®¡é“" class="headerlink" title="é€‰æ‹©ä¸€ä¸ªç®¡é“"></a>é€‰æ‹©ä¸€ä¸ªç®¡é“</h2><p>åœ¨Rasa Open Sourceä¸­ï¼Œä¼ å…¥æ¶ˆæ¯ç”±ä¸€ç³»åˆ—ç»„ä»¶å¤„ç†ã€‚è¿™äº›ç»„ä»¶å°†<code>pipeline</code>åœ¨yourä¸­å®šä¹‰çš„æ‰€è°“å¤„ç†ä¸­ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œ<code>config.yml</code>ã€‚é€‰æ‹©NLUç®¡é“å¯è®©æ‚¨è‡ªå®šä¹‰æ¨¡å‹å¹¶åœ¨æ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒã€‚</p><blockquote><p>æ³¨æ„</p><p>ä½¿ç”¨Rasa 1.8.0ï¼Œæˆ‘ä»¬æ›´æ–°äº†ä¸€äº›ç»„ä»¶ï¼Œå¹¶å¼ƒç”¨äº†æ‰€æœ‰ç°æœ‰ç®¡é“æ¨¡æ¿ã€‚ä½†æ˜¯ï¼Œ<strong>ä»»ä½•æ—§æœ¯è¯­ä»å°†è¡¨ç°å‡ºä¸ä»¥å‰ç›¸åŒçš„æ–¹å¼</strong>ï¼</p></blockquote><blockquote><p>è­¦å‘Š</p><p>æˆ‘ä»¬ä¸æ¨èä½¿ç”¨æ‰€æœ‰ç°æœ‰ç®¡é“æ¨¡æ¿ï¼ˆä¾‹å¦‚<code>supervised_embeddings</code>ï¼‰ã€‚è¯·åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºæ‚¨è¦ç›´æ¥ä½¿ç”¨çš„æ‰€æœ‰ç»„ä»¶ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="#">å¦‚ä½•</a>ä¸ºå»ºè®®çš„å¯åŠ¨é…ç½®<a href="#">é€‰æ‹©ç®¡é“</a>ï¼Œæˆ–å‚é˜… <a href="#">ç®¡é“æ¨¡æ¿ï¼ˆä¸</a>å»ºè®® <a href="#">ä½¿ç”¨ï¼‰</a>ã€‚</p></blockquote><h3 id="å¦‚ä½•é€‰æ‹©ä¸€ä¸ªç®¡é“"><a href="#å¦‚ä½•é€‰æ‹©ä¸€ä¸ªç®¡é“" class="headerlink" title="å¦‚ä½•é€‰æ‹©ä¸€ä¸ªç®¡é“"></a>å¦‚ä½•é€‰æ‹©ä¸€ä¸ªç®¡é“</h3><h4 id="ç®€çŸ­ç­”æ¡ˆ"><a href="#ç®€çŸ­ç­”æ¡ˆ" class="headerlink" title="ç®€çŸ­ç­”æ¡ˆ"></a>ç®€çŸ­ç­”æ¡ˆ</h4><p>å¦‚æœæ‚¨çš„åŸ¹è®­æ•°æ®æ˜¯è‹±æ–‡çš„ï¼Œé‚£ä¹ˆä¸‹é¢çš„ç®¡é“æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:  <span class="token list punctuation">-</span> name: ConveRTTokenizer  <span class="token list punctuation">-</span> name: ConveRTFeaturizer  <span class="token list punctuation">-</span> name: RegexFeaturizer  <span class="token list punctuation">-</span> name: LexicalSyntacticFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer<span class="token code keyword">    analyzer: "char_wb"</span><span class="token code keyword">    min_ngram: 1</span><span class="token code keyword">    max_ngram: 4</span>  <span class="token list punctuation">-</span> name: DIETClassifier<span class="token code keyword">    epochs: 100</span>  <span class="token list punctuation">-</span> name: EntitySynonymMapper  <span class="token list punctuation">-</span> name: ResponseSelector<span class="token code keyword">    epochs: 100</span></code></pre><p>å¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®ä¸æ˜¯è‹±è¯­ï¼Œè¯·ä»ä»¥ä¸‹ç®¡é“å¼€å§‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "fr"  # your two-letter language codepipeline:  <span class="token list punctuation">-</span> name: WhitespaceTokenizer  <span class="token list punctuation">-</span> name: RegexFeaturizer  <span class="token list punctuation">-</span> name: LexicalSyntacticFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer<span class="token code keyword">    analyzer: "char_wb"</span><span class="token code keyword">    min_ngram: 1</span><span class="token code keyword">    max_ngram: 4</span>  <span class="token list punctuation">-</span> name: DIETClassifier<span class="token code keyword">    epochs: 100</span>  <span class="token list punctuation">-</span> name: EntitySynonymMapper  <span class="token list punctuation">-</span> name: ResponseSelector<span class="token code keyword">    epochs: 100</span></code></pre><h4 id="æ›´é•¿å›ç­”"><a href="#æ›´é•¿å›ç­”" class="headerlink" title="æ›´é•¿å›ç­”"></a>æ›´é•¿å›ç­”</h4><p>å¦‚æœæ‚¨çš„åŸ¹è®­æ•°æ®æ˜¯è‹±è¯­ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä»¥ä¸‹ç®¡é“ï¼š</p><blockquote><pre><code>language: "en"pipeline:  - name: ConveRTTokenizer  - name: ConveRTFeaturizer  - name: RegexFeaturizer  - name: LexicalSyntacticFeaturizer  - name: CountVectorsFeaturizer  - name: CountVectorsFeaturizer    analyzer: "char_wb"    min_ngram: 1    max_ngram: 4  - name: DIETClassifier    epochs: 100  - name: EntitySynonymMapper  - name: ResponseSelector    epochs: 100</code></pre></blockquote><p>ç®¡é“åŒ…å«<a href="#">ConveRTFeaturizer</a>ï¼Œå®ƒæä¾›ç”¨æˆ·è¯è¯­çš„é¢„è®­ç»ƒè¯åµŒå…¥ã€‚é¢„å…ˆè®­ç»ƒçš„è¯åµŒå…¥éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å·²ç»ç¼–ç äº†æŸç§è¯­è¨€çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨è®­ç»ƒæ•°æ®ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼â€œæˆ‘æƒ³è´­ä¹°è‹¹æœâ€çš„å¥å­ï¼Œå¹¶ä¸”è¦æ±‚Rasaé¢„æµ‹â€œè·å–æ¢¨â€çš„æ„å›¾ï¼Œé‚£ä¹ˆæ‚¨çš„æ¨¡å‹å·²ç»çŸ¥é“â€œè‹¹æœâ€å’Œâ€œè±Œè±†â€æ˜¯éå¸¸ç›¸ä¼¼ã€‚å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„åŸ¹è®­æ•°æ®ï¼Œè¿™å°†ç‰¹åˆ«æœ‰ç”¨ã€‚<a href="#">ConveRTFeaturizer</a>çš„ä¼˜ç‚¹æ˜¯å®ƒä¸ä¼šå•ç‹¬å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„æ¯ä¸ªå•è¯ï¼Œè€Œæ˜¯ä¸ºæ•´ä¸ªå¥å­åˆ›å»ºä¸Šä¸‹æ–‡å‘é‡è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œ<code>ConveRT</code>ä»…æä¾›è‹±è¯­ã€‚</p><p>å¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®ä¸æ˜¯è‹±è¯­ï¼Œä½†æ‚¨ä»æƒ³ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„è¯åµŒå…¥ï¼Œåˆ™å»ºè®®ä½¿ç”¨ä»¥ä¸‹ç®¡é“ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "fr"  # your two-letter language codepipeline:  <span class="token list punctuation">-</span> name: SpacyNLP  <span class="token list punctuation">-</span> name: SpacyTokenizer  <span class="token list punctuation">-</span> name: SpacyFeaturizer  <span class="token list punctuation">-</span> name: RegexFeaturizer  <span class="token list punctuation">-</span> name: LexicalSyntacticFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer<span class="token code keyword">    analyzer: "char_wb"</span><span class="token code keyword">    min_ngram: 1</span><span class="token code keyword">    max_ngram: 4</span>  <span class="token list punctuation">-</span> name: DIETClassifier<span class="token code keyword">    epochs: 100</span>  <span class="token list punctuation">-</span> name: EntitySynonymMapper  <span class="token list punctuation">-</span> name: ResponseSelector<span class="token code keyword">    epochs: 100</span></code></pre><p>å®ƒä½¿ç”¨<a href="#">SpacyFeaturizer</a>è€Œä¸æ˜¯<a href="#">ConveRTFeaturizer</a>ã€‚ <a href="#">SpacyFeaturizer</a>ä»¥å¤šç§ä¸åŒçš„è¯­è¨€æä¾›æ¥è‡ªGloVeæˆ–fastTextçš„é¢„è®­ç»ƒè¯åµŒå…¥ï¼ˆè¯·å‚é˜…<a href="#">é¢„è®­ç»ƒè¯å‘é‡</a>ï¼‰ã€‚</p><p>å¦‚æœæ‚¨åœ¨ç®¡é“ä¸­æœªä½¿ç”¨ä»»ä½•é¢„è®­ç»ƒçš„å•è¯åµŒå…¥ï¼Œåˆ™æ— éœ€ç»‘å®šåˆ°ç‰¹å®šè¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥å°†æ¨¡å‹è®­ç»ƒä¸ºæ›´ç‰¹å®šäºé¢†åŸŸã€‚å¦‚æœæ‚¨çš„è¯­è¨€æ²¡æœ‰å•è¯åµŒå…¥ï¼Œæˆ–è€…æ‚¨å…·æœ‰éå¸¸ç‰¹å®šäºåŸŸçš„æœ¯è¯­ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä»¥ä¸‹ç®¡é“ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "fr"  # your two-letter language codepipeline:  <span class="token list punctuation">-</span> name: WhitespaceTokenizer  <span class="token list punctuation">-</span> name: RegexFeaturizer  <span class="token list punctuation">-</span> name: LexicalSyntacticFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer<span class="token code keyword">    analyzer: "char_wb"</span><span class="token code keyword">    min_ngram: 1</span><span class="token code keyword">    max_ngram: 4</span>  <span class="token list punctuation">-</span> name: DIETClassifier<span class="token code keyword">    epochs: 100</span>  <span class="token list punctuation">-</span> name: EntitySynonymMapper  <span class="token list punctuation">-</span> name: ResponseSelector<span class="token code keyword">    epochs: 100</span></code></pre><blockquote><p>æ³¨æ„</p><p>æˆ‘ä»¬é¼“åŠ±æ¯ä¸ªäººé€šè¿‡åˆ—å‡ºè¦ä½¿ç”¨çš„ç»„ä»¶çš„åç§°æ¥å®šä¹‰è‡ªå·±çš„ç®¡é“ã€‚æ‚¨å¯ä»¥åœ¨<a href="#">Componentsä¸­</a>æ‰¾åˆ°æ¯ä¸ªç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœè¦åœ¨ç®¡é“ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼Œè¯·å‚é˜…â€œ<a href="#">è‡ªå®šä¹‰NLUç»„ä»¶â€</a>ã€‚</p></blockquote><h3 id="é€‰æ‹©åˆé€‚çš„ç»„ä»¶"><a href="#é€‰æ‹©åˆé€‚çš„ç»„ä»¶" class="headerlink" title="é€‰æ‹©åˆé€‚çš„ç»„ä»¶"></a>é€‰æ‹©åˆé€‚çš„ç»„ä»¶</h3><p>æœ‰ç”¨äºå®ä½“æå–ï¼Œæ„å›¾åˆ†ç±»ï¼Œå“åº”é€‰æ‹©ï¼Œé¢„å¤„ç†ç­‰çš„ç»„ä»¶ã€‚æ‚¨å¯ä»¥åœ¨â€œ<a href="#">ç»„ä»¶â€</a>é¡µé¢ä¸Šäº†è§£æœ‰å…³ä»»ä½•ç‰¹å®šç»„ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚å¦‚æœè¦æ·»åŠ è‡ªå·±çš„ç»„ä»¶ï¼ˆä¾‹å¦‚è¿›è¡Œæ‹¼å†™æ£€æŸ¥æˆ–è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼‰ï¼Œè¯·ç­¾å‡ºâ€œ<a href="#">è‡ªå®šä¹‰NLUç»„ä»¶â€</a>ã€‚</p><p>ç®¡é“é€šå¸¸åŒ…å«ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p><ul><li><a href="#">Tokenization</a></li><li><a href="#">Featurization</a></li><li><a href="#">å®ä½“è¯†åˆ«/æ„å›¾åˆ†ç±»/å“åº”é€‰æ‹©å™¨</a></li></ul><h4 id="Tokenization"><a href="#Tokenization" class="headerlink" title="Tokenization"></a>Tokenization</h4><p>å¯¹äºè‹±è¯­è¾“å…¥çš„æ ‡è®°åŒ–ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨<a href="#">ConveRTTokenizer</a>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://legacy-docs-v1.rasa.com/nlu/components/#whitespacetokenizer">WhitespaceTokenizer</a>å¤„ç†å…¶ä»–ç”¨ç©ºæ ¼æ ‡è®°çš„ï¼ˆç”¨ç©ºæ ¼åˆ†éš”çš„å•è¯ï¼‰è¯­è¨€ã€‚å¦‚æœæ‚¨çš„è¯­è¨€ä¸æ˜¯ç”¨ç©ºæ ¼æ ‡è®°çš„ï¼Œåˆ™åº”ä½¿ç”¨å…¶ä»–æ ‡è®°å™¨ã€‚æˆ‘ä»¬æ”¯æŒè®¸å¤šä¸åŒçš„<a href="https://legacy-docs-v1.rasa.com/nlu/components/#tokenizers">ä»¤ç‰Œç”Ÿæˆå™¨</a>ï¼Œæˆ–è€…æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„<a href="https://legacy-docs-v1.rasa.com/api/custom-nlu-components/#custom-nlu-components">è‡ªå®šä¹‰ä»¤ç‰Œç”Ÿæˆå™¨</a>ã€‚</p><blockquote><p>æ³¨æ„</p><p>ç®¡é“ä¸‹æ¸¸çš„æŸäº›ç»„ä»¶å¯èƒ½éœ€è¦ç‰¹å®šçš„æ ‡è®°å™¨ã€‚æ‚¨å¯ä»¥åœ¨<a href="%EF%BC%83">Componentsä¸­</a>çš„å„ä¸ªç»„ä»¶ä¸Šæ‰¾åˆ°è¿™äº›è¦æ±‚ã€‚å¦‚æœç®¡é“å†…ç¼ºå°‘å¿…éœ€çš„ç»„ä»¶ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</p></blockquote><h4 id="Featurization"><a href="#Featurization" class="headerlink" title="Featurization"></a>Featurization</h4><p>æ‚¨éœ€è¦ç¡®å®šæ˜¯å¦ä½¿ç”¨æä¾›é¢„è®­ç»ƒå•è¯åµŒå…¥çš„ç»„ä»¶ã€‚æˆ‘ä»¬å»ºè®®åœ¨è®­ç»ƒæ•°æ®é‡è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä»é¢„å…ˆè®­ç»ƒçš„è¯åµŒå…¥å…¥æ‰‹ã€‚ä¸€æ—¦æ‹¥æœ‰å¤§é‡æ•°æ®å¹¶ç¡®ä¿æœ€ç›¸å…³çš„è¯å°†å‡ºç°åœ¨æ•°æ®ä¸­ï¼Œå› æ­¤å°†æœ‰è¯åµŒå…¥ï¼Œç›‘ç£åµŒå…¥ï¼Œè¿™äº›åµŒå…¥å¯ç›´æ¥ä»è®­ç»ƒæ•°æ®ä¸­å­¦ä¹ è¯ä¹‰ï¼Œä»è€Œä½¿æ‚¨çš„æ¨¡å‹å¯¹æ‚¨çš„é¢†åŸŸæ›´åŠ å…·ä½“ã€‚å¦‚æœæ‰¾ä¸åˆ°é€‚åˆæ‚¨è¯­è¨€çš„é¢„å…ˆè®­ç»ƒæ¨¡å‹ï¼Œåˆ™åº”ä½¿ç”¨ç›‘ç£æ€§åµŒå…¥ã€‚</p><h5 id="é¢„å…ˆè®­ç»ƒçš„æ›²é¢åµŒå…¥"><a href="#é¢„å…ˆè®­ç»ƒçš„æ›²é¢åµŒå…¥" class="headerlink" title="é¢„å…ˆè®­ç»ƒçš„æ›²é¢åµŒå…¥"></a>é¢„å…ˆè®­ç»ƒçš„æ›²é¢åµŒå…¥</h5><p>åœ¨ç®¡é“ä¸­ä½¿ç”¨ç»è¿‡é¢„å…ˆè®­ç»ƒçš„å•è¯åµŒå…¥çš„ä¼˜åŠ¿åœ¨äºï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªè®­ç»ƒç¤ºä¾‹ï¼Œä¾‹å¦‚ï¼šâ€œæˆ‘æƒ³ä¹°è‹¹æœâ€ï¼Œå¹¶ä¸”è¦æ±‚Rasaé¢„æµ‹â€œä¹°æ¢¨â€çš„æ„å›¾ï¼Œé‚£ä¹ˆæ‚¨çš„æ¨¡å‹å·²ç»çŸ¥é“â€œè‹¹æœâ€å’Œâ€œè±Œè±†â€è¿™ä¸¤ä¸ªè¯éå¸¸ç›¸ä¼¼ã€‚å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„åŸ¹è®­æ•°æ®ï¼Œè¿™å°†ç‰¹åˆ«æœ‰ç”¨ã€‚æˆ‘ä»¬æ”¯æŒæä¾›é¢„è®­ç»ƒè¯åµŒå…¥çš„ä¸€äº›ç»„ä»¶ï¼š</p><ol><li><a href="#">MitieFeaturizer</a></li><li><a href="#">SpacyFeaturizer</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/components/#convertfeaturizer">ConveRTFeaturizer</a></li><li><a href="https://legacy-docs-v1.rasa.com/nlu/components/#languagemodelfeaturizer">LanguageModelFeaturizer</a></li></ol><p>å¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®æ˜¯è‹±è¯­ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨<a href="#">ConveRTFeaturizer</a>ã€‚<a href="#">ConveRTFeaturizer</a>çš„ä¼˜ç‚¹æ˜¯å®ƒä¸ä¼šå•ç‹¬å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„æ¯ä¸ªå•è¯ï¼Œè€Œæ˜¯ä¸ºæ•´ä¸ªå¥å­åˆ›å»ºä¸Šä¸‹æ–‡å‘é‡è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªåŸ¹è®­ç¤ºä¾‹ï¼Œä¾‹å¦‚ï¼šâ€œæˆ‘å¯ä»¥é¢„è®¢æ±½è½¦å—ï¼Ÿâ€ï¼Œå¹¶ä¸”Rasaè¢«è¦æ±‚é¢„æµ‹â€œæˆ‘éœ€è¦ä»æˆ‘å®¶ä¹˜è½¦â€çš„æ„å›¾ï¼Œå› ä¸ºä¸¤ä¸ªç¤ºä¾‹çš„ä¸Šä¸‹æ–‡çŸ¢é‡è¡¨ç¤ºå·²ç»éå¸¸ç›¸ä¼¼ï¼Œä¸¤è€…çš„åˆ†ç±»æ„å›¾å¾ˆæœ‰å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ï¼Œè¿™ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p><p><a href="#">ConveRTFeaturizer</a>çš„æ›¿ä»£<a href="#">æ–¹æ³•</a>æ˜¯<a href="#">LanguageModelFeaturizer</a>ï¼Œå®ƒä½¿ç”¨è¯¸å¦‚BERTï¼ŒGPT-2ç­‰çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹æ¥æå–å®Œæ•´å¥å­çš„ç›¸ä¼¼ä¸Šä¸‹æ–‡å‘é‡è¡¨ç¤ºå½¢å¼ã€‚æœ‰å…³æ”¯æŒçš„è¯­è¨€æ¨¡å‹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§ <a href="#">HFTransformersNLP</a>ã€‚</p><p>å¦‚æœæ‚¨çš„è®­ç»ƒæ•°æ®ä¸æ˜¯è‹±è¯­ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§è¯­è¨€æ¨¡å‹å˜ä½“ï¼Œè¯¥å˜ä½“å·²ç»ä»¥ç‰¹å®šäºæ‚¨è®­ç»ƒæ•°æ®çš„è¯­è¨€è¿›è¡Œäº†é¢„è®­ç»ƒã€‚ä¾‹å¦‚ï¼ŒBERTæ¨¡å‹æœ‰ä¸­æ–‡ï¼ˆ<code>bert-base-chinese</code>ï¼‰å’Œæ—¥è¯­ï¼ˆ<code>bert-base-japanese</code>ï¼‰å˜ä½“ã€‚å¯ä»¥åœ¨<a href="https://huggingface.co/transformers/pretrained_models.html">Transformersåº“</a>çš„<a href="https://huggingface.co/transformers/pretrained_models.html">å®˜æ–¹æ–‡æ¡£ä¸­</a>æ‰¾åˆ°è¿™äº›è¯­è¨€æ¨¡å‹çš„ä¸åŒå˜ä½“çš„å®Œæ•´åˆ—è¡¨ ã€‚</p><p><a href="#">SpacyFeaturizer</a>è¿˜æä¾›äº†è®¸å¤šä¸åŒè¯­è¨€çš„è¯åµŒå…¥ï¼ˆè¯·å‚é˜…<a href="#">é¢„å…ˆè®­ç»ƒçš„è¯å‘é‡</a>ï¼‰ï¼Œå› æ­¤æ‚¨å¯ä»¥æ ¹æ®è®­ç»ƒæ•°æ®çš„è¯­è¨€å°†å…¶ç”¨ä½œå¦ä¸€ç§é€‰æ‹©ã€‚</p><h5 id="ç›‘ç£æ›²é¢åµŒå…¥"><a href="#ç›‘ç£æ›²é¢åµŒå…¥" class="headerlink" title="ç›‘ç£æ›²é¢åµŒå…¥"></a>ç›‘ç£æ›²é¢åµŒå…¥</h5><p>å¦‚æœæ‚¨åœ¨ç®¡é“ä¸­æœªä½¿ç”¨ä»»ä½•é¢„è®­ç»ƒçš„å•è¯åµŒå…¥ï¼Œåˆ™æ— éœ€ç»‘å®šåˆ°ç‰¹å®šè¯­è¨€ï¼Œå¹¶ä¸”å¯ä»¥å°†æ¨¡å‹è®­ç»ƒä¸ºæ›´ç‰¹å®šäºé¢†åŸŸã€‚ä¾‹å¦‚ï¼Œåœ¨é€šç”¨è‹±è¯­ä¸­ï¼Œâ€œå¹³è¡¡â€ä¸€è¯ä¸â€œå¯¹ç§°æ€§â€ç´§å¯†ç›¸å…³ï¼Œä½†ä¸â€œç°é‡‘â€ä¸€è¯æœ‰å¾ˆå¤§ä¸åŒã€‚åœ¨é“¶è¡Œé¢†åŸŸä¸­ï¼Œâ€œä½™é¢â€å’Œâ€œç°é‡‘â€å¯†åˆ‡ç›¸å…³ï¼Œæ‚¨å¸Œæœ›æ¨¡å‹èƒ½å¤ŸæŠ“ä½è¿™ä¸€ç‚¹ã€‚å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨é¢„è®­ç»ƒçš„å•è¯åµŒå…¥ï¼Œåˆ™ä»…åº”ä½¿ç”¨<a href="#">ç¨€ç–åŠŸèƒ½åŒ–å™¨</a>ç±»åˆ«ä¸­çš„<a href="#">åŠŸèƒ½åŒ–å™¨</a>ï¼Œä¾‹å¦‚ <a href="#">CountVectorsFeaturizer</a>ï¼Œ<a href="#">RegexFeaturizer</a>æˆ–<a href="#">LexicalSyntacticFeaturizer</a>ã€‚</p><h4 id="å®ä½“è¯†åˆ«-æ„å›¾åˆ†ç±»-å“åº”é€‰æ‹©å™¨"><a href="#å®ä½“è¯†åˆ«-æ„å›¾åˆ†ç±»-å“åº”é€‰æ‹©å™¨" class="headerlink" title="å®ä½“è¯†åˆ«/æ„å›¾åˆ†ç±»/å“åº”é€‰æ‹©å™¨"></a>å®ä½“è¯†åˆ«/æ„å›¾åˆ†ç±»/å“åº”é€‰æ‹©å™¨</h4><p>æ ¹æ®æ‚¨çš„æ•°æ®ï¼Œæ‚¨å¯èƒ½åªå¸Œæœ›æ‰§è¡Œæ„å›¾åˆ†ç±»ï¼Œå®ä½“è¯†åˆ«æˆ–å“åº”é€‰æ‹©ã€‚æˆ–è€…ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åˆå¹¶å¤šä¸ªè¿™äº›ä»»åŠ¡ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªä»»åŠ¡æ”¯æŒå¤šä¸ªç»„ä»¶ã€‚æ‰€æœ‰è¿™äº›éƒ½åœ¨<a href="#">Components</a>ä¸­åˆ—å‡ºã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨<a href="#">DIETClassifier</a>è¿›è¡Œæ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«ï¼Œå¹¶ä½¿ç”¨<a href="#">ResponseSelector</a>è¿›è¡Œå“åº”é€‰æ‹©ã€‚</p><h3 id="å¤šæ„å›¾åˆ†ç±»"><a href="#å¤šæ„å›¾åˆ†ç±»" class="headerlink" title="å¤šæ„å›¾åˆ†ç±»"></a>å¤šæ„å›¾åˆ†ç±»</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨Rasaå¼€æºç»„ä»¶å°†æ„å›¾æ‹†åˆ†ä¸ºå¤šä¸ªæ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é¢„æµ‹å¤šä¸ª<code>thank+goodbye</code>Intent ï¼ˆï¼‰æˆ–æ¨¡å‹åˆ†å±‚Intentç»“æ„ï¼ˆ<code>feedback+positive</code>ä¸<code>feedback+negative</code>ç›¸æ¯”æ›´ç›¸ä¼¼<code>chitchat</code>ï¼‰ã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨ç®¡é“ä¸­ä½¿ç”¨<a href="#">DIETClassifier</a>ã€‚æ‚¨è¿˜éœ€è¦åœ¨ä½¿ç”¨çš„ä»»ä½•æ ‡è®°ç¨‹åºä¸­å®šä¹‰è¿™äº›æ ‡å¿—ï¼š</p><blockquote><ul><li><code>intent_tokenization_flag</code>ï¼šå°†å…¶è®¾ç½®ä¸º<code>True</code>ï¼Œä»¥ä¾¿æ ‡è®°æ„å›¾æ ‡ç­¾ã€‚</li><li><code>intent_split_symbol</code>ï¼šå°†å…¶è®¾ç½®ä¸ºåˆ†éš”æ„å›¾æ ‡ç­¾çš„å®šç•Œç¬¦å­—ç¬¦ä¸²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹<code>+</code>ï¼Œé»˜è®¤è®¾ç½®<code>_</code>ã€‚</li></ul></blockquote><p>é˜…è¯» æœ‰å…³å¦‚ä½•åœ¨Rasaä¸­ä½¿ç”¨å¤šä¸ªæ„å›¾çš„<a href="#">æ•™ç¨‹</a>ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š</p><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"  intent<span class="token italic"><span class="token punctuation">_</span>tokenization<span class="token punctuation">_</span></span>flag: True  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"<span class="token list punctuation">-</span> name: "DIETClassifier"</code></pre><h3 id="æ¯”è¾ƒç®¡é“"><a href="#æ¯”è¾ƒç®¡é“" class="headerlink" title="æ¯”è¾ƒç®¡é“"></a>æ¯”è¾ƒç®¡é“</h3><p>Rasaä¸ºæ‚¨æä¾›äº†ç›´æ¥æ¯”è¾ƒæ•°æ®ä¸Šå¤šä¸ªç®¡é“æ€§èƒ½çš„å·¥å…·ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">æ¯”è¾ƒNLUç®¡é“</a>ã€‚</p><blockquote><p>æ³¨æ„</p><p>æ„å›¾åˆ†ç±»ä¸å®ä½“æå–æ— å…³ã€‚å› æ­¤ï¼Œæœ‰æ—¶NLUä¼šè·å¾—æ­£ç¡®çš„æ„å›¾ï¼Œä½†å®ä½“ä¼šå‡ºé”™ï¼Œåä¹‹äº¦ç„¶ã€‚æ‚¨éœ€è¦ä¸ºæ„å›¾å’Œå®ä½“æä¾›è¶³å¤Ÿçš„æ•°æ®</p></blockquote><h3 id="å¤„ç†ç±»ä¸å¹³è¡¡"><a href="#å¤„ç†ç±»ä¸å¹³è¡¡" class="headerlink" title="å¤„ç†ç±»ä¸å¹³è¡¡"></a>å¤„ç†ç±»ä¸å¹³è¡¡</h3><p>å¦‚æœç±»åˆ«å¤±è¡¡å¾ˆå¤§ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰å¾ˆå¤šé’ˆå¯¹æŸäº›æ„å›¾çš„è®­ç»ƒæ•°æ®è€Œå¾ˆå°‘æœ‰é’ˆå¯¹å…¶ä»–æ„å›¾çš„è®­ç»ƒæ•°æ®ï¼Œåˆ™åˆ†ç±»ç®—æ³•é€šå¸¸ä¸ä¼šè¡¨ç°è‰¯å¥½ã€‚è¦ç¼“è§£æ­¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨<code>balanced</code>æ‰¹å¤„ç†ç­–ç•¥ã€‚è¯¥ç®—æ³•ç¡®ä¿åœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­æˆ–è‡³å°‘åœ¨å°½å¯èƒ½å¤šçš„åç»­æ‰¹æ¬¡ä¸­ä»£è¡¨æ‰€æœ‰ç±»åˆ«ï¼Œä»ç„¶æ¨¡ä»¿æŸäº›ç±»åˆ«æ¯”å…¶ä»–ç±»åˆ«æ›´é¢‘ç¹çš„äº‹å®ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨å¹³è¡¡æ‰¹å¤„ç†ã€‚ä¸ºäº†å°†å…¶å…³é—­å¹¶ä½¿ç”¨ç»å…¸çš„æ‰¹å¤„ç†ç­–ç•¥ï¼Œè¯·åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¯¥ç­–ç•¥ ã€‚<code>batch_strategy: sequence</code></p><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline:<span class="token title important"><span class="token punctuation">#</span> - ... other components</span><span class="token list punctuation">-</span> name: "DIETClassifier"  batch_strategy: sequence</code></pre><h3 id="ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</h3><p>æ¯ä¸ªç»„ä»¶å¤„ç†è¾“å…¥å’Œ/æˆ–åˆ›å»ºè¾“å‡ºã€‚ç»„ä»¶çš„é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä¸­åˆ—å‡ºçš„é¡ºåº<code>config.yml</code>ï¼›ç»„ä»¶çš„è¾“å‡ºå¯ç”±ç®¡é“ä¸­ç´§éšå…¶åçš„ä»»ä½•å…¶ä»–ç»„ä»¶ä½¿ç”¨ã€‚æŸäº›ç»„ä»¶ä»…ç”Ÿæˆç®¡é“ä¸­å…¶ä»–ç»„ä»¶ä½¿ç”¨çš„ä¿¡æ¯ã€‚å…¶ä»–ç»„ä»¶äº§ç”Ÿçš„<code>output</code>å±æ€§å°†åœ¨å¤„ç†å®Œæˆåè¿”å›ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯¹äºå¥å­ï¼Œè¾“å‡ºä¸ºï¼š<code>"I am looking for Chinese food"</code></p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"I am looking for Chinese food"</span><span class="token punctuation">,</span>    <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"chinese"</span><span class="token punctuation">,</span>            <span class="token property">"entity"</span><span class="token operator">:</span> <span class="token string">"cuisine"</span><span class="token punctuation">,</span>            <span class="token property">"extractor"</span><span class="token operator">:</span> <span class="token string">"DIETClassifier"</span><span class="token punctuation">,</span>            <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.864</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"restaurant_search"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>    <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"restaurant_search"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.1416153159565678</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"affirm"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>è¿™æ˜¯åœ¨ä»¥ä¸‹ç®¡é“ä¸­ä¸åŒç»„ä»¶çš„ç»“æœçš„ç»„åˆä¸­åˆ›å»ºçš„ï¼š</p><pre class=" language-markdown"><code class="language-markdown">pipeline:  <span class="token list punctuation">-</span> name: WhitespaceTokenizer  <span class="token list punctuation">-</span> name: RegexFeaturizer  <span class="token list punctuation">-</span> name: LexicalSyntacticFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer  <span class="token list punctuation">-</span> name: CountVectorsFeaturizer<span class="token code keyword">    analyzer: "char_wb"</span><span class="token code keyword">    min_ngram: 1</span><span class="token code keyword">    max_ngram: 4</span>  <span class="token list punctuation">-</span> name: DIETClassifier  <span class="token list punctuation">-</span> name: EntitySynonymMapper  <span class="token list punctuation">-</span> name: ResponseSelector</code></pre><p>ä¾‹å¦‚ï¼Œ<code>entities</code>æ­¤å¤„çš„å±æ€§æ˜¯ç”±<code>DIETClassifier</code>ç»„ä»¶åˆ›å»ºçš„ã€‚</p><p>æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥å®ç°<code>Component</code>åŸºç±»ä¸­çš„å‡ ç§æ–¹æ³•ã€‚åœ¨ç®¡é“ä¸­ï¼Œå°†æŒ‰ç‰¹å®šé¡ºåºè°ƒç”¨è¿™äº›ä¸åŒçš„æ–¹æ³•ã€‚å‡è®¾æˆ‘ä»¬å°†ä»¥ä¸‹ç®¡é“æ·»åŠ åˆ°æˆ‘ä»¬çš„<code>config.yml</code>ï¼š</p><pre class=" language-markdown"><code class="language-markdown">pipeline:  <span class="token list punctuation">-</span> name: "Component A"  <span class="token list punctuation">-</span> name: "Component B"  <span class="token list punctuation">-</span> name: "Last Component"</code></pre><p>ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨è®­ç»ƒè¯¥ç®¡é“æœŸé—´çš„å‘¼å«é¡ºåºï¼š</p><img src="/2020/10/04/rasa-wen-dang-zhi-nan-11/9.png" style="zoom:50%;"><p>åœ¨ä½¿ç”¨è¯¥<code>create</code>å‡½æ•°åˆ›å»ºç¬¬ä¸€ä¸ªç»„ä»¶ä¹‹å‰ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰€è°“<code>context</code>çš„ï¼ˆä»…æ˜¯python dictï¼‰ã€‚æ­¤ä¸Šä¸‹æ–‡ç”¨äºåœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥è®¡ç®—è®­ç»ƒæ•°æ®çš„ç‰¹å¾å‘é‡ï¼Œå°†å…¶å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè€Œå¦ä¸€ä¸ªç»„ä»¶å¯ä»¥ä»ä¸Šä¸‹æ–‡ä¸­æ£€ç´¢è¿™äº›ç‰¹å¾å‘é‡å¹¶è¿›è¡Œæ„å›¾åˆ†ç±»ã€‚</p><p>æœ€åˆï¼Œä¸Šä¸‹æ–‡ä½¿ç”¨æ‰€æœ‰é…ç½®å€¼å¡«å……ã€‚å›¾åƒä¸­çš„ç®­å¤´æ˜¾ç¤ºäº†å‘¼å«é¡ºåºï¼Œå¹¶å¯è§†åŒ–äº†æ‰€ä¼ é€’ä¸Šä¸‹æ–‡çš„è·¯å¾„ã€‚åœ¨å¯¹æ‰€æœ‰ç»„ä»¶è¿›è¡Œäº†è®­ç»ƒå’ŒæŒä¹…åŒ–ä¹‹åï¼Œæœ€ç»ˆçš„ä¸Šä¸‹æ–‡å­—å…¸ç”¨äºæŒä¹…åŒ–æ¨¡å‹çš„å…ƒæ•°æ®ã€‚</p><h3 id="ç®¡é“æ¨¡æ¿ï¼ˆå·²å¼ƒç”¨ï¼‰"><a href="#ç®¡é“æ¨¡æ¿ï¼ˆå·²å¼ƒç”¨ï¼‰" class="headerlink" title="ç®¡é“æ¨¡æ¿ï¼ˆå·²å¼ƒç”¨ï¼‰"></a>ç®¡é“æ¨¡æ¿ï¼ˆå·²å¼ƒç”¨ï¼‰</h3><p>æ¨¡æ¿åªæ˜¯å®Œæ•´ç»„ä»¶åˆ—è¡¨çš„å¿«æ·æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæ­¤ç®¡é“æ¨¡æ¿ï¼š</p><blockquote><pre class=" language-markdown"><code class="language-markdown">language: "en"pipeline: "pretrained<span class="token italic"><span class="token punctuation">_</span>embeddings<span class="token punctuation">_</span></span>spacy"</code></pre></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(10)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-10/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-10/</url>
      
        <content type="html"><![CDATA[<h1 id="äº‘å­˜å‚¨"><a href="#äº‘å­˜å‚¨" class="headerlink" title="äº‘å­˜å‚¨"></a>äº‘å­˜å‚¨</h1><p>Rasaæ”¯æŒä½¿ç”¨<a href="https://aws.amazon.com/s3/">S3</a>ï¼Œ <a href="https://cloud.google.com/storage/">GCS</a>å’Œ<a href="https://azure.microsoft.com/services/storage/">Azureå­˜å‚¨</a>æ¥ä¿å­˜æ¨¡å‹ã€‚</p><ul><li><p>Amazon S3å­˜å‚¨</p><blockquote><p><code>boto3</code>æ‚¨å¯ä»¥é€šè¿‡å®‰è£…çš„æ¨¡å—æ¥æ”¯æŒS3 ã€‚<code>pip install boto3</code></p><p>å°†RasaæœåŠ¡å™¨çš„<code>remote-storage</code>é€‰é¡¹è®¾ç½®ä¸º <code>aws</code>ã€‚è·å–æ‚¨çš„S3å‡­æ®å¹¶è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><ul><li><code>AWS_SECRET_ACCESS_KEY</code></li><li><code>AWS_ACCESS_KEY_ID</code></li><li><code>AWS_DEFAULT_REGION</code></li><li><code>BUCKET_NAME</code></li><li><code>AWS_ENDPOINT_URL</code></li></ul><p>å¦‚æœæ²¡æœ‰åç§°ä¸ºçš„å­˜å‚¨æ¡¶<code>BUCKET_NAME</code>ï¼ŒRasaå°†åˆ›å»ºå®ƒã€‚</p></blockquote></li><li><p>è°·æ­Œäº‘å­˜å‚¨</p><blockquote><p>ä½¿ç”¨è¯¥<code>google-cloud-storage</code>è½¯ä»¶åŒ…æ”¯æŒGCS ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ã€‚<code>pip install google-cloud-storage</code></p><p>å°†RasaæœåŠ¡å™¨çš„<code>remote-storage</code>é€‰é¡¹è®¾ç½®ä¸º<code>gcs</code>ã€‚</p><p>åœ¨Google App Engineå’Œè®¡ç®—å¼•æ“ä¸Šè¿è¡Œæ—¶ï¼Œå·²ç»è®¾ç½®äº†èº«ä»½éªŒè¯å‡­æ®ã€‚è¦åœ¨æœ¬åœ°æˆ–å…¶ä»–åœ°æ–¹è¿è¡Œï¼Œè¯·ç­¾å‡ºå…¶ <a href="https://github.com/GoogleCloudPlatform/python-docs-samples/tree/master/storage/cloud-client#authentication">å®¢æˆ·ç«¯å­˜å‚¨åº“</a> ä»¥è·å–æœ‰å…³è®¾ç½®èº«ä»½éªŒè¯çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒæ¶‰åŠä»Google Cloud Consoleåˆ›å»ºæœåŠ¡å¸æˆ·å¯†é’¥æ–‡ä»¶ï¼Œå¹¶å°†<code>GOOGLE_APPLICATION_CREDENTIALS</code>ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºè¯¥å¯†é’¥æ–‡ä»¶çš„è·¯å¾„ã€‚</p></blockquote></li><li><p>Azureå­˜å‚¨</p><blockquote><p>ä½¿ç”¨è¯¥<code>azure-storage-blob</code>è½¯ä»¶åŒ…æ”¯æŒAzure ï¼Œå¯ä»¥ä½¿ç”¨è¿›è¡Œå®‰è£…ã€‚<code>pip install azure-storage-blob</code></p><p>å°†RasaæœåŠ¡å™¨çš„<code>remote-storage</code>é€‰é¡¹è®¾ç½®ä¸º<code>azure</code>ã€‚</p><p>å¿…é¡»è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p><ul><li><code>AZURE_CONTAINER</code></li><li><code>AZURE_ACCOUNT_NAME</code></li><li><code>AZURE_ACCOUNT_KEY</code></li></ul><p>å¦‚æœæ²¡æœ‰åç§°ä¸ºçš„å®¹å™¨<code>AZURE_CONTAINER</code>ï¼ŒRasaå°†åˆ›å»ºå®ƒã€‚</p></blockquote></li></ul><p>å°†æ¨¡å‹å‹ç¼©åå†ä¿å­˜åˆ°äº‘ä¸­ã€‚å‹ç¼©æ–‡ä»¶çš„å‘½åçº¦å®šä¸º<code>{MODEL_NAME}.tar.gz</code>ï¼Œå®ƒå­˜å‚¨åœ¨å­˜å‚¨æœåŠ¡çš„æ ¹æ–‡ä»¶å¤¹ä¸­ã€‚å½“å‰ï¼Œæ‚¨æ— æ³•æ‰‹åŠ¨æŒ‡å®šäº‘å­˜å‚¨ä¸Šçš„è·¯å¾„ã€‚</p><p>å¦‚æœå­˜å‚¨å—è¿‡è®­ç»ƒçš„æ¨¡å‹ï¼ŒRasaå°†gzipæ–°æ¨¡å‹å¹¶å°†å…¶ä¸Šä¼ åˆ°å®¹å™¨ä¸­ã€‚å¦‚æœè¦ä»äº‘å­˜å‚¨ä¸­æ£€ç´¢/åŠ è½½æ¨¡å‹ï¼ŒRasaå°†åœ¨æœ¬åœ°ä¸‹è½½å‹ç¼©çš„æ¨¡å‹å¹¶å°†å†…å®¹æå–åˆ°ä¸´æ—¶ç›®å½•ä¸­ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(9)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-9/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-9/</url>
      
        <content type="html"><![CDATA[<h1 id="éƒ¨ç½²RasaåŠ©æ‰‹"><a href="#éƒ¨ç½²RasaåŠ©æ‰‹" class="headerlink" title="éƒ¨ç½²RasaåŠ©æ‰‹"></a>éƒ¨ç½²RasaåŠ©æ‰‹</h1><p>æœ¬é¡µè¯´æ˜ä½•æ—¶ä»¥åŠå¦‚ä½•éƒ¨ç½²ä½¿ç”¨Rasaæ„å»ºçš„åŠ©æ‰‹ã€‚å®ƒå°†ä½¿æ‚¨çš„åŠ©æ‰‹å¯ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶ä¸ºæ‚¨å‡†å¤‡å¥½ç”Ÿäº§ç¯å¢ƒã€‚</p><ul><li><a href="#">ä½•æ—¶éƒ¨ç½²åŠ©æ‰‹</a></li><li><a href="#">æ¨èçš„éƒ¨ç½²æ–¹æ³•</a><ul><li><a href="#">æœåŠ¡å™¨å¿«é€Ÿå®‰è£…</a></li><li><a href="h#">èˆµå›¾</a></li></ul></li><li><a href="#">æ›¿ä»£éƒ¨ç½²æ–¹æ³•</a><ul><li><a href="#">Dockeræ’°å†™</a></li><li><a href="#">Rasaä»…é™å¼€æºéƒ¨ç½²</a></li></ul></li><li><a href="#">éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨</a><ul><li><a href="#">æ„å»ºåŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ</a></li><li><a href="#">ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ</a></li></ul></li></ul><h2 id="ä½•æ—¶éƒ¨ç½²æ‚¨çš„åŠ©æ‰‹"><a href="#ä½•æ—¶éƒ¨ç½²æ‚¨çš„åŠ©æ‰‹" class="headerlink" title="ä½•æ—¶éƒ¨ç½²æ‚¨çš„åŠ©æ‰‹"></a>ä½•æ—¶éƒ¨ç½²æ‚¨çš„åŠ©æ‰‹</h2><p>éƒ¨ç½²åŠ©æ‰‹å¹¶ä½¿ä¹‹å¯ä¾›æµ‹è¯•ç”¨æˆ·ä½¿ç”¨çš„æœ€ä½³æ—¶é—´æ˜¯å¯ä»¥å¤„ç†æœ€é‡è¦çš„å¿«ä¹è·¯å¾„ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬æ‰€è°“çš„<a href="https://rasa.com/docs/rasa/glossary">æœ€ä½å¯è¡ŒåŠ©æ‰‹</a>ã€‚</p><p>é€šè¿‡ä»¥ä¸‹æ¨èçš„éƒ¨ç½²æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<a href="https://rasa.com/docs/rasa-x/user-guide/share-assistant/#share-your-bot">Rasa Xä¸­</a>çš„<a href="https://rasa.com/docs/rasa-x/user-guide/share-assistant/#share-your-bot">å…±äº«åŠ©æ‰‹åŠŸèƒ½</a>è½»æ¾åœ°ä¸æµ‹è¯•ç”¨æˆ·<a href="https://rasa.com/docs/rasa-x/user-guide/share-assistant/#share-your-bot">å…±äº«åŠ©æ‰‹</a>ã€‚ç„¶åï¼Œå½“æ‚¨å‡†å¤‡é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ª<a href="https://legacy-docs-v1.rasa.com/user-guide/messaging-and-voice-channels/#messaging-and-voice-channels">æ¶ˆæ¯å’Œè¯­éŸ³é€šé“</a>ä½¿æ‚¨çš„åŠ©æ‰‹å¯ç”¨æ—¶ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å°†å®ƒä»¬æ·»åŠ åˆ°ç°æœ‰çš„éƒ¨ç½²è®¾ç½®ä¸­ã€‚</p><h2 id="æ¨èéƒ¨ç½²æ–¹æ³•"><a href="#æ¨èéƒ¨ç½²æ–¹æ³•" class="headerlink" title="æ¨èéƒ¨ç½²æ–¹æ³•"></a>æ¨èéƒ¨ç½²æ–¹æ³•</h2><p>å»ºè®®çš„éƒ¨ç½²åŠ©æ‰‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨æˆ‘ä»¬æ”¯æŒçš„â€œæœåŠ¡å™¨å¿«é€Ÿå®‰è£…â€æˆ–â€œå¤´ç›”å›¾è¡¨â€é€‰é¡¹ã€‚ä¸¤è€…éƒ½éƒ¨ç½²Rasa Xå’Œæ‚¨çš„åŠ©æ‰‹ã€‚å®ƒä»¬æ˜¯éƒ¨ç½²åŠ©æ‰‹ï¼Œå…è®¸æ‚¨ä½¿ç”¨Rasa Xæ¥æŸ¥çœ‹å¯¹è¯å¹¶å°†å…¶è½¬æ¢ä¸ºåŸ¹è®­æ•°æ®çš„æœ€ç®€å•æ–¹æ³•ï¼Œå¹¶ä¸”å·²å‡†å¤‡å°±ç»ªã€‚æœ‰å…³éƒ¨ç½²æ–¹æ³•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š<a href="https://rasa.com/docs/rasa-x/installation-and-setup/installation-guide/">Rasa Xå®‰è£…æŒ‡å—ã€‹</a>ã€‚</p><h3 id="æœåŠ¡å™¨å¿«é€Ÿå®‰è£…"><a href="#æœåŠ¡å™¨å¿«é€Ÿå®‰è£…" class="headerlink" title="æœåŠ¡å™¨å¿«é€Ÿå®‰è£…"></a>æœåŠ¡å™¨å¿«é€Ÿå®‰è£…</h3><p>æœåŠ¡å™¨å¿«é€Ÿå®‰è£…è„šæœ¬æ˜¯éƒ¨ç½²Rasa Xå’Œæ‚¨çš„åŠ©æ‰‹çš„æœ€ç®€å•æ–¹æ³•ã€‚å®ƒä½¿ç”¨åˆç†çš„é»˜è®¤å€¼åœ¨æ‚¨çš„æœºå™¨ä¸Šå®‰è£…äº†Kubernetesé›†ç¾¤ï¼Œä½¿æ‚¨å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤å¯åŠ¨å¹¶è¿è¡Œã€‚</p><blockquote><ul><li><p>é»˜è®¤å€¼ï¼šç¡®ä¿æ»¡è¶³<a href="https://rasa.com/docs/rasa-x/installation-and-setup/install/quick-install-script/#hardware-os-requirements">æ“ä½œç³»ç»Ÿè¦æ±‚</a>ï¼Œç„¶åè¿è¡Œï¼š</p><pre><code>curl -s get-rasa-x.rasa.com | é¡»è—¤bash    å¤åˆ¶    å¤åˆ¶ï¼</code></pre></li><li><p>è‡ªå®šä¹‰ï¼šè¯·å‚é˜…<a href="https://rasa.com/docs/rasa-x/installation-and-setup/customize/#server-quick-install">è‡ªå®šä¹‰è„šæœ¬</a> å’Œ<a href="https://rasa.com/docs/rasa-x/installation-and-setup/install/quick-install-script">æœåŠ¡å™¨å¿«é€Ÿå®‰è£…</a>æ–‡æ¡£ã€‚</p></li></ul></blockquote><h3 id="èˆµå›¾"><a href="#èˆµå›¾" class="headerlink" title="èˆµå›¾"></a>èˆµå›¾</h3><p>å¯¹äºå°†å¸å¼•å¤§é‡ç”¨æˆ·æµé‡çš„åŠ©æ‰‹ï¼Œé€šè¿‡æˆ‘ä»¬çš„Helmå›¾è¡¨è®¾ç½®Kubernetesæˆ–Openshiftéƒ¨ç½²æ˜¯æœ€ä½³é€‰æ‹©ã€‚è¿™æä¾›äº†å¯æ‰©å±•çš„ä½“ç³»ç»“æ„ï¼Œè¯¥ä½“ç³»ç»“æ„ä¹Ÿæ˜“äºéƒ¨ç½²ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰Helmå›¾è¡¨ã€‚</p><blockquote><ul><li>é»˜è®¤å€¼ï¼šé˜…è¯»<a href="https://rasa.com/docs/rasa-x/installation-and-setup/install/helm-chart/">Helm Chartå®‰è£…</a>æ–‡æ¡£ã€‚</li><li>è‡ªå®šä¹‰ï¼šé˜…è¯»ä»¥ä¸Šå†…å®¹ä»¥åŠâ€œ<a href="https://rasa.com/docs/rasa-x/installation-and-setup/customize/#helm-chart">é«˜çº§é…ç½®â€</a> æ–‡æ¡£ï¼Œç„¶åæ ¹æ®éœ€è¦è‡ªå®šä¹‰<a href="https://github.com/RasaHQ/rasa-x-helm">å¼€æºHelmå›¾è¡¨</a>ã€‚</li></ul></blockquote><h2 id="æ›¿ä»£éƒ¨ç½²æ–¹æ³•"><a href="#æ›¿ä»£éƒ¨ç½²æ–¹æ³•" class="headerlink" title="æ›¿ä»£éƒ¨ç½²æ–¹æ³•"></a>æ›¿ä»£éƒ¨ç½²æ–¹æ³•</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>æ‚¨ä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰é›†ç¾¤ç¯å¢ƒçš„æƒ…å†µä¸‹åœ¨Docker Composeè®¾ç½®ä¸­è¿è¡ŒRasaXã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·åšçš„å®‰è£…è„šæœ¬ï¼Œä»¥åŠä»»ä½•è‡ªå®šä¹‰è®¾ç½®çš„æ‰‹åŠ¨è¯´æ˜ã€‚</p><blockquote><ul><li>é»˜è®¤å€¼ï¼šé˜…è¯»<a href="https://rasa.com/docs/rasa-x/installation-and-setup/install/docker-compose/#docker-compose-install-script">Docker Composeå®‰è£…è„šæœ¬</a>æ–‡æ¡£æˆ–è§‚çœ‹æœ‰å…³éƒ¨ç½²Rasa Xçš„<a href="https://www.youtube.com/watch?v=IUYdwy8HPVc">Masterclassè§†é¢‘</a>ã€‚</li><li>è‡ªå®šä¹‰ï¼šé˜…è¯»<a href="https://rasa.com/docs/rasa-x/installation-and-setup/install/docker-compose/#docker-compose-manual-install">Docker Composeæ‰‹åŠ¨å®‰è£…</a>æ–‡æ¡£ä»¥è·å–å®Œæ•´çš„è‡ªå®šä¹‰é€‰é¡¹ã€‚</li></ul></blockquote><h3 id="Rasaä»…é™å¼€æºéƒ¨ç½²"><a href="#Rasaä»…é™å¼€æºéƒ¨ç½²" class="headerlink" title="Rasaä»…é™å¼€æºéƒ¨ç½²"></a>Rasaä»…é™å¼€æºéƒ¨ç½²</h3><p>ä¹Ÿå¯ä»¥ä½¿ç”¨Docker Composeåœ¨ä¸ä½¿ç”¨Rasa Xçš„æƒ…å†µä¸‹éƒ¨ç½²RasaåŠ©æ‰‹ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åœ¨æœ¬åœ°æˆ–åœ¨Dockerä¸­æ„å»ºRasa Assistantã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨Docker Composeä¸­éƒ¨ç½²æ¨¡å‹ã€‚</p><ul><li><a href="https://legacy-docs-v1.rasa.com/user-guide/rasa-tutorial/">åœ¨æœ¬åœ°æ„å»ºRasaåŠ©æ‰‹</a></li><li><a href="https://legacy-docs-v1.rasa.com/user-guide/docker/building-in-docker/">åœ¨Dockerä¸­æ„å»ºRasaåŠ©æ‰‹</a></li><li><a href="https://legacy-docs-v1.rasa.com/user-guide/docker/deploying-in-docker-compose/">åœ¨Docker Composeä¸­éƒ¨ç½²Rasaå¼€æºåŠ©æ‰‹</a></li></ul><h2 id="éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨"><a href="#éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨" class="headerlink" title="éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨"></a>éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨</h2><h3 id="å»ºè®¾è¡ŒåŠ¨æœåŠ¡å™¨æ˜ åƒ"><a href="#å»ºè®¾è¡ŒåŠ¨æœåŠ¡å™¨æ˜ åƒ" class="headerlink" title="å»ºè®¾è¡ŒåŠ¨æœåŠ¡å™¨æ˜ åƒ"></a>å»ºè®¾è¡ŒåŠ¨æœåŠ¡å™¨æ˜ åƒ</h3><p>å¦‚æœæ‚¨æ„å»ºåŒ…å«æ“ä½œä»£ç çš„æ˜ åƒå¹¶å°†å…¶å­˜å‚¨åœ¨å®¹å™¨æ³¨å†Œè¡¨ä¸­ï¼Œåˆ™å¯ä»¥å°†å…¶ä½œä¸ºéƒ¨ç½²çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œè€Œä¸å¿…åœ¨æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨ä»£ç ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥æ·»åŠ ç³»ç»Ÿæˆ–Pythonåº“çš„ä»»ä½•å…¶ä»–ä¾èµ–å…³ç³»ï¼Œè¿™äº›ä¾èµ–å…³ç³»æ˜¯åŠ¨ä½œä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸åŒ…å«åœ¨åŸºæœ¬<code>rasa/rasa-sdk</code>æ˜ åƒä¸­ã€‚</p><p>åˆ›å»ºå›¾åƒï¼š</p><blockquote><ol><li><p>å°†æ“ä½œä»£ç ç§»åˆ°<code>actions</code>é¡¹ç›®ç›®å½•ä¸­çš„æ–‡ä»¶å¤¹ä¸­ã€‚ç¡®ä¿è¿˜æ·»åŠ ä¸€ä¸ªç©º<code>actions/__init__.py</code>æ–‡ä»¶ï¼š</p><blockquote><pre><code>mkdir actionsmv actions.py actions/actions.pytouch actions/__init__.py  # the init file indicates actions.py is a python module</code></pre></blockquote><p>è¯¥<code>rasa/rasa-sdk</code>å›¾åƒä¼šè‡ªåŠ¨å¯»æ‰¾åœ¨è¡ŒåŠ¨<code>actions/actions.py</code>ã€‚</p></li><li><p>å¦‚æœæ‚¨çš„æ“ä½œæœ‰ä»»ä½•å…¶ä»–ä¾èµ–æ€§ï¼Œè¯·åœ¨æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ <code>actions/requirements-actions.txt</code>ã€‚</p></li><li><p><code>Dockerfile</code>åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºçš„æ–‡ä»¶ï¼Œæ‚¨å°†åœ¨å…¶ä¸­æ‰©å±•å®˜æ–¹SDKæ˜ åƒï¼Œåœ¨ä»£ç ä¸Šè¿›è¡Œå¤åˆ¶å¹¶æ·»åŠ ä»»ä½•è‡ªå®šä¹‰ä¾èµ–é¡¹ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚ä¾‹å¦‚ï¼š</p><blockquote><pre><code>ï¼ƒæ‰©å±•å®˜æ–¹Rasa SDKæ˜ åƒFROM rasa/rasa-sdk:1.10.2ï¼ƒä½¿ç”¨å­ç›®å½•ä½œä¸ºå·¥ä½œç›®å½•WORKDIR /appï¼ƒå¦‚æœ‰å¿…è¦ï¼Œå¤åˆ¶ä»»ä½•å…¶ä»–è‡ªå®šä¹‰è¦æ±‚ï¼ˆå–æ¶ˆæ³¨é‡Šä¸‹ä¸€è¡Œ# COPY actions/requirements-actions.txt ./ï¼ƒæ›´æ”¹å›rootç”¨æˆ·ä»¥å®‰è£…ä¾èµ–é¡¹USER rootï¼ƒå¦‚æœ‰å¿…è¦ï¼Œå®‰è£…æ“ä½œä»£ç çš„å…¶ä»–è¦æ±‚ï¼ˆå–æ¶ˆæ³¨é‡Šä¸‹ä¸€è¡Œï¼‰# RUN pip install -r requirements-actions.txtï¼ƒå°†åŠ¨ä½œæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å·¥ä½œç›®å½•COPY ./actions /app/actionsï¼ƒæŒ‰ç…§æœ€ä½³åšæ³•ï¼Œè¯·å‹¿ä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œä»£ç USER 1001</code></pre></blockquote></li></ol></blockquote><p>ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ˜ åƒï¼š</p><blockquote><pre><code>docker build . -t &lt;account_username&gt;/&lt;repository_name&gt;:&lt;custom_image_tag&gt;</code></pre></blockquote><p>è¯¥<code>&lt;custom_image_tag&gt;</code>åº”å‚è€ƒè¿™ä¸€å½¢è±¡å°†å¦‚ä½•ä¸å…¶ä»–äººä¸åŒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ ‡è®°æ ‡ç­¾çš„ç‰ˆæœ¬æˆ–æ—¥æœŸï¼Œä»¥åŠä¸ºç”Ÿäº§å’Œå¼€å‘æœåŠ¡å™¨åˆ›å»ºå…·æœ‰ä¸åŒä»£ç çš„ä¸åŒæ ‡ç­¾ã€‚æ¯å½“æ‚¨æ›´æ–°ä»£ç å¹¶æƒ³é‡æ–°éƒ¨ç½²å®ƒæ—¶ï¼Œéƒ½åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°æ ‡è®°ã€‚</p><h3 id="ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ"><a href="#ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ"></a>ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œæœåŠ¡å™¨æ˜ åƒ</h3><p>å¦‚æœè¦æ„å»ºæ­¤æ˜ åƒä»¥ä½¿å…¶å¯ä»å…¶ä»–æœåŠ¡å™¨ï¼ˆä¾‹å¦‚Rasa Xæˆ–Rasa Enterpriseéƒ¨ç½²ï¼‰ä½¿ç”¨ï¼Œåˆ™åº”å°†æ˜ åƒæ¨é€åˆ°äº‘å­˜å‚¨åº“ã€‚</p><p>æœ¬æ–‡æ¡£å‡å®šæ‚¨å°†æ˜ åƒæ¨é€åˆ°<a href="https://hub.docker.com/">DockerHub</a>ã€‚DockerHubå°†è®©æ‚¨å…è´¹æ‰˜ç®¡å¤šä¸ªå…¬å…±å­˜å‚¨åº“å’Œä¸€ä¸ªç§æœ‰å­˜å‚¨åº“ã€‚ç¡®ä¿é¦–å…ˆ<a href="https://hub.docker.com/signup/">åˆ›å»ºä¸€ä¸ªå¸æˆ·</a> å¹¶<a href="https://hub.docker.com/signup/">åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“</a>æ¥å­˜å‚¨æ‚¨çš„å›¾åƒã€‚æ‚¨è¿˜å¯ä»¥å°†æ˜ åƒæ¨é€åˆ°å…¶ä»–Dockeræ³¨å†Œè¡¨ï¼Œä¾‹å¦‚<a href="https://cloud.google.com/container-registry">Google Container Registry</a>ï¼Œ <a href="https://aws.amazon.com/ecr/">Amazon Elastic Container Registry</a>æˆ– <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a>ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å°†æ˜ åƒæ¨é€åˆ°DockerHubï¼š</p><blockquote><pre><code>docker login --username &lt;account_username&gt; --password &lt;account_password&gt;docker push &lt;account_username&gt;/&lt;repository_name&gt;:&lt;custom_image_tag&gt;</code></pre></blockquote><p>è¦å°†å›¾åƒè¿›è¡Œèº«ä»½éªŒè¯å¹¶å°†å…¶æ¨é€åˆ°å…¶ä»–å®¹å™¨æ³¨å†Œè¡¨ï¼Œè¯·å‚é˜…æ‰€é€‰å®¹å™¨æ³¨å†Œè¡¨çš„æ–‡æ¡£ã€‚</p><p>æ‚¨å¦‚ä½•å¼•ç”¨è‡ªå®šä¹‰æ“ä½œæ˜ åƒå–å†³äºæ‚¨çš„éƒ¨ç½²ã€‚é€‰æ‹©ä¸æ‚¨çš„éƒ¨ç½²ç›¸å…³çš„æ–‡æ¡£ï¼š</p><blockquote><ul><li><a href="https://rasa.com/docs/rasa-x/installation-and-setup/customize/#quick-install-script-customizing">æœåŠ¡å™¨å¿«é€Ÿå®‰è£…</a></li><li><a href="https://rasa.com/docs/rasa-x/installation-and-setup/customize/#adding-a-custom-action-server">èˆµå›¾</a></li><li><a href="https://rasa.com/docs/rasa-x/installation-and-setup/customize/#connecting-a-custom-action-server">Dockeræ’°å†™</a></li><li><a href="https://legacy-docs-v1.rasa.com/user-guide/docker/deploying-in-docker-compose/#running-multiple-services">Rasaä»…å¼€æº</a></li></ul></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(8)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-8/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-8/</url>
      
        <content type="html"><![CDATA[<h1 id="é…ç½®HTTP-API"><a href="#é…ç½®HTTP-API" class="headerlink" title="é…ç½®HTTP API"></a>é…ç½®HTTP API</h1><ul><li><a href="#">ä½¿ç”¨Rasaçš„HTTP API</a><ul><li><a href="#">ä»æœåŠ¡å™¨è·å–æ¨¡å‹</a></li><li><a href="#">ä»è¿œç¨‹å­˜å‚¨ä¸­è·å–æ¨¡å‹</a></li></ul></li><li><a href="#">é…ç½®SSL / HTTPS</a></li><li><a href="#">å®‰å…¨æ³¨æ„äº‹é¡¹</a></li><li><a href="#">ç«¯ç‚¹é…ç½®</a><ul><li><a href="#">è¿æ¥è¿½è¸ªå•†åº—</a></li><li><a href="#">è¿æ¥äº‹ä»¶ä»£ç†</a></li></ul></li></ul><h2 id="ä½¿ç”¨Rasaçš„HTTP"><a href="#ä½¿ç”¨Rasaçš„HTTP" class="headerlink" title="ä½¿ç”¨Rasaçš„HTTP"></a>ä½¿ç”¨Rasaçš„HTTP</h2><p>æ³¨æ„</p><p>ä»¥ä¸‹è¯´æ˜ä¸é…ç½®æ¨¡å‹å¦‚ä½•åœ¨Dockerå®¹å™¨ä¸­è¿è¡Œæˆ–åœ¨æœ¬åœ°æµ‹è¯•HTTP APIæœ‰å…³ã€‚å¦‚æœè¦å‘ç”¨æˆ·éƒ¨ç½²åŠ©æ‰‹ï¼Œè¯·å‚é˜…<a href="#">éƒ¨ç½²RasaåŠ©æ‰‹</a>ã€‚</p><p>æ‚¨å¯ä»¥è¿è¡Œä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä½¿ç”¨è®­ç»ƒæœ‰ç´ çš„Rasaæ¨¡å‹å¤„ç†ä»¥ä¸‹è¯·æ±‚ï¼š</p><pre><code>rasa run -m models --enable-api --log-file out.log</code></pre><p>è¯¥APIå…¬å¼€çš„æ‰€æœ‰ç«¯ç‚¹éƒ½è®°å½•åœ¨<a href="#">HTTP APIä¸­</a>ã€‚</p><p>ä¸åŒçš„å‚æ•°æ˜¯ï¼š</p><ul><li><code>-m</code>ï¼šåŒ…å«Rasaæ¨¡å‹çš„æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œ</li><li><code>--enable-api</code>ï¼šå¯ç”¨æ­¤é™„åŠ APIï¼Œå¹¶</li><li><code>--log-file</code>ï¼šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</li></ul><p>Rasaå¯ä»¥é€šè¿‡ä¸‰ç§ä¸åŒçš„æ–¹å¼åŠ è½½æ¨¡å‹ï¼š</p><ol><li>ä»æœåŠ¡å™¨<a href="#">è·å–æ¨¡å‹</a>ï¼ˆè¯·å‚é˜…ä»æœåŠ¡å™¨<a href="#">è·å–æ¨¡å‹</a>ï¼‰ï¼Œæˆ–è€…</li><li>ä»è¿œç¨‹å­˜å‚¨ä¸­è·å–æ¨¡å‹ï¼ˆè¯·å‚é˜…<a href="#">Cloud Storage</a>ï¼‰ã€‚</li><li>é€šè¿‡<code>-m</code>æœ¬åœ°å­˜å‚¨ç³»ç»ŸåŠ è½½æŒ‡å®šçš„æ¨¡å‹ï¼Œ</li></ol><p>Rasaå°è¯•ä»¥ä¸Šè¿°é¡ºåºåŠ è½½æ¨¡å‹ï¼Œå³ï¼Œå¦‚æœæœªé…ç½®ä»»ä½•æ¨¡å‹æœåŠ¡å™¨å’Œè¿œç¨‹å­˜å‚¨ï¼Œå®ƒåªä¼šå°è¯•ä»æœ¬åœ°å­˜å‚¨ç³»ç»ŸåŠ è½½æ¨¡å‹ã€‚</p><blockquote><p>è­¦å‘Š</p><p>ç¡®ä¿é€šè¿‡é™åˆ¶å¯¹æœåŠ¡å™¨çš„è®¿é—®ï¼ˆä¾‹å¦‚ä½¿ç”¨é˜²ç«å¢™ï¼‰æˆ–å¯ç”¨èº«ä»½éªŒè¯æ–¹æ³•æ¥ç¡®ä¿æœåŠ¡å™¨çš„å®‰å…¨ï¼š<a href="#">å®‰å…¨æ³¨æ„äº‹é¡¹</a>ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ä½œï¼Œè¯·ç¡®ä¿æ‚¨çš„åŠ¨ä½œæœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆè¯·å‚é˜…<a href="#">å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨</a>ï¼‰ã€‚å¦‚æœæ‚¨çš„æ“ä½œåœ¨å…¶ä»–è®¡ç®—æœºä¸Šè¿è¡Œï¼Œæˆ–è€…æ‚¨æ²¡æœ‰ä½¿ç”¨Rasa SDKï¼Œè¯·ç¡®ä¿æ›´æ–°<code>endpoints.yml</code>æ–‡ä»¶ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>å¦‚æœä½¿ç”¨ä»…NLUæ¨¡å‹å¯åŠ¨æœåŠ¡å™¨ï¼Œåˆ™æ— æ³•è°ƒç”¨æ‰€æœ‰å¯ç”¨ç«¯ç‚¹ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›ç«¯ç‚¹å°†è¿”å›409çŠ¶æ€ä»£ç ï¼Œå› ä¸ºéœ€è¦è®­ç»ƒæœ‰ç´ çš„Coreæ¨¡å‹æ¥å¤„ç†è¯·æ±‚ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTPæœåŠ¡å™¨ä½œä¸ºå•ä¸ªè¿›ç¨‹è¿è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>SANIC_WORKERS</code>ç¯å¢ƒå˜é‡æ›´æ”¹å·¥ä½œè¿›ç¨‹çš„æ•°é‡ã€‚å»ºè®®æ‚¨å°†å·¥ä½œç¨‹åºæ•°è®¾ç½®ä¸ºå¯ç”¨çš„CPUå†…æ ¸æ•°ï¼ˆ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="#">Sanicæ–‡æ¡£</a>ï¼‰ã€‚è¿™åªèƒ½ä¸ç»“åˆä½¿ç”¨ <code>RedisLockStore</code>ï¼ˆè¯·å‚é˜…<a href="#">é”å­˜å‚¨</a>ï¼‰</p></blockquote><h3 id="ä»æœåŠ¡å™¨è·å–æ¨¡å‹"><a href="#ä»æœåŠ¡å™¨è·å–æ¨¡å‹" class="headerlink" title="ä»æœåŠ¡å™¨è·å–æ¨¡å‹"></a>ä»æœåŠ¡å™¨è·å–æ¨¡å‹</h3><p>æ‚¨å¯ä»¥å°†HTTPæœåŠ¡å™¨é…ç½®ä¸ºä»å¦ä¸€ä¸ªURLè·å–æ¨¡å‹ï¼š</p><pre><code>rasa run --enable-api --log-file out.log --endpoints my_endpoints.yml</code></pre><p>åœ¨ç«¯ç‚¹é…ç½®ï¼ˆ<code>my_endpoints.yml</code>ï¼‰ä¸­æŒ‡å®šæ¨¡å‹æœåŠ¡å™¨ï¼Œåœ¨è¯¥é…ç½®ä¸­æ‚¨å¯ä»¥æŒ‡å®šæœåŠ¡å™¨URL Rasaå®šæœŸæŸ¥è¯¢å‹ç¼©çš„Rasaæ¨¡å‹ï¼š</p><pre><code>models:  url: http://my-server.com/models/default@latest  wait_time_between_pulls: 10   # [optional](default: 100)</code></pre><blockquote><p>æ³¨æ„</p><p>å¦‚æœåªæƒ³ä»æœåŠ¡å™¨æå–ä¸€æ¬¡æ¨¡å‹ï¼Œè¯·è®¾ç½® <code>wait_time_between_pulls</code>ä¸º<code>None</code>ã€‚</p></blockquote><blockquote><p>æ³¨æ„</p><p>æ‚¨çš„æ¨¡å‹æœåŠ¡å™¨å¿…é¡»æä¾›å‹ç¼©çš„Rasaæ¨¡å‹ï¼Œå¹¶ä¸” æ ‡å¤´ä¹‹ä¸€ã€‚ä»…å½“æ­¤æ¨¡å‹å“ˆå¸Œå€¼å·²æ›´æ”¹æ—¶ï¼ŒRasaæ‰ä¼šä¸‹è½½æ–°æ¨¡å‹ã€‚<code>{"ETag": &lt;model_hash_string&gt;}</code></p></blockquote><p>Rasaä½¿ç”¨<code>If-None-Match</code> åŒ…å«å½“å‰æ¨¡å‹å“ˆå¸Œçš„æ ‡å¤´å°†è¯·æ±‚å‘é€åˆ°æ¨¡å‹æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨çš„æ¨¡å‹æœåŠ¡å™¨å¯ä»¥ä¸ºæ¨¡å‹æä¾›ä¸æ‚¨å‘é€çš„å“ˆå¸Œä¸åŒçš„å“ˆå¸Œï¼Œåˆ™å®ƒåº”ä»¥zipæ–‡ä»¶çš„å½¢å¼å‘é€ï¼Œå¹¶å¸¦æœ‰<code>ETag</code>åŒ…å«æ–°å“ˆå¸Œçš„æ ‡å¤´ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™RasaæœŸæœ›å¸¦æœ‰<code>204</code>æˆ–<code>304</code>çŠ¶æ€ä»£ç çš„ç©ºå“åº”ã€‚</p><p>Rasaå¯èƒ½å‘æ¨¡å‹æœåŠ¡å™¨å‘å‡ºçš„ç¤ºä¾‹è¯·æ±‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-shell"><code class="language-shell"> curl --header "If-None-Match: d41d8cd98f00b204e9800998ecf8427e" http://my-server.com/models/default@latest</code></pre><h3 id="ä»è¿œç¨‹å­˜å‚¨è·å–æ¨¡å‹"><a href="#ä»è¿œç¨‹å­˜å‚¨è·å–æ¨¡å‹" class="headerlink" title="ä»è¿œç¨‹å­˜å‚¨è·å–æ¨¡å‹"></a>ä»è¿œç¨‹å­˜å‚¨è·å–æ¨¡å‹</h3><p>æ‚¨è¿˜å¯ä»¥é…ç½®RasaæœåŠ¡å™¨ä»¥ä»è¿œç¨‹å­˜å‚¨ä¸­è·å–æ¨¡å‹ï¼š</p><pre><code>rasa run -m 20190506-100418.tar.gz --enable-api --log-file out.log --remote-storage aws</code></pre><p>è¯¥æ¨¡å‹å°†è¢«ä¸‹è½½å¹¶å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ç³»ç»Ÿä¸Šçš„ä¸´æ—¶ç›®å½•ä¸­ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="#">Cloud Storage</a>ã€‚</p><h2 id="é…ç½®SSL"><a href="#é…ç½®SSL" class="headerlink" title="é…ç½®SSL /"></a>é…ç½®SSL /</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRasaæœåŠ¡å™¨ä½¿ç”¨HTTPè¿›è¡Œé€šä¿¡ã€‚ä¸ºäº†ç¡®ä¿ä¸SSLçš„é€šä¿¡å®‰å…¨ï¼Œæ‚¨éœ€è¦æä¾›æœ‰æ•ˆçš„è¯ä¹¦å’Œç›¸åº”çš„ç§é’¥æ–‡ä»¶ã€‚</p><p>æ‚¨å¯ä»¥åœ¨å‘½ä»¤ä¸­æŒ‡å®šè¿™äº›æ–‡ä»¶ï¼š<code>rasa run</code></p><pre class=" language-shell"><code class="language-shell">rasa run --ssl-certificate myssl.crt --ssl-keyfile myssl.key</code></pre><p>å¦‚æœåœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨å¯†ç å¯¹å¯†é’¥æ–‡ä»¶è¿›è¡Œäº†åŠ å¯†ï¼Œåˆ™éœ€è¦å°†æ­¤å¯†ç æ·»åŠ åˆ°å‘½ä»¤ä¸­ï¼š</p><pre class=" language-shell"><code class="language-shell">rasa run --ssl-certificate myssl.crt --ssl-keyfile myssl.key --ssl-password mypassword</code></pre><h2 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h2><p>æˆ‘ä»¬å»ºè®®ä¸è¦å°†Rasa Serveræš´éœ²ç»™å¤–ç•Œï¼Œè€Œåº”é€šè¿‡ä¸“ç”¨è¿æ¥ï¼ˆä¾‹å¦‚dockerå®¹å™¨ä¹‹é—´ï¼‰ä»åç«¯è¿æ¥åˆ°Rasa Serverã€‚</p><p>ä½†æ˜¯ï¼Œå†…ç½®äº†ä¸¤ç§èº«ä»½éªŒè¯æ–¹æ³•ï¼š</p><p><strong>åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯ï¼š</strong></p><p>å¯åŠ¨æœåŠ¡å™¨æ—¶ä½¿ç”¨ä¼ é€’ä»¤ç‰Œï¼š<code>--auth-token thisismysecret</code></p><pre class=" language-shell"><code class="language-shell">rasa run \    -m models \    --enable-api \    --log-file out.log \    --auth-token thisismysecret</code></pre><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­<code>thisismysecret</code>ï¼Œæ‚¨çš„è¯·æ±‚åº”å°†ä»¤ç‰Œä½œä¸ºå‚æ•°ä¼ é€’ï¼š</p><pre class=" language-shell"><code class="language-shell"> curl -XGET localhost:5005/conversations/default/tracker?token=thisismysecret</code></pre><p><strong>åŸºäºJWTçš„èº«ä»½éªŒè¯ï¼š</strong></p><p>ä½¿ç”¨å¯ç”¨åŸºäºJWTçš„èº«ä»½éªŒè¯ã€‚å‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚éœ€è¦åœ¨ä½¿ç”¨æ­¤æœºå¯†å’Œç®—æ³•ç­¾åçš„æ ‡å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„JWTä»¤ç‰Œã€‚<code>--jwt-secret thisismysecret Authorization HS256</code></p><p>ç”¨æˆ·å¿…é¡»å…·æœ‰<code>username</code>å’Œ<code>role</code>å±æ€§ã€‚å¦‚æœ<code>role</code>ä¸º<code>admin</code>ï¼Œåˆ™æ‰€æœ‰ç«¯ç‚¹å‡å¯è®¿é—®ã€‚å¦‚æœ<code>role</code>ä¸º<code>user</code>ï¼Œ<code>sender_id</code>åˆ™åªæœ‰<code>sender_id</code>ä¸ç”¨æˆ·çš„åŒ¹é…æ—¶ï¼Œæ‰å¯ä»¥è®¿é—®å¸¦æœ‰å‚æ•°çš„ç«¯ç‚¹<code>username</code>ã€‚</p><pre class=" language-shell"><code class="language-shell">rasa run \    -m models \    --enable-api \    --log-file out.log \    --jwt-secret thisismysecret</code></pre><p>æ‚¨çš„è¯·æ±‚åº”è®¾ç½®æ­£ç¡®çš„JWTæ ‡å¤´ï¼š</p><pre class=" language-shell"><code class="language-shell">"Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ"                 "zdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIi"                 "wiaWF0IjoxNTE2MjM5MDIyfQ.qdrr2_a7Sd80gmCWjnDomO"                 "Gl8eZFVfKXA6jhncgRn-I"</code></pre><h2 id="ç«¯ç‚¹é…ç½®"><a href="#ç«¯ç‚¹é…ç½®" class="headerlink" title="ç«¯ç‚¹é…ç½®"></a>ç«¯ç‚¹é…ç½®</h2><p>è¦å°†Rasaè¿æ¥åˆ°å…¶ä»–ç»ˆç»“ç‚¹ï¼Œå¯ä»¥åœ¨YAMLæ–‡ä»¶ä¸­æŒ‡å®šç»ˆç»“ç‚¹é…ç½®ã€‚ç„¶åä½¿ç”¨flagè¿è¡ŒRasa ã€‚<code>--endpoints &lt;path to endpoint configuration.yml&gt;</code></p><p>ä¾‹å¦‚ï¼š</p><pre class=" language-shell"><code class="language-shell">rasa run \    --m <Rasa model> \    --endpoints <path to endpoint configuration>.yml</code></pre><blockquote><p>æ³¨æ„</p><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨ä¸­æŒ‡å®šé…ç½®æ–‡ä»¶æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚ç„¶åå°†è¿™äº›å ä½ç¬¦æ›¿æ¢ä¸ºç¯å¢ƒå˜é‡çš„å€¼ã€‚<code>${name of environment variable}</code></p></blockquote><h3 id="è¿æ¥Trackerå•†åº—"><a href="#è¿æ¥Trackerå•†åº—" class="headerlink" title="è¿æ¥Trackerå•†åº—"></a>è¿æ¥Trackerå•†åº—</h3><p>è¦åœ¨ç«¯ç‚¹é…ç½®ä¸­é…ç½®è·Ÿè¸ªå™¨å­˜å‚¨ï¼Œè¯·å‚é˜…<a href="#">è·Ÿè¸ªå™¨å­˜å‚¨</a>ã€‚</p><h3 id="è¿æ¥äº‹ä»¶ä»£ç†"><a href="#è¿æ¥äº‹ä»¶ä»£ç†" class="headerlink" title="è¿æ¥äº‹ä»¶ä»£ç†"></a>è¿æ¥äº‹ä»¶ä»£ç†</h3><p>è¦åœ¨ç«¯ç‚¹é…ç½®ä¸­é…ç½®äº‹ä»¶ä»£ç†ï¼Œè¯·å‚é˜…<a href="#">äº‹ä»¶</a>ä»£ç†ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(7)</title>
      <link href="/2020/10/04/rasa-wen-dang-zhi-nan-7/"/>
      <url>/2020/10/04/rasa-wen-dang-zhi-nan-7/</url>
      
        <content type="html"><![CDATA[<h1 id="éªŒè¯æ•°æ®"><a href="#éªŒè¯æ•°æ®" class="headerlink" title="éªŒè¯æ•°æ®"></a>éªŒè¯æ•°æ®</h1><h2 id="æµ‹è¯•åŸŸå’Œæ•°æ®æ–‡ä»¶ä¸­çš„é”™è¯¯"><a href="#æµ‹è¯•åŸŸå’Œæ•°æ®æ–‡ä»¶ä¸­çš„é”™è¯¯" class="headerlink" title="æµ‹è¯•åŸŸå’Œæ•°æ®æ–‡ä»¶ä¸­çš„é”™è¯¯"></a>æµ‹è¯•åŸŸå’Œæ•°æ®æ–‡ä»¶ä¸­çš„é”™è¯¯</h2><p>è¦éªŒè¯æ‚¨çš„åŸŸæ–‡ä»¶ï¼ŒNLUæ•°æ®æˆ–æ•…äº‹æ•°æ®ä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ï¼Œè¯·è¿è¡ŒéªŒè¯è„šæœ¬ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š</p><pre><code>rasa data validate</code></pre><p>ä¸Šé¢çš„è„šæœ¬å¯¹æ–‡ä»¶è¿è¡Œæ‰€æœ‰éªŒè¯ï¼Œä½†æ•…äº‹ç»“æ„éªŒè¯é™¤å¤–ï¼Œé™¤éæ‚¨æä¾›<code>--max-history</code>å‚æ•°ï¼Œå¦åˆ™å°†çœç•¥è¯¥éªŒè¯ã€‚è¿™æ˜¯è„šæœ¬çš„é€‰é¡¹åˆ—è¡¨ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa data validate [-h] [-v] [-vv] [--quiet]                          [--max-history MAX_HISTORY] [--fail-on-warnings]                          [-d DOMAIN] [--data DATA]                          &#123;stories&#125; ...positional arguments:  &#123;stories&#125;    stories             Checks for inconsistencies in the story files.optional arguments:  -h, --help            show this help message and exit  --max-history MAX_HISTORY                        Number of turns taken into account for story structure                        validation. (default: None)  --fail-on-warnings    Fail validation on warnings and errors. If omitted                        only errors will result in a non zero exit code.                        (default: False)  -d DOMAIN, --domain DOMAIN                        Domain specification (yml file). (default: domain.yml)  --data DATA           Path to the file or directory containing Rasa data.                        (default: data)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒéªŒè¯å™¨ä»…æœç´¢æ•°æ®ä¸­çš„é”™è¯¯ï¼ˆä¾‹å¦‚ï¼ŒåŒä¸€ç¤ºä¾‹è¢«åˆ—ä¸ºä¸¤ä¸ªæ„å›¾çš„ç¤ºä¾‹ï¼‰ï¼Œä½†ä¸æŠ¥å‘Šå…¶ä»–æ¬¡è¦é—®é¢˜ï¼ˆä¾‹å¦‚æœªä½¿ç”¨çš„æ„å›¾ï¼Œæœªä½œä¸ºåŠ¨ä½œåˆ—å‡ºçš„è¨€è¯­ï¼‰ã€‚è¦åŒæ—¶æŠ¥å‘Šä»¥åï¼Œè¯·ä½¿ç”¨è¯¥<code>-debug</code>æ ‡å¿—ã€‚</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡å¯¼å…¥Validatorç±»é€šè¿‡Python APIè¿è¡Œè¿™äº›éªŒè¯ï¼Œè¯¥ç±»å…·æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p><p><strong>from_filesï¼ˆï¼‰ï¼š</strong>ä»å­—ç¬¦ä¸²è·¯å¾„åˆ›å»ºå®ä¾‹åˆ°å¿…è¦çš„æ–‡ä»¶ã€‚</p><p><strong>verify_intentsï¼ˆï¼‰ï¼š</strong>æ£€æŸ¥åŸŸæ–‡ä»¶ä¸­åˆ—å‡ºçš„æ„å›¾æ˜¯å¦ä¸NLUæ•°æ®ä¸€è‡´ã€‚</p><p><strong>verify_example_repetition_in_intentsï¼ˆï¼‰ï¼š</strong>æ£€æŸ¥NLUæ•°æ®çš„ä¸åŒæ„å›¾ä¹‹é—´æ˜¯å¦æ²¡æœ‰é‡å¤çš„æ•°æ®ã€‚</p><p><strong>verify_intents_in_storiesï¼ˆï¼‰ï¼š</strong>éªŒè¯æ•…äº‹ä¸­çš„æ„å›¾ï¼Œä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦æœ‰æ•ˆã€‚</p><p><strong>verify_utterancesï¼ˆï¼‰ï¼š</strong>æ£€æŸ¥åŸŸæ–‡ä»¶ä¸­â€œå“åº”â€éƒ¨åˆ†ä¸­åˆ—å‡ºçš„å“åº”ä¸æ‚¨å®šä¹‰çš„å‘å£°æ“ä½œä¹‹é—´çš„ä¸€è‡´æ€§ã€‚</p><p><strong>verify_utterances_in_storiesï¼ˆï¼‰ï¼š</strong>éªŒè¯æ•…äº‹ä¸­çš„è¨€è¯­ï¼Œä»¥æ£€æŸ¥å…¶æ˜¯å¦æœ‰æ•ˆã€‚</p><p><strong>verify_allï¼ˆï¼‰ï¼š</strong>è¿è¡Œä¸Šé¢çš„æ‰€æœ‰éªŒè¯ã€‚</p><p><strong>verify_domain_validityï¼ˆï¼‰ï¼š</strong>æ£€æŸ¥åŸŸæ˜¯å¦æœ‰æ•ˆã€‚</p><p>è¦ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªValidatorå¯¹è±¡å¹¶åˆå§‹åŒ–è®°å½•å™¨ã€‚è¯·å‚é˜…ä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-shell"><code class="language-shell">import loggingfrom rasa import utilsfrom rasa.core.validator import Validatorlogger = logging.getLogger(__name__)utils.configure_colored_logging('DEBUG')validator = Validator.from_files(domain_file='domain.yml',                                 nlu_data='data/nlu_data.md',                                 stories='data/stories.md')validator.verify_all()</code></pre><h2 id="æµ‹è¯•æ•…äº‹æ–‡ä»¶ä»¥è§£å†³å†²çª"><a href="#æµ‹è¯•æ•…äº‹æ–‡ä»¶ä»¥è§£å†³å†²çª" class="headerlink" title="æµ‹è¯•æ•…äº‹æ–‡ä»¶ä»¥è§£å†³å†²çª"></a>æµ‹è¯•æ•…äº‹æ–‡ä»¶ä»¥è§£å†³å†²çª</h2><p>é™¤äº†ä¸Šè¿°é»˜è®¤æµ‹è¯•ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥å¯¹æ•…äº‹è¿›è¡Œæ›´æ·±å…¥çš„ç»“æ„æµ‹è¯•ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‚¨å¯ä»¥æµ‹è¯•æ‚¨çš„æ•…äº‹æ˜¯å¦ä¸ä¸€è‡´ï¼Œå³æ˜¯å¦ä»ç›¸åŒçš„å¯¹è¯å†å²ä¸­éµå¾ªäº†ä¸åŒçš„æ¼«æ¸¸å™¨æ“ä½œã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™Rasaæ— æ³•å­¦ä¹ æ­£ç¡®çš„è¡Œä¸ºã€‚</p><p>ä»¥ä»¥ä¸‹ä¸¤ä¸ªæ•…äº‹ä¸ºä¾‹ï¼š</p><pre class=" language-text"><code class="language-text">## Story 1* greet  - utter_greet* inform_happy  - utter_happy  - utter_goodbye## Story 2* greet  - utter_greet* inform_happy  - utter_goodbye</code></pre><p>è¿™ä¸¤ä¸ªæ•…äº‹æ˜¯ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºèä¸çŸ¥é“æ˜¯å¦åº”è¯¥é¢„æµ‹<code>utter_happy</code>æˆ–<code>utter_goodbye</code> ä¹‹å<code>inform_happy</code>ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆèƒ½åŒºåˆ†å¯¹è¯å›½åœ¨<code>inform_happy</code>è¿™ä¸¤ä¸ªæ•…äº‹å’Œåç»­è¡ŒåŠ¨æ˜¯åœ¨æ•…äº‹1å’Œ2çš„æ•…äº‹ä¸åŒã€‚</p><p>å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ•…äº‹ç»“æ„éªŒè¯å·¥å…·è‡ªåŠ¨è¯†åˆ«æ­¤å†²çªã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<code>rasa data validate</code></p><pre class=" language-text"><code class="language-text">rasa data validate stories --max-history 3> 2019-12-09 09:32:13 INFO     rasa.core.validator  - Story structure validation...> 2019-12-09 09:32:13 INFO     rasa.core.validator  - Assuming max_history = 3>   Processed Story Blocks: 100% 2/2 [00:00<00:00, 3237.59it/s, # trackers=1]> 2019-12-09 09:32:13 WARNING  rasa.core.validator  - CONFLICT after intent 'inform_happy':>   utter_goodbye predicted in 'Story 2'>   utter_happy predicted in 'Story 1'</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†<code>max-history</code>å€¼æŒ‡å®šä¸º3ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨è¿›è¡ŒåŠ¨ä½œé¢„æµ‹æ—¶ä¼šè€ƒè™‘3ä¸ªäº‹ä»¶ï¼ˆç”¨æˆ·æ¶ˆæ¯/æœºå™¨äººæ“ä½œï¼‰ï¼Œä½†æ˜¯å¯¹äºæ­¤ç¤ºä¾‹ï¼Œç‰¹å®šçš„è®¾ç½®å¹¶ä¸é‡è¦ï¼Œå› ä¸ºæ— è®ºæ‚¨èŠ±è´¹å¤šé•¿æ—¶é—´çš„å†å²è®°å½•è€ƒè™‘åˆ°ï¼Œå†²çªå§‹ç»ˆå­˜åœ¨ã€‚</p><blockquote><p>è­¦å‘Š</p><p>è¯¥è„šæœ¬å‡å®šæ‚¨æ‰€æœ‰çš„<strong>æ•…äº‹åç§°éƒ½æ˜¯å”¯ä¸€çš„</strong>ã€‚å¦‚æœæ‚¨çš„æ•…äº‹é‡‡ç”¨Markdownæ ¼å¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¸å¦‚è¿™æ ·çš„å‘½ä»¤æŸ¥æ‰¾é‡å¤çš„åç§° ã€‚<code>rasa data validate stories``grep -h "##" data/*.md | uniq -c | grep "^[^1]"</code></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(6)</title>
      <link href="/2020/10/03/rasa-wen-dang-zhi-nan-6/"/>
      <url>/2020/10/03/rasa-wen-dang-zhi-nan-6/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾ç½®CI-CD"><a href="#è®¾ç½®CI-CD" class="headerlink" title="è®¾ç½®CI / CD"></a>è®¾ç½®CI / CD</h1><p>å³ä½¿å¼€å‘ä¸Šä¸‹æ–‡åŠ©æ‰‹ä¸å¼€å‘ä¼ ç»Ÿè½¯ä»¶æœ‰æ‰€ä¸åŒï¼Œæ‚¨ä»åº”éµå¾ªè½¯ä»¶å¼€å‘æœ€ä½³å®è·µã€‚è®¾ç½®æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰ç®¡é“å¯ç¡®ä¿å¯¹æ‚¨çš„æ¼«æ¸¸å™¨è¿›è¡Œå¢é‡æ›´æ–°å¯ä»¥æ”¹å–„å®ƒï¼Œè€Œä¸ä¼šæŸå®³å®ƒã€‚</p><ul><li><a href="#">æ€»è§ˆ</a></li><li><a href="#">æŒç»­é›†æˆï¼ˆCIï¼‰</a><ul><li><a href="#">éªŒè¯æ•°æ®å’Œæ•…äº‹</a></li><li><a href="#">è®­ç»ƒæ¨¡å‹</a></li><li><a href="#">æµ‹è¯•åŠ©æ‰‹</a></li><li><a href="#">æ¯”è¾ƒNLUæ€§èƒ½</a></li><li><a href="#">æµ‹è¯•åŠ¨ä½œä»£ç </a></li></ul></li><li><a href="#">æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰</a><ul><li><a href="#">éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹</a></li><li><a href="#">éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨</a></li></ul></li><li><a href="#">CI / CDç®¡é“ç¤ºä¾‹</a></li></ul><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æŒç»­é›†æˆï¼ˆCIï¼‰æ˜¯ä¸€ç§ç»å¸¸åˆå¹¶ä»£ç æ›´æ”¹å¹¶åœ¨æäº¤æ›´æ”¹æ—¶è‡ªåŠ¨å¯¹å…¶è¿›è¡Œæµ‹è¯•çš„åšæ³•ã€‚è¿ç»­éƒ¨ç½²ï¼ˆCDï¼‰æ„å‘³ç€å°†é›†æˆçš„æ›´æ”¹è‡ªåŠ¨éƒ¨ç½²åˆ°ç™»å°æˆ–ç”Ÿäº§ç¯å¢ƒã€‚å®ƒä»¬ä¸€èµ·ä½¿æ‚¨å¯ä»¥å¯¹åŠ©æ‰‹è¿›è¡Œæ›´é¢‘ç¹çš„æ”¹è¿›ï¼Œå¹¶æœ‰æ•ˆåœ°æµ‹è¯•å’Œéƒ¨ç½²è¿™äº›æ›´æ”¹ã€‚</p><p>æœ¬æŒ‡å—å°†æ¶µç›–<strong>å“ªäº›</strong>åº”è¯¥åœ¨CI / CDç®¡é“ï¼Œå…·ä½“åˆ°ä¸€ä¸ªé¡¹ç›®æ‹‰èã€‚<strong>å¦‚ä½•</strong>å®ç°è¯¥ç®¡é“å–å†³äºæ‚¨ã€‚é‚£é‡Œæœ‰è®¸å¤šCI / CDå·¥å…·ï¼Œä¾‹å¦‚<a href="https://github.com/features/actions">GitHub Actions</a>ï¼Œ <a href="https://docs.gitlab.com/ee/ci/">GitLab CI / CD</a>ï¼Œ<a href="https://jenkins.io/doc/">Jenkins</a>å’Œ <a href="https://circleci.com/docs/2.0/">CircleCI</a>ã€‚æˆ‘ä»¬å»ºè®®é€‰æ‹©ä¸æ‚¨ä½¿ç”¨çš„ä»»ä½•Gitå­˜å‚¨åº“é›†æˆçš„å·¥å…·ã€‚</p><h2 id="æŒç»­é›†æˆï¼ˆCIï¼‰"><a href="#æŒç»­é›†æˆï¼ˆCIï¼‰" class="headerlink" title="æŒç»­é›†æˆï¼ˆCIï¼‰"></a>æŒç»­é›†æˆï¼ˆCIï¼‰</h2><p>æ”¹å–„åŠ©æ‰‹çš„æœ€ä½³æ–¹æ³•æ˜¯é¢‘ç¹è¿›è¡Œ<a href="https://rasa.com/docs/rasa-x/user-guide/fix-problems">å¢é‡æ›´æ–°</a>ã€‚æ— è®ºå˜åŒ–æœ‰å¤šå°ï¼Œæ‚¨éƒ½å¸Œæœ›ç¡®ä¿å®ƒä¸ä¼šå¸¦æ¥æ–°çš„é—®é¢˜æˆ–å¯¹åŠ©æ‰‹çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p><p>é€šå¸¸æœ€å¥½å¯¹åˆå¹¶/æå–è¯·æ±‚æˆ–æäº¤è¿è¡ŒCIæ£€æŸ¥ã€‚å¤§å¤šæ•°æµ‹è¯•è¶³å¤Ÿå¿«ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ›´æ”¹æ—¶è¿è¡Œã€‚ä½†æ˜¯ï¼Œä»…å½“æŸäº›æ–‡ä»¶å·²æ›´æ”¹æˆ–å­˜åœ¨æŸäº›å…¶ä»–æŒ‡ç¤ºç¬¦æ—¶ï¼Œæ‚¨æ‰å¯ä»¥é€‰æ‹©è¿è¡Œæ›´å¤šçš„èµ„æºå¯†é›†å‹æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ä»£ç æ‰˜ç®¡åœ¨Githubä¸Šï¼Œåˆ™åªæœ‰åœ¨æ‹‰å–è¯·æ±‚å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œæ‚¨æ‰èƒ½è¿›è¡Œæµ‹è¯•è¿è¡Œï¼ˆä¾‹å¦‚â€œéœ€è¦NLUæµ‹è¯•â€ï¼‰ã€‚</p><ul><li><a href="#">éªŒè¯æ•°æ®å’Œstories</a></li><li><a href="#">è®­ç»ƒæ¨¡å‹</a></li><li><a href="#">æµ‹è¯•åŠ©æ‰‹</a></li><li><a href="#">æ¯”è¾ƒNLUæ€§èƒ½</a></li><li><a href="#">æµ‹è¯•åŠ¨ä½œä»£ç </a></li></ul><h3 id="éªŒè¯æ•°æ®å’Œæ¡ˆä¾‹"><a href="#éªŒè¯æ•°æ®å’Œæ¡ˆä¾‹" class="headerlink" title="éªŒè¯æ•°æ®å’Œæ¡ˆä¾‹"></a>éªŒè¯æ•°æ®å’Œæ¡ˆä¾‹</h3><p><a href="#">æ•°æ®éªŒè¯</a>å¯éªŒè¯åŸŸæ–‡ä»¶ï¼ŒNLUæ•°æ®æˆ–æ•…äº‹æ•°æ®ä¸­æ˜¯å¦æ²¡æœ‰é”™è¯¯æˆ–é‡å¤§ä¸ä¸€è‡´ã€‚</p><pre><code>rasa data validate --fail-on-warnings --max-history &lt;max_history&gt;</code></pre><p>å¦‚æœæ•°æ®éªŒè¯å¯¼è‡´é”™è¯¯ï¼Œåˆ™è®­ç»ƒæ¨¡å‹ä¹Ÿå°†å¤±è´¥ã€‚é€šè¿‡åŒ…å«è¯¥<code>--fail-on-warnings</code>æ ‡å¿—ï¼ŒéªŒè¯ä¹Ÿå°†åœ¨ä¸ä¼šå‡ºç°é—®é¢˜çš„è­¦å‘Šä¸Šå¤±è´¥ï¼Œè¿™äº›é—®é¢˜ä¸ä¼šé˜»æ­¢è®­ç»ƒæ¨¡å‹ï¼Œä½†å¯èƒ½æŒ‡ç¤ºæ··ä¹±çš„æ•°æ®ï¼Œä¾‹å¦‚åŸŸä¸­åˆ—å‡ºçš„æœªåœ¨ä»»ä½•æ•…äº‹ä¸­ä½¿ç”¨çš„æ“ä½œã€‚</p><p>æ•°æ®éªŒè¯åŒ…æ‹¬<a href="#">æ•…äº‹ç»“æ„éªŒè¯</a>ã€‚æ•…äº‹éªŒè¯æ£€æŸ¥æ‚¨æ˜¯å¦æœ‰ä»»ä½•æ•…äº‹ï¼Œå…¶ä¸­ç›¸åŒçš„å¯¹è¯å†å²è®°å½•ä¸­ä¼šå‡ºç°ä¸åŒçš„æœºå™¨äººæ“ä½œã€‚æ•…äº‹ä¹‹é—´çš„å†²çªå°†é˜»æ­¢æ¨¡å‹å­¦ä¹ æ­£ç¡®çš„å¯¹è¯æ¨¡å¼ã€‚å°†<code>--max-history</code>å‚æ•°è®¾ç½®<code>max_history</code>ä¸ºä¸­çš„å¤‡æ³¨ç­–ç•¥çš„å€¼<code>config.yml</code>ã€‚å¦‚æœå°šæœªè®¾ç½®ï¼Œè¯·ä½¿ç”¨é»˜è®¤å€¼<code>5</code>ã€‚</p><h3 id="ç«è½¦æ¨¡å‹"><a href="#ç«è½¦æ¨¡å‹" class="headerlink" title="ç«è½¦æ¨¡å‹"></a>ç«è½¦æ¨¡å‹</h3><pre><code>rasa train</code></pre><p>è®­ç»ƒæ¨¡å‹å¯éªŒè¯æ‚¨çš„NLUç®¡é“å’Œç­–ç•¥é…ç½®æœ‰æ•ˆä¸”å¯è®­ç»ƒï¼Œå¹¶ä¸”æä¾›äº†ç”¨äºæµ‹è¯•å¯¹è¯çš„æ¨¡å‹ã€‚å¦‚æœå®ƒé€šè¿‡äº†CIæµ‹è¯•ï¼Œé‚£ä¹ˆ ä½œä¸ºæŒç»­éƒ¨ç½²è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨è¿˜<a href="#">å¯ä»¥å°†ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ä¸Šä¼ </a>åˆ°æœåŠ¡å™¨ã€‚</p><h3 id="æµ‹è¯•åŠ©æ‰‹"><a href="#æµ‹è¯•åŠ©æ‰‹" class="headerlink" title="æµ‹è¯•åŠ©æ‰‹"></a>æµ‹è¯•åŠ©æ‰‹</h3><p>åœ¨<a href="#">æµ‹è¯•å¯¹è¯ä¸­</a>æµ‹è¯•è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹æ˜¯å¯¹åŠ©æ‰‹åœ¨æŸäº›æƒ…å†µä¸‹çš„è¡Œä¸ºæœ‰ä¿¡å¿ƒçš„æœ€ä½³æ–¹æ³•ã€‚è¿™äº›ä»¥ä¿®æ”¹åçš„æ•…äº‹æ ¼å¼ç¼–å†™çš„æ•…äº‹ï¼Œä½¿æ‚¨å¯ä»¥æä¾›æ•´ä¸ªå¯¹è¯ï¼Œå¹¶æµ‹è¯•åœ¨ç»™å‡ºæ­¤ç”¨æˆ·è¾“å…¥çš„æƒ…å†µä¸‹æ‚¨çš„æ¨¡å‹å°†ä»¥é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚å½“æ‚¨å¼€å§‹ä»ç”¨æˆ·å¯¹è¯ä¸­ä»‹ç»æ›´å¤æ‚çš„æ•…äº‹æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚</p><pre><code>rasa test --stories tests/conversation_tests.md --fail-on-prediction-errors</code></pre><p>è¯¥<code>--fail-on-prediction-errors</code>æ ‡å¿—ç¡®ä¿å¦‚æœä»»ä½•æµ‹è¯•å¯¹è¯å¤±è´¥ï¼Œåˆ™æµ‹è¯•å°†å¤±è´¥ã€‚</p><p>ç«¯åˆ°ç«¯æµ‹è¯•ä»…ä¸æ‚¨æ‰€åŒ…æ‹¬çš„æµ‹è¯•ç”¨ä¾‹ä¸€æ ·é€å½»å’Œå‡†ç¡®ï¼Œå› æ­¤ï¼Œåœ¨å¯¹åŠ©æ‰‹è¿›è¡Œæ”¹è¿›æ—¶ï¼Œåº”ç»§ç»­å¢åŠ æµ‹è¯•å¯¹è¯é›†ã€‚éµå¾ªçš„ä¸€ä¸ªå¾ˆå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œæ‚¨åº”è¯¥ä»¥æµ‹è¯•å¯¹è¯ä¸ºç›®æ ‡ï¼Œä»¥ä»£è¡¨çœŸå®å¯¹è¯çš„çœŸå®åˆ†å¸ƒã€‚Rasa Xä½¿å¾—<a href="#">åŸºäºçœŸå®å¯¹è¯æ·»åŠ æµ‹è¯•å¯¹è¯</a>å˜å¾—å®¹æ˜“ã€‚</p><p>æ³¨ï¼šç»ˆç«¯åˆ°ç»ˆç«¯çš„æµ‹è¯•å¹¶<strong>æ²¡æœ‰</strong>æ‰§è¡Œä½ çš„æ“ä½œä»£ç ã€‚æ‚¨å°†éœ€è¦ åœ¨å•ç‹¬çš„æ­¥éª¤ä¸­<a href="#">æµ‹è¯•æ“ä½œä»£ç </a>ã€‚</p><h3 id="æ¯”è¾ƒNLUæ€§èƒ½"><a href="#æ¯”è¾ƒNLUæ€§èƒ½" class="headerlink" title="æ¯”è¾ƒNLUæ€§èƒ½"></a>æ¯”è¾ƒNLUæ€§èƒ½</h3><p>å¦‚æœæ‚¨å¯¹NLUè®­ç»ƒæ•°æ®è¿›è¡Œäº†é‡å¤§æ›´æ”¹ï¼ˆä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªæ„å›¾åˆ†ä¸ºä¸¤ä¸ªæ„å›¾æˆ–æ·»åŠ äº†å¾ˆå¤šè®­ç»ƒç¤ºä¾‹ï¼‰ï¼Œåˆ™åº”è¿è¡Œ <a href="#">å®Œæ•´çš„NLUè¯„ä¼°</a>ã€‚æ‚¨å°†éœ€è¦æ¯”è¾ƒæ²¡æœ‰æ›´æ”¹çš„NLUæ¨¡å‹çš„æ€§èƒ½ä¸æ›´æ”¹ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨äº¤å‰éªŒè¯æ¨¡å¼ä¸‹è¿è¡ŒNLUæµ‹è¯•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><pre><code>rasa test nlu --cross-validation</code></pre><p>æ‚¨è¿˜å¯ä»¥åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹å¹¶åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œæµ‹è¯•ã€‚å¦‚æœæ‚¨ä½¿ç”¨è®­ç»ƒæµ‹è¯•é›†æ–¹æ³•ï¼Œåˆ™æœ€å¥½ä½¿ç”¨æ­¤CIæ­¥éª¤çš„ä¸€éƒ¨åˆ†å¯¹<a href="#">æ•°æ®</a>è¿›è¡Œ<a href="#">æ”¹ç»„å’Œæ‹†åˆ†</a>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é™æ€NLUæµ‹è¯•é›†ï¼Œå› ä¸ºåè€…å¾ˆå®¹æ˜“è¿‡æ—¶ã€‚<code>rasa data split</code></p><p>å› ä¸ºæ­¤æµ‹è¯•ä¸ä¼šå¯¼è‡´é€šè¿‡/å¤±è´¥é€€å‡ºä»£ç ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç»“æœå¯è§ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è§£é‡Šå®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œ<a href="#">æ­¤å·¥ä½œæµç¨‹</a> åŒ…æ‹¬ä½¿ç”¨ç»“æœè¡¨æ³¨é‡ŠPRï¼Œè¯¥ç»“æœè¡¨æ˜¾ç¤ºå“ªäº›æ„å›¾ä¸å…¶ä»–æ„å›¾æ··æ·†ã€‚</p><p>ç”±äºNLUæ¯”è¾ƒå¯èƒ½æ˜¯ç›¸å½“è€—è´¹èµ„æºçš„æµ‹è¯•ï¼Œå› æ­¤æ‚¨å¯ä»¥é€‰æ‹©ä»…åœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æ‰è¿è¡Œæ­¤æµ‹è¯•ã€‚æ¡ä»¶å¯èƒ½åŒ…æ‹¬å­˜åœ¨æ‰‹åŠ¨æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼Œâ€œéœ€è¦è¿›è¡ŒNLUæµ‹è¯•â€ï¼‰ï¼Œå¯¹NLUæ•°æ®çš„æ›´æ”¹æˆ–å¯¹NLUç®¡é“çš„æ›´æ”¹ã€‚</p><h3 id="æµ‹è¯•æ“ä½œä»£ç "><a href="#æµ‹è¯•æ“ä½œä»£ç " class="headerlink" title="æµ‹è¯•æ“ä½œä»£ç "></a>æµ‹è¯•æ“ä½œä»£ç </h3><p>ç”¨äºæµ‹è¯•æ‚¨çš„åŠ¨ä½œä»£ç çš„æ–¹æ³•å°†å–å†³äºå…¶å®ç°æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿æ¥åˆ°å¤–éƒ¨APIï¼Œå»ºè®®ç¼–å†™å•å…ƒæµ‹è¯•ä»¥ç¡®ä¿è¿™äº›APIå¯¹å¸¸è§è¾“å…¥çš„å“åº”è¾¾åˆ°é¢„æœŸã€‚æ— è®ºæ‚¨æµ‹è¯•åŠ¨ä½œä»£ç å¦‚ä½•ï¼Œéƒ½åº”å°†è¿™äº›æµ‹è¯•åŒ…æ‹¬åœ¨CIç®¡é“ä¸­ï¼Œä»¥ä¾¿æ¯æ¬¡è¿›è¡Œæ›´æ”¹æ—¶éƒ½å¯ä»¥è¿è¡Œã€‚</p><h2 id="æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰"><a href="#æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰" class="headerlink" title="æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰"></a>æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰</h2><p>ä¸ºäº†ç»å¸¸å‘ç”¨æˆ·æä¾›æ”¹è¿›ï¼Œæ‚¨å°†éœ€è¦å°½å¯èƒ½å¤šçš„è‡ªåŠ¨åŒ–éƒ¨ç½²è¿‡ç¨‹ã€‚</p><p>ä¸€æ—¦CIæ£€æŸ¥æˆåŠŸï¼ŒCDæ­¥éª¤é€šå¸¸åœ¨æ¨é€æˆ–åˆå¹¶åˆ°æŸä¸ªåˆ†æ”¯ä¸Šè¿è¡Œã€‚</p><ul><li><a href="#">éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹</a></li><li><a href="#">éƒ¨ç½²åŠ¨ä½œæœåŠ¡å™¨</a></li></ul><h3 id="éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹"><a href="#éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹" class="headerlink" title="éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹"></a>éƒ¨ç½²æ‚¨çš„Rasaæ¨¡å‹</h3><p>å¦‚æœæ‚¨åœ¨CIç®¡é“ä¸­è¿è¡Œ<a href="#">ç«¯åˆ°ç«¯æµ‹è¯•</a>ï¼Œé‚£ä¹ˆæ‚¨å°†å·²ç»æ‹¥æœ‰è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹ã€‚å¦‚æœCIç»“æœä»¤äººæ»¡æ„ï¼Œæ‚¨å¯ä»¥è®¾ç½®CDç®¡é“ä»¥å°†è®­ç»ƒå¥½çš„æ¨¡å‹ä¸Šä¼ åˆ°RasaæœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œè¦å°†æ¨¡å‹ä¸Šä¼ åˆ°Rasa Xï¼š</p><pre><code>curl -k -F "model=@models/my_model.tar.gz" "https://example.rasa.com/api/projects/default/models?api_token=&amp;#123;your_api_token&amp;#125;"</code></pre><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Rasa Xï¼Œè¿˜å¯ä»¥<a href="#">å°†ä¸Šè½½çš„æ¨¡å‹æ ‡è®°</a> ä¸º<code>active</code>ï¼ˆå¦‚æœä½¿ç”¨å¤šä¸ª<a href="#">éƒ¨ç½²ç¯å¢ƒ</a>ï¼Œåˆ™å¯ä»¥<a href="#">æ ‡è®°</a>ä¸ºå“ªä¸ªéƒ¨ç½²ï¼‰ï¼š</p><pre><code>curl -X PUT "https://example.rasa.com/api/projects/default/models/my_model/tags/active"</code></pre><p>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„æ›´æ–°åŒ…æ‹¬æ›´æ”¹åˆ°è¿™ä¸¤ä¸ªæ¨¡å‹å’Œä½ çš„æ“ä½œä»£ç ï¼Œè€Œè¿™äº›å˜åŒ–ä»¥ä»»ä½•æ–¹å¼ä¾èµ–äºå¯¹æ–¹ï¼Œä½ åº”è¯¥<strong>ä¸ä¼š</strong> è‡ªåŠ¨æ ‡è®°æ¨¡å‹<code>production</code>ã€‚é¦–å…ˆï¼Œæ‚¨å°†éœ€è¦æ„å»ºå’Œéƒ¨ç½²æ›´æ–°çš„åŠ¨ä½œæœåŠ¡å™¨ï¼Œä»¥ä¾¿æ–°æ¨¡å‹ä¸ä¼šï¼ˆä¾‹å¦‚ï¼‰è°ƒç”¨æ›´æ–°å‰åŠ¨ä½œæœåŠ¡å™¨ä¸­ä¸å­˜åœ¨çš„åŠ¨ä½œã€‚</p><h3 id="éƒ¨ç½²æ“ä½œæœåŠ¡å™¨"><a href="#éƒ¨ç½²æ“ä½œæœåŠ¡å™¨" class="headerlink" title="éƒ¨ç½²æ“ä½œæœåŠ¡å™¨"></a>éƒ¨ç½²æ“ä½œæœåŠ¡å™¨</h3><p>æ‚¨å¯ä»¥è‡ªåŠ¨ <a href="#">æ„å»ºåŠ¨ä½œæœåŠ¡å™¨çš„æ–°æ˜ åƒå¹¶å°†å…¶ä¸Šä¼ </a>åˆ°æ˜ åƒå­˜å‚¨åº“ï¼Œä»¥æ›´æ–°åŠ¨ä½œä»£ç ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œå¦‚æœåŠ¨ä½œæœåŠ¡å™¨ä¸å½“å‰ç”Ÿäº§æ¨¡å‹ä¸å…¼å®¹ï¼Œåˆ™åœ¨å°†æ–°çš„å›¾åƒæ ‡ç­¾è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æ—¶åº”æ ¼å¤–å°å¿ƒã€‚</p><h2 id="CI-CDç®¡é“ç¤ºä¾‹"><a href="#CI-CDç®¡é“ç¤ºä¾‹" class="headerlink" title="CI / CDç®¡é“ç¤ºä¾‹"></a>CI / CDç®¡é“ç¤ºä¾‹</h2><p>ä½œä¸ºç¤ºä¾‹ï¼Œè¯·å‚è§<a href="https://github.com/RasaHQ/rasa-demo/blob/master/.github/workflows/build_and_deploy.yml">Sara</a>çš„CI / CDç®¡é“ ï¼Œæ‚¨å¯ä»¥åœ¨Rasa Docsä¸­ä¸ä¹‹äº¤è°ˆçš„RasaåŠ©æ‰‹ä»¥åŠ <a href="https://github.com/RasaHQ/carbon-assistant/blob/master/.github/workflows/model_ci.yml">Carbon Bot</a>ã€‚ä¸¤è€…éƒ½ä½¿ç”¨<a href="https://github.com/features/actions">Github Actions</a>ä½œä¸ºCI / CDå·¥å…·ã€‚</p><p>è¿™äº›ç¤ºä¾‹åªæ˜¯ä¼—å¤šå¯èƒ½æ€§ä¸­çš„ä¸¤ä¸ªã€‚å¦‚æœæ‚¨å–œæ¬¢è®¾ç½®CI / CDï¼Œè¯·åœ¨<a href="https://forum.rasa.com/">è®ºå›</a>ä¸Šä¸Rasaç¤¾åŒºå…±äº«ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(5)</title>
      <link href="/2020/10/03/rasa-wen-dang-zhi-nan-5/"/>
      <url>/2020/10/03/rasa-wen-dang-zhi-nan-5/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ‹è¯•æ‚¨çš„åŠ©æ‰‹"><a href="#æµ‹è¯•æ‚¨çš„åŠ©æ‰‹" class="headerlink" title="æµ‹è¯•æ‚¨çš„åŠ©æ‰‹"></a>æµ‹è¯•æ‚¨çš„åŠ©æ‰‹</h1><ul><li><a href="#">ç«¯åˆ°ç«¯æµ‹è¯•</a></li><li><a href="#">è¯„ä¼°NLUæ¨¡å‹</a><ul><li><a href="#">æ¯”è¾ƒNLUç®¡é“</a></li><li><a href="#">æ„å›¾åˆ†ç±»</a></li><li><a href="#">å“åº”é€‰æ‹©</a></li><li><a href="#">å®ä½“æå–</a></li><li><a href="#">å®ä½“è®¡åˆ†</a></li></ul></li><li><a href="#">è¯„ä¼°æ ¸å¿ƒæ¨¡å‹</a></li><li><a href="#">æ¯”è¾ƒæ ¸å¿ƒé…ç½®</a></li></ul><blockquote><p>æ³¨æ„</p><p>å¦‚æœæ‚¨æƒ³è°ƒæ•´NLUæ¨¡å‹çš„è¶…å‚æ•°ï¼Œè¯·æŸ¥çœ‹æœ¬<a href="#">æ•™ç¨‹</a>ã€‚</p></blockquote><h2 id="ç«¯åˆ°ç«¯æµ‹è¯•"><a href="#ç«¯åˆ°ç«¯æµ‹è¯•" class="headerlink" title="ç«¯åˆ°ç«¯æµ‹è¯•"></a>ç«¯åˆ°ç«¯æµ‹è¯•</h2><p>Rasa Open Sourceä½¿æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œæµ‹è¯•å¯¹è¯å¹¶ç¡®ä¿NLUå’ŒCoreåšå‡ºæ­£ç¡®çš„é¢„æµ‹æ¥ç«¯å¯¹ç«¯åœ°æµ‹è¯•å¯¹è¯ã€‚</p><p>ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä¸€äº›ç«¯åˆ°ç«¯æ ¼å¼çš„æ•…äº‹ï¼Œå…¶ä¸­åŒ…æ‹¬NLUè¾“å‡ºå’ŒåŸå§‹æ–‡æœ¬ã€‚è¿™é‡Œæœ‰äº›ä¾‹å­ï¼š</p><pre><code>åŸºæœ¬## A basic end-to-end test* greet: hello   - utter_ask_howcanhelp* inform: show me [chinese](cuisine) restaurants   - utter_ask_location* inform: in [Paris](location)   - utter_ask_price   è‡ªå®šä¹‰åŠ¨ä½œ   ## End-to-End tests where a custom action appends events* greet: hi    - my_custom_action    &lt;!-- The following events are emitted by `my_custom_action` --&gt;    - slot&amp;#123;"my_slot": "value added by custom action"&amp;#125;    - utter_ask_age* thankyou: thanks    - utter_noworriesForms Happy Path    ## Testing a conversation with a form* greet: hi    - utter_greet* request_restaurant: im looking for a restaurant    - restaurant_form    - form&amp;#123;"name": "restaurant_form"&amp;#125;* inform: [afghan](cuisine) food    - form: restaurant_form    - form&amp;#123;"name": null&amp;#125;    - utter_slots_values* thankyou: thanks    - utter_noworries    Forms Unhappy Path    ## Testing a conversation with a form and unexpected user input* greet: hi    - utter_greet* request_restaurant: im looking for a restaurant    - restaurant_form    - form&amp;#123;"name": "restaurant_form"&amp;#125;&lt;!-- The user sends a message which should not be handled by the form. --&gt;* chitchat: can you share your boss with me?    - utter_chitchat    - restaurant_form    - form&amp;#123;"name": null&amp;#125;    - utter_slots_values* thankyou: thanks    - utter_noworries</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRasa Open Sourceå°†ä¼šè¯æµ‹è¯•ä¿å­˜åˆ°<code>tests/conversation_tests.md</code>ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯¹æ‚¨çš„åŠ©æ‰‹è¿›è¡Œæµ‹è¯•ï¼š</p><pre><code>rasa test</code></pre><blockquote><p>æ³¨æ„</p><p><a href="#">è‡ªå®šä¹‰æ“ä½œ</a>ä¸ä¼šä½œä¸ºç«¯åˆ°ç«¯æµ‹è¯•çš„ä¸€éƒ¨åˆ†æ‰§è¡Œã€‚å¦‚æœæ‚¨çš„è‡ªå®šä¹‰æ“ä½œå°†ä»»ä½•äº‹ä»¶é™„åŠ åˆ°è·Ÿè¸ªå™¨ï¼Œåˆ™å¿…é¡»åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¸­åæ˜ å‡ºæ¥ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡å°†<code>slot</code>äº‹ä»¶æ·»åŠ åˆ°ç«¯åˆ°ç«¯æ•…äº‹ä¸­ï¼‰ã€‚</p></blockquote><p>å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜ï¼Œè¯·<a href="#">åœ¨æˆ‘ä»¬è®ºå›</a>çš„ä¸“ç”¨<a href="#">æµ‹è¯•éƒ¨åˆ†</a>ä¸æˆ‘ä»¬åˆ†äº« ï¼</p><blockquote><p>æ³¨æ„</p><p>è¯·åœ¨ç¡®ä¿æ‚¨çš„æ¨¡å‹æ–‡ä»¶<code>models</code>çš„ç»„åˆ<code>core</code> å’Œ<code>nlu</code>å‹å·ã€‚å¦‚æœä¸åŒ…å«NLUæ¨¡å‹ï¼Œåˆ™Coreå°†ä½¿ç”¨default <code>RegexInterpreter</code>ã€‚</p></blockquote><h2 id="è¯„ä¼°ä¸€ä¸ªNLUæ¨¡å‹"><a href="#è¯„ä¼°ä¸€ä¸ªNLUæ¨¡å‹" class="headerlink" title="è¯„ä¼°ä¸€ä¸ªNLUæ¨¡å‹"></a>è¯„ä¼°ä¸€ä¸ªNLUæ¨¡å‹</h2><p>æœºå™¨å­¦ä¹ çš„æ ‡å‡†æŠ€æœ¯æ˜¯å°†ä¸€äº›æ•°æ®åˆ†å¼€ä½œä¸º<em>æµ‹è¯•é›†</em>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•<a href="#">å°†NLUè®­ç»ƒæ•°æ®</a> åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š</p><pre><code>rasa data split nlu</code></pre><p>å¦‚æœå®Œæˆäº†æ­¤æ“ä½œï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹NLUæ¨¡å‹å¯¹æµ‹è¯•ç”¨ä¾‹çš„é¢„æµ‹ç¨‹åº¦ï¼š</p><pre><code>rasa test nlu -u train_test_split/test_data.md --model models/nlu-20180323-145833.tar.gz</code></pre><p>å¦‚æœæ‚¨ä¸æƒ³åˆ›å»ºå•ç‹¬çš„æµ‹è¯•é›†ï¼Œåˆ™ä»å¯ä»¥ä½¿ç”¨äº¤å‰éªŒè¯æ¥ä¼°è®¡æ¨¡å‹çš„æ¦‚æ‹¬ç¨‹åº¦ã€‚ä¸ºæ­¤ï¼Œæ·»åŠ æ ‡å¿—<code>--cross-validation</code>ï¼š</p><pre><code>rasa test nlu -u data/nlu.md --config config.yml --cross-validation</code></pre><p>è„šæœ¬é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ä¸ºï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa test nlu [-h] [-v] [-vv] [--quiet] [-m MODEL] [-u NLU] [--out OUT]                     [--successes] [--no-errors] [--histogram HISTOGRAM]                     [--confmat CONFMAT] [-c CONFIG [CONFIG ...]]                     [--cross-validation] [-f FOLDS] [-r RUNS]                     [-p PERCENTAGES [PERCENTAGES ...]] [--no-plot]optional arguments:  -h, --help            show this help message and exit  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: models)  -u NLU, --nlu NLU     File or folder containing your NLU data. (default:                        data)  --out OUT             Output path for any files created during the                        evaluation. (default: results)  --successes           If set successful predictions (intent and entities)                        will be written to a file. (default: False)  --no-errors           If set incorrect predictions (intent and entities)                        will NOT be written to a file. (default: False)  --histogram HISTOGRAM                        Output path for the confidence histogram. (default:                        hist.png)  --confmat CONFMAT     Output path for the confusion matrix plot. (default:                        confmat.png)  -c CONFIG [CONFIG ...], --config CONFIG [CONFIG ...]                        Model configuration file. If a single file is passed                        and cross validation mode is chosen, cross-validation                        is performed, if multiple configs or a folder of                        configs are passed, models will be trained and                        compared directly. (default: None)  --no-plot             Don't render evaluation plots (default: False)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Cross Validation:  --cross-validation    Switch on cross validation mode. Any provided model                        will be ignored. (default: False)  -f FOLDS, --folds FOLDS                        Number of cross validation folds (cross validation                        only). (default: 5)Comparison Mode:  -r RUNS, --runs RUNS  Number of comparison runs to make. (default: 3)  -p PERCENTAGES [PERCENTAGES ...], --percentages PERCENTAGES [PERCENTAGES ...]                        Percentages of training data to exclude during                        comparison. (default: [0, 25, 50, 75])</code></pre><h3 id="æ¯”è¾ƒNLUç®¡é“"><a href="#æ¯”è¾ƒNLUç®¡é“" class="headerlink" title="æ¯”è¾ƒNLUç®¡é“"></a>æ¯”è¾ƒNLUç®¡é“</h3><p>é€šè¿‡å°†å¤šä¸ªç®¡é“é…ç½®ï¼ˆæˆ–åŒ…å«å®ƒä»¬çš„æ–‡ä»¶å¤¹ï¼‰ä¼ é€’åˆ°CLIï¼ŒRasaå°†åœ¨ç®¡é“ä¹‹é—´è¿›è¡Œæ¯”è¾ƒæ£€æŸ¥ã€‚</p><pre class=" language-yaml"><code class="language-yaml"> rasa test nlu <span class="token punctuation">-</span><span class="token punctuation">-</span>config pretrained_embeddings_spacy.yml supervised_embeddings.yml  <span class="token punctuation">-</span><span class="token punctuation">-</span>nlu data/nlu.md <span class="token punctuation">-</span><span class="token punctuation">-</span>runs 3 <span class="token punctuation">-</span><span class="token punctuation">-</span>percentages 0 25 50 70 90</code></pre><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„å‘½ä»¤å°†æ ¹æ®æ‚¨çš„æ•°æ®åˆ›å»ºè®­ç»ƒ/æµ‹è¯•æ‹†åˆ†ï¼Œç„¶åä½¿ç”¨è®­ç»ƒé›†ä¸­æ’é™¤çš„æ„å›¾æ•°æ®çš„0ï¼…ï¼Œ25ï¼…ï¼Œ50ï¼…ï¼Œ70ï¼…å’Œ90ï¼…å¤šæ¬¡è®­ç»ƒæ¯ä¸ªç®¡é“ã€‚ç„¶ååœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹ï¼Œå¹¶è®°å½•æ¯ä¸ªæ’é™¤ç™¾åˆ†æ¯”çš„f1å¾—åˆ†ã€‚æ­¤è¿‡ç¨‹è¿è¡Œäº†3æ¬¡ï¼ˆå³æ€»å…±æœ‰3ä¸ªæµ‹è¯•é›†ï¼‰ï¼Œç„¶åä½¿ç”¨f1å¾—åˆ†çš„å¹³å‡å€¼å’Œæ ‡å‡†åå·®ç»˜åˆ¶äº†å›¾è¡¨ã€‚</p><p>f1å¾—åˆ†å›¾ä»¥åŠæ‰€æœ‰è®­ç»ƒ/æµ‹è¯•é›†ï¼Œè®­ç»ƒæœ‰ç´ çš„æ¨¡å‹ï¼Œåˆ†ç±»å’Œé”™è¯¯æŠ¥å‘Šå°†ä¿å­˜åˆ°åä¸ºçš„æ–‡ä»¶å¤¹ä¸­<code>nlu_comparison_results</code>ã€‚</p><h3 id="æ„å‘åˆ†ç±»"><a href="#æ„å‘åˆ†ç±»" class="headerlink" title="æ„å‘åˆ†ç±»"></a>æ„å‘åˆ†ç±»</h3><p>è¯„ä¼°è„šæœ¬å°†ä¸ºæ‚¨çš„æ¨¡å‹ç”ŸæˆæŠ¥å‘Šï¼Œæ··æ·†çŸ©é˜µå’Œç½®ä¿¡åº¦ç›´æ–¹å›¾ã€‚</p><p>è¯¥æŠ¥å‘Šè®°å½•æ¯ä¸ªæ„å›¾å’Œå®ä½“çš„ç²¾åº¦ï¼Œå¬å›ç‡å’Œf1åº¦é‡ï¼Œå¹¶æä¾›æ€»ä½“å¹³å‡å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>--report</code>å‚æ•°å°†è¿™äº›æŠ¥å‘Šå¦å­˜ä¸ºJSONæ–‡ä»¶ã€‚</p><p>æ··æ·†çŸ©é˜µå‘æ‚¨æ˜¾ç¤ºå“ªäº›æ„å›¾è¢«è¯¯è®¤ä¸ºå…¶ä»–æ„å›¾ï¼›ä»»ä½•è¢«é”™è¯¯é¢„æµ‹çš„æ ·æœ¬éƒ½ä¼šè¢«è®°å½•å¹¶ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­<code>errors.json</code>ï¼Œä»¥ä¾¿äºè°ƒè¯•ã€‚</p><p>è„šæœ¬ç”Ÿæˆçš„ç›´æ–¹å›¾ä½¿æ‚¨å¯ä»¥å¯è§†åŒ–æ‰€æœ‰é¢„æµ‹çš„ç½®ä¿¡åº¦åˆ†å¸ƒï¼Œæ­£ç¡®å’Œä¸æ­£ç¡®çš„é¢„æµ‹é‡åˆ†åˆ«ç”±è“è‰²å’Œçº¢è‰²æ¡æ˜¾ç¤ºã€‚æé«˜è®­ç»ƒæ•°æ®çš„è´¨é‡ä¼šå°†è“è‰²ç›´æ–¹å›¾æ¡ç§»åˆ°è¯¥å›¾çš„å³ä¾§ï¼Œå°†çº¢è‰²ç›´æ–¹å›¾æ¡ç§»è‡³è¯¥å›¾çš„å·¦ä¾§ã€‚</p><p>è­¦å‘Š</p><p>å¦‚æœæ‚¨çš„ä»»ä½•å®ä½“æ³¨é‡Šä¸æ­£ç¡®ï¼Œåˆ™è¯„ä¼°å¯èƒ½ä¼šå¤±è´¥ã€‚ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯å®ä½“æ— æ³•åœ¨ä»¤ç‰Œå†…éƒ¨åœæ­¢æˆ–å¯åŠ¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ª<code>name</code>ç±»ä¼¼çš„å®ä½“çš„ç¤ºä¾‹ï¼Œåˆ™ä»…åœ¨æ‚¨çš„ä»¤ç‰Œç”Ÿæˆå™¨æ‹†åˆ†ä¸ºå¤šä¸ªä»¤ç‰Œæ—¶æ‰æœ‰æ•ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç©ºç™½æ ‡è®°å™¨å°†ä¸èµ·ä½œç”¨ã€‚<code>[Brian](name)'s house``Brian's</code></p><h3 id="å“åº”é€‰æ‹©"><a href="#å“åº”é€‰æ‹©" class="headerlink" title="å“åº”é€‰æ‹©"></a>å“åº”é€‰æ‹©</h3><p>è¯„ä¼°è„šæœ¬å°†ä¸ºç®¡é“ä¸­çš„æ‰€æœ‰å“åº”é€‰æ‹©å™¨æ¨¡å‹ç”Ÿæˆç»„åˆæŠ¥å‘Šã€‚</p><p>è¯¥æŠ¥å‘Šè®°å½•æ¯ä¸ªå“åº”çš„ç²¾åº¦ï¼Œå¬å›ç‡å’Œf1åº¦é‡ï¼Œå¹¶æä¾›æ€»ä½“å¹³å‡å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>--report</code>å‚æ•°å°†è¿™äº›æŠ¥å‘Šå¦å­˜ä¸ºJSONæ–‡ä»¶ã€‚</p><h3 id="å®ä½“æå–"><a href="#å®ä½“æå–" class="headerlink" title="å®ä½“æå–"></a>å®ä½“æå–</h3><p>ï¼Œè¿™<code>CRFEntityExtractor</code>æ˜¯æ‚¨ä½¿ç”¨è‡ªå·±çš„æ•°æ®è®­ç»ƒçš„å”¯ä¸€å®ä½“æå–å™¨ï¼Œå› æ­¤ä¹Ÿæ˜¯å”¯ä¸€è¦è¯„ä¼°çš„å®ä½“æå–å™¨ã€‚å¦‚æœæ‚¨ä½¿ç”¨spaCyæˆ–å°é¸­ç»è¿‡é¢„è®­ç»ƒçš„å®ä½“æå–å™¨ï¼Œåˆ™Rasa NLUå°†ä¸ä¼šåœ¨è¯„ä¼°ä¸­åŒ…æ‹¬è¿™äº›æå–å™¨ã€‚</p><p>Rasa NLUå°†æŠ¥å‘Šå—<code>CRFEntityExtractor</code>è®­ç»ƒè¯†åˆ«çš„æ¯ç§å®ä½“ç±»å‹çš„å¬å›ç‡ï¼Œç²¾åº¦å’Œf1åº¦é‡ ã€‚</p><h3 id="å®ä½“è®¡åˆ†"><a href="#å®ä½“è®¡åˆ†" class="headerlink" title="å®ä½“è®¡åˆ†"></a>å®ä½“è®¡åˆ†</h3><p>ä¸ºäº†è¯„ä¼°å®ä½“æå–ï¼Œæˆ‘ä»¬åº”ç”¨äº†ä¸€ç§åŸºäºæ ‡ç­¾çš„ç®€å•æ–¹æ³•ã€‚æˆ‘ä»¬ä¸è€ƒè™‘BILOUæ ‡ç­¾ï¼Œè€Œä»…è€ƒè™‘æ¯ä¸ªä»¤ç‰ŒåŸºç¡€ä¸Šçš„å®ä½“ç±»å‹æ ‡ç­¾ã€‚å¯¹äºåƒâ€œ Alexanderplatzé™„è¿‘â€è¿™æ ·çš„ä½ç½®å®ä½“ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æ ‡ç­¾è€Œä¸æ˜¯åŸºäºBILOUçš„æ ‡ç­¾ã€‚å¯¹äºè¯„ä¼°ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ›´ä¸ºå®½å®¹ï¼Œå› ä¸ºå®ƒå¥–åŠ±éƒ¨åˆ†æå–ï¼Œå¹¶ä¸”ä¸ä¼šæƒ©ç½šå®ä½“çš„åˆ†è£‚ã€‚ä¾‹å¦‚ï¼Œç»™å®šå‰è¿°å®ä½“â€œ Alexanderplatzé™„è¿‘â€å’Œæå–â€œ Alexanderplatzâ€çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬çš„æ–¹æ³•å°†å¥–åŠ±æå–â€œ Alexanderplatzâ€å¹¶æƒ©ç½šä¸¢å¤±çš„å•è¯â€œ nearâ€ã€‚ä½†æ˜¯ï¼ŒåŸºäºBILOUçš„æ–¹æ³•ä¼šå°†å…¶æ ‡è®°ä¸ºå®Œå…¨å¤±è´¥ï¼Œå› ä¸ºå®ƒå¸Œæœ›å°†Alexanderplatzæ ‡è®°ä¸ºå®ä½“ï¼ˆï¼‰ä¸­çš„æœ€åä¸€ä¸ªæ ‡è®°ï¼Œè€Œä¸æ˜¯å•ä¸ªæ ‡è®°å®ä½“ï¼ˆ<code>LOC LOC``B-LOC L-LOC``L-LOC``U-LOC</code>ï¼‰ã€‚è¿˜è¦æ³¨æ„ï¼Œå°†â€œ nearâ€å’Œâ€œ Alexanderplatzâ€åˆ†å¼€æå–å°†åœ¨æˆ‘ä»¬çš„æ–¹æ³•ä¸­è·å¾—æ»¡åˆ†ï¼Œè€Œåœ¨åŸºäºBILOUçš„æ–¹æ³•ä¸­è·å¾—é›¶åˆ†ã€‚</p><p>è¿™æ˜¯çŸ­è¯­â€œnear Alexanderplatz tonightâ€çš„ä¸¤ç§è¯„åˆ†æœºåˆ¶ä¹‹é—´çš„æ¯”è¾ƒï¼š</p><table><thead><tr><th align="left">extracted</th><th align="left">Simple tags (score)</th><th align="left">BILOU tags (score)</th></tr></thead><tbody><tr><td align="left"><a href="loc">near Alexanderplatz</a> <a href="time">tonight</a></td><td align="left">loc loc time (3)</td><td align="left">B-loc L-loc U-time (3)</td></tr><tr><td align="left"><a href="loc">near</a> <a href="loc">Alexanderplatz</a> <a href="time">tonight</a></td><td align="left">loc loc time (3)</td><td align="left">U-loc U-loc U-time (1)</td></tr><tr><td align="left">near <a href="loc">Alexanderplatz</a> <a href="time">tonight</a></td><td align="left">O loc time (2)</td><td align="left">O U-loc U-time (1)</td></tr><tr><td align="left"><a href="loc">near</a> Alexanderplatz <a href="time">tonight</a></td><td align="left">loc O time (2)</td><td align="left">U-loc O U-time (1)</td></tr><tr><td align="left"><a href="loc">near Alexanderplatz tonight</a></td><td align="left">loc loc loc (2)</td><td align="left">B-loc I-loc L-loc (1)</td></tr></tbody></table><h3 id="è¯„ä¼°æ ¸å¿ƒæ¨¡å‹"><a href="#è¯„ä¼°æ ¸å¿ƒæ¨¡å‹" class="headerlink" title="è¯„ä¼°æ ¸å¿ƒæ¨¡å‹"></a>è¯„ä¼°æ ¸å¿ƒæ¨¡å‹</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨è¯„ä¼°è„šæœ¬åœ¨ä¸€ç»„æµ‹è¯•æ¡ˆä¾‹ä¸­è¯„ä¼°è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹ï¼š</p><pre><code>rasa test core --stories test_stories.md --out results</code></pre><p>è¿™ä¼šå°†å¤±è´¥çš„æ•…äº‹æ‰“å°åˆ°<code>results/failed_stories.md</code>ã€‚å¦‚æœè‡³å°‘æœ‰ä¸€é¡¹è¡ŒåŠ¨è¢«é”™è¯¯åœ°é¢„æµ‹ï¼Œæˆ‘ä»¬ä¼šå°†ä»»ä½•æ•…äº‹è§†ä¸ºå¤±è´¥ã€‚</p><p>æ­¤å¤–ï¼Œè¿™ä¼šå°†æ··ä¹±çŸ©é˜µä¿å­˜åˆ°åä¸ºçš„æ–‡ä»¶ä¸­ <code>results/story_confmat.pdf</code>ã€‚å¯¹äºæ‚¨åŸŸä¸­çš„æ¯ä¸ªåŠ¨ä½œï¼Œæ··æ·†çŸ©é˜µæ˜¾ç¤ºäº†æ­£ç¡®é¢„æµ‹è¯¥åŠ¨ä½œçš„é¢‘ç‡ä»¥åŠç›¸ååœ°é¢„æµ‹äº†ä¸€ä¸ªä¸æ­£ç¡®åŠ¨ä½œçš„é¢‘ç‡ã€‚</p><p>è„šæœ¬é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ä¸ºï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa test core [-h] [-v] [-vv] [--quiet] [-m MODEL [MODEL ...]]                      [-s STORIES] [--max-stories MAX_STORIES] [--out OUT]                      [--e2e] [--endpoints ENDPOINTS]                      [--fail-on-prediction-errors] [--url URL]                      [--evaluate-model-directory] [--no-plot]optional arguments:  -h, --help            show this help message and exit  -m MODEL [MODEL ...], --model MODEL [MODEL ...]                        Path to a pre-trained model. If it is a 'tar.gz' file                        that model file will be used. If it is a directory,                        the latest model in that directory will be used                        (exception: '--evaluate-model-directory' flag is set).                        If multiple 'tar.gz' files are provided, all those                        models will be compared. (default: [None])  -s STORIES, --stories STORIES                        File or folder containing your test stories. (default:                        data)  --max-stories MAX_STORIES                        Maximum number of stories to test on. (default: None)  --out OUT             Output path for any files created during the                        evaluation. (default: results)  --e2e, --end-to-end   Run an end-to-end evaluation for combined action and                        intent prediction. Requires a story file in end-to-end                        format. (default: False)  --endpoints ENDPOINTS                        Configuration file for the connectors as a yml file.                        (default: None)  --fail-on-prediction-errors                        If a prediction error is encountered, an exception is                        thrown. This can be used to validate stories during                        tests, e.g. on travis. (default: False)  --url URL             If supplied, downloads a story file from a URL and                        trains on it. Fetches the data by sending a GET                        request to the supplied URL. (default: None)  --evaluate-model-directory                        Should be set to evaluate models trained via 'rasa                        train core --config <config-1> <config-2>'. All models                        in the provided directory are evaluated and compared                        against each other. (default: False)  --no-plot             Don't render evaluation plots (default: False)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><h3 id="æ¯”è¾ƒæ ¸å¿ƒçš„é…ç½®"><a href="#æ¯”è¾ƒæ ¸å¿ƒçš„é…ç½®" class="headerlink" title="æ¯”è¾ƒæ ¸å¿ƒçš„é…ç½®"></a>æ¯”è¾ƒæ ¸å¿ƒçš„é…ç½®</h3><p>è¦ä¸ºæ‚¨çš„æ ¸å¿ƒæ¨¡å‹é€‰æ‹©é…ç½®ï¼Œæˆ–ä¸ºç‰¹å®šç­–ç•¥é€‰æ‹©è¶…å‚æ•°ï¼Œæ‚¨æƒ³è¡¡é‡Rasa Coreå°†å…¶æ¨å¹¿ åˆ°ä»¥å‰ä»æœªè§è¿‡çš„å¯¹è¯çš„ç¨‹åº¦ã€‚ç‰¹åˆ«æ˜¯åœ¨é¡¹ç›®å¼€å§‹æ—¶ï¼Œæ‚¨æ²¡æœ‰å¤ªå¤šçœŸæ­£çš„å¯¹è¯å¯ç”¨æ¥è®­ç»ƒæ‚¨çš„æœºå™¨äººï¼Œå› æ­¤æ‚¨ä¸åªæ˜¯æƒ³æ‰”æ‰ä¸€äº›ä¸œè¥¿æ¥ç”¨ä½œæµ‹è¯•é›†ã€‚</p><p>Rasa Coreå…·æœ‰ä¸€äº›è„šæœ¬æ¥å¸®åŠ©æ‚¨é€‰æ‹©å’Œè°ƒæ•´ç­–ç•¥é…ç½®ã€‚å¯¹å®ƒæ„Ÿåˆ°æ»¡æ„åï¼Œå°±å¯ä»¥åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šè®­ç»ƒæœ€ç»ˆé…ç½®ã€‚ä¸ºæ­¤ï¼Œæ‚¨é¦–å…ˆå¿…é¡»é’ˆå¯¹ä¸åŒçš„é…ç½®è®­ç»ƒæ¨¡å‹ã€‚åˆ›å»ºä¸¤ä¸ªï¼ˆæˆ–æ›´å¤šï¼‰é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¦æ¯”è¾ƒçš„ç­–ç•¥ï¼Œç„¶åä½¿ç”¨<code>compare</code>è®­ç»ƒè„šæœ¬çš„æ¨¡å¼è®­ç»ƒæ¨¡å‹ï¼š</p><pre><code> rasa train core -c config_1.yml config_2.yml \  -d domain.yml -s stories_folder --out comparison_models --runs 3 \  --percentages 0 5 25 50 70 95</code></pre><p>å¯¹äºæä¾›çš„æ¯ç§ç­–ç•¥é…ç½®ï¼ŒRasa Coreå°†æ¥å—å¤šæ¬¡åŸ¹è®­ï¼ŒåŸ¹è®­æ•°æ®ä¸­ä¸åŒ…æ‹¬0ã€5ã€25ã€50ã€70å’Œ95ï¼…çš„åŸ¹è®­æ¡ˆä¾‹ã€‚è¿›è¡Œå¤šæ¬¡è¿è¡Œä»¥ç¡®ä¿ç»“æœä¸€è‡´ã€‚</p><p>è¯¥è„šæœ¬å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨<code>compare</code> æ¨¡å¼ä¸‹ä½¿ç”¨è¯„ä¼°è„šæœ¬æ¥è¯„ä¼°æ‚¨åˆšåˆšè®­ç»ƒçš„æ¨¡å‹ï¼š</p><pre><code>rasa test core -m comparison_models --stories stories_folder--out comparison_results --evaluate-model-directory</code></pre><p>è¿™å°†è¯„ä¼°æ‰€æä¾›æ•…äº‹ä¸­çš„æ¯ä¸ªæ¨¡å‹ï¼ˆå¯ä»¥æ˜¯è®­ç»ƒé›†ï¼Œä¹Ÿå¯ä»¥æ˜¯æµ‹è¯•é›†ï¼‰ï¼Œå¹¶ç»˜åˆ¶ä¸€äº›å›¾è¡¨ä»¥å‘æ‚¨æ˜¾ç¤ºå“ªç§ç­–ç•¥æ•ˆæœæœ€ä½³ã€‚é€šè¿‡è¯„ä¼°æ•´ä¸ªæ•…äº‹ï¼Œæ‚¨å¯ä»¥è¡¡é‡Rasa Coreå¯¹é¢„è¨€æ•…äº‹çš„é¢„æµ‹ç¨‹åº¦ã€‚</p><p>è¦æ¯”è¾ƒå•ä¸ªç­–ç•¥ï¼Œè¯·åˆ›å»ºæ¯ä¸ªä»…åŒ…å«ä¸€ä¸ªç­–ç•¥çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šè¦æ¯”è¾ƒçš„ç­–ç•¥ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨è¯•ç”¨ <code>EmbeddingPolicy</code>å’Œ<code>KerasPolicy</code>ï¼Œçœ‹çœ‹å“ªç§ç­–ç•¥æ›´é€‚åˆæ‚¨ã€‚</p><blockquote><p>æ³¨æ„</p><p>è¿™ä¸ªè®­ç»ƒè¿‡ç¨‹å¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®è®©å®ƒåœ¨ä¸ä¸­æ–­çš„åå°è¿è¡Œã€‚</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(4)</title>
      <link href="/2020/10/03/rasa-wen-dang-zhi-nan-4/"/>
      <url>/2020/10/03/rasa-wen-dang-zhi-nan-4/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¶ˆæ¯å’Œè¯­éŸ³é€šé“"><a href="#æ¶ˆæ¯å’Œè¯­éŸ³é€šé“" class="headerlink" title="æ¶ˆæ¯å’Œè¯­éŸ³é€šé“"></a>æ¶ˆæ¯å’Œè¯­éŸ³é€šé“</h1><p>è¦ä½¿æ‚¨çš„åŠ©æ‰‹åœ¨æ¶ˆæ¯ä¼ é€’å¹³å°ä¸Šå¯ç”¨ï¼Œæ‚¨éœ€è¦åœ¨<code>credentials.yml</code>æ–‡ä»¶ä¸­æä¾›å‡­æ®ã€‚è¿è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶ï¼Œå› æ­¤æœ€å®¹æ˜“ç¼–è¾‘è¯¥æ–‡ä»¶å¹¶åœ¨å…¶ä¸­æ·»åŠ å‡­æ®ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Facebookå‡­è¯çš„ç¤ºä¾‹ï¼š<code>rasa init</code></p><pre><code>facebook:  verify: "rasa-bot"  secret: "3e34709d01ea89032asdebfe5a74518"  page-access-token: "EAAbHPa7H9rEBAAuFk4Q3gPKbDedQnx4djJJ1JmQ7CAqO4iJKrQcNT0wtD"</code></pre><h2 id="ä½¿ç”¨Ngrokåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæµ‹è¯•é€šé“"><a href="#ä½¿ç”¨Ngrokåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæµ‹è¯•é€šé“" class="headerlink" title="ä½¿ç”¨Ngrokåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæµ‹è¯•é€šé“"></a>ä½¿ç”¨Ngrokåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæµ‹è¯•é€šé“</h2><p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://ngrok.com/">ngrok</a>å»ºç«‹ä¸æœ¬åœ°è®¡ç®—æœºçš„è¿æ¥ï¼Œè¯¥è¿æ¥å¯ä»¥åœ¨Internetä¸Šå…¬å¼€è·å¾—ã€‚åœ¨æœåŠ¡å™¨ä¸Šè¿è¡ŒRasaæ—¶ä¸éœ€è¦æ­¤åŠŸèƒ½ï¼Œå› ä¸ºæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ªåŸŸåæ¥æŒ‡å‘è¯¥æœåŠ¡å™¨çš„IPåœ°å€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨IPåœ°å€æœ¬èº«ã€‚</p><p>å®‰è£…ngrokä¹‹åï¼Œè¿è¡Œï¼š</p><pre class=" language-shell"><code class="language-shell">ngrok http 5005; rasa run</code></pre><p>æ‚¨çš„Webhookåœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>https://yyyyyy.ngrok.io/webhooks/&lt;CHANNEL&gt;/webhook</code>, e.g.</li><li><code>https://yyyyyy.ngrok.io/webhooks/facebook/webhook</code></li></ul><blockquote><p>è­¦å‘Š</p><p>ä½¿ç”¨ngrokçš„å…è´¹å±‚ï¼Œæ‚¨ä¼šé‡åˆ°æ¯åˆ†é’Ÿå¯ä»¥å»ºç«‹å¤šå°‘ä¸ªè¿æ¥çš„é™åˆ¶ã€‚æ’°å†™æœ¬æ–‡æ—¶ï¼Œå®ƒè®¾ç½®ä¸º40ä¸ªè¿æ¥/åˆ†é’Ÿã€‚</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(3)</title>
      <link href="/2020/10/03/rasa-wen-dang-zhi-nan-3/"/>
      <url>/2020/10/03/rasa-wen-dang-zhi-nan-3/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h1><h2 id="æ¶ˆæ¯å¤„ç†"><a href="#æ¶ˆæ¯å¤„ç†" class="headerlink" title="æ¶ˆæ¯å¤„ç†"></a>æ¶ˆæ¯å¤„ç†</h2><p>æ­¤å›¾æ˜¾ç¤ºäº†ä½¿ç”¨Rasaæ„å»ºçš„åŠ©æ‰‹å¦‚ä½•å“åº”æ¶ˆæ¯çš„åŸºæœ¬æ­¥éª¤ï¼š</p><p><img src="/2020/10/03/rasa-wen-dang-zhi-nan-3/8.png"></p><p>è¿™äº›æ­¥éª¤æ˜¯ï¼š</p><ol><li>æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯<code>Interpreter</code>å¹¶å°†å…¶ä¼ é€’ç»™ï¼Œè¯¥æ¶ˆæ¯ä¼šå°†å…¶è½¬æ¢ä¸ºå­—å…¸ï¼ŒåŒ…æ‹¬åŸå§‹æ–‡æœ¬ï¼Œæ„å›¾å’Œæ‰¾åˆ°çš„ä»»ä½•å®ä½“ã€‚è¿™éƒ¨åˆ†ç”±NLUå¤„ç†ã€‚</li><li>è¯¥<code>Tracker</code>æ˜¯è·Ÿè¸ªé€šè¯çŠ¶æ€çš„å¯¹è±¡ã€‚å®ƒæ¥æ”¶åˆ°æœ‰æ–°æ¶ˆæ¯è¿›å…¥çš„ä¿¡æ¯ã€‚</li><li>è¯¥ç­–ç•¥æ¥æ”¶è·Ÿè¸ªå™¨çš„å½“å‰çŠ¶æ€ã€‚</li><li>è¯¥ç­–ç•¥é€‰æ‹©ä¸‹ä¸€æ­¥è¦é‡‡å–çš„æªæ–½ã€‚</li><li>æ‰€é€‰åŠ¨ä½œç”±è·Ÿè¸ªå™¨è®°å½•ã€‚</li><li>å“åº”å‘é€ç»™ç”¨æˆ·ã€‚</li></ol><blockquote><p>æ³¨æ„</p><p>æ¶ˆæ¯å¯ä»¥æ˜¯äººç±»é”®å…¥çš„æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»“æ„åŒ–çš„è¾“å…¥ï¼Œä¾‹å¦‚æŒ‰ä¸‹æŒ‰é’®ã€‚</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(2)</title>
      <link href="/2020/10/03/rasa-wen-dang-zhi-nan-2/"/>
      <url>/2020/10/03/rasa-wen-dang-zhi-nan-2/</url>
      
        <content type="html"><![CDATA[<h1 id="Rasaæ–‡æ¡£æŒ‡å—"><a href="#Rasaæ–‡æ¡£æŒ‡å—" class="headerlink" title="Rasaæ–‡æ¡£æŒ‡å—"></a>Rasaæ–‡æ¡£æŒ‡å—</h1><h2 id="å‘½ä»¤è¡Œæ¥å£"><a href="#å‘½ä»¤è¡Œæ¥å£" class="headerlink" title="å‘½ä»¤è¡Œæ¥å£"></a>å‘½ä»¤è¡Œæ¥å£</h2><p><a href="#">å¤‡å¿˜å•</a></p><p><a href="#">åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</a></p><p><a href="#">è®­ç»ƒæ¨¡å‹</a></p><p><a href="#">äº’åŠ¨å­¦ä¹ </a></p><p><a href="#">ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ</a></p><p><a href="#">å¯åŠ¨æœåŠ¡å™¨</a></p><p><a href="#">å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨</a></p><p><a href="#">å¯è§†åŒ–æ‚¨çš„æ•…äº‹</a></p><p><a href="#">è¯„ä¼°æµ‹è¯•æ•°æ®æ¨¡å‹</a></p><p><a href="#">åˆ›å»ºç«è½¦æµ‹è¯•æ‹†åˆ†</a></p><p><a href="#">åœ¨Markdownå’ŒJSONä¹‹é—´è½¬æ¢æ•°æ®</a></p><p><a href="#">å°†å¯¹è¯å¯¼å‡ºåˆ°äº‹ä»¶ä»£ç†</a></p><p><a href="#">å¯åŠ¨Rasa X</a></p><h2 id="å¤‡å¿˜å•"><a href="#å¤‡å¿˜å•" class="headerlink" title="å¤‡å¿˜å•"></a>å¤‡å¿˜å•</h2><p>å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ä¸ºæ‚¨æä¾›äº†æ˜“äºè®°å¿†çš„å¸¸è§ä»»åŠ¡å‘½ä»¤ã€‚</p><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">å½±å“</th></tr></thead><tbody><tr><td align="left"><code>rasa init</code></td><td align="left">ä½¿ç”¨ç¤ºä¾‹è®­ç»ƒæ•°æ®ï¼Œæ“ä½œå’Œé…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚</td></tr><tr><td align="left"><code>rasa train</code></td><td align="left">ä½¿ç”¨æ‚¨çš„NLUæ•°æ®å’Œæ•…äº‹æ¥è®­ç»ƒæ¨¡å‹ï¼Œå¹¶å°†è®­ç»ƒåçš„æ¨¡å‹ä¿å­˜åœ¨ä¸­<code>./models</code>ã€‚</td></tr><tr><td align="left"><code>rasa interactive</code></td><td align="left">å¼€å§‹ä¸€ä¸ªäº¤äº’å¼å­¦ä¹ ä¼šè¯ï¼Œä»¥é€šè¿‡èŠå¤©åˆ›å»ºæ–°çš„è®­ç»ƒæ•°æ®ã€‚</td></tr><tr><td align="left"><code>rasa shell</code></td><td align="left">åŠ è½½æ‚¨è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹ï¼Œå¹¶å…è®¸æ‚¨åœ¨å‘½ä»¤è¡Œä¸Šä¸åŠ©æ‰‹äº¤è°ˆã€‚</td></tr><tr><td align="left"><code>rasa run</code></td><td align="left">ä½¿ç”¨è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹å¯åŠ¨RasaæœåŠ¡å™¨ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#">é…ç½®HTTP API</a>æ–‡æ¡£ã€‚</td></tr><tr><td align="left"><code>rasa run actions</code></td><td align="left">ä½¿ç”¨Rasa SDKå¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨ã€‚</td></tr><tr><td align="left"><code>rasa visualize</code></td><td align="left">å¯è§†åŒ–æ•…äº‹ã€‚</td></tr><tr><td align="left"><code>rasa test</code></td><td align="left">ä½¿ç”¨æ‚¨çš„æµ‹è¯•NLUæ•°æ®å’Œæ•…äº‹æµ‹è¯•ç»è¿‡è®­ç»ƒçš„Rasaæ¨¡å‹ã€‚</td></tr><tr><td align="left"><code>rasa data split nlu</code></td><td align="left">æ ¹æ®æŒ‡å®šçš„ç™¾åˆ†æ¯”å¯¹NLUæ•°æ®è¿›è¡Œæ‹†åˆ†ã€‚</td></tr><tr><td align="left"><code>rasa data convert nlu</code></td><td align="left">åœ¨ä¸åŒæ ¼å¼ä¹‹é—´è½¬æ¢NLUè®­ç»ƒæ•°æ®ã€‚</td></tr><tr><td align="left"><code>rasa export</code></td><td align="left">å°†å¯¹è¯ä»è·Ÿè¸ªå•†åº—å­˜å‚¨åˆ°äº‹ä»¶ä»£ç†ã€‚</td></tr><tr><td align="left"><code>rasa x</code></td><td align="left">åœ¨æœ¬åœ°å¯åŠ¨RasaXã€‚</td></tr><tr><td align="left"><code>rasa -h</code></td><td align="left">æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ã€‚</td></tr></tbody></table><h2 id="åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</h2><p>å•ä¸ªå‘½ä»¤å°†ä¸ºæ‚¨æä¾›ä¸€äº›ç¤ºä¾‹åŸ¹è®­æ•°æ®çš„å®Œæ•´é¡¹ç›®ã€‚</p><pre class=" language-shell"><code class="language-shell">rasa init</code></pre><p>è¿™å°†åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š</p><pre class=" language-shell"><code class="language-shell">.â”œâ”€â”€ __init__.pyâ”œâ”€â”€ actions.pyâ”œâ”€â”€ config.ymlâ”œâ”€â”€ credentials.ymlâ”œâ”€â”€ dataâ”‚   â”œâ”€â”€ nlu.mdâ”‚   â””â”€â”€ stories.mdâ”œâ”€â”€ domain.ymlâ”œâ”€â”€ endpoints.ymlâ””â”€â”€ models    â””â”€â”€ <timestamp>.tar.gz</code></pre><p>è¯¥å‘½ä»¤å°†è¯¢é—®æ‚¨æ˜¯å¦è¦ä½¿ç”¨æ­¤æ•°æ®è®­ç»ƒåˆå§‹æ¨¡å‹ã€‚å¦‚æœå›ç­”â€œå¦â€ï¼Œåˆ™ç›®å½•å°†ä¸ºç©ºã€‚<code>rasa init  models</code></p><p>é€šè¿‡æ­¤é¡¹ç›®è®¾ç½®ï¼Œå¸¸ç”¨å‘½ä»¤éå¸¸å®¹æ˜“è®°ä½ã€‚è¦è®­ç»ƒæ¨¡å‹ï¼Œè¯·é”®å…¥ï¼Œä»¥åœ¨å‘½ä»¤è¡Œä¸Šä¸æ¨¡å‹å¯¹è¯ï¼Œä»¥æµ‹è¯•æ¨¡å‹ç±»å‹ã€‚<code>rasa train  rasa shell rasa test</code></p><h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><p>ä¸»è¦å‘½ä»¤æ˜¯ï¼š</p><pre><code>rasa train</code></pre><p>æ­¤å‘½ä»¤è®­ç»ƒä¸€ä¸ªç»“åˆäº†Rasa NLUå’ŒRasa Coreæ¨¡å‹çš„Rasaæ¨¡å‹ã€‚å¦‚æœæ‚¨åªæƒ³è®­ç»ƒNLUæˆ–Coreæ¨¡å‹ï¼Œåˆ™å¯ä»¥è¿è¡Œæˆ–ã€‚ä½†æ˜¯ï¼Œå¦‚æœè®­ç»ƒæ•°æ®å’Œé…ç½®æ²¡æœ‰æ›´æ”¹ï¼ŒRasaå°†è‡ªåŠ¨è·³è¿‡è®­ç»ƒæ ¸å¿ƒæˆ–NLUã€‚<code>rasa train nlu``rasa train core</code></p><p><code>rasa train</code>ä¼šå°†è®­ç»ƒåçš„æ¨¡å‹å­˜å‚¨åœ¨å®šä¹‰çš„ç›®å½•ä¸­<code>--out</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹åç§°ä¸º<code>&lt;timestamp&gt;.tar.gz</code>ã€‚å¦‚æœè¦ç”¨ä¸åŒçš„åç§°å‘½åæ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨æ¥æŒ‡å®šåç§°<code>--fixed-model-name</code>ã€‚</p><p>ä»¥ä¸‹å‚æ•°å¯ç”¨äºé…ç½®åŸ¹è®­è¿‡ç¨‹ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa train [-h] [-v] [-vv] [--quiet] [--data DATA [DATA ...]]                  [-c CONFIG] [-d DOMAIN] [--out OUT]                  [--augmentation AUGMENTATION] [--debug-plots]                  [--fixed-model-name FIXED_MODEL_NAME] [--persist-nlu-data]                  [--force]                  &#123;core,nlu&#125; ...positional arguments:  &#123;core,nlu&#125;    core                Trains a Rasa Core model using your stories.    nlu                 Trains a Rasa NLU model using your NLU data.optional arguments:  -h, --help            show this help message and exit  --data DATA [DATA ...]                        Paths to the Core and NLU data files. (default:                        ['data'])  -c CONFIG, --config CONFIG                        The policy and NLU pipeline configuration of your bot.                        (default: config.yml)  -d DOMAIN, --domain DOMAIN                        Domain specification (yml file). (default: domain.yml)  --out OUT             Directory where your models should be stored.                        (default: models)  --augmentation AUGMENTATION                        How much data augmentation to use during training.                        (default: 50)  --debug-plots         If enabled, will create plots showing checkpoints and                        their connections between story blocks in a file                        called `story_blocks_connections.html`. (default:                        False)  --fixed-model-name FIXED_MODEL_NAME                        If set, the name of the model file/directory will be                        set to the given name. (default: None)  --persist-nlu-data    Persist the nlu training data in the saved model.                        (default: False)  --force               Force a model training even if the data has not                        changed. (default: False)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:  None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><blockquote><p>æ³¨æ„</p><p>ä½¿ç”¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œç¡®ä¿å­˜åœ¨Coreå’ŒNLUçš„è®­ç»ƒæ•°æ®ã€‚å¦‚æœä»…æä¾›ä¸€ç§æ¨¡å‹ç±»å‹çš„è®­ç»ƒæ•°æ®ï¼Œè¯¥å‘½ä»¤å°†è‡ªåŠ¨é€€å›åˆ° æˆ–å–å†³äºæä¾›çš„è®­ç»ƒæ–‡ä»¶ã€‚<code>rasa train  rasa train nlu  rasa train core</code></p></blockquote><h2 id="äº¤äº’å­¦ä¹ "><a href="#äº¤äº’å­¦ä¹ " class="headerlink" title="äº¤äº’å­¦ä¹ "></a>äº¤äº’å­¦ä¹ </h2><p>è¦ä¸æ‚¨çš„åŠ©æ‰‹å¼€å§‹äº¤äº’å¼å­¦ä¹ ä¼šè¯ï¼Œè¯·è¿è¡Œ</p><pre class=" language-shell"><code class="language-shell">rasa interactive</code></pre><p>å¦‚æœæ‚¨ä½¿ç”¨<code>--model</code>å‚æ•°æä¾›è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹ï¼Œåˆ™äº¤äº’å¼å­¦ä¹ è¿‡ç¨‹å°†ä»æä¾›çš„æ¨¡å‹å¼€å§‹ã€‚å¦‚æœæœªæŒ‡å®šä»»ä½•æ¨¡å‹ï¼Œåˆ™åœ¨æ²¡æœ‰å…¶ä»–ç›®å½•ä¼ é€’ç»™è¯¥ æ ‡å¿—çš„æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ä½äºå…¶ä¸­çš„æ•°æ®æ¥è®­ç»ƒæ–°çš„Rasaæ¨¡å‹ã€‚åœ¨è®­ç»ƒäº†åˆå§‹æ¨¡å‹ä¹‹åï¼Œäº¤äº’å¼å­¦ä¹ ä¼šè¯å¼€å§‹ã€‚å¦‚æœè®­ç»ƒæ•°æ®å’Œé…ç½®æœªæ›´æ”¹ï¼Œåˆ™å°†è·³è¿‡è®­ç»ƒã€‚<code>rasa interactive``data/``--data</code></p><p>å¯ä»¥è®¾ç½®çš„å‚æ•°çš„å®Œæ•´åˆ—è¡¨ä¸ºï¼š<code>rasa interactive</code></p><pre class=" language-shell"><code class="language-shell">usage: rasa interactive [-h] [-v] [-vv] [--quiet] [--e2e] [-m MODEL]                        [--data DATA [DATA ...]] [--skip-visualization]                        [--conversation-id CONVERSATION_ID]                        [--endpoints ENDPOINTS] [-c CONFIG] [-d DOMAIN]                        [--out OUT] [--augmentation AUGMENTATION]                        [--debug-plots] [--force] [--persist-nlu-data]                        &#123;core&#125; ... [model-as-positional-argument]positional arguments:  &#123;core&#125;    core                Starts an interactive learning session model to create                        new training data for a Rasa Core model by chatting.                        Uses the 'RegexInterpreter', i.e. `/<intent>` input                        format.  model-as-positional-argument                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: None)optional arguments:  -h, --help            show this help message and exit  --e2e                 Save story files in e2e format. In this format user                        messages will be included in the stories. (default:                        False)  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: None)  --data DATA [DATA ...]                        Paths to the Core and NLU data files. (default:                        ['data'])  --skip-visualization  Disable plotting the visualization during interactive                        learning. (default: False)  --conversation-id CONVERSATION_ID                        Specify the id of the conversation the messages are                        in. Defaults to a UUID that will be randomly                        generated. (default: 39156e0e50ca4ac2993dd943a540a3da)  --endpoints ENDPOINTS                        Configuration file for the model server and the                        connectors as a yml file. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Train Arguments:  -c CONFIG, --config CONFIG                        The policy and NLU pipeline configuration of your bot.                        (default: config.yml)  -d DOMAIN, --domain DOMAIN                        Domain specification (yml file). (default: domain.yml)  --out OUT             Directory where your models should be stored.                        (default: models)  --augmentation AUGMENTATION                        How much data augmentation to use during training.                        (default: 50)  --debug-plots         If enabled, will create plots showing checkpoints and                        their connections between story blocks in a file                        called `story_blocks_connections.html`. (default:                        False)  --force               Force a model training even if the data has not                        changed. (default: False)  --persist-nlu-data    Persist the nlu training data in the saved model.                        (default: False)</code></pre><h2 id="ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ"><a href="#ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ" class="headerlink" title="ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ"></a>ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ</h2><p>è¦åœ¨å‘½ä»¤è¡Œä¸Šä¸æ‚¨çš„åŠ©æ‰‹å¼€å§‹èŠå¤©ä¼šè¯ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa shell</code></pre><p>å¯ä¸botäº’åŠ¨çš„æ¨¡å‹å¯ä»¥é€šè¿‡æŒ‡å®š<code>--model</code>ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä»…NLUæ¨¡å‹å¯åŠ¨å¤–å£³ç¨‹åºï¼Œåˆ™å¯ä»¥è·å–åœ¨å‘½ä»¤è¡Œä¸Šé”®å…¥çš„ä»»ä½•æ–‡æœ¬çš„æ„å›¾å’Œå®ä½“ã€‚å¦‚æœæ‚¨çš„æ¨¡å‹åŒ…æ‹¬è®­ç»ƒæœ‰ç´ çš„Coreæ¨¡å‹ï¼Œåˆ™å¯ä»¥ä¸æ‚¨çš„æœºå™¨äººèŠå¤©ï¼Œå¹¶æŸ¥çœ‹è¯¥æœºå™¨äººä¸‹ä¸€æ­¥çš„é¢„æµ‹ã€‚å¦‚æœæ‚¨å·²ç»è®­ç»ƒäº†ä¸€ä¸ªç»„åˆçš„Rasaæ¨¡å‹ï¼Œä½†æ˜¯ä»ç„¶æƒ³æŸ¥çœ‹æ¨¡å‹ä»æ–‡æœ¬ä¸­æå–çš„æ„å›¾å’Œå®ä½“ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å‘½ä»¤ã€‚<code>rasa shell``rasa shell nlu</code></p><p>è¦æé«˜è°ƒè¯•çš„æ—¥å¿—è®°å½•çº§åˆ«ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa shell --debug</code></pre><p>é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨æ˜¯<code>rasa shell</code></p><pre class=" language-shell"><code class="language-shell">usage: rasa shell [-h] [-v] [-vv] [--quiet]                  [--conversation-id CONVERSATION_ID] [-m MODEL]                  [--log-file LOG_FILE] [--endpoints ENDPOINTS] [-p PORT]                  [-t AUTH_TOKEN] [--cors [CORS [CORS ...]]] [--enable-api]                  [--response-timeout RESPONSE_TIMEOUT]                  [--remote-storage REMOTE_STORAGE]                  [--ssl-certificate SSL_CERTIFICATE]                  [--ssl-keyfile SSL_KEYFILE] [--ssl-ca-file SSL_CA_FILE]                  [--ssl-password SSL_PASSWORD] [--credentials CREDENTIALS]                  [--connector CONNECTOR] [--jwt-secret JWT_SECRET]                  [--jwt-method JWT_METHOD]                  &#123;nlu&#125; ... [model-as-positional-argument]positional arguments:  &#123;nlu&#125;    nlu                 Interprets messages on the command line using your NLU                        model.  model-as-positional-argument                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: None)optional arguments:  -h, --help            show this help message and exit  --conversation-id CONVERSATION_ID                        Set the conversation ID. (default:                        71b04d860ac8469c9d97c6b68226019a)  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: models)  --log-file LOG_FILE   Store logs in specified file. (default: None)  --endpoints ENDPOINTS                        Configuration file for the model server and the                        connectors as a yml file. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Server Settings:  -p PORT, --port PORT  Port to run the server at. (default: 5005)  -t AUTH_TOKEN, --auth-token AUTH_TOKEN                        Enable token based authentication. Requests need to                        provide the token to be accepted. (default: None)  --cors [CORS [CORS ...]]                        Enable CORS for the passed origin. Use * to whitelist                        all origins. (default: None)  --enable-api          Start the web server API in addition to the input                        channel. (default: False)  --response-timeout RESPONSE_TIMEOUT                        Maximum time a response can take to process (sec).                        (default: 3600)  --remote-storage REMOTE_STORAGE                        Set the remote location where your Rasa model is                        stored, e.g. on AWS. (default: None)  --ssl-certificate SSL_CERTIFICATE                        Set the SSL Certificate to create a TLS secured                        server. (default: None)  --ssl-keyfile SSL_KEYFILE                        Set the SSL Keyfile to create a TLS secured server.                        (default: None)  --ssl-ca-file SSL_CA_FILE                        If your SSL certificate needs to be verified, you can                        specify the CA file using this parameter. (default:                        None)  --ssl-password SSL_PASSWORD                        If your ssl-keyfile is protected by a password, you                        can specify it using this paramer. (default: None)Channels:  --credentials CREDENTIALS                        Authentication credentials for the connector as a yml                        file. (default: None)  --connector CONNECTOR                        Service to connect to. (default: None)JWT Authentication:  --jwt-secret JWT_SECRET                        Public key for asymmetric JWT methods or shared                        secretfor symmetric methods. Please also make sure to                        use --jwt-method to select the method of the                        signature, otherwise this argument will be ignored.                        (default: None)  --jwt-method JWT_METHOD                        Method used for the signature of the JWT                        authentication payload. (default: HS256)</code></pre><h2 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h2><p>è¦å¯åŠ¨è¿è¡Œæ‚¨çš„Rasaæ¨¡å‹çš„æœåŠ¡å™¨ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa run</code></pre><p>ä»¥ä¸‹å‚æ•°å¯ç”¨äºé…ç½®RasaæœåŠ¡å™¨ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa run [-h] [-v] [-vv] [--quiet] [-m MODEL] [--log-file LOG_FILE]                [--endpoints ENDPOINTS] [-p PORT] [-t AUTH_TOKEN]                [--cors [CORS [CORS ...]]] [--enable-api]                [--response-timeout RESPONSE_TIMEOUT]                [--remote-storage REMOTE_STORAGE]                [--ssl-certificate SSL_CERTIFICATE]                [--ssl-keyfile SSL_KEYFILE] [--ssl-ca-file SSL_CA_FILE]                [--ssl-password SSL_PASSWORD] [--credentials CREDENTIALS]                [--connector CONNECTOR] [--jwt-secret JWT_SECRET]                [--jwt-method JWT_METHOD]                &#123;actions&#125; ... [model-as-positional-argument]positional arguments:  &#123;actions&#125;    actions             Runs the action server.  model-as-positional-argument                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: None)optional arguments:  -h, --help            show this help message and exit  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: models)  --log-file LOG_FILE   Store logs in specified file. (default: None)  --endpoints ENDPOINTS                        Configuration file for the model server and the                        connectors as a yml file. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Server Settings:  -p PORT, --port PORT  Port to run the server at. (default: 5005)  -t AUTH_TOKEN, --auth-token AUTH_TOKEN                        Enable token based authentication. Requests need to                        provide the token to be accepted. (default: None)  --cors [CORS [CORS ...]]                        Enable CORS for the passed origin. Use * to whitelist                        all origins. (default: None)  --enable-api          Start the web server API in addition to the input                        channel. (default: False)  --response-timeout RESPONSE_TIMEOUT                        Maximum time a response can take to process (sec).                        (default: 3600)  --remote-storage REMOTE_STORAGE                        Set the remote location where your Rasa model is                        stored, e.g. on AWS. (default: None)  --ssl-certificate SSL_CERTIFICATE                        Set the SSL Certificate to create a TLS secured                        server. (default: None)  --ssl-keyfile SSL_KEYFILE                        Set the SSL Keyfile to create a TLS secured server.                        (default: None)  --ssl-ca-file SSL_CA_FILE                        If your SSL certificate needs to be verified, you can                        specify the CA file using this parameter. (default:                        None)  --ssl-password SSL_PASSWORD                        If your ssl-keyfile is protected by a password, you                        can specify it using this paramer. (default: None)Channels:  --credentials CREDENTIALS                        Authentication credentials for the connector as a yml                        file. (default: None)  --connector CONNECTOR                        Service to connect to. (default: None)JWT Authentication:  --jwt-secret JWT_SECRET                        Public key for asymmetric JWT methods or shared                        secretfor symmetric methods. Please also make sure to                        use --jwt-method to select the method of the                        signature, otherwise this argument will be ignored.                        (default: None)  --jwt-method JWT_METHOD                        Method used for the signature of the JWT                        authentication payload. (default: HS256)</code></pre><p>æœ‰å…³å…¶ä»–å‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ<a href="#">é…ç½®HTTP APIâ€</a>ã€‚æœ‰å…³æ‰€æœ‰ç«¯ç‚¹çš„è¯¦ç»†æ–‡æ¡£ï¼Œè¯·å‚è§Rasa <a href="#">HTTP API</a>æ–‡æ¡£ã€‚</p><h2 id="å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨"><a href="#å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨"></a>å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨</h2><p>è¦è¿è¡ŒåŠ¨ä½œæœåŠ¡å™¨ï¼Œè¯·è¿è¡Œ</p><pre><code>rasa run actions</code></pre><p>ä»¥ä¸‹å‚æ•°å¯ç”¨äºè°ƒæ•´æœåŠ¡å™¨è®¾ç½®ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa run actions [-h] [-v] [-vv] [--quiet] [-p PORT]                        [--cors [CORS [CORS ...]]] [--actions ACTIONS]                        [--ssl-keyfile SSL_KEYFILE]                        [--ssl-certificate SSL_CERTIFICATE]                        [--ssl-password SSL_PASSWORD] [--auto-reload]optional arguments:  -h, --help            show this help message and exit  -p PORT, --port PORT  port to run the server at (default: 5055)  --cors [CORS [CORS ...]]                        enable CORS for the passed origin. Use * to whitelist                        all origins (default: None)  --actions ACTIONS     name of action package to be loaded (default: None)  --ssl-keyfile SSL_KEYFILE                        Set the SSL certificate to create a TLS secured                        server. (default: None)  --ssl-certificate SSL_CERTIFICATE                        Set the SSL certificate to create a TLS secured                        server. (default: None)  --ssl-password SSL_PASSWORD                        If your ssl-keyfile is protected by a password, you                        can specify it using this paramer. (default: None)  --auto-reload         Enable auto-reloading of modules containing Action                        subclasses. (default: False)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><h2 id="å¯è§†åŒ–ä½ çš„æ•…äº‹"><a href="#å¯è§†åŒ–ä½ çš„æ•…äº‹" class="headerlink" title="å¯è§†åŒ–ä½ çš„æ•…äº‹"></a>å¯è§†åŒ–ä½ çš„æ•…äº‹</h2><p>è¦æ‰“å¼€å¸¦æœ‰æ˜¾ç¤ºæ‚¨çš„æ•…äº‹çš„å›¾å½¢çš„æµè§ˆå™¨é€‰é¡¹å¡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><pre><code>rasa visualize</code></pre><p>é€šå¸¸ï¼Œç›®å½•<code>data</code>ä¸­çš„åŸ¹è®­æ¡ˆä¾‹æ˜¯å¯è§†åŒ–çš„ã€‚å¦‚æœæ‚¨çš„æ•…äº‹ä½äºå…¶ä»–åœ°æ–¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ¥æŒ‡å®šå®ƒä»¬çš„ä½ç½®<code>--stories</code>ã€‚</p><p>å…¶ä»–å‚æ•°æ˜¯ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa visualize [-h] [-v] [-vv] [--quiet] [-d DOMAIN] [-s STORIES]                      [-c CONFIG] [--out OUT] [--max-history MAX_HISTORY]                      [-u NLU]optional arguments:  -h, --help            show this help message and exit  -d DOMAIN, --domain DOMAIN                        Domain specification (yml file). (default: domain.yml)  -s STORIES, --stories STORIES                        File or folder containing your training stories.                        (default: data)  -c CONFIG, --config CONFIG                        The policy and NLU pipeline configuration of your bot.                        (default: config.yml)  --out OUT             Filename of the output path, e.g. 'graph.html'.                        (default: graph.html)  --max-history MAX_HISTORY                        Max history to consider when merging paths in the                        output graph. (default: 2)  -u NLU, --nlu NLU     File or folder containing your NLU data, used to                        insert example messages into the graph. (default:                        None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><h2 id="åœ¨æµ‹è¯•æ•°æ®ä¸Šè¯„ä¼°æ¨¡å‹"><a href="#åœ¨æµ‹è¯•æ•°æ®ä¸Šè¯„ä¼°æ¨¡å‹" class="headerlink" title="åœ¨æµ‹è¯•æ•°æ®ä¸Šè¯„ä¼°æ¨¡å‹"></a>åœ¨æµ‹è¯•æ•°æ®ä¸Šè¯„ä¼°æ¨¡å‹</h2><p>è¦æ ¹æ®æµ‹è¯•æ•°æ®è¯„ä¼°æ¨¡å‹ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa test</code></pre><p>æŒ‡å®šè¦æµ‹è¯•çš„æ¨¡å‹<code>--model</code>ã€‚åœ¨â€œ<a href="#">è¯„ä¼°NLUæ¨¡å‹</a>å’Œ<a href="#">è¯„ä¼°æ ¸å¿ƒæ¨¡å‹â€ä¸­</a>æŸ¥çœ‹æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p>ä»¥ä¸‹å‚æ•°å¯ç”¨äºï¼š<code>rasa test</code></p><pre class=" language-shell"><code class="language-shell">usage: rasa test [-h] [-v] [-vv] [--quiet] [-m MODEL] [-s STORIES]                 [--max-stories MAX_STORIES] [--endpoints ENDPOINTS]                 [--fail-on-prediction-errors] [--url URL]                 [--evaluate-model-directory] [-u NLU] [--out OUT]                 [--successes] [--no-errors] [--histogram HISTOGRAM]                 [--confmat CONFMAT] [-c CONFIG [CONFIG ...]]                 [--cross-validation] [-f FOLDS] [-r RUNS]                 [-p PERCENTAGES [PERCENTAGES ...]] [--no-plot]                 &#123;core,nlu&#125; ...positional arguments:  &#123;core,nlu&#125;    core                Tests Rasa Core models using your test stories.    nlu                 Tests Rasa NLU models using your test NLU data.optional arguments:  -h, --help            show this help message and exit  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: models)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Core Test Arguments:  -s STORIES, --stories STORIES                        File or folder containing your test stories. (default:                        tests)  --max-stories MAX_STORIES                        Maximum number of stories to test on. (default: None)  --endpoints ENDPOINTS                        Configuration file for the connectors as a yml file.                        (default: None)  --fail-on-prediction-errors                        If a prediction error is encountered, an exception is                        thrown. This can be used to validate stories during                        tests, e.g. on travis. (default: False)  --url URL             If supplied, downloads a story file from a URL and                        trains on it. Fetches the data by sending a GET                        request to the supplied URL. (default: None)  --evaluate-model-directory                        Should be set to evaluate models trained via 'rasa                        train core --config <config-1> <config-2>'. All models                        in the provided directory are evaluated and compared                        against each other. (default: False)NLU Test Arguments:  -u NLU, --nlu NLU     File or folder containing your NLU data. (default:                        data)  --out OUT             Output path for any files created during the                        evaluation. (default: results)  --successes           If set successful predictions (intent and entities)                        will be written to a file. (default: False)  --no-errors           If set incorrect predictions (intent and entities)                        will NOT be written to a file. (default: False)  --histogram HISTOGRAM                        Output path for the confidence histogram. (default:                        hist.png)  --confmat CONFMAT     Output path for the confusion matrix plot. (default:                        confmat.png)  -c CONFIG [CONFIG ...], --config CONFIG [CONFIG ...]                        Model configuration file. If a single file is passed                        and cross validation mode is chosen, cross-validation                        is performed, if multiple configs or a folder of                        configs are passed, models will be trained and                        compared directly. (default: None)  --no-plot             Don't render evaluation plots (default: False)</code></pre><h2 id="åˆ›å»ºè®­ç»ƒæµ‹è¯•æ‹†åˆ†"><a href="#åˆ›å»ºè®­ç»ƒæµ‹è¯•æ‹†åˆ†" class="headerlink" title="åˆ›å»ºè®­ç»ƒæµ‹è¯•æ‹†åˆ†"></a>åˆ›å»ºè®­ç»ƒæµ‹è¯•æ‹†åˆ†</h2><p>è¦åˆ›å»ºNLUæ•°æ®çš„æ‹†åˆ†ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa data split nlu</code></pre><p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°æŒ‡å®šè®­ç»ƒæ•°æ®ï¼Œåˆ†æ•°å’Œè¾“å‡ºç›®å½•ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa data split nlu [-h] [-v] [-vv] [--quiet] [-u NLU]                           [--training-fraction TRAINING_FRACTION]                           [--random-seed RANDOM_SEED] [--out OUT]optional arguments:  -h, --help            show this help message and exit  -u NLU, --nlu NLU     File or folder containing your NLU data. (default:                        data)  --training-fraction TRAINING_FRACTION                        Percentage of the data which should be in the training                        data. (default: 0.8)  --random-seed RANDOM_SEED                        Seed to generate the same train/test split. (default:                        None)  --out OUT             Directory where the split files should be stored.                        (default: train_test_split)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><p>æ­¤å‘½ä»¤å°†å°è¯•åœ¨è®­ç»ƒå’Œæµ‹è¯•ä¸­ä¿æŒæ„å›¾çš„æ¯”ä¾‹ç›¸åŒã€‚å¦‚æœæ‚¨æœ‰NLGæ•°æ®ç”¨äºæ£€ç´¢æ“ä½œï¼Œåˆ™å°†å…¶ä¿å­˜åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼š</p><pre class=" language-shell"><code class="language-shell">ls train_test_split      nlg_test_data.md     test_data.json      nlg_training_data.md training_data.json</code></pre><h2 id="åœ¨Markdownå’ŒJSONä¹‹é—´è½¬æ¢æ•°æ®"><a href="#åœ¨Markdownå’ŒJSONä¹‹é—´è½¬æ¢æ•°æ®" class="headerlink" title="åœ¨Markdownå’ŒJSONä¹‹é—´è½¬æ¢æ•°æ®"></a>åœ¨Markdownå’ŒJSONä¹‹é—´è½¬æ¢æ•°æ®</h2><p>è¦å°†NLUæ•°æ®ä»LUISæ•°æ®æ ¼å¼ï¼ŒWITæ•°æ®æ ¼å¼ï¼ŒDialogflowæ•°æ®æ ¼å¼ï¼ŒJSONæˆ–Markdownè½¬æ¢ä¸ºJSONæˆ–Markdownï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa data convert nlu</code></pre><p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶å’Œè¾“å‡ºæ ¼å¼ï¼š</p><pre class=" language-shell"><code class="language-shell">usage: rasa data convert nlu [-h] [-v] [-vv] [--quiet] --data DATA --out OUT                             [-l LANGUAGE] -f &#123;json,md&#125;optional arguments:  -h, --help            show this help message and exit  --data DATA           Path to the file or directory containing Rasa NLU                        data. (default: None)  --out OUT             File where to save training data in Rasa format.                        (default: None)  -l LANGUAGE, --language LANGUAGE                        Language of data. (default: en)  -f &#123;json,md&#125;, --format &#123;json,md&#125;                        Output format the training data should be converted                        into. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><h2 id="å°†å¯¹è¯å¯¼å‡ºåˆ°äº‹ä»¶ä»£ç†"><a href="#å°†å¯¹è¯å¯¼å‡ºåˆ°äº‹ä»¶ä»£ç†" class="headerlink" title="å°†å¯¹è¯å¯¼å‡ºåˆ°äº‹ä»¶ä»£ç†"></a>å°†å¯¹è¯å¯¼å‡ºåˆ°äº‹ä»¶ä»£ç†</h2><p>è¦ä½¿ç”¨äº‹ä»¶ä»£ç†ä»è·Ÿè¸ªå•†åº—ä¸­å¯¼å‡ºäº‹ä»¶ï¼Œè¯·è¿è¡Œï¼š</p><pre><code>rasa export</code></pre><p>æ‚¨å¯ä»¥æŒ‡å®šç¯å¢ƒæ–‡ä»¶çš„ä½ç½®ï¼Œåº”å‘å¸ƒçš„äº‹ä»¶çš„æœ€å°å’Œæœ€å¤§æ—¶é—´æˆ³ä»¥åŠåº”å‘å¸ƒçš„å¯¹è¯IDã€‚</p><pre class=" language-shell"><code class="language-shell">usage: rasa export [-h] [-v] [-vv] [--quiet] [--endpoints ENDPOINTS]                   [--minimum-timestamp MINIMUM_TIMESTAMP]                   [--maximum-timestamp MAXIMUM_TIMESTAMP]                   [--conversation-ids CONVERSATION_IDS]optional arguments:  -h, --help            show this help message and exit  --endpoints ENDPOINTS                        Endpoint configuration file specifying the tracker                        store and event broker. (default: endpoints.yml)  --minimum-timestamp MINIMUM_TIMESTAMP                        Minimum timestamp of events to be exported. The                        constraint is applied in a 'greater than or equal'                        comparison. (default: None)  --maximum-timestamp MAXIMUM_TIMESTAMP                        Maximum timestamp of events to be exported. The                        constraint is applied in a 'less than' comparison.                        (default: None)  --conversation-ids CONVERSATION_IDS                        Comma-separated list of conversation IDs to migrate.                        If unset, all available conversation IDs will be                        exported. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)</code></pre><h2 id="å¯åŠ¨Rasa"><a href="#å¯åŠ¨Rasa" class="headerlink" title="å¯åŠ¨Rasa"></a>å¯åŠ¨Rasa</h2><p>Rasa Xæ˜¯ä¸€ä¸ªå·¥å…·é›†ï¼Œå¯å¸®åŠ©æ‚¨åˆ©ç”¨å¯¹è¯æ¥æ”¹å–„æ‚¨çš„åŠ©æ‰‹ã€‚æ‚¨å¯ä»¥<a href="#">åœ¨æ­¤å¤„</a>æ‰¾åˆ°æœ‰å…³å®ƒçš„æ›´å¤šä¿¡æ¯ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°å¯åŠ¨Rasa X</p><pre><code>rasa x</code></pre><p>ä¸ºäº†èƒ½å¤Ÿå¯åŠ¨Rasa Xï¼Œæ‚¨éœ€è¦å®‰è£…Rasa Xæœ¬åœ°æ¨¡å¼ï¼Œå¹¶ä¸”éœ€è¦å¤„äºRasaé¡¹ç›®ä¸­ã€‚</p><blockquote><p>æ³¨æ„</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRasa Xåœ¨ç«¯å£5002ä¸Šè¿è¡Œã€‚ä½¿ç”¨è¯¥å‚æ•°<code>--rasa-x-port</code>å¯ä»¥å°†å…¶æ›´æ”¹ä¸ºä»»ä½•å…¶ä»–ç«¯å£ã€‚</p></blockquote><p>ä»¥ä¸‹å‚æ•°å¯ç”¨äºï¼š<code>rasa x</code></p><pre class=" language-shell"><code class="language-shell">usage: rasa x [-h] [-v] [-vv] [--quiet] [-m MODEL] [--data DATA] [-c CONFIG]              [--no-prompt] [--production] [--rasa-x-port RASA_X_PORT]              [--config-endpoint CONFIG_ENDPOINT] [--log-file LOG_FILE]              [--endpoints ENDPOINTS] [-p PORT] [-t AUTH_TOKEN]              [--cors [CORS [CORS ...]]] [--enable-api]              [--response-timeout RESPONSE_TIMEOUT]              [--remote-storage REMOTE_STORAGE]              [--ssl-certificate SSL_CERTIFICATE] [--ssl-keyfile SSL_KEYFILE]              [--ssl-ca-file SSL_CA_FILE] [--ssl-password SSL_PASSWORD]              [--credentials CREDENTIALS] [--connector CONNECTOR]              [--jwt-secret JWT_SECRET] [--jwt-method JWT_METHOD]optional arguments:  -h, --help            show this help message and exit  -m MODEL, --model MODEL                        Path to a trained Rasa model. If a directory is                        specified, it will use the latest model in this                        directory. (default: models)  --data DATA           Path to the file or directory containing stories and                        Rasa NLU data. (default: data)  -c CONFIG, --config CONFIG                        The policy and NLU pipeline configuration of your bot.                        (default: config.yml)  --no-prompt           Automatic yes or default options to prompts and                        oppressed warnings. (default: False)  --production          Run Rasa X in a production environment. (default:                        False)  --rasa-x-port RASA_X_PORT                        Port to run the Rasa X server at. (default: 5002)  --config-endpoint CONFIG_ENDPOINT                        Rasa X endpoint URL from which to pull the runtime                        config. This URL typically contains the Rasa X token                        for authentication. Example:                        https://example.com/api/config?token=my_rasa_x_token                        (default: None)  --log-file LOG_FILE   Store logs in specified file. (default: None)  --endpoints ENDPOINTS                        Configuration file for the model server and the                        connectors as a yml file. (default: None)Python Logging Options:  -v, --verbose         Be verbose. Sets logging level to INFO. (default:                        None)  -vv, --debug          Print lots of debugging statements. Sets logging level                        to DEBUG. (default: None)  --quiet               Be quiet! Sets logging level to WARNING. (default:                        None)Server Settings:  -p PORT, --port PORT  Port to run the server at. (default: 5005)  -t AUTH_TOKEN, --auth-token AUTH_TOKEN                        Enable token based authentication. Requests need to                        provide the token to be accepted. (default: None)  --cors [CORS [CORS ...]]                        Enable CORS for the passed origin. Use * to whitelist                        all origins. (default: None)  --enable-api          Start the web server API in addition to the input                        channel. (default: False)  --response-timeout RESPONSE_TIMEOUT                        Maximum time a response can take to process (sec).                        (default: 3600)  --remote-storage REMOTE_STORAGE                        Set the remote location where your Rasa model is                        stored, e.g. on AWS. (default: None)  --ssl-certificate SSL_CERTIFICATE                        Set the SSL Certificate to create a TLS secured                        server. (default: None)  --ssl-keyfile SSL_KEYFILE                        Set the SSL Keyfile to create a TLS secured server.                        (default: None)  --ssl-ca-file SSL_CA_FILE                        If your SSL certificate needs to be verified, you can                        specify the CA file using this parameter. (default:                        None)  --ssl-password SSL_PASSWORD                        If your ssl-keyfile is protected by a password, you                        can specify it using this paramer. (default: None)Channels:  --credentials CREDENTIALS                        Authentication credentials for the connector as a yml                        file. (default: None)  --connector CONNECTOR                        Service to connect to. (default: None)JWT Authentication:  --jwt-secret JWT_SECRET                        Public key for asymmetric JWT methods or shared                        secretfor symmetric methods. Please also make sure to                        use --jwt-method to select the method of the                        signature, otherwise this argument will be ignored.                        (default: None)  --jwt-method JWT_METHOD                        Method used for the signature of the JWT                        authentication payload. (default: HS256)</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rasaæ–‡æ¡£æŒ‡å—(1)</title>
      <link href="/2020/10/02/rasa-zhi-nan/"/>
      <url>/2020/10/02/rasa-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h1 id="Rasaæ–‡æ¡£æŒ‡å—"><a href="#Rasaæ–‡æ¡£æŒ‡å—" class="headerlink" title="Rasaæ–‡æ¡£æŒ‡å—"></a>Rasaæ–‡æ¡£æŒ‡å—</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li>å¿«é€Ÿå®‰è£…</li></ul><p>æ‚¨å¯ä»¥ä½¿ç”¨pipå®‰è£…Rasa Open Sourceï¼ˆéœ€è¦Python 3.6æˆ–3.7ï¼‰ã€‚</p><pre class=" language-shell"><code class="language-shell">pip3 install rasa</code></pre><ul><li>ä»æºä»£ç æ„å»º</li></ul><pre class=" language-shell"><code class="language-shell">curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | pythongit clone https://github.com/RasaHQ/rasa.gitcd rasapoetry install</code></pre><ul><li><p>spaCyçš„ä¾èµ–å…³ç³»</p><p>æœ‰å…³spaCyçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://spacy.io/usage/models">spaCyæ–‡æ¡£</a>ã€‚</p></li></ul><pre class=" language-shell"><code class="language-shell">pip install rasa[spacy]python -m spacy download en_core_web_mdpython -m spacy link en_core_web_md en</code></pre><ul><li><p>MITIEçš„ä¾èµ–é¡¹</p><p>ç„¶åä¸‹è½½ <a href="https://github.com/mit-nlp/MITIE/releases/download/v0.4/MITIE-models-v0.2.tar.bz2">MITIEæ¨¡å‹</a>ã€‚æ‚¨éœ€è¦çš„æ–‡ä»¶æ˜¯<code>total_word_feature_extractor.dat</code>ã€‚å°†æ­¤ä¿å­˜åœ¨ä»»ä½•åœ°æ–¹ã€‚å¦‚æœè¦ä½¿ç”¨MITIEï¼Œåˆ™éœ€è¦å‘Šè¯‰å®ƒåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ­¤æ–‡ä»¶ï¼ˆåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œè¯¥<code>data</code>æ–‡ä»¶å·²ä¿å­˜åœ¨é¡¹ç›®ç›®å½•çš„ æ–‡ä»¶å¤¹ä¸­ï¼‰ã€‚</p></li></ul><pre class=" language-shell"><code class="language-shell">pip install git+https://github.com/mit-nlp/MITIE.gitpip install rasa[mitie]</code></pre><h2 id="æ•™ç¨‹ï¼šRasaåŸºç¡€"><a href="#æ•™ç¨‹ï¼šRasaåŸºç¡€" class="headerlink" title="æ•™ç¨‹ï¼šRasaåŸºç¡€"></a>æ•™ç¨‹ï¼šRasaåŸºç¡€</h2><h3 id="åŸºæœ¬æ­¥éª¤"><a href="#åŸºæœ¬æ­¥éª¤" class="headerlink" title="åŸºæœ¬æ­¥éª¤"></a>åŸºæœ¬æ­¥éª¤</h3><ol><li><p>åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</p></li><li><p>æŸ¥çœ‹æ‚¨çš„NLUåŸ¹è®­æ•°æ®</p></li><li><p>å®šä¹‰æ¨¡å‹é…ç½®</p></li><li><p>å†™ä½ çš„ç¬¬ä¸€ç¯‡æ•…äº‹</p></li><li><p>å®šä¹‰åŸŸ</p></li><li><p>è®­ç»ƒæ¨¡å‹</p></li><li><p>æµ‹è¯•æ‚¨çš„åŠ©æ‰‹</p></li><li><p>ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ</p></li></ol><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªç®€å•å‹å¥½çš„åŠ©æ‰‹ï¼Œè¯¥åŠ©æ‰‹å°†è¯¢é—®æ‚¨çš„å·¥ä½œçŠ¶å†µï¼Œå¹¶å‘æ‚¨å‘é€æœ‰è¶£çš„å›¾ç‰‡ä»¥åœ¨æ‚¨éš¾è¿‡æ—¶ä¸ºæ‚¨åŠ æ²¹ã€‚</p><p><img src="/2020/10/02/rasa-zhi-nan/1.png"></p><h3 id="1-åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®"><a href="#1-åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®" class="headerlink" title="1.åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®"></a>1.åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®</h3><p>ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„Rasaé¡¹ç›®ã€‚ä¸ºæ­¤ï¼Œè¯·è¿è¡Œï¼š</p><pre class=" language-shell"><code class="language-shell">rasa init --no-prompt</code></pre><p>è¯¥å‘½ä»¤åˆ›å»ºRasaé¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€äº›ç¤ºä¾‹æ•°æ®ä¸Šè®­ç»ƒä¸€ä¸ªç®€å•çš„botã€‚å¦‚æœæ‚¨ä¸åšä»»ä½•æ ‡è®°ï¼Œç³»ç»Ÿå°†è¯¢é—®æ‚¨ä¸€äº›æœ‰å…³å¦‚ä½•è®¾ç½®é¡¹ç›®çš„é—®é¢˜ã€‚<code>rasa init --no-prompt</code></p><p>è¿™å°†åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š</p><table><thead><tr><th><code>__init__.py</code></th><th>ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œå¯å¸®åŠ©pythonæŸ¥æ‰¾æ‚¨çš„æ“ä½œ</th></tr></thead><tbody><tr><td><code>actions.py</code></td><td>æ‚¨çš„è‡ªå®šä¹‰æ“ä½œçš„ä»£ç </td></tr><tr><td><code>config.yml</code> â€˜*â€™</td><td>æ‚¨çš„NLUå’ŒCoreæ¨¡å‹çš„é…ç½®</td></tr><tr><td><code>credentials.yml</code></td><td>è¿æ¥å…¶ä»–æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>data/nlu.md</code> â€˜*â€™</td><td>æ‚¨çš„NLUè®­ç»ƒæ•°æ®</td></tr><tr><td><code>data/stories.md</code> â€˜*â€™</td><td>ä½ çš„æ•…äº‹</td></tr><tr><td><code>domain.yml</code> â€˜*â€™</td><td>æ‚¨åŠ©æ‰‹çš„åŸŸå</td></tr><tr><td><code>endpoints.yml</code></td><td>è¿æ¥åˆ°fb Messengerç­‰é¢‘é“çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>models/&lt;timestamp&gt;.tar.gz</code></td><td>æ‚¨çš„åˆå§‹æ¨¡å‹</td></tr></tbody></table><p>æœ€é‡è¦çš„æ–‡ä»¶æ ‡æœ‰â€œ *â€ã€‚æ‚¨å°†åœ¨æœ¬æ•™ç¨‹ä¸­äº†è§£æ‰€æœ‰è¿™äº›å†…å®¹ã€‚</p><h3 id="2-æŸ¥çœ‹æ‚¨çš„NLUåŸ¹è®­æ•°æ®"><a href="#2-æŸ¥çœ‹æ‚¨çš„NLUåŸ¹è®­æ•°æ®" class="headerlink" title="2.æŸ¥çœ‹æ‚¨çš„NLUåŸ¹è®­æ•°æ®"></a>2.æŸ¥çœ‹æ‚¨çš„NLUåŸ¹è®­æ•°æ®</h3><p>RasaåŠ©æ‰‹çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯NLUæ¨¡å‹ã€‚NLUä»£è¡¨è‡ªç„¶è¯­è¨€ç†è§£ï¼Œè¿™æ„å‘³ç€å°†ç”¨æˆ·æ¶ˆæ¯è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ã€‚è¦ä½¿ç”¨Rasaåšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦æä¾›è®­ç»ƒç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹è¯´æ˜Rasaåº”è¯¥å¦‚ä½•ç†è§£ç”¨æˆ·æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡æ˜¾ç¤ºè¿™äº›ç¤ºä¾‹æ¥è®­ç»ƒæ¨¡å‹ã€‚</p><p>è¿è¡Œä¸‹é¢çš„ä»£ç å•å…ƒä»¥æŸ¥çœ‹è¯¥å‘½ä»¤åˆ›å»ºçš„NLUè®­ç»ƒæ•°æ®ï¼š<code>rasa init</code></p><pre class=" language-text"><code class="language-text">## intent:greet- hey- hello- hi- good morning- good evening- hey there## intent:goodbye- bye- goodbye- see you around- see you later## intent:affirm- yes- indeed- of course- that sounds good- correct## intent:deny- no- never- I don't think so- don't like that- no way- not really## intent:mood_great- perfect- very good- great- amazing- wonderful- I am feeling very good- I am great- I'm good## intent:mood_unhappy- sad- very sad- unhappy- bad- very bad- awful- terrible- not very good- extremely sad- so sad## intent:bot_challenge- are you a bot?- are you a human?- am I talking to a bot?- am I talking to a human?</code></pre><p>ä»¥å¼€å¤´çš„è¡Œ<code>##</code>å®šä¹‰yourçš„åç§°<code>intents</code>ï¼Œå®ƒä»¬æ˜¯å…·æœ‰ç›¸åŒå«ä¹‰çš„æ¶ˆæ¯ç»„ã€‚å½“æ‚¨çš„ç”¨æˆ·å‘æ‚¨çš„åŠ©æ‰‹å‘é€çœ‹ä¸è§çš„æ–°æ¶ˆæ¯æ—¶ï¼ŒRasaçš„å·¥ä½œå°†æ˜¯é¢„æµ‹æ­£ç¡®çš„æ„å›¾ã€‚æ‚¨å¯ä»¥åœ¨<a href="#">è®­ç»ƒæ•°æ®æ ¼å¼</a>ä¸­æ‰¾åˆ°è¯¥æ•°æ®æ ¼å¼çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="3-å®šä¹‰ä½ çš„æ¨¡å‹é…ç½®"><a href="#3-å®šä¹‰ä½ çš„æ¨¡å‹é…ç½®" class="headerlink" title="3.å®šä¹‰ä½ çš„æ¨¡å‹é…ç½®"></a>3.å®šä¹‰ä½ çš„æ¨¡å‹é…ç½®</h3><p>é…ç½®æ–‡ä»¶å®šä¹‰äº†æ¨¡å‹å°†ä½¿ç”¨çš„NLUå’ŒCoreç»„ä»¶ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨çš„NLUæ¨¡å‹å°†ä½¿ç”¨ <code>supervised_embeddings</code>ç®¡é“ã€‚æ‚¨å¯ä»¥<a href="#">åœ¨æ­¤å¤„</a>äº†è§£ä¸åŒçš„NLUç®¡é“ ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‚¨çš„æ¨¡å‹é…ç½®æ–‡ä»¶ã€‚</p><pre class=" language-text"><code class="language-text"># Configuration for Rasa NLU.# https://rasa.com/docs/rasa/nlu/components/language: enpipeline:  - name: WhitespaceTokenizer  - name: RegexFeaturizer  - name: LexicalSyntacticFeaturizer  - name: CountVectorsFeaturizer  - name: CountVectorsFeaturizer    analyzer: "char_wb"    min_ngram: 1    max_ngram: 4  - name: DIETClassifier    epochs: 10  - name: EntitySynonymMapper  - name: ResponseSelector    epochs: 10# Configuration for Rasa Core.# https://rasa.com/docs/rasa/core/policies/policies:  - name: MemoizationPolicy  - name: TEDPolicy    max_history: 5    epochs: 10  - name: MappingPolicy</code></pre><p>åœ¨<code>language</code>å’Œ<code>pipeline</code>ä¸»é”®æŒ‡å®šçš„NLUæ¨¡å‹åº”è¯¥å¦‚ä½•æ„å»ºã€‚è¯¥<code>policies</code>é”®å®šä¹‰<a href="#">ç­–ç•¥</a>çš„æ ¸å¿ƒè½¦å‹å°†é‡‡ç”¨ã€‚</p><h3 id="4-ç¼–å†™ç¬¬ä¸€ä¸ªæ•…äº‹"><a href="#4-ç¼–å†™ç¬¬ä¸€ä¸ªæ•…äº‹" class="headerlink" title="4.ç¼–å†™ç¬¬ä¸€ä¸ªæ•…äº‹"></a>4.ç¼–å†™ç¬¬ä¸€ä¸ªæ•…äº‹</h3><p>åœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å°†æ•™æ‚¨çš„åŠ©æ‰‹å¦‚ä½•å›å¤æ‚¨çš„æ¶ˆæ¯ã€‚è¿™ç§°ä¸ºå¯¹è¯ç®¡ç†ï¼Œç”±æ‚¨çš„Coreæ¨¡å‹å¤„ç†ã€‚</p><p>æ ¸å¿ƒæ¨¡å‹ä»¥è®­ç»ƒâ€œæ•…äº‹â€çš„å½¢å¼ä»çœŸå®çš„å¯¹è¯æ•°æ®ä¸­å­¦ä¹ ã€‚æ•…äº‹æ˜¯ç”¨æˆ·å’ŒåŠ©æ‰‹ä¹‹é—´çš„çœŸå®å¯¹è¯ã€‚å…·æœ‰æ„å›¾å’Œå®ä½“çš„è¡Œåæ˜ äº†ç”¨æˆ·çš„è¾“å…¥ï¼Œè€ŒåŠ¨ä½œåç§°åˆ™æ˜¾ç¤ºäº†åŠ©æ‰‹åº”è¯¥åšå‡ºçš„å“åº”ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å¯¹è¯çš„ç¤ºä¾‹ã€‚ç”¨æˆ·æ‰“ä¸ªæ‹›å‘¼ï¼ŒåŠ©æ‰‹æ‰“ä¸ªæ‹›å‘¼ã€‚è¿™å°±æ˜¯ä¸€ä¸ªæ•…äº‹ï¼š</p><pre><code>## story1* greet   - utter_greet</code></pre><p>æ‚¨å¯ä»¥åœ¨â€œ<a href="#">æ•…äº‹â€ä¸­</a>æŸ¥çœ‹å®Œæ•´çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>å¼€å¤´çš„è¡Œæ˜¯<code>-</code>åŠ©æ‰‹æ‰§è¡Œçš„æ“ä½œã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åŠ¨ä½œéƒ½æ˜¯å‘é€å›ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚<code>utter_greet</code>ï¼Œä½†æ˜¯ä¸€èˆ¬è€Œè¨€ï¼ŒåŠ¨ä½œå¯ä»¥æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬è°ƒç”¨APIå’Œä¸å¤–ç•Œäº’åŠ¨ã€‚</p><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æŸ¥çœ‹æ–‡ä»¶ä¸­çš„ç¤ºä¾‹æ•…äº‹<code>data/stories.md</code>ï¼š</p><pre class=" language-text"><code class="language-text">## happy path* greet  - utter_greet* mood_great  - utter_happy## sad path 1* greet  - utter_greet* mood_unhappy  - utter_cheer_up  - utter_did_that_help* affirm  - utter_happy## sad path 2* greet  - utter_greet* mood_unhappy  - utter_cheer_up  - utter_did_that_help* deny  - utter_goodbye## say goodbye* goodbye  - utter_goodbye## bot challenge* bot_challenge  - utter_iamabot</code></pre><h3 id="5-å®šä¹‰ä¸€ä¸ªåŸŸ"><a href="#5-å®šä¹‰ä¸€ä¸ªåŸŸ" class="headerlink" title="5.å®šä¹‰ä¸€ä¸ªåŸŸ"></a>5.å®šä¹‰ä¸€ä¸ªåŸŸ</h3><p>æˆ‘ä»¬éœ€è¦åšçš„ä¸‹ä¸€ä»¶äº‹æ˜¯å®šä¹‰ä¸€ä¸ª<a href="#">Domain</a>ã€‚è¯¥åŸŸå®šä¹‰äº†æ‚¨çš„åŠ©æ‰‹æ‰€ç”Ÿæ´»çš„ä¸–ç•Œï¼šåº”è¯¥æœŸæœ›å¾—åˆ°ä»€ä¹ˆç”¨æˆ·è¾“å…¥ï¼Œåº”è¯¥èƒ½å¤Ÿé¢„æµ‹ä»€ä¹ˆæ“ä½œï¼Œå¦‚ä½•å“åº”ä»¥åŠè¦å­˜å‚¨ä»€ä¹ˆä¿¡æ¯ã€‚æˆ‘ä»¬åŠ©æ‰‹çš„åŸŸä¿å­˜åœ¨ä¸€ä¸ªåä¸ºçš„æ–‡ä»¶ä¸­<code>domain.yml</code>ï¼š</p><pre class=" language-text"><code class="language-text">intents:  - greet  - goodbye  - affirm  - deny  - mood_great  - mood_unhappy  - bot_challengeresponses:  utter_greet:  - text: "Hey! How are you?"  utter_cheer_up:  - text: "Here is something to cheer you up:"    image: "https://i.imgur.com/nGF1K8f.jpg"  utter_did_that_help:  - text: "Did that help you?"  utter_happy:  - text: "Great, carry on!"  utter_goodbye:  - text: "Bye"  utter_iamabot:  - text: "I am a bot, powered by Rasa."session_config:  session_expiration_time: 60  carry_over_slots_to_new_session: true</code></pre><p>é‚£ä¹ˆä¸åŒçš„éƒ¨åˆ†æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><table><thead><tr><th><code>intents</code></th><th>æ‚¨å¸Œæœ›ç”¨æˆ·è¯´çš„è¯</th></tr></thead><tbody><tr><td><code>actions</code></td><td>æ‚¨çš„åŠ©æ‰‹å¯ä»¥è¯´çš„äº‹æƒ…</td></tr><tr><td><code>responses</code></td><td>æ‚¨çš„åŠ©æ‰‹å¯ä»¥è¯´çš„è¯çš„å›åº”å­—ç¬¦ä¸²</td></tr></tbody></table><p><strong>è¿™å¦‚ä½•æ­é…åœ¨ä¸€èµ·ï¼Ÿ</strong> Rasa Coreçš„å·¥ä½œæ˜¯é€‰æ‹©æ­£ç¡®çš„åŠ¨ä½œï¼Œä»¥ä¾¿åœ¨å¯¹è¯çš„æ¯ä¸ªæ­¥éª¤ä¸­æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ“ä½œåªä¼šå‘ç”¨æˆ·å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚è¿™äº›ç®€å•çš„å‘å£°åŠ¨ä½œæ˜¯ä»¥<code>actions</code>å¼€å¤´çš„åŸŸ<code>utter_</code>ã€‚åŠ©æ‰‹å°†æ ¹æ®æ­¤<code>responses</code>éƒ¨åˆ†çš„å“åº”ä»¥ä¸€æ¡æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚è¯·å‚é˜…<a href="#">è‡ªå®šä¹‰æ“ä½œ</a> ï¼Œä»¥æ„å»ºé™¤å‘é€æ¶ˆæ¯ä»¥å¤–è¿˜å¯ä»¥åšçš„äº‹æƒ…ã€‚</p><h3 id="6-è®­ç»ƒæ¨¡å‹"><a href="#6-è®­ç»ƒæ¨¡å‹" class="headerlink" title="6.è®­ç»ƒæ¨¡å‹"></a>6.è®­ç»ƒæ¨¡å‹</h3><p>æ¯å½“æˆ‘ä»¬æ·»åŠ æ–°çš„NLUæˆ–Coreæ•°æ®ï¼Œæˆ–æ›´æ–°åŸŸæˆ–é…ç½®æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ ¹æ®ç¤ºä¾‹æ•…äº‹å’ŒNLUæ•°æ®é‡æ–°è®­ç»ƒç¥ç»ç½‘ç»œã€‚ä¸ºæ­¤ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚è¯¥å‘½ä»¤å°†è°ƒç”¨Rasa Coreå’ŒNLUè®­ç»ƒå‡½æ•°ï¼Œå¹¶å°†è®­ç»ƒåçš„æ¨¡å‹å­˜å‚¨åˆ°<code>models/</code>ç›®å½•ä¸­ã€‚å¦‚æœä¸åŒæ¨¡å‹é›¶ä»¶çš„æ•°æ®æˆ–é…ç½®æœ‰æ‰€æ›´æ”¹ï¼Œè¯¥å‘½ä»¤å°†ä»…è‡ªåŠ¨é‡æ–°è®­ç»ƒå®ƒä»¬ã€‚</p><pre class=" language-shell"><code class="language-shell">rasa train</code></pre><p>è¯¥å‘½ä»¤å°†åŒæ—¶æŸ¥æ‰¾NLUå’ŒCoreæ•°æ®ï¼Œå¹¶è®­ç»ƒç»„åˆæ¨¡å‹ã€‚<code>rasa train</code></p><h3 id="7-æµ‹è¯•æ‚¨çš„åŠ©æ‰‹"><a href="#7-æµ‹è¯•æ‚¨çš„åŠ©æ‰‹" class="headerlink" title="7.æµ‹è¯•æ‚¨çš„åŠ©æ‰‹"></a>7.æµ‹è¯•æ‚¨çš„åŠ©æ‰‹</h3><p>è®­ç»ƒæ¨¡å‹åï¼Œæ‚¨å§‹ç»ˆå¸Œæœ›æ£€æŸ¥åŠ©æ‰‹çš„è¡Œä¸ºæ˜¯å¦ä»ç„¶ç¬¦åˆæ‚¨çš„æœŸæœ›ã€‚åœ¨Rasaå¼€æ”¾æºä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>tests/</code>ç›®å½•ä¸­å®šä¹‰çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¥è¿è¡Œæµ‹è¯•å¯¹è¯ï¼Œä»¥ç¡®ä¿NLUå’ŒCoreéƒ½èƒ½åšå‡ºæ­£ç¡®çš„é¢„æµ‹ã€‚</p><pre class=" language-shell"><code class="language-shell">rasa test</code></pre><p>è¯·å‚é˜…<a href="#">æµ‹è¯•æ‚¨çš„åŠ©æ‰‹</a>ä»¥äº†è§£æœ‰å…³åœ¨æ”¹è¿›æ¨¡å‹æ—¶å¦‚ä½•è¯„ä¼°æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="8-ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ"><a href="#8-ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ" class="headerlink" title="8.ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ"></a>8.ä¸æ‚¨çš„åŠ©æ‰‹äº¤è°ˆ</h3><p>æ­å–œä½ ï¼ğŸš€æ‚¨åˆšåˆšæ„å»ºäº†ä¸€ä¸ªå®Œå…¨ç”±æœºå™¨å­¦ä¹ é©±åŠ¨çš„åŠ©æ‰‹ã€‚</p><p>ä¸‹ä¸€æ­¥å°±æ˜¯å°è¯•ä¸€ä¸‹ï¼å¦‚æœæ‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šéµå¾ªæœ¬æ•™ç¨‹ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹ä¸åŠ©æ‰‹äº¤è°ˆï¼š</p><pre class=" language-shell"><code class="language-shell">rasa shell</code></pre><h2 id="æ•™ç¨‹ï¼šæ„å»ºåŠ©ç†"><a href="#æ•™ç¨‹ï¼šæ„å»ºåŠ©ç†" class="headerlink" title="æ•™ç¨‹ï¼šæ„å»ºåŠ©ç†"></a>æ•™ç¨‹ï¼šæ„å»ºåŠ©ç†</h2><p>åœ¨éµå¾ªäº†<a href="#">Rasaæ•™ç¨‹</a>ä¸­è®¾ç½®åŠ©æ‰‹çš„åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å°†é€æ­¥æ„å»ºä¸€ä¸ªåŸºæœ¬çš„FAQèŠå¤©æœºå™¨äººï¼Œç„¶åæ„å»ºä¸€ä¸ªå¯ä»¥å¤„ç†ä¸Šä¸‹æ–‡å¯¹è¯çš„æœºå™¨äººã€‚</p><ul><li><a href="#">æ„å»ºä¸€ä¸ªç®€å•çš„FAQåŠ©æ‰‹</a><ul><li><a href="#">è®°å¿†æ”¿ç­–</a></li><li><a href="#">å“åº”é€‰æ‹©å™¨</a></li></ul></li><li><a href="#">æ„å»ºä¸Šä¸‹æ–‡åŠ©ç†</a><ul><li><a href="#">å¤„ç†ä¸šåŠ¡é€»è¾‘</a></li><li><a href="#">å¤„ç†æ„å¤–çš„ç”¨æˆ·è¾“å…¥</a><ul><li><a href="#">æ™®é€šæ„Ÿå¹è¯</a></li><li><a href="#">æƒ…å¢ƒé—®é¢˜</a></li></ul></li><li><a href="#">ä¼˜é›…å¤±è´¥</a><ul><li><a href="#">åå¤‡æ”¿ç­–</a></li><li><a href="#">è¶…å‡ºèŒƒå›´æ„å›¾</a></li></ul></li><li><a href="#">æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯</a><ul><li><a href="#">å¢å¼ºè®°å¿†æ”¿ç­–</a></li><li><a href="#">ä½¿ç”¨MLè¿›è¡Œæ¦‚æ‹¬</a></li></ul></li></ul></li></ul><h3 id="æ„å»ºä¸€ä¸ªç®€å•çš„FAQåŠ©æ‰‹"><a href="#æ„å»ºä¸€ä¸ªç®€å•çš„FAQåŠ©æ‰‹" class="headerlink" title="æ„å»ºä¸€ä¸ªç®€å•çš„FAQåŠ©æ‰‹"></a>æ„å»ºä¸€ä¸ªç®€å•çš„FAQåŠ©æ‰‹</h3><p>FAQåŠ©æ‰‹æ˜¯æœ€ç®€å•çš„åŠ©æ‰‹ï¼Œä¹Ÿæ˜¯å…¥é—¨çš„å¥½åœ°æ–¹ã€‚è¿™äº›åŠ©æ‰‹å…è®¸ç”¨æˆ·æå‡ºä¸€ä¸ªç®€å•çš„é—®é¢˜å¹¶å¾—åˆ°ç­”å¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸“é—¨ä¸ºæ­¤ç±»åŠ©æ‰‹è®¾è®¡çš„RasaåŠŸèƒ½æ¥æ„å»ºåŸºæœ¬çš„FAQåŠ©æ‰‹ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»¥ä¸‹ä¸»é¢˜ï¼š</p><ul><li>é€šè¿‡MemoizationPolicy<a href="#">å“åº”ç®€å•çš„æ„å›¾</a></li><li>ä½¿ç”¨ResponseSelector<a href="#">å¤„ç†å¸¸è§é—®é¢˜</a></li></ul><p>ä¸ºäº†å‡†å¤‡æœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•å¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„Rasaé¡¹ç›®ã€‚</p><pre class=" language-shell"><code class="language-shell">mkdir rasa-assistantrasa init</code></pre><p>è®©æˆ‘ä»¬ä»botä¸­åˆ é™¤é»˜è®¤å†…å®¹ï¼Œä»¥ä¾¿<code>nlu.md</code>ï¼Œ<code>stories.md</code> å’Œ<code>domain.yml</code>æ–‡ä»¶ä¸ºç©ºã€‚</p><h4 id="Memoization-Policy"><a href="#Memoization-Policy" class="headerlink" title="Memoization Policy"></a>Memoization Policy</h4><p>MemoizationPolicyæœ€å¤šå¯ä»¥è®°ä½è®­ç»ƒæ•…äº‹ä¸­çš„ç¤ºä¾‹<code>max_history</code> ã€‚â€œturnsâ€æ¬¡æ•°åŒ…æ‹¬ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ä»¥åŠåŠ©æ‰‹æ‰§è¡Œçš„æ“ä½œã€‚å‡ºäºç®€å•ï¼Œæ— ä¸Šä¸‹æ–‡çš„FAQæœºå™¨äººçš„ç›®çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ³¨æ„ç”¨æˆ·å‘é€çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º<code>1</code>ã€‚</p><p>æ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç¼–è¾‘<code>config.yml</code>æ–‡ä»¶æ¥å®Œæˆæ­¤æ“ä½œï¼ˆç°åœ¨å¯ä»¥åˆ é™¤<code>TEDPolicy</code>ï¼‰ï¼š</p><pre class=" language-shell"><code class="language-shell">policies:- name: MemoizationPolicy  max_history: 1- name: MappingPolicy</code></pre><blockquote><p>æ³¨æ„</p><p>MappingPolicyä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œæ˜¯å› ä¸ºå®ƒå¤„ç†äº†<code>/restart</code>æ„å›¾çš„é€»è¾‘ï¼Œè¿™ä½¿æ‚¨å¯ä»¥æ¸…é™¤å¯¹è¯å†å²è®°å½•å¹¶é‡æ–°å¼€å§‹ã€‚</p></blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ–‡ä»¶æ·»åŠ ä¸€äº›æ•…äº‹<code>goodbye</code>ï¼Œ<code>thank</code>å¹¶å‘æ–‡ä»¶æ·»åŠ <code>greet</code> æ„å›¾<code>stories.md</code>ï¼š</p><pre class=" language-text"><code class="language-text">## greet* greet  - utter_greet## thank* thank  - utter_noworries## goodbye* bye  - utter_bye</code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦<code>domain.yml</code>åœ¨ä»¥ä¸‹å„èŠ‚ä¸­å‘æ–‡ä»¶æ·»åŠ æ„å›¾ï¼Œæ“ä½œå’Œå“åº”ï¼š</p><pre class=" language-shell"><code class="language-shell">intents:  - greet  - bye  - thankresponses:  utter_noworries:    - text: No worries!  utter_greet:    - text: Hi  utter_bye:    - text: Bye!</code></pre><p>æœ€åï¼Œæˆ‘ä»¬å°†ä»Saraå¤åˆ¶ä¸€äº›NLUæ•°æ®åˆ°æˆ‘ä»¬çš„<code>nlu.md</code>æ–‡ä»¶ä¸­ï¼ˆæ›´å¤šä¿¡æ¯å¯ä»¥åœ¨<a href="#">è¿™é‡Œ</a>æ‰¾åˆ°ï¼‰ï¼š</p><pre class=" language-text"><code class="language-text">## intent:greet- Hi- Hey- Hi bot- Hey bot- Hello- Good morning- hi again- hi folks## intent:bye- goodbye- goodnight- good bye- good night- see ya- toodle-oo- bye bye- gotta go- farewell## intent:thank- Thanks- Thank you- Thank you so much- Thanks bot- Thanks for that- cheers</code></pre><p>æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è®­ç»ƒç¬¬ä¸€ä¸ªæ¨¡å‹å¹¶æµ‹è¯•æœºå™¨äººï¼š</p><pre class=" language-shell"><code class="language-shell">rasa trainrasa shell</code></pre><p>è¯¥æœºå™¨äººç°åœ¨åº”è¯¥èƒ½å¤Ÿä»¥ä»»ä½•é¡ºåºç­”å¤æˆ‘ä»¬ä¸€è‡´å®šä¹‰çš„æ„å›¾ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><img src="/2020/10/02/rasa-zhi-nan/2.png"></p><p>äº¤äº’å¼åœ°æµ‹è¯•botå¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜åº”è¯¥æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™äº›ç”¨ä¾‹ä»¥åå¯ä»¥åŒ…å«åœ¨<a href="#">CI / CDç³»ç»Ÿä¸­</a>ã€‚ç«¯åˆ°ç«¯çš„<a href="#">æµ‹è¯•å¯¹è¯</a> åŒ…æ‹¬NLUæ•°æ®ï¼Œå› æ­¤å¯ä»¥æµ‹è¯•Rasaçš„ä¸¤ä¸ªç»„ä»¶ã€‚è¯¥æ–‡ä»¶ <code>tests/conversation_tests.md</code>åŒ…å«ç¤ºä¾‹æµ‹è¯•å¯¹è¯ã€‚åˆ é™¤æ‰€æœ‰æµ‹è¯•å¯¹è¯ï¼Œå¹¶ä»¥è¿„ä»Šä¸ºæ­¢åˆ°ç›®å‰ä¸ºæ­¢æ‚¨çš„åŠ©æ‰‹çš„ä¸€äº›æµ‹è¯•å¯¹è¯æ¥ä»£æ›¿å®ƒä»¬ï¼š</p><pre><code>## greet + goodbye* greet: Hi!  - utter_greet* bye: Bye  - utter_bye## greet + thanks* greet: Hello there  - utter_greet* thank: thanks a bunch  - utter_noworries## greet + thanks + goodbye* greet: Hey  - utter_greet* thank: thank you  - utter_noworries* bye: bye bye  - utter_bye</code></pre><p>è¦é’ˆå¯¹æµ‹è¯•æ–‡ä»¶æµ‹è¯•æ¨¡å‹ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre><code>rasa test --stories tests/conversation_tests.md</code></pre><p>æµ‹è¯•å‘½ä»¤å°†äº§ç”Ÿä¸€ä¸ªåä¸ºçš„ç›®å½•<code>results</code>ã€‚å®ƒåº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºçš„æ–‡ä»¶<code>failed_stories.md</code>ï¼Œå…¶ä¸­å°†æ‰“å°ä»»ä½•å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ã€‚å®ƒè¿˜å°†æŒ‡å®šæ˜¯é”™è¯¯çš„NLUè¿˜æ˜¯Coreé¢„æµ‹ã€‚ä½œä¸ºCI / CDç®¡é“çš„ä¸€éƒ¨åˆ†ï¼Œæµ‹è¯•é€‰é¡¹<code>--fail-on-prediction-errors</code>å¯ç”¨äºå¼•å‘å¼‚å¸¸ï¼Œä»è€Œåœæ­¢ç®¡é“ã€‚</p><h4 id="å“åº”é€‰æ‹©å™¨"><a href="#å“åº”é€‰æ‹©å™¨" class="headerlink" title="å“åº”é€‰æ‹©å™¨"></a>å“åº”é€‰æ‹©å™¨</h4><p>è¯¥<a href="#">ResponseSelector</a> NLUç»„ä»¶çš„è®¾è®¡ï¼Œä½¿å…¶æ›´å®¹æ˜“å¤„ç†å¯¹è¯å…ƒç´ ï¼Œå¦‚<a href="#">å°å¯¹è¯</a>å’Œå¸¸è§é—®é¢˜çš„ä¿¡æ¯ä»¥ç®€å•çš„æ–¹å¼ã€‚é€šè¿‡ä½¿ç”¨ResponseSelectorï¼Œæ‚¨åªéœ€è¦ä¸€ä¸ªæ•…äº‹å³å¯å¤„ç†æ‰€æœ‰FAQï¼Œè€Œæ— éœ€åœ¨æ¯æ¬¡æƒ³è¦å¢åŠ æœºå™¨äººçš„èŒƒå›´æ—¶æ·»åŠ æ–°æ•…äº‹ã€‚</p><p>äººä»¬å¸¸å¸¸é—®Rasaå‘¨è¾¹Rasaäº§å“ä¸åŒçš„é—®é¢˜ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹æœ‰ä¸‰ä¸ªæ„å›¾ï¼š<code>ask_channels</code>ï¼Œ<code>ask_languages</code>ï¼Œå’Œ<code>ask_rasax</code>ã€‚æˆ‘ä»¬å°†ä»<a href="#">Saraè®­ç»ƒæ•°æ®ä¸­</a>å¤åˆ¶ä¸€äº›NLU<a href="#">æ•°æ®</a> åˆ°æˆ‘ä»¬çš„<code>nlu.md</code>ã€‚è¿™äº›æ„å›¾å¿…é¡»å¸¦æœ‰<code>faq/</code>å‰ç¼€ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› æ­¤ResponseSelectorä¼šå°†å®ƒä»¬è¯†åˆ«ä¸ºå¸¸è§é—®é¢˜æ„å›¾ï¼š</p><pre class=" language-text"><code class="language-text">## intent: faq/ask_channels- What channels of communication does rasa support?- what channels do you support?- what chat channels does rasa uses- channels supported by Rasa- which messaging channels does rasa support?## intent: faq/ask_languages- what language does rasa support?- which language do you support?- which languages supports rasa- can I use rasa also for another laguage?- languages supported## intent: faq/ask_rasax- I want information about rasa x- i want to learn more about Rasa X- what is rasa x?- Can you tell me about rasa x?- Tell me about rasa x- tell me what is rasa x</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦<code>responses.md</code>åœ¨<code>data/</code>ç›®å½•ä¸­çš„æ–°æ–‡ä»¶ä¸­å®šä¹‰ä¸è¿™äº›FAQç›¸å…³çš„å“åº”ï¼š</p><pre class=" language-reStructuredText"><code class="language-reStructuredText">* faq/ask_channels  - We have a comprehensive list of [supported connectors](https://rasa.com/docs/core/connectors/), but if    you don't see the one you're looking for, you can always create a custom connector by following    [this guide](https://rasa.com/docs/rasa/user-guide/connectors/custom-connectors/).## ask languages* faq/ask_languages  - You can use Rasa to build assistants in any language you want!## ask rasa x* faq/ask_rasax - Rasa X is a tool to learn from real conversations and improve your assistant. Read more [here](https://rasa.com/docs/rasa-x/)</code></pre><p>ResponseSelectoråº”è¯¥å·²ç»åœ¨æˆ‘ä»¬çš„NLUç®¡é“çš„æœ«å°¾<code>config.yml</code>ï¼š</p><pre class=" language-shell"><code class="language-shell">language: enpipeline:  - name: WhitespaceTokenizer  - name: RegexFeaturizer  - name: LexicalSyntacticFeaturizer  - name: CountVectorsFeaturizer  - name: CountVectorsFeaturizer    analyzer: "char_wb"    min_ngram: 1    max_ngram: 4  - name: DIETClassifier    epochs: 100  - name: EntitySynonymMapper  - name: ResponseSelector    epochs: 100</code></pre><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº†NLUç«¯ï¼Œæˆ‘ä»¬éœ€è¦è®©Coreæ„è¯†åˆ°è¿™äº›å˜åŒ–ã€‚æ‰“å¼€<code>domain.yml</code>æ–‡ä»¶å¹¶æ·»åŠ <code>faq</code>æ„å›¾ï¼š</p><pre><code>intents:  - greet  - bye  - thank  - faq</code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª<a href="#">æ£€ç´¢åŠ¨ä½œ</a>ï¼Œè¯¥<a href="#">åŠ¨ä½œ</a>è´Ÿè´£å°†ResponseSelectoré¢„æµ‹çš„å“åº”å‘é€å›ç”¨æˆ·åˆ°åŠ¨ä½œåˆ—è¡¨ã€‚è¿™äº›æ“ä½œå§‹ç»ˆå¿…é¡»ä»¥<code>respond_</code>å‰ç¼€å¼€å¤´ï¼š</p><pre><code>actions:  - respond_faq</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªstoryï¼Œä»¥ä¾¿CoreçŸ¥é“è¦é¢„æµ‹çš„åŠ¨ä½œï¼š</p><pre><code>## Some question from FAQ* faq    - respond_faq</code></pre><p>å¦‚æˆ‘ä»¬å‰é¢æ‰€è¿°ï¼Œæ­¤é¢„æµ‹ç”±MemoizationPolicyå¤„ç†ã€‚</p><p>å®Œæˆæ‰€æœ‰æ›´æ”¹åï¼Œè®­ç»ƒæ–°æ¨¡å‹å¹¶æµ‹è¯•ä¿®æ”¹åçš„FAQï¼š</p><pre><code>rasa trainrasa shell</code></pre><p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæœ‰å¿…è¦<code>test_stories.md</code>å†æ¬¡å‘æ–‡ä»¶æ·»åŠ ä¸€äº›æµ‹è¯•ç”¨ä¾‹ï¼š</p><pre><code>## ask channels* faq: What messaging channels does Rasa support?  - respond_faq## ask languages* faq: Which languages can I build assistants in?  - respond_faq## ask rasa x* faq: Whatâ€™s Rasa X?  - respond_faq</code></pre><p>æ‚¨å¯ä»¥åœ¨æ­¤<a href="#">åšå®¢æ–‡ç« </a>å’Œâ€œ <a href="#">æ£€ç´¢æ“ä½œâ€</a>é¡µé¢ä¸­é˜…è¯»æ›´å¤šå†…å®¹ã€‚</p><p>ä½¿ç”¨æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­æè¿°çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è½»æ¾æ„å»ºæ— ä¸Šä¸‹æ–‡åŠ©æ‰‹ã€‚å½“æ‚¨å‡†å¤‡ä½¿ç”¨ä¸Šä¸‹æ–‡å¢å¼ºåŠ©æ‰‹æ—¶ï¼Œè¯·æŸ¥çœ‹<a href="#">æ„å»ºä¸Šä¸‹æ–‡åŠ©æ‰‹</a>ã€‚</p><blockquote><p>æ³¨æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ä¸ºæ„å»ºåŸºæœ¬çš„FAQåŠ©æ‰‹è€Œä¿®æ”¹çš„æ–‡ä»¶çš„æœ€å°æ¸…å•ï¼š</p><ul><li><p>data/nlu.mdï¼šä¸ºfaq/æ„å›¾æ·»åŠ NLUè®­ç»ƒæ•°æ®</p></li><li><p>data/responses.mdï¼šæ·»åŠ ä¸faq/æ„å›¾ç›¸å…³çš„å“åº”</p></li><li><p>config.ymlï¼šReponseSelectoråœ¨æ‚¨çš„NLUç®¡é“ä¸­æ·»åŠ </p></li><li><p>domain.ymlï¼šæ·»åŠ æ£€ç´¢åŠ¨ä½œrespond_faqå’Œæ„å›¾faq</p></li><li><p>data/stories.mdï¼šä¸ºå¸¸è§é—®é¢˜è§£ç­”æ·»åŠ ç®€å•çš„æ•…äº‹</p></li><li><p>test_stories.mdï¼šä¸ºæ‚¨çš„å¸¸è§é—®é¢˜è§£ç­”æ·»åŠ E2Eæµ‹è¯•æ¡ˆä¾‹</p></li></ul></blockquote><h4 id="æ„å»ºä¸€ä¸ªä¸Šä¸‹æ–‡åŠ©æ‰‹"><a href="#æ„å»ºä¸€ä¸ªä¸Šä¸‹æ–‡åŠ©æ‰‹" class="headerlink" title="æ„å»ºä¸€ä¸ªä¸Šä¸‹æ–‡åŠ©æ‰‹"></a>æ„å»ºä¸€ä¸ªä¸Šä¸‹æ–‡åŠ©æ‰‹</h4><p>æ— è®ºæ‚¨æ˜¯åˆšåˆšåˆ›å»ºFAQæœºå™¨äººè¿˜æ˜¯ä»å¤´å¼€å§‹ï¼Œä¸‹ä¸€æ­¥éƒ½æ˜¯æ‰©å±•æ‚¨çš„botæ¥å¤„ç†ä¸Šä¸‹æ–‡å¯¹è¯ã€‚</p><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¶µç›–å„ç§ä¸»é¢˜ï¼š</p><ul><li><a href="#">å¤„ç†ä¸šåŠ¡é€»è¾‘</a></li><li><a href="#">å¤„ç†æ„å¤–çš„ç”¨æˆ·è¾“å…¥</a></li><li><a href="#">ä¼˜é›…å¤±è´¥</a></li><li><a href="#">æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯</a></li></ul><p>åœ¨å¼€å§‹æœ¬éƒ¨åˆ†ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ä»â€œ<a href="#">æ„å»ºç®€å•çš„FAQåŠ©æ‰‹â€</a>éƒ¨åˆ†è·å–äº†æ‰€æœ‰æ•°æ®ã€‚æ‚¨å°†éœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨éœ€è¦æ³¨æ„ä¸Šä¸‹æ–‡ï¼š</p><pre><code>policies:- name: MemoizationPolicy- name: MappingPolicy</code></pre><p>æˆ‘ä»¬åˆ é™¤äº†é…ç½®ã€‚é»˜è®¤å€¼ä¸ºï¼Œè¿™æ„å‘³ç€Coreè¿›è¡Œé¢„æµ‹æ—¶ä¼šæ³¨æ„è¿‡å»5åœˆï¼ˆè¯·å‚é˜…<a href="#">æœ€å¤§å†å²è®°å½•çš„</a>è¯´æ˜ï¼‰ã€‚<code>max_history: 15</code></p><h4 id="å¤„ç†ä¸šåŠ¡é€»è¾‘"><a href="#å¤„ç†ä¸šåŠ¡é€»è¾‘" class="headerlink" title="å¤„ç†ä¸šåŠ¡é€»è¾‘"></a>å¤„ç†ä¸šåŠ¡é€»è¾‘</h4><p>è®¸å¤šå¯¹è¯åŠ©æ‰‹çš„ç”¨æˆ·ç›®æ ‡éƒ½æ˜¯åœ¨èƒ½å¤Ÿä¸ºç”¨æˆ·åšæŸäº‹ä¹‹å‰å…ˆä»ç”¨æˆ·é‚£é‡Œæ”¶é›†ä¸€å †ä¿¡æ¯ã€‚è¿™ç§°ä¸ºæ’æ§½å¡«å……ã€‚ä¾‹å¦‚ï¼Œåœ¨é“¶è¡Œä¸šä¸­ï¼Œæ‚¨å¯èƒ½æœ‰ä¸€ä¸ªè½¬ç§»èµ„é‡‘çš„ç”¨æˆ·ç›®æ ‡ï¼Œåœ¨è¿™é‡Œæ‚¨éœ€è¦æ”¶é›†æœ‰å…³ä»å“ªä¸ªå¸æˆ·è½¬è´¦ï¼Œå‘è°è½¬è´¦ä»¥åŠè½¬è´¦é‡‘é¢çš„ä¿¡æ¯ã€‚å¯ä»¥è€Œä¸”åº”è¯¥ä»¥åŸºäºè§„åˆ™çš„æ–¹å¼å¤„ç†è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºå¾ˆæ¸…æ¥šåº”è¯¥å¦‚ä½•æ”¶é›†æ­¤ä¿¡æ¯ã€‚</p><p>å¯¹äºè¿™ç§ç±»å‹çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Formså’ŒFormPolicyã€‚è¯¥<a href="#">FormPolicy</a> çš„å·¥ä½œåŸç†æ˜¯ï¼Œç›´åˆ°æ‰€æœ‰çš„ä¿¡æ¯ä»ç”¨æˆ·æ”¶é›†é¢„æµ‹å½¢å¼ä¸‹ä¸€ä¸ªåŠ¨ä½œã€‚</p><p>ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†æ„å»ºSaraçš„SalesFormã€‚ç”¨æˆ·æƒ³è¦è”ç³»æˆ‘ä»¬çš„é”€å”®å›¢é˜Ÿï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>ä»–ä»¬çš„å·¥ä½œ</li><li>ä»–ä»¬çš„æœºå™¨äººç”¨ä¾‹</li><li>ä»–ä»¬çš„åå­—</li><li>ä»–ä»¬çš„ç”µå­é‚®ä»¶</li><li>ä»–ä»¬çš„é¢„ç®—</li><li>ä»–ä»¬çš„å…¬å¸</li></ul><p>æˆ‘ä»¬å°†ä»<code>SalesForm</code>åœ¨åä¸ºçš„æ–‡ä»¶ä¸­å°†å…¶å®šä¹‰ä¸ºæ–°ç±»å¼€å§‹<code>actions.py</code>ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰çš„ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯åç§°ï¼Œå°±åƒåœ¨å¸¸è§„Actionä¸­ä¸€æ ·ï¼Œå®ƒè¿”å›å°†åœ¨æˆ‘ä»¬çš„storyä¸­ä½¿ç”¨çš„åç§°ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>forms <span class="token keyword">import</span> FormAction<span class="token keyword">class</span> <span class="token class-name">SalesForm</span><span class="token punctuation">(</span>FormAction<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Collects sales information and adds it to the spreadsheet"""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"sales_form"</span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰<code>required_slots</code>ä¸€ç§æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŒ‡å®šè¦è¯¢é—®çš„ä¿¡æ¯ï¼Œå³è¦å¡«å……çš„æ’æ§½ã€‚</p><pre class=" language-python"><code class="language-python">@staticmethod<span class="token keyword">def</span> <span class="token function">required_slots</span><span class="token punctuation">(</span>tracker<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>        <span class="token string">"job_function"</span><span class="token punctuation">,</span>        <span class="token string">"use_case"</span><span class="token punctuation">,</span>        <span class="token string">"budget"</span><span class="token punctuation">,</span>        <span class="token string">"person_name"</span><span class="token punctuation">,</span>        <span class="token string">"company"</span><span class="token punctuation">,</span>        <span class="token string">"business_email"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span></code></pre><p>æ³¨æ„ï¼šæ‚¨å¯ä»¥å°†æ‰€éœ€çš„æ’æ§½åŠŸèƒ½è‡ªå®šä¹‰ä¸ºéé™æ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>job_function</code>æ˜¯å¼€å‘äººå‘˜ï¼Œåˆ™å¯ä»¥æ·»åŠ <code>required_slot</code>ä¸Rasaæœ‰å…³çš„ç”¨æˆ·ä½“éªŒçº§åˆ«</p><p>å®Œæˆæ­¤æ“ä½œåï¼Œæ‚¨éœ€è¦æŒ‡å®šæœºå™¨äººåº”å¦‚ä½•è¯·æ±‚æ­¤ä¿¡æ¯ã€‚è¿™æ˜¯é€šè¿‡<code>utter_ask_{slotname}</code>åœ¨<code>domain.yml</code>æ–‡ä»¶ä¸­æŒ‡å®šå“åº”æ¥å®Œæˆçš„ã€‚å¯¹äºä¸Šè¿°å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä»¥ä¸‹å†…å®¹</p><pre class=" language-reStructuredText"><code class="language-reStructuredText">utter_ask_business_email:  - text: What's your business email?utter_ask_company:  - text: What company do you work for?utter_ask_budget:  - text: "What's your annual budget for conversational AI? ğŸ’¸"utter_ask_job_function:  - text: "What's your job? ğŸ•´"utter_ask_person_name:  - text: What's your name?utter_ask_use_case:  - text: What's your use case?</code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>domain.yml</code>æ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰è¿™äº›æ’æ§½ï¼š</p><pre class=" language-reStructuredText"><code class="language-reStructuredText">slots:  company:    type: unfeaturized  job_function:    type: unfeaturized  person_name:    type: unfeaturized  budget:    type: unfeaturized  business_email:    type: unfeaturized  use_case:    type: unfeaturized</code></pre><p>å›åˆ°æˆ‘ä»¬çš„è¡¨å•å®šä¹‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰<code>submit</code>æ–¹æ³•ï¼Œä¸€æ—¦è¡¨å•å®Œæˆï¼Œå®ƒå°†å¯¹ç”¨æˆ·æä¾›çš„ä¿¡æ¯åšä¸€äº›äº‹æƒ…ï¼š</p><pre><code>def submit(        self,        dispatcher: CollectingDispatcher,        tracker: Tracker,        domain: Dict[Text, Any],    ) -&gt; List[Dict]:    dispatcher.utter_message("Thanks for getting in touch, weâ€™ll contact you soon")    return []</code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…å‘Šè¯‰ç”¨æˆ·æˆ‘ä»¬å°†ä¸ä»–ä»¬è”ç³»ï¼Œä½†æ˜¯é€šå¸¸æ‚¨ä¼šå°†è¿™äº›ä¿¡æ¯å‘é€åˆ°APIæˆ–æ•°æ®åº“ã€‚æœ‰å…³ å¦‚ä½•åœ¨ç”µå­è¡¨æ ¼ä¸­å­˜å‚¨æ­¤ä¿¡æ¯çš„ç¤ºä¾‹ï¼Œè¯·å‚è§<a href="https://github.com/RasaHQ/rasa-demo/blob/master/actions/actions.py#L71">rasa-demo</a>ã€‚</p><p>æˆ‘ä»¬éœ€è¦å°†åˆšåˆšåˆ›å»ºçš„è¡¨å•æ·»åŠ åˆ°<code>domain.yml</code>æ–‡ä»¶ä¸­çš„æ–°éƒ¨åˆ†ï¼š</p><pre><code>forms:  - sales_form</code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ¿€æ´»è¡¨å•çš„æ„å›¾ï¼Œä»¥åŠä¸€ä¸ªæä¾›è¡¨å•è¦æ±‚ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯çš„æ„å›¾ã€‚å¯¹äºè¡¨å•æ¿€æ´»æ„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºçš„æ„å›¾<code>contact_sales</code>ã€‚å°†ä»¥ä¸‹è®­ç»ƒæ•°æ®æ·»åŠ åˆ°æ‚¨çš„nluæ–‡ä»¶ä¸­ï¼š</p><pre><code>## intent:contact_sales- I wanna talk to your sales people.- I want to talk to your sales people- I want to speak with sales- Sales- Please schedule a sales call- Please connect me to someone from sales- I want to get in touch with your sales guys- I would like to talk to someone from your sales team- sales please</code></pre><p>æ‚¨å¯ä»¥åœ¨<a href="https://github.com/RasaHQ/rasa-demo/blob/master/data/nlu/nlu.md#intentcontact_sales">æ­¤å¤„</a>æŸ¥çœ‹å®Œæ•´çš„æ„å›¾ï¼‰</p><p>æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ªåä¸ºçš„æ„å›¾<code>inform</code>ï¼Œè¯¥æ„å›¾æ¶µç›–ç”¨æˆ·æä¾›ç»™æœºå™¨äººçš„ä»»ä½•ä¿¡æ¯ã€‚<em>ä¹‹æ‰€ä»¥å°†æ‰€æœ‰è¿™äº›éƒ½æ”¾åœ¨ä¸€ä¸ªæ„å›¾ä¸‹ï¼Œæ˜¯å› ä¸ºåœ¨æä¾›ä¿¡æ¯ä¹‹åå¹¶æ²¡æœ‰çœŸæ­£çš„æ„å›¾ï¼Œåªæœ‰å®ä½“å¾ˆé‡è¦ã€‚</em>å°†ä»¥ä¸‹æ•°æ®æ·»åŠ åˆ°æ‚¨çš„NLUæ–‡ä»¶ä¸­ï¼š</p><pre><code>## intent:inform- [100k](budget)- [100k](budget)- [240k/year](budget)- [150,000 USD](budget)- I work for [Rasa](company)- The name of the company is [ACME](company)- company: [Rasa Technologies](company)- it's a small company from the US, the name is [Hooli](company)- it's a tech company, [Rasa](company)- [ACME](company)- [Rasa Technologies](company)- [maxmeier@firma.de](business_email)- [bot-fan@bots.com](business_email)- [maxmeier@firma.de](business_email)- [bot-fan@bots.com](business_email)- [my email is email@rasa.com](business_email)- [engineer](job_function)- [brand manager](job_function)- [marketing](job_function)- [sales manager](job_function)- [growth manager](job_function)- [CTO](job_function)- [CEO](job_function)- [COO](job_function)- [John Doe](person_name)- [Jane Doe](person_name)- [Max Mustermann](person_name)- [Max Meier](person_name)- We plan to build a [sales bot](use_case) to increase our sales by 500%.- we plan to build a [sales bot](use_case) to increase our revenue by 100%.- a [insurance tool](use_case) that consults potential customers on the best life insurance to choose.- we're building a [conversational assistant](use_case) for our employees to book meeting rooms.</code></pre><blockquote><p>æ³¨æ„</p><p>åƒ<code>business_email</code>å’Œ<code>budget</code>è¿™æ ·çš„å®ä½“é€šå¸¸ç”±ç»è¿‡é¢„è®­ç»ƒçš„å®ä½“æå–å™¨ï¼ˆä¾‹å¦‚<a href="#">DucklingHTTPExtractor</a>æˆ–<a href="#">SpacyEntityExtractor</a>ï¼‰å¤„ç†ï¼Œä½†æ˜¯å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å¸Œæœ›é¿å…ä»»ä½•å…¶ä»–è®¾ç½®ã€‚</p></blockquote><p>æ„å›¾å’Œå®ä½“ä¹Ÿéœ€è¦æ·»åŠ åˆ°æ‚¨çš„<code>domain.yml</code>æ–‡ä»¶ä¸­ï¼š</p><pre><code>intents:  - greet  - bye  - thank  - faq  - contact_sales  - informentities:  - company  - job_function  - person_name  - budget  - business_email  - use_case</code></pre><p>è¡¨å•çš„æ•…äº‹éå¸¸ç®€å•ï¼Œå› ä¸ºæ‰€æœ‰å¹¿å‘Šä½æ”¶é›†è¡¨å•éƒ½å‘ç”Ÿåœ¨è¡¨å•å†…éƒ¨ï¼Œå› æ­¤ä¸éœ€è¦åŒ…å«åœ¨æ•…äº‹ä¸­ã€‚æ‚¨åªéœ€è¦ç¼–å†™ä¸€ä¸ªæ•…äº‹ï¼Œè¯´æ˜ä½•æ—¶åº”æ¿€æ´»è¡¨å•ã€‚å¯¹äºé”€å”®è¡¨å•ï¼Œå°†æ­¤æ•…äº‹æ·»åŠ åˆ°æ‚¨çš„<code>stories.md</code>æ–‡ä»¶ä¸­ï¼š</p><pre><code>## sales form* contact_sales    - sales_form                   &lt;!--Run the sales_form action--&gt;    - form&amp;#123;"name": "sales_form"&amp;#125;   &lt;!--Activate the form--&gt;    - form&amp;#123;"name": null&amp;#125;           &lt;!--Deactivate the form--&gt;</code></pre><p>æœ€åï¼Œè®©æˆ‘ä»¬å°†FormPolicyæ·»åŠ åˆ°æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¸­ï¼š</p><pre><code>policies:  - name: MemoizationPolicy  - name: KerasPolicy  - name: MappingPolicy  - name: FormPolicy</code></pre><p>è‡³æ­¤ï¼Œæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨æ ¼ï¼Œå› æ­¤è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ç¡®ä¿å–æ¶ˆæ³¨é‡Š <code>action_endpoint</code>æ‚¨çš„ï¼Œ<code>endpoints.yml</code>ä»¥ä½¿RasaçŸ¥é“å°†è¿è¡Œæˆ‘ä»¬è¡¨å•çš„åŠ¨ä½œæœåŠ¡å™¨ï¼š</p><pre><code>action_endpoint: url: "http://localhost:5055/webhook"</code></pre><p>ç„¶ååœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨ï¼š</p><pre><code>rasa run actions</code></pre><p>ç„¶åï¼Œæ‚¨å¯ä»¥é‡æ–°è®­ç»ƒå¹¶ä¸æ‚¨çš„æœºå™¨äººå¯¹è¯ï¼š</p><pre><code>rasa trainrasa shell</code></pre><p>è¿™ç§ç®€å•çš„å½¢å¼å¯ä»¥ç«‹å³ä½¿ç”¨ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›æ·»åŠ æ›´å¤šçš„åŠŸèƒ½æ¥å¤„ç†ä¸åŒçš„æƒ…å†µã€‚å…¶ä¸­ä¸€ä¸ªç¤ºä¾‹æ˜¯éªŒè¯æ’æ§½ï¼Œä»¥ç¡®ä¿ç”¨æˆ·æ­£ç¡®æä¾›äº†ä¿¡æ¯ï¼ˆ<a href="#">åœ¨æ­¤å¤„</a>äº†è§£æ›´å¤šä¿¡æ¯ ï¼‰ã€‚</p><p>å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯ï¼Œæ‚¨å¯èƒ½æƒ³å¡«å……åç§°ç›¸åŒçš„å®ä½“ä»¥å¤–çš„ä¸œè¥¿çš„æ’æ§½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæˆ‘ä»¬è¡¨å•ä¸­çš„â€œç”¨ä¾‹â€æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·é”®å…¥å®Œæ•´çš„å¥å­ï¼Œè€Œä¸æ˜¯æ‚¨å¯èƒ½å¿…é¡»æå–ä¸ºå®ä½“çš„ä¸œè¥¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥<code>slot_mappings</code>æ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æè¿°åº”ä»ä¸­æå–å®ä½“çš„å†…å®¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥<code>from_text</code>æ–¹æ³•æå–ç”¨æˆ·çš„æ•´ä¸ªæ¶ˆæ¯ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">slot_mappings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Union<span class="token punctuation">[</span>Dict<span class="token punctuation">,</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A dictionary to map required slots to    - an extracted entity    - intent: value pairs    - a whole message    or a list of them, where a first match will be picked"""</span>    <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"use_case": self.from_text(intent="inform")&amp;#125;</span></code></pre><p>ç°åœ¨ï¼Œå½“è¯·æ±‚ç”¨ä¾‹æ’æ§½æ—¶ï¼Œæˆ‘ä»¬çš„æœºå™¨äººå°†æå–å®Œæ•´çš„ç”¨æˆ·æ¶ˆæ¯ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨<code>use_case</code>ä¹‹å‰å®šä¹‰çš„å®ä½“ã€‚</p><p>å¯ä»¥å®šåˆ¶è¡¨å•ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œä»¥å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸­çš„ä¸åŒåˆ†æ”¯ã€‚<a href="https://rasa.com/docs/rasa/core/forms/#">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³æ­¤å†…å®¹çš„æ›´å¤šä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæ‚¨åº”ç¡®ä¿ä¸è¦å¤„ç†è¡¨å•å†…æ‰€æœ‰ä¸æ„‰å¿«çš„è·¯å¾„ã€‚åº”è¯¥é€šè¿‡ç¼–å†™å¸¸è§„æ•…äº‹æ¥å¤„ç†è¿™äº›é—®é¢˜ï¼Œä»¥ä¾¿æ‚¨çš„æ¨¡å‹å¯ä»¥å­¦ä¹ è¿™ç§è¡Œä¸ºã€‚</p><blockquote><p>æ³¨æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ä¸ºä½¿ç”¨è¡¨å•æ“ä½œå¤„ç†ä¸šåŠ¡é€»è¾‘è€Œä¿®æ”¹çš„æ–‡ä»¶çš„æœ€å°æ¸…å•ï¼š</p><ul><li><p><code>actions.py</code>ï¼šå®šä¹‰å½¢å¼ä½œç”¨ï¼ŒåŒ…æ‹¬<code>required_slots</code>ï¼Œ<code>slot_mappings</code>å’Œ<code>submit</code>æ–¹æ³•</p></li><li><p><code>data/nlu.md</code>ï¼š</p><blockquote><ul><li>æ·»åŠ ç¤ºä¾‹ä»¥æ¿€æ´»è¡¨å•</li><li>æ·»åŠ ç¤ºä¾‹<code>inform</code>ä»¥å¡«å†™è¡¨å•</li></ul></blockquote></li><li><p><code>domain.yml</code>ï¼š</p><blockquote><ul><li>æ·»åŠ è¡¨æ ¼æ‰€éœ€çš„æ‰€æœ‰æ’æ§½</li><li>æ·»åŠ <code>utter_ask_{slot}</code>æ‰€æœ‰å¿…éœ€æ’æ§½çš„å“åº”</li><li>å°†è¡¨å•åŠ¨ä½œæ·»åŠ åˆ°è¯¥<code>forms</code>éƒ¨åˆ†</li><li>ä»æ‚¨çš„NLUåŸ¹è®­æ•°æ®ä¸­æ·»åŠ æ‰€æœ‰æ„å›¾å’Œå®ä½“</li></ul></blockquote></li><li><p><code>data/stories.md</code>ï¼šä¸ºè¡¨å•æ·»åŠ ä¸€ä¸ªæ•…äº‹</p></li><li><p><code>config.yml</code>ï¼š</p><blockquote><ul><li>å°†æ–°å¢<code>FormPolicy</code>è‡³æ‚¨çš„æ”¿ç­–</li><li>å°†å®ä½“æå–å™¨æ·»åŠ åˆ°ç®¡é“</li></ul></blockquote></li><li><p><code>endpoints.yml</code>ï¼šå®šä¹‰ <code>action_endpoint</code></p></li></ul></blockquote><h4 id="å¤„ç†æ„æƒ³ä¸åˆ°çš„ç”¨æˆ·è¾“å…¥"><a href="#å¤„ç†æ„æƒ³ä¸åˆ°çš„ç”¨æˆ·è¾“å…¥" class="headerlink" title="å¤„ç†æ„æƒ³ä¸åˆ°çš„ç”¨æˆ·è¾“å…¥"></a>å¤„ç†æ„æƒ³ä¸åˆ°çš„ç”¨æˆ·è¾“å…¥</h4><p>æ‰€æœ‰é¢„æœŸçš„ç”¨æˆ·è¾“å…¥éƒ½åº”é€šè¿‡æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„å½¢å¼å¤„ç†ï¼Œå³ï¼Œå¦‚æœç”¨æˆ·æä¾›äº†æœºå™¨äººæ‰€è¦æ±‚çš„ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„è¡Œä¸ºé€šå¸¸ä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å„ç§å½¢å¼çš„â€œæ„Ÿå¹è¯â€ä»¥åŠå¦‚ä½•åœ¨Rasaä¸­å¤„ç†å®ƒä»¬ã€‚</p><p>å¤„ç†è¿™äº›ç±»å‹çš„ç”¨æˆ·è¾“å…¥çš„å†³å®šåº”å§‹ç»ˆæ¥è‡ªæŸ¥çœ‹çœŸå®çš„å¯¹è¯ã€‚æ‚¨åº”è¯¥é¦–å…ˆæ„å»ºåŠ©æ‰‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸çœŸå®ç”¨æˆ·ï¼ˆæ— è®ºæ˜¯æœ€ç»ˆç”¨æˆ·è¿˜æ˜¯åŒäº‹ï¼‰è¿›è¡Œæµ‹è¯•ï¼Œç„¶åæ·»åŠ ç¼ºå¤±çš„å†…å®¹ã€‚æ‚¨ä¸åº”è¯¥å°è¯•å®æ–½æ‚¨è®¤ä¸ºå¯èƒ½å‘ç”Ÿçš„æ‰€æœ‰å¯èƒ½çš„æç«¯æƒ…å†µï¼Œå› ä¸ºæœ€ç»ˆç”¨æˆ·å¯èƒ½æ°¸è¿œä¸ä¼šä»¥è¿™ç§æ–¹å¼è¡Œäº‹ã€‚ <a href="#">Rasa X</a> æ˜¯å¯ä»¥å¸®åŠ©æ‚¨æŸ¥çœ‹å¯¹è¯å¹¶åšå‡ºæ­¤ç±»å†³å®šçš„å·¥å…·ã€‚</p><h4 id="é€šç”¨æ„Ÿå¹è¯"><a href="#é€šç”¨æ„Ÿå¹è¯" class="headerlink" title="é€šç”¨æ„Ÿå¹è¯"></a>é€šç”¨æ„Ÿå¹è¯</h4><p>å¦‚æœæ‚¨æœ‰é€šç”¨æ„Ÿå¹è¯ï¼Œæ— è®ºä¸Šä¸‹æ–‡å¦‚ä½•ï¼Œéƒ½åº”å§‹ç»ˆå…·æœ‰ç›¸åŒçš„å•ä¸ªå“åº”ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<a href="#">æ˜ å°„ç­–ç•¥</a>æ¥å¤„ç†è¿™äº›æ„Ÿå¹è¯ã€‚å®ƒå°†å§‹ç»ˆä¸ºæ„å›¾é¢„æµ‹ç›¸åŒçš„åŠ¨ä½œï¼Œå¹¶ä¸”ä¸é—å¿˜æœºåˆ¶ç»“åˆä½¿ç”¨æ—¶ï¼Œæ‚¨ä¹Ÿæ— éœ€ç¼–å†™ä»»ä½•æ•…äº‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çœ‹åˆ°ç”¨æˆ·ä¸æ‚¨çš„åŠ©æ‰‹è¿›è¡Œå¦‚ä¸‹å¯¹è¯ï¼Œä»–ä»¬åœ¨å¯¹è¯ä¸­é—´å†™äº†é—®å€™-å¯èƒ½æ˜¯å› ä¸ºä»–ä»¬ç¦»å¼€äº†å‡ åˆ†é’Ÿï¼š</p><img src="/2020/10/02/rasa-zhi-nan/3.png" style="zoom:30%;"><p>é—®å€™æ„å›¾æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°†å§‹ç»ˆç»™å‡ºç›¸åŒçš„å“åº”ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›è¿™ç§æ„å›¾å½±å“å¯¹è¯å†å²ã€‚ä¸ºæ­¤ï¼Œå“åº”å¿…é¡»æ˜¯è¿”å›<code>UserUtteranceReverted()</code>äº‹ä»¶ä»¥ä»å¯¹è¯å†å²è®°å½•ä¸­åˆ é™¤äº¤äº’çš„åŠ¨ä½œã€‚</p><p>é¦–å…ˆï¼Œæ‰“å¼€<code>domain.yml</code>æ–‡ä»¶å¹¶ä¿®æ”¹é—®å€™æ„å›¾ï¼Œç„¶å<code>actions</code>åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæ–°å—ï¼Œç„¶åï¼Œ<code>action_greet</code>å¦‚ä¸‹æ‰€ç¤ºæ·»åŠ ï¼š</p><pre class=" language-reStructuredText"><code class="language-reStructuredText">intents:  - greet: &#123;triggers: action_greet&#125;  - bye  - thank  - faq  - contact_sales  - informactions:  - action_greet</code></pre><p>å¦‚æœæœ‰ï¼Œè¯·ä½¿ç”¨â€œæ‰“æ‹›å‘¼â€æ„å›¾åˆ é™¤æ‰€æœ‰æ•…äº‹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰<code>action_greet</code>ã€‚å°†ä»¥ä¸‹æ“ä½œæ·»åŠ åˆ°<code>actions.py</code>æ–‡ä»¶ä¸­ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk <span class="token keyword">import</span> Action<span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>events <span class="token keyword">import</span> UserUtteranceReverted<span class="token keyword">class</span> <span class="token class-name">ActionGreetUser</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token triple-quoted-string string">"""Revertible mapped action for utter_greet"""</span><span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">"action_greet"</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>    dispatcher<span class="token punctuation">.</span>utter_template<span class="token punctuation">(</span><span class="token string">"utter_greet"</span><span class="token punctuation">,</span> tracker<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>UserUtteranceReverted<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>è¦æµ‹è¯•ä¿®æ”¹åçš„æ„å›¾ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å¯åŠ¨åŠ¨ä½œæœåŠ¡å™¨ï¼š</p><pre class=" language-shell"><code class="language-shell">rasa run actions</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œå¹¶å°è¯•æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><pre class=" language-shell"><code class="language-shell">rasa trainrasa shell</code></pre><p>å¸¸è§é—®é¢˜è§£ç­”æ˜¯å¦ä¸€ç§é€šç”¨æ„Ÿå¹è¯ï¼Œåº”å§‹ç»ˆå¾—åˆ°ç›¸åŒçš„å“åº”ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯èƒ½ä¼šåœ¨å¡«å†™è¡¨å•æ—¶è¯¢é—®ç›¸å…³çš„FAQï¼š</p><img src="/2020/10/02/rasa-zhi-nan/4.png" style="zoom:33%;"><p>è¦å¤„ç†é€šè¿‡æ£€ç´¢æ“ä½œå®šä¹‰çš„FAQï¼Œæ‚¨å¯ä»¥æ·»åŠ ä¸€ä¸ªç®€å•çš„storyï¼Œè¯¥æ•…äº‹å°†ç”±MemoizationPolicyå¤„ç†ï¼š</p><pre><code>## just sales, continue* contact_sales    - sales_form    - form&amp;#123;"name": "sales_form"&amp;#125;* faq    - respond_faq    - sales_form    - form&amp;#123;"name": null&amp;#125;</code></pre><p>è¿™å°†è„±ç¦»è¡¨æ ¼å¹¶å¤„ç†ç”¨æˆ·çš„FAQé—®é¢˜ï¼Œç„¶åè¿”å›åˆ°åŸå§‹ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><img src="/2020/10/02/rasa-zhi-nan/5.png" style="zoom:33%;"><p>å¦‚æœå‘ç°å¾ˆéš¾ä»¥è¿™ç§æ ¼å¼ç¼–å†™æ•…äº‹ï¼Œåˆ™å¯ä»¥éšæ—¶ä½¿ç”¨â€œ<a href="#">äº¤äº’å¼å­¦ä¹ â€</a> æ¥å¸®åŠ©æ‚¨åˆ›å»ºæ•…äº‹ã€‚</p><p>ä¸å¾€å¸¸ä¸€æ ·ï¼Œè¯·ç¡®ä¿å°†ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹æ·»åŠ åˆ°æ‚¨çš„test_stories.mdæ–‡ä»¶ä¸­ã€‚</p><h5 id="è¯­å¢ƒçš„é—®é¢˜"><a href="#è¯­å¢ƒçš„é—®é¢˜" class="headerlink" title="è¯­å¢ƒçš„é—®é¢˜"></a>è¯­å¢ƒçš„é—®é¢˜</h5><p>æ‚¨è¿˜å¯ä»¥å¤„ç†<a href="#">ä¸Šä¸‹æ–‡é—®é¢˜</a>ï¼Œä¾‹å¦‚ç”¨æˆ·è¯¢é—®é—®é¢˜â€œä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“è¿™ä¸€ç‚¹â€ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®æœºå™¨äººå·²è¯·æ±‚çš„ç‰¹å®šæ’æ§½æ¥è¯¢é—®æ­¤é—®é¢˜ï¼Œå¹¶ä¸”æ¯ä¸ªæ’æ§½çš„å“åº”åº”æœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚ï¼š</p><img src="/2020/10/02/rasa-zhi-nan/6.png" style="zoom:33%;"><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿<code>requested_slot</code>ç‰¹å¾åŒ–ï¼Œå¹¶ä¸ºå…¶åˆ†é…åˆ†ç±»ç±»å‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown">slots:  requested_slot:<span class="token code keyword">    type: categorical</span><span class="token code keyword">    values:</span><span class="token code keyword">      - business_email</span><span class="token code keyword">      - company</span><span class="token code keyword">      - person_name</span><span class="token code keyword">      - use_case</span><span class="token code keyword">      - budget</span><span class="token code keyword">      - job_function</span></code></pre><p>è¿™æ„å‘³ç€Coreåœ¨è¿›è¡Œé¢„æµ‹æ—¶ä¼šæ³¨æ„æ’æ§½çš„å€¼ï¼ˆäº†è§£æ›´å¤šæœ‰å…³å…¶ä»–<a href="#">åŠŸèƒ½åŒ–æ’æ§½çš„ä¿¡æ¯</a>ï¼‰ï¼Œè€ŒæœªåŠŸèƒ½åŒ–æ’æ§½ä»…ç”¨äºå­˜å‚¨ä¿¡æ¯ã€‚æœ‰å…³çš„æ•…äº‹åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> explain email</span><span class="token list punctuation">*</span> contact_sales<span class="token code keyword">    - sales_form</span><span class="token code keyword">    - form&amp;#123;"name": "sales_form"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "business_email"&amp;#125;</span><span class="token list punctuation">*</span> explain<span class="token code keyword">    - utter_explain_why_email</span><span class="token code keyword">    - sales_form</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span><span class="token title important"><span class="token punctuation">##</span> explain budget</span><span class="token list punctuation">*</span> contact_sales<span class="token code keyword">    - sales_form</span><span class="token code keyword">    - form&amp;#123;"name": "sales_form"&amp;#125;</span><span class="token code keyword">    - slot&amp;#123;"requested_slot": "budget"&amp;#125;</span><span class="token list punctuation">*</span> explain<span class="token code keyword">    - utter_explain_why_budget</span><span class="token code keyword">    - sales_form</span><span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre><p>æˆ‘ä»¬éœ€è¦æ·»åŠ åˆšæ·»åŠ åˆ°<code>domain.yml</code>æ–‡ä»¶ä¸­çš„æ„å›¾å’Œè¯è¯­ï¼š</p><pre class=" language-markdown"><code class="language-markdown">intents:<span class="token list punctuation">-</span> greet: <span class="token entity" title="&#123;">&amp;#123;</span>triggers: action<span class="token italic"><span class="token punctuation">_</span>greet<span class="token punctuation">_</span></span>user<span class="token entity" title="&#125;">&amp;#125;</span><span class="token list punctuation">-</span> bye<span class="token list punctuation">-</span> thank<span class="token list punctuation">-</span> faq<span class="token list punctuation">-</span> explainresponses:  utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>why_budget:  <span class="token list punctuation">-</span> text: We need to know your budget to recommend a subscription  utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>why_email:  <span class="token list punctuation">-</span> text: We need your email so we can contact you</code></pre><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè§£é‡Šç›®çš„æ·»åŠ ä¸€äº›NLUæ•°æ®ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:explain</span><span class="token list punctuation">-</span> why<span class="token list punctuation">-</span> why is that<span class="token list punctuation">-</span> why do you need it<span class="token list punctuation">-</span> why do you need to know that?<span class="token list punctuation">-</span> could you explain why you need it?</code></pre><p>ç„¶åï¼Œæ‚¨å¯ä»¥é‡æ–°è®­ç»ƒæ‚¨çš„æœºå™¨äººå¹¶å†æ¬¡è¿›è¡Œæµ‹è¯•:</p><pre><code>rasa trainrasa shell</code></pre><blockquote><p>æ³¨æ„</p><p>æ‚¨éœ€è¦ä¸ºè¯¥å¹¿å‘Šä½çš„æ¯ä¸ª<code>requested_slot</code>æ’æ§½å€¼æ·»åŠ ä¸€ä¸ªæ•…äº‹ï¼Œä»¥ä¾¿è¯¥æœºå™¨äººå¯ä»¥å¤„ç†â€œä¸ºä»€ä¹ˆè¦çŸ¥é“â€çš„æ¯ç§æƒ…å†µ</p></blockquote><p>åˆ«å¿˜äº†ä¸ºæ‚¨<code>test_stories.md</code>çš„æµ‹è¯•æ·»åŠ ä¸€äº›ç«¯åˆ°ç«¯çš„æ•…äº‹ã€‚</p><blockquote><p>æ³¨æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ä¸ºå¤„ç†æ„å¤–ç”¨æˆ·è¾“å…¥è€Œä¿®æ”¹çš„æ–‡ä»¶çš„æœ€å°æ¸…å•</p><ul><li><p><code>actions.py</code>ï¼šå®šä¹‰ <code>action_greet</code></p></li><li><p><code>data/nlu.md</code>ï¼šæ·»åŠ <code>explain</code>æ„å›¾çš„è®­ç»ƒæ•°æ®</p></li><li><p><code>domain.yml</code>ï¼š</p><blockquote><ul><li>åœ°å›¾æ„å›¾<code>greet</code>ä»¥ <code>action_greet_user</code></li><li>ä½¿<code>requested_slot</code>ä¸€ä¸ªåˆ†ç±»æ—¶éš™ä¸æ‰€æœ‰éœ€è¦çš„æ—¶éš™ä½œä¸ºå€¼</li><li>æ·»åŠ <code>explain</code>æ„å›¾</li><li>æ·»åŠ é’ˆå¯¹ä¸Šä¸‹æ–‡é—®é¢˜æ‰“æ‰°çš„å›å¤</li></ul></blockquote></li><li><p><code>data/stories.md</code>ï¼š</p><blockquote><ul><li>å¦‚æœæœ‰æ•…äº‹ï¼Œè¯·ä½¿ç”¨æ˜ å°„çš„æ„å›¾åˆ é™¤æ•…äº‹</li><li>åœ¨å¡«å†™è¡¨æ ¼æ—¶æ·»åŠ å¸¦æœ‰å¸¸è§é—®é¢˜è§£ç­”å’Œä¸Šä¸‹æ–‡ä¸­æ–­çš„æ•…äº‹</li></ul></blockquote></li></ul></blockquote><h4 id="æ­£å¸¸å¤±è´¥"><a href="#æ­£å¸¸å¤±è´¥" class="headerlink" title="æ­£å¸¸å¤±è´¥"></a>æ­£å¸¸å¤±è´¥</h4><p>å³ä½¿æ‚¨å®Œç¾åœ°è®¾è®¡äº†æœºå™¨äººï¼Œç”¨æˆ·ä¹Ÿä¸å¯é¿å…åœ°ä¼šå‘æ‚¨çš„åŠ©æ‰‹è¯´å‡ºæ‚¨æ„æ–™ä¹‹å¤–çš„äº‹æƒ…ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨çš„åŠ©æ‰‹å°†å¤±è´¥ï¼Œå› æ­¤è¯·ç¡®ä¿å…¶æ­£å¸¸è¿è¡Œå¾ˆé‡è¦ã€‚</p><h4 id="åå¤‡æ”¿ç­–"><a href="#åå¤‡æ”¿ç­–" class="headerlink" title="åå¤‡æ”¿ç­–"></a>åå¤‡æ”¿ç­–</h4><p>æœ€å¸¸è§çš„æ•…éšœä¹‹ä¸€æ˜¯NLUç½®ä¿¡åº¦ä½ï¼Œä½¿ç”¨TwoStageFallbackPolicyå¯ä»¥å¾ˆå¥½åœ°å¤„ç†å®ƒã€‚æ‚¨å¯ä»¥é€šè¿‡å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­æ¥å¯ç”¨å®ƒï¼Œ</p><pre><code>policies:  - name: TwoStageFallbackPolicy    nlu_threshold: 0.8</code></pre><p>å¹¶å°†<code>out_of_scope</code>æ„å›¾æ·»åŠ åˆ°<code>domain.yml</code>æ–‡ä»¶ä¸­ï¼š</p><pre><code>intents:- out_of_scope</code></pre><p>å½“nluç½®ä¿¡åº¦é™è‡³å®šä¹‰çš„é˜ˆå€¼ä»¥ä¸‹æ—¶ï¼Œæœºå™¨äººå°†æç¤ºç”¨æˆ·é‡æ–°è¡¨è¾¾å…¶æ¶ˆæ¯ã€‚å¦‚æœåƒµå°¸ç¨‹åºæ— æ³•ä¸‰éè·å–å…¶æ¶ˆæ¯ï¼Œåˆ™å°†é‡‡å–æœ€ç»ˆè¡ŒåŠ¨ï¼Œä¾‹å¦‚ï¼Œåƒµå°¸ç¨‹åºå¯ä»¥ç§»äº¤ç»™äººç±»ã€‚</p><p>è¦å°è¯•æ­¤æ“ä½œï¼Œè¯·é‡æ–°è®­ç»ƒæ‚¨çš„æ¨¡å‹ï¼Œç„¶åå‘æ‚¨çš„æœºå™¨äººå‘é€â€œå‘æˆ‘è®¢è´­æŠ«è¨â€ä¹‹ç±»çš„æ¶ˆæ¯ï¼š</p><pre><code>rasa trainrasa shell</code></pre><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è‡ªå®šä¹‰æ­¤ç­–ç•¥ã€‚åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºæœºå™¨äººSaraä¸­ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œäº†è‡ªå®šä¹‰ï¼Œä»¥åœ¨ä¸€å®šçš„ç½®ä¿¡åº¦èŒƒå›´å†…å‘ç”¨æˆ·å»ºè®®æ„å›¾ï¼Œä»¥ä½¿ç”¨æˆ·æ›´è½»æ¾åœ°å‘æœºå™¨äººæä¾›æ‰€éœ€çš„ä¿¡æ¯ã€‚</p><p>è¿™æ˜¯é€šè¿‡è‡ªå®šä¹‰åŠ¨ä½œæ¥å®Œæˆçš„ï¼Œ<code>ActionDefaultAskAffirmation</code>å¦‚<a href="#">Sara rasa-demoåŠ¨ä½œæœåŠ¡å™¨ä¸­æ‰€ç¤ºã€‚</a> æˆ‘ä»¬å®šä¹‰äº†ä¸€äº›æ„å›¾æ˜ å°„ï¼Œä»¥ä½¿ç”¨æˆ·å¯¹æ„å›¾çš„ç†è§£æ›´åŠ ç›´è§‚ã€‚</p><img src="/2020/10/02/rasa-zhi-nan/7.png" style="zoom:33%;"><h4 id="è¾“å‡ºèŒƒå›´æ„å›¾"><a href="#è¾“å‡ºèŒƒå›´æ„å›¾" class="headerlink" title="è¾“å‡ºèŒƒå›´æ„å›¾"></a>è¾“å‡ºèŒƒå›´æ„å›¾</h4><p>ä¼˜è‰¯ä½œæ³•æ˜¯ä¹Ÿè¦å¤„ç†æ‚¨çŸ¥é“ç”¨æˆ·å¯èƒ½ä¼šé—®çš„é—®é¢˜ï¼Œä½†æ‚¨å°šæœªé’ˆå¯¹è¿™äº›é—®é¢˜å®ç°ç”¨æˆ·ç›®æ ‡ã€‚</p><p>æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>out_of_scope</code>æ„å›¾æ¥å¤„ç†è¶…å‡ºèŒƒå›´çš„é€šç”¨è¯·æ±‚ï¼Œä¾‹å¦‚â€œæˆ‘é¥¿äº†â€ï¼Œå¹¶è®©æ¼«æ¸¸å™¨å“åº”é»˜è®¤æ¶ˆæ¯ï¼Œä¾‹å¦‚â€œæŠ±æ­‰ï¼Œæˆ‘æ— æ³•å¤„ç†è¯¥è¯·æ±‚â€ï¼š</p><pre><code>* out_of_scope  utter_out_of_scope</code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦ä¸º<code>out_of_scope</code>æ„å›¾æ·»åŠ NLUæ•°æ®ï¼š</p><pre><code>## intent:out_of_scope- I want to order food- What is 2 + 2?- Whoâ€™s the US President?- I need a job</code></pre><p>æœ€åï¼Œæˆ‘ä»¬å°†å¯¹<code>domain.yml</code>æ–‡ä»¶æ·»åŠ å“åº”ï¼š</p><pre><code>responses:  utter_out_of_scope:  - text: Sorry, I canâ€™t handle that request.</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°è®­ç»ƒå¹¶æµ‹è¯•æ­¤æ·»åŠ é¡¹</p><pre><code>rasa trainrasa shell</code></pre><p>å†å¾€å‰èµ°ï¼Œå¦‚æœæ‚¨å‘ç°ç”¨æˆ·è¦æ±‚æŸäº›äº‹æƒ…ï¼Œå°†æ¥åˆå¸Œæœ›æˆä¸ºç”¨æˆ·ç›®æ ‡ï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬ä½œä¸ºå•ç‹¬çš„æ„å›¾è¿›è¡Œå¤„ç†ï¼Œä»¥ä½¿ç”¨æˆ·çŸ¥é“æ‚¨å·²ç»ç†è§£äº†ä»–ä»¬çš„ä¿¡æ¯ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç”¨æˆ·é—®â€œæˆ‘æƒ³åœ¨Rasaç”³è¯·å·¥ä½œâ€ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å›ç­”â€œæˆ‘äº†è§£æ‚¨æ­£åœ¨å¯»æ‰¾å·¥ä½œï¼Œä½†æˆ‘ææ€•è¿˜æ— æ³•å¤„ç†è¯¥æŠ€èƒ½ã€‚â€</p><pre><code>* ask_job  utter_job_not_handled</code></pre><blockquote><p>æ³¨æ„</p><p>è¿™æ˜¯æˆ‘ä»¬ä¸ºå¸®åŠ©åŠ©æ‰‹æ­£å¸¸é€€å‡ºè€Œä¿®æ”¹çš„æ–‡ä»¶çš„æœ€å°æ¸…å•ï¼š</p><ul><li><p><code>data/nlu.md</code>ï¼š</p><blockquote><ul><li>æ·»åŠ <code>out_of_scope</code>æ„å›¾å’Œè¦å•ç‹¬å¤„ç†çš„ä»»ä½•ç‰¹å®šèŒƒå›´å¤–æ„å›¾çš„è®­ç»ƒæ•°æ®</li></ul></blockquote></li><li><p><code>data/stories.md</code>ï¼š</p><blockquote><ul><li>ä¸ºä»»ä½•è¶…å‡ºèŒƒå›´çš„æ„å›¾æ·»åŠ æ•…äº‹</li></ul></blockquote></li><li><p><code>domain.yml</code>ï¼š</p><blockquote><ul><li>æ·»åŠ <code>out_of_scope</code>æ„å›¾å’Œä»»ä½•è¶…å‡ºèŒƒå›´çš„æ„å›¾</li><li><code>utter_out_of_scope</code>ä¸ºä»»ä½•è¶…å‡ºèŒƒå›´çš„æ„å›¾æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå“åº”</li></ul></blockquote></li><li><p><code>actions.py</code>ï¼š</p><blockquote><ul><li>è‡ªå®šä¹‰<code>ActionDefaultAskAffirmation</code>å»ºè®®ç”¨æˆ·çš„æ„å›¾ï¼Œä¾›ç”¨æˆ·é€‰æ‹©</li></ul></blockquote></li><li><p><code>config.yml</code>ï¼š</p><blockquote><ul><li>å°†TwoStageFallbackPolicyæ·»åŠ åˆ°è¯¥<code>policies</code>éƒ¨åˆ†</li></ul></blockquote></li></ul></blockquote><h4 id="æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯"><a href="#æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯" class="headerlink" title="æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯"></a>æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡å¯¹è¯</h4><p>å¹¶éæ‚¨å®šä¹‰çš„æ¯ä¸ªç”¨æˆ·ç›®æ ‡éƒ½å°†å±äºä¸šåŠ¡é€»è¾‘ç±»åˆ«ã€‚å¯¹äºå…¶ä»–æƒ…å†µï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨æ•…äº‹å’Œä¸Šä¸‹æ–‡æ¥å¸®åŠ©ç”¨æˆ·å®ç°å…¶ç›®æ ‡ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»¥Saraçš„â€œå…¥é—¨â€æŠ€èƒ½ä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³æ ¹æ®ä»–ä»¬æ˜¯å¦æ›¾ç»æ„å»ºè¿‡AIåŠ©æ‰‹å¹¶ä¸”æ­£åœ¨ä»å…¶ä»–å·¥å…·è¿ç§»è€Œæ¥ï¼Œå‘ä»–ä»¬æä¾›ä¸åŒçš„ä¿¡æ¯ã€‚è¿™å¯ä»¥é€šè¿‡æ•…äº‹å¾ˆç®€å•åœ°å®Œæˆå’Œ<a href="#">æœ€å¤§å†å²</a>çš„æ¦‚å¿µã€‚</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> new to rasa + built a bot before</span> <span class="token list punctuation">*</span> how<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>get_started   <span class="token list punctuation">-</span> utter_getstarted   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>first<span class="token punctuation">_</span></span>bot<span class="token italic"><span class="token punctuation">_</span>with<span class="token punctuation">_</span></span>rasa <span class="token list punctuation">*</span> affirm   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>set<span class="token punctuation">_</span></span>onboarding   <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"onboarding": true<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>built<span class="token punctuation">_</span></span>bot_before <span class="token list punctuation">*</span> affirm   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>migration <span class="token list punctuation">*</span> deny   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>rasa_components   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>rasa<span class="token punctuation">_</span></span>components_details   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>explain_nlucorex <span class="token list punctuation">*</span> affirm   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>nlu   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>core   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>x   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>direct<span class="token punctuation">_</span></span>to_step2 <span class="token title important"><span class="token punctuation">##</span> not new to rasa + core</span> <span class="token list punctuation">*</span> how<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>get_started   <span class="token list punctuation">-</span> utter_getstarted   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>first<span class="token punctuation">_</span></span>bot<span class="token italic"><span class="token punctuation">_</span>with<span class="token punctuation">_</span></span>rasa <span class="token list punctuation">*</span> deny   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>set<span class="token punctuation">_</span></span>onboarding   <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"onboarding": false<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>which_product <span class="token list punctuation">*</span> how<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>get_started<span class="token entity" title="&#123;">&amp;#123;</span>"product": "core"<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>core   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>anything<span class="token punctuation">_</span></span>else</code></pre><p>ä¸Šé¢çš„ç¤ºä¾‹ä¸»è¦åˆ©ç”¨æ„å›¾æ¥æŒ‡å¯¼æµç¨‹ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å®ä½“å’Œæ’æ§½æ¥æŒ‡å¯¼æµç¨‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·åœ¨ä¸€å¼€å§‹å°±å‘æ‚¨æä¾›äº†Rasaçš„æ–°ä¿¡æ¯ï¼Œåˆ™æ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡å°†æ­¤ä¿¡æ¯å­˜å‚¨åœ¨æ’æ§½ä¸­æ¥è·³è¿‡æ­¤é—®é¢˜ã€‚</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> how<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>get<span class="token italic"><span class="token punctuation">_</span>started&amp;#123;"user<span class="token punctuation">_</span></span>type": "new"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"user_type":"new"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>set<span class="token punctuation">_</span></span>onboarding  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"onboarding": true<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>getstarted<span class="token punctuation">_</span></span>new  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>built<span class="token punctuation">_</span></span>bot_before</code></pre><p>ä¸ºæ­¤ï¼Œè¯·è®°ä½å¿…é¡»åœ¨<code>domain.yml</code> æ–‡ä»¶ä¸­è®¾ç½®è¯¥æ’æ§½çš„åŠŸèƒ½ã€‚è¿™æ¬¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>text</code>æ’æ§½ç±»å‹ï¼Œå› ä¸ºæˆ‘ä»¬åªåœ¨ä¹æ˜¯å¦<a href="#">è®¾ç½®</a>äº† <a href="#">æ’æ§½</a>ã€‚</p><h5 id="ç”¨MLæ¦‚æ‹¬"><a href="#ç”¨MLæ¦‚æ‹¬" class="headerlink" title="ç”¨MLæ¦‚æ‹¬"></a>ç”¨MLæ¦‚æ‹¬</h5><p>é™¤äº†ä¸Šæ–‡æ‰€è¿°çš„åŸºäºè§„åˆ™çš„ç­–ç•¥å¤–ï¼ŒCoreè¿˜æä¾›äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„MLç­–ç•¥ã€‚è¿™äº›ä½œä¸ºç­–ç•¥é…ç½®ä¸­çš„é™„åŠ å±‚è¿›å…¥ï¼Œåªæœ‰åœ¨ç”¨æˆ·éµå¾ªæ‚¨æœªæ›¾é¢„æ–™åˆ°çš„è·¯å¾„æ—¶æ‰è·³å…¥ã€‚<strong>é‡è¦çš„æ˜¯è¦äº†è§£ä½¿ç”¨è¿™äº›ç­–ç•¥å¹¶ä¸æ„å‘³ç€æ”¾å¼€å¯¹åŠ©æ‰‹çš„æ§åˆ¶æƒã€‚</strong>å¦‚æœåŸºäºè§„åˆ™çš„ç­–ç•¥èƒ½å¤Ÿåšå‡ºé¢„æµ‹ï¼Œåˆ™è¯¥é¢„æµ‹å°†å§‹ç»ˆå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼ˆ<a href="#">åœ¨æ­¤å¤„</a>äº†è§£æ›´å¤š<a href="#">ä¿¡æ¯</a>ï¼‰å¹¶é¢„æµ‹ä¸‹ä¸€ä¸ªæ“ä½œã€‚åŸºäºMLçš„ç­–ç•¥ä¸ºæ‚¨çš„åŠ©æ‰‹æä¾›äº†ä¸å¤±è´¥çš„æœºä¼šï¼Œè€Œå¦‚æœä¸ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨çš„åŠ©æ‰‹è‚¯å®šä¼šå¤±è´¥ï¼Œå°±åƒåœ¨åŸºäºçŠ¶æ€æœºçš„å¯¹è¯ç³»ç»Ÿä¸­ä¸€æ ·ã€‚</p><p>è¿™äº›ç±»å‹çš„æ„å¤–ç”¨æˆ·è¡Œä¸ºæ˜¯æˆ‘ä»¬çš„<a href="#">TEDPolicy</a>éå¸¸<a href="#">æ“…é•¿</a>å¤„ç†çš„äº‹æƒ…ã€‚å®ƒå¯ä»¥å­¦ä¹ åœ¨ç”¨æˆ·è¯•å›¾å®Œæˆçš„ä¸»è¦ç”¨æˆ·ç›®æ ‡ä¸­çš„ä¸€äº›æ’è¯ä¹‹åä½¿ç”¨æˆ·å›åˆ°æ­£è½¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„å¯¹è¯ä¸­ï¼ˆæ‘˜è‡ª<a href="#">Rasa X</a>ä¸Šçš„å¯¹è¯ï¼‰ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> Story from conversation with a2baab6c83054bfaa8d598459c659d2a on November 28th 2019</span><span class="token list punctuation">*</span> greet  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>greet<span class="token punctuation">_</span></span>user  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"shown_privacy":true<span class="token entity" title="&#125;">&amp;#125;</span><span class="token list punctuation">*</span> ask_whoisit  <span class="token list punctuation">-</span> action_chitchat<span class="token list punctuation">*</span> ask_whatspossible  <span class="token list punctuation">-</span> action_chitchat<span class="token list punctuation">*</span> telljoke  <span class="token list punctuation">-</span> action_chitchat<span class="token list punctuation">*</span> how<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>get_started<span class="token entity" title="&#123;">&amp;#123;</span>"product":"x"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"product":"x"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>x  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>also<span class="token punctuation">_</span></span>explain_nlucore<span class="token list punctuation">*</span> affirm  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>nlu  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>core  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>direct<span class="token punctuation">_</span></span>to_step2</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”¨æˆ·é¦–å…ˆå®Œæˆäº†ä¸€äº›é—²èŠä»»åŠ¡ï¼Œç„¶åæœ€ç»ˆè¯¢é—®ä»–ä»¬å¦‚ä½•å¼€å§‹ä½¿ç”¨RasaXã€‚TEDPolicyæ­£ç¡®åœ°é¢„æµ‹äº†åº”è¯¥å‘ç”¨æˆ·è§£é‡ŠRasa Xï¼Œç„¶åä¹Ÿå°†å…¶æ²¿ç”¨ä¸‹æ¥è·¯å¾„ï¼Œè€Œä¸å…ˆé—®æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é—®é¢˜ã€‚</p><p>ç”±äºåœ¨è¿™ç§æƒ…å†µä¸‹æœºå™¨å­¦ä¹ ç­–ç•¥çš„æ¨å¹¿æ•ˆæœå¾ˆå¥½ï¼Œå› æ­¤æœ‰å¿…è¦å°†æ­¤æ•…äº‹æ·»åŠ åˆ°æ‚¨çš„è®­ç»ƒæ•°æ®ä¸­ï¼Œä»¥ä¸æ–­æ”¹è¿›æ‚¨çš„æœºå™¨äººå¹¶å¸®åŠ©æœºå™¨å­¦ä¹ è¿›ä¸€æ­¥æ¨å¹¿ã€‚<a href="#">Rasa X</a>æ˜¯ä¸€æ¬¾å¯ä»¥å¸®åŠ©æ‚¨æ”¹å–„botå¹¶ä½¿å®ƒä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„å·¥å…·ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PaddleOCR DockeråŒ–éƒ¨ç½²æœåŠ¡</title>
      <link href="/2020/10/02/paddleocr-docker-hua-bu-shu-fu-wu/"/>
      <url>/2020/10/02/paddleocr-docker-hua-bu-shu-fu-wu/</url>
      
        <content type="html"><![CDATA[<h1 id="PaddleOCR-DockeråŒ–éƒ¨ç½²æœåŠ¡"><a href="#PaddleOCR-DockeråŒ–éƒ¨ç½²æœåŠ¡" class="headerlink" title="PaddleOCR DockeråŒ–éƒ¨ç½²æœåŠ¡"></a>PaddleOCR DockeråŒ–éƒ¨ç½²æœåŠ¡</h1><h2 id="å‡†å¤‡Dockerfile"><a href="#å‡†å¤‡Dockerfile" class="headerlink" title="å‡†å¤‡Dockerfile"></a>å‡†å¤‡Dockerfile</h2><pre class=" language-shell"><code class="language-shell"># Version: 1.0.0FROM hub.baidubce.com/paddlepaddle/paddle:latest-gpu-cuda9.0-cudnn7-dev# PaddleOCR base on Python3.7#RUN pip3.7 install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simpleRUN pip3.7 install --upgrade pip -i https://mirror.baidu.com/pypi/simple#RUN python3.7 -m pip install paddlepaddle==1.7.2 -i https://pypi.tuna.tsinghua.edu.cn/simpleRUN python3.7 -m pip install paddlepaddle==1.7.2 -i https://mirror.baidu.com/pypi/simple#RUN pip3.7 install paddlehub --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simpleRUN pip3.7 install paddlehub --upgrade -i https://mirror.baidu.com/pypi/simple#RUN git clone https://gitee.com/PaddlePaddle/PaddleOCRRUN cd / && git clone -b develop --depth 1 https://github.com/PaddlePaddle/PaddleOCR.gitWORKDIR /PaddleOCR#RUN pip3.7 install -r requirments.txt -i https://pypi.tuna.tsinghua.edu.cn/simpleRUN pip3.7 install -r requirments.txt -i https://mirror.baidu.com/pypi/simpleRUN mkdir -p /PaddleOCR/inference/ch_rec_mv3_crnnRUN mkdir -p /PaddleOCR/inference/ch_det_mv3_db# Download orc detect model(light version). if you want to change normal version, you can change ch_det_mv3_db_infer to ch_det_r50_vd_db_infer, also remember$#ADD https://paddleocr.bj.bcebos.com/ch_models/ch_det_mv3_db_infer.tar /PaddleOCR/inference#ADD https://paddleocr.bj.bcebos.com/ch_models/ch_rec_r34_vd_crnn_enhance_infer.tar  /PaddleOCR/inferenceADD https://paddleocr.bj.bcebos.com/ch_models/ch_rec_r34_vd_crnn_infer.tar  /PaddleOCR/inference#RUN tar xf /PaddleOCR/inference/ch_rec_r34_vd_crnn_enhance_infer.tar --strip-components 1  -C /PaddleOCR/inference/ch_rec_mv3_crnnRUN tar xf /PaddleOCR/inference/ch_rec_r34_vd_crnn_infer.tar --strip-components 1  -C /PaddleOCR/inference/ch_rec_mv3_crnn# Download orc recognition model(light version). If you want to change normal version, you can change ch_rec_mv3_crnn_infer to ch_rec_r34_vd_crnn_enhance_inf$#ADD https://paddleocr.bj.bcebos.com/ch_models/ch_rec_mv3_crnn_infer.tar /PaddleOCR/inferenceADD https://paddleocr.bj.bcebos.com/ch_models/ch_det_r50_vd_db_infer.tar  /PaddleOCR/inferenceRUN tar xf /PaddleOCR/inference/ch_det_r50_vd_db_infer.tar --strip-components 1  -C /PaddleOCR/inference/ch_det_mv3_dbEXPOSE 8866CMD ["/bin/bash","-c","export PYTHONPATH=. && hub install deploy/hubserving/ocr_system/ && hub serving start -m ocr_system"]</code></pre><h2 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h2><pre class=" language-shell"><code class="language-shell">docker build -t paddleocr:cpu . </code></pre><h2 id="åˆ›å»ºå®¹å™¨"><a href="#åˆ›å»ºå®¹å™¨" class="headerlink" title="åˆ›å»ºå®¹å™¨"></a>åˆ›å»ºå®¹å™¨</h2><pre class=" language-shell"><code class="language-shell">docker run -dp 8866:8866 --name paddle_ocr paddleocr:cpu</code></pre><h2 id="æµ‹è¯•CURL"><a href="#æµ‹è¯•CURL" class="headerlink" title="æµ‹è¯•CURL"></a>æµ‹è¯•CURL</h2><pre class=" language-shell"><code class="language-shell">curl -H "Content-Type:application/json" -X POST --data "&#123;\"images\": [\"å¡«å…¥å›¾ç‰‡Base64ç¼–ç (éœ€è¦åˆ é™¤'data:image/jpg;base64,'ï¼‰\"]&#125;" http://localhost:8866/predict/ocr_system</code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://gitee.com/paddlepaddle/PaddleOCR/tree/develop/deploy/docker/hubserving">https://gitee.com/paddlepaddle/PaddleOCR/tree/develop/deploy/docker/hubserving</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OCR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•åŸºç¡€</title>
      <link href="/2020/09/28/suan-fa-ji-chu/"/>
      <url>/2020/09/28/suan-fa-ji-chu/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®—æ³•åŸºç¡€"><a href="#ç®—æ³•åŸºç¡€" class="headerlink" title="ç®—æ³•åŸºç¡€"></a>ç®—æ³•åŸºç¡€</h1><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><p>ç»™å®šä½ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•´æ•°æ•°åˆ—ã€‚</p><p>è¯·ä½ ä½¿ç”¨å¿«é€Ÿæ’åºå¯¹è¿™ä¸ªæ•°åˆ—æŒ‰ç…§ä»å°åˆ°å¤§è¿›è¡Œæ’åºã€‚</p><p>å¹¶å°†æ’å¥½åºçš„æ•°åˆ—æŒ‰é¡ºåºè¾“å‡ºã€‚</p><ul><li>è¾“å…¥æ ¼å¼</li></ul><p>è¾“å…¥å…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° nã€‚</p><p>ç¬¬äºŒè¡ŒåŒ…å« n ä¸ªæ•´æ•°ï¼ˆæ‰€æœ‰æ•´æ•°å‡åœ¨1~109109èŒƒå›´å†…ï¼‰ï¼Œè¡¨ç¤ºæ•´ä¸ªæ•°åˆ—ã€‚</p><ul><li>è¾“å‡ºæ ¼å¼</li></ul><p>è¾“å‡ºå…±ä¸€è¡Œï¼ŒåŒ…å« n ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ’å¥½åºçš„æ•°åˆ—ã€‚</p><ul><li>æ•°æ®èŒƒå›´</li></ul><p>1â‰¤<em>n</em>â‰¤1000001â‰¤nâ‰¤100000</p><ul><li>è¾“å…¥æ ·ä¾‹ï¼š</li></ul><pre><code>53 1 2 4 5</code></pre><ul><li>è¾“å‡ºæ ·ä¾‹ï¼š</li></ul><pre><code>1 2 3 4 5</code></pre><h3 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h3><ol><li><p>ç¡®å®šä¸­é—´åˆ†ç•Œç‚¹</p></li><li><p>æ‰€æœ‰å°äºåˆ†ç•Œç‚¹çš„åœ¨å·¦ä¾§ï¼Œç­‰äºåˆ†ç•Œç‚¹çš„åœ¨ä¸­é—´ï¼Œå¤§äºåˆ†ç•Œç‚¹çš„åœ¨å³ä¾§</p></li><li><p>é€’å½’æ’åº</p></li></ol><img src="/2020/09/28/suan-fa-ji-chu/å¿«é€Ÿæ’åº.png" style="zoom:80%;"><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## python</span><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">sort_list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span>List<span class="token punctuation">)</span><span class="token punctuation">:</span>        n <span class="token operator">=</span> len<span class="token punctuation">(</span>nums<span class="token punctuation">)</span>        <span class="token keyword">if</span> n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> nums        mid <span class="token operator">=</span> nums<span class="token punctuation">[</span>n<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">]</span>        right <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> nums <span class="token keyword">if</span> x <span class="token operator">></span> mid<span class="token punctuation">]</span>        middle <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> nums <span class="token keyword">if</span> x <span class="token operator">==</span> mid<span class="token punctuation">]</span>        left <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> nums <span class="token keyword">if</span> x <span class="token operator">&lt;</span> mid<span class="token punctuation">]</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>sort_list<span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">+</span> middle <span class="token operator">+</span> self<span class="token punctuation">.</span>sort_list<span class="token punctuation">(</span>right<span class="token punctuation">)</span></code></pre><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul><li><p>æ‰¾åˆ†ç•Œç‚¹ã€€mid = (l-r)//2</p></li><li><p>é€’å½’æ’åºleft right</p></li><li><p>å½’å¹¶ã€€â€“&gt; åˆè€Œä¸ºä¸€</p></li></ul><p><img src="/2020/09/28/suan-fa-ji-chu/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F.png"></p><p>æ¨¡æ¿</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">merge_sort</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> list1<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>list1<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        mid <span class="token operator">=</span> len<span class="token punctuation">(</span>list1<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>        L <span class="token operator">=</span> list1<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span>        R <span class="token operator">=</span> list1<span class="token punctuation">[</span>mid<span class="token punctuation">:</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>merge_sort<span class="token punctuation">(</span>L<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>merge_sort<span class="token punctuation">(</span>R<span class="token punctuation">)</span>        i <span class="token operator">=</span> j <span class="token operator">=</span> k <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">and</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>                list1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                i <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                list1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span>                j <span class="token operator">+=</span> <span class="token number">1</span>            k <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>            list1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>            k <span class="token operator">+=</span> <span class="token number">1</span>            i <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">while</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">:</span>            list1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span>            k <span class="token operator">+=</span> <span class="token number">1</span>            j <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">return</span> list1</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Medical Entity Linking using Triplet Network</title>
      <link href="/2020/09/28/medical-entity-linking-using-triplet-network/"/>
      <url>/2020/09/28/medical-entity-linking-using-triplet-network/</url>
      
        <content type="html"><![CDATA[<p>å›½åº†å‰å®Œæˆ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Pointer Graph Networks</title>
      <link href="/2020/09/27/pointer-graph-networks/"/>
      <url>/2020/09/27/pointer-graph-networks/</url>
      
        <content type="html"><![CDATA[<p>å›½åº†å‰å®Œæˆ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XgBooståŸç†</title>
      <link href="/2020/09/25/xgboost-yuan-li/"/>
      <url>/2020/09/25/xgboost-yuan-li/</url>
      
        <content type="html"><![CDATA[<h1 id="XgBooståŸç†"><a href="#XgBooståŸç†" class="headerlink" title="XgBooståŸç†"></a>XgBooståŸç†</h1><p>â€‹         XGBoostå…¨ç§°æ˜¯eXtreme Gradient Boosting,å¯è¯‘ä¸ºæé™æ¢¯åº¦æå‡ç®—æ³•ã€‚å®ƒç”±é™ˆå¤©å¥‡æ‰€è®¾è®¡,è‡´åŠ›äºè®©æå‡æ ‘çªç ´è‡ªèº«çš„è®¡ç®—æé™,ä»¥å®ç°è¿ç®—å¿«é€Ÿ,æ€§èƒ½ä¼˜ç§€çš„å·¥ç¨‹ç›®æ ‡ã€‚å’Œä¼ ç»Ÿçš„æ¢¯åº¦æå‡ç®—æ³•ç›¸æ¯”,XGBoostè¿›è¡Œäº†è®¸å¤šæ”¹è¿›,å®ƒèƒ½å¤Ÿæ¯”å…¶ä»–ä½¿ç”¨æ¢¯åº¦æå‡çš„é›†æˆç®—æ³•æ›´åŠ å¿«é€Ÿ,å¹¶ä¸”å·²ç»è¢«è®¤ä¸ºæ˜¯åœ¨åˆ†ç±»å’Œå›å½’ä¸Šéƒ½æ‹¥æœ‰è¶…é«˜æ€§èƒ½çš„å…ˆè¿›è¯„ä¼°å™¨ã€‚é™¤äº†æ¯”èµ›ä¹‹ä¸­,é«˜ç§‘æŠ€è¡Œä¸šå’Œæ•°æ®å’¨è¯¢ç­‰è¡Œä¸šä¹Ÿå·²ç»å¼€å§‹é€æ­¥ä½¿ç”¨XGBoost,äº†è§£è¿™ä¸ªç®—æ³•,å·²ç»æˆä¸ºå­¦ä¹ æœºå™¨å­¦ä¹ ä¸­å¿…è¦çš„ä¸€ç¯ã€‚</p><p>â€‹        é™¤äº†æ¯”èµ›ä¹‹ä¸­,é«˜ç§‘æŠ€è¡Œä¸šå’Œæ•°æ®å’¨è¯¢ç­‰è¡Œä¸šä¹Ÿå·²ç»å¼€å§‹é€æ­¥ä½¿ç”¨XGBoost,äº†è§£è¿™ä¸ªç®—æ³•,å·²ç»æˆä¸ºå­¦ä¹ æœºå™¨å­¦ä¹ ä¸­å¿…è¦çš„ä¸€ç¯ã€‚ æ€§èƒ½è¶…å¼ºçš„ç®—æ³•å¾€å¾€æœ‰ç€å¤æ‚çš„åŸç†,XGBoostä¹Ÿä¸èƒ½å…ä¿—,å› æ­¤å®ƒèƒŒåçš„æ•°å­¦æ·±å¥¥å¤æ‚ã€‚é™¤æ­¤ä¹‹å¤–,XGBoostä¸å¤šå¹´å‰å°±å·²ç»ç ”å‘å‡ºæ¥çš„ç®—æ³•,æ¯”å¦‚å†³ç­–æ ‘,SVMç­‰ä¸åŒ,å®ƒæ˜¯ä¸€ä¸ªé›†å¤§æˆçš„æœºå™¨å­¦ä¹ ç®—æ³•,å¯¹å¤§å®¶æŒæ¡æœºå™¨å­¦ä¹ ä¸­å„ ç§æ¦‚å¿µçš„ç¨‹åº¦æœ‰è¾ƒé«˜çš„è¦æ±‚ã€‚è™½ç„¶è¦å¬æ‡‚ä»Šå¤©è¿™å ‚è¯¾,ä½ ä¸éœ€è¦æ˜¯ä¸€ä¸ªæœºå™¨å­¦ä¹ ä¸“å®¶,ä½†ä½ è‡³å°‘éœ€è¦äº†è§£æ ‘æ¨¡å‹æ˜¯ä»€ä¹ˆã€‚å¦‚æœä½ å¯¹æœºå™¨å­¦ä¹ æ¯”è¾ƒå¥½çš„äº†è§£,åŸºç¡€æ¯”è¾ƒç‰¢,é‚£ä»Šå¤©çš„è¯¾å°†ä¼šæ˜¯ä½¿ä½ èä¼šè´¯é€šçš„ä¸€èŠ‚è¯¾ã€‚ç†è§£XGBoost,ä¸€å®šèƒ½è®©ä½ åœ¨æœºå™¨å­¦ä¹ ä¸Šæ›´ä¸Šä¸€å±‚æ¥¼ ã€‚</p><h2 id="xgbooståº“ä¸XGBçš„sklearn-API"><a href="#xgbooståº“ä¸XGBçš„sklearn-API" class="headerlink" title="xgbooståº“ä¸XGBçš„sklearn API"></a>xgbooståº“ä¸XGBçš„sklearn API</h2><p>â€‹       ç°åœ¨,æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æ¥ä½¿ç”¨æˆ‘ä»¬çš„xgbooståº“ã€‚ç¬¬ä¸€ç§æ–¹å¼,æ˜¯ç›´æ¥ä½¿ç”¨xgbooståº“è‡ªå·±çš„å»ºæ¨¡æµç¨‹ã€‚<br>â€‹       xgboost documents:<a href="https://xgboost.readthedocs.io/en/latest/index.html">https://xgboost.readthedocs.io/en/latest/index.html</a></p><pre class=" language-shell"><code class="language-shell">#windowspip install xgboost #å®‰è£…xgbooståº“pip install --upgrade xgboost #æ›´æ–°xgbooståº“#MACbrew install gcc@7pip3 install xgboostimport xgboost as xgb</code></pre><p>â€‹        å…¶ä¸­æœ€æ ¸å¿ƒçš„ï¼Œæ˜¯DMtarixè¿™ä¸ªè¯»å–æ•°æ®çš„ç±»ï¼Œä»¥åŠtrain()è¿™ä¸ªç”¨äºè®­ç»ƒçš„ç±»ã€‚ä¸sklearnæŠŠæ‰€æœ‰çš„å‚æ•°éƒ½å†™åœ¨ç±»ä¸­çš„æ–¹å¼ä¸åŒï¼Œxgbooståº“ä¸­å¿…é¡»å…ˆä½¿ç”¨å­—å…¸è®¾å®šå‚æ•°é›†ï¼Œå†ä½¿ç”¨trainæ¥å°†å‚æ•°åŠè¾“å…¥ï¼Œç„¶åè¿›è¡Œè®­ç»ƒã€‚ä¼šè¿™æ ·è®¾è®¡çš„åŸå› ï¼Œæ˜¯å› ä¸ºXGBæ‰€æ¶‰åŠåˆ°çš„å‚æ•°å®åœ¨å¤ªå¤šï¼Œå…¨éƒ¨å†™åœ¨xgb.train()ä¸­å¤ªé•¿ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¸ºå¤§å®¶å‡†å¤‡äº†paramså¯èƒ½çš„å–å€¼ä»¥åŠxgboost.trainçš„åˆ—è¡¨ï¼Œç»™å¤§å®¶ä¸€ä¸ªå°è±¡ã€‚</p><pre class=" language-json"><code class="language-json">params  &amp;#<span class="token number">123</span><span class="token punctuation">;</span>eta<span class="token punctuation">,</span> gamma<span class="token punctuation">,</span> max_depth<span class="token punctuation">,</span> min_child_weight<span class="token punctuation">,</span> max_delta_step<span class="token punctuation">,</span> subsample<span class="token punctuation">,</span> colsample_bytree<span class="token punctuation">,</span>colsample_bylevel<span class="token punctuation">,</span> colsample_bynode<span class="token punctuation">,</span> lambda<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> tree_method string<span class="token punctuation">,</span> sketch_eps<span class="token punctuation">,</span> scale_pos_weight<span class="token punctuation">,</span> updater<span class="token punctuation">,</span>refresh_leaf<span class="token punctuation">,</span> process_type<span class="token punctuation">,</span> grow_policy<span class="token punctuation">,</span> max_leaves<span class="token punctuation">,</span> max_bin<span class="token punctuation">,</span> predictor<span class="token punctuation">,</span> num_parallel_tree&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><pre class=" language-python"><code class="language-python">xgboost<span class="token punctuation">.</span>train <span class="token punctuation">(</span>params<span class="token punctuation">,</span> dtrain<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> evals<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> obj<span class="token operator">=</span>None<span class="token punctuation">,</span> feval<span class="token operator">=</span>None<span class="token punctuation">,</span> maximize<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>early_stopping_rounds<span class="token operator">=</span>None<span class="token punctuation">,</span> evals_result<span class="token operator">=</span>None<span class="token punctuation">,</span> verbose_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> xgb_model<span class="token operator">=</span>None<span class="token punctuation">,</span> callbacks<span class="token operator">=</span>None<span class="token punctuation">,</span>learning_rates<span class="token operator">=</span>None<span class="token punctuation">)</span></code></pre><p>â€‹       æˆ–è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨xgbooståº“ä¸­çš„sklearnçš„APIã€‚è¿™æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å¦‚ä¸‹çš„ç±»ï¼Œå¹¶ç”¨æˆ‘ä»¬sklearnå½“ä¸­æƒ¯ä¾‹çš„å®ä¾‹åŒ–ï¼Œï¬tå’Œpredictçš„æµç¨‹æ¥è¿è¡ŒXGBï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è°ƒç”¨å±æ€§æ¯”å¦‚coef_ç­‰ç­‰ã€‚å½“ç„¶ï¼Œè¿™æ˜¯æˆ‘ä»¬å›å½’çš„ç±»ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ç”¨äºåˆ†ç±»ï¼Œç”¨äºæ’åºçš„ç±»ã€‚ä»–ä»¬ä¸å›å½’çš„ç±»éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤äº†è§£ä¸€ä¸ªç±»å³å¯ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">xgboost</span><span class="token punctuation">.</span>XGBRegressor <span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> silent<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>objective<span class="token operator">=</span><span class="token string">'reg:linear'</span><span class="token punctuation">,</span> booster<span class="token operator">=</span><span class="token string">'gbtree'</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> nthread<span class="token operator">=</span>None<span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> min_child_weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_delta_step<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>subsample<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> colsample_bytree<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> colsample_bylevel<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> reg_alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reg_lambda<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> scale_pos_weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>base_score<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> missing<span class="token operator">=</span>None<span class="token punctuation">,</span> importance_type<span class="token operator">=</span><span class="token string">'gain'</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code></pre><p>â€‹      çœ‹åˆ°è¿™é•¿é•¿çš„å‚æ•°æ¡ç›®ï¼Œå¯èƒ½å¤§å®¶ä¼šæ„Ÿåˆ°å¤´æ™•çœ¼èŠ±â€”â€”æ²¡é”™XGBå°±æ˜¯è¿™é—¨å¤æ‚ã€‚ä½†æ˜¯çœ¼å°–çš„å°ä¼™ä¼´å¯èƒ½å·²ç»å‘ç°äº†ï¼Œè°ƒç”¨xgboost.trainå’Œè°ƒç”¨sklearnAPIä¸­çš„ç±»XGBRegressorï¼Œéœ€è¦è¾“å…¥çš„å‚æ•°æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”çœ‹èµ·æ¥ç›¸å½“çš„ä¸åŒã€‚ä½†å…¶å®ï¼Œ<strong>è¿™äº›å‚æ•°åªæ˜¯å†™æ³•ä¸åŒï¼ŒåŠŸèƒ½æ˜¯ç›¸åŒçš„</strong>ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬çš„paramså­—å…¸ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°etaï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬XGBRegressoré‡Œé¢çš„å‚æ•°learning_rateï¼Œä»–ä»¬çš„å«ä¹‰å’Œå®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚åªä¸è¿‡åœ¨sklearnAPIä¸­ï¼Œå¼€å‘å›¢é˜Ÿå‹å¥½åœ°å¸®åŠ©æˆ‘ä»¬å°†å‚æ•°çš„åç§°è°ƒèŠ‚æˆäº†ä¸sklearnä¸­å…¶ä»–çš„ç®—æ³•ç±»æ›´ç›¸ä¼¼çš„æ ·å­ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‘æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºConditional Layer Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ</title>
      <link href="/2020/09/22/ji-yu-conditional-layer-normalization-de-tiao-jian-wen-ben-sheng-cheng/"/>
      <url>/2020/09/22/ji-yu-conditional-layer-normalization-de-tiao-jian-wen-ben-sheng-cheng/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºäºConditional-Layer-Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ"><a href="#åŸºäºConditional-Layer-Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ" class="headerlink" title="åŸºäºConditional Layer Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ"></a>åŸºäºConditional Layer Normalizationçš„æ¡ä»¶æ–‡æœ¬ç”Ÿæˆ</h1><p>â€‹    åˆ©ç”¨Conditional Layer Normalizationæ¥å°†å¤–éƒ¨æ¡ä»¶èå…¥åˆ°é¢„è®­ç»ƒæ¨¡å‹ä¸­çš„æ€è·¯ï¼Œå…¶ç›´æ¥åº”ç”¨å°±æ˜¯æ¡ä»¶æ–‡æœ¬ç”Ÿæˆï¼Œä½†å…¶å®ä¹Ÿä¸å•å•å¯ä»¥ç”¨äºç”Ÿæˆæ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ†ç±»æ¨¡å‹ç­‰åœºæ™¯ï¼ˆå¤–éƒ¨æ¡ä»¶å¯èƒ½æ˜¯å…¶ä»–æ¨¡æ€çš„ä¿¡æ¯ï¼Œæ¥è¾…åŠ©åˆ†ç±»ï¼‰ã€‚</p><p>åŸæ–‡å‚è€ƒè‹ç¥çš„Blog <a href="https://spaces.ac.cn/archives/7124/comment-page-1">https://spaces.ac.cn/archives/7124/comment-page-1</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å½’ä¸€åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“è¯†åˆ«</title>
      <link href="/2020/09/22/zhong-wen-yi-xue-wen-ben-ming-ming-shi-ti-shi-bie/"/>
      <url>/2020/09/22/zhong-wen-yi-xue-wen-ben-ming-ming-shi-ti-shi-bie/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“è¯†åˆ«"><a href="#ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“è¯†åˆ«" class="headerlink" title="ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“è¯†åˆ«"></a>ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“è¯†åˆ«</h1><h2 id="ä»»åŠ¡ç®€ä»‹"><a href="#ä»»åŠ¡ç®€ä»‹" class="headerlink" title="ä»»åŠ¡ç®€ä»‹"></a>ä»»åŠ¡ç®€ä»‹</h2><p>â€‹      å®ä½“è¯†åˆ«ä½œä¸ºä¿¡æ¯æŠ½å–çš„ä¸€ä¸ªé‡è¦å­ä»»åŠ¡ï¼Œè¿‘äº›å¹´å·²ç»å–å¾—äº†é˜¶æ®µæ€§æˆæœã€‚å¯¹äºåŒ»å­¦é¢†åŸŸçš„è‡ªç„¶è¯­è¨€æ–‡çŒ®ï¼Œä¾‹å¦‚åŒ»å­¦æ•™æã€åŒ»å­¦ç™¾ç§‘ã€ä¸´åºŠç—…ä¾‹ã€åŒ»å­¦æœŸåˆŠã€å…¥é™¢è®°å½•ã€æ£€éªŒæŠ¥å‘Šç­‰ï¼Œè¿™äº›æ–‡æœ¬ä¸­è•´å«å¤§é‡åŒ»å­¦ä¸“ä¸šçŸ¥è¯†å’ŒåŒ»å­¦æœ¯è¯­ã€‚å°†å®ä½“è¯†åˆ«æŠ€æœ¯ä¸åŒ»å­¦ä¸“ä¸šé¢†åŸŸç»“åˆï¼Œåˆ©ç”¨æœºå™¨è¯»å–åŒ»å­¦æ–‡æœ¬ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ä¸´åºŠç§‘ç ”çš„æ•ˆç‡å’Œè´¨é‡ï¼Œå¹¶ä¸”å¯æœåŠ¡äºä¸‹æ¸¸å­ä»»åŠ¡ã€‚è¦æƒ³è®©æœºå™¨â€œè¯»æ‡‚â€åŒ»å­¦æ•°æ®ï¼Œæ ¸å¿ƒåœ¨äºè®©è®¡ç®—æœºåœ¨å¤§é‡åŒ»å­¦æ–‡æœ¬ä¸­å‡†ç¡®çš„æå–å‡ºå…³é”®ä¿¡æ¯ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†å‘½åå®ä½“è¯†åˆ«ã€å…³ç³»æŠ½å–ç­‰è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ã€‚åŒ»å­¦é¢†åŸŸä¸­éç»“æ„åŒ–çš„æ–‡æœ¬ï¼Œéƒ½æ˜¯ç”±ä¸­æ–‡è‡ªç„¶è¯­è¨€å¥å­æˆ–å¥å­é›†åˆç»„æˆã€‚å®ä½“æŠ½å–æ˜¯ä»éç»“æ„åŒ–åŒ»å­¦æ–‡æœ¬ä¸­æ‰¾å‡ºåŒ»å­¦å®ä½“ï¼Œå¦‚ç–¾ç—…ã€ç—‡çŠ¶çš„è¿‡ç¨‹ã€‚</p><h2 id="ä»»åŠ¡è¯¦æƒ…"><a href="#ä»»åŠ¡è¯¦æƒ…" class="headerlink" title="ä»»åŠ¡è¯¦æƒ…"></a>ä»»åŠ¡è¯¦æƒ…</h2><p>æœ¬è¯„æµ‹ä»»åŠ¡ä¸ºé¢å‘ä¸­æ–‡åŒ»å­¦æ–‡æœ¬çš„å‘½åå®ä½“è¯†åˆ«ï¼Œå³ç»™å®šschemaåŠå¥å­sentenceï¼Œå¯¹äºç»™å®šçš„ä¸€ç»„çº¯åŒ»å­¦æ–‡æœ¬æ–‡æ¡£ï¼Œä»»åŠ¡çš„ç›®æ ‡æ˜¯è¯†åˆ«å¹¶æŠ½å–å‡ºä¸åŒ»å­¦ä¸´åºŠç›¸å…³çš„å®ä½“ï¼Œå¹¶å°†ä»–ä»¬å½’ç±»åˆ°é¢„å…ˆå®šä¹‰å¥½çš„ç±»åˆ«ã€‚å°†åŒ»å­¦æ–‡æœ¬å‘½åå®ä½“åˆ’åˆ†ä¸ºä¹å¤§ç±»ï¼ŒåŒ…æ‹¬ï¼šç–¾ç—…ï¼Œä¸´åºŠè¡¨ç°ï¼Œè¯ç‰©ï¼ŒåŒ»ç–—è®¾å¤‡ï¼ŒåŒ»ç–—ç¨‹åºï¼Œèº«ä½“ï¼ŒåŒ»å­¦æ£€éªŒé¡¹ç›®ï¼Œå¾®ç”Ÿç‰©ç±»ï¼Œç§‘å®¤ã€‚æ ‡æ³¨ä¹‹å‰å¯¹æ–‡ç« è¿›è¡Œè‡ªåŠ¨åˆ†è¯å¤„ç†ï¼Œæ‰€æœ‰çš„åŒ»å­¦å®ä½“å‡å·²æ­£ç¡®åˆ‡åˆ†ã€‚</p><h2 id="æ•°æ®ç®€ä»‹"><a href="#æ•°æ®ç®€ä»‹" class="headerlink" title="æ•°æ®ç®€ä»‹"></a>æ•°æ®ç®€ä»‹</h2><table><thead><tr><th>åºå·</th><th>å‘½åå®ä½“ç±»åˆ«</th><th>å­ç±»</th><th>æ ‡ç­¾</th><th>æ ·ä¾‹</th></tr></thead><tbody><tr><td>1</td><td>ç–¾ç—…</td><td>ç–¾ç—…æˆ–ç»¼åˆç—‡</td><td>dis</td><td>å°¿æ½´ç•™è€…æ˜“ç»§å‘æ³Œå°¿ç³»æ„ŸæŸ“ã€‚|||0 2 dis|||7 11 dis|||</td></tr><tr><td>2</td><td>ä¸´åºŠè¡¨ç°</td><td>ç—‡çŠ¶</td><td>sym</td><td>é€æ¸å‡ºç°å‘¼å¸å›°éš¾ã€é˜µå‘æ€§å–˜æ†‹ï¼Œå‘ä½œæ—¶å‘¼å¸å¿«è€Œæµ…ï¼Œå¹¶ä¼´æœ‰å‘¼æ°”æ€§å–˜é¸£ï¼Œæ˜æ˜¾é¼»æ‰‡åŠä¸‰å‡¹å¾ã€‚|||4 7 sym|||9 13 sym|||18 31 sym|||35 35 bod|||33 36 sym|||38 40 sym|||</td></tr><tr><td>3</td><td>åŒ»ç–—ç¨‹åº</td><td>æ£€æŸ¥ç¨‹åº</td><td>pro</td><td>ç”¨å…ç–«å­¦æ–¹æ³•æ£€æµ‹æŸç§ç—…åŸä½“çš„ç‰¹å¼‚æŠ—åŸå¾ˆæœ‰è¯Šæ–­ä»·å€¼ï¼Œå› å…¶ç®€å•å¿«é€Ÿï¼Œå¸¸å¸¸ç”¨äºæ—©æœŸè¯Šæ–­ï¼Œè¯Šæ–­ä¹‰å¸¸è¾ƒæŠ—ä½“æ£€æµ‹æ›´ä¸ºå¯é ã€‚|||1 7 pro|||47 50 pro|||</td></tr><tr><td>4</td><td>åŒ»ç–—è®¾å¤‡</td><td>æ£€æŸ¥è®¾å¤‡</td><td>equ</td><td>ï¼ˆä¸€ï¼‰ç—…åŸä½“çš„æ£€å‡º1.ç—…åŸä½“çš„ç›´æ¥æ£€å‡ºå¾ˆå¤šæ„ŸæŸ“æ€§ç–¾ç—…å¯ä»¥é€šè¿‡è‚‰çœ¼æˆ–æ˜¾å¾®é•œç›´æ¥æ£€å‡ºç—…åŸä½“è€Œç¡®è¯Šï¼Œè¿™äº›ç—…åŸä½“éƒ½æœ‰å…¶å½¢æ€å­¦ç‰¹å¾è€Œæ˜“äºè®¤å®šã€‚|||33 35 equ||| å¯„ç”Ÿè™«æˆè™«å¯ä»¥åœ¨æ‚£å„¿çš„å¤§ä¾¿ä¸­çœ‹åˆ°ï¼Œé€šè¿‡æ˜¾å¾®é•œå¯ä»¥ä»å¤§ä¾¿æŸ¥å‡ºå„ç§å¯„ç”Ÿè™«è™«åµåŠé˜¿ç±³å·´åŸè™«ç­‰ã€‚|||0 4 mic|||31 33 mic|||</td></tr><tr><td>5</td><td>è¯ç‰©</td><td>è¯ç‰©</td><td>dru</td><td>å·²æœ‰2ç§EBVç–«è‹—ç”¨äºå¿—æ„¿è€…ï¼šè¡¨è¾¾EBVgp320çš„é‡ç»„ç—˜ç—…æ¯’ç–«è‹—å’Œæçº¯ç—…æ¯’gp320è†œç³–è›‹ç™½çš„ç–«è‹—ï¼Œæœ‰æœ›å¼€å‘åº”ç”¨äºBVæ„ŸæŸ“çš„é¢„é˜²ã€‚|||4 8 dru|||15 32 dru|||34 49 dru|||58 62 dis|||</td></tr><tr><td>6</td><td>åŒ»å­¦æ£€éªŒé¡¹ç›®</td><td>åŒ»å­¦æ£€éªŒé¡¹ç›®</td><td>ite</td><td>é…æ–¹ä¸­çš„é‡è¦å‚æ•°åŒ…æ‹¬æ¸—é€å‹ã€è‚¾æº¶è´¨è´Ÿè·ã€çƒ­èƒ½å¯†åº¦ã€é»ç¨ åº¦å’Œç»„æˆæˆåˆ†ç­‰ã€‚|||10 12 ite|||14 18 ite|||20 23 ite|||25 27 ite|||29 32 ite|||</td></tr><tr><td>7</td><td>èº«ä½“</td><td>èº«ä½“ç‰©è´¨</td><td>bod</td><td>è„¾ç ´è£‚ç½•è§ï¼Œå´ä¸ºä¸¥é‡å¹¶å‘ç—‡ï¼Œæ•…æ£€æŸ¥è„¾è„æ—¶ä¸å®œé‡æŒ‰ã€‚|||0 0 bod|||0 2 sym|||17 18 bod|||</td></tr><tr><td>8</td><td>ç§‘å®¤</td><td>ç§‘å®¤</td><td>dep</td><td>å› æ­¤ï¼Œåº”å¼ºè°ƒå®šæœŸçœ¼ç§‘éšè®¿ã€‚|||8 9 dep|||</td></tr><tr><td>9</td><td>å¾®ç”Ÿç‰©ç±»</td><td>å¾®ç”Ÿç‰©ç±»</td><td>mic</td><td>å¯„ç”Ÿè™«æˆè™«å¯ä»¥åœ¨æ‚£å„¿çš„å¤§ä¾¿ä¸­çœ‹åˆ°ï¼Œé€šè¿‡æ˜¾å¾®é•œå¯ä»¥ä»å¤§ä¾¿æŸ¥å‡ºå„ç§å¯„ç”Ÿè™«è™«åµåŠé˜¿ç±³å·´åŸè™«ç­‰ã€‚|||0 4 mic|||31 33 mic|||</td></tr></tbody></table><p>ï¼™ç§å‘½åå®ä½“ç±»åˆ«ï¼Œ</p><p>å¯„ç”Ÿè™«æˆè™«å¯ä»¥åœ¨æ‚£å„¿çš„å¤§ä¾¿ä¸­çœ‹åˆ°ï¼Œé€šè¿‡æ˜¾å¾®é•œå¯ä»¥ä»å¤§ä¾¿æŸ¥å‡ºå„ç§å¯„ç”Ÿè™«è™«åµåŠé˜¿ç±³å·´åŸè™«ç­‰ã€‚|||0 4 mic|||31 33 mic|||</p><p>æ–‡æœ¬ ||| start end category ||| start end category |||</p><h2 id="è¯„ä¼°æ–¹æ³•"><a href="#è¯„ä¼°æ–¹æ³•" class="headerlink" title="è¯„ä¼°æ–¹æ³•"></a>è¯„ä¼°æ–¹æ³•</h2><p>Precisionï¼ŒRecallå’ŒF1å€¼ä½œä¸ºè¯„ä»·æŒ‡æ ‡ã€‚</p><h3 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><ol><li><p>åŸå§‹æ–‡æœ¬å¤§äº1024ä¸ªå­ï¼Œé€šè¿‡ [â€œï¼Œâ€,â€ï¼›â€]åˆ†å‰²å¥å­ï¼ï¼&gt;å°äº210ä¸ªå­—</p><pre class=" language-python"><code class="language-python">   <span class="token triple-quoted-string string">"""è¿‡é•¿å¥å­åˆ†å‰²"""</span>                punt_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                <span class="token keyword">for</span> index<span class="token punctuation">,</span> val <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>text_list<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> val <span class="token keyword">in</span> split_punt<span class="token punctuation">:</span>                        punt_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>index<span class="token punctuation">)</span>                <span class="token keyword">if</span> punt_index<span class="token punctuation">:</span>                    start <span class="token operator">=</span> <span class="token number">0</span>                    <span class="token keyword">for</span> idx <span class="token keyword">in</span> punt_index<span class="token punctuation">:</span>                        texts_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>text_list<span class="token punctuation">[</span>start<span class="token punctuation">:</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                        tags_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tag_list<span class="token punctuation">[</span>start<span class="token punctuation">:</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                        start <span class="token operator">=</span> idx<span class="token operator">+</span><span class="token number">1</span>                    texts_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>text_list<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    tags_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tag_list<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    texts_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>text_list<span class="token punctuation">)</span>                    tags_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tag_list<span class="token punctuation">)</span></code></pre></li><li><p>æ•°æ®BIOæ ‡æ³¨</p><p><img src="/2020/09/22/zhong-wen-yi-xue-wen-ben-ming-ming-shi-ti-shi-bie/1.png"></p></li></ol><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><p>BERT+CRF</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BertCrf</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name_or_path<span class="token punctuation">:</span> str<span class="token punctuation">,</span> num_tags<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>batch_first <span class="token operator">=</span> batch_first        self<span class="token punctuation">.</span>model_name_or_path <span class="token operator">=</span> model_name_or_path        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bert_config <span class="token operator">=</span> BertConfig<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name_or_path<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> num_tags        self<span class="token punctuation">.</span>model_kwargs <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'config': self.bert_config&amp;#125;</span>        self<span class="token punctuation">.</span>bertModel <span class="token operator">=</span> BertForTokenClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name_or_path<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>model_kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>crf_model <span class="token operator">=</span> CRF<span class="token punctuation">(</span>num_tags<span class="token operator">=</span>num_tags<span class="token punctuation">,</span> batch_first<span class="token operator">=</span>batch_first<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_layers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> input_size<span class="token operator">=</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> num_tags<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                tags<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor <span class="token operator">=</span> None<span class="token punctuation">,</span>                attention_mask<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>                token_type_ids<span class="token operator">=</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                decode<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>                reduction<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"mean"</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">:</span>        emissions <span class="token operator">=</span> self<span class="token punctuation">.</span>bertModel<span class="token punctuation">(</span>input_ids<span class="token operator">=</span>input_ids<span class="token punctuation">,</span> attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># emissions, _ = self.lstm(emissions)</span>        <span class="token comment" spellcheck="true"># emissions = self.fc(emissions)</span>        <span class="token comment" spellcheck="true"># è¿™é‡Œåœ¨seq_lençš„ç»´åº¦ä¸Šå»å¤´ï¼Œæ˜¯å»æ‰äº†[CLS]ï¼Œå»å°¾å·´æœ‰ä¸¤ç§æƒ…å†µ</span>        <span class="token comment" spellcheck="true"># 1ã€æ˜¯ &lt;pad> 2ã€[SEP]</span>        new_emissions <span class="token operator">=</span> emissions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## [batch_size, seq_len-2, num_labels] å»æ‰cls å’Œ sep</span>        new_mask <span class="token operator">=</span> attention_mask<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## [batch_size, seq_len-2] å»æ‰cls å’Œ sep</span>        <span class="token keyword">if</span> tags <span class="token keyword">is</span> None<span class="token punctuation">:</span>            loss <span class="token operator">=</span> None            <span class="token keyword">pass</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            new_tags <span class="token operator">=</span> tags<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#</span>            loss <span class="token operator">=</span> self<span class="token punctuation">.</span>crf_model<span class="token punctuation">(</span>emissions<span class="token operator">=</span>new_emissions<span class="token punctuation">,</span> tags<span class="token operator">=</span>new_tags<span class="token punctuation">,</span> mask<span class="token operator">=</span>new_mask<span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reduction<span class="token operator">=</span>reduction<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [1]</span>        <span class="token keyword">if</span> decode<span class="token punctuation">:</span>            tag_list <span class="token operator">=</span> self<span class="token punctuation">.</span>crf_model<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>emissions<span class="token operator">=</span>new_emissions<span class="token punctuation">,</span> mask<span class="token operator">=</span>new_mask<span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>loss<span class="token punctuation">,</span> tag_list<span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>loss<span class="token punctuation">]</span></code></pre><h2 id="è®­ç»ƒå‚æ•°"><a href="#è®­ç»ƒå‚æ•°" class="headerlink" title="è®­ç»ƒå‚æ•°"></a>è®­ç»ƒå‚æ•°</h2><pre class=" language-shell"><code class="language-shell">--model_name_or_path/home/daiyizheng/.cache/torch/transformers/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/--data_dir./input/middle_data/210--output_dir./output--do_predict</code></pre><h2 id="è®­ç»ƒç»“æœ"><a href="#è®­ç»ƒç»“æœ" class="headerlink" title="è®­ç»ƒç»“æœ"></a>è®­ç»ƒç»“æœ</h2><table><thead><tr><th></th><th>f1-score</th></tr></thead><tbody><tr><td>train</td><td>0.69</td></tr><tr><td>dev</td><td>0.63</td></tr><tr><td>test</td><td>0.61</td></tr></tbody></table><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><pre class=" language-text"><code class="language-text">t       r           pæˆ    B-DIS    Oäºº    I-DIS    Oäºš    O    I-BODç¾¤    O    I-BODç»†    O    B-BODèƒ    O    I-BOD</code></pre><p>å¯¹äºè¿™éƒ¨åˆ†æ•°æ®ï¼Œå—åˆ°ä¸»è§‚æ ‡æ³¨å½±å“</p><pre class=" language-text"><code class="language-text"> t          r           pè‚º    B-SYM    B-DISå†…    I-SYM    I-DISç‚    I-SYM    I-DISæ€§    I-SYM    I-DISç—…    I-SYM    I-DISå˜    I-SYM    I-DIS</code></pre><p>æ¨¡å‹ç†è§£é”™è¯¯ï¼ŒæŠŠè‚ºéƒ¨ç‚ä½œä¸ºæ¯”é‡çš„å¤§ä¿¡æ¯ï¼Œå› è€Œåˆ†åˆ°ç–¾ç—…ä¸€ç±»</p><pre class=" language-text"><code class="language-text">è‚º    B-SYM    B-BODéƒ¨    I-SYM    I-BODç—…    I-SYM    Oå˜    I-SYM    O</code></pre><p>åˆ†è¯è¾¹ç•Œï¼Œç”±äºè¾“å…¥tokenå­çº§åˆ«çš„ï¼Œæ— æ³•å¾—åˆ°è¯å‘é‡ä¿¡æ¯ï¼Œåˆ†è¯è¾¹ç•Œæœ‰é—®é¢˜</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åºåˆ—æ ‡æ³¨ </tag>
            
            <tag> å®ä½“è¯†åˆ« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVMåŸç†</title>
      <link href="/2020/09/20/svm-yuan-li/"/>
      <url>/2020/09/20/svm-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>#ã€€æ”¯æŒå‘é‡æœº</p><p>æ”¯æŒå‘é‡æœºï¼ˆsupport vector machines, SVMï¼‰æ˜¯ä¸€ç§äºŒåˆ†ç±»æ¨¡å‹ï¼Œå®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯å®šä¹‰åœ¨ç‰¹å¾ç©ºé—´ä¸Šçš„<strong>é—´éš”æœ€å¤§çš„çº¿æ€§åˆ†ç±»å™¨</strong>ï¼Œé—´éš”æœ€å¤§ä½¿å®ƒæœ‰åˆ«äºæ„ŸçŸ¥æœºï¼›SVMè¿˜åŒ…æ‹¬<strong>æ ¸æŠ€å·§</strong>ï¼Œè¿™ä½¿å®ƒæˆä¸ºå®è´¨ä¸Šçš„éçº¿æ€§åˆ†ç±»å™¨ã€‚SVMçš„çš„å­¦ä¹ ç­–ç•¥å°±æ˜¯é—´éš”æœ€å¤§åŒ–ï¼Œå¯å½¢å¼åŒ–ä¸ºä¸€ä¸ªæ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’çš„é—®é¢˜ï¼Œä¹Ÿç­‰ä»·äºæ­£åˆ™åŒ–çš„åˆé¡µæŸå¤±å‡½æ•°çš„æœ€å°åŒ–é—®é¢˜ã€‚SVMçš„çš„å­¦ä¹ ç®—æ³•å°±æ˜¯æ±‚è§£å‡¸äºŒæ¬¡è§„åˆ’çš„æœ€ä¼˜åŒ–ç®—æ³•ã€‚</p><h2 id="SVMç®—æ³•åŸç†"><a href="#SVMç®—æ³•åŸç†" class="headerlink" title="SVMç®—æ³•åŸç†"></a>SVMç®—æ³•åŸç†</h2><p>SVMå­¦ä¹ çš„åŸºæœ¬æƒ³æ³•æ˜¯æ±‚è§£èƒ½å¤Ÿæ­£ç¡®åˆ’åˆ†è®­ç»ƒæ•°æ®é›†å¹¶ä¸”å‡ ä½•é—´éš”æœ€å¤§çš„åˆ†ç¦»è¶…å¹³é¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ $W \dot x + b = 0$ å³ä¸ºåˆ†ç¦»è¶…å¹³é¢ï¼Œå¯¹äºçº¿æ€§å¯åˆ†çš„æ•°æ®é›†æ¥è¯´ï¼Œè¿™æ ·çš„è¶…å¹³é¢æœ‰æ— ç©·å¤šä¸ªï¼ˆå³æ„ŸçŸ¥æœºï¼‰ï¼Œä½†æ˜¯å‡ ä½•é—´éš”æœ€å¤§çš„åˆ†ç¦»è¶…å¹³é¢å´æ˜¯å”¯ä¸€çš„ã€‚</p><p><img src="/2020/09/20/svm-yuan-li/1.jpg"></p><p>å…¬å¼æ¨å¯¼</p><p>å‚è€ƒæèˆª&lt;&lt;ç»Ÿè®¡å­¦åŸç†&gt;&gt;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šè½®å¯¹è¯æ¡†æ¶Rasaä»£ç è§£è¯»-1</title>
      <link href="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/"/>
      <url>/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Rasa"><a href="#Rasa" class="headerlink" title="Rasa"></a>Rasa</h1><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/1.png"></p><p>ä¸¤ä¸ªæ ¸å¿ƒçš„å­æ¨¡å—ï¼šcoreå’Œnlu</p><h2 id="Nluæ¨¡å—"><a href="#Nluæ¨¡å—" class="headerlink" title="Nluæ¨¡å—"></a>Nluæ¨¡å—</h2><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/2.png"></p><ul><li>componentï¼šåœ¨æˆ‘ä»¬åšä»»ä½•è‡ªç„¶è¯­è¨€å¤„ç†çš„ä»»åŠ¡æ—¶ï¼Œä¸æ­¢æ˜¯ç”¨å•çº¯æ¨¡å‹å»åšä¸€äº›åˆ†ç±»æˆ–è€…æ ‡æ³¨ä»»åŠ¡ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæœ‰ç›¸å½“ä¸€éƒ¨åˆ†å·¥ä½œæ˜¯å¯¹æ–‡æœ¬åšä¸€äº›é¢„å¤„ç†å·¥ä½œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šåˆ†è¯ï¼ˆå°¤å…¶æ˜¯ä¸­æ–‡æ–‡æœ¬ï¼‰ï¼Œè¯æ€§æ ‡æ³¨ï¼Œç‰¹å¾æå–ï¼ˆä¼ ç»ŸMLæˆ–è€…ç»Ÿè®¡å‹æ–¹æ³•ï¼‰ï¼Œè¯åº“æ„å»ºç­‰ç­‰ã€‚åœ¨rasaä¸­ï¼Œè¿™äº›ä¸åŒçš„é¢„å¤„ç†å·¥ä½œä»¥åŠåç»­çš„æ„å›¾åˆ†ç±»å’Œå®ä½“è¯†åˆ«éƒ½æ˜¯é€šè¿‡å•ç‹¬çš„ç»„ä»¶æ¥å®Œæˆï¼Œå› æ­¤componentåœ¨NLUä¸­æ‰¿æ‹…ç€å®ŒæˆNLUä¸åŒé˜¶æ®µä»»åŠ¡çš„è´£ä»»ã€‚componentç±»å‹å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼štokenizer,featurizer,extractor,classifierã€‚å½“ç„¶è¿˜æœ‰emulatorsï¼Œè¿™ä¸ªä¸»è¦ç”¨äºè¿›è¡Œå¯¹è¯ä»¿çœŸæµ‹è¯•ï¼Œæˆ‘ç›®å‰è¿˜æ²¡ä½¿ç”¨è¿‡ï¼Œå°±ä¸å¤šæè¿°è¿™ä¸ªç»„ä»¶äº†ã€‚</li><li>pipelineï¼šæœ‰äº†ç»„ä»¶ä¹‹åï¼Œå¦‚ä½•å°†ç»„ä»¶æŒ‰éƒ¨å°±ç­ï¼Œäº•ç„¶æœ‰åºåœ°æ‹¼è£…èµ·æ¥ï¼Œå¹¶æ­£å¸¸å·¥ä½œå‘¢ï¼Ÿå› æ­¤å°±æœ‰äº†pipelineè¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸï¼Œpipelineè¿™ä¸ªæ¦‚å¿µå·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ï¼Œå®ƒåœ¨å¾ˆå¤šæ¡†æ¶ä¸­éƒ½æœ‰ï¼Œæ¯”å¦‚å¤§åé¼é¼çš„sklearnã€‚ä½¿ç”¨pipelineçš„å¥½å¤„åœ¨äºå¯ä»¥åˆç†æœ‰åºç®¡ç†ä¸åŒä»»åŠ¡é˜¶æ®µçš„ä¸åŒç»„ä»¶å·¥å…·ï¼Œå½“ç»„ä»¶æ•°é‡è¾ƒå¤šæ—¶ï¼Œpipelineçš„å¥½å¤„å°±éå¸¸æ˜æ˜¾äº†ã€‚è€Œåœ¨rasaä¸­ï¼Œpipelineçš„ä½¿ç”¨æ›´ä¸ºä¾¿æ·ï¼Œæ˜¯é€šè¿‡ymlé…ç½®æ–‡ä»¶å®ç°ã€‚å³å¼€å‘è€…åªéœ€è¦å®šä¹‰å¥½è‡ªå·±çš„ç»„ä»¶ï¼Œç„¶åå°†ç»„ä»¶é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­å°±å¯ä»¥ï¼Œå³æ’å³ç”¨ã€‚</li></ul><blockquote><p>tips1:è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œé…ç½®çš„ç»„ä»¶åç§°nameå¯¹åº”çš„æ˜¯ç»„ä»¶ç±»çš„ç±»åã€‚è€Œåé¢è·Ÿç€çš„key-valueé”®å€¼å¯¹ï¼Œå¯¹åº”çš„æ˜¯ç»„ä»¶ç±»éœ€è¦ä¼ å…¥çš„åˆå§‹çš„å‚æ•°ã€‚å‚è€ƒ</p></blockquote><ul><li>messageï¼šåœ¨rasaä¸­ï¼Œç”¨æˆ·å‘é€åˆ°chatbotçš„æ‰€æœ‰å¯¹è¯å†…å®¹ï¼Œéƒ½éœ€è¦è¢«å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯Message.è€Œåœ¨æ•´ä¸ªrasaå·¥ä½œæµä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸åŒçš„messageå°è£…å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯UserMessageï¼Œå¦ä¸€ä¸ªæ˜¯Messageã€‚å…¶ä¸­UserMessageæ˜¯æœ€ä¸Šå±‚çš„å°è£…å¯¹è±¡ï¼Œå³ç›´æ¥æ¥æ”¶ç”¨æˆ·ä»æŸä¸ªå¹³å°æ¥å£ä¼ é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚è€ŒMessageåˆ™æ˜¯å½“ç”¨æˆ·æ¶ˆæ¯æµåˆ°NLUæ¨¡å—æ—¶ï¼Œå°†ç”¨æˆ·æ¶ˆæ¯è¿›è¡Œå°è£…ã€‚å…³äºUserMessageçš„å†…å®¹åœ¨åé¢ä»£ç è¯¦è§£æ—¶ä¼šæ¶‰åŠåˆ°ï¼Œè¿™é‡Œå…ˆè§£é‡Šä¸€ä¸‹Messageå¯¹è±¡ã€‚çœ‹ä¸€ä¸‹å®ƒçš„ç±»éƒ¨åˆ†å®šä¹‰ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å°†ç”¨æˆ·çš„å¯¹è¯æ–‡æœ¬ï¼Œä»¥åŠæ—¶é—´è¿›è¡Œå°è£…ï¼Œç”±äºè¿™ä¸ªMessageæ˜¯è´¯ç©¿æ•´ä¸ªNLUå·¥ä½œæµçš„ç»Ÿä¸€æ•°æ®å¯¹è±¡ï¼Œå› æ­¤è¿˜æ‰¿è½½ç€è®°å¿†å„ä¸ªç»„ä»¶ä¸´æ—¶ç”Ÿæˆçš„ä¸­é—´ç»“æœï¼ˆæ¯”å¦‚åˆ†è¯å’Œè¯æ€§æ ‡æ³¨çš„ç»“æœï¼‰ä»¥åŠæœ€ç»ˆå¾—åˆ°çš„æ„å›¾å’Œå®ä½“ä¿¡æ¯ã€‚å…¶ä¸­dataå­˜æ”¾çš„æ˜¯æ„å›¾å’Œå®ä½“ä¿¡æ¯ï¼Œåœ¨åç»­ç»„ä»¶å¤„ç†æ—¶ï¼Œè¿˜ä¼šå†Messageä¸­å¢åŠ ä¸€äº›å˜é‡å­˜å‚¨ä¸­é—´ç»“æœï¼Œå³setæˆå‘˜æ–¹æ³•çš„èŒè´£ã€‚</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Message</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> Text<span class="token punctuation">,</span> data<span class="token operator">=</span>None<span class="token punctuation">,</span> output_properties<span class="token operator">=</span>None<span class="token punctuation">,</span> time<span class="token operator">=</span>None    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>text <span class="token operator">=</span> text        self<span class="token punctuation">.</span>time <span class="token operator">=</span> time        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data <span class="token keyword">if</span> data <span class="token keyword">else</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>        <span class="token keyword">if</span> output_properties<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>output_properties <span class="token operator">=</span> output_properties        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>output_properties <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> info<span class="token punctuation">,</span> add_to_output<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> info        <span class="token keyword">if</span> add_to_output<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>output_properties<span class="token punctuation">.</span>add<span class="token punctuation">(</span>prop<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> default<span class="token operator">=</span>None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Any<span class="token punctuation">:</span>        <span class="token keyword">if</span> prop <span class="token operator">==</span> TEXT<span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>text        <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span>prop<span class="token punctuation">,</span> default<span class="token punctuation">)</span></code></pre><p>å¯¹ä¸Šé¢ä¸‰ä¸ªæ¦‚å¿µæ˜ç¡®ä»¥åï¼Œä¸‹é¢åˆ—å‡ºä¸åŒç»„ä»¶çš„ä»£ç ç»“æ„ï¼š</p><p>rasaä¸­ï¼Œå·²ç»é¢„ç½®äº†ä¸€äº›ç»„ä»¶ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶æœ‰äº›ç»„ä»¶æ˜¯éœ€è¦å…ˆè¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°æ¨¡å‹åï¼Œæ‰èƒ½ä½¿ç”¨ï¼Œè€Œæœ‰äº›åˆ™æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…å…³é”®è¯ç­‰è§„åˆ™ï¼Œç›´æ¥å°±å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä»¥CRFEntityExtractorä¸ºä¾‹ï¼Œè®²è§£ä¸€ä¸‹Componentçš„ä¸»è¦æ ¸å¿ƒè¦ç´ ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">CRFEntityExtractor</span><span class="token punctuation">(</span>EntityExtractor<span class="token punctuation">)</span><span class="token punctuation">:</span>    @classmethod    <span class="token keyword">def</span> <span class="token function">required_components</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Type<span class="token punctuation">[</span>Component<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>Tokenizer<span class="token punctuation">]</span> <span class="token keyword">class</span> <span class="token class-name">EntityExtractor</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">add_extractor_name</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> entities<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> entity <span class="token keyword">in</span> entities<span class="token punctuation">:</span>            entity<span class="token punctuation">[</span>EXTRACTOR<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>name        <span class="token keyword">return</span> entities    <span class="token keyword">class</span> <span class="token class-name">Component</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>ComponentMetaclass<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">pass</span></code></pre><ul><li>é¦–å…ˆçœ‹åˆ°ï¼Œè¯¥ç±»ç»§æ‰¿äº†ä¸€ä¸ªEntityExtractorï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒçº§ç»„ä»¶æŠ½è±¡ç±»ï¼ˆæˆ‘è‡ªå·±å®šä¹‰çš„è¯´æ³•ï¼‰ï¼Œè¿™ä¸ªäºŒå±‚æŠ½è±¡ç±»ç»§æ‰¿è‡ªComponentè¿™ä¸ªä¸€çº§æŠ½è±¡ç±»ã€‚å› ä¸ºä¸åŒç»„ä»¶æ‰¿æ‹…çš„ä»»åŠ¡ä¸åŒï¼Œæœ‰äº›ç»„ä»¶ä»»åŠ¡æ¯”è¾ƒå•ä¸€ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿Componentæ¯”å¦‚tokenizer,classifierï¼Œè€Œæœ‰äº›ç»„ä»¶çš„ä»»åŠ¡æ¯”è¾ƒå¤æ‚ï¼Œåˆ™éœ€è¦åˆ¶å®šè¿™ä¸€ç±»å‹çš„äºŒçº§æ¥å£ï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œå¦‚featurizer,extractorã€‚</li><li>å¯¹äºCRFEntityExtractoræ¥è¯´ï¼Œå®ƒæä¾›äº†å®ä½“çš„æŠ½å–ï¼ŒåŒæ—¶ä¸ºäº†è¿›è¡Œå®ä½“æŠ½å–ï¼Œéœ€è¦å…ˆå¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œå› æ­¤éœ€è¦ä¸Šæ¸¸ä»»åŠ¡å…ˆå®Œæˆtokenizerä»»åŠ¡ï¼Œæä¾›tokensçš„ä¸­é—´æˆæœã€‚</li><li>trainæ–¹æ³•ã€‚æ—¢ç„¶æ˜¯ä½¿ç”¨æ¡ä»¶éšæœºåœºæ¥è¿›è¡Œå®ä½“æŠ½å–ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚å› æ­¤éœ€è¦å®šä¹‰trainæ–¹æ³•ï¼Œæ¥è®­ç»ƒæ¨¡å‹ã€‚å…³æ³¨trainæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°training_dataå’Œconfigã€‚å…¶ä¸­ï¼Œconfigå°±æ˜¯ä¹‹å‰æåˆ°çš„é…ç½®pipelineçš„é…ç½®æ–‡ä»¶çš„è¯»å–å¯¹è±¡ã€‚training_dataæ˜¯TrainingDataç±»å‹çš„å¯¹è±¡ã€‚ä½ å¯ä»¥å°†å…¶ç±»æ¯”äºpytorchä¸­çš„data_loaderåŠŸèƒ½ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œå°è£…ï¼Œæ‹†åˆ†è®­ç»ƒé›†éªŒè¯é›†ï¼Œåšæ•°æ®æ ¡éªŒç­‰å·¥ä½œã€‚è¯´åˆ°è¿™é‡Œï¼Œæä¸€ä¸‹rasaæ”¯æŒçš„åŸå§‹è®­ç»ƒæ•°æ®çš„å­˜æ”¾æ ¼å¼ï¼Œä¸»è¦æ”¯æŒmarkdownï¼Œwitï¼Œluisç­‰æ–‡ä»¶æ ¼å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æä¾›jsonæ ¼å¼çš„æ•°æ®ã€‚rasaå¦‚ä½•è¯»å–è¿™äº›æ ¼å¼çš„è®­ç»ƒæ•°æ®åˆ™æ˜¯åœ¨å¦‚ä¸‹ä»£ç åŒ…é‡Œå®šä¹‰ï¼š</li></ul><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/4.png"></p><ul><li>persistå’Œloadæ–¹æ³•ã€‚å½“æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œéœ€è¦ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ï¼Œå¯¹ç”Ÿäº§ç¯å¢ƒä¸Šçš„å®æ—¶ä¸šåŠ¡æµè¿›è¡Œå¤„ç†ï¼Œå› æ­¤éœ€è¦å®šä¹‰persistå’Œloadæ–¹æ³•åŠ è½½æ¨¡å‹ã€‚</li><li>processæ–¹æ³•ã€‚è¿™ä¸ªå¯ä»¥è¯´æ˜¯ç»„ä»¶é‡Œé¢æœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ã€‚å½“å‰é¢ä¸€é€šæ“ä½œä¹‹åï¼Œåªå¾—åˆ°äº†æ¨¡å‹ï¼Œå¦‚ä½•è°ƒç”¨è¿™ä¸ªæ¨¡å‹å¹¶å¤„ç†æ–‡æœ¬ï¼Œå°±æ˜¯processæ–¹æ³•çš„å·¥ä½œäº†ã€‚æœ€ååœ¨messageä¸­å¢åŠ ä¸€ä¸ªdictï¼Œåä¸ºentitiesï¼Œç”¨æ¥å­˜æ”¾æå–çš„å®ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ä½“çš„ç±»å‹ï¼Œå®ä½“çš„åœ¨æ–‡æœ¬ä¸­çš„startå’Œendçš„ä½ç½®ä¿¡æ¯ç­‰ã€‚</li></ul><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> Message<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        entities <span class="token operator">=</span> self<span class="token punctuation">.</span>extract_entities<span class="token punctuation">(</span>message<span class="token punctuation">)</span>        entities <span class="token operator">=</span> self<span class="token punctuation">.</span>add_extractor_name<span class="token punctuation">(</span>entities<span class="token punctuation">)</span>        message<span class="token punctuation">.</span>set<span class="token punctuation">(</span>ENTITIES<span class="token punctuation">,</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span>ENTITIES<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> entities<span class="token punctuation">,</span> add_to_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><blockquote><p>tips2ï¼šå¯¹äºå¯¹è¯ä¸­ï¼Œæ¶‰åŠåˆ°çš„æ‰€æœ‰intentå’Œå®ä½“ï¼Œå‡éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ï¼Œæ–¹ä¾¿å„ä¸ªç»„ä»¶åœ¨åšç›¸åº”çš„æ–‡æœ¬åˆ†ææ—¶è¿›è¡Œlookup-tableæŸ¥æ‰¾ã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶å«domain.ymlï¼Œä¸€ä¸ªç®€å•çš„å®ä¾‹å¦‚ä¸‹ï¼š</p></blockquote><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/6.png"></p><pre class=" language-python"><code class="language-python">tips3ï¼šè¿™é‡Œè¯´ä¸€ä¸ªå®ç”¨æŠ€å·§ã€‚åœ¨å®é™…çš„å¯¹è¯åœºæ™¯ä¸­ï¼Œç”¨æˆ·çš„ä¸€ä¸ªutteranceï¼ˆè¡¨è¾¾ï¼‰é€šå¸¸ä¼šå¸¦æœ‰ä¸æ­¢ä¸€ä¸ªæ„å›¾ï¼Œæœ‰çš„äººä¼šå°†è¿™ç§æƒ…å†µå½“åšä¸€ä¸ªå¤åˆå‹å•æ„å›¾ï¼Œå°†å…¶æ·»åŠ åˆ°domainé…ç½®æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯å®é™…ä¸Šå¤§å¯ä»¥ä¸å¿…è¿™ä¹ˆéº»çƒ¦ï¼Œæ­¤æ—¶ç›¸å½“äºä»ä¸€ä¸ªæ„å›¾å¤šåˆ†ç±»é—®é¢˜ï¼Œè½¬å˜ä¸ºä¸€ä¸ªæ„å›¾å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜ï¼Œå³æ¯æ¡æ•°æ®å¯èƒ½ä¸æ­¢ä¸€ä¸ªæ ‡ç­¾ï¼Œæ­¤æ—¶åªéœ€è¦å°†æ¨¡å‹çš„æœ€åä¸€å±‚softmaxå±‚ï¼Œæ›¿æ¢ä¸ºnä¸ªsigmoidåˆ†ç±»å™¨å°±å¯ä»¥ã€‚åœ¨è®­ç»ƒæ•°æ®ä¸­ï¼Œæˆ‘åˆ™éœ€è¦é…ç½®è¿™ç§è®­ç»ƒæ•°æ®ï¼Œå°†å¤šä¸ªæ„å›¾ä½¿ç”¨æŸä¸ªç¬¦å·<span class="token string">"+"</span>æˆ–è€…<span class="token string">"_"</span>ç­‰è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚åœ¨classifierä¸­è¿›è¡Œå¤„ç†ã€‚è¿™æ ·å°±æ— éœ€åœ¨domainé…ç½®æ–‡ä»¶ä¸­é…ç½®è¯¸å¦‚inform_affirmè¿™æ ·å†—ä½™çš„æ„å›¾äº†ã€‚</code></pre><p>rasaä¸­å·²ç»é›†æˆäº†è®¸å¤šæœ‰ç”¨çš„ç»„ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é’ˆå¯¹ä¸­æ–‡æ–‡æœ¬ï¼Œæœ‰jiebaåˆ†è¯ï¼Œå¦å¤–è¿˜æœ‰ä¸“é—¨å¯¹æ—¶é—´ä¿¡æ¯è¿›è¡Œæå–çš„ç»„ä»¶ducklingHTTPExctractor,è¦ä½¿ç”¨è¿™äº›ç»„ä»¶éƒ½éœ€è¦å®‰è£…ç›¸åº”çš„ä¾èµ–åŒ…ã€‚</p><h2 id="core"><a href="#core" class="headerlink" title="core"></a>core</h2><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/3.png"></p><p>é™¤å»coreæ ¹è·¯å¾„ä¸‹çš„ä¸€äº›å…¬å…±èµ„æºå’Œå…¥å£æ–¹æ³•å¤–ï¼Œå¯ä»¥çœ‹å‡ºcoreæ ¹æ®åŒ…åå¤§æ¦‚åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>actions,è¯¥åŒ…ä¸‹é¢ä¸»è¦å­˜æ”¾çš„æ˜¯actionå…·ä½“çš„å®ç°ç±»ã€‚å…³äºactionçš„å…·ä½“å®šä¹‰å’Œæè¿°åœ¨åé¢ä¼šæœ‰è¯¦ç»†è®²è§£ï¼Œç®€å•è¯´å°±æ˜¯chatbotæ‰§è¡Œçš„ä¸€äº›åŠ¨ä½œã€‚</li><li>channels,è¯¥åŒ…ä¸‹é¢ä¸»è¦å­˜æ”¾çš„æ˜¯rasaä¸å‰ç«¯å¹³å°è¿›è¡Œå¯¹æ¥çš„æ¥å£ã€‚å› ä¸ºrasaæœ¬èº«åªæä¾›å¯¹è¯ç³»ç»Ÿçš„åŠŸèƒ½æœåŠ¡ï¼Œå…·ä½“è¿˜éœ€è¦ä¸ç”¨æˆ·åœ¨å‰ç«¯ç•Œé¢è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ªåŒ…é‡Œå®šä¹‰äº†ä¸åŒçš„æ¥å£å’Œä¸åŒå¹³å°è¿›è¡Œå¯¹æ¥ã€‚ä¾‹å¦‚ï¼Œconsole.pyï¼Œå®šä¹‰äº†æœ€ç®€å•çš„ç›´æ¥åœ¨shellå‘½ä»¤è¡Œä¸­è¿›è¡Œå¯¹è¯äº¤äº’çš„æ¥å£ã€‚</li><li>eventsï¼Œè¿™ä¸ªæ˜¯rasaä¸­å®šä¹‰çš„chatbotèƒ½æ‰§è¡Œçš„æœ€å°ç²’åº¦çš„åŠ¨ä½œã€‚ä¸actionæœ‰ä¸€äº›å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡actionè°ƒç”¨ä¸åŒçš„eventsæ¥å®ç°ä¸åŒçš„æ“ä½œã€‚eventsçš„å®ä¾‹æœ‰â€œSlotSetâ€(æ§½ä½å¡«å……),â€Restartedâ€ï¼ˆé‡å¯å¯¹è¯ï¼Œå°†æ‰€æœ‰çŠ¶æ€é‡ç½®ï¼‰ç­‰ç­‰ã€‚</li><li>nlgï¼Œrasaçš„responseç”Ÿæˆæ¨¡å—ï¼Œå³ç”Ÿäº§chatbotè¿”å›ç»™ç”¨æˆ·çš„æ¶ˆæ¯ã€‚ç›®å‰ï¼Œrasaæ”¯æŒé€šè¿‡æ¨¡æ¿ç”Ÿæˆè¯æœ¯ï¼Œä¹Ÿæ”¯æŒé€šè¿‡machine learningçš„æ–¹å¼åšNLGã€‚nlgæ¨¡å—ä¸­å®šä¹‰äº†æ–¹æ³•è¯»å–domain.ymlä¸­çš„é¢„å®šä¹‰çš„è¯æœ¯æ¨¡æ¿ï¼Œç„¶åç”Ÿæˆå…·ä½“çš„æ¶ˆæ¯ã€‚</li><li>policiesï¼Œæ­¤æ¨¡å—æ˜¯coreæœ€ä¸Šå±‚çš„å¯¹è¯ç®¡ç†æ§åˆ¶æ¨¡å—ã€‚è¯¥åŒ…ä¸­ï¼Œå®šä¹‰äº†ä¸åŒç±»å‹çš„å¯¹è¯ç®¡ç†ç­–ç•¥ï¼Œrasaå°†ä¾æ®è¿™äº›ç­–ç•¥ï¼Œæ‰§è¡Œä¸åŒactionsï¼Œå®Œæˆå¤šè½®å¯¹è¯ä»»åŠ¡ã€‚è¿™äº›ç­–ç•¥åŒ…æ‹¬äººå·¥è§„åˆ™ç­–ç•¥å¦‚form_policy,memoizationç­‰ï¼Œä¹ŸåŒ…æ‹¬é€šè¿‡æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ è¿›è¡Œè®­ç»ƒå¾—åˆ°ç­–ç•¥æ¨¡å‹ï¼Œå¦‚sklearn_policy,keras_policyç­‰ã€‚</li><li>schemasï¼Œè¿™é‡Œä¸»è¦æ”¾ç½®coreçš„é…ç½®æ–‡ä»¶domian.ymlï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸»è¦é…ç½®æ§½ä½å®šä¹‰ï¼Œå®ä½“å®šä¹‰ï¼Œè¯æœ¯æ¨¡æ¿ï¼Œä½¿ç”¨çš„actionsçš„åç§°å®šä¹‰ä»¥åŠå…¶ä»–ç³»ç»Ÿé…ç½®ã€‚å¼€å‘è€…åœ¨å¼€å‘è‡ªå·±çš„å¯¹è¯ç³»ç»Ÿæ—¶ï¼Œéœ€è¦è‡ªå®šä¹‰è¿™ä¸ªé…ç½®æ–‡ä»¶æ¥è¦†ç›–æºç ä¸­é¢„å®šä¹‰çš„é…ç½®ã€‚</li><li>training,è¿™é‡Œä¸»è¦å­˜æ”¾çš„æ˜¯å¦‚ä½•å°†å‡†å¤‡çš„æ•°æ®è½¬åŒ–ä¸ºå¯¹è¯ç³»ç»Ÿå¯è®­ç»ƒçš„è½¬åŒ–æ–¹æ³•ä»¥åŠå¯è§†åŒ–æ–¹æ³•ã€‚</li></ul><p>æ ¹è·¯å¾„ä¸Šä¹Ÿæœ‰å¾ˆå¤šé‡è¦çš„ç±»æ–‡ä»¶ï¼Œè¿™é‡Œå°±ä¸å…¨éƒ¨æ‹¿å‡ºæ¥è¯´äº†ï¼ŒæŒ‘å‡ ä¸ªé‡ç‚¹çš„è¯´ä¸€ä¸‹ã€‚</p><ul><li>agentï¼Œè¿™æ˜¯coreä¸“é—¨è®¾è®¡çš„ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å°†å…¶è§†ä½œbotä¸»ä½“ï¼Œä¸»è¦ä½œç”¨æ˜¯å°è£…å’Œè°ƒç”¨rasaä¸­æœ€é‡è¦çš„ä¸€äº›åŠŸèƒ½æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šè¿°æåˆ°çš„å‡ ä¸ªåŒ…é‡Œçš„åŠŸèƒ½æ¨¡å—ã€‚</li><li>featurizers: è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯å®šä¹‰äº†ä¸€äº›æ–¹æ³•å°†å¯¹è¯æ•°æ®ç‰¹å¾åŒ–ï¼Œç›®çš„æ˜¯ä¸ºäº†å°†å¯¹è¯æ•°æ®ç”¨äºæœºå™¨å­¦ä¹ çš„è®­ç»ƒã€‚</li><li>interpreter: è¿™ä¸ªæ–¹æ³•æ˜¯coreä¸nluçš„ä¸€ä¸ªçº½å¸¦ï¼Œrasaç®¡ç†æ¨¡å—é€šè¿‡å®šä¹‰interpreterç±»æ–¹æ³•ï¼Œè°ƒç”¨nluä¸­çš„parseræ–¹æ³•æ¥å¯¹ç”¨æˆ·çš„å‘é€åˆ°botçš„æ¶ˆæ¯æ–‡æœ¬è¿›è¡Œå®ä½“æŠ½å–ã€æ„å›¾è¯†åˆ«ç­‰æ“ä½œã€‚</li><li>processorï¼šå®šä¹‰äº†MessageProcessç±»ï¼Œä¾›agentè°ƒç”¨ï¼ŒåŠŸèƒ½æ˜¯æœ‰åºå¾—è°ƒç”¨ä¸åŒå¯¹è¯åŠŸèƒ½ç»„ä»¶ï¼Œä¾‹å¦‚è°ƒç”¨interpreterè§£æç”¨æˆ·æ–‡æœ¬ã€è°ƒç”¨æœ¬è½®å¯¹è¯çš„actionå®Œæˆä¸€äº›æ“ä½œã€æ ¹æ®policyå¾—åˆ°ä¸‹ä¸€æ­¥çš„actionã€è®°å½•å¯¹è¯çŠ¶æ€ç­‰ã€‚</li><li>trackersï¼šè¿™ä¸ªä¹Ÿæ˜¯rasaä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯rasaå¯¹è¯ç³»ç»Ÿä¸­çš„çŠ¶æ€è®°å½•å™¨ï¼Œæ¯ä¸€è½®å¯¹è¯ä¸­ï¼Œå¯¹è¯çš„çŠ¶æ€ä¿¡æ¯éƒ½ä¼šè¿›è¡Œæ›´æ–°å¹¶ä¿å­˜åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚ä¾‹å¦‚å½“å‰å·²å¡«å……çš„æ§½ä½ã€ç”¨æˆ·æœ€åä¸€æ¬¡å‘é€çš„æ–‡æœ¬ã€å½“å‰ç”¨æˆ·çš„æ„å›¾ç­‰ç­‰ã€‚</li></ul><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/7.png"></p><p>è¿™æ¬¡ï¼Œæˆ‘ä»¬ä»¥coreä¸ºä¸»è§†è§’ï¼Œå°†è¿™ä¸ªå›¾é‡æ–°è§£æä¸€éï¼Œç€é‡æè¿°coreåœ¨å¯¹è¯ç³»ç»Ÿä¸­çš„åŠŸèƒ½ä¸ä½œç”¨ã€‚</p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/8.png" alt="8" style="zoom:75%;"><h3 id="InputChannelå’ŒOutputChannel"><a href="#InputChannelå’ŒOutputChannel" class="headerlink" title="InputChannelå’ŒOutputChannel"></a>InputChannelå’ŒOutputChannel</h3><p>OutputChannelå°è£…äº†chatbotéœ€è¦è¿”å›ç»™ç”¨æˆ·çš„ä¿¡æ¯ï¼Œéœ€è¦æ³¨æ„ï¼Œchatbotè¿”å›çš„æ¶ˆæ¯ä¸ä¸€å®šæ˜¯çº¯æ–‡æœ¬ï¼Œè¿˜å¯èƒ½æ˜¯htmlï¼Œjsonï¼Œæ–‡ä»¶é™„ä»¶ç­‰ç­‰ï¼Œå› æ­¤éœ€è¦OutputChannelè¿™ä¸ªç»Ÿä¸€æ¥å£è¿›è¡Œå°è£…å¤„ç†ï¼Œå› æ­¤chatbotå¯ä»¥æ”¯æŒè®©ç”¨æˆ·è¿›è¡Œç‚¹é€‰åŠŸèƒ½ï¼ˆå½“ç„¶ï¼Œå‰ææ˜¯å‰ç«¯ç•Œé¢æ”¯æŒç‚¹é€‰çš„é€‚é…ï¼‰ã€‚</p><p>InputChannelä¸»è¦è´Ÿè´£å°†ç”¨æˆ·è¾“å…¥è¿åŒç”¨æˆ·çš„èº«ä»½ä¿¡æ¯å°è£…æˆUserMessageå¯¹è±¡ï¼Œæ–¹ä¾¿åé¢çš„Processorå¤„ç†ã€‚å¯¹åº”çš„ï¼Œå¦‚æœåœ¨ä¸Šä¸€è½®å¯¹è¯ä¸­ï¼ŒOutputChannelæ˜¯ç‚¹é€‰æˆ–è€…å…¶ä»–éå•çº¯æ–‡æœ¬è¾“å‡ºï¼Œé‚£ä¹ˆæœ¬è½®å¯¹è¯ä¸­çš„InputChannelä¹Ÿéœ€è¦æ¥å—ç”¨æˆ·ç‚¹é€‰æˆ–è€…å…¶ä»–éå•çº¯æ–‡æœ¬çš„è¾“å…¥ï¼Œå°è£…æˆæœ€ç»ˆçš„UserMessageã€‚</p><h3 id="UserMessage"><a href="#UserMessage" class="headerlink" title="UserMessage"></a>UserMessage</h3><p>å…³äºUserMessageå¯¹è±¡ï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­å·²ç»æœ‰è¿‡ä»‹ç»ï¼Œè¿™é‡Œç»™å‡ºå…¶å…·ä½“çš„æˆå‘˜å˜é‡å°è£…æƒ…å†µ</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">UserMessage</span><span class="token punctuation">:</span>    DEFAULT_SENDER_ID <span class="token operator">=</span> <span class="token string">"default"</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        text<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        output_channel<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token string">"OutputChannel"</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        sender_id<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        parse_data<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        input_channel<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        message_id<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        metadata<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span></code></pre><p>å¯ä»¥çœ‹åˆ°ä½œä¸ºè´¯ç©¿æ•´ä¸ªcoreå¤„ç†æµç¨‹çš„ç”¨æˆ·æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒçš„æˆå‘˜ç»“æ„è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼ŒåŒ…æ‹¬äº†ç”¨æˆ·å‘é€çš„æ–‡æœ¬ï¼Œå®šä¹‰çš„OutputChannelç±»å‹ï¼Œç”¨æˆ·çš„idï¼Œparse_data(ä¸»è¦å­˜æ”¾ç”¨æˆ·è‡ªå·±å®šä¹‰çš„å®ä½“é”®å€¼å¯¹ï¼Œå¼€å‘è°ƒè¯•ç”¨),inputChannelç±»å‹ï¼Œä»¥åŠmessageçš„idã€‚</p><h3 id="policy"><a href="#policy" class="headerlink" title="policy"></a>policy</h3><p>å¯¹è¯ç®¡ç†ç­–ç•¥æ˜¯å¤šè½®å¯¹è¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç›¸å½“äºå¯¹è¯ç³»ç»Ÿçš„å¤§è„‘ï¼Œå®ƒè´Ÿè´£æ ¹æ®å½“å‰ç”¨æˆ·çš„åé¦ˆï¼Œå‘Šè¯‰Processorå½“å‰è½®å¯¹è¯ä¸­éœ€è¦é‡‡å–çš„åç»­actionï¼Œä»¥åŠå¦‚ä½•æ›´æ–°å¯¹è¯çŠ¶æ€ä¿¡æ¯ç­‰ã€‚rasaæ”¯æŒäººå·¥è§„åˆ™çš„ç­–ç•¥ï¼Œä¹Ÿæ”¯æŒæœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ å¾—åˆ°çš„æ•°æ®é©±åŠ¨ç­–ç•¥ã€‚</p><p>ä»¥Form_policyä¸ºä¾‹ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯ä¸€ç§è¡¨å•ç­–ç•¥ï¼Œå¯¹åº”çš„rasaé¢„ç½®äº†ä¸€ç§ç±»å‹çš„actionï¼Œå«formçš„actionã€‚è¿™ç§actionä¼šå°†æ‰€æœ‰æ§½ä½ä½œä¸ºè¡¨å•çš„å±æ€§columnï¼Œæ¯ä¸€è½®å¯¹è¯ï¼Œéƒ½ä¼šå»ä¸»åŠ¨è¯¢é—®ç”¨æˆ·ï¼Œå¼•å¯¼ç”¨æˆ·å°†è¿™äº›è¡¨å•çš„å±æ€§å¡«å……ï¼Œç›´åˆ°æ‰€æœ‰å±æ€§å¡«å……å®Œæˆã€‚è€Œform_policyçš„æ ¸å¿ƒå°±æ˜¯æ£€ç´¢å½“å‰æ˜¯å¦é…ç½®äº†formç±»å‹çš„actionï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†ä¸‹ä¸€æ­¥çš„actionç½®ä¸ºformã€‚æœ‰å…³actionçš„æè¿°å°†åœ¨åé¢è¯¦ç»†ç»™å‡ºã€‚å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„äººå·¥è§„åˆ™ç­–ç•¥ã€‚</p><p>åœ¨ä¸€æ¬¡å¯¹è¯ä»»åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªpolicyçš„ç»„åˆæ¥å¸®åŠ©botå®Œæˆæ—¢å®šçš„ä»»åŠ¡ã€‚æ¯”å¦‚ç­–ç•¥Aæ˜¯ä¸€ä¸ªä½¿ç”¨æ·±åº¦å­¦ä¹ è®­ç»ƒå¾—åˆ°çš„ä¸€ä¸ªç­–ç•¥æ¨¡å‹ï¼Œä½†æ˜¯ä¸€èˆ¬ä½¿ç”¨data-drivenå¾—åˆ°çš„æ¨¡å‹ä¸ä¼šè¾¾åˆ°100%çš„å‡†ç¡®ç‡ï¼Œæ€»ä¼šæœ‰bad caseçš„æƒ…å†µï¼Œæ­¤æ—¶å¦‚æœåªæ˜¯ç”¨è¯¥ç­–ç•¥ï¼Œé‚£ä¹ˆä¼šè¯ææœ‰å¯èƒ½ä¼šé™·å…¥åˆ°bad caseä¸­ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªå…œåº•çš„ç­–ç•¥åœ¨ç­–ç•¥Açš„bad caseå‘ç”Ÿæ—¶ï¼Œè®©å¯¹è¯èƒ½å¤Ÿå¹³ç¨³è¿›è¡Œä¸‹å»ã€‚rasaå°±é¢„ç½®äº†è¿™æ ·ä¸€ä¸ªç­–ç•¥ï¼Œå«fall_backï¼Œå°†fall_backä¸ç­–ç•¥Aè¿›è¡Œç»„åˆï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ›´åŠ é²æ£’çš„ä¸€ä¸ªå¯¹è¯ç­–ç•¥ã€‚</p><p>åœ¨å®é™…é¡¹ç›®ç”Ÿäº§ä¸­ï¼Œå¦‚æœåœ¨é¡¹ç›®åˆæœŸï¼Œé¢†åŸŸæ•°æ®æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šé€‰æ‹©form policyæˆ–è€…å…¶ä»–è§„åˆ™å‹ç­–ç•¥ã€‚å½“äº§å“ä¸Šçº¿ï¼Œåœ¨ç§¯ç´¯åˆ°ä¸€å®šçš„æ•°æ®åï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›data-drivençš„æ¨¡å‹æ¥åšç­–ç•¥ã€‚</p><h3 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h3><p>è¿™ä¸ªå¯¹è±¡çš„æ•°æ®æ¥è‡ªäºå‰è¿°ç« èŠ‚æåˆ°çš„é…ç½®æ–‡ä»¶domain.ymlã€‚è¯¥å¯¹è±¡å®šä¹‰ä¸åŒçš„æ–¹æ³•ï¼Œä»é…ç½®æ–‡ä»¶domain.ymlè¯»å–æ§½ä½æ¨¡æ¿ï¼Œè¯æœ¯æ¨¡æ¿ï¼Œå®šä¹‰çš„actionåç§°,è‡ªå®šä¹‰çš„policyåç§°ç­‰ä¿¡æ¯ï¼Œå¹¶å°è£…åˆ°domainå¯¹è±¡ä¸­ã€‚domainå¯¹è±¡å¯ä»¥åœ¨actionæ‰§è¡Œæ—¶ä¸ºå…¶æä¾›æ§½ä½ä¿¡æ¯ä»¥åŠè¯æœ¯æ¨¡æ¿ç­‰å­—æ®µã€‚</p><p>è®¾è®¡domainçš„å¥½å¤„åœ¨å“ªå„¿å‘¢ï¼Ÿ</p><p>ä¸ªäººè®¤ä¸ºä¸»è¦æ˜¯æ–¹ä¾¿ç®¡ç†å¯¹è¯ç³»ç»Ÿéœ€è¦ä½¿ç”¨çš„æ¨¡æ¿ä¿¡æ¯ã€‚è¿™é‡Œçš„æ¨¡æ¿ä¿¡æ¯åŒ…å«å®šä¹‰çš„æ§½ä½ï¼Œæ„å›¾ã€å®ä½“ã€è¯æœ¯æ¨¡æ¿ã€è‡ªå®šä¹‰actionã€è‡ªå®šä¹‰policyã€‚å¦‚æœéœ€è¦æ·»åŠ æˆ–è€…ä¿®æ”¹è¿™äº›ä¿¡æ¯ï¼Œåªéœ€è¦ä¿®æ”¹domain.ymlé‡Œé¢çš„ä¿¡æ¯å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å»ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œè®©é…ç½®å’Œä»£ç è§£è€¦ã€‚</p><p>åˆ—ä¸¾ä¸€ä¸ªæœ¬äººåœ¨åšé¡¹ç›®æ—¶çš„ä¸€ä¸ªdomainä½¿ç”¨å®ä¾‹ã€‚åšå¯¹è¯ç³»ç»Ÿçš„å¯¹è¯è®°å½•ä¿å­˜æ—¶ï¼Œéœ€è¦ä¿å­˜æ¯ä¸€è½®å¯¹è¯ä¸­chatbotå‘é€ç»™ç”¨æˆ·çš„ä¿¡æ¯ã€‚ä½†æ˜¯å› ä¸ºå¾ˆå¤šbot messageéƒ½æ˜¯è¯»å–çš„domain.ymlä¸­çš„è¯æœ¯æ¨¡æ¿å†é…ç½®å‚æ•°åŠ¨æ€ç”Ÿæˆçš„ã€‚å› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨Domainçš„loadæ–¹æ³•è¯»å–ymlä¸­çš„é”®å€¼å¯¹ï¼Œç”Ÿæˆä¸€ä¸ªå­—å…¸ã€‚ç„¶åå¯ä»¥ä»å­—å…¸ä¸­è¯»å–ç›¸åº”çš„è¯æœ¯æ¨¡æ¿å¾—åˆ°bot messageã€‚</p><h3 id="CollectionDispatcher"><a href="#CollectionDispatcher" class="headerlink" title="CollectionDispatcher"></a>CollectionDispatcher</h3><p>è¿™ä¸ªå¯¹è±¡çš„ä¸»è¦ä½œç”¨æ˜¯è®¾è®¡äº†å„ç§é­”æ³•å‡½æ•°ï¼Œå¤„ç†ä¸åŒç±»å‹çš„botè¾“å‡ºï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°OutputChannelä¸­ã€‚çœ‹ä¸€ä¸‹å®ƒçš„æˆå‘˜æ–¹æ³•å°±èƒ½çŸ¥é“å®ƒçš„ä½œç”¨ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">CollectingDispatcher</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Send messages back to user"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">utter_message</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        text<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        image<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        json_message<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        template<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        attachment<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        buttons<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        elements<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>     <span class="token comment" spellcheck="true"># noinspection PyUnusedLocal</span>    <span class="token keyword">def</span> <span class="token function">utter_template</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> template<span class="token punctuation">:</span> Text<span class="token punctuation">,</span> tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span> silent_fail<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">""""Send a message to the client based on a template."""</span>        warnings<span class="token punctuation">.</span>warn<span class="token punctuation">(</span>            <span class="token string">"Use of `utter_template` is deprecated. "</span>            <span class="token string">"Use `utter_message(template=&lt;template_name>)` instead."</span><span class="token punctuation">,</span>            FutureWarning<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span>template<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code></pre><p>æ ¹æ®æ–¹æ³•åå°±èƒ½çŸ¥é“ä¸åŒæ–¹æ³•çš„ä½œç”¨ï¼Œä¾‹å¦‚utter_messageï¼Œæ¥å—textå­—ç¬¦ä¸²å‚æ•°ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºæˆ‘ä»¬å®šä¹‰çš„æ–‡æœ¬ã€‚utter_templateåˆ™æ˜¯ä»domainä¸­çš„è¯æœ¯æ¨¡æ¿è¯»å–ç›¸åº”çš„templateï¼Œ**kwargsè¡¨ç¤ºå¦‚æœè¯æœ¯æ¨¡æ¿ä¸­é¢„ç•™äº†å‚æ•°æ§½ä½ï¼Œåˆ™ä½¿ç”¨è¯¥å‚æ•°è¿›è¡Œå¡«å……ï¼Œç”Ÿæˆæœ€ç»ˆçš„bot messageã€‚</p><h2 id="Processor"><a href="#Processor" class="headerlink" title="Processor"></a>Processor</h2><p>è¿™ä¸ªå¯¹è±¡æ˜¯å¯¹è¯ç³»ç»Ÿçš„æ ¸å¿ƒå¤„ç†æ¨¡å—ã€‚å®ƒé€šè¿‡execute_actionå®Œæˆbotå¤„ç†å¯¹è¯çš„æµç¨‹ã€‚</p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨processoræ‰§è¡Œactionä¹‹å‰ï¼Œagentå°†ä¼šè°ƒç”¨processorçš„log_messageæ–¹æ³•ï¼Œä½¿ç”¨nlu_interpreteræ¥å¯¹ç”¨æˆ·å‘é€çš„æ–‡æœ¬åšå®ä½“è¯†åˆ«å’Œæ„å›¾è¯†åˆ«ï¼Œç„¶åå°†ä¿¡æ¯ä¿å­˜åœ¨trackerä¸­ï¼Œè¿™ä¸ªé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œnluæ¨¡å—ä¹Ÿåœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­è¯¦ç»†è§£æè¿‡äº†ï¼Œå› æ­¤è¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚</p></blockquote><pre class=" language-python"><code class="language-python"> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">execute_action</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        sender_id<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        action_name<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        output_channel<span class="token punctuation">:</span> OutputChannel<span class="token punctuation">,</span>        nlg<span class="token punctuation">:</span> NaturalLanguageGenerator<span class="token punctuation">,</span>        policy<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        confidence<span class="token punctuation">:</span> float<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span>DialogueStateTracker<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># we have a Tracker instance for each user</span>        <span class="token comment" spellcheck="true"># which maintains conversation state</span>        tracker <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>get_tracker_with_session_start<span class="token punctuation">(</span>sender_id<span class="token punctuation">,</span> output_channel<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#---------->è·å–å†å²çŠ¶æ€ä¿¡æ¯</span>        <span class="token keyword">if</span> tracker<span class="token punctuation">:</span>            action <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_action<span class="token punctuation">(</span>action_name<span class="token punctuation">)</span>            <span class="token keyword">await</span> self<span class="token punctuation">.</span>_run_action<span class="token punctuation">(</span><span class="token comment" spellcheck="true">#------------------->æ‰§è¡Œaction</span>                action<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> output_channel<span class="token punctuation">,</span> nlg<span class="token punctuation">,</span> policy<span class="token punctuation">,</span> confidence            <span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># save tracker state to continue conversation from this state</span>            self<span class="token punctuation">.</span>_save_tracker<span class="token punctuation">(</span>tracker<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#------------->æ›´æ–°å¯¹è¯çŠ¶æ€</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>                f<span class="token string">"Failed to retrieve or create tracker for conversation ID "</span>                f<span class="token string">"'&amp;#123;sender_id&amp;#125;'."</span>            <span class="token punctuation">)</span>        <span class="token keyword">return</span> tracker</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ¨¡å—æ¶‰åŠçš„æ ¸å¿ƒå¯¹è±¡æœ‰ä¸¤ä¸ªï¼Œactionå’Œtrackerï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–å¯¹è±¡å¦‚OutputChannel,policyç­‰ï¼‰ã€‚ä¸‹é¢åˆ†åˆ«è§£æè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚</p><h3 id="DialogueStateTracker"><a href="#DialogueStateTracker" class="headerlink" title="DialogueStateTracker"></a>DialogueStateTracker</h3><p>ä»åå­—ä¸Šå°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼šåœ¨å¤šè½®å¯¹è¯è¿‡ç¨‹ä¸­å…¨ç¨‹è®°å½•å¯¹è¯çŠ¶æ€ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è±¡åœ¨å¼€å‘è‡ªå·±çš„å¯¹è¯ç³»ç»Ÿæ—¶ï¼Œä½œç”¨å¯æ˜¯éå¸¸å¤§çš„ã€‚å¾ˆå¤šå¯¹è¯çŠ¶æ€ä¿¡æ¯ï¼Œéƒ½å¯ä»¥ä»å®ƒè¿™é‡Œå¾—åˆ°ã€‚å½“ç„¶ï¼Œ æˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥å»è¯»å†™å…¶å®šä¹‰çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œéœ€è¦é€šè¿‡å…¶æˆå‘˜æ–¹æ³•æ¥æ“ä½œæˆå‘˜å˜é‡ï¼Œä¾‹å¦‚current_sate()ï¼Œå…¶æ ¸å¿ƒå†…å®¹å¦‚ä¸‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DialogueStateTracker</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        sender_id<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        slots<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Iterable<span class="token punctuation">[</span>Slot<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        max_event_history<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        sender_source<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># maximum number of events to store</span>        self<span class="token punctuation">.</span>_max_event_history <span class="token operator">=</span> max_event_history        <span class="token comment" spellcheck="true"># list of previously seen events</span>        self<span class="token punctuation">.</span>events <span class="token operator">=</span> self<span class="token punctuation">.</span>_create_events<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># id of the source of the messages</span>        self<span class="token punctuation">.</span>sender_id <span class="token operator">=</span> sender_id        <span class="token comment" spellcheck="true"># slots that can be filled in this domain</span>        <span class="token keyword">if</span> slots <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>slots <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;slot.name: copy.copy(slot) for slot in slots&amp;#125;</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>slots <span class="token operator">=</span> AnySlotDict<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># file source of the messages</span>        self<span class="token punctuation">.</span>sender_source <span class="token operator">=</span> sender_source        <span class="token comment" spellcheck="true"># if tracker is paused, no actions should be taken</span>        self<span class="token punctuation">.</span>_paused <span class="token operator">=</span> <span class="token boolean">False</span>        <span class="token comment" spellcheck="true"># A deterministically scheduled action to be executed next</span>        self<span class="token punctuation">.</span>followup_action <span class="token operator">=</span> ACTION_LISTEN_NAME        self<span class="token punctuation">.</span>latest_action_name <span class="token operator">=</span> None        <span class="token comment" spellcheck="true"># Stores the most recent message sent by the user</span>        self<span class="token punctuation">.</span>latest_message <span class="token operator">=</span> None        self<span class="token punctuation">.</span>latest_bot_utterance <span class="token operator">=</span> None        self<span class="token punctuation">.</span>_reset<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>active_form <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    <span class="token comment" spellcheck="true">###</span>    <span class="token comment" spellcheck="true"># Public tracker interface</span>    <span class="token comment" spellcheck="true">###</span>    <span class="token keyword">def</span> <span class="token function">current_state</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> event_verbosity<span class="token punctuation">:</span> EventVerbosity <span class="token operator">=</span> EventVerbosity<span class="token punctuation">.</span>NONE    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Return the current tracker state as an object."""</span>        <span class="token keyword">if</span> event_verbosity <span class="token operator">==</span> EventVerbosity<span class="token punctuation">.</span>ALL<span class="token punctuation">:</span>            evts <span class="token operator">=</span> <span class="token punctuation">[</span>e<span class="token punctuation">.</span>as_dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>events<span class="token punctuation">]</span>        <span class="token keyword">elif</span> event_verbosity <span class="token operator">==</span> EventVerbosity<span class="token punctuation">.</span>AFTER_RESTART<span class="token punctuation">:</span>            evts <span class="token operator">=</span> <span class="token punctuation">[</span>e<span class="token punctuation">.</span>as_dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>events_after_latest_restart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">elif</span> event_verbosity <span class="token operator">==</span> EventVerbosity<span class="token punctuation">.</span>APPLIED<span class="token punctuation">:</span>            evts <span class="token operator">=</span> <span class="token punctuation">[</span>e<span class="token punctuation">.</span>as_dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>applied_events<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            evts <span class="token operator">=</span> None        latest_event_time <span class="token operator">=</span> None        <span class="token keyword">if</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            latest_event_time <span class="token operator">=</span> self<span class="token punctuation">.</span>events<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>timestamp        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>            <span class="token string">"sender_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>sender_id<span class="token punctuation">,</span>            <span class="token string">"slots"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>current_slot_values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"latest_message"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>latest_message<span class="token punctuation">.</span>parse_data<span class="token punctuation">,</span>            <span class="token string">"latest_event_time"</span><span class="token punctuation">:</span> latest_event_time<span class="token punctuation">,</span>            <span class="token string">"followup_action"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>followup_action<span class="token punctuation">,</span>            <span class="token string">"paused"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>is_paused<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"events"</span><span class="token punctuation">:</span> evts<span class="token punctuation">,</span>            <span class="token string">"latest_input_channel"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>get_latest_input_channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"active_form"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>active_form<span class="token punctuation">,</span>            <span class="token string">"latest_action_name"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>latest_action_name<span class="token punctuation">,</span>        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p>æ³¨æ„è¯¥æ–¹æ³•çš„è¿”å›å¯¹è±¡æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶åŒ…å«äº†ä¸°å¯Œçš„å¯¹è¯ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„idã€å½“å‰æ‰€æœ‰çš„æ§½ä½é”®å€¼å¯¹ï¼ˆåŒ…æ‹¬å·²å¡«å……å’Œæœªè¢«å¡«å……çš„ï¼‰ã€ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡å‘é€çš„æ¶ˆæ¯ç­‰ç­‰ã€‚</p><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>ä¸‹é¢å°†è§£æå¯¹è¯ç®¡ç†ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µâ€”â€”Actionã€‚å‰é¢å·²ç»è¯´åˆ°ï¼Œeventå¯¹è±¡æ˜¯rasaä¸­å®šä¹‰çš„chatbotèƒ½æ‰§è¡Œçš„æœ€å°ç²’åº¦çš„åŠ¨ä½œã€‚è€ŒActionåˆ™æ˜¯æ¯”eventæ›´é«˜å±‚æ¬¡çš„å¯¹è±¡ï¼Œä¼šæ ¹æ®ç”¨æˆ·å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œï¼Œè¿™äº›æ“ä½œå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ä¸€äº›é€»è¾‘ï¼Œä¹Ÿå¯ä»¥æ˜¯ç³»ç»Ÿé¢„ç½®çš„eventsã€‚rasaä¸­ï¼Œactionå¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><p><strong>utterance actions</strong>ï¼šç›´æ¥å‘é€æ–‡æœ¬ç»™ç”¨æˆ·ï¼Œactionæ–‡æœ¬æ¨¡æ¿æ˜¯åœ¨domain.ymlä¸­è¿›è¡Œå®šä¹‰ã€‚</p><p><strong>custom actions</strong>: è‡ªå®šä¹‰actionï¼Œç”±å¼€å‘è€…è‡ªå®šä¹‰åŠŸèƒ½çš„actionã€‚ä¸ªäººè®¤ä¸ºè¿™ä¸ªæ˜¯åŠŸèƒ½æœ€å¼ºå¤§çš„actionï¼Œå› ä¸ºå¼€å‘è‡ªç”±åº¦å¾ˆå¤§ï¼Œæ”¯æŒä½¿ç”¨ä»»ä½•å¼€å‘è¯­è¨€è¿›è¡Œå¼€å‘ã€‚æœ€ååªéœ€è¦å°†å…¶æ‰“åŒ…æˆä¸€ä¸ªrestfulæœåŠ¡æ¥å£æš´éœ²å‡ºæ¥å³å¯ã€‚å› æ­¤è¿™ç§actionæ˜¯å¯ä»¥å’Œå¯¹è¯ä¸»ç³»ç»Ÿåˆ†ç¦»éƒ¨ç½²çš„ã€‚ä¸‹é¢ç»™å‡ºè‡ªå®šä¹‰action serverä¸bot agentå’Œç”¨æˆ·çš„äº¤äº’æµç¨‹å›¾ï¼š</p><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/9.png"></p><p>rasa actionæ”¯æŒnode.js, .NET, javaç­‰å¼€å‘è¯­è¨€ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒPythonã€‚ä½†æ˜¯å¯¹äºPythonæ¥è¯´ï¼Œéœ€è¦å®‰è£…rasa-sdkå·¥å…·åŒ…ã€‚è¿™ä¸ªå·¥å…·åŒ…é‡Œé¢„ç½®äº†ä¸€äº›æœ‰ç”¨çš„actionæ¨¡æ¿ã€‚ä¾‹å¦‚form actionã€‚</p><p>å½“ç„¶ï¼Œform actionä»¥åŠå…¶ä»–é¢„ç½®çš„actionæ¨¡æ¿åªèƒ½å®ç°æœ€ç®€å•çš„åœºæ™¯ï¼Œå¦‚æœè¦å®ç°å¤æ‚çš„åœºæ™¯ï¼Œéœ€è¦æ ¹æ®ä¸åŒåœºæ™¯ï¼Œè‡ªå®šä¹‰actionï¼Œå¯ä»¥é€‰æ‹©ç»§æ‰¿è¿™äº›æ¨¡æ¿ï¼Œåœ¨ä¸Šé¢è¿›è¡ŒåŠŸèƒ½çš„æ·»åŠ å’Œå®Œå–„ã€‚</p><p><strong>default action</strong>: rasaç³»ç»Ÿå†…ç½®çš„ç²’åº¦è¾ƒå°çš„actionã€‚ä¸rasa_sdkä¸­çš„actionä¸åŒï¼Œè¿™ä¸ªæ˜¯ç›´æ¥åœ¨core/actionsä¸‹é¢çš„ã€‚ç›¸å¯¹äºä¸Šé¢çš„form actionæ¥è¯´ï¼Œè¿™é‡Œçš„actionåŠŸèƒ½æ›´å•ä¸€ï¼Œä¸eventsæ¯”è¾ƒåƒï¼Œä½†æ˜¯è¿˜æ˜¯ç•¥æœ‰ä¸åŒï¼Œä¸‹é¢ä¸¾ä¸ªå®ä¾‹ActionRestart</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionRestart</span><span class="token punctuation">(</span>ActionUtterTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Resets the tracker to its initial state.    Utters the restart template if available."""</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token keyword">return</span> ACTION_RESTART_NAME    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token string">"utter_restart"</span><span class="token punctuation">,</span> silent_fail<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        output_channel<span class="token punctuation">:</span> <span class="token string">"OutputChannel"</span><span class="token punctuation">,</span>        nlg<span class="token punctuation">:</span> <span class="token string">"NaturalLanguageGenerator"</span><span class="token punctuation">,</span>        tracker<span class="token punctuation">:</span> <span class="token string">"DialogueStateTracker"</span><span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> <span class="token string">"Domain"</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Event<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>events <span class="token keyword">import</span> Restarted        <span class="token comment" spellcheck="true"># only utter the template if it is available</span>        evts <span class="token operator">=</span> <span class="token keyword">await</span> super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span>output_channel<span class="token punctuation">,</span> nlg<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#*****</span>        <span class="token keyword">return</span> evts <span class="token operator">+</span> <span class="token punctuation">[</span>Restarted<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>å¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨äº†ä¸€ä¸ªRestarted()çš„eventï¼Œè¿™ä¸ªeventçš„åŠŸèƒ½æ˜¯é‡å¯æ•´ä¸ªå¯¹è¯æµç¨‹ï¼Œé‡ç½®å¯¹è¯çŠ¶æ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥actionéœ€è¦å…ˆæ‰§è¡Œè¯»å–è¯æœ¯æ¨¡æ¿ç»„è£…bot messageï¼Œå¹¶å°†å…¶å‘é€ç»™ç”¨æˆ·åï¼Œæ‰å»é‡å¯æ•´ä¸ªä¼šè¯ã€‚</p><p>æ‰€æœ‰default actionçš„åˆ—è¡¨å¦‚ä¸‹ï¼Œå®ƒä»¬çš„å‘½åéƒ½éå¸¸ç®€å•ç›´æ¥ï¼š</p><p><img src="/2020/09/20/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-1/10.png"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
            <tag> QA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èšç±»ç®—æ³•åŸç†</title>
      <link href="/2020/09/19/ju-lei-suan-fa-yuan-li/"/>
      <url>/2020/09/19/ju-lei-suan-fa-yuan-li/</url>
      
        <content type="html"><![CDATA[<h1 id="èšç±»ç®—æ³•åŸç†"><a href="#èšç±»ç®—æ³•åŸç†" class="headerlink" title="èšç±»ç®—æ³•åŸç†"></a>èšç±»ç®—æ³•åŸç†</h1><h2 id="æ— ç›‘ç£å­¦ä¹ ä¸èšç±»ç®—æ³•"><a href="#æ— ç›‘ç£å­¦ä¹ ä¸èšç±»ç®—æ³•" class="headerlink" title="æ— ç›‘ç£å­¦ä¹ ä¸èšç±»ç®—æ³•"></a>æ— ç›‘ç£å­¦ä¹ ä¸èšç±»ç®—æ³•</h2><p>èšç±»ç®—æ³•åˆå«åšâ€œæ— ç›‘ç£åˆ†ç±»â€ï¼Œå…¶ç›®çš„æ˜¯å°†æ•°æ®åˆ’åˆ†æˆæœ‰æ„ä¹‰æˆ–æœ‰ç”¨çš„ç»„ï¼ˆæˆ–ç°‡ï¼‰ã€‚è¿™ç§åˆ’åˆ†å¯ä»¥åŸºäºæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚æˆ–å»ºæ¨¡éœ€æ±‚æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥å•çº¯åœ°å¸®åŠ©æˆ‘ä»¬æ¢ç´¢æ•°æ®çš„è‡ªç„¶ç»“æ„å’Œåˆ†å¸ƒã€‚æ¯”å¦‚åœ¨å•†ä¸šä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ‰‹å¤´æœ‰å¤§é‡çš„å½“å‰å’Œæ½œåœ¨å®¢æˆ·çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨èšç±»å°†å®¢æˆ·åˆ’åˆ†ä¸ºè‹¥å¹²ç»„ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥åˆ†æå’Œå¼€å±•è¥é”€æ´»åŠ¨ï¼Œæœ€æœ‰åçš„å®¢æˆ·ä»·å€¼åˆ¤æ–­æ¨¡å‹RFMï¼Œå°±å¸¸å¸¸å’Œèšç±»åˆ†æå…±åŒä½¿ç”¨ã€‚å†æ¯”å¦‚ï¼Œèšç±»å¯ä»¥ç”¨äºé™ç»´å’ŒçŸ¢é‡é‡åŒ–ï¼ˆvectorquantizationï¼‰ï¼Œå¯ä»¥å°†é«˜ç»´ç‰¹å¾å‹ç¼©åˆ°ä¸€åˆ—å½“ä¸­ï¼Œå¸¸å¸¸ç”¨äºå›¾åƒï¼Œå£°éŸ³ï¼Œè§†é¢‘ç­‰éç»“æ„åŒ–æ•°æ®ï¼Œå¯ä»¥å¹…åº¦å‹ç¼©æ•°æ®é‡ã€‚</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/2.png"></p><h2 id="sklearnä¸­çš„èšç±»ç®—æ³•"><a href="#sklearnä¸­çš„èšç±»ç®—æ³•" class="headerlink" title="sklearnä¸­çš„èšç±»ç®—æ³•"></a>sklearnä¸­çš„èšç±»ç®—æ³•</h2><p>èšç±»ç®—æ³•åœ¨sklearnä¸­æœ‰ä¸¤ç§è¡¨ç°å½¢å¼,ä¸€ç§æ˜¯ç±»(å’Œæˆ‘ä»¬ç›®å‰ä¸ºæ­¢å­¦è¿‡çš„åˆ†ç±»ç®—æ³•ä»¥åŠæ•°æ®é¢„å¤„ç†æ–¹æ³•ä»¬éƒ½ä¸€<br>æ ·),éœ€è¦å®ä¾‹åŒ–,è®­ç»ƒå¹¶ä½¿ç”¨æ¥å£å’Œå±æ€§æ¥è°ƒç”¨ç»“æœã€‚å¦ä¸€ç§æ˜¯å‡½æ•°(function),åªéœ€è¦è¾“å…¥ç‰¹å¾çŸ©é˜µå’Œè¶…å‚<br>æ•°,å³å¯è¿”å›èšç±»çš„ç»“æœå’Œå„ç§æŒ‡æ ‡ã€‚</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/1.png"></p><h3 id="KMeansæ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#KMeansæ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="KMeansæ˜¯å¦‚ä½•å·¥ä½œçš„"></a>KMeansæ˜¯å¦‚ä½•å·¥ä½œçš„</h3><p>ä½œä¸ºèšç±»ç®—æ³•çš„å…¸å‹ä»£è¡¨,KMeanså¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„èšç±»ç®—æ³•æ²¡æœ‰ä¹‹ä¸€,é‚£å®ƒæ˜¯æ€ä¹ˆå®Œæˆèšç±»çš„å‘¢?</p><p>å…³é”®æ¦‚å¿µ:ç°‡ä¸è´¨å¿ƒ</p><blockquote><p>KMeansç®—æ³•å°†ä¸€ç»„Nä¸ªæ ·æœ¬çš„ç‰¹å¾çŸ©é˜µXåˆ’åˆ†ä¸ºKä¸ªæ— äº¤é›†çš„ç°‡,ç›´è§‚ä¸Šæ¥çœ‹æ˜¯ç°‡æ˜¯ä¸€ç»„ä¸€ç»„èšé›†åœ¨ä¸€èµ·çš„æ•°<br>æ®,åœ¨ä¸€ä¸ªç°‡ä¸­çš„æ•°æ®å°±è®¤ä¸ºæ˜¯åŒä¸€ç±»ã€‚ç°‡å°±æ˜¯èšç±»çš„ç»“æœè¡¨ç°ã€‚<br>ç°‡ä¸­æ‰€æœ‰æ•°æ®çš„å‡å€¼<br> é€šå¸¸è¢«ç§°ä¸ºè¿™ä¸ªç°‡çš„â€œè´¨å¿ƒâ€(centroids)ã€‚åœ¨ä¸€ä¸ªäºŒç»´å¹³é¢ä¸­,ä¸€ç°‡æ•°æ®ç‚¹çš„è´¨å¿ƒçš„<br>æ¨ªåæ ‡å°±æ˜¯è¿™ä¸€ç°‡æ•°æ®ç‚¹çš„æ¨ªåæ ‡çš„å‡å€¼,è´¨å¿ƒçš„çºµåæ ‡å°±æ˜¯è¿™ä¸€ç°‡æ•°æ®ç‚¹çš„çºµåæ ‡çš„å‡å€¼ã€‚åŒç†å¯æ¨å¹¿è‡³é«˜<br>ç»´ç©ºé—´ã€‚</p></blockquote><p>åœ¨KMeansç®—æ³•ä¸­,ç°‡çš„ä¸ªæ•°Kæ˜¯ä¸€ä¸ªè¶…å‚æ•°,éœ€è¦æˆ‘ä»¬äººä¸ºè¾“å…¥æ¥ç¡®å®šã€‚KMeansçš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯æ ¹æ®æˆ‘ä»¬è®¾å®šå¥½<br>çš„K,æ‰¾å‡ºKä¸ªæœ€ä¼˜çš„è´¨å¿ƒ,å¹¶å°†ç¦»è¿™äº›è´¨å¿ƒæœ€è¿‘çš„æ•°æ®åˆ†åˆ«åˆ†é…åˆ°è¿™äº›è´¨å¿ƒä»£è¡¨çš„ç°‡ä¸­å»ã€‚å…·ä½“è¿‡ç¨‹å¯ä»¥æ€»ç»“å¦‚<br>ä¸‹:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/3.png"></p><p>è¾“å…¥æ•°æ®</p><p>éœ€è¦æ³¨æ„çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯,è¯¥æ¨¡å—ä¸­å®ç°çš„ç®—æ³•å¯ä»¥é‡‡ç”¨ä¸åŒç±»å‹çš„çŸ©é˜µä½œä¸ºè¾“å…¥ã€‚ æ‰€æœ‰æ–¹æ³•éƒ½æ¥å—å½¢çŠ¶<br>[n_samples,n_features]çš„æ ‡å‡†ç‰¹å¾çŸ©é˜µ,è¿™äº›å¯ä»¥ä»sklearn.feature_extractionæ¨¡å—ä¸­çš„ç±»ä¸­è·å¾—ã€‚å¯¹äºäº²å’Œ<br>åŠ›ä¼ æ’­,å…‰è°±èšç±»å’ŒDBSCAN,è¿˜å¯ä»¥è¾“å…¥å½¢çŠ¶[n_samples,n_samples]çš„ç›¸ä¼¼æ€§çŸ©é˜µ,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<br>sklearn.metrics.pairwiseæ¨¡å—ä¸­çš„å‡½æ•°æ¥è·å–ç›¸ä¼¼æ€§çŸ©é˜µã€‚</p><h2 id="ç°‡å†…è¯¯å·®å¹³æ–¹å’Œçš„å®šä¹‰å’Œè§£æƒ‘"><a href="#ç°‡å†…è¯¯å·®å¹³æ–¹å’Œçš„å®šä¹‰å’Œè§£æƒ‘" class="headerlink" title="ç°‡å†…è¯¯å·®å¹³æ–¹å’Œçš„å®šä¹‰å’Œè§£æƒ‘"></a>ç°‡å†…è¯¯å·®å¹³æ–¹å’Œçš„å®šä¹‰å’Œè§£æƒ‘</h2><p>èšç±»ç®—æ³•èšå‡ºçš„ç±»æœ‰ä»€ä¹ˆå«ä¹‰å‘¢?è¿™äº›ç±»æœ‰ä»€ä¹ˆæ ·çš„æ€§è´¨?æˆ‘ä»¬è®¤ä¸º,è¢«åˆ†åœ¨åŒä¸€ä¸ªç°‡ä¸­çš„æ•°æ®æ˜¯æœ‰ç›¸ä¼¼æ€§çš„,è€Œ<br>ä¸åŒç°‡ä¸­çš„æ•°æ®æ˜¯ä¸åŒçš„,å½“èšç±»å®Œæ¯•ä¹‹å,æˆ‘ä»¬å°±è¦åˆ†åˆ«å»ç ”ç©¶æ¯ä¸ªç°‡ä¸­çš„æ ·æœ¬éƒ½æœ‰ä»€ä¹ˆæ ·çš„æ€§è´¨,ä»è€Œæ ¹æ®ä¸š<br>åŠ¡éœ€æ±‚åˆ¶å®šä¸åŒçš„å•†ä¸šæˆ–è€…ç§‘æŠ€ç­–ç•¥ã€‚è¿™ä¸ªå¬ä¸Šå»å’Œæˆ‘ä»¬åœ¨ä¸Šå‘¨çš„è¯„åˆ†å¡æ¡ˆä¾‹ä¸­è®²è§£çš„â€œåˆ†ç®±â€æ¦‚å¿µæœ‰äº›ç±»ä¼¼,å³æˆ‘<br>ä»¬åˆ†ç®±çš„ç›®çš„æ˜¯å¸Œæœ›,ä¸€ä¸ªç®±å†…çš„äººæœ‰ç€ç›¸ä¼¼çš„ä¿¡ç”¨é£é™©,è€Œä¸åŒç®±çš„äººçš„ä¿¡ç”¨é£é™©å·®å¼‚å·¨å¤§,ä»¥æ­¤æ¥åŒºåˆ«ä¸åŒä¿¡<br>ç”¨åº¦çš„äºº,å› æ­¤æˆ‘ä»¬è¿½æ±‚â€œç»„å†…å·®å¼‚å°,ç»„é—´å·®å¼‚å¤§â€ã€‚èšç±»ç®—æ³•ä¹Ÿæ˜¯åŒæ ·çš„ç›®çš„,æˆ‘ä»¬è¿½æ±‚â€œç°‡å†…å·®å¼‚å°,ç°‡å¤–å·®å¼‚<br>å¤§â€ã€‚è€Œè¿™ä¸ªâ€œå·®å¼‚â€œ,ç”±æ ·æœ¬ç‚¹åˆ°å…¶æ‰€åœ¨ç°‡çš„è´¨å¿ƒçš„è·ç¦»æ¥è¡¡é‡ã€‚<br>å¯¹äºä¸€ä¸ªç°‡æ¥è¯´,æ‰€æœ‰æ ·æœ¬ç‚¹åˆ°è´¨å¿ƒçš„è·ç¦»ä¹‹å’Œè¶Šå°,æˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªç°‡ä¸­çš„æ ·æœ¬è¶Šç›¸ä¼¼,ç°‡å†…å·®å¼‚å°±è¶Šå°ã€‚è€Œè·<br>ç¦»çš„è¡¡é‡æ–¹æ³•æœ‰å¤šç§,ä»¤ è¡¨ç¤ºç°‡ä¸­çš„ä¸€ä¸ªæ ·æœ¬ç‚¹, è¡¨ç¤ºè¯¥ç°‡ä¸­çš„è´¨å¿ƒ,nè¡¨ç¤ºæ¯ä¸ªæ ·æœ¬ç‚¹ä¸­çš„ç‰¹å¾æ•°ç›®,iè¡¨ç¤ºç»„<br>æˆç‚¹ çš„æ¯ä¸ªç‰¹å¾,åˆ™è¯¥æ ·æœ¬ç‚¹åˆ°è´¨å¿ƒçš„è·ç¦»å¯ä»¥ç”±ä»¥ä¸‹è·ç¦»æ¥åº¦é‡:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/4.png"></p><p>å¦‚æˆ‘ä»¬é‡‡ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»,åˆ™ä¸€ä¸ªç°‡ä¸­æ‰€æœ‰æ ·æœ¬ç‚¹åˆ°è´¨å¿ƒçš„è·ç¦»çš„å¹³æ–¹å’Œä¸º:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/5.png"></p><p>å¤§å®¶å¯ä»¥å‘ç°,æˆ‘ä»¬çš„Inertiaæ˜¯åŸºäºæ¬§å‡ é‡Œå¾—è·ç¦»çš„è®¡ç®—å…¬å¼å¾—æ¥çš„ã€‚å®é™…ä¸Š,æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è·ç¦»,æ¯ä¸ªè·<br>ç¦»éƒ½æœ‰è‡ªå·±å¯¹åº”çš„Inertiaã€‚åœ¨è¿‡å»çš„ç»éªŒä¸­,æˆ‘ä»¬æ€»ç»“å‡ºä¸åŒè·ç¦»æ‰€å¯¹åº”çš„è´¨å¿ƒé€‰æ‹©æ–¹æ³•å’ŒInertia,åœ¨Kmeans<br>ä¸­,åªè¦ä½¿ç”¨äº†æ­£ç¡®çš„è´¨å¿ƒå’Œè·ç¦»ç»„åˆ,æ— è®ºä½¿ç”¨ä»€ä¹ˆæ ·çš„è·ç¦»,éƒ½å¯ä»¥è¾¾åˆ°ä¸é”™çš„èšç±»æ•ˆæœ:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/6.png"></p><p>è€Œè¿™äº›ç»„åˆ,éƒ½å¯ä»¥ç”±ä¸¥æ ¼çš„æ•°å­¦è¯æ˜æ¥æ¨å¯¼ã€‚åœ¨sklearnå½“ä¸­,æˆ‘ä»¬æ— æ³•é€‰æ‹©ä½¿ç”¨çš„è·ç¦»,åªèƒ½ä½¿ç”¨æ¬§å¼è·ç¦»ã€‚<br>å› æ­¤,æˆ‘ä»¬ä¹Ÿæ— éœ€å»æ‹…å¿§è¿™äº›è·ç¦»æ‰€æ­é…çš„è´¨å¿ƒé€‰æ‹©æ˜¯å¦‚ä½•å¾—æ¥çš„äº†ã€‚</p><h2 id="sklearn-cluster-KMeans"><a href="#sklearn-cluster-KMeans" class="headerlink" title="sklearn.cluster.KMeans"></a>sklearn.cluster.KMeans</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">sklearn</span><span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>KMeans <span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> init<span class="token operator">=</span>â€™k<span class="token operator">-</span>means<span class="token operator">+</span><span class="token operator">+</span>â€™<span class="token punctuation">,</span> n_init<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span>precompute_distances<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> copy_x<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span>None<span class="token punctuation">,</span> algorithm<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">)</span></code></pre><h3 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h3><p><strong>n_clusters</strong></p><p>â€‹     n_clustersæ˜¯KMeansä¸­çš„k,è¡¨ç¤ºç€æˆ‘ä»¬å‘Šè¯‰æ¨¡å‹æˆ‘ä»¬è¦åˆ†å‡ ç±»ã€‚è¿™æ˜¯KMeanså½“ä¸­å”¯ä¸€ä¸€ä¸ªå¿…å¡«çš„å‚æ•°,é»˜è®¤ä¸º8ç±»,ä½†é€šå¸¸æˆ‘ä»¬çš„èšç±»ç»“æœä¼šæ˜¯ä¸€ä¸ªå°äº8çš„ç»“æœã€‚é€šå¸¸,åœ¨å¼€å§‹èšç±»ä¹‹å‰,æˆ‘ä»¬å¹¶ä¸çŸ¥é“n_clustersç©¶ç«Ÿæ˜¯å¤šå°‘,</p><h3 id="èšç±»ç®—æ³•çš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡"><a href="#èšç±»ç®—æ³•çš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡" class="headerlink" title="èšç±»ç®—æ³•çš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡"></a>èšç±»ç®—æ³•çš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡</h3><p>â€‹      ä¸åŒäºåˆ†ç±»æ¨¡å‹å’Œå›å½’,èšç±»ç®—æ³•çš„æ¨¡å‹è¯„ä¼°ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹ã€‚åœ¨åˆ†ç±»ä¸­,æœ‰ç›´æ¥ç»“æœ(æ ‡ç­¾)çš„è¾“å‡º,å¹¶ä¸”åˆ†<br>ç±»çš„ç»“æœæœ‰æ­£è¯¯ä¹‹åˆ†,æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨é¢„æµ‹çš„å‡†ç¡®åº¦,æ··æ·†çŸ©é˜µ,ROCæ›²çº¿ç­‰ç­‰æŒ‡æ ‡æ¥è¿›è¡Œè¯„ä¼°,ä½†æ— è®ºå¦‚ä½•è¯„ä¼°,<br>éƒ½æ˜¯åœ¨â€æ¨¡å‹æ‰¾åˆ°æ­£ç¡®ç­”æ¡ˆâ€œçš„èƒ½åŠ›ã€‚è€Œå›å½’ä¸­,ç”±äºè¦æ‹Ÿåˆæ•°æ®,æˆ‘ä»¬æœ‰SSEå‡æ–¹è¯¯å·®,æœ‰æŸå¤±å‡½æ•°æ¥è¡¡é‡æ¨¡å‹çš„<br>æ‹Ÿåˆç¨‹åº¦ã€‚ä½†è¿™äº›è¡¡é‡æŒ‡æ ‡éƒ½ä¸èƒ½å¤Ÿä½¿ç”¨äºèšç±»ã€‚</p><p>â€‹     é¢è¯•é«˜å±é—®é¢˜:å¦‚ä½•è¡¡é‡èšç±»ç®—æ³•çš„æ•ˆæœ?<br>èšç±»æ¨¡å‹çš„ç»“æœä¸æ˜¯æŸç§æ ‡ç­¾è¾“å‡º,å¹¶ä¸”èšç±»çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„,å…¶ä¼˜åŠ£ç”±ä¸šåŠ¡éœ€æ±‚æˆ–è€…ç®—æ³•éœ€æ±‚æ¥å†³å®š,å¹¶<br>ä¸”æ²¡æœ‰æ°¸è¿œçš„æ­£ç¡®ç­”æ¡ˆã€‚é‚£æˆ‘ä»¬å¦‚ä½•è¡¡é‡èšç±»çš„æ•ˆæœå‘¢?</p><h4 id="å½“çœŸå®æ ‡ç­¾å·²çŸ¥çš„æ—¶å€™"><a href="#å½“çœŸå®æ ‡ç­¾å·²çŸ¥çš„æ—¶å€™" class="headerlink" title="å½“çœŸå®æ ‡ç­¾å·²çŸ¥çš„æ—¶å€™"></a>å½“çœŸå®æ ‡ç­¾å·²çŸ¥çš„æ—¶å€™</h4><p>â€‹       è™½ç„¶æˆ‘ä»¬åœ¨èšç±»ä¸­ä¸è¾“å…¥çœŸå®æ ‡ç­¾,ä½†è¿™ä¸ä»£è¡¨æˆ‘ä»¬æ‹¥æœ‰çš„æ•°æ®ä¸­ä¸€å®šä¸å…·æœ‰çœŸå®æ ‡ç­¾,æˆ–è€…ä¸€å®šæ²¡æœ‰ä»»ä½•å‚è€ƒä¿¡æ¯ã€‚å½“ç„¶,åœ¨ç°å®ä¸­,æ‹¥æœ‰çœŸå®æ ‡ç­¾çš„æƒ…å†µéå¸¸å°‘è§(å‡ ä¹æ˜¯ä¸å¯èƒ½çš„)ã€‚å¦‚æœæ‹¥æœ‰çœŸå®æ ‡ç­¾,æˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨<br>åˆ†ç±»ç®—æ³•ã€‚ä½†ä¸æ’é™¤æˆ‘ä»¬ä¾ç„¶å¯èƒ½ä½¿ç”¨èšç±»ç®—æ³•çš„å¯èƒ½æ€§ã€‚å¦‚æœæˆ‘ä»¬æœ‰æ ·æœ¬çœŸå®èšç±»æƒ…å†µçš„æ•°æ®,æˆ‘ä»¬å¯ä»¥å¯¹äºèš<br>ç±»ç®—æ³•çš„ç»“æœå’ŒçœŸå®ç»“æœæ¥è¡¡é‡èšç±»çš„æ•ˆæœã€‚å¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•:<img src="/2020/09/19/ju-lei-suan-fa-yuan-li/7.png" alt="7"></p><h4 id="å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™-è½®å»“ç³»æ•°"><a href="#å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™-è½®å»“ç³»æ•°" class="headerlink" title="å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™:è½®å»“ç³»æ•°"></a>å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™:è½®å»“ç³»æ•°</h4><p>â€‹      åœ¨99%çš„æƒ…å†µä¸‹,æˆ‘ä»¬æ˜¯å¯¹æ²¡æœ‰çœŸå®æ ‡ç­¾çš„æ•°æ®è¿›è¡Œæ¢ç´¢,ä¹Ÿå°±æ˜¯å¯¹ä¸çŸ¥é“çœŸæ­£ç­”æ¡ˆçš„æ•°æ®è¿›è¡Œèšç±»ã€‚è¿™æ ·çš„èš<br>ç±»,æ˜¯å®Œå…¨ä¾èµ–äºè¯„ä»·ç°‡å†…çš„ç¨ å¯†ç¨‹åº¦(ç°‡å†…å·®å¼‚å°)å’Œç°‡é—´çš„ç¦»æ•£ç¨‹åº¦(ç°‡å¤–å·®å¼‚å¤§)æ¥è¯„ä¼°èšç±»çš„æ•ˆæœã€‚å…¶ä¸­<br>è½®å»“ç³»æ•°æ˜¯æœ€å¸¸ç”¨çš„èšç±»ç®—æ³•çš„è¯„ä»·æŒ‡æ ‡ã€‚å®ƒæ˜¯å¯¹æ¯ä¸ªæ ·æœ¬æ¥å®šä¹‰çš„,å®ƒèƒ½å¤ŸåŒæ—¶è¡¡é‡:<br>1)æ ·æœ¬ä¸å…¶è‡ªèº«æ‰€åœ¨çš„ç°‡ä¸­çš„å…¶ä»–æ ·æœ¬çš„ç›¸ä¼¼åº¦a,ç­‰äºæ ·æœ¬ä¸åŒä¸€ç°‡ä¸­æ‰€æœ‰å…¶ä»–ç‚¹ä¹‹é—´çš„å¹³å‡è·ç¦»<br>2)æ ·æœ¬ä¸å…¶ä»–ç°‡ä¸­çš„æ ·æœ¬çš„ç›¸ä¼¼åº¦b,ç­‰äºæ ·æœ¬ä¸ä¸‹ä¸€ä¸ªæœ€è¿‘çš„ç°‡ä¸­çš„æ‰€æœ‰ç‚¹ä¹‹é—´çš„å¹³å‡è·ç¦»<br>æ ¹æ®èšç±»çš„è¦æ±‚â€ç°‡å†…å·®å¼‚å°,ç°‡å¤–å·®å¼‚å¤§â€œ,æˆ‘ä»¬å¸Œæœ›bæ°¸è¿œå¤§äºa,å¹¶ä¸”å¤§å¾—è¶Šå¤šè¶Šå¥½ã€‚</p><p>å•ä¸ªæ ·æœ¬çš„è½®å»“ç³»æ•°è®¡ç®—ä¸º:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/8.png"></p><p>è¿™ä¸ªå…¬å¼å¯ä»¥è¢«è§£æä¸º:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/9.png"></p><p>â€‹      å¾ˆå®¹æ˜“ç†è§£è½®å»“ç³»æ•°èŒƒå›´æ˜¯(-1,1),å…¶ä¸­å€¼è¶Šæ¥è¿‘1è¡¨ç¤ºæ ·æœ¬ä¸è‡ªå·±æ‰€åœ¨çš„ç°‡ä¸­çš„æ ·æœ¬å¾ˆç›¸ä¼¼,å¹¶ä¸”ä¸å…¶ä»–ç°‡ä¸­çš„æ ·<br>æœ¬ä¸ç›¸ä¼¼,å½“æ ·æœ¬ç‚¹ä¸ç°‡å¤–çš„æ ·æœ¬æ›´ç›¸ä¼¼çš„æ—¶å€™,è½®å»“ç³»æ•°å°±ä¸ºè´Ÿã€‚å½“è½®å»“ç³»æ•°ä¸º0æ—¶,åˆ™ä»£è¡¨ä¸¤ä¸ªç°‡ä¸­çš„æ ·æœ¬ç›¸<br>ä¼¼åº¦ä¸€è‡´,ä¸¤ä¸ªç°‡æœ¬åº”è¯¥æ˜¯ä¸€ä¸ªç°‡ã€‚å¯ä»¥æ€»ç»“ä¸ºè½®å»“ç³»æ•°è¶Šæ¥è¿‘äº1è¶Šå¥½,è´Ÿæ•°åˆ™è¡¨ç¤ºèšç±»æ•ˆæœéå¸¸å·®ã€‚<br>å¦‚æœä¸€ä¸ªç°‡ä¸­çš„å¤§å¤šæ•°æ ·æœ¬å…·æœ‰æ¯”è¾ƒé«˜çš„è½®å»“ç³»æ•°,åˆ™ç°‡ä¼šæœ‰è¾ƒé«˜çš„æ€»è½®å»“ç³»æ•°,åˆ™æ•´ä¸ªæ•°æ®é›†çš„å¹³å‡è½®å»“ç³»æ•°è¶Š<br>é«˜,åˆ™èšç±»æ˜¯åˆé€‚çš„ã€‚å¦‚æœè®¸å¤šæ ·æœ¬ç‚¹å…·æœ‰ä½è½®å»“ç³»æ•°ç”šè‡³è´Ÿå€¼,åˆ™èšç±»æ˜¯ä¸åˆé€‚çš„,èšç±»çš„è¶…å‚æ•°Kå¯èƒ½è®¾å®šå¾—<br>å¤ªå¤§æˆ–è€…å¤ªå°ã€‚</p><p>â€‹      åœ¨sklearnä¸­,æˆ‘ä»¬ä½¿ç”¨æ¨¡å—metricsä¸­çš„ç±»silhouette_scoreæ¥è®¡ç®—è½®å»“ç³»æ•°,å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°æ®é›†ä¸­,æ‰€æœ‰æ ·<br>æœ¬çš„è½®å»“ç³»æ•°çš„å‡å€¼ã€‚ä½†æˆ‘ä»¬è¿˜æœ‰åŒåœ¨metricsæ¨¡å—ä¸­çš„silhouette_sample,å®ƒçš„å‚æ•°ä¸è½®å»“ç³»æ•°ä¸€è‡´,ä½†è¿”å›çš„<br>æ˜¯æ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬è‡ªå·±çš„è½®å»“ç³»æ•°ã€‚</p><h4 id="å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™-Calinski-Harabaz-Index"><a href="#å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™-Calinski-Harabaz-Index" class="headerlink" title="å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™:Calinski-Harabaz Index"></a>å½“çœŸå®æ ‡ç­¾æœªçŸ¥çš„æ—¶å€™:Calinski-Harabaz Index</h4><p>â€‹       é™¤äº†è½®å»“ç³»æ•°æ˜¯æœ€å¸¸ç”¨çš„,æˆ‘ä»¬è¿˜æœ‰å¡æ—æ–¯åŸº-å“ˆæ‹‰å·´æ–¯æŒ‡æ•°(Calinski-Harabaz Index,ç®€ç§°CHI,ä¹Ÿè¢«ç§°ä¸ºæ–¹å·®<br>æ¯”æ ‡å‡†),æˆ´ç»´æ–¯-å¸ƒå°”ä¸æŒ‡æ•°(Davies-Bouldin)ä»¥åŠæƒå˜çŸ©é˜µ(Contingency Matrix)å¯ä»¥ä½¿ç”¨ã€‚</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/12.png"></p><p>â€‹         åœ¨è¿™é‡Œæˆ‘ä»¬é‡ç‚¹æ¥äº†è§£ä¸€ä¸‹å¡æ—æ–¯åŸº-å“ˆæ‹‰å·´æ–¯æŒ‡æ•°ã€‚Calinski-HarabazæŒ‡æ•°è¶Šé«˜è¶Šå¥½ã€‚å¯¹äºæœ‰kä¸ªç°‡çš„èšç±»è€Œè¨€,Calinski-HarabazæŒ‡æ•°s(k)å†™ä½œå¦‚ä¸‹å…¬å¼:</p><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/13.png"></p><p>â€‹       å…¶ä¸­Nä¸ºæ•°æ®é›†ä¸­çš„æ ·æœ¬é‡,kä¸ºç°‡çš„ä¸ªæ•°(å³ç±»åˆ«çš„ä¸ªæ•°),æ˜¯ç»„é—´ç¦»æ•£çŸ©é˜µ,å³ä¸åŒç°‡ä¹‹é—´çš„åæ–¹å·®çŸ©é˜µ,$W _k$æ˜¯ç°‡å†…ç¦»æ•£çŸ©é˜µ,å³ä¸€ä¸ªç°‡å†…æ•°æ®çš„åæ–¹å·®çŸ©é˜µ,è€Œtrè¡¨ç¤ºçŸ©é˜µçš„è¿¹ã€‚åœ¨çº¿æ€§ä»£æ•°ä¸­,ä¸€ä¸ªnÃ—nçŸ©é˜µAçš„ä¸»å¯¹è§’çº¿(ä»å·¦ä¸Šæ–¹è‡³å³ä¸‹æ–¹çš„å¯¹è§’çº¿)ä¸Šå„ä¸ªå…ƒç´ çš„æ€»å’Œè¢«ç§°ä¸ºçŸ©é˜µAçš„è¿¹(æˆ–è¿¹æ•°),ä¸€èˆ¬è®°ä½œ ã€‚æ•°æ®ä¹‹é—´çš„ç¦»æ•£ç¨‹åº¦è¶Šé«˜,åæ–¹å·®çŸ©é˜µçš„è¿¹å°±ä¼šè¶Šå¤§ã€‚ç»„å†…ç¦»æ•£ç¨‹åº¦ä½,åæ–¹å·®çš„è¿¹å°±ä¼šè¶Šå°, ä¹Ÿå°±è¶Šå°,åŒæ—¶,ç»„é—´ç¦»æ•£ç¨‹åº¦å¤§,åæ–¹å·®çš„çš„è¿¹ä¹Ÿä¼šè¶Šå¤§, å°±è¶Šå¤§,è¿™æ­£æ˜¯æˆ‘ä»¬å¸Œæœ›çš„,å› æ­¤Calinski-harabazæŒ‡æ•°è¶Šé«˜è¶Šå¥½ã€‚</p><h2 id="é‡è¦å‚æ•°init-amp-random-state-amp-n-init-åˆå§‹è´¨å¿ƒæ€ä¹ˆæ”¾å¥½"><a href="#é‡è¦å‚æ•°init-amp-random-state-amp-n-init-åˆå§‹è´¨å¿ƒæ€ä¹ˆæ”¾å¥½" class="headerlink" title="é‡è¦å‚æ•°init &amp; random_state &amp; n_init:åˆå§‹è´¨å¿ƒæ€ä¹ˆæ”¾å¥½?"></a>é‡è¦å‚æ•°init &amp; random_state &amp; n_init:åˆå§‹è´¨å¿ƒæ€ä¹ˆæ”¾å¥½?</h2><p>â€‹       åœ¨K-Meansä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚,å°±æ˜¯æ”¾ç½®åˆå§‹è´¨å¿ƒã€‚å¦‚æœæœ‰è¶³å¤Ÿçš„æ—¶é—´,K-meansä¸€å®šä¼šæ”¶æ•›,ä½†Inertiaå¯èƒ½æ”¶<br>æ•›åˆ°å±€éƒ¨æœ€å°å€¼ã€‚æ˜¯å¦èƒ½å¤Ÿæ”¶æ•›åˆ°çœŸæ­£çš„æœ€å°å€¼å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºè´¨å¿ƒçš„åˆå§‹åŒ–ã€‚initå°±æ˜¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬å†³å®šåˆå§‹<br>åŒ–æ–¹å¼çš„å‚æ•°ã€‚</p><p>â€‹         init:å¯è¾“å…¥â€k-means++â€,â€randomâ€æˆ–è€…ä¸€ä¸ªnç»´æ•°ç»„ã€‚è¿™æ˜¯åˆå§‹åŒ–è´¨å¿ƒçš„æ–¹æ³•,é»˜è®¤â€k-means++â€ã€‚è¾“å…¥â€k-means++â€:ä¸€ç§ä¸ºKå‡å€¼èšç±»é€‰æ‹©åˆå§‹èšç±»ä¸­å¿ƒçš„èªæ˜çš„åŠæ³•,ä»¥åŠ é€Ÿæ”¶æ•›ã€‚å¦‚æœè¾“å…¥äº†nç»´æ•°ç»„,æ•°ç»„çš„å½¢çŠ¶åº”è¯¥æ˜¯(n_clusters,n_features)å¹¶ç»™å‡ºåˆå§‹è´¨å¿ƒã€‚</p><h2 id="é‡è¦å‚æ•°max-iter-amp-tol-è®©è¿­ä»£åœä¸‹æ¥"><a href="#é‡è¦å‚æ•°max-iter-amp-tol-è®©è¿­ä»£åœä¸‹æ¥" class="headerlink" title="é‡è¦å‚æ•°max_iter &amp; tol:è®©è¿­ä»£åœä¸‹æ¥"></a>é‡è¦å‚æ•°max_iter &amp; tol:è®©è¿­ä»£åœä¸‹æ¥</h2><p>åœ¨ä¹‹å‰æè¿°K-Meansçš„åŸºæœ¬æµç¨‹æ—¶æˆ‘ä»¬æåˆ°è¿‡,å½“è´¨å¿ƒä¸å†ç§»åŠ¨,Kmeansç®—æ³•å°±ä¼šåœä¸‹æ¥ã€‚ä½†åœ¨å®Œå…¨æ”¶æ•›ä¹‹å‰,æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨max_iter,æœ€å¤§è¿­ä»£æ¬¡æ•°,æˆ–è€…tol,ä¸¤æ¬¡è¿­ä»£é—´Inertiaä¸‹é™çš„é‡,è¿™ä¸¤ä¸ªå‚æ•°æ¥è®©è¿­ä»£æå‰åœä¸‹æ¥ã€‚æœ‰æ—¶å€™,å½“æˆ‘ä»¬çš„n_clustersé€‰æ‹©ä¸ç¬¦åˆæ•°æ®çš„è‡ªç„¶åˆ†å¸ƒ,æˆ–è€…æˆ‘ä»¬ä¸ºäº†ä¸šåŠ¡éœ€æ±‚,å¿…é¡»è¦å¡«å…¥ä¸æ•°æ®çš„è‡ªç„¶åˆ†å¸ƒä¸åˆçš„n_clusters,æå‰è®©è¿­ä»£åœä¸‹æ¥åè€Œèƒ½å¤Ÿæå‡æ¨¡å‹çš„è¡¨ç°ã€‚</p><p><strong>max_iter</strong>:æ•´æ•°,é»˜è®¤300,å•æ¬¡è¿è¡Œçš„k-meansç®—æ³•çš„æœ€å¤§è¿­ä»£æ¬¡æ•°<br><strong>tol</strong>:æµ®ç‚¹æ•°,é»˜è®¤1e-4,ä¸¤æ¬¡è¿­ä»£é—´Inertiaä¸‹é™çš„é‡,å¦‚æœä¸¤æ¬¡è¿­ä»£ä¹‹é—´Inertiaä¸‹é™çš„å€¼å°äºtolæ‰€è®¾å®šçš„å€¼,è¿­ä»£å°±ä¼šåœä¸‹</p><h2 id="é‡è¦å±æ€§ä¸é‡è¦æ¥å£"><a href="#é‡è¦å±æ€§ä¸é‡è¦æ¥å£" class="headerlink" title="é‡è¦å±æ€§ä¸é‡è¦æ¥å£"></a>é‡è¦å±æ€§ä¸é‡è¦æ¥å£</h2><p><img src="/2020/09/19/ju-lei-suan-fa-yuan-li/14.png"></p><h2 id="å‡½æ•°cluster-k-means"><a href="#å‡½æ•°cluster-k-means" class="headerlink" title="å‡½æ•°cluster.k_means"></a>å‡½æ•°cluster.k_means</h2><pre class=" language-python"><code class="language-python">sklearn<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>k_means <span class="token punctuation">(</span>X<span class="token punctuation">,</span> n_clusters<span class="token punctuation">,</span> sample_weight<span class="token operator">=</span>None<span class="token punctuation">,</span> init<span class="token operator">=</span>â€™k<span class="token operator">-</span>means<span class="token operator">+</span><span class="token operator">+</span>â€™<span class="token punctuation">,</span> precompute_distances<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">,</span>n_init<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> copy_x<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span>None<span class="token punctuation">,</span>algorithm<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">,</span> return_n_iter<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>â€‹         å‡½æ•°k_meansçš„ç”¨æ³•å…¶å®å’Œç±»éå¸¸ç›¸ä¼¼,ä¸è¿‡å‡½æ•°æ˜¯è¾“å…¥ä¸€ç³»åˆ—å€¼,è€Œç›´æ¥è¿”å›ç»“æœã€‚ä¸€æ¬¡æ€§åœ°,å‡½æ•°k_meansä¼šä¾æ¬¡è¿”å›è´¨å¿ƒ,æ¯ä¸ªæ ·æœ¬å¯¹åº”çš„ç°‡çš„æ ‡ç­¾,inertiaä»¥åŠæœ€ä½³è¿­ä»£æ¬¡æ•°ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‘æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šè½®å¯¹è¯æ¡†æ¶Rasaä»£ç è§£è¯»-2</title>
      <link href="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/"/>
      <url>/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/</url>
      
        <content type="html"><![CDATA[<h1 id="Rasaæºç è§£è¯»"><a href="#Rasaæºç è§£è¯»" class="headerlink" title="Rasaæºç è§£è¯»"></a>Rasaæºç è§£è¯»</h1><h2 id="è„šæœ¬æ€»å…¥å£"><a href="#è„šæœ¬æ€»å…¥å£" class="headerlink" title="è„šæœ¬æ€»å…¥å£"></a>è„šæœ¬æ€»å…¥å£</h2><p><code>python __main__.py ã€€train --domain domain.yml --data data --config config.yml --out models</code></p><p>æ‰€æœ‰rasaæŒ‡ä»¤çš„æ€»å…¥å£å‡½æ•°</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/1.png"></p><p>train é¦–å…ˆæ‰§è¡Œ<code>cmdline_arguments.func(cmdline_arguments)</code>ç„¶å<code>create_argument_parser()</code>â€“&gt;<code>train.add_subparser</code>ï¼ï¼<code>train_parser.set_defaults(func=train)</code>ï¼Œè¿™æ ·è°ƒç”¨çš„å°±æ˜¯<code>train</code>å³æ‰§è¡Œäº†<code>.../rasa/train.py</code>æ–‡ä»¶ä¸­çš„trainå‡½æ•°ã€‚</p><p>å‚æ•°ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># è®­ç»ƒåœ¨`.../rasa/train.py`æ–‡ä»¶ä¸‹ï¼Œé‚£çœŸæ­£å…¥å£æ˜¯`train_async`å‡½æ•°</span>train_async<span class="token punctuation">(</span>    domain<span class="token operator">=</span>domain<span class="token punctuation">,</span>    config<span class="token operator">=</span>config<span class="token punctuation">,</span>    training_files<span class="token operator">=</span>training_files<span class="token punctuation">,</span>    output_path<span class="token operator">=</span>output<span class="token punctuation">,</span>    force_training<span class="token operator">=</span>force_training<span class="token punctuation">,</span>    fixed_model_name<span class="token operator">=</span>fixed_model_name<span class="token punctuation">,</span>    persist_nlu_training_data<span class="token operator">=</span>persist_nlu_training_data<span class="token punctuation">,</span>    additional_arguments<span class="token operator">=</span>additional_arguments<span class="token punctuation">,</span><span class="token punctuation">)</span></code></pre><p>åœ¨è°ƒç”¨_do_trainingï¼Œå…¥å‚å’Œä¸Šè¿°ä¸åŒçš„åœ°æ–¹åœ¨äºdomainä¸å†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªDomainå¯¹è±¡ï¼Œä¸»è¦æ˜¯æŠŠdomain.ymlæ–‡ä»¶ä¸­çš„å†…å®¹å˜æˆå­—å…¸from_dictã€‚</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#_do_training åœ¨æ–‡ä»¶ .../rasa/train.py  180è¡Œ</span><span class="token keyword">if</span> fingerprint_comparison<span class="token punctuation">.</span>is_training_required<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">await</span> _do_training<span class="token punctuation">(</span>            file_importer<span class="token punctuation">,</span>ã€€            output_path<span class="token operator">=</span>output_path<span class="token punctuation">,</span>            train_path<span class="token operator">=</span>train_path<span class="token punctuation">,</span>            fingerprint_comparison_result<span class="token operator">=</span>fingerprint_comparison<span class="token punctuation">,</span>            fixed_model_name<span class="token operator">=</span>fixed_model_name<span class="token punctuation">,</span>            persist_nlu_training_data<span class="token operator">=</span>persist_nlu_training_data<span class="token punctuation">,</span>            additional_arguments<span class="token operator">=</span>additional_arguments<span class="token punctuation">,</span>        <span class="token punctuation">)</span></code></pre><p>ç„¶ååˆ†åˆ«ç”¨<code>_train_core_with_validated_data</code>è®­ç»ƒcore,ç”¨<code>_train_nlu_with_validated_data</code>è®­ç»ƒnlu.</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/2.png"></p><h2 id="Core-å¯¹è¯ç®¡ç†æ¨¡å—çš„è§£è¯»"><a href="#Core-å¯¹è¯ç®¡ç†æ¨¡å—çš„è§£è¯»" class="headerlink" title="Core å¯¹è¯ç®¡ç†æ¨¡å—çš„è§£è¯»"></a>Core å¯¹è¯ç®¡ç†æ¨¡å—çš„è§£è¯»</h2><p><strong>æ•´ä½“çš„å¤„ç†é€»è¾‘</strong></p><p>åŠ è½½policiesé…ç½®ï¼ï¼æ„é€ Agentå¯¹è±¡ï¼ï¼åŠ è½½è®­ç»ƒæ•°æ®ï¼ï¼è¿›è¡Œè®­ç»ƒï¼ï¼æ¨¡å‹æŒä¹…åŒ–</p><p><strong>å¯¹è¯ç®¡ç†çš„å…¥å£</strong></p><p>ã€€ã€€<code>train.py</code>çš„<code>_do_training</code>å‡½æ•°ï¼Œè®­ç»ƒçš„å…¥å£æ˜¯<code>_train_core_with_validated_data</code>ï¼Œæˆ‘ä»¬é¦–å…ˆå¼„æ¸…æ¥šä¼ çš„å…¥å‚ï¼š</p><p><code>domain</code>ï¼Œæ˜¯ä¸€ä¸ª<code>Domain</code>å¯¹è±¡ï¼Œä¸åœ¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå’Œ<code>domain.yml</code>æ–‡ä»¶å¯¹åº”ã€‚åœ¨<code>rasa/domain.py</code>æ–‡ä»¶ä¸­ï¼Œ</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># rasa/domain.py line 342   ----> intent_properties</span>    <span class="token keyword">def</span> <span class="token function">collect_intent_properties</span><span class="token punctuation">(</span>        cls<span class="token punctuation">,</span> intents<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Union<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> entities<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Union<span class="token punctuation">[</span>bool<span class="token punctuation">,</span> List<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># make a copy to not alter the input argument</span>        intents <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>intents<span class="token punctuation">)</span>        intent_properties <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>        duplicates <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> intent <span class="token keyword">in</span> intents<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>intent<span class="token punctuation">,</span> dict<span class="token punctuation">)</span><span class="token punctuation">:</span>                intent <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;intent: &amp;#123;USE_ENTITIES_KEY: True, IGNORE_ENTITIES_KEY: []&amp;#125;&amp;#125;</span>            name <span class="token operator">=</span> list<span class="token punctuation">(</span>intent<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> name <span class="token keyword">in</span> intent_properties<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                duplicates<span class="token punctuation">.</span>add<span class="token punctuation">(</span>name<span class="token punctuation">)</span>            intent <span class="token operator">=</span> cls<span class="token punctuation">.</span>_transform_intent_properties_for_internal_use<span class="token punctuation">(</span>intent<span class="token punctuation">,</span> entities<span class="token punctuation">)</span>            intent_properties<span class="token punctuation">.</span>update<span class="token punctuation">(</span>intent<span class="token punctuation">)</span></code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/7.png"></p><p>configï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²â€™config.ymlâ€™</p><p>story_directoryï¼Œå­—ç¬¦ä¸²â€™/tmp/tmp110fpdymâ€™ï¼Œå¯¹åº”åŸå§‹æ–‡ä»¶æ˜¯data/core/stories.md,ã€€åœ¨è®­ç»ƒæ—¶æ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸‹</p><p>outputã€€è¾“å‡ºç›®å½•â€™modelsâ€™</p><p>train_pathã€€ä¼ å…¥å€¼ä¸ºç©ºï¼Œç”±ç³»ç»Ÿç”Ÿæˆä¸€ä¸ªä¸´æ—¶ç›®å½•â€™/tmp/tmp7odkccbrâ€™</p><p>fixed_model_nameã€€å€¼ä¸ºç©º</p><p>kwargs,æ˜¯ä¸€ä¸ªå­—å…¸ï¼š</p><p>ï¼‘ï¼ã€€åŠ è½½policiesé…ç½®</p><p>è¯»å–é…ç½®æ–‡ä»¶config.ymlï¼Œæ„é€ PolicyEnsembleå¯¹è±¡ã€‚è¿™é‡Œç»™å‡ºè¿è¡Œæ—¶çš„æ ·ä¾‹æ•°æ®ï¼Œä¾¿äºå’Œé…ç½®æ–‡ä»¶åšå¯¹æ¯”ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># .../rasa/core/agent.py line 342</span>self<span class="token punctuation">.</span>policy_ensemble <span class="token operator">=</span> self<span class="token punctuation">.</span>_create_ensemble<span class="token punctuation">(</span>policies<span class="token punctuation">)</span><span class="token comment" spellcheck="true">##./policies/ensemble.py line 924</span><span class="token keyword">def</span> <span class="token function">_create_ensemble</span><span class="token punctuation">(</span>        policies<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Policy<span class="token punctuation">]</span><span class="token punctuation">,</span> PolicyEnsemble<span class="token punctuation">,</span> None<span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span>PolicyEnsemble<span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">if</span> policies <span class="token keyword">is</span> None<span class="token punctuation">:</span>            <span class="token keyword">return</span> None        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>policies<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> SimplePolicyEnsemble<span class="token punctuation">(</span>policies<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#&lt;-----------------æ„é€ PolicyEnsembleå¯¹è±¡</span>                <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>policies<span class="token punctuation">,</span> PolicyEnsemble<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#&lt;-----------------æ„é€ PolicyEnsembleå¯¹è±¡</span>            <span class="token keyword">return</span> policies</code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/8.png"></p><p>ï¼’ï¼æ„é€ Agentå¯¹è±¡</p><p>Agentå¯¹è±¡åœ¨Rasaæ¡†æ¶ä¸­æä¾›äº†éå¸¸å¤šçš„æ¥å£ï¼ŒåŒ…æ‹¬è®­ç»ƒï¼Œå¤„ç†è¾“å…¥æ¶ˆæ¯ï¼ŒåŠ è½½å¯¹è¯æ¨¡å‹ï¼Œè·å–ä¸‹ä¸€æ­¥çš„actionï¼Œå¤„ç†é€šé“ã€‚</p><p>è¿™é‡Œä¸»è¦å…³æ³¨ç±»çš„å…³è”å…³ç³»ã€‚</p><ul><li>domainæŒ‡å‘Domainå¯¹è±¡</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## .../rasa/core/agent.py line 341</span>self<span class="token punctuation">.</span>domain <span class="token operator">=</span> self<span class="token punctuation">.</span>_create_domain<span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## .../rasa/core/agent.py line 887</span><span class="token keyword">def</span> <span class="token function">_create_domain</span><span class="token punctuation">(</span>domain<span class="token punctuation">:</span> Union<span class="token punctuation">[</span>Domain<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Domain<span class="token punctuation">:</span>    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>        domain <span class="token operator">=</span> Domain<span class="token punctuation">.</span>load<span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token comment" spellcheck="true">##&lt;------domainæŒ‡å‘Domainå¯¹è±¡</span>        domain<span class="token punctuation">.</span>check_missing_templates<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> domain    <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> Domain<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> domain<span class="token comment" spellcheck="true">##  &lt;-------domainæŒ‡å‘Domainå¯¹è±¡</span>    <span class="token keyword">elif</span> domain <span class="token keyword">is</span> None<span class="token punctuation">:</span>        <span class="token keyword">return</span> Domain<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><ul><li>interpreteræŒ‡å‘NaturalLanguageInterpreterå¯¹è±¡</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## .../rasa/core/agent.py line 353</span>self<span class="token punctuation">.</span>interpreter <span class="token operator">=</span> NaturalLanguageInterpreter<span class="token punctuation">.</span>create<span class="token punctuation">(</span>interpreter<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## ./rasa/core/interpreter.py line 32</span>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>        obj<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token string">"NaturalLanguageInterpreter"</span><span class="token punctuation">,</span> EndpointConfig<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># this second parameter is deprecated!</span>        endpoint<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>EndpointConfig<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>    <span class="token punctuation">)</span>             obj <span class="token operator">=</span> endpoint <span class="token operator">or</span> obj        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> NaturalLanguageInterpreter<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> obj        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> RasaNLUInterpreter<span class="token punctuation">(</span>model_directory<span class="token operator">=</span>obj<span class="token punctuation">)</span>        <span class="token keyword">elif</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># user passed in a string, but file does not exist</span>            logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>                f<span class="token string">"No local NLU model '&amp;#123;obj&amp;#125;' found. Using RegexInterpreter instead."</span>            <span class="token punctuation">)</span>            <span class="token keyword">return</span> RegexInterpreter<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> _create_from_endpoint_config<span class="token punctuation">(</span>obj<span class="token punctuation">)</span></code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/12.png"></p><ul><li>nlgæŒ‡å‘NaturalLanguageGeneratorå¯¹è±¡ï¼Œæœ¬ç¤ºä¾‹ä¸­å®é™…æ˜¯TemplatedNaturalLanguageGeneratorå¯¹è±¡ã€‚</li></ul><pre class=" language-python"><code class="language-python"> <span class="token comment" spellcheck="true">#    .../rasa/core/agent.py line 355</span>    self<span class="token punctuation">.</span>nlg <span class="token operator">=</span> NaturalLanguageGenerator<span class="token punctuation">.</span>create<span class="token punctuation">(</span>generator<span class="token punctuation">,</span> self<span class="token punctuation">.</span>domain<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## ./rasa/core/nlg/generator.py line 905</span>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>        obj<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token string">"NaturalLanguageGenerator"</span><span class="token punctuation">,</span> EndpointConfig<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Domain<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> NaturalLanguageGenerator<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> obj        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> _create_from_endpoint_config<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> domain<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">### ./rasa/core/nlg/generator.py  </span><span class="token keyword">def</span> <span class="token function">_create_from_endpoint_config</span><span class="token punctuation">(</span>    endpoint_config<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>EndpointConfig<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Domain<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"NaturalLanguageGenerator"</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Given an endpoint configuration, create a proper NLG object."""</span>    domain <span class="token operator">=</span> domain <span class="token operator">or</span> Domain<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> endpoint_config <span class="token keyword">is</span> None<span class="token punctuation">:</span>        <span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>nlg <span class="token keyword">import</span> <span class="token punctuation">(</span>  <span class="token comment" spellcheck="true"># pytype: disable=pyi-error</span>            TemplatedNaturalLanguageGenerator<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># this is the default type if no endpoint config is set</span>        nlg <span class="token operator">=</span> TemplatedNaturalLanguageGenerator<span class="token punctuation">(</span>domain<span class="token punctuation">.</span>templates<span class="token punctuation">)</span>    <span class="token keyword">elif</span> endpoint_config<span class="token punctuation">.</span>type <span class="token keyword">is</span> None <span class="token operator">or</span> endpoint_config<span class="token punctuation">.</span>type<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"callback"</span><span class="token punctuation">:</span>        <span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>nlg <span class="token keyword">import</span> <span class="token punctuation">(</span>  <span class="token comment" spellcheck="true"># pytype: disable=pyi-error</span>            CallbackNaturalLanguageGenerator<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># this is the default type if no nlg type is set</span>        nlg <span class="token operator">=</span> CallbackNaturalLanguageGenerator<span class="token punctuation">(</span>endpoint_config<span class="token operator">=</span>endpoint_config<span class="token punctuation">)</span>    <span class="token keyword">elif</span> endpoint_config<span class="token punctuation">.</span>type<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"template"</span><span class="token punctuation">:</span>        <span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>nlg <span class="token keyword">import</span> <span class="token punctuation">(</span>  <span class="token comment" spellcheck="true"># pytype: disable=pyi-error</span>            TemplatedNaturalLanguageGenerator<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        nlg <span class="token operator">=</span> TemplatedNaturalLanguageGenerator<span class="token punctuation">(</span>domain<span class="token punctuation">.</span>templates<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        nlg <span class="token operator">=</span> _load_from_module_string<span class="token punctuation">(</span>endpoint_config<span class="token punctuation">,</span> domain<span class="token punctuation">)</span>    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>f<span class="token string">"Instantiated NLG to '&amp;#123;nlg.__class__.__name__&amp;#125;'."</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nlg</code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/10.png"></p><ul><li>tracker_storeæŒ‡å‘InMemoryTrackerStoreå¯¹è±¡</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#   .../rasa/core/agent.py line 355</span>self<span class="token punctuation">.</span>tracker_store <span class="token operator">=</span> self<span class="token punctuation">.</span>create_tracker_store<span class="token punctuation">(</span>tracker_store<span class="token punctuation">,</span> self<span class="token punctuation">.</span>domain<span class="token punctuation">)</span><span class="token comment" spellcheck="true">##..../rasa/core/agent.py line 912</span>tracker_store <span class="token operator">=</span> InMemoryTrackerStore<span class="token punctuation">(</span>domain<span class="token punctuation">)</span></code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/11.png"></p><p>action_endpointï¼Œæœ¬ç¤ºä¾‹ä¸­ä¸ºç©ºã€‚</p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>        obj<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token string">"NaturalLanguageGenerator"</span><span class="token punctuation">,</span> EndpointConfig<span class="token punctuation">,</span> None<span class="token punctuation">]</span><span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Domain<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"NaturalLanguageGenerator"</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Factory to create a generator."""</span>        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> NaturalLanguageGenerator<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> obj        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> _create_from_endpoint_config<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token comment" spellcheck="true">##&lt; ----</span></code></pre><p>ï¼“ï¼åŠ è½½è®­ç»ƒæ•°æ®</p><p>å‡½æ•°æ˜¯agent.load_dataï¼Œå…ˆåˆ†æå…¥å‚ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ./core/train.py line 63 </span>training_data <span class="token operator">=</span> <span class="token keyword">await</span> agent<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span>        training_resource<span class="token punctuation">,</span> exclusion_percentage<span class="token operator">=</span>exclusion_percentage<span class="token punctuation">,</span> <span class="token operator">**</span>data_load_args    <span class="token punctuation">)</span></code></pre><p>training_resourceï¼Œå¯¹åº”åŸå§‹æ–‡ä»¶æ˜¯data/core/stories.mdåŠå…¶ä»–æ•°æ®,ã€€åœ¨è®­ç»ƒæ—¶æ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸‹</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/13.png"></p><p>exclusion_percentageï¼Œæœ¬ç¤ºä¾‹çš„å€¼ä¸ºnoneã€‚å…·ä½“å«ä¹‰é€šè¿‡å˜é‡çš„åç§°å¯ä»¥ç†è§£ï¼Œå°±æ˜¯æŒ‡å®šè®­ç»ƒæ—¶åªä½¿ç”¨è®­ç»ƒæ•°æ®é›†çš„ä¸€éƒ¨åˆ†ã€‚</p><p>data_load_argsï¼Œæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…æ‹¬ï¼šaugmentation_factorä¸º50ï¼Œdebug_plotsä¸ºfalse</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/14.png"></p><p>å‡ºå‚æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯DialogueStateTrackerå¯¹è±¡ã€‚</p><p>è¿™é‡Œå…ˆè®²è§£ä¸‹storyçš„æ•°æ®æ ¼å¼ï¼š</p><pre class=" language-python"><code class="language-python"> <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>è¿™è¡Œæ˜¯æ³¨é‡Šï¼Œ<span class="token comment" spellcheck="true">##å¼€å¤´ï¼Œåé¢çš„éƒ¨åˆ†æ˜¯storyçš„åç§°ï¼Œä¸»è¦æ˜¯è°ƒè¯•ç”¨ã€‚æ¯ä¸ªstoryéƒ½æ˜¯ä»¥##å¼€å¤´--></span><span class="token comment" spellcheck="true">## Generated Story No7</span><span class="token operator">*</span> greet    <span class="token operator">-</span> utter_greet<span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> ä»¥<span class="token operator">*</span>å¼€å¤´çš„éƒ¨åˆ†ï¼Œå¯¹åº”ç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†ï¼Œæ ¼å¼æ˜¯æ„å›¾<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;å®ä½“ï¼šå€¼ï¼Œå®ä½“ï¼šå€¼...&amp;#125; --></span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> å…¶ä¸­<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;å®ä½“ï¼šå€¼&amp;#125;çš„éƒ¨åˆ†å¯ä»¥ä¸è¦--></span><span class="token operator">*</span> request_management<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"package": "å¥—é¤"&amp;#125;</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> ä»¥<span class="token operator">-</span>å¼€å¤´çš„éƒ¨åˆ†ï¼Œè¡¨ç¤ºç³»ç»Ÿçš„å“åº”ï¼Œä¹Ÿå°±æ˜¯èŠå¤©æœºå™¨äººæ‰§è¡Œçš„Action<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> ä»¥<span class="token operator">-</span> slotå¼€å¤´çš„éƒ¨åˆ†ï¼Œè¡¨ç¤ºéœ€è¦å¡«å……çš„æ§½<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>    <span class="token operator">-</span> slot<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"package": "å¥—é¤"&amp;#125;</span>    <span class="token operator">-</span> utter_ask_package<span class="token operator">*</span> inform<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"package": "å¥—é¤ä¸€"&amp;#125;</span>    <span class="token operator">-</span> slot<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"package": "å¥—é¤ä¸€"&amp;#125;</span>    <span class="token operator">-</span> utter_confirm<span class="token operator">*</span> confirm    <span class="token operator">-</span> utter_ack_management    <span class="token operator">-</span> utter_ask_morehelp<span class="token operator">*</span> deny    <span class="token operator">-</span> utter_goodbye<span class="token operator">*</span> thanks    <span class="token operator">-</span> utter_thanks</code></pre><p>è¯»å–æ–‡ä»¶ï¼ŒStoryFileReaderå¯¹åº”ä¸€ä¸ªstoryæ–‡ä»¶çš„ç±»ï¼Œæˆå‘˜å˜é‡story_stepsæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªList[StoryStep]ï¼Œè¿™é‡Œå­˜åœ¨listçš„åµŒå¥—ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#..../rasa/importers/rasa.py  line50</span> story_steps <span class="token operator">=</span> <span class="token keyword">await</span> StoryFileReader<span class="token punctuation">.</span>read_from_files<span class="token punctuation">(</span>            self<span class="token punctuation">.</span>_story_files<span class="token punctuation">,</span>            <span class="token keyword">await</span> self<span class="token punctuation">.</span>get_domain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            interpreter<span class="token punctuation">,</span>            template_variables<span class="token punctuation">,</span>            use_e2e<span class="token punctuation">,</span>            exclusion_percentage<span class="token punctuation">,</span>        <span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">## </span>        <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_from_files</span><span class="token punctuation">(</span>        files<span class="token punctuation">:</span> Iterable<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Domain<span class="token punctuation">,</span>        interpreter<span class="token punctuation">:</span> NaturalLanguageInterpreter <span class="token operator">=</span> RegexInterpreter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        template_variables<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        use_e2e<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>        exclusion_percentage<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>int<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>StoryStep<span class="token punctuation">]</span><span class="token punctuation">:</span>        story_steps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>            steps <span class="token operator">=</span> <span class="token keyword">await</span> StoryFileReader<span class="token punctuation">.</span>read_from_file<span class="token punctuation">(</span>                f<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> interpreter<span class="token punctuation">,</span> template_variables<span class="token punctuation">,</span> use_e2e            <span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token keyword">return</span> story_steps   <span class="token comment" spellcheck="true">## .../rasa/core/training/dsl.py</span> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_from_file</span><span class="token punctuation">(</span>        filename<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Domain<span class="token punctuation">,</span>        interpreter<span class="token punctuation">:</span> NaturalLanguageInterpreter <span class="token operator">=</span> RegexInterpreter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        template_variables<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        use_e2e<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>StoryStep<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Given a md file reads the contained stories."""</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span>io_utils<span class="token punctuation">.</span>DEFAULT_ENCODING<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>            reader <span class="token operator">=</span> StoryFileReader<span class="token punctuation">(</span>                interpreter<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> template_variables<span class="token punctuation">,</span> use_e2e<span class="token punctuation">,</span> filename            <span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span>process_lines<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">## .../rasa/core/training/dsl.py line 221</span>        story_steps <span class="token operator">=</span> <span class="token keyword">await</span> StoryFileReader<span class="token punctuation">.</span>read_from_files<span class="token punctuation">(</span>            self<span class="token punctuation">.</span>_story_files<span class="token punctuation">,</span>            <span class="token keyword">await</span> self<span class="token punctuation">.</span>get_domain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            interpreter<span class="token punctuation">,</span>            template_variables<span class="token punctuation">,</span>            use_e2e<span class="token punctuation">,</span>            exclusion_percentage<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> StoryGraph<span class="token punctuation">(</span>story_steps<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## .../rasa/core/training/structures.py</span><span class="token keyword">class</span> <span class="token class-name">Story</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> story_steps<span class="token punctuation">:</span> List<span class="token punctuation">[</span>StoryStep<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span> story_name<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>story_steps <span class="token operator">=</span> story_steps <span class="token keyword">if</span> story_steps <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>story_name <span class="token operator">=</span> story_name</code></pre><p>è¿™é‡Œçœ‹ä¸‹StoryStepçš„åˆå§‹åŒ–ï¼Œ</p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        block_name<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Text<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        start_checkpoints<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Checkpoint<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        end_checkpoints<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Checkpoint<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        events<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>Event<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span></code></pre><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/15.png"></p><p>å¤„ç†çš„é€»è¾‘ï¼š</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/16.png"></p><p>aï¼ã€€ä»¥##å¼€å¤´ï¼Œ StoryFileReaderçš„current_step_builderæŒ‡å‘æ–°åˆ›å»ºçš„StoryStepBuilderï¼Œè¿™ä¸ªStoryStepBuilderå¯ä»¥å¯¹åº”æ–‡ä»¶ä¸­çš„ä¸€ä¸ªstoryï¼Œå…¶æˆå‘˜å˜é‡</p><pre class=" language-python"><code class="language-python">        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>story_steps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>current_steps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>start_checkpoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">## #ã€€.../rasa/core/training/dsl.py line line 401</span>        <span class="token keyword">def</span> <span class="token function">new_story_part</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">:</span> Text<span class="token punctuation">,</span> source_name<span class="token punctuation">:</span> Text<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_add_current_stories_to_result<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>current_step_builder <span class="token operator">=</span> StoryStepBuilder<span class="token punctuation">(</span>name<span class="token punctuation">,</span> source_name<span class="token punctuation">)</span></code></pre><p>bï¼ã€€ä»¥ä»¥*å¼€å¤´çš„éƒ¨åˆ†ï¼Œå¯¹åº”ç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†ï¼ŒåŠ å…¥åˆ°current_stepsä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä¸ºList[UserUttered]ï¼Œçœ‹ä¸‹UserUtteredçš„æ„é€ å‡½æ•°ï¼Œå…¶æˆå‘˜å¯¹åº”ç”¨æˆ·è¾“å…¥çš„æ„å›¾ï¼Œå®ä½“ç­‰ã€‚</p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        text<span class="token punctuation">,</span>        intent<span class="token operator">=</span>None<span class="token punctuation">,</span>        entities<span class="token operator">=</span>None<span class="token punctuation">,</span>        parse_data<span class="token operator">=</span>None<span class="token punctuation">,</span>        timestamp<span class="token operator">=</span>None<span class="token punctuation">,</span>        input_channel<span class="token operator">=</span>None<span class="token punctuation">,</span>        message_id<span class="token operator">=</span>None<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">##.../rasa/core/training/dsl.py line 354</span>  <span class="token keyword">elif</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment" spellcheck="true"># reached a user message</span>          user_messages <span class="token operator">=</span> <span class="token punctuation">[</span>el<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> el <span class="token keyword">in</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" OR "</span><span class="token punctuation">)</span><span class="token punctuation">]</span>          <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_e2e<span class="token punctuation">:</span>              <span class="token keyword">await</span> self<span class="token punctuation">.</span>add_e2e_messages<span class="token punctuation">(</span>user_messages<span class="token punctuation">,</span> line_num<span class="token punctuation">)</span>               <span class="token keyword">else</span><span class="token punctuation">:</span>                  <span class="token keyword">await</span> self<span class="token punctuation">.</span>add_user_messages<span class="token punctuation">(</span>user_messages<span class="token punctuation">,</span> line_num<span class="token punctuation">)</span></code></pre><p>cï¼ã€€ä»¥-å¼€å¤´çš„éƒ¨åˆ†ï¼Œè¡¨ç¤ºç³»ç»Ÿçš„å“åº”ï¼Œä¼šæ·»åŠ åˆ°StoryStepä¸­çš„eventsï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯List[Event]ã€‚Eventç±»ç”¨æ¥æè¿°å›è¯è¿‡ç¨‹ä¸­å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”¨æ¥é€šçŸ¥<em>DialogueStateTrackeræ¥æ›´æ–°å®ƒçš„çŠ¶æ€ã€‚</em></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ##.../rasa/core/training/dsl.py line 350</span><span class="token keyword">elif</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># reached a slot, event, or executed action</span>    event_name<span class="token punctuation">,</span> parameters <span class="token operator">=</span> self<span class="token punctuation">.</span>_parse_event_line<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>add_event<span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span></code></pre><p><em>dï¼åœ¨</em>extract_story_graphä¸­ï¼Œç”¨story_stepsæ¥æ„é€ StoryGraphå¯¹è±¡ï¼Œç„¶åTrainingDataGeneratoræ¥æ„é€ è®­ç»ƒçš„å†…å­˜æ•°æ®æ ¼å¼ã€‚è¿™å—çš„ä»£ç æ¯”è¾ƒå¤æ‚ã€‚è¿™é‡Œå…ˆç†è§£ï¼šè¿”å›çš„ç»“æœæ˜¯List[â€œDialogueStateTrackerâ€]ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## ../rasa/core/training/__init__.py line 25</span> story_steps <span class="token operator">=</span> <span class="token keyword">await</span> StoryFileReader<span class="token punctuation">.</span>read_from_folder<span class="token punctuation">(</span>        resource_name<span class="token punctuation">,</span>        domain<span class="token punctuation">,</span>        interpreter<span class="token punctuation">,</span>        use_e2e<span class="token operator">=</span>use_e2e<span class="token punctuation">,</span>        exclusion_percentage<span class="token operator">=</span>exclusion_percentage<span class="token punctuation">,</span>    <span class="token punctuation">)</span>    <span class="token keyword">return</span> StoryGraph<span class="token punctuation">(</span>story_steps<span class="token punctuation">)</span></code></pre><ol start="4"><li>è¿›è¡Œè®­ç»ƒ</li></ol><pre class=" language-python"><code class="language-python">  <span class="token comment" spellcheck="true">##è®­ç»ƒèµ·ç¤ºå…¥å£ã€€/rasa/core/policies/ensemble.py  line 124</span>    <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        training_trackers<span class="token punctuation">:</span> List<span class="token punctuation">[</span>DialogueStateTracker<span class="token punctuation">]</span><span class="token punctuation">,</span>        domain<span class="token punctuation">:</span> Domain<span class="token punctuation">,</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        <span class="token keyword">if</span> training_trackers<span class="token punctuation">:</span>            <span class="token keyword">for</span> policy <span class="token keyword">in</span> self<span class="token punctuation">.</span>policies<span class="token punctuation">:</span>                policy<span class="token punctuation">.</span>train<span class="token punctuation">(</span>training_trackers<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#&lt;--------train</span>            training_events <span class="token operator">=</span> self<span class="token punctuation">.</span>_training_events_from_trackers<span class="token punctuation">(</span>training_trackers<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>action_fingerprints <span class="token operator">=</span> self<span class="token punctuation">.</span>_create_action_fingerprints<span class="token punctuation">(</span>training_events<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Skipped training, because there are no training samples."</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>date_trained <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%d-%H%M%S"</span><span class="token punctuation">)</span></code></pre><h2 id="NLUè®­ç»ƒæ¨¡å—çš„è§£è¯»"><a href="#NLUè®­ç»ƒæ¨¡å—çš„è§£è¯»" class="headerlink" title="NLUè®­ç»ƒæ¨¡å—çš„è§£è¯»"></a>NLUè®­ç»ƒæ¨¡å—çš„è§£è¯»</h2><p>å…¥å£æ˜¯rasa.nlu.trainã€‚å¤„ç†é€»è¾‘ï¼š</p><p>åŠ è½½é…ç½®æ–‡ä»¶ï¼ï¼ï¼æ„é€ è®­ç»ƒç»„ä»¶çš„å¯¹è±¡ï¼ï¼ï¼åŠ è½½è®­ç»ƒæ•°æ®ï¼ï¼ï¼æ¯ä¸ªç»„ä»¶ä¾æ¬¡å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œå¤„ç†å’Œè®­ç»ƒï¼ï¼ï¼æ¨¡å‹çš„æŒä¹…åŒ–</p><p>1.åŠ è½½é…ç½®</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## /rasa/train.py line 82</span>file_importer <span class="token operator">=</span> TrainingDataImporter<span class="token punctuation">.</span>load_from_config<span class="token punctuation">(</span>    config<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> training_files<span class="token punctuation">)</span></code></pre><p>è°ƒç”¨config.loadï¼Œå°†é…ç½®æ–‡ä»¶config.ymlçš„æ–‡ä»¶å†…å®¹è¯»å‡ºæ¥ï¼Œå¹¶ä¿å­˜åˆ°RasaNLUModelConfigå¯¹è±¡ä¸­ï¼Œçœ‹ä¸‹è¿™ä¸ªå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/3.png"></p><pre class=" language-python"><code class="language-python">   <span class="token comment" spellcheck="true"># åŠ è½½config.yml #../rasa/nlu/train.py line 69</span>    <span class="token keyword">if</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>nlu_config<span class="token punctuation">,</span> RasaNLUModelConfig<span class="token punctuation">)</span><span class="token punctuation">:</span>        nlu_config <span class="token operator">=</span> config<span class="token punctuation">.</span>load<span class="token punctuation">(</span>nlu_config<span class="token punctuation">)</span></code></pre><ol start="2"><li>æ„é€ è®­ç»ƒç»„ä»¶çš„å¯¹è±¡</li></ol><p>åœ¨Trainerç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œä¸»è¦æ˜¯æ„é€ pipelineï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ®é…ç½®æ–‡ä»¶config.ymlä¸­çš„pipelineä¸­çš„æ¯ä¸ªç±»ï¼Œä¾æ¬¡è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°ã€‚é‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­çš„åç§°å’Œç±»çš„åç§°çš„å¯¹åº”å…³ç³»åœ¨registry.pyä¸­çš„component_classeså˜é‡ä¸­ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># build pipeline  .../rasa/nlu/model.py line 144</span>        self<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> self<span class="token punctuation">.</span>_build_pipeline<span class="token punctuation">(</span>cfg<span class="token punctuation">,</span> component_builder<span class="token punctuation">)</span></code></pre><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">_build_pipeline</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> cfg<span class="token punctuation">:</span> RasaNLUModelConfig<span class="token punctuation">,</span> component_builder<span class="token punctuation">:</span> ComponentBuilder    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Component<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Transform the passed names of the pipeline components into classes."""</span>        pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># Transform the passed names of the pipeline components into classes</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            component_cfg <span class="token operator">=</span> cfg<span class="token punctuation">.</span>for_component<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            component <span class="token operator">=</span> component_builder<span class="token punctuation">.</span>create_component<span class="token punctuation">(</span>component_cfg<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span>            pipeline<span class="token punctuation">.</span>append<span class="token punctuation">(</span>component<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>skip_validation<span class="token punctuation">:</span>            components<span class="token punctuation">.</span>validate_pipeline<span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span>        <span class="token keyword">return</span> pipeline</code></pre><p><strong>é…ç½®æ–‡ä»¶ä¸­çš„åç§°å’Œç±»çš„åç§°çš„å¯¹åº”å…³ç³»åœ¨registry.pyä¸­çš„component_classeså˜é‡</strong></p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/4.png"></p><p>ï¼“ï¼ã€€åŠ è½½è®­ç»ƒæ•°æ®</p><p>load_dataä¼šè¯»å–è®­ç»ƒæ•°æ®ï¼Œéƒ½ä¿å­˜åœ¨TrainingDataå¯¹è±¡ä¸­ï¼Œ</p><p>training_examplesï¼Œå¯¹åº”æ•°æ®ä¸­common_examples</p><p>entity_synonymsï¼Œå¯¹åº”æ•°æ®ä¸­entity_synonymsï¼Œç›®å‰æ ·ä¾‹ä¸ºç©ºã€‚</p><p>regex_featuresï¼Œå¯¹åº”æ•°æ®ä¸­regex_featuresï¼Œç›®å‰æ ·ä¾‹ä¸ºç©º</p><p>lookup_tablesï¼Œç›®å‰æ ·ä¾‹ä¸ºç©º</p><p>åœ¨çœ‹çœ‹æ•°æ®ç»“æ„çš„å®šä¹‰ï¼Œtraining_examplesæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªMessageå¯¹è±¡ã€‚</p><p><img src="/2020/09/19/duo-lun-dui-hua-kuang-jia-rasa-dai-ma-jie-du-xun-lian/6.png"></p><p>åˆ†åˆ«å¯¹åº”Messageå¯¹è±¡ä¸­çš„text ï¼Œdata[â€œintentâ€]ï¼Œdata[â€œentitiesâ€] ï¼Œdataæ˜¯ä¸€ä¸ªå­—å…¸ã€‚</p><p>ï¼”ï¼ã€€æ¯ä¸ªç»„ä»¶ä¾æ¬¡å¯¹è®­ç»ƒæ•°æ®è¿›è¡Œå¤„ç†å’Œè®­ç»ƒ</p><p>trainer.trainï¼Œä¾æ¬¡è°ƒç”¨pipelineæ¯ä¸ªç»„ä»¶çš„é¢„å¤„ç†å‡½æ•°å’Œè®­ç»ƒå‡½æ•°ï¼Œè¿™é‡Œéœ€è¦ç†è§£è¿‡ç¨‹ä¸­è®­ç»ƒçš„ç»“æœä¿å­˜åˆ°å“ªé‡Œï¼Ÿ</p><pre class=" language-python"><code class="language-python"> <span class="token comment" spellcheck="true"># nlu/tain.py  line 90</span>interpreter <span class="token operator">=</span> trainer<span class="token punctuation">.</span>train<span class="token punctuation">(</span>training_data<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ../nul/model.py line 188ã€€ä¸åŒæ–¹æ³•è®­ç»ƒéƒ¨åˆ†</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> component <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">:</span>            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span>f<span class="token string">"Starting to train component &amp;#123;component.name&amp;#125;"</span><span class="token punctuation">)</span>            component<span class="token punctuation">.</span>prepare_partial_processing<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pipeline<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>            updates <span class="token operator">=</span> component<span class="token punctuation">.</span>train<span class="token punctuation">(</span>working_data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>config<span class="token punctuation">,</span> <span class="token operator">**</span>context<span class="token punctuation">)</span>            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Finished training component."</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> updates<span class="token punctuation">:</span>                context<span class="token punctuation">.</span>update<span class="token punctuation">(</span>updates<span class="token punctuation">)</span></code></pre><p>è¿™é‡Œé‡‡ç”¨ä¸€ä¸ªå­—å…¸contextï¼Œåœ¨è®­ç»ƒå¼€å§‹å‰ï¼Œæ¯ä¸ªç»„ä»¶éƒ½é€šè¿‡provide_contextå°†éœ€è¦æä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ›´æ–°åˆ°contextä¸­ï¼Œå¤§éƒ¨åˆ†ç»„ä»¶ä¸éœ€è¦æä¾›é¢„ç½®ä¿¡æ¯ã€‚æ¯”å¦‚<em>MITIE ï¼Œ spacyéœ€è¦</em>æä¾›æ¡†æ¶çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚è¯å‘é‡ã€‚</p><p>ç»„ä»¶JiebaTokenizerçš„è®­ç»ƒï¼šå°†training_examplesä¸­çš„æ¯ä¸ªMessageå¯¹è±¡ä¸­çš„text è¿›è¡Œåˆ†è¯ï¼Œå¹¶å°†åˆ†è¯ç»“æœä¿å­˜åˆ°data[â€œtokensâ€]ä¸­ã€‚</p><p>ç»„ä»¶CRFEntityExtractorçš„è®­ç»ƒï¼Œè¾“å‡ºï¼šä¿å­˜åˆ°data[â€œentitiesâ€]ä¸­ã€‚</p><p>ç»„ä»¶JiebaPsegExtractorï¼Œæ²¡æœ‰å®šä¹‰è®­ç»ƒè¿‡ç¨‹ï¼Œæ— éœ€è®­ç»ƒã€‚</p><p>ç»„ä»¶BertVectorsFeaturizerï¼Œ</p><p>ç»„ä»¶EmbeddingBertIntentClassifierï¼Œ</p><ol start="5"><li>æ¨¡å‹çš„æŒä¹…åŒ–</li></ol><p>å°†æ¨¡å‹çš„è¾“å‡ºæ‰“åŒ…æˆä¸€ä¸ª<em>zipæ–‡ä»¶ï¼Œ</em>fingerprintçš„ä½œç”¨æ˜¯ï¼Œä¿å­˜æ¨¡å‹å’Œè®­ç»ƒæ•°æ®çš„å¯¹åº”å…³ç³»ã€‚å½“è®­ç»ƒæ•°æ®æ²¡æœ‰å˜åŒ–æ—¶ï¼Œfingerprintä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œå°±ä¸ç”¨é‡æ–°è®­ç»ƒã€‚</p><pre class=" language-python"><code class="language-python">   <span class="token comment" spellcheck="true">## æŒä¹…åŒ–ã€€/rasa/nlu/model.pyã€€line 242</span>    <span class="token keyword">def</span> <span class="token function">persist</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span>        path<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>        persistor<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>Persistor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>        fixed_model_name<span class="token punctuation">:</span> Text <span class="token operator">=</span> None<span class="token punctuation">,</span>        persist_nlu_training_data<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Persist all components of the pipeline to the passed path.        Returns the directory of the persisted model."""</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> component <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">:</span>            file_name <span class="token operator">=</span> self<span class="token punctuation">.</span>_file_name<span class="token punctuation">(</span>i<span class="token punctuation">,</span> component<span class="token punctuation">.</span>name<span class="token punctuation">)</span>            update <span class="token operator">=</span> component<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> dir_name<span class="token punctuation">)</span>            component_meta <span class="token operator">=</span> component<span class="token punctuation">.</span>component_config            <span class="token keyword">if</span> update<span class="token punctuation">:</span>                component_meta<span class="token punctuation">.</span>update<span class="token punctuation">(</span>update<span class="token punctuation">)</span>            component_meta<span class="token punctuation">[</span><span class="token string">"class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> utils<span class="token punctuation">.</span>module_path_from_object<span class="token punctuation">(</span>component<span class="token punctuation">)</span>            metadata<span class="token punctuation">[</span><span class="token string">"pipeline"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>component_meta<span class="token punctuation">)</span>        Metadata<span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> dir_name<span class="token punctuation">)</span><span class="token punctuation">.</span>persist<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span>        <span class="token keyword">if</span> persistor <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            persistor<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>dir_name<span class="token punctuation">,</span> model_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># &lt;-----------------</span>        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span>            <span class="token string">"Successfully saved model into '&amp;#123;&amp;#125;'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> dir_name</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rasa </tag>
            
            <tag> QA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšæœºæ£®æ—åŸç†</title>
      <link href="/2020/09/18/sui-ji-sen-lin-yuan-li/"/>
      <url>/2020/09/18/sui-ji-sen-lin-yuan-li/</url>
      
        <content type="html"><![CDATA[<h1 id="éšæœºæ£®æ—åŸç†"><a href="#éšæœºæ£®æ—åŸç†" class="headerlink" title="éšæœºæ£®æ—åŸç†"></a>éšæœºæ£®æ—åŸç†</h1><h2 id="é›†æˆç®—æ³•æ¦‚è¿°"><a href="#é›†æˆç®—æ³•æ¦‚è¿°" class="headerlink" title="é›†æˆç®—æ³•æ¦‚è¿°"></a>é›†æˆç®—æ³•æ¦‚è¿°</h2><p>é›†æˆå­¦ä¹ ï¼ˆensemble learningï¼‰æ˜¯æ—¶ä¸‹éå¸¸æµè¡Œçš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒæœ¬èº«ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œè€Œæ˜¯é€šè¿‡åœ¨æ•°æ®ä¸Šæ„å»ºå¤šä¸ªæ¨¡å‹ï¼Œé›†æˆæ‰€æœ‰æ¨¡å‹çš„å»ºæ¨¡ç»“æœã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„æœºå™¨å­¦ä¹ é¢†åŸŸéƒ½å¯ä»¥çœ‹åˆ°é›†æˆå­¦ä¹ çš„èº«å½±ï¼Œåœ¨ç°å®ä¸­é›†æˆå­¦ä¹ ä¹Ÿæœ‰ç›¸å½“å¤§çš„ä½œç”¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥åšå¸‚åœºè¥é”€æ¨¡æ‹Ÿçš„å»ºæ¨¡ï¼Œç»Ÿè®¡å®¢æˆ·æ¥æºï¼Œä¿ç•™å’Œæµå¤±ï¼Œä¹Ÿå¯ç”¨æ¥é¢„æµ‹ç–¾ç—…çš„é£é™©å’Œç—…æ‚£è€…çš„æ˜“æ„Ÿæ€§ã€‚åœ¨ç°åœ¨çš„å„ç§ç®—æ³•ç«èµ›ä¸­ï¼Œéšæœºæ£®æ—ï¼Œæ¢¯åº¦æå‡æ ‘ï¼ˆGBDTï¼‰ï¼ŒXgboostç­‰é›†æˆç®—æ³•çš„èº«å½±ä¹Ÿéšå¤„å¯è§ï¼Œå¯è§å…¶æ•ˆæœä¹‹å¥½ï¼Œåº”ç”¨ä¹‹å¹¿ã€‚</p><p><strong>é›†æˆç®—æ³•çš„ç›®æ ‡</strong></p><p>é›†æˆç®—æ³•ä¼šè€ƒè™‘å¤šä¸ªè¯„ä¼°å™¨çš„å»ºæ¨¡ç»“æœï¼Œæ±‡æ€»ä¹‹åå¾—åˆ°ä¸€ä¸ªç»¼åˆçš„ç»“æœï¼Œä»¥æ­¤æ¥è·å–æ¯”å•ä¸ªæ¨¡å‹æ›´å¥½çš„å›å½’æˆ–åˆ†ç±»</p><p>å¤šä¸ªæ¨¡å‹é›†æˆæˆä¸ºçš„æ¨¡å‹å«åšé›†æˆè¯„ä¼°å™¨ï¼ˆensemble estimatorï¼‰ï¼Œç»„æˆé›†æˆè¯„ä¼°å™¨çš„æ¯ä¸ªæ¨¡å‹éƒ½å«åšåŸºè¯„ä¼°å™¨base estimatorï¼‰ã€‚é€šå¸¸æ¥è¯´ï¼Œæœ‰ä¸‰ç±»é›†æˆç®—æ³•ï¼šè£…è¢‹æ³•ï¼ˆBaggingï¼‰ï¼Œæå‡æ³•ï¼ˆBoostingï¼‰å’Œstackingã€‚</p><p><img src="/2020/09/18/sui-ji-sen-lin-yuan-li/1.png"></p><p>è£…è¢‹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ„å»ºå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„è¯„ä¼°å™¨,ç„¶åå¯¹å…¶é¢„æµ‹è¿›è¡Œå¹³å‡æˆ–å¤šæ•°è¡¨å†³åŸåˆ™æ¥å†³å®šé›†æˆè¯„ä¼°å™¨çš„ç»“<br>æœã€‚è£…è¢‹æ³•çš„ä»£è¡¨æ¨¡å‹å°±æ˜¯éšæœºæ£®æ—ã€‚</p><p>æå‡æ³•ä¸­,åŸºè¯„ä¼°å™¨æ˜¯ç›¸å…³çš„,æ˜¯æŒ‰é¡ºåºä¸€ä¸€æ„å»ºçš„ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ç»“åˆå¼±è¯„ä¼°å™¨çš„åŠ›é‡ä¸€æ¬¡æ¬¡å¯¹éš¾ä»¥è¯„ä¼°çš„æ ·æœ¬<br>è¿›è¡Œé¢„æµ‹,ä»è€Œæ„æˆä¸€ä¸ªå¼ºè¯„ä¼°å™¨ã€‚æå‡æ³•çš„ä»£è¡¨æ¨¡å‹æœ‰Adaboostå’Œæ¢¯åº¦æå‡æ ‘ã€‚</p><h2 id="sklearnä¸­çš„é›†æˆç®—æ³•"><a href="#sklearnä¸­çš„é›†æˆç®—æ³•" class="headerlink" title="sklearnä¸­çš„é›†æˆç®—æ³•"></a>sklearnä¸­çš„é›†æˆç®—æ³•</h2><table><thead><tr><th>ç±»</th><th>ç±»çš„åŠŸèƒ½</th></tr></thead><tbody><tr><td>ensemble.AdaBoostClassifier</td><td>AdaBooståˆ†ç±»</td></tr><tr><td>ensemble.AdaBoostRegressor</td><td>Adaboostå›å½’</td></tr><tr><td>ensemble.BaggingClassifier</td><td>è£…è¢‹åˆ†ç±»å™¨</td></tr><tr><td>ensemble.BaggingRegressor</td><td>è£…è¢‹å›å½’å™¨</td></tr><tr><td>ensemble.ExtraTreesClassifier</td><td>Extra-treesåˆ†ç±»(è¶…æ ‘,æç«¯éšæœºæ ‘)</td></tr><tr><td>ensemble.ExtraTreesRegressor</td><td>Extra-treeså›å½’</td></tr><tr><td>ensemble.GradientBoostingClassifier</td><td>æ¢¯åº¦æå‡åˆ†ç±»</td></tr><tr><td>ensemble.GradientBoostingRegressor</td><td>æ¢¯åº¦æå‡å›å½’</td></tr><tr><td>ensemble.IsolationForest</td><td>éš”ç¦»æ£®æ—</td></tr><tr><td>ensemble.RandomForestClassifier</td><td>éšæœºæ£®æ—åˆ†ç±»</td></tr><tr><td>ensemble.RandomForestRegressor</td><td>éšæœºæ£®æ—å›å½’</td></tr><tr><td>ensemble.RandomTreesEmbedding</td><td>å®Œå…¨éšæœºæ ‘çš„é›†æˆ</td></tr><tr><td>ensemble.VotingClassifier</td><td>ç”¨äºä¸åˆé€‚ä¼°ç®—å™¨çš„è½¯æŠ•ç¥¨/å¤šæ•°è§„åˆ™åˆ†ç±»å™¨</td></tr></tbody></table><h2 id="RandomForestClassifier"><a href="#RandomForestClassifier" class="headerlink" title="RandomForestClassifier"></a>RandomForestClassifier</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">sklearn</span><span class="token punctuation">.</span>ensemble<span class="token punctuation">.</span>RandomForestClassifier <span class="token punctuation">(</span>n_estimators<span class="token operator">=</span>â€™<span class="token number">10</span>â€™<span class="token punctuation">,</span> criterion<span class="token operator">=</span>â€™giniâ€™<span class="token punctuation">,</span> max_depth<span class="token operator">=</span>None<span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_samples_leaf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> min_weight_fraction_leaf<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> max_features<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">,</span>max_leaf_nodes<span class="token operator">=</span>None<span class="token punctuation">,</span> min_impurity_decrease<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> min_impurity_split<span class="token operator">=</span>None<span class="token punctuation">,</span> bootstrap<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>n_jobs<span class="token operator">=</span>None<span class="token punctuation">,</span> random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> warm_start<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> class_weight<span class="token operator">=</span>None<span class="token punctuation">)</span></code></pre><p>éšæœºæ£®æ—æ˜¯éå¸¸å…·æœ‰ä»£è¡¨æ€§çš„Baggingé›†æˆç®—æ³•,å®ƒçš„æ‰€æœ‰åŸºè¯„ä¼°å™¨éƒ½æ˜¯å†³ç­–æ ‘,åˆ†ç±»æ ‘ç»„æˆçš„æ£®æ—å°±å«åšéšæœºæ£®<br>æ—åˆ†ç±»å™¨,å›å½’æ ‘æ‰€é›†æˆçš„æ£®æ—å°±å«åšéšæœºæ£®æ—å›å½’å™¨ã€‚è¿™ä¸€èŠ‚ä¸»è¦è®²è§£RandomForestClassifier,éšæœºæ£®æ—åˆ†ç±»<br>å™¨ã€‚</p><h3 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h3><h4 id="æ§åˆ¶åŸºè¯„ä¼°å™¨çš„å‚æ•°"><a href="#æ§åˆ¶åŸºè¯„ä¼°å™¨çš„å‚æ•°" class="headerlink" title="æ§åˆ¶åŸºè¯„ä¼°å™¨çš„å‚æ•°"></a>æ§åˆ¶åŸºè¯„ä¼°å™¨çš„å‚æ•°</h4><p>criterion  ä¸çº¯åº¦çš„è¡¡é‡æŒ‡æ ‡,æœ‰åŸºå°¼ç³»æ•°å’Œä¿¡æ¯ç†µä¸¤ç§é€‰æ‹©</p><p>max_depth  æ ‘çš„æœ€å¤§æ·±åº¦,è¶…è¿‡æœ€å¤§æ·±åº¦çš„æ ‘æéƒ½ä¼šè¢«å‰ªæ‰ </p><p>min_samples_leaf ä¸€ä¸ªèŠ‚ç‚¹åœ¨åˆ†æåçš„æ¯ä¸ªå­èŠ‚ç‚¹éƒ½å¿…é¡»åŒ…å«è‡³å°‘min_samples_leafä¸ªè®­ç»ƒæ ·æœ¬,å¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿ</p><p>min_samples_split ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»è¦åŒ…å«è‡³å°‘min_samples_splitä¸ªè®­ç»ƒæ ·æœ¬,è¿™ä¸ªèŠ‚ç‚¹æ‰å…è®¸è¢«åˆ†æ,å¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿ</p><p>max_features  max_featuresé™åˆ¶åˆ†ææ—¶è€ƒè™‘çš„ç‰¹å¾ä¸ªæ•°,è¶…è¿‡é™åˆ¶ä¸ªæ•°çš„ç‰¹å¾éƒ½ä¼šè¢«èˆå¼ƒ,i  é»˜è®¤å€¼ä¸ºæ€»ç‰¹å¾ä¸ªæ•°å¼€å¹³æ–¹å–æ•´</p><p>min_impurity_decrease  é™åˆ¶ä¿¡æ¯å¢ç›Šçš„å¤§å°,ä¿¡æ¯å¢ç›Šå°äºè®¾å®šæ•°å€¼çš„åˆ†æä¸ä¼šå‘ç”Ÿ</p><h3 id="n-estimators"><a href="#n-estimators" class="headerlink" title="n_estimators"></a>n_estimators</h3><p>è¿™æ˜¯æ£®æ—ä¸­æ ‘æœ¨çš„æ•°é‡ï¼Œå³åŸºè¯„ä¼°å™¨çš„æ•°é‡ã€‚è¿™ä¸ªå‚æ•°å¯¹éšæœºæ£®æ—æ¨¡å‹çš„ç²¾ç¡®æ€§å½±å“æ˜¯å•è°ƒçš„ï¼Œ<strong>n_estimators</strong>è¶Š<strong>å¤§ï¼Œæ¨¡å‹çš„æ•ˆæœå¾€å¾€è¶Šå¥½</strong>ã€‚ä½†æ˜¯ç›¸åº”çš„ï¼Œä»»ä½•æ¨¡å‹éƒ½æœ‰å†³ç­–è¾¹ç•Œï¼Œn_estimatorsè¾¾åˆ°ä¸€å®šçš„ç¨‹åº¦ä¹‹åï¼Œéšæœºæ£®æ—çš„ç²¾ç¡®æ€§å¾€å¾€ä¸åœ¨ä¸Šå‡æˆ–å¼€å§‹æ³¢åŠ¨ï¼Œå¹¶ä¸”ï¼Œn_estimatorsè¶Šå¤§ï¼Œéœ€è¦çš„è®¡ç®—é‡å’Œå†…å­˜ä¹Ÿè¶Šå¤§ï¼Œè®­ç»ƒçš„æ—¶é—´ä¹Ÿä¼šè¶Šæ¥è¶Šé•¿ã€‚å¯¹äºè¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ˜¯æ¸´æœ›åœ¨è®­ç»ƒéš¾åº¦å’Œæ¨¡å‹æ•ˆæœä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><p>n_estimatorsçš„é»˜è®¤å€¼åœ¨ç°æœ‰ç‰ˆæœ¬çš„sklearnä¸­æ˜¯10ï¼Œä½†æ˜¯åœ¨å³å°†æ›´æ–°çš„0.22ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªé»˜è®¤å€¼ä¼šè¢«ä¿®æ­£ä¸º100ã€‚è¿™ä¸ªä¿®æ­£æ˜¾ç¤ºå‡ºäº†ä½¿ç”¨è€…çš„è°ƒå‚å€¾å‘ï¼šè¦æ›´å¤§çš„n_estimatorsã€‚</p><h3 id="random-state"><a href="#random-state" class="headerlink" title="random_state"></a><strong>random_state</strong></h3><p>éšæœºæ£®æ—çš„æœ¬è´¨æ˜¯ä¸€ç§è£…è¢‹é›†æˆç®—æ³•ï¼ˆbaggingï¼‰ï¼Œè£…è¢‹é›†æˆç®—æ³•æ˜¯å¯¹åŸºè¯„ä¼°å™¨çš„é¢„æµ‹ç»“æœè¿›è¡Œå¹³å‡æˆ–ç”¨å¤šæ•°è¡¨å†³åŸåˆ™æ¥å†³å®šé›†æˆè¯„ä¼°å™¨çš„ç»“æœã€‚åœ¨åˆšæ‰çš„çº¢é…’ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å»ºç«‹äº†25æ£µæ ‘ï¼Œå¯¹ä»»ä½•ä¸€ä¸ªæ ·æœ¬è€Œè¨€ï¼Œå¹³å‡æˆ–å¤šæ•°è¡¨å†³åŸåˆ™ä¸‹ï¼Œå½“ä¸”ä»…å½“æœ‰13æ£µä»¥ä¸Šçš„æ ‘åˆ¤æ–­é”™è¯¯çš„æ—¶å€™ï¼Œéšæœºæ£®æ—æ‰ä¼šåˆ¤æ–­é”™è¯¯ã€‚</p><h3 id="bootstrap-amp-oob-score"><a href="#bootstrap-amp-oob-score" class="headerlink" title="bootstrap &amp; oob_score"></a><strong>bootstrap &amp; oob_score</strong></h3><p>â€‹       è¦è®©åŸºåˆ†ç±»å™¨å°½é‡éƒ½ä¸ä¸€æ ·ï¼Œä¸€ç§å¾ˆå®¹æ˜“ç†è§£çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸åŒçš„è®­ç»ƒé›†æ¥è¿›è¡Œè®­ç»ƒï¼Œè€Œè¢‹è£…æ³•æ­£æ˜¯é€šè¿‡æœ‰æ”¾å›çš„éšæœºæŠ½æ ·æŠ€æœ¯æ¥å½¢æˆä¸åŒçš„è®­ç»ƒæ•°æ®ï¼Œbootstrapå°±æ˜¯ç”¨æ¥æ§åˆ¶æŠ½æ ·æŠ€æœ¯çš„å‚æ•°ã€‚åœ¨ä¸€ä¸ªå«æœ‰nä¸ªæ ·æœ¬çš„åŸå§‹è®­ç»ƒé›†ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œéšæœºé‡‡æ ·ï¼Œæ¯æ¬¡é‡‡æ ·ä¸€ä¸ªæ ·æœ¬ï¼Œå¹¶åœ¨æŠ½å–ä¸‹ä¸€ä¸ªæ ·æœ¬ä¹‹å‰å°†è¯¥æ ·æœ¬æ”¾å›åŸå§‹è®­ç»ƒé›†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹æ¬¡é‡‡æ ·æ—¶è¿™ä¸ªæ ·æœ¬ä¾ç„¶å¯èƒ½è¢«é‡‡é›†åˆ°ï¼Œè¿™æ ·é‡‡é›†næ¬¡ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå’ŒåŸå§‹è®­ç»ƒé›†ä¸€æ ·å¤§çš„ï¼Œnä¸ªæ ·æœ¬ç»„æˆçš„è‡ªåŠ©é›†ã€‚ç”±äºæ˜¯éšæœºé‡‡æ ·ï¼Œè¿™æ ·æ¯æ¬¡çš„è‡ªåŠ©é›†å’ŒåŸå§‹æ•°æ®é›†ä¸åŒï¼Œå’Œå…¶ä»–çš„é‡‡æ ·é›†ä¹Ÿæ˜¯ä¸åŒçš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è‡ªç”±åˆ›é€ å–ä¹‹ä¸å°½ç”¨ä¹‹ä¸ç«­ï¼Œå¹¶ä¸”äº’ä¸ç›¸åŒçš„è‡ªåŠ©é›†ï¼Œç”¨è¿™äº›è‡ªåŠ©é›†æ¥è®­ç»ƒæˆ‘ä»¬çš„åŸºåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬çš„åŸºåˆ†ç±»å™¨è‡ªç„¶ä¹Ÿå°±å„ä¸ç›¸åŒäº†ã€‚</p><p>â€‹         <strong>bootstrap</strong>å‚æ•°é»˜è®¤<strong>True</strong>ï¼Œä»£è¡¨é‡‡ç”¨è¿™ç§æœ‰æ”¾å›çš„éšæœºæŠ½æ ·æŠ€æœ¯ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå‚æ•°ä¸ä¼šè¢«æˆ‘ä»¬è®¾ç½®ä¸ºFalseã€‚</p><p>â€‹         å½“nè¶³å¤Ÿå¤§æ—¶ï¼Œè¿™ä¸ªæ¦‚ç‡æ”¶æ•›äº1-(1/e)ï¼Œçº¦ç­‰äº0.632ã€‚å› æ­¤ï¼Œä¼šæœ‰çº¦37%çš„è®­ç»ƒæ•°æ®è¢«æµªè´¹æ‰ï¼Œæ²¡æœ‰å‚ä¸å»ºæ¨¡ï¼Œè¿™äº›æ•°æ®è¢«ç§°ä¸ºè¢‹å¤–æ•°æ®(out of bag dataï¼Œç®€å†™ä¸ºoob)ã€‚é™¤äº†æˆ‘ä»¬æœ€å¼€å§‹å°±åˆ’åˆ†å¥½çš„æµ‹è¯•é›†ä¹‹å¤–ï¼Œè¿™äº›æ•°æ®ä¹Ÿå¯ä»¥è¢«ç”¨æ¥ä½œä¸ºé›†æˆç®—æ³•çš„æµ‹è¯•é›†ã€‚<strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨éšæœºæ£®æ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸åˆ’åˆ†æµ‹è¯•é›†å’Œè®­ç»ƒé›†ï¼Œåªéœ€è¦ç”¨è¢‹å¤–æ•°æ®æ¥æµ‹è¯•æˆ‘ä»¬çš„æ¨¡å‹å³å¯ã€‚</strong>å½“ç„¶ï¼Œè¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œå½“nå’Œn_estimatorséƒ½ä¸å¤Ÿå¤§çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½å°±æ²¡æœ‰æ•°æ®æ‰è½åœ¨è¢‹å¤–ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•ä½¿ç”¨oobæ•°æ®æ¥æµ‹è¯•æ¨¡å‹äº†ã€‚</p><h3 id="é‡è¦å±æ€§å’Œæ¥å£"><a href="#é‡è¦å±æ€§å’Œæ¥å£" class="headerlink" title="é‡è¦å±æ€§å’Œæ¥å£"></a><strong>é‡è¦å±æ€§å’Œæ¥å£</strong></h3><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»è®²å®Œäº†æ‰€æœ‰éšæœºæ£®æ—ä¸­çš„é‡è¦å‚æ•°ï¼Œä¸ºå¤§å®¶å¤ä¹ äº†ä¸€ä¸‹å†³ç­–æ ‘çš„å‚æ•°ï¼Œå¹¶é€šè¿‡n_estimatorsï¼Œrandom_stateï¼Œboostrapå’Œoob_scoreè¿™å››ä¸ªå‚æ•°å¸®åŠ©å¤§å®¶äº†è§£äº†è¢‹è£…æ³•çš„åŸºæœ¬æµç¨‹å’Œé‡è¦æ¦‚å¿µã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†**.estimators_** å’Œ <strong>.oob_score_</strong> è¿™ä¸¤ä¸ªé‡è¦å±æ€§ã€‚é™¤äº†è¿™ä¸¤ä¸ªå±æ€§ä¹‹å¤–ï¼Œä½œä¸ºæ ‘æ¨¡å‹çš„é›†æˆç®—æ³•ï¼Œéšæœºæ£®æ—è‡ªç„¶ä¹Ÿæœ‰**.feature_importances_**è¿™ä¸ªå±æ€§ã€‚</p><p>éšæœºæ£®æ—çš„æ¥å£ä¸å†³ç­–æ ‘å®Œå…¨ä¸€è‡´ï¼Œå› æ­¤ä¾ç„¶æœ‰å››ä¸ªå¸¸ç”¨æ¥å£ï¼š<strong>apply, ï¬t, predict</strong>å’Œ<strong>score</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„éšæœºæ£®æ—çš„predict_probaæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›æ¯ä¸ªæµ‹è¯•æ ·æœ¬å¯¹åº”çš„è¢«åˆ†åˆ°æ¯ä¸€ç±»æ ‡ç­¾çš„æ¦‚ç‡ï¼Œæ ‡ç­¾æœ‰å‡ ä¸ªåˆ†ç±»å°±è¿”å›å‡ ä¸ªæ¦‚ç‡ã€‚å¦‚æœæ˜¯äºŒåˆ†ç±»é—®é¢˜ï¼Œåˆ™predict_probaè¿”å›çš„æ•°å€¼å¤§äº0.5çš„ï¼Œè¢«åˆ†ä¸º1ï¼Œå°äº0.5çš„ï¼Œè¢«åˆ†ä¸º0ã€‚ä¼ ç»Ÿçš„éšæœºæ£®æ—æ˜¯åˆ©ç”¨è¢‹è£…æ³•ä¸­çš„è§„åˆ™ï¼Œå¹³å‡æˆ–å°‘æ•°æœä»å¤šæ•°æ¥å†³å®šé›†æˆçš„ç»“æœï¼Œè€Œsklearnä¸­çš„éšæœºæ£®æ—æ˜¯å¹³å‡æ¯ä¸ªæ ·æœ¬å¯¹åº”çš„predict_probaè¿”å›çš„æ¦‚ç‡ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡æ¦‚ç‡ï¼Œä»è€Œå†³å®šæµ‹è¯•æ ·æœ¬çš„åˆ†ç±»ã€‚</p><h2 id="RandomForestRegressor"><a href="#RandomForestRegressor" class="headerlink" title="RandomForestRegressor"></a><strong>RandomForestRegressor</strong></h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">sklearn</span><span class="token punctuation">.</span>ensemble<span class="token punctuation">.</span>RandomForestRegressor  <span class="token punctuation">(</span>n_estimators<span class="token operator">=</span>â€™warnâ€™<span class="token punctuation">,</span> criterion<span class="token operator">=</span>â€™mseâ€™<span class="token punctuation">,</span> max_depth<span class="token operator">=</span>None<span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_samples_leaf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> min_weight_fraction_leaf<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> max_features<span class="token operator">=</span>â€™autoâ€™<span class="token punctuation">,</span>max_leaf_nodes<span class="token operator">=</span>None<span class="token punctuation">,</span> min_impurity_decrease<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> min_impurity_split<span class="token operator">=</span>None<span class="token punctuation">,</span> bootstrap<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>n_jobs<span class="token operator">=</span>None<span class="token punctuation">,</span> random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> warm_start<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><h2 id="é‡è¦å‚æ•°-å±æ€§ä¸æ¥å£"><a href="#é‡è¦å‚æ•°-å±æ€§ä¸æ¥å£" class="headerlink" title="é‡è¦å‚æ•°,å±æ€§ä¸æ¥å£"></a>é‡è¦å‚æ•°,å±æ€§ä¸æ¥å£</h2><p>åŸºæœ¬ä¸å†³ç­–æ ‘ä¸€è‡´ï¼š<a href="/2020/09/17/jue-ce-shu-yuan-li/" title="å†³ç­–æ ‘åŸç†">å†³ç­–æ ‘åŸç†</a></p><p>ã€€ã€€æœ€é‡è¦çš„å±æ€§å’Œæ¥å£,éƒ½ä¸éšæœºæ£®æ—çš„åˆ†ç±»å™¨ç›¸ä¸€è‡´,è¿˜æ˜¯apply, fit, predictå’Œscoreæœ€ä¸ºæ ¸å¿ƒã€‚å€¼å¾—ä¸€æçš„æ˜¯,éšæœºæ£®æ—å›å½’å¹¶æ²¡æœ‰predict_probaè¿™ä¸ªæ¥å£,å› ä¸ºå¯¹äºå›å½’æ¥è¯´,å¹¶ä¸å­˜åœ¨ä¸€ä¸ªæ ·æœ¬è¦è¢«åˆ†åˆ°æŸä¸ªç±»åˆ«çš„æ¦‚ç‡é—®<br>é¢˜,å› æ­¤æ²¡æœ‰predict_probaè¿™ä¸ªæ¥å£ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‘æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>word2vecå®æˆ˜ï¼šè·å–å’Œé¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘(Wikipedia)è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹</title>
      <link href="/2020/09/18/word2vec-shi-zhan-huo-qu-he-yu-chu-li-zhong-wen-wei-ji-bai-ke-wikipedia-yu-liao-ku-bing-xun-lian-cheng-word2vec-mo-xing/"/>
      <url>/2020/09/18/word2vec-shi-zhan-huo-qu-he-yu-chu-li-zhong-wen-wei-ji-bai-ke-wikipedia-yu-liao-ku-bing-xun-lian-cheng-word2vec-mo-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="word2vecå®æˆ˜ï¼šè·å–å’Œé¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘-Wikipedia-è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹"><a href="#word2vecå®æˆ˜ï¼šè·å–å’Œé¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘-Wikipedia-è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹" class="headerlink" title="word2vecå®æˆ˜ï¼šè·å–å’Œé¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘(Wikipedia)è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹"></a>word2vecå®æˆ˜ï¼šè·å–å’Œé¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘(Wikipedia)è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹</h1><p>è½¬è½½ï¼š<a href="https://blog.csdn.net/qq_32166627/article/details/68942216">https://blog.csdn.net/qq_32166627/article/details/68942216</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è‡ªç„¶è¯­è¨€å¤„ç†æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæœ€è¿‘å¾ˆæµè¡Œçš„æ˜¯è°·æ­Œå¼€æºé¡¹ç›®word2vecï¼Œè¯¦è§è°·æ­Œå®˜ç½‘ï¼š<a href="https://code.google.com/archive/p/word2vec/">å®˜ç½‘é“¾æ¥</a>ã€‚å…¶ä¸»è¦ç†è®ºç”±Tomas Mikolovå¤§ç¥å›¢é˜Ÿçš„2ç¯‡è®ºæ–‡ç»„æˆï¼š<a href="https://arxiv.org/pdf/1301.3781.pdf">Efficient Estimation of Word Representations in Vector Space</a>ï¼Œ <a href="https://arxiv.org/pdf/1310.4546.pdf">Distributed Representations of Words and Phrases and their Compositionality</a>ã€‚</p><p>ä¼ ç»Ÿçš„æ–¹æ³•æ˜¯å°†è¯æ±‡ä½œä¸ºç¦»æ•£çš„å•ä¸€ç¬¦å·ï¼Œè¿™äº›ç¬¦å·ç¼–ç æ¯«æ— è§„åˆ™ï¼Œæ— æ³•æä¾›è¯æ±‡ä¹‹é—´å¯èƒ½å­˜åœ¨çš„å…³è”å…³ç³»ï¼Œè€Œè¯æ±‡çš„å‘é‡è¡¨ç¤ºå°†å…‹æœä¸Šè¿°éš¾é¢˜ã€‚</p><p>å‘é‡ç©ºé—´æ¨¡å‹ï¼ˆVSMï¼‰å°†è¯æ±‡è¡¨ç¤ºåœ¨ä¸€ä¸ªè¿ç»­çš„å‘é‡ç©ºé—´ä¸­ï¼Œè¯­ä¹‰è¿‘ä¼¼çš„è¯è¢«æ˜ å°„ä¸ºç›¸é‚»çš„æ•°æ®ç‚¹ã€‚VSMä¾èµ–äºåˆ†å¸ƒå¼å‡è®¾æ€æƒ³ï¼Œè¯¥æ€æƒ³çš„æ ¸å¿ƒæ˜¯ï¼šå‡ºç°äºç›¸åŒçš„ä¸Šä¸‹æ–‡æƒ…æ™¯ä¸­çš„è¯æ±‡éƒ½æœ‰ç›¸ä¼¼çš„è¯­ä¹‰ã€‚</p><p>åŸºäºVSMå‡è®¾æœ‰2ç§ç ”ç©¶æ–¹æ³•ï¼š<br>1ï¼ŒåŸºäºè®¡æ•°çš„æ–¹æ³•ï¼šè®¡ç®—æŸè¯æ±‡æå…¶ä¸´è¿‘è¯åœ¨ä¸€ä¸ªå¤§å‹è¯­æ–™åº“ä¸­å…±åŒå‡ºç°çš„é¢‘ç‡ï¼Œç„¶åå°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªå°è€Œç¨ å¯†çš„å‘é‡ä¸­ã€‚<br>2ï¼Œé¢„æµ‹æ–¹æ³•ï¼šè¯¥æ–¹æ³•è¯•å›¾ç›´æ¥ä»æŸè¯æ±‡çš„ä¸´è¿‘è¯å¯¹å…¶è¿›è¡Œé¢„æµ‹ï¼Œæ­¤è¿‡ç¨‹åˆ©ç”¨å­¦ä¹ åˆ°çš„å‘é‡ã€‚</p><p>word2vecæ˜¯ä¸€ç§å¯ä»¥è¿›è¡Œé«˜æ•ˆç‡è¯åµŒå¥—å­¦ä¹ çš„é¢„æµ‹æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æœ‰2ç§å…·ä½“çš„å½¢å¼ï¼š<br>1ï¼ŒCBOWæ¨¡å‹ï¼šæ ¹æ®ä¸Šä¸‹æ–‡è¯æ±‡â€œthe cat sits on theâ€ï¼Œæ¥é¢„æµ‹ç›®æ ‡è¯â€œmatâ€ã€‚<br>2ï¼Œskip-gramæ¨¡å‹ï¼šé€šè¿‡ç›®æ ‡è¯æ¥é¢„æµ‹æºè¯æ±‡ã€‚</p><p>æœ¬æ–‡ä¸å…³æ³¨å…·ä½“ç†è®ºï¼Œè€Œæ˜¯è¯¦ç»†ä»‹ç»å¦‚ä½•è·å–å¹¶é¢„å¤„ç†ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™åº“ï¼Œå¹¶è®­ç»ƒæˆword2vecæ¨¡å‹ã€‚</p><p>å®éªŒç¯å¢ƒï¼šUbuntu14.04/Python2.7ï¼ˆAnacondaç‰ˆï¼‰</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>1ï¼Œä¸‹è½½åŸå§‹æ•°æ®<br>æ•°æ®ä¸‹è½½åœ°å€ï¼š<a href="https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2">https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2</a></p><p>ä¸‹è½½çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªå¤§å°ä¸º1.3Gçš„å‹ç¼©åŒ…ï¼Œè§£å‹åæ˜¯ä¸ª5.8Gå·¦å³çš„xmlæ–‡ä»¶ï¼Œå†…å®¹æ˜¯ç½‘é¡µæ ‡ç­¾å½¢å¼çš„ã€‚æˆ‘ä»¬éœ€è¦æŠ½å–å‡ºå…¶ä¸­çš„æœ‰æ•ˆä¿¡æ¯ã€‚</p><p>2ï¼Œä½¿ç”¨Wikipedia ExtractoræŠ½å–æ­£æ–‡<br>Wikipedia Extractoræ˜¯æ„å¤§åˆ©äººç”¨Pythonå†™çš„ä¸€ä¸ªç»´åŸºç™¾ç§‘æŠ½å–å™¨ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚ä¸‹è½½ä¹‹åç›´æ¥ä½¿ç”¨è¿™æ¡å‘½ä»¤å³å¯å®ŒæˆæŠ½å–ï¼Œè¿è¡Œæ—¶é—´å¾ˆå¿«ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><pre class=" language-shell"><code class="language-shell">$ sudo apt-get install unzip python python-dev python-pip$ git clone https://github.com/attardi/wikiextractor.git wikiextractor$ cd wikiextractor$ sudo python setup.py install$ ./WikiExtractor.py -b 1024M -o extracted zhwiki-latest-pages-articles.xml.bz2</code></pre><p>å‚æ•°-b 1024Mè¡¨ç¤ºä»¥1024Mä¸ºå•ä½åˆ‡åˆ†æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯1Mã€‚ç”±äºæœ€åç”Ÿæˆçš„æ­£æ–‡æ–‡æœ¬çº¦1060Mï¼ŒæŠŠå‚æ•°è®¾ç½®çš„å¤§ä¸€äº›å¯ä»¥ä¿è¯æœ€åçš„æŠ½å–ç»“æœå…¨éƒ¨å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚è¿™é‡Œæˆ‘ä»¬è®¾ä¸º1024Mï¼Œå¯ä»¥åˆ†æˆä¸€ä¸ª1Gçš„å¤§æ–‡ä»¶å’Œä¸€ä¸ª36Mçš„å°æ–‡ä»¶ï¼Œåç»­çš„æ­¥éª¤å¯ä»¥å…ˆåœ¨å°æ–‡ä»¶ä¸Šå®éªŒï¼Œå†åº”ç”¨åˆ°å¤§æ–‡ä»¶ä¸Šã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¾—åˆ°äº†2ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼šwiki_00, wiki_01ã€‚å¤§å°åˆ†åˆ«ä¸ºï¼š1024M, 36.7Mã€‚</p><p>3ï¼Œç¹ä½“è½¬ç®€ä½“<br>ç»´åŸºç™¾ç§‘çš„ä¸­æ–‡æ•°æ®æ˜¯ç¹ç®€æ··æ‚çš„ï¼Œé‡Œé¢åŒ…å«å¤§é™†ç®€ä½“ã€å°æ¹¾ç¹ä½“ã€æ¸¯æ¾³ç¹ä½“ç­‰å¤šç§ä¸åŒçš„æ•°æ®ã€‚æœ‰æ—¶å€™åœ¨ä¸€ç¯‡æ–‡ç« çš„ä¸åŒæ®µè½é—´ä¹Ÿä¼šä½¿ç”¨ä¸åŒçš„ç¹ç®€å­—ã€‚</p><p>ä¸ºäº†å¤„ç†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº†å¼€æºé¡¹ç›®openccã€‚å‚ç…§å®‰è£…è¯´æ˜çš„æ–¹æ³•ï¼Œå®‰è£…å®Œæˆä¹‹åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç¹ç®€è½¬æ¢ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¹Ÿå¾ˆå¿«ï¼š</p><pre class=" language-shell"><code class="language-shell">$ sudo apt-get install opencc$ opencc -i wiki_00 -o zh_wiki_00 -c zht2zhs.ini$ opencc -i wiki_01 -o zh_wiki_01 -c zht2zhs.ini</code></pre><p>å‘½ä»¤ä¸­çš„wiki_00/wiki_01è¿™ä¸ªæ–‡ä»¶æ˜¯æ­¤å‰ä½¿ç”¨Wikipedia Extractorå¾—åˆ°çš„ã€‚åˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å¤§éƒ¨åˆ†ç¹ç®€è½¬æ¢å·¥ä½œã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¾—åˆ°äº†2ä¸ªç®€ä½“æ–‡ä»¶ï¼šzh_wiki_00ï¼Œzh_wiki_01ã€‚å¤§å°åˆ†åˆ«ä¸ºï¼š1024Mï¼Œ36.7Mã€‚åŒä¸Šæ­¥ç»“æœå¤§å°ä¸å˜ã€‚</p><p>4ï¼Œç¬¦å·å¤„ç†<br>ç”±äºWikipedia ExtractoræŠ½å–æ­£æ–‡æ—¶ï¼Œä¼šå°†æœ‰ç‰¹æ®Šæ ‡è®°çš„å¤–æ–‡ç›´æ¥å‰”é™¤ã€‚æˆ‘ä»¬æœ€åå†å°†ã€Œã€ã€ã€è¿™äº›ç¬¦å·æ›¿æ¢æˆå¼•å·ï¼Œé¡ºä¾¿åˆ é™¤ç©ºæ‹¬å·ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼ä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> re<span class="token keyword">import</span> sys<span class="token keyword">import</span> codecs<span class="token keyword">def</span> <span class="token function">myfun</span><span class="token punctuation">(</span>input_file<span class="token punctuation">)</span><span class="token punctuation">:</span>    p1 <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>ur<span class="token string">'-\&amp;#123;.*?(zh-hans|zh-cn):([^;]*?)(;.*?)?\&amp;#125;-'</span><span class="token punctuation">)</span>    p2 <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>ur<span class="token string">'[ï¼ˆ\(][ï¼Œï¼›ã€‚ï¼Ÿï¼\s]*[ï¼‰\)]'</span><span class="token punctuation">)</span>    p3 <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>ur<span class="token string">'[ã€Œã€]'</span><span class="token punctuation">)</span>    p4 <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>ur<span class="token string">'[ã€ã€]'</span><span class="token punctuation">)</span>    outfile <span class="token operator">=</span> codecs<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'std_'</span> <span class="token operator">+</span> input_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> codecs<span class="token punctuation">.</span>open<span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> myfile<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> myfile<span class="token punctuation">:</span>            line <span class="token operator">=</span> p1<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>ur<span class="token string">'\2'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>            line <span class="token operator">=</span> p2<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>ur<span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>            line <span class="token operator">=</span> p3<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>ur<span class="token string">'â€œ'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>            line <span class="token operator">=</span> p4<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>ur<span class="token string">'â€'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>            outfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>    outfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"Usage: python script.py inputfile"</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>    reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    input_file <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    myfun<span class="token punctuation">(</span>input_file<span class="token punctuation">)</span></code></pre><p>å°†ä¸Šè¿°ä»£ç ä¿å­˜åˆ°exec.pyæ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶æ”¾åˆ°ä¸æ•°æ®æ–‡ä»¶ç›¸åŒçš„ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><pre class=" language-shell"><code class="language-shell">$ python exec.py zh_wiki_00$ python exec.py zh_wiki_01</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆå¾—åˆ°2ä¸ªæ ¼å¼åŒ–æ–‡ä»¶ï¼šstd_zh_wiki_00ï¼Œstd_zh_wiki_01ã€‚å¤§å°åˆ†åˆ«ä¸ºï¼š1021Mï¼Œ36.6Mã€‚å¤§å°æ¯”ä¹‹å‰çš„æ–‡ä»¶è¦å°ï¼Œå› ä¸ºä¿®æ”¹åˆ é™¤äº†æ–‡ä»¶ä¸­çš„ç¬¦å·ã€‚</p><p>5ï¼Œä¸­æ–‡åˆ†è¯<br>ä¸­æ–‡åˆ†è¯å·¥å…·æœ‰å¾ˆå¤šç§ï¼Œ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨pythonç‰ˆæœ¬çš„ç»“å·´åˆ†è¯ï¼š<a href="https://github.com/fxsjy/jieba">https://github.com/fxsjy/jieba</a></p><p>å®‰è£…å¾ˆç®€å•ï¼š$ pip install jieba</p><p>å®‰è£…å¥½åæ‰§è¡Œå‘½ä»¤è¿›è¡Œåˆ†è¯ï¼š</p><pre class=" language-shell"><code class="language-shell">python -m jieba -d " " ./std_zh_wiki_00 > ./cut_std_zh_wiki_00python -m jieba -d " " ./std_zh_wiki_01 > ./cut_std_zh_wiki_01</code></pre><p>å‘½ä»¤ä¸­çš„-d â€ â€œé€‰é¡¹ï¼ŒåŒå¼•å·ä¸­æ˜¯ä¸€ä¸ªç©ºæ ¼ï¼ŒæŒ‡çš„æ˜¯ä»¥ç©ºæ ¼åˆ†å‰²è¯æ±‡ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆå¾—åˆ°2ä¸ªåˆ†è¯æ–‡ä»¶ï¼šcut_std_zh_wiki_00ï¼Œcut_std_zh_wiki_01ã€‚å¤§å°åˆ†åˆ«ä¸ºï¼š1.21Gï¼Œ44.6Mã€‚æ¯”ä¹‹å‰çš„æ–‡ä»¶è¦å¤§ï¼Œå› ä¸ºæ–‡ä»¶ä¸­åŠ å…¥äº†å¾ˆå¤šç©ºæ ¼ç¬¦ã€‚</p><p>6ï¼Œè®­ç»ƒword2vecæ¨¡å‹<br>è®­ç»ƒæ¨¡å‹æˆ‘ä»¬ä½¿ç”¨pythonçš„gensimåº“æä¾›çš„æ–¹æ³•ï¼Œ<a href="https://radimrehurek.com/gensim/">gensimå®˜ç½‘</a>ã€‚</p><p>å®‰è£…éå¸¸ç®€å•ï¼š$ pip install gensim</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨1.21Gçš„å¤§æ–‡ä»¶è¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒä»£ç ä¹Ÿå¾ˆç®€å•ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> word2vec<span class="token keyword">import</span> logginglogging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>format<span class="token operator">=</span><span class="token string">'%(asctime)s : %(levelname)s : %(message)s'</span><span class="token punctuation">,</span> level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>sentences <span class="token operator">=</span> word2vec<span class="token punctuation">.</span>LineSentence<span class="token punctuation">(</span>u<span class="token string">'./cut_std_zh_wiki_00'</span><span class="token punctuation">)</span>model <span class="token operator">=</span> word2vec<span class="token punctuation">.</span>Word2Vec<span class="token punctuation">(</span>sentences<span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>window<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>min_count<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./word2vecModel/WikiCHModel'</span><span class="token punctuation">)</span></code></pre><p>è®­ç»ƒçš„è¿‡ç¨‹è¿›åº¦ä¼šæ‰“å°åœ¨æ§åˆ¶å°ã€‚è®­ç»ƒç»“æŸåæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªword2vecæ¨¡å‹ã€‚</p><p>7ï¼Œè°ƒç”¨å¹¶æµ‹è¯•word2vecæ¨¡å‹<br>è°ƒç”¨æ¨¡å‹ä¹Ÿå¾ˆç®€å•ï¼ŒåŒæ ·ä½¿ç”¨gensimåº“ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models <span class="token keyword">import</span> word2vecmodel <span class="token operator">=</span> word2vec<span class="token punctuation">.</span>Word2Vec<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'./word2vecModel/WikiCHModel'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>similarity<span class="token punctuation">(</span><span class="token string">'å¥¥è¿ä¼š'</span><span class="token punctuation">,</span><span class="token string">'é‡‘ç‰Œ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#ä¸¤ä¸ªè¯çš„ç›¸å…³æ€§</span><span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>most_similar<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ä¼¦æ•¦'</span><span class="token punctuation">,</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'åŒ—äº¬'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># åŒ—äº¬is toä¸­å›½ as ä¼¦æ•¦is toï¼Ÿ</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯­è¨€æ¨¡å‹ </tag>
            
            <tag> è¯å‘é‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rasaä½¿ç”¨æŒ‡å—</title>
      <link href="/2020/09/18/rasa-shi-yong-zhi-nan/"/>
      <url>/2020/09/18/rasa-shi-yong-zhi-nan/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½ï¼š<a href="https://www.jianshu.com/u/fd743bd5ad2d">https://www.jianshu.com/u/fd743bd5ad2d</a></p><h1 id="Rasa"><a href="#Rasa" class="headerlink" title="Rasa"></a>Rasa</h1><p><code>Rasa</code>æ˜¯ä¸€ä¸ªå¼€æºæœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œç”¨äºæ„å»ºä¸Šä¸‹æ–‡AIåŠ©æ‰‹å’ŒèŠå¤©æœºå™¨äººã€‚<br> Rasaæœ‰ä¸¤ä¸ªä¸»è¦æ¨¡å—ï¼š</p><ul><li><code>Rasa NLU</code> ï¼šç”¨äºç†è§£ç”¨æˆ·æ¶ˆæ¯ï¼ŒåŒ…æ‹¬æ„å›¾è¯†åˆ«å’Œå®ä½“è¯†åˆ«ï¼Œå®ƒä¼šæŠŠç”¨æˆ·çš„è¾“å…¥è½¬æ¢ä¸ºç»“æ„åŒ–çš„æ•°æ®ã€‚</li><li><code>Rasa Core</code>ï¼šæ˜¯ä¸€ä¸ªå¯¹è¯ç®¡ç†å¹³å°ï¼Œç”¨äºä¸¾è¡Œå¯¹è¯å’Œå†³å®šä¸‹ä¸€æ­¥åšä»€ä¹ˆã€‚</li></ul><p><code>Rasa X</code>æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯å¸®åŠ©æ‚¨æ„å»ºã€æ”¹è¿›å’Œéƒ¨ç½²ç”±Rasaæ¡†æ¶æä¾›æ”¯æŒçš„AI Assistantsã€‚ Rasa XåŒ…æ‹¬ç”¨æˆ·ç•Œé¢å’ŒREST APIã€‚</p><p><strong>Rasaå®˜æ–¹æ–‡æ¡£</strong>ï¼š <a href="https://links.jianshu.com/go?to=https://rasa.com/docs/rasa/">Build contextual chatbots and AI assistants with Rasa</a></p><p><strong>githubåœ°å€</strong>ï¼š<a href="https://links.jianshu.com/go?to=https://github.com/RasaHQ/rasa">RasaHQ/rasa</a></p><p><strong>pipå®‰è£…</strong></p><pre class=" language-shell"><code class="language-shell">pip install rasa_nlupip install rasa_core[tensorflow]</code></pre><h2 id="å“åº”æ¶ˆæ¯çš„åŸºæœ¬æ­¥éª¤ï¼š"><a href="#å“åº”æ¶ˆæ¯çš„åŸºæœ¬æ­¥éª¤ï¼š" class="headerlink" title="å“åº”æ¶ˆæ¯çš„åŸºæœ¬æ­¥éª¤ï¼š"></a>å“åº”æ¶ˆæ¯çš„åŸºæœ¬æ­¥éª¤ï¼š</h2><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/1.png"></p><ul><li>é¦–å…ˆï¼Œå°†ç”¨æˆ·è¾“å…¥çš„Messageä¼ é€’åˆ°Interpreter(Rasa NLUæ¨¡å—)ï¼Œè¯¥æ¨¡å—è´Ÿè´£è¯†åˆ«Messageä¸­çš„â€æ„å›¾(intent)â€œå’Œæå–æ‰€æœ‰â€å®ä½“â€(entity)æ•°æ®ï¼›</li><li>å…¶æ¬¡ï¼ŒRasa Coreä¼šå°†Interpreteræå–åˆ°çš„æ„å›¾å’Œè¯†åˆ«ä¼ ç»™Trackerå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ä¸»è¦ä½œç”¨æ˜¯è·Ÿè¸ªä¼šè¯çŠ¶æ€(conversation state)ï¼›</li><li>ç¬¬ä¸‰ï¼Œåˆ©ç”¨policyè®°å½•Trackerå¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œå¹¶é€‰æ‹©æ‰§è¡Œç›¸åº”çš„actionï¼Œå…¶ä¸­ï¼Œè¿™ä¸ªactionæ˜¯è¢«è®°å½•åœ¨Trackå¯¹è±¡ä¸­çš„ï¼›</li><li>æœ€åï¼Œå°†æ‰§è¡Œactionè¿”å›çš„ç»“æœè¾“å‡ºå³å®Œæˆä¸€æ¬¡äººæœºäº¤äº’ã€‚</li></ul><h3 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h3><ul><li><code>intents</code>ï¼šæ„å›¾</li><li><code>pipeline</code>ï¼š</li><li><code>story</code>ï¼šCore model ä»¥è®­ç»ƒâ€œstoriesâ€çš„å½¢å¼ä»çœŸå®çš„ä¼šè¯æ•°æ®ä¸­å­¦ä¹ ã€‚æ•…äº‹æ˜¯ç”¨æˆ·å’ŒåŠ©æ‰‹ä¹‹é—´çš„çœŸå®å¯¹è¯.</li><li><code>domain</code>ï¼šå®šä¹‰äº†åŠ©æ‰‹æ‰€å¤„çš„universeï¼šå®ƒåº”è¯¥è·å¾—çš„ç”¨æˆ·è¾“å…¥ï¼Œåº”è¯¥èƒ½å¤Ÿé¢„æµ‹çš„æ“ä½œï¼Œå¦‚ä½•å“åº”ä»¥åŠè¦å­˜å‚¨çš„ä¿¡æ¯</li></ul><h2 id="Rasa-NLU"><a href="#Rasa-NLU" class="headerlink" title="Rasa_NLU"></a>Rasa_NLU</h2><p>Rasa NLUæ›¾ç»æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº“ï¼Œä½†å®ƒç°åœ¨æ˜¯Rasaæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚</p><p>Rasa_NLUæ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¯æœ¬åœ°éƒ¨ç½²å¹¶é…å¥—æœ‰è¯­æ–™æ ‡æ³¨å·¥å…·<a href="https://links.jianshu.com/go?to=https://rasahq.github.io/rasa-nlu-trainer/">RASA NLU Trainer</a>ã€‚å…¶æœ¬èº«å¯æ”¯æŒä»»ä½•è¯­è¨€ï¼Œä¸­æ–‡å› å…¶ç‰¹æ®Šæ€§éœ€è¦åŠ å…¥ç‰¹å®šçš„<code>tokenizer</code>ä½œä¸ºæ•´ä¸ªæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p><p><code>Rasa NLU</code> ç”¨äºèŠå¤©æœºå™¨äººä¸­çš„<strong>æ„å›¾è¯†åˆ«</strong>å’Œ<strong>å®ä½“æå–</strong>ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å¥å­ï¼š</p><pre><code>"I am looking for a Mexican restaurant in the center of town"</code></pre><p>è¿”å›ç»“æ„åŒ–æ•°æ®:</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"search_restaurant"</span><span class="token punctuation">,</span>  <span class="token property">"entities"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"cuisine"</span> <span class="token operator">:</span> <span class="token string">"Mexican"</span><span class="token punctuation">,</span>    <span class="token property">"location"</span> <span class="token operator">:</span> <span class="token string">"center"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p><a href="https://links.jianshu.com/go?to=https://github.com/crownpku/Rasa_NLU_Chi">Rasa_NLU_Chi</a> ä½œä¸º <code>Rasa_NLU çš„ä¸€ä¸ª fork ç‰ˆæœ¬</code>ï¼ŒåŠ å…¥äº†<code>jieba</code> ä½œä¸ºä¸­æ–‡çš„ tokenizerï¼Œå®ç°äº†ä¸­æ–‡æ”¯æŒã€‚</p><p>è¯¥éƒ¨åˆ†ç®€å•ä»‹ç»åŸºäº <code>Rasa_NLU_Chi</code> æ„å»ºä¸€ä¸ªæœ¬åœ°éƒ¨ç½²çš„ç‰¹å®šé¢†åŸŸçš„ä¸­æ–‡ NLU ç³»ç»Ÿçš„è¿‡ç¨‹ã€‚</p><p><strong>ç›®æ ‡</strong></p><ul><li>è¾“å…¥ï¼š ä¸­æ–‡æµ‹è¯•æ–‡æœ¬</li><li>è¾“å‡ºï¼š ç»“æ„åŒ–çš„æ•°æ®ï¼Œè¯†åˆ«å‡ºæ–‡æœ¬ä¸­å¯¹åº”çš„æ„å›¾å’Œå®ä½“</li></ul><h3 id="ç¬¬ä¸€æ­¥ï¼š-Pipeline"><a href="#ç¬¬ä¸€æ­¥ï¼š-Pipeline" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š Pipeline"></a>ç¬¬ä¸€æ­¥ï¼š Pipeline</h3><p>rasa nlu æ”¯æŒä¸åŒçš„ Pipelineï¼Œå…¶åç«¯å®ç°å¯æ”¯æŒ<code>spaCyã€MITIEã€MITIE + sklearn ä»¥åŠ tensorflow</code>ï¼Œå…¶ä¸­ spaCy æ˜¯å®˜æ–¹æ¨èçš„ï¼Œå¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ä» 0.12 ç‰ˆæœ¬åï¼ŒMITIE å°±è¢«åˆ—å…¥ Deprecated äº†ã€‚</p><p>æœ¬ä¾‹ä½¿ç”¨çš„ <strong>pipeline</strong> ä¸º <code>MITIE+Jieba+sklearn</code>ï¼Œ rasa nlu çš„<strong>é…ç½®æ–‡ä»¶</strong>ä¸º <code>config_jieba_mitie_sklearn.yml</code>å¦‚ä¸‹ï¼š</p><pre class=" language-c"><code class="language-c">language<span class="token punctuation">:</span> <span class="token string">"zh"</span>pipeline<span class="token punctuation">:</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"nlp_mitie"</span>  model<span class="token punctuation">:</span> <span class="token string">"data/total_word_feature_extractor_zh.dat"</span>  <span class="token comment" spellcheck="true">// åŠ è½½ mitie æ¨¡å‹</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"tokenizer_jieba"</span>   <span class="token comment" spellcheck="true">// ä½¿ç”¨ jieba è¿›è¡Œåˆ†è¯</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"ner_mitie"</span>   <span class="token comment" spellcheck="true">// mitie çš„å‘½åå®ä½“è¯†åˆ«</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"ner_synonyms"</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"intent_entity_featurizer_regex"</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"intent_featurizer_mitie"</span>  <span class="token comment" spellcheck="true">// ç‰¹å¾æå–</span><span class="token operator">-</span> name<span class="token punctuation">:</span> <span class="token string">"intent_classifier_sklearn"</span> <span class="token comment" spellcheck="true">// sklearn çš„æ„å›¾åˆ†ç±»æ¨¡å‹</span></code></pre><h3 id="ç¬¬äºŒæ­¥ï¼šå‡†å¤‡å·¥ä½œï¼šè®­ç»ƒMITIEæ¨¡å‹æ–‡ä»¶"><a href="#ç¬¬äºŒæ­¥ï¼šå‡†å¤‡å·¥ä½œï¼šè®­ç»ƒMITIEæ¨¡å‹æ–‡ä»¶" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå‡†å¤‡å·¥ä½œï¼šè®­ç»ƒMITIEæ¨¡å‹æ–‡ä»¶"></a>ç¬¬äºŒæ­¥ï¼šå‡†å¤‡å·¥ä½œï¼šè®­ç»ƒMITIEæ¨¡å‹æ–‡ä»¶</h3><p>rasa NLUçš„å®ä½“è¯†åˆ«å’Œæ„å›¾è¯†åˆ«çš„ä»»åŠ¡ï¼Œéœ€è¦ä¸€ä¸ªè®­ç»ƒå¥½çš„MITIEçš„æ¨¡å‹ã€‚è¿™ä¸ªMITIEæ¨¡å‹æ˜¯éç›‘ç£è®­ç»ƒå¾—åˆ°çš„ï¼Œç±»ä¼¼äºword2vecä¸­çš„word embeddingã€‚</p><p>è¦è®­ç»ƒè¿™ä¸ªMITIEæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§„æ¨¡æ¯”è¾ƒå¤§çš„ä¸­æ–‡è¯­æ–™ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯ç”¨å¯¹åº”è‡ªå·±éœ€æ±‚çš„è¯­æ–™ï¼Œæ¯”å¦‚åšé‡‘èçš„chatbotå°±å¤šå»çˆ¬å–äº›è´¢ç»æ–°é—»ï¼ŒåšåŒ»ç–—çš„chatbotå°±å¤šè·å–äº›åŒ»ç–—ç›¸å…³æ–‡ç« ã€‚</p><p>ä½¿ç”¨<a href="https://github.com/crownpku/awesome-chinese-nlp">awesome-chinese-nlp</a>ä¸­åˆ—å‡ºçš„ä¸­æ–‡wikipedia dumpå’Œç™¾åº¦ç™¾ç§‘è¯­æ–™ä¸ºä¾‹ã€‚å…¶ä¸­å…³äºwikipedia dumpçš„å¤„ç†å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/qq_32166627/article/details/68942216">è¿™ç¯‡å¸–å­</a>ã€‚</p><p>ä»…ä»…è·å–è¯­æ–™è¿˜ä¸å¤Ÿï¼Œå› ä¸ºMITIEæ¨¡å‹è®­ç»ƒçš„è¾“å…¥æ˜¯ä»¥è¯ä¸ºå•ä½çš„ã€‚æ‰€ä»¥è¦å…ˆè¿›è¡Œåˆ†è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»“å·´åˆ†è¯ã€‚</p><p>å®‰è£…ç»“å·´åˆ†è¯ï¼š</p><pre class=" language-shell"><code class="language-shell">$ pip install jieba</code></pre><p>å°†ä¸€ä¸ªè¯­æ–™æ–‡ä»¶åˆ†è¯ï¼Œä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ï¼š</p><pre class=" language-shell"><code class="language-shell">$ python -m jieba -d " " ./test > ./test_cut</code></pre><h4 id="MITIEæ¨¡å‹è®­ç»ƒ"><a href="#MITIEæ¨¡å‹è®­ç»ƒ" class="headerlink" title="MITIEæ¨¡å‹è®­ç»ƒ"></a>MITIEæ¨¡å‹è®­ç»ƒ</h4><p>æˆ‘ä»¬æŠŠæ‰€æœ‰åˆ†å¥½è¯çš„è¯­æ–™æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®­ç»ƒMITIEæ¨¡å‹ã€‚</p><p>é¦–å…ˆå°†MITIE cloneä¸‹æ¥ï¼š</p><pre><code>$ git clone https://github.com/mit-nlp/MITIE.git</code></pre><p>æˆ‘ä»¬è¦ä½¿ç”¨çš„åªæ˜¯MITIEå…¶ä¸­wordrepè¿™ä¸€ä¸ªå·¥å…·ã€‚æˆ‘ä»¬å…ˆbuildå®ƒã€‚</p><pre><code>$ cd MITIE/tools/wordrep$ mkdir build$ cd build$ cmake ..$ cmake --build . --config Release</code></pre><p>ç„¶åè®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°total_word_feature_extractor.datã€‚æ³¨æ„è¿™ä¸€æ­¥è®­ç»ƒä¼šè€—è´¹å‡ åGBçš„å†…å­˜ï¼Œå¤§æ¦‚éœ€è¦ä¸¤åˆ°ä¸‰å¤©çš„æ—¶é—´ã€‚ã€‚ã€‚</p><pre><code>$ ./wordrep -e /path/to/your/folder_of_cutted_text_files</code></pre><p>ä¸­æ–‡wikipediaå’Œç™¾åº¦ç™¾ç§‘è¯­æ–™ç”Ÿæˆäº†ä¸€ä¸ªtotal_word_feature_extractor_chi.datï¼Œåˆ†äº«å¦‚ä¸‹ã€‚</p><pre><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1kNENvlHLYWZIddmtWJ7Pdg å¯†ç ï¼šp4vx</code></pre><p>å¯¹äºä¸€äº›æ¯”è¾ƒgeneralçš„NLUä½¿ç”¨åœºæ™¯ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¤Ÿç”¨äº†ã€‚</p><h3 id="ç¬¬ä¸‰æ­¥ï¼šrasa-nlu-è¯­æ–™"><a href="#ç¬¬ä¸‰æ­¥ï¼šrasa-nlu-è¯­æ–™" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šrasa_nlu è¯­æ–™"></a>ç¬¬ä¸‰æ­¥ï¼šrasa_nlu è¯­æ–™</h3><p>å¾—åˆ°MITIEè¯å‘é‡æ¨¡å‹ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨æ ‡æ³¨å¥½è¯­æ–™è®­ç»ƒRasa NLUæ¨¡å‹ã€‚<br> Rasaæä¾›äº†<strong>æ•°æ®æ ‡æ³¨å¹³å°</strong>: <a href="https://links.jianshu.com/go?to=https://rasahq.github.io/rasa-nlu-trainer/">rasa-nlu-trainer</a></p><p>é‚£æ ‡æ³¨å¥½çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p>æ ‡æ³¨å¥½çš„è¯­æ–™å­˜å‚¨åœ¨<code>json</code>æ–‡ä»¶ä¸­ï¼Œå…·ä½“æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼ŒåŒ…å«<code>text</code>ï¼Œ <code>intent</code>ï¼Œ<code>entities</code>ï¼Œå®ä½“ä¸­<code>start</code>å’Œ<code>end</code>æ˜¯å®ä½“å¯¹åº”åœ¨<code>text</code>ä¸­çš„èµ·æ­¢<code>index</code>ã€‚</p><p>ä»¥<code>data/examples/rasa/demo-rasa_zh.json</code>ä¸ºä¾‹ï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"rasa_nlu_data"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"common_examples"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"ä½ å¥½"</span><span class="token punctuation">,</span>        <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"greet"</span><span class="token punctuation">,</span>        <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"æˆ‘æƒ³æ‰¾åœ°æ–¹åƒé¥­"</span><span class="token punctuation">,</span>        <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"restaurant_search"</span><span class="token punctuation">,</span>        <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"æˆ‘æƒ³åƒç«é”…å•Š"</span><span class="token punctuation">,</span>        <span class="token property">"intent"</span><span class="token operator">:</span> <span class="token string">"restaurant_search"</span><span class="token punctuation">,</span>        <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span>          &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"end"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"ç«é”…"</span><span class="token punctuation">,</span>            <span class="token property">"entity"</span><span class="token operator">:</span> <span class="token string">"food"</span>          &amp;#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token punctuation">]</span>      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span> </code></pre><h3 id="ç¬¬å››æ­¥ï¼šè®­ç»ƒæ¨¡å‹"><a href="#ç¬¬å››æ­¥ï¼šè®­ç»ƒæ¨¡å‹" class="headerlink" title="ç¬¬å››æ­¥ï¼šè®­ç»ƒæ¨¡å‹"></a>ç¬¬å››æ­¥ï¼šè®­ç»ƒæ¨¡å‹</h3><p>åˆ°ç›®å‰ï¼Œå·²ç»è·å–äº†è®­ç»ƒæ‰€éœ€çš„æ ‡æ³¨å¥½çš„è¯­æ–™ï¼Œä»¥åŠè¯å‘é‡æ¨¡å‹MITIEæ–‡ä»¶ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥è®­ç»ƒRasa_NLUæ¨¡å‹äº†ã€‚</p><p>æ’ä¸€å¥  å®‰è£…ï¼š</p><ul><li><p>æºç å®‰è£…</p><pre class=" language-py"><code class="language-py">$ git clone https://github.com/crownpku/Rasa_NLU_Chi.git // clone æºç $ cd Rasa_NLU_Chi$ python setup.py install  // å®‰è£…ä¾èµ–</code></pre></li></ul><p><strong>æ¨¡å‹è®­ç»ƒå‘½ä»¤</strong></p><pre class=" language-kotlin"><code class="language-kotlin">python <span class="token operator">-</span>m rasa_nlu<span class="token punctuation">.</span>train <span class="token operator">-</span>c sample_configs<span class="token operator">/</span>config_jieba_mitie_sklearn<span class="token punctuation">.</span>yml <span class="token operator">--</span><span class="token keyword">data</span> <span class="token keyword">data</span><span class="token operator">/</span>examples<span class="token operator">/</span>rasa<span class="token operator">/</span>demo<span class="token operator">-</span>rasa_zh<span class="token punctuation">.</span>json <span class="token operator">--</span>path models <span class="token operator">--</span>project nlu</code></pre><p><strong>æ‰€éœ€å‚æ•°ï¼š</strong></p><ul><li>è®­ç»ƒé…ç½®æ–‡ä»¶ï¼š<code>-c</code></li><li>è®­ç»ƒè¯­æ–™ï¼š<code>--data</code></li><li>æ¨¡å‹ä¿å­˜è·¯å¾„ï¼š<code>--path</code></li><li>é¡¹ç›®åç§°ï¼š<code>--project</code></li></ul><p>æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œä¼šåœ¨<code>--path</code>æŒ‡å®šçš„è·¯å¾„ä¸‹ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¦‚æœè®­ç»ƒæ—¶æŒ‡å®šäº†æ¨¡å‹åç§°ï¼ˆå³â€“projectï¼‰ï¼Œæ¨¡å‹å°±ä¼šå­˜å‚¨åœ¨<code>models/project_name/model_**</code>ç›®å½•ä¸­ï¼Œå¦‚<code>models/chat_nlu_test/model_20190821-160150</code><br> ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/1.webp"></p><h3 id="ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯"><a href="#ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯" class="headerlink" title="ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯"></a>ç¬¬äº”æ­¥ï¼šæµ‹è¯•éªŒè¯</h3><ul><li>å¯åŠ¨æœåŠ¡</li></ul><pre class=" language-swift"><code class="language-swift">python <span class="token operator">-</span>m rasa_nlu<span class="token punctuation">.</span>server <span class="token operator">-</span>c sample_configs<span class="token operator">/</span>config_jieba_mitie_sklearn<span class="token punctuation">.</span>yml <span class="token operator">--</span>path models</code></pre><ul><li>æµ‹è¯•æœåŠ¡(æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œä½¿ç”¨curlå‘½ä»¤è·å–ç»“æœ)</li></ul><pre class=" language-rust"><code class="language-rust">curl <span class="token operator">-</span>XPOST localhost<span class="token punctuation">:</span><span class="token number">5000</span><span class="token operator">/</span>parse <span class="token operator">-</span>d <span class="token string">'&amp;#123;"q":"æ˜å¤©å¤©æ°”é¢„æŠ¥", "project":"nlu", "model":"model_20190821-160150"&amp;#125;'</span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/2.webp"></p><h2 id="Rasa-Core"><a href="#Rasa-Core" class="headerlink" title="Rasa Core"></a>Rasa Core</h2><p>Rasa Coreæ˜¯ç”¨äºæ„å»ºAIåŠ©æ‰‹çš„å¯¹è¯å¼•æ“ï¼Œæ˜¯å¼€æºRasaæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>Rasa Coreæ¶ˆæ¯å¤„ç†æµç¨‹</strong><br> ç”±å‰é¢æè¿°çš„å¯¹è¯ç®¡ç†æ¨¡å—äº†è§£åˆ°ï¼Œå®ƒåº”è¯¥æ˜¯è´Ÿè´£åè°ƒèŠå¤©æœºå™¨äººçš„å„ä¸ªæ¨¡å—ï¼Œèµ·åˆ°ç»´æŠ¤äººæœºå¯¹è¯çš„ç»“æ„å’ŒçŠ¶æ€çš„ä½œç”¨ã€‚å¯¹è¯ç®¡ç†æ¨¡å—æ¶‰åŠåˆ°çš„å…³é”®æŠ€æœ¯åŒ…æ‹¬å¯¹è¯è¡Œä¸ºè¯†åˆ«ã€å¯¹è¯çŠ¶æ€è¯†åˆ«ã€å¯¹è¯ç­–ç•¥å­¦ä¹ ä»¥åŠè¡Œä¸ºé¢„æµ‹ã€å¯¹è¯å¥–åŠ±ç­‰ã€‚ä¸‹é¢æ˜¯Rasa Coreæ¶ˆæ¯å¤„ç†æµç¨‹ï¼š</p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/1.png"></p><ul><li>é¦–å…ˆï¼Œå°†ç”¨æˆ·è¾“å…¥çš„Messageä¼ é€’åˆ°<code>Interpreter</code>(NLUæ¨¡å—)ï¼Œè¯¥æ¨¡å—è´Ÿè´£è¯†åˆ«Messageä¸­çš„â€æ„å›¾(intent)â€œå’Œæå–æ‰€æœ‰â€å®ä½“â€(entity)æ•°æ®ï¼›</li><li>å…¶æ¬¡ï¼ŒRasa Coreä¼šå°†Interpreteræå–åˆ°çš„æ„å›¾å’Œè¯†åˆ«ä¼ ç»™<code>Tracker</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ä¸»è¦ä½œç”¨æ˜¯è·Ÿè¸ªä¼šè¯çŠ¶æ€(conversation state)ï¼›</li><li>ç¬¬ä¸‰ï¼Œåˆ©ç”¨<code>policy</code>è®°å½•<code>Tracker</code>å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œå¹¶é€‰æ‹©æ‰§è¡Œç›¸åº”çš„<code>action</code>ï¼Œå…¶ä¸­ï¼Œè¿™ä¸ªactionæ˜¯è¢«è®°å½•åœ¨Trackå¯¹è±¡ä¸­çš„ï¼›</li><li>æœ€åï¼Œå°†æ‰§è¡Œactionè¿”å›çš„ç»“æœè¾“å‡ºå³å®Œæˆä¸€æ¬¡äººæœºäº¤äº’ã€‚</li></ul><p>Rasa CoreåŒ…å«ä¸¤ä¸ªå†…å®¹ï¼š <code>stories</code>å’Œ<code>domain</code>ã€‚</p><ul><li><code>domain.yml</code>ï¼šåŒ…æ‹¬å¯¹è¯ç³»ç»Ÿæ‰€é€‚ç”¨çš„é¢†åŸŸï¼ŒåŒ…å«æ„å›¾é›†åˆï¼Œå®ä½“é›†åˆå’Œç›¸åº”é›†åˆ</li><li><code>story.md</code>ï¼šè®­ç»ƒæ•°æ®é›†åˆï¼ŒåŸå§‹å¯¹è¯åœ¨domainä¸­çš„æ˜ å°„ã€‚</li></ul><h3 id="1-Stories"><a href="#1-Stories" class="headerlink" title="1. Stories"></a>1. Stories</h3><p>storieså¯ä»¥ç†è§£ä¸ºå¯¹è¯çš„åœºæ™¯æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰æœºå™¨æˆ‘ä»¬çš„å¤šè½®åœºæ™¯æ˜¯æ€æ ·çš„ã€‚Storyæ ·æœ¬æ•°æ®å°±æ˜¯Rasa Coreå¯¹è¯ç³»ç»Ÿè¦è®­ç»ƒçš„æ ·æœ¬ï¼Œå®ƒæè¿°äº†äººæœºå¯¹è¯è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„æ•…äº‹æƒ…èŠ‚ï¼Œé€šè¿‡å¯¹Storiesæ ·æœ¬å’Œdomainçš„è®­ç»ƒå¾—åˆ°äººæœºå¯¹è¯ç³»ç»Ÿæ‰€éœ€çš„å¯¹è¯æ¨¡å‹ã€‚</p><p>Storieså­˜å‚¨åœ¨mdæ–‡ä»¶ä¸­ã€‚storyçš„ç¬¦å·è¯´æ˜å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">ç¬¦å·</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">##</td><td align="center">sotryæ ‡é¢˜</td></tr><tr><td align="center">*</td><td align="center">æ„å›¾å’Œå¡«å……çš„slot</td></tr><tr><td align="center">-</td><td align="center">åŠ¨ä½œ</td></tr></tbody></table><p><strong>Storyæ ¼å¼å¤§è‡´åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</strong></p><ul><li><strong>1. ç”¨æˆ·è¾“å…¥</strong>ï¼ˆ<code>User Messages</code>ï¼‰</li></ul><p>â€ƒä½¿ç”¨<code>*</code>å¼€å¤´çš„è¯­å¥è¡¨ç¤ºç”¨æˆ·çš„è¾“å…¥æ¶ˆæ¯ï¼Œæˆ‘ä»¬æ— éœ€ä½¿ç”¨åŒ…å«æŸä¸ªå…·ä½“å†…å®¹çš„è¾“å…¥ï¼Œè€Œæ˜¯ä½¿ç”¨NLUç®¡é“è¾“å‡ºçš„intentå’Œentitiesæ¥è¡¨ç¤ºå¯èƒ½çš„è¾“å…¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”¨æˆ·çš„è¾“å…¥å¯èƒ½åŒ…å«entitiesï¼Œå»ºè®®å°†å…¶åŒ…æ‹¬åœ¨å†…ï¼Œå°†æœ‰åŠ©äºpoliciesé¢„æµ‹ä¸‹ä¸€æ­¥actionã€‚è¿™éƒ¨åˆ†å¤§è‡´åŒ…å«ä¸‰ç§å½¢å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰<code>* greet</code> è¡¨ç¤ºç”¨æˆ·è¾“å…¥æ²¡æœ‰entityæƒ…å†µï¼›<br>ï¼ˆ2ï¼‰<code>* inform{"people": "six"}</code> è¡¨ç¤ºç”¨æˆ·è¾“å…¥åŒ…å«entityæƒ…å†µï¼Œå“åº”è¿™ç±»intentä¸ºæ™®é€šactionï¼›<br>ï¼ˆ3ï¼‰<code>* request_weather</code> è¡¨ç¤ºç”¨æˆ·è¾“å…¥Messageå¯¹åº”çš„intentä¸ºform actionæƒ…å†µï¼›</p><ul><li><strong>2. åŠ¨ä½œ</strong>ï¼ˆ<code>Actions</code>ï¼‰</li></ul><p>â€ƒä½¿ç”¨<code>-</code>å¼€å¤´çš„è¯­å¥è¡¨ç¤ºè¦æ‰§è¡ŒåŠ¨ä½œ(<code>Action</code>)ï¼Œå¯åˆ†ä¸º<code>utterance actions</code>å’Œ<code>custom actions</code>ï¼Œå…¶ä¸­ï¼Œå‰è€…åœ¨domain.yamlä¸­å®šä¹‰ä»¥<code>utter_</code>ä¸ºå‰ç¼€ï¼Œæ¯”å¦‚åä¸ºgreetçš„æ„å›¾ï¼Œå®ƒçš„å›å¤åº”ä¸º<code>utter_greet</code>ï¼›åè€…ä¸ºè‡ªå®šä¹‰åŠ¨ä½œï¼Œå…·ä½“é€»è¾‘ç”±æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œè™½ç„¶åœ¨å®šä¹‰actionåç§°çš„æ—¶å€™æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®ä»¥<code>action_</code>ä¸ºå‰ç¼€ï¼Œæ¯”å¦‚åä¸ºinformçš„æ„å›¾fetch_profileçš„æ„å›¾ï¼Œå®ƒçš„responseå¯ä¸º<code>action_fetch_profile</code>ã€‚</p><ul><li><strong>3. äº‹ä»¶</strong>ï¼ˆ<code>Events</code>ï¼‰</li></ul><p>â€ƒEventsä¹Ÿæ˜¯ä½¿ç”¨<code>-</code>å¼€å¤´ï¼Œä¸»è¦åŒ…å«æ§½å€¼è®¾ç½®(<code>SlotSet</code>)å’Œæ¿€æ´»/æ³¨é”€è¡¨å•(<code>Form</code>)ï¼Œå®ƒæ˜¯æ˜¯Storyçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¿…é¡»æ˜¾ç¤ºçš„å†™å‡ºæ¥ã€‚Slot Eventså’ŒForm Eventsçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰Slot Events</p><p>â€ƒ<code>Slot Events</code>çš„ä½œç”¨å½“æˆ‘ä»¬åœ¨è‡ªå®šä¹‰Actionä¸­è®¾ç½®äº†æŸä¸ªæ§½å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨Storyä¸­Actionæ‰§è¡Œä¹‹åæ˜¾è‘—çš„å°†è¿™ä¸ªSlotSetäº‹ä»¶æ ‡æ³¨å‡ºæ¥ï¼Œæ ¼å¼ä¸º<code>- slot{"slot_name": "value"}</code>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨action_fetch_profileä¸­è®¾ç½®äº†Slotåä¸ºaccount_typeçš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>actions <span class="token keyword">import</span> Action<span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>events <span class="token keyword">import</span> SlotSet<span class="token keyword">import</span> requests<span class="token keyword">class</span> <span class="token class-name">FetchProfileAction</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"fetch_profile"</span>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> <span class="token string">"http://myprofileurl.com"</span>        data <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>json        <span class="token keyword">return</span> <span class="token punctuation">[</span>SlotSet<span class="token punctuation">(</span><span class="token string">"account_type"</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"account_type"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>â€ƒé‚£ä¹ˆï¼Œå°±éœ€è¦åœ¨Storyä¸­æ‰§è¡Œ<code>action_fetch_profile</code>ä¹‹åï¼Œæ·»åŠ <code>- slot{"account_type" : "premium"}</code>ã€‚è™½ç„¶ï¼Œè¿™ä¹ˆåšçœ‹èµ·æ¥æœ‰ç‚¹å¤šä½™ï¼Œä½†æ˜¯Rasaè§„å®šè¿™ä¹ˆåšå¿…é¡»çš„ï¼Œç›®çš„æ˜¯æé«˜è®­ç»ƒæ—¶å‡†ç¡®åº¦ã€‚</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> fetch_profile</span><span class="token list punctuation">*</span> fetch_profile   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>fetch<span class="token punctuation">_</span></span>profile   <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"account_type" : "premium"<span class="token entity" title="&#125;">&amp;#125;</span>   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>welcome<span class="token punctuation">_</span></span>premium</code></pre><p>â€ƒå½“ç„¶ï¼Œå¦‚æœæ‚¨çš„è‡ªå®šä¹‰Actionä¸­å°†æ§½å€¼é‡ç½®ä¸ºNoneï¼Œåˆ™å¯¹åº”çš„äº‹ä»¶ä¸º<code>-slot{"slot_name": null}</code>ã€‚</p><p>ï¼ˆ2ï¼‰Form Events</p><p>â€ƒåœ¨Storyä¸­ä¸»è¦å­˜åœ¨ä¸‰ç§å½¢å¼çš„è¡¨å•äº‹ä»¶(Form Events)ï¼Œå®ƒä»¬å¯è¡¨è¿°ä¸ºï¼š</p><ul><li><code>Form Action</code>äº‹ä»¶</li></ul><p>â€ƒForm Actionå³è¡¨å•åŠ¨ä½œäº‹ä»¶ï¼Œæ˜¯è‡ªå®šä¹‰Actionçš„ä¸€ç§ï¼Œç”¨äºä¸€ä¸ªè¡¨å•æ“ä½œã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> restaurant_form</code></pre><ul><li><code>Form activation</code>äº‹ä»¶</li></ul><p>â€ƒform activationå³æ¿€æ´»è¡¨å•äº‹ä»¶ï¼Œå½“form actionäº‹ä»¶æ‰§è¡Œåï¼Œä¼šç«‹é©¬æ‰§è¡Œè¯¥äº‹ä»¶ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> form<span class="token entity" title="&#123;">&amp;#123;</span>"name": "restaurant_form"<span class="token entity" title="&#125;">&amp;#125;</span></code></pre><ul><li><code>Form deactivation</code>äº‹ä»¶</li></ul><p>â€ƒform deactivationå³æ³¨é”€è¡¨å•äº‹ä»¶ï¼Œä½œç”¨ä¸form activationç›¸åã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> form<span class="token entity" title="&#123;">&amp;#123;</span>"name": null<span class="token entity" title="&#125;">&amp;#125;</span></code></pre><p>â€ƒæ€»ä¹‹ï¼Œæˆ‘ä»¬åœ¨æ„å»ºStoryæ—¶ï¼Œå¯ä»¥è¯´æ˜¯å¤šç§å¤šæ ·çš„ï¼Œå› ä¸ºè®¾è®¡çš„æ•…äº‹æƒ…èŠ‚æ˜¯å¤šç§å¤šæ ·çš„ï¼Œè¿™å°±æ„å‘³ç€ä¸Šè¿°ä¸‰ç§å†…å®¹çš„ç»„åˆä¹Ÿæ˜¯éå¸¸çµæ´»çš„ã€‚å¦å¤–ï¼Œåœ¨è®¾è®¡Storyæ—¶Rasaè¿˜æä¾›äº†<a href="https://rasa.com/docs/rasa/core/stories/#id9">Checkpoints </a>å’Œ<a href="https://rasa.com/docs/rasa/core/stories/#id9">OR statements</a>ä¸¤ç§åŠŸèƒ½ï¼Œæ¥æå‡æ„å»ºStoryçš„çµæ´»åº¦ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸œè¥¿è™½å¥½ï¼Œä½†æ˜¯ä¸è¦å¤ªè´ªäº†ï¼Œè¿‡å¤šçš„ä½¿ç”¨ä¸ä»…å¢åŠ äº†å¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿä¼šæ‹–æ…¢è®­ç»ƒçš„é€Ÿåº¦ã€‚å…¶ä¸­ï¼Œ<a href="https://rasa.com/docs/rasa/core/stories/#id10">Checkpoints</a>ç”¨äºæ¨¡å—åŒ–å’Œç®€åŒ–è®­ç»ƒæ•°æ®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> first story</span><span class="token list punctuation">*</span> greet   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>user_question<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token title important"><span class="token punctuation">##</span> user affirms question</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token list punctuation">*</span> affirm  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation<span class="token title important"><span class="token punctuation">##</span> user denies question</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question<span class="token list punctuation">*</span> deny  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>denial<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial<span class="token title important"><span class="token punctuation">##</span> user leaves</span><span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation<span class="token list punctuation">*</span> goodbye  <span class="token list punctuation">-</span> utter_goodbye</code></pre><p>â€ƒåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>&gt; check_asked_question</code>è¡¨ç¤ºfirst storyï¼Œè¿™æ ·åœ¨å…¶ä»–storyä¸­ï¼Œå¦‚æœæœ‰ç›¸åŒçš„first storyéƒ¨åˆ†ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>&gt; check_asked_question</code>ä»£æ›¿ã€‚è€Œ<a href="https://rasa.com/docs/rasa/core/stories/#id11">OR Statements</a>ä¸»è¦ç”¨äºå®ç°æŸä¸€ä¸ªactionå¯åŒæ—¶å“åº”å¤šä¸ªæ„å›¾çš„æƒ…å†µï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> story</span><span class="token list punctuation">*</span> affirm OR thankyou  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation</code></pre><p>ç¤ºä¾‹ï¼š</p><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true">## simple_story_with_multiple_turns</span>* affirm OR thank_you    <span class="token punctuation">-</span> utter_default* goodbye    <span class="token punctuation">-</span> utter_goodbye<span class="token punctuation">></span> check_goodbye<span class="token comment" spellcheck="true">## story_04649138</span>* greet <span class="token punctuation">-</span> utter_ask_howcanhelp* inform&amp;<span class="token comment" spellcheck="true">#123;"location": "london", "people": "two", "price": "moderate"&amp;#125;</span> <span class="token punctuation">-</span> utter_on_it <span class="token punctuation">-</span> utter_ask_cuisine* inform&amp;<span class="token comment" spellcheck="true">#123;"cuisine": "spanish"&amp;#125;</span> <span class="token punctuation">-</span> utter_ask_moreupdates* inform&amp;<span class="token comment" spellcheck="true">#123;"cuisine": "british"&amp;#125;</span> <span class="token punctuation">-</span> utter_ask_moreupdates* deny <span class="token punctuation">-</span> utter_ack_dosearch <span class="token punctuation">-</span> action_search_restaurants <span class="token punctuation">-</span> action_suggest* affirm <span class="token punctuation">-</span> utter_ack_makereservation* thankyou <span class="token punctuation">-</span> utter_goodbye</code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>**<code>&gt; check_\*</code>**ï¼š ç”¨äºæ¨¡å—åŒ–å’Œç®€åŒ–è®­ç»ƒæ•°æ®ï¼Œå³storyå¤ç”¨ã€‚</li><li><strong><code>OR</code></strong> ï¼šç”¨äºå¤„ç†åŒä¸€ä¸ªstoryä¸­å¯èƒ½å‡ºç°2ä¸ªä»¥ä¸Šæ„å›¾ï¼Œè¿™æœ‰åˆ©äºç®€åŒ–storyï¼Œä½†æ˜¯ç›¸åº”çš„è®­ç»ƒæ—¶é—´ç­‰äºè®­ç»ƒäº†ä¸¤ä¸ªä»¥ä¸Šçš„æ•…äº‹ï¼Œä¸å»ºè®®å¯†é›†ä½¿ç”¨ã€‚</li></ul><h4 id="å¯è§†åŒ–stories"><a href="#å¯è§†åŒ–stories" class="headerlink" title="å¯è§†åŒ–stories"></a>å¯è§†åŒ–stories</h4><p>Rasa Coreä¸­æä¾›äº†<code>rasa_core.visualize</code>æ¨¡å—å¯è§†åŒ–æ•…äº‹ï¼Œæœ‰åˆ©äºæŒæ¡è®¾è®¡æ•…äº‹æµç¨‹ã€‚</p><p><strong>å‘½ä»¤ï¼š</strong></p><pre class=" language-kotlin"><code class="language-kotlin">python <span class="token operator">-</span>m rasa_core<span class="token punctuation">.</span>visualize <span class="token operator">-</span>d domain<span class="token punctuation">.</span>yml <span class="token operator">-</span>s <span class="token keyword">data</span><span class="token operator">/</span>sotries<span class="token punctuation">.</span>md <span class="token operator">-</span>o graph<span class="token punctuation">.</span>html <span class="token operator">-</span>c config<span class="token punctuation">.</span>yml</code></pre><p>å‚æ•°ï¼š</p><ul><li><code>-m</code>ï¼šæŒ‡å®šè¿è¡Œæ¨¡å—</li><li><code>-d</code>ï¼šæŒ‡å®šdomain.ymlæ–‡ä»¶è·¯å¾„</li><li><code>-s</code>ï¼šæŒ‡å®šstoryè·¯å¾„</li><li><code>-o</code>ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶å</li><li><code>-c</code>ï¼šæŒ‡å®šPolicyé…ç½®æ–‡ä»¶ã€‚</li></ul><p>æœ€ç»ˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ª<code>graph.html</code>ï¼Œå¯ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><p>å…·ä½“å®ç°ï¼Œå¯å‚è€ƒæºä»£ç <code>rasa/core/visualize.py</code>ã€‚</p><p>æœ€ç»ˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ª<code>graph.html</code>ï¼Œå¯ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚</p><p>å…·ä½“å®ç°ï¼Œå¯å‚è€ƒæºä»£ç <code>rasa/core/visualize.py</code>ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_core<span class="token punctuation">.</span>agent <span class="token keyword">import</span> Agent<span class="token keyword">from</span> rasa_core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>keras_policy <span class="token keyword">import</span> KerasPolicy<span class="token keyword">from</span> rasa_core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>memoization <span class="token keyword">import</span> MemoizationPolicy<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    agent <span class="token operator">=</span> Agent<span class="token punctuation">(</span><span class="token string">"domain.yml"</span><span class="token punctuation">,</span> policies<span class="token operator">=</span><span class="token punctuation">[</span>MemoizationPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> KerasPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    agent<span class="token punctuation">.</span>visualize<span class="token punctuation">(</span><span class="token string">"data/stories.md"</span><span class="token punctuation">,</span> output_file<span class="token operator">=</span><span class="token string">"graph.html"</span><span class="token punctuation">,</span> max_history<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/2.png"></p><h3 id="2-Domain"><a href="#2-Domain" class="headerlink" title="2. Domain"></a>2. Domain</h3><p>domain.ymlå®šä¹‰äº†å¯¹è¯æœºå™¨äººåº”çŸ¥é“çš„æ‰€æœ‰ä¿¡æ¯ï¼Œç›¸å½“äºå¤§è„‘æ¡†æ¶ï¼ŒæŒ‡å®šäº†æ„å›¾<code>intents</code>ï¼Œ å®ä½“<code>entities</code>ï¼Œ æ’æ§½<code>slots</code>ä»¥åŠåŠ¨ä½œ<code>actions</code>ã€‚<br> å…¶ç§ï¼Œ<code>intents</code>å’Œ<code>entities</code>ä¸Rasa NLUæ¨¡å‹è®­ç»ƒæ ·æœ¬ä¸­æ ‡è®°çš„ä¸€è‡´ã€‚<code>slot</code>ä¸æ ‡è®°çš„<code>entities</code>ä¸€è‡´ï¼Œ<code>actions</code>ä¸ºå¯¹è¯æœºå™¨äººå¯¹åº”ç”¨æˆ·çš„è¯·æ±‚ä½œå‡ºçš„åŠ¨ä½œã€‚<br> æ­¤å¤–ï¼Œdomain.ymlä¸­çš„<code>templates</code>éƒ¨åˆ†é’ˆå¯¹<code>utter_</code>ç±»å‹<code>action</code>å®šä¹‰äº†æ¨¡æ¿æ¶ˆæ¯ï¼Œä¾¿äºå¯¹è¯æœºå™¨äººå¯¹ç›¸å…³åŠ¨ä½œè‡ªåŠ¨å›å¤ã€‚</p><table><thead><tr><th align="center">é¡¹</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>intents</code></td><td align="center">æ„å›¾</td></tr><tr><td align="center"><code>entities</code></td><td align="center">å®ä½“ä¿¡æ¯</td></tr><tr><td align="center"><code>slots</code></td><td align="center">è¯æ§½ï¼Œå¯¹è¯ä¸­æƒ³è¦è·Ÿè¸ªçš„ä¿¡æ¯</td></tr><tr><td align="center"><code>actions</code></td><td align="center">æœºå™¨äººä½œå‡ºçš„åŠ¨ä½œ</td></tr><tr><td align="center"><code>templates</code></td><td align="center">å›å¤çš„æ¨¡æ¿è¯­å¥</td></tr></tbody></table><h4 id="æ„å›¾intents"><a href="#æ„å›¾intents" class="headerlink" title="æ„å›¾intents"></a>æ„å›¾intents</h4><p>ä½¿ç”¨<code>-</code>ç¬¦å·è¡¨ç¤ºæ¯ä¸ªæ„å›¾</p><pre class=" language-undefined"><code class="language-undefined">intents:  - greet  - goodbye  - search_weather</code></pre><h4 id="å®ä½“entities"><a href="#å®ä½“entities" class="headerlink" title="å®ä½“entities"></a>å®ä½“entities</h4><p>å®ä½“ï¼Œå³æ ·æœ¬ä¸­æ ‡å‡ºçš„æ‰€æœ‰entity</p><pre class=" language-undefined"><code class="language-undefined">entities:  - city</code></pre><h4 id="æ§½slot"><a href="#æ§½slot" class="headerlink" title="æ§½slot"></a>æ§½slot</h4><p>æ’æ§½æ˜¯æœºå™¨äººçš„è®°å¿†ã€‚å®ƒä»¬å……å½“é”®å€¼å­˜å‚¨å™¨ï¼Œå…¶å¯ç”¨äºå­˜å‚¨ç”¨æˆ·æä¾›çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œä»–ä»¬çš„å®¶ä¹¡ï¼‰ä»¥åŠå…³äºå¤–éƒ¨ä¸–ç•Œæ”¶é›†çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œæ•°æ®åº“æŸ¥è¯¢çš„ç»“æœï¼‰ã€‚<br> ä»¥å¤©æ°”æŸ¥è¯¢ä¸ºä¾‹ï¼Œå¯¹è¯æœºå™¨äººå¿…é¡»çŸ¥é“åœ°ç‚¹å’Œæ—¥æœŸæ‰å¯ä»¥æŸ¥è¯¢ï¼Œå› æ­¤åœ¨domain.ymlä¸­éœ€è¦åœ¨slotséƒ¨åˆ†å®šä¹‰ä¸¤ä¸ªæ’æ§½ï¼Œå³<code>city</code>å’Œ<code>datatime</code>ï¼Œè€Œ<code>matches</code>åˆ™ç”¨æ¥å­˜å‚¨æœ€åæŸ¥è¯¢çš„ç»“æœã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class=" language-bash"><code class="language-bash">slots:  city:    type: text    initial_value:<span class="token string">"åŒ—äº¬"</span>  datatime:    type:text    initial_value:<span class="token string">"æ˜å¤©"</span>  matches:    type:unfeaturized    initial_value:<span class="token string">"none"</span></code></pre><p><strong>Slot Typesç±»å‹ï¼š</strong></p><ul><li><p><code>Text Slot</code> ï¼šæ–‡æœ¬</p></li><li><p><code>Boolean Slot</code>ï¼šå¸ƒå°”å€¼</p></li><li><p>Categorical Slotï¼šæ¥å—æšä¸¾æ‰€åˆ—çš„å€¼</p><pre class=" language-bash"><code class="language-bash">slots:   risk_level:      type: categorical      values:      - low      - medium      - high</code></pre></li><li><p>Float Slotï¼šæµ®ç‚¹å‹</p><pre class=" language-bash"><code class="language-bash">slots:   temperature:      type: float      min_value: -100.0      max_value:  100.0</code></pre><pre><code>Defaults: max_value=1.0, min_value=0.0</code></pre><p>è®¾ç½®max_valueå’Œmin_valueåï¼Œå¤§äºmax_valueå’Œå°äºmin_valueçš„å€¼è¢«è®¾ä¸ºmax_valueå’Œmin_valueã€‚</p></li><li><p><code>List Slot</code>ï¼šåˆ—è¡¨å‹æ•°æ®ï¼Œä¸”é•¿åº¦ä¸å½±å“å¯¹è¯</p></li><li><p><code>Unfeaturized Slot</code>ï¼šå­˜å‚¨ä¸å½±å“ä¼šè¯æµç¨‹çš„æ•°æ®ã€‚</p></li></ul><p>å¦‚æœå€¼æœ¬èº«å¾ˆé‡è¦ï¼Œè¯·ä½¿ç”¨<code>categorical</code>æˆ–<code>bool</code>æ§½ã€‚è¿˜æœ‰<code>float</code>å’Œ<code>list slots</code>ã€‚å¦‚æœæ‚¨åªæƒ³å­˜å‚¨ä¸€äº›æ•°æ®ï¼Œä½†ä¸å¸Œæœ›å®ƒå½±å“ä¼šè¯æµï¼Œè¯·ä½¿ç”¨<code>unfeaturized</code>çš„æ’æ§½ã€‚<code>type</code>è¡¨ç¤ºslotå­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œ<code>initial_value</code>ä¸ºslotåˆå§‹å€¼ï¼Œè¯¥å€¼å¯æœ‰å¯æ— (æ— æ„ä¹‰)ã€‚</p><pre class=" language-bash"><code class="language-bash">slots:  name:    type: text    initial_value: <span class="token string">"human"</span>  matches:    type:unfeaturized</code></pre><h4 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h4><p>å½“Rasa NLUè¯†åˆ«åˆ°ç”¨æˆ·è¾“å…¥ä¿¡æ¯çš„æ„å›¾åï¼ŒRasa Coreå¯¹è¯ç®¡ç†æ¨¡å—ä¼šå¯¹å…¶ä½œå‡ºå›åº”ï¼Œå›åº”çš„æ“ä½œå°±æ˜¯actionã€‚<br> Rasa Coreæ”¯æŒä¸‰ç§actionï¼š</p><ul><li><p>default actions</p><p>ï¼šé»˜è®¤çš„ä¸€ç»„åŠ¨ä½œï¼Œæ— éœ€å®šä¹‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</p><ul><li><strong>action_listen</strong>ï¼šç›‘å¬action</li><li><strong>action_restart</strong>ï¼šé‡ç½®çŠ¶æ€</li><li><strong>action_default_fallback</strong>ï¼šå½“Rasa Coreå¾—åˆ°çš„ç½®ä¿¡åº¦ä½äºè®¾ç½®çš„é˜ˆå€¼æ—¶ï¼Œé»˜è®¤æ‰§è¡Œè¯¥åŠ¨ä½œã€‚</li></ul></li><li><p>utter actions</p><p>ï¼šä»¥utter_ä¸ºå¼€å¤´ï¼Œåªå‘é€ä¸€æ¡ä¿¡æ¯ç»™ç”¨æˆ·ä½œä¸ºåé¦ˆçš„åŠ¨ä½œã€‚</p><p>å®šä¹‰å¾ˆç®€å•ï¼Œåªéœ€åœ¨domain.ymlæ–‡ä»¶ä¸­çš„<code>actions:</code>å­—æ®µå®šä¹‰ä»¥<code>utter_</code>ä¸ºå¼€å¤´å³å¯ã€‚å…·ä½“çš„å›å¤å†…å®¹å°†è¢«å®šä¹‰åœ¨<code>templates</code>éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰<code>utter_</code>è¿™ä¸ªå‰ç¼€ï¼Œé‚£ä¹ˆ<code>action</code>å°±ä¼šè¢«è¯†åˆ«ä¸º<code>custom actions</code>ã€‚</p><pre class=" language-undefined"><code class="language-undefined">actions:  - utter_greet  - utter_cheer_up</code></pre></li><li><p>custom actions</p><p>ï¼šè‡ªå®šä¹‰åŠ¨ä½œï¼Œå…è®¸å¼€å‘è€…æ‰§è¡Œä»»ä½•æ“ä½œå¹¶åé¦ˆç»™ç”¨æˆ·ï¼Œæ˜¯actionå¤šè½®çš„å…³é”®ç‚¹ã€‚éœ€è¦åœ¨domain.yml</p><p>æ–‡ä»¶ä¸­çš„<code>actions</code>éƒ¨åˆ†å…ˆå®šä¹‰ï¼Œç„¶ååœ¨æŒ‡å®šçš„<code>webserver</code>ä¸­å®ç°å®ƒã€‚å…¶ä¸­ï¼Œwebserverçš„<code>url</code></p><p>åœ°å€åœ¨<code>endpoint.yml</code>æ–‡ä»¶ä¸­æŒ‡å®šã€‚</p><p>å®˜æ–¹æä¾›äº†ä¸€ä¸ªå°çš„python sdkæ¥æ–¹ä¾¿ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰çš„actionï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸‹å¯¹åº”çš„<code>rasa_core_sdk</code>åç»­å†è®²ã€‚ã€‚</p><pre class=" language-bash"><code class="language-bash">actions:  - action_search_weather</code></pre></li></ul><p><strong>templates</strong><br>æ­¤æ¬¡å®šä¹‰äº†<code>utter actions</code>å…·ä½“çš„å›å¤å†…å®¹ï¼Œä¸”æ¯ä¸ª<code>utter actions</code>ä¸‹å¯ä»¥<strong>å®šä¹‰å¤šæ¡</strong>å›å¤ä¿¡æ¯ã€‚å½“ç”¨æˆ·å‘èµ·ä¸€ä¸ªæ„å›¾ï¼Œæ¯”å¦‚â€ä½ å¥½ï¼â€ï¼Œå°±è§¦å‘<code>utter_greet</code>æ“ä½œï¼ŒRasa Coreä¼šä»è¯¥actionçš„æ¨¡æ¿ä¸­è‡ªåŠ¨é€‰æ‹©å…¶ä¸­çš„ä¸€æ¡ä¿¡æ¯ä½œä¸ºç»“æœåé¦ˆç»™ç”¨æˆ·ã€‚</p><pre class=" language-bash"><code class="language-bash">templates:  utter_greet:    - text: <span class="token string">"æ‚¨å¥½ï¼è¯·é—®æˆ‘å¯ä»¥å¸®åˆ°æ‚¨å—ï¼Ÿ"</span>    - text: <span class="token string">"æ‚¨å¥½ï¼è¯·è¯´å‡ºæ‚¨è¦æŸ¥è¯¢çš„å…·ä½“ä¸šåŠ¡ï¼Œæ¯”å¦‚è·Ÿæˆ‘è¯´'æŸ¥è¯¢èº«ä»½è¯å·ç '"</span>    - text: <span class="token string">"æ‚¨å¥½ï¼"</span></code></pre><p><code>utter_default</code>æ˜¯Rasa Coreé»˜è®¤çš„<code>action_default_fallback</code>ï¼Œå½“Rasa NLUè¯†åˆ«è¯¥æ„å›¾æ—¶ï¼Œå®ƒçš„ç½®ä¿¡åº¦ä½äºè®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šé»˜è®¤æ‰§è¡Œutter_defaultä¸­çš„æ¨¡æ¿ã€‚</p><p>é™¤äº†å›å¤ç®€å•çš„Text Messageï¼ŒRasa Coreè¿˜æ”¯æŒåœ¨Text Messageåæ·»åŠ <strong>æŒ‰é’®å’Œå›¾ç‰‡</strong>ï¼Œä»¥åŠ<strong>è®¿é—®æ’æ§½ä¸­çš„å€¼</strong>ï¼ˆå¦‚æœè¯¥æ’æ§½çš„å€¼æœ‰è¢«å¡«å……çš„è¯ï¼Œå¦åˆ™è¿”å›Noneï¼‰ã€‚ä¸¾ä¸ªæ —å­</p><pre class=" language-bash"><code class="language-bash">  utter_introduce_self:    - text: <span class="token string">"æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIæœºå™¨äººå‘€~"</span>      image: <span class="token string">"https://i.imgur.com/sayhello.jpg"</span>  utter_introduce_selfcando:    - text: <span class="token string">"æˆ‘èƒ½å¸®ä½ æŸ¥è¯¢å¤©æ°”ä¿¡æ¯"</span>      buttons:        - title: <span class="token string">"å¥½çš„"</span>          payload: <span class="token string">"ok"</span>            - title: <span class="token string">"ä¸äº†"</span>          payload: <span class="token string">"no"</span>  utter_ask_city:    - text: <span class="token string">"è¯·é—®æ‚¨è¦æŸ¥è¯¢&amp;#123; datetime &amp;#125;å“ªé‡Œçš„å¤©æ°”ï¼Ÿ"</span>    utter_ask_datetime:    - text: <span class="token string">"è¯·é—®æ‚¨è¦æŸ¥è¯¢&amp;#123; city &amp;#125;å“ªå¤©çš„å¤©æ°”"</span></code></pre><p><strong>ä¸€ä¸ªç¤ºä¾‹ï¼š</strong></p><pre class=" language-bash"><code class="language-bash">intents:  - greet  - goodbye  - affirm  - deny  - search_weatherslots:    city:        type: text    matches:        type: unfeaturizedentities:    - cityactions:    - utter_greet    - utter_cheer_up    - utter_did_that_help    - utter_happy    - utter_goodbyetemplates:  utter_greet:  - text: <span class="token string">"Hey! How are you?"</span>  utter_cheer_up:  - text: <span class="token string">"Here is something to cheer you up:"</span>    image: <span class="token string">"https://i.imgur.com/nGF1K8f.jpg"</span>  utter_did_that_help:  - text: <span class="token string">"Did that help you?"</span>  utter_happy:  - text: <span class="token string">"Great carry on!"</span>  utter_goodbye:  - text: <span class="token string">"Bye"</span>  utter_default:    - text: <span class="token string">"å°xè¿˜åœ¨å­¦ä¹ ä¸­ï¼Œè¯·æ¢ç§è¯´æ³•å§~"</span>    - text: <span class="token string">"å°xæ­£åœ¨å­¦ä¹ ä¸­ï¼Œç­‰æˆ‘å‡çº§äº†æ‚¨å†è¯•è¯•å§~"</span>    - text: <span class="token string">"å¯¹ä¸èµ·ï¼Œä¸»äººï¼Œæ‚¨è¦æŸ¥è¯¢çš„åŠŸèƒ½å°xè¿˜æ²¡å­¦ä¼šå‘¢~"</span></code></pre><h3 id="3-è®­ç»ƒå¯¹è¯æ¨¡å‹"><a href="#3-è®­ç»ƒå¯¹è¯æ¨¡å‹" class="headerlink" title="3. è®­ç»ƒå¯¹è¯æ¨¡å‹"></a>3. è®­ç»ƒå¯¹è¯æ¨¡å‹</h3><p>å‡†å¤‡å¥½domain.ymlå’Œsotries.mdæ•°æ®ä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒäº†ã€‚<br>æ¨¡å‹çš„è¾“å…¥æ•°æ®æ˜¯å†å²å¯¹è¯è®°å½•ï¼Œlableæ˜¯ä¸‹ä¸€ä¸ªå†³ç­–actionã€‚æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯num_actionsä¸ªç±»åˆ«çš„å¤šåˆ†ç±»ã€‚</p><p><strong>è®­ç»ƒå‘½ä»¤å¦‚ä¸‹ï¼š</strong></p><pre class=" language-python"><code class="language-python">python <span class="token operator">-</span>m rasa_core<span class="token punctuation">.</span>train <span class="token operator">-</span>d domain<span class="token punctuation">.</span>yml <span class="token operator">-</span>s stories<span class="token punctuation">.</span>md <span class="token operator">-</span>o models<span class="token operator">/</span>chat1</code></pre><p><strong>å‚æ•°è§£é‡Šï¼š</strong></p><p><strong>å‚æ•°è§£é‡Šï¼š</strong></p><ul><li>**<code>-dæˆ–--domain</code>**ï¼šæŒ‡domain.ymlæ–‡ä»¶çš„è·¯å¾„</li><li>**<code>-sæˆ–--stories</code>**ï¼šæŒ‡å®šstories.mdæ–‡ä»¶è·¯å¾„ã€‚å¯ä»¥å°†æ•…äº‹è¯·å‡ä¿å­˜åœ¨ä¸€ä¸ªmdæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ†ç±»ä¿å­˜åœ¨å¤šä¸ªmdæ–‡ä»¶ä¸­ï¼ˆå­˜æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼‰</li><li>**<code>-oæˆ–--out</code>**ï¼šæŒ‡å¯¹è¯æ¨¡å‹çš„è¾“å‡ºè·¯å¾„ï¼Œä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶</li><li>**<code>-cæˆ–--c</code>**ï¼šæŒ‡å®šPolicyè§„èŒƒæ–‡ä»¶</li></ul><p><strong>è®­ç»ƒæ‰€éœ€æ•°æ®ç¤ºä¾‹ï¼š</strong></p><pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">intent</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> greet  <span class="token punctuation">-</span> goodbye  <span class="token punctuation">-</span> search_weather<span class="token key atrule">entities</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> city<span class="token key atrule">actions</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> utter_greet  <span class="token punctuation">-</span> utter_goodbye  <span class="token punctuation">-</span> utter_ask_city<span class="token key atrule">templates</span><span class="token punctuation">:</span>  <span class="token key atrule">utter_greet</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"ä½ å¥½å•Š"</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"åˆè§é¢äº†"</span>  <span class="token key atrule">utter_goodbye</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"å†è§"</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"ä¸‹æ¬¡å†è§å•Š"</span>  <span class="token key atrule">utter_ask_city</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®æ‚¨è¦æŸ¥è¯¢å“ªé‡Œçš„å¤©æ°”ï¼Ÿ"</span></code></pre><p><strong>stories.mdæ–‡ä»¶ï¼š</strong></p><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true">## search weather</span>* greet  <span class="token punctuation">-</span> utter_greet* search_weather&amp;<span class="token comment" spellcheck="true">#123; "datatime" : "æ˜å¤©"&amp;#125;</span>  <span class="token punctuation">-</span> utter_ask_city* goodbye  <span class="token punctuation">-</span> utter_goodbye</code></pre><p><strong>è®­ç»ƒç½‘ç»œç»“æ„ï¼š</strong></p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/3.png"></p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/4.png"></p><h4 id="æµ‹è¯•å¯¹è¯æ¨¡å‹"><a href="#æµ‹è¯•å¯¹è¯æ¨¡å‹" class="headerlink" title="æµ‹è¯•å¯¹è¯æ¨¡å‹"></a>æµ‹è¯•å¯¹è¯æ¨¡å‹</h4><p>ç»è¿‡è®­ç»ƒï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†å¯¹è¯æ¨¡å‹ï¼Œé‚£ç°åœ¨æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>æµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class=" language-py"><code class="language-py">python -m rasa_core.run -d models/chat1</code></pre><p>å‚æ•°<code>-d</code>ï¼šæŒ‡å®šæ¨¡å‹è·¯å¾„</p><p>æ³¨ï¼šæ­¤æ—¶æµ‹è¯•rasa_coreå¯¹è¯æ¨¡å‹ï¼Œå¹¶æ²¡æœ‰åŠ å…¥core_nluæ¨¡å‹ï¼Œå› æ­¤è¿˜æ— æ³•è¿›è¡Œæ„å›¾è¯†åˆ«ï¼Œåªèƒ½å¤Ÿæ ¹æ®å·²çŸ¥çš„æ„å›¾ï¼ˆè¾“å…¥æ„å›¾ï¼‰è¿”å›ç‰¹å®šçš„ç­”æ¡ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥åœ¨domain.ymlä¸­å®šä¹‰å¥½çš„æ„å›¾ï¼Œè¾“å…¥æ„å›¾ä»¥<code>/</code>ç¬¦å·å¼€å¤´ã€‚<br>å¦‚è¾“å…¥greetæ„å›¾ï¼š<code>/greet</code></p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/5.png"></p><h2 id="æµ‹è¯•èŠå¤©æœºå™¨äºº"><a href="#æµ‹è¯•èŠå¤©æœºå™¨äºº" class="headerlink" title="æµ‹è¯•èŠå¤©æœºå™¨äºº"></a>æµ‹è¯•èŠå¤©æœºå™¨äºº</h2><p>é€šè¿‡å‰é¢çš„æ­¥éª¤ï¼Œå·²ç»è®­ç»ƒäº†Rasa_nluçš„æ„å›¾è¯†åˆ«æ¨¡å‹å’ŒRasa_Coreçš„å¯¹è¯æ¨¡å‹ã€‚æ¥ä¸‹æ¥å°±è¿›è¡Œä¸¤è€…çš„æ•´ä½“çš„æµ‹è¯•ã€‚</p><ul><li>è¾“å…¥ï¼šå¾…æµ‹è¯•æ–‡æœ¬</li><li>è¾“å‡ºï¼šæœºå™¨äººå›åº”</li><li>ä¸­é—´è¿‡ç¨‹ï¼šåŒ…å«æ„å›¾è¯†åˆ«ã€å®ä½“è¯†åˆ«å’Œä¼šè¯æµç¨‹</li></ul><p><strong>æµ‹è¯•å‘½ä»¤</strong><br><code>python -m rasa_core.run -d models/chat1 -u models/nlu/model_20190820-105546</code></p><p><strong>å‚æ•°è§£é‡Š;</strong></p><ul><li><code>-d</code>ï¼šmodeldir æŒ‡å®šå¯¹è¯æ¨¡å‹è·¯å¾„ï¼ˆå³Rasa_coreè®­ç»ƒçš„æ¨¡å‹è·¯å¾„ï¼‰</li><li><code>-u</code>ï¼šRasa NLUè®­ç»ƒçš„æ¨¡å‹è·¯å¾„</li><li><code>--port</code>ï¼šæŒ‡å®šRasa Core Webåº”ç”¨è¿è¡Œçš„ç«¯å£å·</li><li><code>--credentials</code>ï¼šæŒ‡å®šé€šé“ï¼ˆinput channelsï¼‰å±æ€§</li><li><code>--endpoints</code>ï¼šç”¨äºæŒ‡å®šRasa Coreè¿æ¥å…¶ä»–web serverçš„urlåœ°å€ï¼Œæ¯”å¦‚nlu web</li><li><code>-o</code>ï¼šæŒ‡å®šlogæ—¥å¿—æ–‡ä»¶è¾“å‡ºè·¯å¾„</li><li><code>--debug</code>ï¼šæ‰“å°è°ƒè¯•ä¿¡æ¯ã€‚åœ¨æ˜¾ç¤ºçš„ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾“å…¥messageåRasa NLUæ¨¡å‹æ˜¯å¦è¯†åˆ«å‡ºæ„å›¾ã€å®ä½“åŠå…¶ç½®ä¿¡åº¦ä¿¡æ¯ã€‚æ§½ä½çš„å¡«å……ä»¥åŠpolicyé¢„æµ‹çš„ä¸‹ä¸€ä¸ªactionä¿¡æ¯ã€‚</li></ul><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/6.png"></p><p>åŠ å…¥<code>--debug</code>å‚æ•°åæ‰“å°å‡ºçš„è°ƒè¯•ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="/2020/09/18/rasa-shi-yong-zhi-nan/7.png"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/5d9aa2a444a3">rasaå¯¹è¯ç³»ç»Ÿè¸©å‘è®°</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> èŠå¤©ç³»ç»Ÿ </tag>
            
            <tag> rasa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sklearnæœºå™¨å­¦ä¹ åŸç†æ±‡æ€»</title>
      <link href="/2020/09/17/ji-qi-xue-xi-yuan-li-hui-zong/"/>
      <url>/2020/09/17/ji-qi-xue-xi-yuan-li-hui-zong/</url>
      
        <content type="html"><![CDATA[<h1 id="sklearnæœºå™¨å­¦ä¹ æ±‡æ€»"><a href="#sklearnæœºå™¨å­¦ä¹ æ±‡æ€»" class="headerlink" title="sklearnæœºå™¨å­¦ä¹ æ±‡æ€»"></a>sklearnæœºå™¨å­¦ä¹ æ±‡æ€»</h1><h2 id="sklearn-å»ºæ¨¡æµç¨‹"><a href="#sklearn-å»ºæ¨¡æµç¨‹" class="headerlink" title="sklearn å»ºæ¨¡æµç¨‹"></a>sklearn å»ºæ¨¡æµç¨‹</h2><p>æ•°æ®é›†å¤„ç†</p><ul><li><strong>æ•°æ®é›†åŠ è½½</strong> X=[],æ ‡ç­¾Y=[] , æ¯”ä¾‹X:Y=1:1</li><li><strong>æ•°æ®é›†åˆ†ç±»</strong> <code>train_test_split</code> -&gt;ï¼ˆX_train,X_test,y_train,y_testï¼‰</li></ul><p>ç‰¹å¾æå–</p><ul><li><strong>ç‰¹å¾æå–</strong>ï¼ˆç›´æ–¹å›¾ã€è½®å»“æè¿°å­â€¦ç‰¹å¾æ•°ç»„ï¼‰</li></ul><p>è®­ç»ƒæ¨¡å‹</p><ul><li><strong>ç‰¹å¾åˆ†ç±»</strong>ï¼ˆæ„é€ åˆ†ç±»å™¨ï¼ˆlrçº¿æ€§åˆ†ç±»ï¼Œsvmæ”¯æŒå‘é‡æœºåˆ†ç±»ï¼Œbeyesè´å¶æ–¯åˆ†ç±»â€¦ï¼‰ï¼‰</li><li>ç”¨<strong>è®­ç»ƒ</strong>æ•°æ®ï¼ˆX_train,y_trainï¼‰æ‹Ÿåˆåˆ†ç±»å™¨<strong>æ¨¡å‹</strong> ã€<strong>ä¿å­˜æ¨¡å‹</strong></li></ul><p>é¢„æµ‹</p><ul><li>é¢„æµ‹ <code>result = predit(X_test)</code></li><li>åˆ†æ <code>classification_report (result)</code></li></ul><h2 id="sklearn-API"><a href="#sklearn-API" class="headerlink" title="sklearn API"></a>sklearn API</h2><p>Key_Word</p><p>æ•°æ®è·å–: sklearn, <strong>datasets</strong>, DataFrame, load_*</p><p>æ•°æ®æ ‡å‡†åŒ–**: preprocessing**, <strong>MinMaxScaler</strong>, scaler, <strong>fit</strong>, <strong>transform</strong>, data, target</p><p>åˆ’åˆ†æµ‹è¯•é›†: model_selection, <strong>train_test_split</strong>, test_size</p><p>è®­ç»ƒæ¨¡å‹: fit ,predict, <strong>kernel=â€linearâ€</strong>, <strong>probability=True</strong></p><p>æ¨¡å‹è¯„ä¼°: <strong>score,</strong> <strong>predict_proba</strong></p><p>ä½¿ç”¨metricsæ¨¡å—è¯„ä¼°: classification_report</p><p>ä½¿ç”¨äº¤å‰éªŒè¯æ–¹æ³•è¯„ä¼°: cross_val_score</p><p>æ¨¡å‹çš„ä¼˜åŒ–: <strong>GridSearchCV</strong>, C, kernel, gamma, param_grid, svc, cv</p><p>æ¨¡å‹æŒä¹…åŒ–: pikle, joblib, dump, load</p><h2 id="æ€»ä½“æµç¨‹"><a href="#æ€»ä½“æµç¨‹" class="headerlink" title="æ€»ä½“æµç¨‹"></a>æ€»ä½“æµç¨‹</h2><h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><p>æ•°æ®é›†å¤„ç†ä¸­æˆ‘ä»¬å¸¸ç”¨åˆ°ï¼š</p><ul><li>datasets ï¼š æ˜¯sklearnåº“è‡ªå¸¦çš„æ•°æ®é›†ï¼ˆirisé¸¢å°¾èŠ±æ•°æ®ç­‰ï¼‰ï¼Œå‰æœŸå­¦ä¹ éå¸¸å‹å¥½</li><li>train_test_split å°†æ•°æ®åˆ†ä¸ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets<span class="token comment" spellcheck="true">#å¼•å…¥æ•°æ®é›†,sklearnåŒ…å«ä¼—å¤šæ•°æ®é›†</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split<span class="token comment" spellcheck="true">#å°†æ•°æ®åˆ†ä¸ºæµ‹è¯•é›†å’Œè®­ç»ƒé›†</span>iris <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å¼•å…¥irisé¸¢å°¾èŠ±æ•°æ®,irisæ•°æ®åŒ…å«4ä¸ªç‰¹å¾å˜é‡</span>X <span class="token operator">=</span> iris<span class="token punctuation">.</span>data <span class="token comment" spellcheck="true"># ç‰¹å¾å˜é‡</span>y <span class="token operator">=</span> iris<span class="token punctuation">.</span>target <span class="token comment" spellcheck="true"># ç›®æ ‡å€¼</span>X_train<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#åˆ©ç”¨train_test_splitè¿›è¡Œå°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†è¿›è¡Œåˆ†å¼€ï¼Œtest_sizeå 30%</span><span class="token keyword">print</span><span class="token punctuation">(</span>y_train<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#æˆ‘ä»¬çœ‹åˆ°è®­ç»ƒæ•°æ®çš„ç‰¹å¾å€¼åˆ†ä¸º3ç±»</span><span class="token number">12345678</span></code></pre><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>Sklearnçš„æ¨¡å‹å¯¼å‡ºæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨Pythonçš„Pickleæœºåˆ¶ã€‚å¯¹Pythonçš„å‡½æ•°è¿›è¡Œåºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯æŠŠè®­ç»ƒå¥½çš„Transformerå‡½æ•°åºåˆ—åŒ–å¹¶å­˜ä¸ºæ–‡ä»¶ã€‚</p><p><strong>.pkl</strong></p><p>pklæ–‡ä»¶æ˜¯pythoné‡Œé¢ä¿å­˜æ–‡ä»¶çš„ä¸€ç§æ ¼å¼ï¼Œå¦‚æœç›´æ¥æ‰“å¼€ä¼šæ˜¾ç¤ºä¸€å †åºåˆ—åŒ–çš„ä¸œè¥¿ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token comment" spellcheck="true"># é‡ç‚¹æ˜¯rbå’Œrçš„åŒºåˆ«ï¼Œrbæ˜¯æ‰“å¼€2è¿›åˆ¶æ–‡ä»¶ï¼Œæ–‡æœ¬æ–‡ä»¶ç”¨r</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'test.pkl'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token number">123456</span></code></pre><blockquote><p>å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/Allen-rg/p/9548539.html">sklearn ä¸­æ¨¡å‹ä¿å­˜çš„ä¸¤ç§æ–¹æ³•</a><br>æ—¢ç„¶joblibåœ¨ä½¿ç”¨ä¸Šæ¯”è¾ƒå®¹æ˜“ï¼Œè¯»å–é€Ÿåº¦ä¹Ÿç›¸å¯¹pickleå¿«ï¼Œé‚£ä¹ˆæˆ‘ä»¬åé¢å°±ç”¨joblibè¿›è¡Œè®¨è®ºã€‚</p></blockquote><p><strong>.m</strong></p><p>ä¿å­˜ ã€è¯»å–ã€é¢„æµ‹</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>externals <span class="token keyword">import</span> joblibjoblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>lr<span class="token punctuation">,</span> <span class="token string">'lr.model'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¿å­˜   lræ˜¯ä¸€ä¸ªLogisticRegressionæ¨¡å‹</span>lr <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'lr.model'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># åŠ è½½</span>lr<span class="token punctuation">.</span>predit<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é¢„æµ‹    æ­¤å¤„test_Xä¸ºç‰¹å¾é›†</span><span class="token number">1234567</span></code></pre><h4 id="ä¸€ä¸ªå®Œæ•´çš„svmåˆ†ç±»ä¾‹å­"><a href="#ä¸€ä¸ªå®Œæ•´çš„svmåˆ†ç±»ä¾‹å­" class="headerlink" title="ä¸€ä¸ªå®Œæ•´çš„svmåˆ†ç±»ä¾‹å­"></a>ä¸€ä¸ªå®Œæ•´çš„svmåˆ†ç±»ä¾‹å­</h4><ol><li>datasetï¼šç‰¹å¾æ•°ç»„Xï¼Œæ ‡ç­¾Yï¼Œæ¯”ä¾‹X:Y=1:1</li><li>clf ï¼š æ„é€ åˆ†ç±»å™¨ï¼ˆlrçº¿æ€§åˆ†ç±»ï¼Œsvmæ”¯æŒå‘é‡æœºåˆ†ç±»ï¼Œbeyesè´å¶æ–¯åˆ†ç±»â€¦ï¼‰</li><li>clf.fit()ï¼šç”¨è®­ç»ƒæ•°æ®æ‹Ÿåˆåˆ†ç±»å™¨æ¨¡å‹</li><li>joblib.dumpï¼šä¿å­˜æ¨¡å‹</li><li>joblib.loadï¼šåŠ è½½æ¨¡å‹</li><li>clf.predit()ï¼šé¢„æµ‹</li></ol><pre class=" language-python"><code class="language-python">os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span><span class="token string">"workspace/model_save"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¿å­˜Model(æ³¨:model_saveæ–‡ä»¶å¤¹è¦é¢„å…ˆå»ºç«‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™)</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>externals <span class="token keyword">import</span> joblib<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svmX <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>clf <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># clfæ˜¯è®­ç»ƒçš„åˆ†ç±»å™¨</span>clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>  clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span>train_y<span class="token punctuation">)</span>joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> <span class="token string">"train_model.m"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¿å­˜</span>clf <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"train_model.m"</span><span class="token punctuation">)</span>clf<span class="token punctuation">.</span>predit<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#æ­¤å¤„test_Xä¸ºç‰¹å¾é›†</span><span class="token number">123456789101112</span></code></pre><h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>externals <span class="token keyword">import</span> joblibClass <span class="token class-name">classificationTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#ä¿å­˜æ¨¡å‹</span>    <span class="token keyword">def</span> <span class="token function">Save_Model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>        joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>model<span class="token punctuation">,</span> filename<span class="token operator">=</span>filepath<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">SVM_classifier</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span><span class="token punctuation">:</span>        clf <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># clfæ˜¯è®­ç»ƒçš„åˆ†ç±»å™¨</span>        clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>Save_Model<span class="token punctuation">(</span>clf<span class="token punctuation">,</span><span class="token string">"train_model.m"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¿å­˜æ¨¡å‹</span>        <span class="token keyword">return</span> clf    <span class="token keyword">def</span> <span class="token function">Load_Model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>        <span class="token keyword">return</span> model    <span class="token keyword">def</span> <span class="token function">Predict_Model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> filpath<span class="token punctuation">)</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> self<span class="token punctuation">.</span>Load_Model<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>        result <span class="token operator">=</span> model<span class="token punctuation">.</span>predit<span class="token punctuation">(</span>x_test<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é¢„æµ‹</span>        <span class="token keyword">return</span> result<span class="token number">123456789101112131415161718192021</span></code></pre><h3 id="å…¶ä»–æ¨¡å‹"><a href="#å…¶ä»–æ¨¡å‹" class="headerlink" title="å…¶ä»–æ¨¡å‹"></a>å…¶ä»–æ¨¡å‹</h3><p>å…¶ä»–å‡ ç§æ¨¡å‹åç¼€çš„å¯¹æ¯”ï¼š</p><ul><li><p>.pb<br>MetaGraphçš„protocol bufferæ ¼å¼çš„æ–‡ä»¶ï¼ŒMetaGraphåŒ…æ‹¬è®¡ç®—å›¾ï¼Œæ•°æ®æµï¼Œä»¥åŠç›¸å…³çš„å˜é‡å’Œè¾“å…¥è¾“å‡ºã€‚</p><p>åœ¨tensorflowè®­ç»ƒä¸­ç›´æ¥ä¿å­˜ä¸ºpbä¸ºæ ¼å¼ï¼Œä¿å­˜pbçš„å¥½å¤„å°±æ˜¯ä½¿ç”¨åœºæ™¯æ˜¯å®ç°åˆ›å»ºæ¨¡å‹ä¸ä½¿ç”¨æ¨¡å‹çš„è§£è€¦ï¼Œä½¿å¾—åˆ›å»ºæ¨¡å‹ä¸ä½¿ç”¨æ¨¡å‹çš„è§£è€¦ï¼Œä½¿å¾—å‰å‘æ¨å¯¼inferenceä»£ç ç»Ÿä¸€ã€‚å¦å¤–çš„å¥½å¤„å°±æ˜¯ä¿å­˜ä¸ºpbçš„æ—¶å€™ï¼Œæ¨¡å‹çš„å˜é‡ä¼šå˜æˆå›ºå®šçš„ï¼Œå¯¼è‡´æ¨¡å‹çš„å¤§å°ä¼šå¤§å¤§å‡å°ã€‚</p></li><li><p>.dat<br>.datå¹¶ä¸æ˜¯ä¸€ç§æ ‡å‡†æ–‡ä»¶ã€‚DATAçš„æ„æ€ï¼Œå³æ•°æ®æ–‡ä»¶ï¼Œè¿™ç±»æ–‡ä»¶å¹¶æ²¡æœ‰è¿›è¡Œç»å¯¹åŒ–çš„å®šä¹‰ã€‚<br>åœ¨æ·±åº¦å­¦ä¹ é‡ŒæŒ‡å­˜æ”¾æ•°æ®çš„æ–‡ä»¶ã€‚</p></li><li><p>.h5å³ï¼ˆ.hdf5ï¼‰<br>HDF5æ˜¯ä¸€ç§å…¨æ–°çš„åˆ†å±‚æ•°æ®æ ¼å¼äº§å“ï¼Œç”±æ•°æ®æ ¼å¼è§„èŒƒå’Œæ”¯æŒåº“å®ç°ç»„æˆã€‚</p></li><li><p>.ckpt<br>è¿™ç§æ¨¡å‹æ–‡ä»¶æ˜¯ä¾èµ– TensorFlow çš„ï¼Œåªèƒ½åœ¨å…¶æ¡†æ¶ä¸‹ä½¿ç”¨ã€‚</p><p>checkpointæ–‡ä»¶ï¼šç”¨äºå‘ŠçŸ¥æŸäº›TFå‡½æ•°ï¼Œè¿™æ˜¯æœ€æ–°çš„æ£€æŸ¥ç‚¹æ–‡ä»¶ã€‚<br>.dataæ–‡ä»¶ï¼šä¿å­˜å›¾ä¸­æ‰€æœ‰å˜é‡çš„å€¼ï¼Œæ²¡æœ‰ç»“æ„ã€‚<br>.indexæ–‡ä»¶ï¼šä¿å­˜ç´¢å¼•ã€‚<br>.metaæ–‡ä»¶ï¼šä¿å­˜è®¡ç®—å›¾çš„ç»“æ„ï¼Œä½†æ˜¯ä¸åŒ…å«é‡Œé¢å˜é‡çš„å€¼ã€‚</p></li></ul><h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>ä»‹ç»ä¸€ä¸ªsklearnä¸­é«˜æ•ˆçš„åˆ†æå‡½æ•°ï¼š<code>classification_report ()</code></p><p>ä½¿ç”¨ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_reportclf <span class="token operator">=</span> BernoulNB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>XX_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¼¯åŠªåˆ©è´å¶æ–¯åˆ†ç±»å™¨</span>os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span><span class="token string">"model/"</span><span class="token punctuation">)</span><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>externals <span class="token keyword">import</span> joblib<span class="token keyword">import</span> timeticks <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y_%m_%d_%H_%M_%S"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>joblib<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> ticks<span class="token operator">+</span><span class="token string">"train_model.m"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#joblib.dump(clf, ticks+"train_model.pkl")</span>clf <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"train_model.m"</span><span class="token punctuation">)</span>predictions_lables <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>XX_test<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ä½¿ç”¨æµ‹è¯•é›†é¢„æµ‹ç»“æœ</span><span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">"é¢„æµ‹ç»“æœ"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>predictions_lables<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## ç”Ÿæˆæ–‡æœ¬è¡Œåˆ†ç±»æŠ¥å‘Š</span><span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">"ç®—æ³•æŠ¥å‘Š"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> predictions_labels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#ç”Ÿæˆå­—å…¸æŠ¥å‘Š</span>report <span class="token operator">=</span> classifcation_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> predictions_labels<span class="token punctuation">,</span> output_dict<span class="token operator">=</span>true<span class="token punctuation">)</span></code></pre><h3 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h3><h2 id="sklearnä¸­çš„å¸¸è§„æ¨¡å‹"><a href="#sklearnä¸­çš„å¸¸è§„æ¨¡å‹" class="headerlink" title="sklearnä¸­çš„å¸¸è§„æ¨¡å‹"></a>sklearnä¸­çš„å¸¸è§„æ¨¡å‹</h2><h3 id="å†³ç­–æ ‘"><a href="#å†³ç­–æ ‘" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h3><p>æ¨¡å‹è¯„ä¼°ï¼ˆå¾…å†™ï¼‰</p><a href="/2020/09/17/jue-ce-shu-yuan-li/" title="å†³ç­–æ ‘åŸç†">å†³ç­–æ ‘åŸç†</a><a href="/2020/09/18/sui-ji-sen-lin-yuan-li/" title="éšæœºæ£®æ—åŸç†">éšæœºæ£®æ—åŸç†</a><a href="/2020/09/19/ju-lei-suan-fa-yuan-li/" title="èšç±»ç®—æ³•åŸç†">èšç±»ç®—æ³•åŸç†</a><a href="/2020/09/20/svm-yuan-li/" title="SVMåŸç†">SVMåŸç†</a><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒã€€"></a>å‚è€ƒã€€</h2><p><a href="https://www.cnblogs.com/draven123/p/11408086.html">https://www.cnblogs.com/draven123/p/11408086.html</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†³ç­–æ ‘åŸç†</title>
      <link href="/2020/09/17/jue-ce-shu-yuan-li/"/>
      <url>/2020/09/17/jue-ce-shu-yuan-li/</url>
      
        <content type="html"><![CDATA[<h1 id="å†³ç­–æ ‘"><a href="#å†³ç­–æ ‘" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h1><p> (Tree)æ˜¯ä¸€ç§éå‚æ•°çš„æœ‰ç›‘ç£å­¦ä¹ æ–¹æ³•,å®ƒèƒ½å¤Ÿä»ä¸€ç³»åˆ—æœ‰ç‰¹å¾å’Œæ ‡ç­¾çš„æ•°æ®ä¸­æ€»ç»“å‡ºå†³ç­–è§„åˆ™,å¹¶ç”¨æ ‘çŠ¶å›¾çš„ç»“æ„æ¥å‘ˆç°è¿™äº›è§„åˆ™,ä»¥è§£å†³åˆ†ç±»å’Œå›å½’é—®é¢˜ã€‚</p><p>è¿™äº›ç®—æ³•åŸºæœ¬éƒ½æ‰§è¡Œâ€è´ªå¿ƒç­–ç•¥â€œ,å³é€šè¿‡å±€éƒ¨çš„æœ€ä¼˜æ¥è¾¾åˆ°æˆ‘ä»¬ç›¸ä¿¡æ˜¯æœ€æ¥è¿‘å…¨å±€æœ€ä¼˜çš„ç»“æœã€‚åªè€ƒè™‘å½“å‰çº¯åº¦å·®æœ€å¤§çš„æƒ…å†µä½œä¸ºåˆ†å‰²ç‚¹ã€‚</p><p>Huntç®—æ³•æ˜¯è®¸å¤šå†³ç­–æ ‘ç®—æ³•çš„åŸºç¡€,åŒ…æ‹¬ID3ã€C4.5å’ŒCARTç­‰ã€‚</p><p><strong>å†³ç­–æ ‘æ„å»ºåŸºæœ¬æ­¥éª¤</strong></p><p> 1ï¼‰ å¼€å§‹ï¼Œæ‰€æœ‰è®°å½•çœ‹ä½œä¸€ä¸ªèŠ‚ç‚¹</p><p> 2ï¼‰éå†æ¯ä¸ªå˜é‡çš„æ¯ä¸€ç§åˆ†å‰²æ–¹å¼ï¼Œæ‰¾åˆ°æœ€å¥½çš„åˆ†å‰²ç‚¹</p><p> 3ï¼‰åˆ†å‰²æˆä¸¤ä¸ªèŠ‚ç‚¹N1å’ŒN2</p><ol start="4"><li>å¯¹N1å’ŒN2åˆ†åˆ«ç»§ç»­æ‰§è¡Œ2-3æ­¥ï¼Œç›´åˆ°æ¯ä¸ªèŠ‚ç‚¹è¶³å¤Ÿâ€œçº¯â€ä¸ºæ­¢</li></ol><p><img src="/2020/09/17/jue-ce-shu-yuan-li/1.png"></p><h2 id="æ¨¡å—sklearn-tree"><a href="#æ¨¡å—sklearn-tree" class="headerlink" title="æ¨¡å—sklearn.tree"></a>æ¨¡å—sklearn.tree</h2><p>sklearnä¸­å†³ç­–æ ‘çš„ç±»éƒ½åœ¨â€treeâ€œè¿™ä¸ªæ¨¡å—ä¹‹ä¸‹ã€‚è¿™ä¸ªæ¨¡å—æ€»å…±åŒ…å«äº”ä¸ªç±»:</p><table><thead><tr><th>tree.DecisionTreeClassifier</th><th>åˆ†ç±»æ ‘</th></tr></thead><tbody><tr><td>tree.DecisionTreeRegressor</td><td>å›å½’æ ‘</td></tr><tr><td>tree.export_graphviz</td><td>å°†ç”Ÿæˆçš„å†³ç­–æ ‘å¯¼å‡ºä¸ºDOTæ ¼å¼,ç”»å›¾ä¸“ç”¨</td></tr><tr><td>tree.ExtraTreeClassifier</td><td>é«˜éšæœºç‰ˆæœ¬çš„åˆ†ç±»æ ‘</td></tr><tr><td>tree.ExtraTreeRegressor</td><td>é«˜éšæœºç‰ˆæœ¬çš„å›å½’æ ‘</td></tr></tbody></table><h2 id="DecisionTreeClassiï¬er"><a href="#DecisionTreeClassiï¬er" class="headerlink" title="DecisionTreeClassiï¬er"></a>DecisionTreeClassiï¬er</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">sklearn</span><span class="token punctuation">.</span>tree<span class="token punctuation">.</span>DecisionTreeClassifier <span class="token punctuation">(</span>criterion<span class="token operator">=</span>â€™giniâ€™<span class="token punctuation">,</span> splitter<span class="token operator">=</span>â€™bestâ€™<span class="token punctuation">,</span> max_depth<span class="token operator">=</span>None<span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_samples_leaf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> min_weight_fraction_leaf<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> max_features<span class="token operator">=</span>None<span class="token punctuation">,</span>random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> max_leaf_nodes<span class="token operator">=</span>None<span class="token punctuation">,</span> min_impurity_decrease<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> min_impurity_split<span class="token operator">=</span>None<span class="token punctuation">,</span>class_weight<span class="token operator">=</span>None<span class="token punctuation">,</span> presort<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><h3 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h3><ul><li><strong>criterion</strong></li></ul><p>ä¸ºäº†è¦å°†è¡¨æ ¼è½¬åŒ–ä¸ºä¸€æ£µæ ‘ï¼Œå†³ç­–æ ‘éœ€è¦æ‰¾å‡ºæœ€ä½³èŠ‚ç‚¹å’Œæœ€ä½³çš„åˆ†ææ–¹æ³•ï¼Œå¯¹åˆ†ç±»æ ‘æ¥è¯´ï¼Œè¡¡é‡è¿™ä¸ªâ€œæœ€ä½³â€çš„æŒ‡æ ‡</p><p>å«åšâ€œä¸çº¯åº¦â€ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸çº¯åº¦è¶Šä½ï¼Œå†³ç­–æ ‘å¯¹è®­ç»ƒé›†çš„æ‹Ÿåˆè¶Šå¥½ã€‚ç°åœ¨ä½¿ç”¨çš„å†³ç­–æ ‘ç®—æ³•åœ¨åˆ†ææ–¹æ³•ä¸Šçš„æ ¸å¿ƒ</p><p>å¤§å¤šæ˜¯å›´ç»•åœ¨å¯¹æŸä¸ªä¸çº¯åº¦ç›¸å…³æŒ‡æ ‡çš„æœ€ä¼˜åŒ–ä¸Šã€‚</p><p>ä¸çº¯åº¦åŸºäºèŠ‚ç‚¹æ¥è®¡ç®—ï¼Œæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ä¸€ä¸ªä¸çº¯åº¦ï¼Œå¹¶ä¸”å­èŠ‚ç‚¹çš„ä¸çº¯åº¦ä¸€å®šæ˜¯ä½äºçˆ¶èŠ‚ç‚¹çš„ï¼Œä¹Ÿå°±æ˜¯</p><p>è¯´ï¼Œåœ¨åŒä¸€æ£µå†³ç­–æ ‘ä¸Šï¼Œå¶å­èŠ‚ç‚¹çš„ä¸çº¯åº¦ä¸€å®šæ˜¯æœ€ä½çš„ã€‚</p><p>Criterionè¿™ä¸ªå‚æ•°æ­£æ˜¯ç”¨æ¥å†³å®šä¸çº¯åº¦çš„è®¡ç®—æ–¹æ³•çš„ã€‚sklearnæä¾›äº†ä¸¤ç§é€‰æ‹©ï¼š</p><p>1ï¼‰è¾“å…¥â€entropyâ€œï¼Œä½¿ç”¨<strong>ä¿¡æ¯ç†µ</strong>ï¼ˆEntropyï¼‰</p><p>2ï¼‰è¾“å…¥â€giniâ€œï¼Œä½¿ç”¨<strong>åŸºå°¼ç³»æ•°</strong>ï¼ˆGini Impurityï¼‰</p><ul><li><strong>random_state &amp; splitter</strong></li></ul><p>random_stateç”¨æ¥è®¾ç½®åˆ†æä¸­çš„éšæœºæ¨¡å¼çš„å‚æ•°ï¼Œé»˜è®¤Noneï¼Œåœ¨é«˜ç»´åº¦æ—¶éšæœºæ€§ä¼šè¡¨ç°æ›´æ˜æ˜¾ï¼Œä½ç»´åº¦çš„æ•°æ®ï¼ˆæ¯”å¦‚é¸¢å°¾èŠ±æ•°æ®é›†ï¼‰ï¼Œéšæœºæ€§å‡ ä¹ä¸ä¼šæ˜¾ç°ã€‚è¾“å…¥ä»»æ„æ•´æ•°ï¼Œä¼šä¸€ç›´é•¿å‡ºåŒä¸€æ£µæ ‘ï¼Œè®©æ¨¡å‹ç¨³å®šä¸‹æ¥ã€‚</p><p>splitterä¹Ÿæ˜¯ç”¨æ¥æ§åˆ¶å†³ç­–æ ‘ä¸­çš„éšæœºé€‰é¡¹çš„ï¼Œæœ‰ä¸¤ç§è¾“å…¥å€¼ï¼Œè¾“å…¥â€bestâ€ï¼Œå†³ç­–æ ‘åœ¨åˆ†ææ—¶è™½ç„¶éšæœºï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä¼˜å…ˆé€‰æ‹©æ›´é‡è¦çš„ç‰¹å¾è¿›è¡Œåˆ†æï¼ˆé‡è¦æ€§å¯ä»¥é€šè¿‡å±æ€§feature_importances_æŸ¥çœ‹ï¼‰ï¼Œè¾“å…¥â€œrandomâ€ï¼Œå†³ç­–æ ‘åœ¨åˆ†ææ—¶ä¼šæ›´åŠ éšæœºï¼Œæ ‘ä¼šå› ä¸ºå«æœ‰æ›´å¤šçš„ä¸å¿…è¦ä¿¡æ¯è€Œæ›´æ·±æ›´å¤§ï¼Œå¹¶å› è¿™äº›ä¸å¿…è¦ä¿¡æ¯è€Œé™ä½å¯¹è®­ç»ƒé›†çš„æ‹Ÿåˆã€‚è¿™ä¹Ÿæ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆçš„ä¸€ç§æ–¹å¼ã€‚å½“ä½ é¢„æµ‹åˆ°ä½ çš„æ¨¡å‹ä¼šè¿‡æ‹Ÿåˆï¼Œç”¨è¿™ä¸¤ä¸ªå‚æ•°æ¥å¸®åŠ©ä½ é™ä½æ ‘å»ºæˆä¹‹åè¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ã€‚å½“ç„¶ï¼Œæ ‘ä¸€æ—¦å»ºæˆï¼Œæˆ‘ä»¬ä¾ç„¶æ˜¯ä½¿ç”¨å‰ªæå‚æ•°æ¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p><ul><li><strong>å‰ªæå‚æ•°</strong></li></ul><p>åœ¨ä¸åŠ é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œä¸€æ£µå†³ç­–æ ‘ä¼šç”Ÿé•¿åˆ°è¡¡é‡ä¸çº¯åº¦çš„æŒ‡æ ‡æœ€ä¼˜ï¼Œæˆ–è€…æ²¡æœ‰æ›´å¤šçš„ç‰¹å¾å¯ç”¨ä¸ºæ­¢ã€‚è¿™æ ·çš„å†³ç­–æ ‘å¾€å¾€ä¼šè¿‡æ‹Ÿåˆï¼Œè¿™å°±æ˜¯è¯´ï¼Œ<strong>å®ƒä¼šåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¾ˆå¥½ï¼Œåœ¨æµ‹è¯•é›†ä¸Šå´è¡¨ç°ç³Ÿç³•ã€‚</strong>æˆ‘ä»¬æ”¶é›†çš„æ ·æœ¬æ•°æ®ä¸å¯èƒ½å’Œæ•´ä½“çš„çŠ¶å†µå®Œå…¨ä¸€è‡´ï¼Œå› æ­¤å½“ä¸€æ£µå†³ç­–æ ‘å¯¹è®­ç»ƒæ•°æ®æœ‰äº†è¿‡äºä¼˜ç§€çš„è§£é‡Šæ€§ï¼Œå®ƒæ‰¾å‡ºçš„è§„åˆ™å¿…ç„¶åŒ…å«äº†è®­ç»ƒæ ·æœ¬ä¸­çš„å™ªå£°ï¼Œå¹¶ä½¿å®ƒå¯¹æœªçŸ¥æ•°æ®çš„æ‹Ÿåˆç¨‹åº¦ä¸è¶³ã€‚</p><p>ä¸ºäº†è®©å†³ç­–æ ‘æœ‰æ›´å¥½çš„æ³›åŒ–æ€§ï¼Œæˆ‘ä»¬è¦å¯¹å†³ç­–æ ‘è¿›è¡Œå‰ªæã€‚<strong>å‰ªæç­–ç•¥å¯¹å†³ç­–æ ‘çš„å½±å“å·¨å¤§ï¼Œæ­£ç¡®çš„å‰ªæç­–ç•¥æ˜¯ä¼˜åŒ–å†³ç­–æ ‘ç®—æ³•çš„æ ¸å¿ƒã€‚</strong>sklearnä¸ºæˆ‘ä»¬æä¾›äº†ä¸åŒçš„å‰ªæç­–ç•¥ï¼š</p><p>1)<strong>max_depth</strong>  : é™åˆ¶æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œè¶…è¿‡è®¾å®šæ·±åº¦çš„æ ‘æå…¨éƒ¨å‰ªæ‰</p><p>2)<strong>min_samples_leaf &amp; min_samples_split</strong>:</p><p>min_samples_leafé™å®šï¼Œä¸€ä¸ªèŠ‚ç‚¹åœ¨åˆ†æåçš„æ¯ä¸ªå­èŠ‚ç‚¹éƒ½å¿…é¡»åŒ…å«è‡³å°‘min_samples_leafä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿï¼Œæˆ–è€…ï¼Œåˆ†æä¼šæœç€æ»¡è¶³æ¯ä¸ªå­èŠ‚ç‚¹éƒ½åŒ…å«min_samples_leafä¸ªæ ·æœ¬çš„æ–¹å‘å»å‘ç”Ÿä¸€èˆ¬æ­é…ã€‚max_depthä½¿ç”¨ï¼Œåœ¨å›å½’æ ‘ä¸­æœ‰ç¥å¥‡çš„æ•ˆæœï¼Œå¯ä»¥è®©æ¨¡å‹å˜å¾—æ›´åŠ å¹³æ»‘ã€‚è¿™ä¸ªå‚æ•°çš„æ•°é‡è®¾ç½®å¾—å¤ªå°ä¼šå¼•èµ·è¿‡æ‹Ÿåˆï¼Œè®¾ç½®å¾—å¤ªå¤§å°±ä¼šé˜»æ­¢æ¨¡å‹å­¦ä¹ æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®ä»=5å¼€å§‹ä½¿ç”¨ã€‚å¦‚æœå¶èŠ‚ç‚¹ä¸­å«æœ‰çš„æ ·æœ¬é‡å˜åŒ–å¾ˆå¤§ï¼Œå»ºè®®è¾“å…¥æµ®ç‚¹æ•°ä½œä¸ºæ ·æœ¬é‡çš„ç™¾åˆ†æ¯”æ¥ä½¿ç”¨ã€‚åŒæ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä¿è¯æ¯ä¸ªå¶å­çš„æœ€å°å°ºå¯¸ï¼Œå¯ä»¥åœ¨å›å½’é—®é¢˜ä¸­é¿å…ä½æ–¹å·®ï¼Œè¿‡æ‹Ÿåˆçš„å¶å­èŠ‚ç‚¹å‡ºç°ã€‚å¯¹äºç±»åˆ«ä¸å¤šçš„åˆ†ç±»é—®é¢˜ï¼Œ=1é€šå¸¸å°±æ˜¯æœ€ä½³é€‰æ‹©ã€‚min_samples_splité™å®šï¼Œä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»è¦åŒ…å«è‡³å°‘min_samples_splitä¸ªè®­ç»ƒæ ·æœ¬ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰å…è®¸è¢«åˆ†æï¼Œå¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿã€‚</p><ol start="3"><li><strong>max_features &amp; min_impurity_decrease</strong>:</li></ol><p>ä¸€èˆ¬max_depthä½¿ç”¨ï¼Œç”¨ä½œæ ‘çš„â€ç²¾ä¿®â€œ</p><p>max_featuresé™åˆ¶åˆ†ææ—¶è€ƒè™‘çš„ç‰¹å¾ä¸ªæ•°ï¼Œè¶…è¿‡é™åˆ¶ä¸ªæ•°çš„ç‰¹å¾éƒ½ä¼šè¢«èˆå¼ƒã€‚å’Œmax_depthå¼‚æ›²åŒå·¥ï¼Œmax_featuresæ˜¯ç”¨æ¥é™åˆ¶é«˜ç»´åº¦æ•°æ®çš„è¿‡æ‹Ÿåˆçš„å‰ªæå‚æ•°ï¼Œä½†å…¶æ–¹æ³•æ¯”è¾ƒæš´åŠ›ï¼Œæ˜¯ç›´æ¥é™åˆ¶å¯ä»¥ä½¿ç”¨çš„ç‰¹å¾æ•°é‡è€Œå¼ºè¡Œä½¿å†³ç­–æ ‘åœä¸‹çš„å‚æ•°ï¼Œåœ¨ä¸çŸ¥é“å†³ç­–æ ‘ä¸­çš„å„ä¸ªç‰¹å¾çš„é‡è¦æ€§çš„æƒ…å†µä¸‹ï¼Œå¼ºè¡Œè®¾å®šè¿™ä¸ªå‚æ•°å¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹å­¦ä¹ ä¸è¶³ã€‚å¦‚æœå¸Œæœ›é€šè¿‡é™ç»´çš„æ–¹å¼é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå»ºè®®ä½¿ç”¨PCAï¼ŒICAæˆ–è€…ç‰¹å¾é€‰æ‹©æ¨¡å—ä¸­çš„é™ç»´ç®—æ³•ã€‚</p><p>min_impurity_decreaseé™åˆ¶ä¿¡æ¯å¢ç›Šçš„å¤§å°ï¼Œä¿¡æ¯å¢ç›Šå°äºè®¾å®šæ•°å€¼çš„åˆ†æä¸ä¼šå‘ç”Ÿã€‚è¿™æ˜¯åœ¨0.19ç‰ˆæœ¬ä¸­æ›´æ–°çš„åŠŸèƒ½ï¼Œåœ¨0.19ç‰ˆæœ¬ä¹‹å‰æ—¶ä½¿ç”¨min_impurity_splitã€‚</p><p><strong>ç¡®è®¤æœ€ä¼˜çš„å‰ªæå‚æ•°</strong></p><p>é‚£å…·ä½“æ€ä¹ˆæ¥ç¡®å®šæ¯ä¸ªå‚æ•°å¡«å†™ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨ç¡®å®šè¶…å‚æ•°çš„æ›²çº¿æ¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œç»§ç»­ä½¿ç”¨æˆ‘ä»¬å·²ç»è®­ç»ƒå¥½çš„å†³ç­–æ ‘æ¨¡å‹clfã€‚è¶…å‚æ•°çš„å­¦ä¹ æ›²çº¿ï¼Œæ˜¯ä¸€æ¡ä»¥è¶…å‚æ•°çš„å–å€¼ä¸ºæ¨ªåæ ‡ï¼Œæ¨¡å‹çš„åº¦é‡æŒ‡æ ‡ä¸ºçºµåæ ‡çš„æ›²çº¿ï¼Œå®ƒæ˜¯ç”¨æ¥è¡¡é‡ä¸åŒè¶…å‚æ•°å–å€¼ä¸‹æ¨¡å‹çš„è¡¨ç°çš„çº¿ã€‚åœ¨æˆ‘ä»¬å»ºå¥½çš„å†³ç­–æ ‘é‡Œï¼Œæˆ‘ä»¬çš„æ¨¡å‹åº¦é‡æŒ‡æ ‡å°±scoreã€‚</p><pre class=" language-python"><code class="language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>test<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">"max_depth"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="ç›®æ ‡æƒé‡å‚æ•°"><a href="#ç›®æ ‡æƒé‡å‚æ•°" class="headerlink" title="ç›®æ ‡æƒé‡å‚æ•°"></a><strong>ç›®æ ‡æƒé‡å‚æ•°</strong></h3><ul><li><strong>class_weight &amp; min_weight_fraction_leaf</strong></li></ul><p>å®Œæˆæ ·æœ¬æ ‡ç­¾å¹³è¡¡çš„å‚æ•°ã€‚æ ·æœ¬ä¸å¹³è¡¡æ˜¯æŒ‡åœ¨ä¸€ç»„æ•°æ®é›†ä¸­ï¼Œæ ‡ç­¾çš„ä¸€ç±»å¤©ç”Ÿå æœ‰å¾ˆå¤§çš„æ¯”ä¾‹ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨é“¶è¡Œè¦åˆ¤æ–­â€œä¸€ä¸ªåŠäº†ä¿¡ç”¨å¡çš„äººæ˜¯å¦ä¼šè¿çº¦â€ï¼Œå°±æ˜¯æ˜¯vså¦ï¼ˆ1%ï¼š99%ï¼‰çš„æ¯”ä¾‹ã€‚è¿™ç§åˆ†ç±»çŠ¶å†µä¸‹ï¼Œå³ä¾¿æ¨¡å‹ä»€ä¹ˆä¹Ÿä¸åšï¼Œå…¨æŠŠç»“æœé¢„æµ‹æˆâ€œå¦â€ï¼Œæ­£ç¡®ç‡ä¹Ÿèƒ½æœ‰99%ã€‚å› æ­¤æˆ‘ä»¬è¦ä½¿ç”¨class_weightå‚æ•°å¯¹æ ·æœ¬æ ‡ç­¾è¿›è¡Œä¸€å®šçš„å‡è¡¡ï¼Œç»™å°‘é‡çš„æ ‡ç­¾æ›´å¤šçš„æƒé‡ï¼Œè®©æ¨¡å‹æ›´åå‘å°‘æ•°ç±»ï¼Œå‘æ•è·å°‘æ•°ç±»çš„æ–¹å‘å»ºæ¨¡ã€‚è¯¥å‚æ•°é»˜è®¤Noneï¼Œæ­¤æ¨¡å¼è¡¨ç¤ºè‡ªåŠ¨ç»™ä¸æ•°æ®é›†ä¸­çš„æ‰€æœ‰æ ‡ç­¾ç›¸åŒçš„æƒé‡ã€‚</p><p> <strong>é‡è¦å±æ€§å’Œæ¥å£</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#applyè¿”å›æ¯ä¸ªæµ‹è¯•æ ·æœ¬æ‰€åœ¨çš„å¶å­èŠ‚ç‚¹çš„ç´¢å¼•</span>clf<span class="token punctuation">.</span>apply<span class="token punctuation">(</span>Xtest<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#predictè¿”å›æ¯ä¸ªæµ‹è¯•æ ·æœ¬çš„åˆ†ç±»/å›å½’ç»“æœ</span>clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>Xtest<span class="token punctuation">)</span></code></pre><p><strong>æ€»ç»“</strong></p><p>å…«ä¸ªå‚æ•°ï¼šCriterionï¼Œä¸¤ä¸ªéšæœºæ€§ç›¸å…³çš„å‚æ•°ï¼ˆrandom_stateï¼Œsplitterï¼‰ï¼Œäº”ä¸ªå‰ªæå‚æ•°ï¼ˆmax_depth,min_samples_splitï¼Œmin_samples_leafï¼Œmax_featureï¼Œmin_impurity_decreaseï¼‰</p><p>ä¸€ä¸ªå±æ€§ï¼šfeature_importances_</p><p>å››ä¸ªæ¥å£ï¼šï¬tï¼Œscoreï¼Œapplyï¼Œpredict</p><h2 id="DecisionTreeRegressor"><a href="#DecisionTreeRegressor" class="headerlink" title="DecisionTreeRegressor"></a><strong>DecisionTreeRegressor</strong></h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">sklearn</span><span class="token punctuation">.</span>tree<span class="token punctuation">.</span>DecisionTreeRegressor  <span class="token punctuation">(</span>criterion<span class="token operator">=</span>â€™mseâ€™<span class="token punctuation">,</span> splitter<span class="token operator">=</span>â€™bestâ€™<span class="token punctuation">,</span> max_depth<span class="token operator">=</span>None<span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_samples_leaf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> min_weight_fraction_leaf<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> max_features<span class="token operator">=</span>None<span class="token punctuation">,</span>random_state<span class="token operator">=</span>None<span class="token punctuation">,</span> max_leaf_nodes<span class="token operator">=</span>None<span class="token punctuation">,</span> min_impurity_decrease<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> min_impurity_split<span class="token operator">=</span>None<span class="token punctuation">,</span> presort<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><h3 id="é‡è¦å‚æ•°ï¼Œå±æ€§åŠæ¥å£"><a href="#é‡è¦å‚æ•°ï¼Œå±æ€§åŠæ¥å£" class="headerlink" title="é‡è¦å‚æ•°ï¼Œå±æ€§åŠæ¥å£"></a>é‡è¦å‚æ•°ï¼Œå±æ€§åŠæ¥å£</h3><p>å›å½’æ ‘è¡¡é‡åˆ†æè´¨é‡çš„æŒ‡æ ‡ï¼Œæ”¯æŒçš„æ ‡å‡†æœ‰ä¸‰ç§ï¼š</p><p>1ï¼‰è¾“å…¥â€mseâ€ä½¿ç”¨å‡æ–¹è¯¯å·®mean squared error(MSE)ï¼Œçˆ¶èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ä¹‹é—´çš„å‡æ–¹è¯¯å·®çš„å·®é¢å°†è¢«ç”¨æ¥ä½œä¸ºç‰¹å¾é€‰æ‹©çš„æ ‡å‡†ï¼Œè¿™ç§æ–¹æ³•é€šè¿‡ä½¿ç”¨å¶å­èŠ‚ç‚¹çš„å‡å€¼æ¥æœ€å°åŒ–L2æŸå¤±</p><p>2ï¼‰è¾“å…¥â€œfriedman_mseâ€ä½¿ç”¨è´¹å°”å¾·æ›¼å‡æ–¹è¯¯å·®ï¼Œè¿™ç§æŒ‡æ ‡ä½¿ç”¨å¼—é‡Œå¾·æ›¼é’ˆå¯¹æ½œåœ¨åˆ†æä¸­çš„é—®é¢˜æ”¹è¿›åçš„å‡æ–¹è¯¯å·®</p><p>3ï¼‰è¾“å…¥â€maeâ€ä½¿ç”¨ç»å¯¹å¹³å‡è¯¯å·®MAEï¼ˆmean absolute errorï¼‰ï¼Œè¿™ç§æŒ‡æ ‡ä½¿ç”¨å¶èŠ‚ç‚¹çš„ä¸­å€¼æ¥æœ€å°åŒ–L1æŸå¤±å±æ€§ä¸­æœ€é‡è¦çš„ä¾ç„¶æ˜¯feature_importances_ï¼Œæ¥å£ä¾ç„¶æ˜¯apply, ï¬t, predict, scoreæœ€æ ¸å¿ƒã€‚</p><p>â€‹       å…¶ä¸­uæ˜¯æ®‹å·®å¹³æ–¹å’Œï¼ˆMSE * Nï¼‰ï¼Œvæ˜¯æ€»å¹³æ–¹å’Œï¼ŒNæ˜¯æ ·æœ¬æ•°é‡ï¼Œiæ˜¯æ¯ä¸€ä¸ªæ•°æ®æ ·æœ¬ï¼Œï¬æ˜¯æ¨¡å‹å›å½’å‡ºçš„æ•°å€¼ï¼Œyiæ˜¯æ ·æœ¬ç‚¹iå®é™…çš„æ•°å€¼æ ‡ç­¾ã€‚yå¸½æ˜¯çœŸå®æ•°å€¼æ ‡ç­¾çš„å¹³å‡æ•°ã€‚Rå¹³æ–¹å¯ä»¥ä¸ºæ­£ä¸ºè´Ÿï¼ˆå¦‚æœæ¨¡å‹çš„æ®‹å·®å¹³æ–¹å’Œè¿œè¿œå¤§äºæ¨¡å‹çš„æ€»å¹³æ–¹å’Œï¼Œæ¨¡å‹éå¸¸ç³Ÿç³•ï¼ŒRå¹³æ–¹å°±ä¼šä¸ºè´Ÿï¼‰ï¼Œè€Œå‡æ–¹è¯¯å·®æ°¸è¿œä¸ºæ­£ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‘æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Transformersä¸­ä½¿ç”¨TorchScript</title>
      <link href="/2020/09/17/transformers-zhong-shi-yong-torchscript/"/>
      <url>/2020/09/17/transformers-zhong-shi-yong-torchscript/</url>
      
        <content type="html"><![CDATA[<h1 id="Transformersä¸­ä½¿ç”¨TorchScript"><a href="#Transformersä¸­ä½¿ç”¨TorchScript" class="headerlink" title="Transformersä¸­ä½¿ç”¨TorchScript"></a>Transformersä¸­ä½¿ç”¨TorchScript</h1><p>è½¬è½½ï¼š<a href="https://www.cnblogs.com/panchuangai/p/12567841.html">https://www.cnblogs.com/panchuangai/p/12567841.html</a></p><p>æ ¹æ®Pytorchçš„æ–‡æ¡£ï¼šâ€œTorchScriptæ˜¯ä¸€ç§ä»PyTorchä»£ç åˆ›å»ºå¯åºåˆ—åŒ–å’Œå¯ä¼˜åŒ–æ¨¡å‹çš„æ–¹æ³•â€ã€‚Pytorchçš„ä¸¤ä¸ªæ¨¡å—<code>JITå’ŒTRACE</code>å…è®¸å¼€å‘äººå‘˜å¯¼å‡ºä»–ä»¬çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹å¯ä»¥åœ¨å…¶ä»–ç¨‹åºä¸­é‡ç”¨ï¼Œä¾‹å¦‚é¢å‘æ•ˆç‡çš„C++ç¨‹åºã€‚</p><p>æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£å…è®¸å°†<em>transformers</em>æ¨¡å‹å¯¼å‡ºåˆ°TorchScriptï¼Œä»¥ä¾¿ä»–ä»¬å¯åœ¨ä¸åŸºäºPytorchçš„pythonç¨‹åºä¸åŒçš„ç¯å¢ƒä¸­é‡ç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è§£é‡Šå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹ï¼Œä»¥ä¾¿å¯ä»¥å¯¼å‡ºå®ƒä»¬ï¼Œä»¥åŠå°†è¿™äº›æ¨¡å‹ä¸TorchScriptä¸€èµ·ä½¿ç”¨æ—¶è¦æ³¨æ„çš„äº‹é¡¹ã€‚</p><p>å¯¼å‡ºæ¨¡å‹éœ€è¦ä¸¤ä»¶äº‹ï¼š</p><ul><li>è™šæ‹ŸåŒ–è¾“å…¥ä»¥æ‰§è¡Œæ¨¡å‹æ­£å‘ä¼ æ’­ã€‚</li><li>éœ€è¦ä½¿ç”¨<code>torchscript</code>æ ‡å¿—å®ä¾‹åŒ–è¯¥æ¨¡å‹ã€‚</li></ul><p>è¿™äº›å¿…è¦æ€§æ„å‘³ç€å¼€å‘äººå‘˜åº”æ³¨æ„å‡ ä»¶äº‹ã€‚è¿™äº›åœ¨ä¸‹é¢è¯¦ç»†è¯´æ˜ã€‚</p><h3 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h3><h4 id="TorchScriptæ ‡å¿—å’Œè§£ç»‘æƒé‡"><a href="#TorchScriptæ ‡å¿—å’Œè§£ç»‘æƒé‡" class="headerlink" title="TorchScriptæ ‡å¿—å’Œè§£ç»‘æƒé‡"></a>TorchScriptæ ‡å¿—å’Œè§£ç»‘æƒé‡</h4><p>è¯¥æ ‡å¿—æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºè¯¥å­˜å‚¨åº“ä¸­çš„å¤§å¤šæ•°è¯­è¨€æ¨¡å‹éƒ½åœ¨å®ƒä»¬çš„<code>Embedding</code>å±‚åŠå…¶<code>Decoding</code>å±‚å…·æœ‰ç»‘å®šæƒé‡å…³ç³»ã€‚TorchScriptä¸å…è®¸å¯¼å‡ºç»‘å®šæƒé‡çš„æ¨¡å‹ï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦äº‹å…ˆè§£ç»‘æƒé‡ã€‚</p><p>è¿™æ„å‘³ç€ä»¥<code>torchscript</code>æ ‡å¿—å®ä¾‹åŒ–çš„æ¨¡å‹ä½¿å¾—<code>Embedding</code>å±‚å’Œ<code>Decoding</code>å±‚åˆ†å¼€ï¼Œè¿™æ„å‘³ç€ä¸åº”è¯¥å¯¹ä»–ä»¬è¿›è¡ŒåŒæ—¶è®­ç»ƒï¼Œå¯¼è‡´æ„å¤–çš„ç»“æœã€‚</p><p>å¯¹äºæ²¡æœ‰è¯­è¨€æ¨¡å‹å¤´(Language Model head)çš„æ¨¡å‹ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå› ä¸ºé‚£äº›æ¨¡å‹æ²¡æœ‰ç»‘å®šæƒé‡ã€‚è¿™äº›å‹å·å¯ä»¥åœ¨æ²¡æœ‰<code>torchscript</code>æ ‡å¿—çš„æƒ…å†µä¸‹å®‰å…¨åœ°å¯¼å‡ºã€‚</p><h4 id="è™šæ‹Ÿ-dummy-è¾“å…¥å’Œæ ‡å‡†é•¿åº¦"><a href="#è™šæ‹Ÿ-dummy-è¾“å…¥å’Œæ ‡å‡†é•¿åº¦" class="headerlink" title="è™šæ‹Ÿ(dummy)è¾“å…¥å’Œæ ‡å‡†é•¿åº¦"></a>è™šæ‹Ÿ(dummy)è¾“å…¥å’Œæ ‡å‡†é•¿åº¦</h4><p>è™šæ‹Ÿè¾“å…¥ç”¨äºè¿›è¡Œæ¨¡å‹å‰å‘ä¼ æ’­ã€‚å½“è¾“å…¥å€¼åœ¨å„å±‚ä¸­ä¼ æ’­æ—¶ï¼ŒPytorchè·Ÿè¸ªåœ¨æ¯ä¸ªå¼ é‡ä¸Šæ‰§è¡Œçš„ä¸åŒæ“ä½œã€‚ç„¶åä½¿ç”¨è¿™äº›è®°å½•çš„æ“ä½œåˆ›å»ºæ¨¡å‹çš„â€œè¿¹â€ã€‚</p><p>è¿¹æ˜¯ç›¸å¯¹äºè¾“å…¥çš„å°ºå¯¸åˆ›å»ºçš„ã€‚å› æ­¤ï¼Œå®ƒå—åˆ°è™šæ‹Ÿè¾“å…¥å°ºå¯¸çš„é™åˆ¶ï¼Œå¹¶ä¸”ä¸é€‚ç”¨äºä»»ä½•å…¶ä»–åºåˆ—é•¿åº¦æˆ–æ‰¹æ¬¡å¤§å°ã€‚å°è¯•ä½¿ç”¨å…¶ä»–å°ºå¯¸æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œå¦‚ï¼š</p><pre><code>The expanded size of the tensor (3) must match the existing size (7) at non-singleton dimension 2</code></pre><p>å› æ­¤ï¼Œå»ºè®®ä½¿ç”¨è‡³å°‘ä¸æœ€å¤§è¾“å…¥å¤§å°ç›¸åŒçš„è™šæ‹Ÿè¾“å…¥å¤§å°æ¥è·Ÿè¸ªæ¨¡å‹ã€‚åœ¨æ¨ç†æœŸé—´å¯¹äºæ¨¡å‹çš„è¾“å…¥ï¼Œå¯ä»¥æ‰§è¡Œå¡«å……æ¥å¡«å……ç¼ºå°‘çš„å€¼ã€‚ä½œä¸ºæ¨¡å‹<br>å°†ä»¥è¾ƒå¤§çš„è¾“å…¥å¤§å°æ¥è¿›è¡Œè·Ÿè¸ªï¼Œä½†æ˜¯ï¼Œä¸åŒçŸ©é˜µçš„å°ºå¯¸ä¹Ÿå°†å¾ˆå¤§ï¼Œä»è€Œå¯¼è‡´æ›´å¤šçš„è®¡ç®—ã€‚</p><p>å»ºè®®æ³¨æ„æ¯ä¸ªè¾“å…¥ä¸Šå®Œæˆçš„æ“ä½œæ€»æ•°ï¼Œå¹¶å¯†åˆ‡å…³æ³¨å„ç§åºåˆ—é•¿åº¦å¯¹åº”æ€§èƒ½çš„å˜åŒ–ã€‚</p><h3 id="åœ¨Pythonä¸­ä½¿ç”¨TorchScript"><a href="#åœ¨Pythonä¸­ä½¿ç”¨TorchScript" class="headerlink" title="åœ¨Pythonä¸­ä½¿ç”¨TorchScript"></a>åœ¨Pythonä¸­ä½¿ç”¨TorchScript</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨Pythonä¿å­˜ï¼ŒåŠ è½½æ¨¡å‹ä»¥åŠå¦‚ä½•ä½¿ç”¨â€è¿¹â€è¿›è¡Œæ¨ç†çš„ç¤ºä¾‹ã€‚</p><h4 id="ä¿å­˜æ¨¡å‹"><a href="#ä¿å­˜æ¨¡å‹" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h4><p>è¯¥ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨TorchScriptå¯¼å‡º<code>BertModel</code>ã€‚åœ¨è¿™é‡Œå®ä¾‹åŒ–<code>BertModel</code>ï¼Œæ ¹æ®<code>BertConfig</code>ç±»ï¼Œç„¶åä»¥æ–‡ä»¶å<code>traced_bert.pt</code>ä¿å­˜åˆ°ç£ç›˜</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> BertModel<span class="token punctuation">,</span> BertTokenizer<span class="token punctuation">,</span> BertConfig<span class="token keyword">import</span> torchenc <span class="token operator">=</span> BertTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"bert-base-uncased"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ ‡è®°è¾“å…¥æ–‡æœ¬</span>text <span class="token operator">=</span> <span class="token string">"[CLS] Who was Jim Henson ? [SEP] Jim Henson was a puppeteer [SEP]"</span>tokenized_text <span class="token operator">=</span> enc<span class="token punctuation">.</span>tokenize<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è¾“å…¥æ ‡è®°ä¹‹ä¸€è¿›è¡Œæ©ç </span>masked_index <span class="token operator">=</span> <span class="token number">8</span>tokenized_text<span class="token punctuation">[</span>masked_index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'[MASK]'</span>indexed_tokens <span class="token operator">=</span> enc<span class="token punctuation">.</span>convert_tokens_to_ids<span class="token punctuation">(</span>tokenized_text<span class="token punctuation">)</span>segments_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># åˆ›å»ºè™šæ‹Ÿè¾“å…¥</span>tokens_tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>indexed_tokens<span class="token punctuation">]</span><span class="token punctuation">)</span>segments_tensors <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>segments_ids<span class="token punctuation">]</span><span class="token punctuation">)</span>dummy_input <span class="token operator">=</span> <span class="token punctuation">[</span>tokens_tensor<span class="token punctuation">,</span> segments_tensors<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ä½¿ç”¨torchscriptæ ‡å¿—åˆå§‹åŒ–æ¨¡å‹</span><span class="token comment" spellcheck="true"># æ ‡å¿—è¢«è®¾ç½®ä¸ºTrueï¼Œå³ä½¿æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºè¯¥å‹å·æ²¡æœ‰LM Headã€‚</span>config <span class="token operator">=</span> BertConfig<span class="token punctuation">(</span>vocab_size_or_config_json_file<span class="token operator">=</span><span class="token number">32000</span><span class="token punctuation">,</span> hidden_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span>    num_hidden_layers<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> num_attention_heads<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> intermediate_size<span class="token operator">=</span><span class="token number">3072</span><span class="token punctuation">,</span> torchscript<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å®ä¾‹åŒ–æ¨¡å‹</span>model <span class="token operator">=</span> BertModel<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span>model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å¦‚æœæ‚¨è¦ä½¿ç”¨from_pretrainedå®ä¾‹åŒ–æ¨¡å‹ï¼Œåˆ™è¿˜å¯ä»¥è®¾ç½®TorchScriptæ ‡å¿—</span>model <span class="token operator">=</span> BertModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"bert-base-uncased"</span><span class="token punctuation">,</span> torchscript<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºè¿¹</span>traced_model <span class="token operator">=</span> torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>trace<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token punctuation">[</span>tokens_tensor<span class="token punctuation">,</span> segments_tensors<span class="token punctuation">]</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>save<span class="token punctuation">(</span>traced_model<span class="token punctuation">,</span> <span class="token string">"traced_bert.pt"</span><span class="token punctuation">)</span></code></pre><h4 id="è½½å…¥æ¨¡å‹"><a href="#è½½å…¥æ¨¡å‹" class="headerlink" title="è½½å…¥æ¨¡å‹"></a>è½½å…¥æ¨¡å‹</h4><p>è¯¥ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•åŠ è½½ä»¥å‰ä»¥åç§°<code>traced_bert.pt</code>ä¿å­˜åˆ°ç£ç›˜çš„<code>BertModel</code>ã€‚<br>æˆ‘ä»¬é‡æ–°ä½¿ç”¨ä¹‹å‰åˆå§‹åŒ–çš„<code>dummy_input</code>ã€‚</p><pre class=" language-python"><code class="language-python">loaded_model <span class="token operator">=</span> torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"traced_model.pt"</span><span class="token punctuation">)</span>loaded_model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>all_encoder_layers<span class="token punctuation">,</span> pooled_output <span class="token operator">=</span> loaded_model<span class="token punctuation">(</span>dummy_input<span class="token punctuation">)</span></code></pre><h4 id="ä½¿ç”¨è·Ÿè¸ªæ¨¡å‹è¿›è¡Œæ¨ç†"><a href="#ä½¿ç”¨è·Ÿè¸ªæ¨¡å‹è¿›è¡Œæ¨ç†" class="headerlink" title="ä½¿ç”¨è·Ÿè¸ªæ¨¡å‹è¿›è¡Œæ¨ç†"></a>ä½¿ç”¨è·Ÿè¸ªæ¨¡å‹è¿›è¡Œæ¨ç†</h4><p>ä½¿ç”¨è·Ÿè¸ªæ¨¡å‹è¿›è¡Œæ¨ç†å°±åƒä½¿ç”¨å…¶<code>__call__</code> æ–¹æ³•ä¸€æ ·ç®€å•ï¼š</p><pre class=" language-python"><code class="language-python">traced_model<span class="token punctuation">(</span>tokens_tensor<span class="token punctuation">,</span> segments_tensors<span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TorchServeéƒ¨ç½²æ–¹æ³•åŠæ³¨æ„äº‹é¡¹</title>
      <link href="/2020/09/17/torchserve-bu-shu-zhu-yi-shi-xiang/"/>
      <url>/2020/09/17/torchserve-bu-shu-zhu-yi-shi-xiang/</url>
      
        <content type="html"><![CDATA[<h1 id="TorchServeéƒ¨ç½²æ–¹æ³•åŠé—®é¢˜"><a href="#TorchServeéƒ¨ç½²æ–¹æ³•åŠé—®é¢˜" class="headerlink" title="TorchServeéƒ¨ç½²æ–¹æ³•åŠé—®é¢˜"></a>TorchServeéƒ¨ç½²æ–¹æ³•åŠé—®é¢˜</h1><ul><li><p>Java ç¯å¢ƒé—®é¢˜</p><p>ä¸€å®šè¦å®‰è£…JDK11ï¼ˆå®˜ç½‘è¦æ±‚æœ€ä½8ï¼Œä½†æ˜¯æˆ‘ä¸èƒ½ä½¿ç”¨ï¼Œæ‰“åŒ…ä¸€å®šè¦å†éƒ¨ç½²çš„ç¯å¢ƒæ‰“åŒ…ï¼Œé¿å…javaç‰ˆæœ¬ä¸åŒï¼Œéƒ¨ç½²æŠ¥é”™ï¼‰</p></li><li><p>åœ¨åˆ«çš„åœ°æ–¹ä½¿ç”¨cudaè®­ç»ƒçš„æ¨¡å‹åœ¨å…¶ä»–åªæœ‰cpuçš„ç¯å¢ƒå¯èƒ½åœ¨åŠ è½½æ¨¡å‹æ—¶æŠ¥é”™</p><p> raise RuntimeError(â€˜Attempting to deserialize object on a CUDA â€˜<br>RuntimeError: Attempting to deserialize object on a CUDA device but torch.cuda.is_available() is False. If you are running on a CPU-only machine, please use torch.load with map_location=torch.device(â€˜cpuâ€™) to map your storages to the CPU.</p><p>è§£å†³åŠæ³•ã€€ç°åœ¨åŸæ¥åœ°æ–¹åŠ è½½ï¼Œç„¶åä½¿ç”¨cpuä¿å­˜</p></li><li><p>torchserve æ¨¡å‹çš„å…¥å£æ˜¯</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span></code></pre></li><li><p>è¿”å›å¿…é¡»æ˜¯æ•°ç»„ï¼Œå¹¶ä¸”éœ€è¦å¤šåŠ ä¸€åˆ—æ•°ç»„ï¼Œè¿”å›çš„æ•°æ®ä¼šå°‘ä¸€ç»´æ•°ç»„</p><p>ä¸ç„¶æŠ¥é”™ä¿¡æ¯ï¼šbâ€™{\n  â€œcodeâ€: 503,\n  â€œtypeâ€: â€œInternalServerExceptionâ€,\n  â€œmessageâ€: â€œInvalid model predict outputâ€\n}\n</p></li><li><p>è‹¥ä½¿ç”¨äº†transformersï¼Œdockeré•œåƒæ²¡æœ‰å®‰è£…transformersï¼ˆç›®å‰æ‰€æœ‰å¯ç”¨çš„é•œåƒ<a href="https://hub.docker.com/r/pytorch/torchserve/tags%EF%BC%89">https://hub.docker.com/r/pytorch/torchserve/tagsï¼‰</a></p><p>è‹¥è¦ä½¿ç”¨dockerè‡ªå·±åˆ¶ä½œï¼š</p><ol><li>Create TorchServe docker image  <a href="https://github.com/pytorch/serve/tree/master/docker">https://github.com/pytorch/serve/tree/master/docker</a></li><li>Create TorchServe docker image from source   <a href="https://github.com/pytorch/serve/tree/master/docker">https://github.com/pytorch/serve/tree/master/docker</a></li></ol></li></ul><p><strong>æ‰“åŒ…è„šæœ¬</strong></p><pre class=" language-shell"><code class="language-shell">torch-model-archiver     --model-name chatbotBERT     --version 1.0 --serialized-file ./pytorch_model.bin     --extra-files "./config.json,./best_ner.bin,./config.json,./vocab.txt"     --handler "chatbot_medical_qa_ner_handler.py"</code></pre><p><strong>å¯åŠ¨</strong></p><pre class=" language-shell"><code class="language-shell">torchserve --start --ncs --model-store model-store --models chatbotBERT.mar --ts-config ./model-store/config.properties</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>curlå‘½ä»¤</title>
      <link href="/2020/09/15/curl-ming-ling/"/>
      <url>/2020/09/15/curl-ming-ling/</url>
      
        <content type="html"><![CDATA[<h1 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h1><h2 id="å‘½ä»¤ï¼šcurl"><a href="#å‘½ä»¤ï¼šcurl" class="headerlink" title="å‘½ä»¤ï¼šcurl"></a>å‘½ä»¤ï¼šcurl</h2><p>â€‹      åŸåœ°å€ï¼š<a href="https://www.cnblogs.com/duhuo/p/5695256.html">https://www.cnblogs.com/duhuo/p/5695256.html</a></p><p>â€‹       åœ¨Linuxä¸­curlæ˜¯ä¸€ä¸ªåˆ©ç”¨URLè§„åˆ™åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå¯ä»¥è¯´æ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„httpå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ˜¯ç»¼åˆä¼ è¾“å·¥å…·ï¼Œä½†æŒ‰ä¼ ç»Ÿï¼Œä¹ æƒ¯ç§°urlä¸ºä¸‹è½½å·¥å…·ã€‚</p><pre><code>è¯­æ³•ï¼š# curl [option] [url]</code></pre><p>å¸¸è§å‚æ•°ï¼š</p><pre class=" language-shell"><code class="language-shell">-A/--user-agent <string>              è®¾ç½®ç”¨æˆ·ä»£ç†å‘é€ç»™æœåŠ¡å™¨-b/--cookie <name=string/file>    cookieå­—ç¬¦ä¸²æˆ–æ–‡ä»¶è¯»å–ä½ç½®-c/--cookie-jar <file>                    æ“ä½œç»“æŸåæŠŠcookieå†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­-C/--continue-at <offset>            æ–­ç‚¹ç»­è½¬-D/--dump-header <file>              æŠŠheaderä¿¡æ¯å†™å…¥åˆ°è¯¥æ–‡ä»¶ä¸­-e/--referer                                  æ¥æºç½‘å€-f/--fail                                          è¿æ¥å¤±è´¥æ—¶ä¸æ˜¾ç¤ºhttpé”™è¯¯-o/--output                                  æŠŠè¾“å‡ºå†™åˆ°è¯¥æ–‡ä»¶ä¸­-O/--remote-name                      æŠŠè¾“å‡ºå†™åˆ°è¯¥æ–‡ä»¶ä¸­ï¼Œä¿ç•™è¿œç¨‹æ–‡ä»¶çš„æ–‡ä»¶å-r/--range <range>                      æ£€ç´¢æ¥è‡ªHTTP/1.1æˆ–FTPæœåŠ¡å™¨å­—èŠ‚èŒƒå›´-s/--silent                                    é™éŸ³æ¨¡å¼ã€‚ä¸è¾“å‡ºä»»ä½•ä¸œè¥¿-T/--upload-file <file>                  ä¸Šä¼ æ–‡ä»¶-u/--user <user[:password]>      è®¾ç½®æœåŠ¡å™¨çš„ç”¨æˆ·å’Œå¯†ç -w/--write-out [format]                ä»€ä¹ˆè¾“å‡ºå®Œæˆå-x/--proxy <host[:port]>              åœ¨ç»™å®šçš„ç«¯å£ä¸Šä½¿ç”¨HTTPä»£ç†-#/--progress-bar                        è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰çš„ä¼ é€çŠ¶æ€</code></pre><p>ä¾‹å­ï¼š<br>1ã€åŸºæœ¬ç”¨æ³•</p><pre class=" language-shell"><code class="language-shell"># curl http://www.linux.com</code></pre><p>æ‰§è¡Œåï¼Œ<a href="http://www.linux.com/">www.linux.com</a> çš„htmlå°±ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†<br>Psï¼šç”±äºå®‰è£…linuxçš„æ—¶å€™å¾ˆå¤šæ—¶å€™æ˜¯æ²¡æœ‰å®‰è£…æ¡Œé¢çš„ï¼Œä¹Ÿæ„å‘³ç€æ²¡æœ‰æµè§ˆå™¨ï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•ä¹Ÿç»å¸¸ç”¨äºæµ‹è¯•ä¸€å°æœåŠ¡å™¨æ˜¯å¦å¯ä»¥åˆ°è¾¾ä¸€ä¸ªç½‘ç«™</p><p>2ã€ä¿å­˜è®¿é—®çš„ç½‘é¡µ<br>2.1:ä½¿ç”¨linuxçš„é‡å®šå‘åŠŸèƒ½ä¿å­˜</p><pre class=" language-shell"><code class="language-shell"># curl http://www.linux.com >> linux.html</code></pre><p>2.2:å¯ä»¥ä½¿ç”¨curlçš„å†…ç½®option:-o(å°å†™)ä¿å­˜ç½‘é¡µ</p><pre class=" language-shell"><code class="language-shell">$ curl -o linux.html http://www.linux.com</code></pre><p>æ‰§è¡Œå®Œæˆåä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼Œæ˜¾ç¤º100%åˆ™è¡¨ç¤ºä¿å­˜æˆåŠŸ</p><pre class=" language-shell"><code class="language-shell">% Total    % Received % Xferd  Average Speed  Time    Time    Time  Current                                Dload  Upload  Total  Spent    Left  Speed100 79684    0 79684    0    0  3437k      0 --:--:-- --:--:-- --:--:-- 7781k</code></pre><p>2.3:å¯ä»¥ä½¿ç”¨curlçš„å†…ç½®option:-O(å¤§å†™)ä¿å­˜ç½‘é¡µä¸­çš„æ–‡ä»¶<br>è¦æ³¨æ„è¿™é‡Œåé¢çš„urlè¦å…·ä½“åˆ°æŸä¸ªæ–‡ä»¶ï¼Œä¸ç„¶æŠ“ä¸ä¸‹æ¥</p><pre class=" language-shell"><code class="language-shell"># curl -O http://www.linux.com/hello.sh</code></pre><p>3ã€æµ‹è¯•ç½‘é¡µè¿”å›å€¼</p><pre class=" language-shell"><code class="language-shell"># curl -o /dev/null -s -w %&#123;http_code&#125; www.linux.com</code></pre><p>Ps:åœ¨è„šæœ¬ä¸­ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„æµ‹è¯•ç½‘ç«™æ˜¯å¦æ­£å¸¸çš„ç”¨æ³•</p><p>4ã€æŒ‡å®šproxyæœåŠ¡å™¨ä»¥åŠå…¶ç«¯å£<br>å¾ˆå¤šæ—¶å€™ä¸Šç½‘éœ€è¦ç”¨åˆ°ä»£ç†æœåŠ¡å™¨(æ¯”å¦‚æ˜¯ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ä¸Šç½‘æˆ–è€…å› ä¸ºä½¿ç”¨curlåˆ«äººç½‘ç«™è€Œè¢«åˆ«äººå±è”½IPåœ°å€çš„æ—¶å€™)ï¼Œå¹¸è¿çš„æ˜¯curlé€šè¿‡ä½¿ç”¨å†…ç½®optionï¼š-xæ¥æ”¯æŒè®¾ç½®ä»£ç†</p><pre class=" language-shell"><code class="language-shell"># curl -x 192.168.100.100:1080 http://www.linux.com</code></pre><p>5ã€cookie<br>æœ‰äº›ç½‘ç«™æ˜¯ä½¿ç”¨cookieæ¥è®°å½•sessionä¿¡æ¯ã€‚å¯¹äºchromeè¿™æ ·çš„æµè§ˆå™¨ï¼Œå¯ä»¥è½»æ˜“å¤„ç†cookieä¿¡æ¯ï¼Œä½†åœ¨curlä¸­åªè¦å¢åŠ ç›¸å…³å‚æ•°ä¹Ÿæ˜¯å¯ä»¥å¾ˆå®¹æ˜“çš„å¤„ç†cookie<br>5.1:ä¿å­˜httpçš„responseé‡Œé¢çš„cookieä¿¡æ¯ã€‚å†…ç½®option:-cï¼ˆå°å†™ï¼‰</p><pre class=" language-shell"><code class="language-shell"># curl -c cookiec.txt  http://www.linux.com</code></pre><p>æ‰§è¡Œåcookieä¿¡æ¯å°±è¢«å­˜åˆ°äº†cookiec.txté‡Œé¢äº†</p><p>5.2:ä¿å­˜httpçš„responseé‡Œé¢çš„headerä¿¡æ¯ã€‚å†…ç½®option: -D</p><pre class=" language-shell"><code class="language-shell"># curl -D cookied.txt http://www.linux.com</code></pre><p>æ‰§è¡Œåcookieä¿¡æ¯å°±è¢«å­˜åˆ°äº†cookied.txté‡Œé¢äº†</p><p>æ³¨æ„ï¼š-c(å°å†™)äº§ç”Ÿçš„cookieå’Œ-Dé‡Œé¢çš„cookieæ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>5.3:ä½¿ç”¨cookie<br>å¾ˆå¤šç½‘ç«™éƒ½æ˜¯é€šè¿‡ç›‘è§†ä½ çš„cookieä¿¡æ¯æ¥åˆ¤æ–­ä½ æ˜¯å¦æŒ‰è§„çŸ©è®¿é—®ä»–ä»¬çš„ç½‘ç«™çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¿å­˜çš„cookieä¿¡æ¯ã€‚å†…ç½®option: -b</p><pre class=" language-shell"><code class="language-shell"># curl -b cookiec.txt http://www.linux.com</code></pre><p>6ã€æ¨¡ä»¿æµè§ˆå™¨<br>æœ‰äº›ç½‘ç«™éœ€è¦ä½¿ç”¨ç‰¹å®šçš„æµè§ˆå™¨å»è®¿é—®ä»–ä»¬ï¼Œæœ‰äº›è¿˜éœ€è¦ä½¿ç”¨æŸäº›ç‰¹å®šçš„ç‰ˆæœ¬ã€‚curlå†…ç½®option:-Aå¯ä»¥è®©æˆ‘ä»¬æŒ‡å®šæµè§ˆå™¨å»è®¿é—®ç½‘ç«™</p><pre class=" language-shell"><code class="language-shell"># curl -A "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.0)" http://www.linux.com</code></pre><p>è¿™æ ·æœåŠ¡å™¨ç«¯å°±ä¼šè®¤ä¸ºæ˜¯ä½¿ç”¨IE8.0å»è®¿é—®çš„</p><p>7ã€ä¼ªé€ refererï¼ˆç›—é“¾ï¼‰<br>å¾ˆå¤šæœåŠ¡å™¨ä¼šæ£€æŸ¥httpè®¿é—®çš„refererä»è€Œæ¥æ§åˆ¶è®¿é—®ã€‚æ¯”å¦‚ï¼šä½ æ˜¯å…ˆè®¿é—®é¦–é¡µï¼Œç„¶åå†è®¿é—®é¦–é¡µä¸­çš„é‚®ç®±é¡µé¢ï¼Œè¿™é‡Œè®¿é—®é‚®ç®±çš„refereråœ°å€å°±æ˜¯è®¿é—®é¦–é¡µæˆåŠŸåçš„é¡µé¢åœ°å€ï¼Œå¦‚æœæœåŠ¡å™¨å‘ç°å¯¹é‚®ç®±é¡µé¢è®¿é—®çš„refereråœ°å€ä¸æ˜¯é¦–é¡µçš„åœ°å€ï¼Œå°±æ–­å®šé‚£æ˜¯ä¸ªç›—è¿äº†<br>curlä¸­å†…ç½®optionï¼š-eå¯ä»¥è®©æˆ‘ä»¬è®¾å®šreferer</p><pre class=" language-shell"><code class="language-shell"># curl -e "www.linux.com" http://mail.linux.com</code></pre><p>è¿™æ ·å°±ä¼šè®©æœåŠ¡å™¨å…¶ä»¥ä¸ºä½ æ˜¯ä»<a href="http://www.linux.comç‚¹å‡»æŸä¸ªé“¾æ¥è¿‡æ¥çš„/">www.linux.comç‚¹å‡»æŸä¸ªé“¾æ¥è¿‡æ¥çš„</a></p><p>8ã€ä¸‹è½½æ–‡ä»¶<br>8.1ï¼šåˆ©ç”¨curlä¸‹è½½æ–‡ä»¶ã€‚<br>#ä½¿ç”¨å†…ç½®optionï¼š-o(å°å†™)</p><pre class=" language-shell"><code class="language-shell"># curl -o dodo1.jpg http:www.linux.com/dodo1.JPG</code></pre><p>#ä½¿ç”¨å†…ç½®optionï¼š-Oï¼ˆå¤§å†™)</p><pre class=" language-shell"><code class="language-shell"># curl -O http://www.linux.com/dodo1.JPG</code></pre><p>è¿™æ ·å°±ä¼šä»¥æœåŠ¡å™¨ä¸Šçš„åç§°ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°</p><p>8.2ï¼šå¾ªç¯ä¸‹è½½<br>æœ‰æ—¶å€™ä¸‹è½½å›¾ç‰‡å¯ä»¥èƒ½æ˜¯å‰é¢çš„éƒ¨åˆ†åç§°æ˜¯ä¸€æ ·çš„ï¼Œå°±æœ€åçš„å°¾æ¤åä¸ä¸€æ ·</p><pre class=" language-shell"><code class="language-shell"># curl -O http://www.linux.com/dodo[1-5].JPG</code></pre><p>è¿™æ ·å°±ä¼šæŠŠdodo1ï¼Œdodo2ï¼Œdodo3ï¼Œdodo4ï¼Œdodo5å…¨éƒ¨ä¿å­˜ä¸‹æ¥</p><p>8.3ï¼šä¸‹è½½é‡å‘½å</p><pre class=" language-shell"><code class="language-shell"># curl -O http://www.linux.com/&#123;hello,bb&#125;/dodo[1-5].JPG</code></pre><p>ç”±äºä¸‹è½½çš„helloä¸bbä¸­çš„æ–‡ä»¶åéƒ½æ˜¯dodo1ï¼Œdodo2ï¼Œdodo3ï¼Œdodo4ï¼Œdodo5ã€‚å› æ­¤ç¬¬äºŒæ¬¡ä¸‹è½½çš„ä¼šæŠŠç¬¬ä¸€æ¬¡ä¸‹è½½çš„è¦†ç›–ï¼Œè¿™æ ·å°±éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½åã€‚</p><pre class=" language-shell"><code class="language-shell"># curl -o #1_#2.JPG http://www.linux.com/&#123;hello,bb&#125;/dodo[1-5].JPG</code></pre><p>è¿™æ ·åœ¨hello/dodo1.JPGçš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥å°±ä¼šå˜æˆhello_dodo1.JPG,å…¶ä»–æ–‡ä»¶ä¾æ­¤ç±»æ¨ï¼Œä»è€Œæœ‰æ•ˆçš„é¿å…äº†æ–‡ä»¶è¢«è¦†ç›–</p><p>8.4ï¼šåˆ†å—ä¸‹è½½<br>æœ‰æ—¶å€™ä¸‹è½½çš„ä¸œè¥¿ä¼šæ¯”è¾ƒå¤§ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ†æ®µä¸‹è½½ã€‚ä½¿ç”¨å†…ç½®optionï¼š-r</p><pre class=" language-shell"><code class="language-shell"># curl -r 0-100 -o dodo1_part1.JPG http://www.linux.com/dodo1.JPG# curl -r 100-200 -o dodo1_part2.JPG http://www.linux.com/dodo1.JPG# curl -r 200- -o dodo1_part3.JPG http://www.linux.com/dodo1.JPG# cat dodo1_part* > dodo1.JPG</code></pre><p>è¿™æ ·å°±å¯ä»¥æŸ¥çœ‹dodo1.JPGçš„å†…å®¹äº†</p><p>8.5ï¼šé€šè¿‡ftpä¸‹è½½æ–‡ä»¶<br>curlå¯ä»¥é€šè¿‡ftpä¸‹è½½æ–‡ä»¶ï¼Œcurlæä¾›ä¸¤ç§ä»ftpä¸­ä¸‹è½½çš„è¯­æ³•</p><pre class=" language-shell"><code class="language-shell"># curl -O -u ç”¨æˆ·å:å¯†ç  ftp://www.linux.com/dodo1.JPG# curl -O ftp://ç”¨æˆ·å:å¯†ç @www.linux.com/dodo1.JPG</code></pre><p>8.6ï¼šæ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡</p><pre class=" language-shell"><code class="language-shell"># curl -# -O http://www.linux.com/dodo1.JPG</code></pre><p>8.7ï¼šä¸ä¼šæ˜¾ç¤ºä¸‹è½½è¿›åº¦ä¿¡æ¯</p><pre class=" language-shell"><code class="language-shell"># curl -s -O http://www.linux.com/dodo1.JPG</code></pre><p>9ã€æ–­ç‚¹ç»­ä¼ <br>åœ¨windowsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿…é›·è¿™æ ·çš„è½¯ä»¶è¿›è¡Œæ–­ç‚¹ç»­ä¼ ã€‚curlå¯ä»¥é€šè¿‡å†…ç½®option:-CåŒæ ·å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ<br>å¦‚æœåœ¨ä¸‹è½½dodo1.JPGçš„è¿‡ç¨‹ä¸­çªç„¶æ‰çº¿äº†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼ç»­ä¼ </p><pre class=" language-shell"><code class="language-shell"># curl -C -O http://www.linux.com/dodo1.JPG</code></pre><p>10ã€ä¸Šä¼ æ–‡ä»¶<br>curlä¸ä»…ä»…å¯ä»¥ä¸‹è½½æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä¸Šä¼ æ–‡ä»¶ã€‚é€šè¿‡å†…ç½®option:-Tæ¥å®ç°</p><pre class=" language-shell"><code class="language-shell"># curl -T dodo1.JPG -u ç”¨æˆ·å:å¯†ç  ftp://www.linux.com/img/</code></pre><p>è¿™æ ·å°±å‘ftpæœåŠ¡å™¨ä¸Šä¼ äº†æ–‡ä»¶dodo1.JPG</p><p>11ã€æ˜¾ç¤ºæŠ“å–é”™è¯¯</p><pre class=" language-shell"><code class="language-shell"># curl -f http://www.linux.com/error</code></pre><p>å…¶ä»–å‚æ•°(æ­¤å¤„ç¿»è¯‘ä¸ºè½¬è½½)ï¼š</p><pre class=" language-shell"><code class="language-shell">-a/--append                        ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œé™„åŠ åˆ°ç›®æ ‡æ–‡ä»¶--anyauth                            å¯ä»¥ä½¿ç”¨â€œä»»ä½•â€èº«ä»½éªŒè¯æ–¹æ³•--basic                                ä½¿ç”¨HTTPåŸºæœ¬éªŒè¯-B/--use-ascii                      ä½¿ç”¨ASCIIæ–‡æœ¬ä¼ è¾“-d/--data <data>                  HTTP POSTæ–¹å¼ä¼ é€æ•°æ®--data-ascii <data>            ä»¥asciiçš„æ–¹å¼postæ•°æ®--data-binary <data>          ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼postæ•°æ®--negotiate                          ä½¿ç”¨HTTPèº«ä»½éªŒè¯--digest                        ä½¿ç”¨æ•°å­—èº«ä»½éªŒè¯--disable-eprt                  ç¦æ­¢ä½¿ç”¨EPRTæˆ–LPRT--disable-epsv                  ç¦æ­¢ä½¿ç”¨EPSV--egd-file <file>              ä¸ºéšæœºæ•°æ®(SSL)è®¾ç½®EGD socketè·¯å¾„--tcp-nodelay                  ä½¿ç”¨TCP_NODELAYé€‰é¡¹-E/--cert <cert[:passwd]>      å®¢æˆ·ç«¯è¯ä¹¦æ–‡ä»¶å’Œå¯†ç  (SSL)--cert-type <type>              è¯ä¹¦æ–‡ä»¶ç±»å‹ (DER/PEM/ENG) (SSL)--key <key>                    ç§é’¥æ–‡ä»¶å (SSL)--key-type <type>              ç§é’¥æ–‡ä»¶ç±»å‹ (DER/PEM/ENG) (SSL)--pass  <pass>                  ç§é’¥å¯†ç  (SSL)--engine <eng>                  åŠ å¯†å¼•æ“ä½¿ç”¨ (SSL). "--engine list" for list--cacert <file>                CAè¯ä¹¦ (SSL)--capath <directory>            CAç›®   (made using c_rehash) to verify peer against (SSL)--ciphers <list>                SSLå¯†ç --compressed                    è¦æ±‚è¿”å›æ˜¯å‹ç¼©çš„å½¢åŠ¿ (using deflate or gzip)--connect-timeout <seconds>    è®¾ç½®æœ€å¤§è¯·æ±‚æ—¶é—´--create-dirs                  å»ºç«‹æœ¬åœ°ç›®å½•çš„ç›®å½•å±‚æ¬¡ç»“æ„--crlf                          ä¸Šä¼ æ˜¯æŠŠLFè½¬å˜æˆCRLF--ftp-create-dirs              å¦‚æœè¿œç¨‹ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºè¿œç¨‹ç›®å½•--ftp-method [multicwd/nocwd/singlecwd]    æ§åˆ¶CWDçš„ä½¿ç”¨--ftp-pasv                      ä½¿ç”¨ PASV/EPSV ä»£æ›¿ç«¯å£--ftp-skip-pasv-ip              ä½¿ç”¨PASVçš„æ—¶å€™,å¿½ç•¥è¯¥IPåœ°å€--ftp-ssl                      å°è¯•ç”¨ SSL/TLS æ¥è¿›è¡Œftpæ•°æ®ä¼ è¾“--ftp-ssl-reqd                  è¦æ±‚ç”¨ SSL/TLS æ¥è¿›è¡Œftpæ•°æ®ä¼ è¾“-F/--form <name=content>        æ¨¡æ‹Ÿhttpè¡¨å•æäº¤æ•°æ®-form-string <name=string>      æ¨¡æ‹Ÿhttpè¡¨å•æäº¤æ•°æ®-g/--globoff                    ç¦ç”¨ç½‘å€åºåˆ—å’ŒèŒƒå›´ä½¿ç”¨&#123;&#125;å’Œ[]-G/--get                        ä»¥getçš„æ–¹å¼æ¥å‘é€æ•°æ®-h/--help                      å¸®åŠ©-H/--header <line>              è‡ªå®šä¹‰å¤´ä¿¡æ¯ä¼ é€’ç»™æœåŠ¡å™¨--ignore-content-length        å¿½ç•¥çš„HTTPå¤´ä¿¡æ¯çš„é•¿åº¦-i/--include                    è¾“å‡ºæ—¶åŒ…æ‹¬protocolå¤´ä¿¡æ¯-I/--head                      åªæ˜¾ç¤ºæ–‡æ¡£ä¿¡æ¯-j/--junk-session-cookies      è¯»å–æ–‡ä»¶æ—¶å¿½ç•¥session cookie--interface <interface>        ä½¿ç”¨æŒ‡å®šç½‘ç»œæ¥å£/åœ°å€--krb4 <level>                  ä½¿ç”¨æŒ‡å®šå®‰å…¨çº§åˆ«çš„krb4-k/--insecure                  å…è®¸ä¸ä½¿ç”¨è¯ä¹¦åˆ°SSLç«™ç‚¹-K/--config                    æŒ‡å®šçš„é…ç½®æ–‡ä»¶è¯»å–-l/--list-only                  åˆ—å‡ºftpç›®å½•ä¸‹çš„æ–‡ä»¶åç§°--limit-rate <rate>            è®¾ç½®ä¼ è¾“é€Ÿåº¦--local-port<NUM>              å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°ç«¯å£å·-m/--max-time <seconds>        è®¾ç½®æœ€å¤§ä¼ è¾“æ—¶é—´--max-redirs <num>              è®¾ç½®æœ€å¤§è¯»å–çš„ç›®å½•æ•°--max-filesize <bytes>          è®¾ç½®æœ€å¤§ä¸‹è½½çš„æ–‡ä»¶æ€»é‡-M/--manual                    æ˜¾ç¤ºå…¨æ‰‹åŠ¨-n/--netrc                      ä»netrcæ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·åå’Œå¯†ç --netrc-optional                ä½¿ç”¨ .netrc æˆ–è€… URLæ¥è¦†ç›–-n--ntlm                          ä½¿ç”¨ HTTP NTLM èº«ä»½éªŒè¯-N/--no-buffer                  ç¦ç”¨ç¼“å†²è¾“å‡º-p/--proxytunnel                ä½¿ç”¨HTTPä»£ç†--proxy-anyauth                é€‰æ‹©ä»»ä¸€ä»£ç†èº«ä»½éªŒè¯æ–¹æ³•--proxy-basic                  åœ¨ä»£ç†ä¸Šä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯--proxy-digest                  åœ¨ä»£ç†ä¸Šä½¿ç”¨æ•°å­—èº«ä»½éªŒè¯--proxy-ntlm                    åœ¨ä»£ç†ä¸Šä½¿ç”¨ntlmèº«ä»½éªŒè¯-P/--ftp-port <address>        ä½¿ç”¨ç«¯å£åœ°å€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨PASV-Q/--quote <cmd>                æ–‡ä»¶ä¼ è¾“å‰ï¼Œå‘é€å‘½ä»¤åˆ°æœåŠ¡å™¨--range-file                    è¯»å–ï¼ˆSSLï¼‰çš„éšæœºæ–‡ä»¶-R/--remote-time                åœ¨æœ¬åœ°ç”Ÿæˆæ–‡ä»¶æ—¶ï¼Œä¿ç•™è¿œç¨‹æ–‡ä»¶æ—¶é—´--retry <num>                  ä¼ è¾“å‡ºç°é—®é¢˜æ—¶ï¼Œé‡è¯•çš„æ¬¡æ•°--retry-delay <seconds>        ä¼ è¾“å‡ºç°é—®é¢˜æ—¶ï¼Œè®¾ç½®é‡è¯•é—´éš”æ—¶é—´--retry-max-time <seconds>      ä¼ è¾“å‡ºç°é—®é¢˜æ—¶ï¼Œè®¾ç½®æœ€å¤§é‡è¯•æ—¶é—´-S/--show-error                æ˜¾ç¤ºé”™è¯¯--socks4 <host[:port]>          ç”¨socks4ä»£ç†ç»™å®šä¸»æœºå’Œç«¯å£--socks5 <host[:port]>          ç”¨socks5ä»£ç†ç»™å®šä¸»æœºå’Œç«¯å£-t/--telnet-option <OPT=val>    Telneté€‰é¡¹è®¾ç½®--trace <file>                  å¯¹æŒ‡å®šæ–‡ä»¶è¿›è¡Œdebug--trace-ascii <file>            Like --è·Ÿè¸ªä½†æ²¡æœ‰hexè¾“å‡º--trace-time                    è·Ÿè¸ª/è¯¦ç»†è¾“å‡ºæ—¶ï¼Œæ·»åŠ æ—¶é—´æˆ³--url <URL>                    Spet URL to work with-U/--proxy-user <user[:password]>  è®¾ç½®ä»£ç†ç”¨æˆ·åå’Œå¯†ç -V/--version                    æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯-X/--request <command>          æŒ‡å®šä»€ä¹ˆå‘½ä»¤-y/--speed-time                æ”¾å¼ƒé™é€Ÿæ‰€è¦çš„æ—¶é—´ã€‚é»˜è®¤ä¸º30-Y/--speed-limit                åœæ­¢ä¼ è¾“é€Ÿåº¦çš„é™åˆ¶ï¼Œé€Ÿåº¦æ—¶é—´'ç§’-z/--time-cond                  ä¼ é€æ—¶é—´è®¾ç½®-0/--http1.0                    ä½¿ç”¨HTTP 1.0-1/--tlsv1                      ä½¿ç”¨TLSv1ï¼ˆSSLï¼‰-2/--sslv2                      ä½¿ç”¨SSLv2çš„ï¼ˆSSLï¼‰-3/--sslv3                      ä½¿ç”¨çš„SSLv3ï¼ˆSSLï¼‰--3p-quote                      like -Q for the source URL for 3rd party transfer--3p-url                        ä½¿ç”¨urlï¼Œè¿›è¡Œç¬¬ä¸‰æ–¹ä¼ é€--3p-user                      ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿›è¡Œç¬¬ä¸‰æ–¹ä¼ é€-4/--ipv4                      ä½¿ç”¨IP4-6/--ipv6                      ä½¿ç”¨IP6</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–</title>
      <link href="/2020/09/14/zhong-wen-yi-xue-wen-ben-shi-ti-guan-xi-chou-qu/"/>
      <url>/2020/09/14/zhong-wen-yi-xue-wen-ben-shi-ti-guan-xi-chou-qu/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–æ€»ç»“"><a href="#ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–æ€»ç»“" class="headerlink" title="ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–æ€»ç»“"></a>ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–æ€»ç»“</h1><h2 id="ä»»åŠ¡ç®€ä»‹"><a href="#ä»»åŠ¡ç®€ä»‹" class="headerlink" title="ä»»åŠ¡ç®€ä»‹"></a>ä»»åŠ¡ç®€ä»‹</h2><p>å®ä½“å’Œå…³ç³»æŠ½å–ä½œä¸ºä¿¡æ¯æŠ½å–çš„é‡è¦å­ä»»åŠ¡ï¼Œè¿‘äº›å¹´ä¼—å¤šå­¦è€…åˆ©ç”¨å¤šç§æŠ€æœ¯åœ¨è¯¥é¢†åŸŸå¼€å±•æ·±å…¥ç ”ç©¶ã€‚å°†è¿™äº›æŠ€æœ¯åº”ç”¨äºåŒ»å­¦é¢†åŸŸï¼ŒæŠ½å–éç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–çš„åŒ»å­¦æ–‡æœ¬æ„å»ºæˆåŒ»å­¦çŸ¥è¯†å›¾è°±ï¼Œå¯æœåŠ¡äºä¸‹æ¸¸å­ä»»åŠ¡ã€‚éç»“æ„åŒ–çš„åŒ»å­¦æ–‡æœ¬ï¼Œå¦‚åŒ»å­¦æ•™ææ¯ä¸€ä¸ªè‡ªç„¶æ®µè½ï¼Œä¸´åºŠå®è·µä¸­æ¯ç§ç–¾ç—…ä¸‹çš„ä¸»é¢˜ï¼Œç”µå­ç—…å†æ•°æ®ä¸­çš„ä¸»è¯‰ã€ç°ç—…å²ã€é‰´åˆ«è¯Šæ–­ç­‰ï¼Œéƒ½æ˜¯ç”±ä¸­æ–‡è‡ªç„¶è¯­è¨€å¥å­æˆ–å¥å­é›†åˆç»„æˆã€‚å®ä½“å…³ç³»æŠ½å–æ˜¯ä»éç»“æ„åŒ–åŒ»å­¦æ–‡æœ¬ä¸­æ‰¾å‡ºåŒ»å­¦å®ä½“ï¼Œå¹¶ç¡®å®šå®ä½“å¯¹å…³ç³»äº‹å®çš„è¿‡ç¨‹ã€‚</p><h2 id="ä»»åŠ¡è¯¦æƒ…"><a href="#ä»»åŠ¡è¯¦æƒ…" class="headerlink" title="ä»»åŠ¡è¯¦æƒ…"></a>ä»»åŠ¡è¯¦æƒ…</h2><p>ç»™å®šschemaçº¦æŸé›†åˆåŠå¥å­sentenceï¼Œå…¶ä¸­schemaå®šä¹‰äº†å…³ç³»Predicateä»¥åŠå…¶å¯¹åº”çš„ä¸»ä½“Subjectå’Œå®¢ä½“Objectçš„ç±»åˆ«ï¼Œä¾‹å¦‚ï¼š</p><pre class=" language-json"><code class="language-json">ï¼ˆâ€œsubject_typeâ€<span class="token operator">:</span>â€œç–¾ç—…â€ï¼Œâ€œpredicateâ€<span class="token operator">:</span> â€œè¯ç‰©æ²»ç–—â€ï¼Œâ€œobject_typeâ€<span class="token operator">:</span>â€œè¯ç‰©â€ï¼‰ï¼ˆâ€œsubject_typeâ€<span class="token operator">:</span>â€œç–¾ç—…â€ï¼Œâ€œpredicateâ€<span class="token operator">:</span> â€œå®éªŒå®¤æ£€æŸ¥â€ï¼Œâ€œobject_typeâ€<span class="token operator">:</span>â€œæ£€æŸ¥â€ï¼‰</code></pre><p><strong>è¾“å…¥/è¾“å‡º:</strong><br>(1) è¾“å…¥:schemaçº¦æŸé›†åˆåŠå¥å­sentence<br>(2) è¾“å‡º:å¥å­sentenceä¸­åŒ…å«çš„ç¬¦åˆç»™å®šschemaçº¦æŸçš„ä¸‰å…ƒç»„çŸ¥è¯†Triples</p><h2 id="è¯„ä»·æ ‡å‡†"><a href="#è¯„ä»·æ ‡å‡†" class="headerlink" title="è¯„ä»·æ ‡å‡†"></a>è¯„ä»·æ ‡å‡†</h2><p>é‡‡ç”¨Precisionï¼ŒRecallå’ŒF1å€¼ä½œä¸ºè¯„ä»·æŒ‡æ ‡ã€‚</p><h2 id="æ•°æ®ç®€ä»‹"><a href="#æ•°æ®ç®€ä»‹" class="headerlink" title="æ•°æ®ç®€ä»‹"></a>æ•°æ®ç®€ä»‹</h2><h3 id="çº¦æŸé›†"><a href="#çº¦æŸé›†" class="headerlink" title="çº¦æŸé›†"></a>çº¦æŸé›†</h3><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒ–ç–—"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ”¾å°„æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ‰‹æœ¯æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ‰‹æœ¯æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"æ‰‹æœ¯æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ‰‹æœ¯æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å®éªŒå®¤æ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å½±åƒå­¦æ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"è¾…åŠ©æ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç»„ç»‡å­¦æ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å†…çª¥é•œæ£€æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç­›æŸ¥"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æ£€æŸ¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å¤šå‘ç¾¤ä½“"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å‘ç—…ç‡"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å‘ç—…å¹´é¾„"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å¤šå‘åœ°åŒº"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å‘ç—…æ€§åˆ«å€¾å‘"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ­»äº¡ç‡"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å¤šå‘å­£èŠ‚"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ä¼ æ’­é€”å¾„"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"æµè¡Œç—…å­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å¹¶å‘ç—‡"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç—…ç†åˆ†å‹"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç›¸å…³ï¼ˆå¯¼è‡´ï¼‰"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é‰´åˆ«è¯Šæ–­"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç›¸å…³ï¼ˆè½¬åŒ–ï¼‰"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç›¸å…³ï¼ˆç—‡çŠ¶ï¼‰"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ä¸´åºŠè¡¨ç°"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç—‡çŠ¶"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ²»ç–—åç—‡çŠ¶"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç—‡çŠ¶"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ä¾µåŠå‘¨å›´ç»„ç»‡è½¬ç§»çš„ç—‡çŠ¶"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç—‡çŠ¶"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç—‡çŠ¶"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç—‡çŠ¶"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç—…å› "</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é«˜å±å› ç´ "</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é£é™©è¯„ä¼°å› ç´ "</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç—…å²"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é—ä¼ å› ç´ "</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å‘ç—…æœºåˆ¶"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ç—…ç†ç”Ÿç†"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"ç¤¾ä¼šå­¦"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"è¯ç‰©æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"è¯ç‰©"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"è¯ç‰©"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"è¯ç‰©"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å‘ç—…éƒ¨ä½"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"éƒ¨ä½"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"è½¬ç§»éƒ¨ä½"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"éƒ¨ä½"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å¤–ä¾µéƒ¨ä½"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"éƒ¨ä½"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"éƒ¨ä½"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"åŒä¹‰è¯"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"éƒ¨ä½"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é¢„åçŠ¶å†µ"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"é¢„å"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"é¢„åç”Ÿå­˜ç‡"</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> <span class="token string">"é¢„å"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>å±•ç¤ºäº†æ•°æ®é›†ä¸­åŒ…å«çš„53ä¸ªschemaï¼ŒåŒ…å«10ç§åŒä¹‰è¯å­å…³ç³»ï¼Œ43ç§å…¶ä»–å­å…³ç³»ã€‚åŒä¸€ä¸ªpredicateå¯èƒ½æœ‰å¤šä¸ªsubject_typeå’Œobject_typeï¼Œè¿™åœ¨å¯¹predicateåˆ†ç±»çš„æ—¶å€™è¦æ³¨æ„ï¼</p><p><strong>æ•°æ®é›†</strong></p><p>æ•°æ®é›†ä¸­çš„è¯­æ–™æ¥è‡ªåŒ»å­¦æ•™æå’Œä¸´åºŠå®è·µç­‰åŒ»å­¦æ–‡æœ¬ã€‚æ•°æ®é›†åˆ’åˆ†æ–¹å¼ï¼šè®­ç»ƒé›†ï¼ˆ17,924ï¼‰ã€æµ‹è¯•é›†Test1ï¼ˆ4,482ï¼‰ã€æµ‹è¯•é›†Test2ï¼ˆ5,602ï¼‰</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"æ…¢æ€§èƒ°è…ºç‚@### ä½å‰‚é‡æ”¾å°„ è‡ª1964å¹´èµ·ï¼Œæœ‰å‡ é¡¹ç—…ä¾‹ç³»åˆ—æŠ¥é“ç§°å¤–ç…§å°„ (5-50Gy) å¯ä»¥æœ‰æ•ˆæ”¹å–„æ…¢æ€§èƒ°è…ºç‚æ‚£è€…çš„ç–¼ç—›ç—‡çŠ¶ã€‚æ…¢æ€§èƒ°è…ºç‚@ä»æ¦‚å¿µä¸Šè®²ï¼Œå¤–ç…§å°„å¯ä»¥èµ·åˆ°æŠ—ç‚å’Œæ­¢ç—›ä½œç”¨ï¼Œå¹¶ä¸”å·²ç»å¼€å§‹è¢«ç”¨äºéè‚¿ç˜¤æ€§ç–¼ç—›çš„æ²»ç–—ã€‚"</span><span class="token punctuation">,</span> <span class="token property">"spo_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"Combined"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ”¾å°„æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"subject"</span><span class="token operator">:</span> <span class="token string">"æ…¢æ€§èƒ°è…ºç‚"</span><span class="token punctuation">,</span> <span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"@value"</span><span class="token operator">:</span> <span class="token string">"å¤–ç…§å°„"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"@value"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"Combined"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ”¾å°„æ²»ç–—"</span><span class="token punctuation">,</span> <span class="token property">"subject"</span><span class="token operator">:</span> <span class="token string">"éè‚¿ç˜¤æ€§ç–¼ç—›"</span><span class="token punctuation">,</span> <span class="token property">"subject_type"</span><span class="token operator">:</span> <span class="token string">"ç–¾ç—…"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"@value"</span><span class="token operator">:</span> <span class="token string">"å¤–ç…§å°„"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token property">"object_type"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"@value"</span><span class="token operator">:</span> <span class="token string">"å…¶ä»–æ²»ç–—"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p><code>text</code>æ˜¯æ–‡æœ¬ï¼Œ<code>Combined</code>è¿™è¾¹æ²¡æœ‰ç”¨åˆ°ï¼Œ<code>predicate</code>è°“è¯­ï¼Œä¹Ÿå«å…³ç³» , <code>subject</code>ï¼šä¸»è¯­,<code>subject_type</code>ä¸»è¯­ç±»å‹, <code>object</code></p><p>å®¾è¯­,<code>object_type</code>å®¾è¯­ç±»å‹</p><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p>æ•°æ®æ¸…æ™°å¹¶ç¼“å­˜åˆ°æ–‡ä»¶ä¸­</p><pre class=" language-python"><code class="language-python"> <span class="token keyword">def</span> <span class="token function">_read</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> data_type<span class="token punctuation">)</span><span class="token punctuation">:</span>        examples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fr<span class="token punctuation">:</span>            p_id <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">for</span> line <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>fr<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                p_id <span class="token operator">+=</span> <span class="token number">1</span>                src_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>                text_raw <span class="token operator">=</span> src_data<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span>                text_raw <span class="token operator">=</span> text_raw<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'Â®'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>                text_raw <span class="token operator">=</span> text_raw<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'â—†'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>                text_raw <span class="token operator">=</span> text_raw<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>                tokens<span class="token punctuation">,</span> tok_to_orig_start_index<span class="token punctuation">,</span> tok_to_orig_end_index <span class="token operator">=</span> covert_to_tokens<span class="token punctuation">(</span>text_raw<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_seq_length<span class="token punctuation">,</span> return_orig_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>                tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"[CLS]"</span><span class="token punctuation">]</span> <span class="token operator">+</span> tokens <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">"[SEP]"</span><span class="token punctuation">]</span>                sub_po_dict<span class="token punctuation">,</span> sub_ent_list<span class="token punctuation">,</span> spo_list <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">'spo_list'</span> <span class="token operator">not</span> <span class="token keyword">in</span> src_data<span class="token punctuation">:</span>                    examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>                        Example<span class="token punctuation">(</span>                            p_id<span class="token operator">=</span>p_id<span class="token punctuation">,</span>                            raw_text<span class="token operator">=</span>src_data<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                            context<span class="token operator">=</span>text_raw<span class="token punctuation">,</span>                            tok_to_orig_start_index<span class="token operator">=</span>tok_to_orig_start_index<span class="token punctuation">,</span>                            tok_to_orig_end_index<span class="token operator">=</span>tok_to_orig_end_index<span class="token punctuation">,</span>                            bert_tokens<span class="token operator">=</span>tokens<span class="token punctuation">,</span>                            sub_entity_list<span class="token operator">=</span>None<span class="token punctuation">,</span>                            gold_answer<span class="token operator">=</span>None<span class="token punctuation">,</span>                            spoes<span class="token operator">=</span>None                        <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    spoes <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>                    <span class="token keyword">for</span> spo <span class="token keyword">in</span> src_data<span class="token punctuation">[</span><span class="token string">'spo_list'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        spo_dict <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token keyword">for</span> spo_object <span class="token keyword">in</span> spo<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            label <span class="token operator">=</span> spo<span class="token punctuation">[</span><span class="token string">'subject_type'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"|||"</span> <span class="token operator">+</span> spo<span class="token punctuation">[</span><span class="token string">'predicate'</span><span class="token punctuation">]</span>                            spo_dict<span class="token punctuation">[</span>self<span class="token punctuation">.</span>spo_conf<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> spo<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>spo_object<span class="token punctuation">]</span>                        <span class="token keyword">for</span> spo_object <span class="token keyword">in</span> spo<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token comment" spellcheck="true"># assign relation label</span>                            predicate_label <span class="token operator">=</span> self<span class="token punctuation">.</span>spo_conf<span class="token punctuation">[</span>spo<span class="token punctuation">[</span><span class="token string">'subject_type'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"|||"</span> <span class="token operator">+</span> spo<span class="token punctuation">[</span><span class="token string">'predicate'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                            subject_sub_tokens <span class="token operator">=</span> covert_to_tokens<span class="token punctuation">(</span>spo<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_seq_length<span class="token punctuation">)</span>                            object_sub_tokens <span class="token operator">=</span> covert_to_tokens<span class="token punctuation">(</span>spo<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'@value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_seq_length<span class="token punctuation">)</span>                            sub_ent_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>spo<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            subject_start<span class="token punctuation">,</span> object_start <span class="token operator">=</span> search_spo_index<span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> subject_sub_tokens<span class="token punctuation">,</span> object_sub_tokens<span class="token punctuation">)</span>                            <span class="token keyword">if</span> subject_start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                                subject_start <span class="token operator">=</span> search<span class="token punctuation">(</span>subject_sub_tokens<span class="token punctuation">,</span> tokens<span class="token punctuation">)</span>                            <span class="token keyword">if</span> object_start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                                object_start <span class="token operator">=</span> search<span class="token punctuation">(</span>object_sub_tokens<span class="token punctuation">,</span> tokens<span class="token punctuation">)</span>                            <span class="token keyword">if</span> subject_start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">and</span> object_start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                                s <span class="token operator">=</span> <span class="token punctuation">(</span>subject_start<span class="token punctuation">,</span> subject_start <span class="token operator">+</span> len<span class="token punctuation">(</span>subject_sub_tokens<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>                                o <span class="token operator">=</span> <span class="token punctuation">(</span>object_start<span class="token punctuation">,</span> object_start <span class="token operator">+</span> len<span class="token punctuation">(</span>object_sub_tokens<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> predicate_label<span class="token punctuation">)</span>                                <span class="token keyword">if</span> s <span class="token operator">not</span> <span class="token keyword">in</span> spoes<span class="token punctuation">:</span>                                    spoes<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                spoes<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>o<span class="token punctuation">)</span>                    examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>                        Example<span class="token punctuation">(</span>                            p_id<span class="token operator">=</span>p_id<span class="token punctuation">,</span>                            raw_text<span class="token operator">=</span>src_data<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                            context<span class="token operator">=</span>text_raw<span class="token punctuation">,</span>                            tok_to_orig_start_index<span class="token operator">=</span>tok_to_orig_start_index<span class="token punctuation">,</span>                            tok_to_orig_end_index<span class="token operator">=</span>tok_to_orig_end_index<span class="token punctuation">,</span>                            bert_tokens<span class="token operator">=</span>tokens<span class="token punctuation">,</span>                            sub_entity_list<span class="token operator">=</span>sub_ent_list<span class="token punctuation">,</span>                            gold_answer<span class="token operator">=</span>src_data<span class="token punctuation">[</span><span class="token string">'spo_list'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                            spoes<span class="token operator">=</span>spoes                        <span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print('total gold num is &amp;#123;&amp;#125;'.format(gold_num))</span>        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"&amp;#123;&amp;#125; total size is  &amp;#123;&amp;#125; "</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>data_type<span class="token punctuation">,</span> len<span class="token punctuation">(</span>examples<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> examples</code></pre><p>æ•°æ®çš„è¾“å…¥ï¼š</p><pre class=" language-python"><code class="language-python">input_ids <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span> æ–‡æœ¬çš„token_idsegment_ids<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>token_type_idstoken_type_ids<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>å°±æ˜¯ token å¯¹åº”çš„å¥å­idï¼Œå€¼ä¸º<span class="token number">0</span>æˆ–<span class="token number">1</span>ï¼ˆ<span class="token number">0</span>è¡¨ç¤ºå¯¹åº”çš„tokenå±äºç¬¬ä¸€å¥ï¼Œ<span class="token number">1</span>è¡¨ç¤ºå±äºç¬¬äºŒå¥ï¼‰ã€‚subject_ids<span class="token punctuation">,</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>subject<span class="token punctuation">[</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">]</span>ä½ç½®subject_labels<span class="token operator">-</span><span class="token operator">></span>ä¸»è¯­å¯ç¤ºæŒ‡é’ˆï¼»batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> <span class="token number">2</span>ï¼½object_labels<span class="token operator">></span>å®¾è¯­ï¼‹è°“è¯­å¯ç¤ºæŒ‡é’ˆï¼»batch_size<span class="token punctuation">,</span> seq_len<span class="token punctuation">,</span> num_classify<span class="token punctuation">,</span> <span class="token number">2</span>ï¼½</code></pre><p><img src="/2020/09/14/zhong-wen-yi-xue-wen-ben-shi-ti-guan-xi-chou-qu/1.png"></p><h2 id="æ¨¡å‹éƒ¨åˆ†"><a href="#æ¨¡å‹éƒ¨åˆ†" class="headerlink" title="æ¨¡å‹éƒ¨åˆ†"></a>æ¨¡å‹éƒ¨åˆ†</h2><p>ç†è®ºå‚è€ƒï¼š<a href="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/" title="Joint-Extraction-of-Entities-and-Relations-Based-on-a-Novel-Decomposition-Strategy">Joint-Extraction-of-Entities-and-Relations-Based-on-a-Novel-Decomposition-Strategy</a></p><pre><code>bert_encoder = self.bert(passage_ids, token_type_ids=segment_ids, attention_mask=mask)[0] #[batch_size, seq_len, hidden_site]        if not is_eval:            sub_start_encoder = batch_gather(bert_encoder, subject_ids[:, 0]) #[batch_size, hidden_site]            sub_end_encoder = batch_gather(bert_encoder, subject_ids[:, 1]) #[batch_size, hidden_site]            subject = torch.cat([sub_start_encoder, sub_end_encoder], 1) #[batch_size, 2*hidden_site]            #[batch_size,seq_len, hidden_site] å½’ä¸€åŒ–            context_encoder = self.LayerNorm(bert_encoder, subject)             sub_preds = self.subject_dense(bert_encoder) #[batch_size,seq_len, 2]            ##[batch_size,seq_len, num_classify,2]            po_preds = self.po_dense(context_encoder).reshape(passage_ids.size(0), -1, self.classes_num, 2) </code></pre><p>æ¨¡å‹å¾ˆç®€å•ï¼Œfine-tuneã€€bertåæ¥# pointer net work</p><h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><pre class=" language-python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>input<span class="token operator">/</span>media<span class="token operator">/</span>daiyizheng<span class="token operator">/</span>SSD<span class="token operator">/</span>data<span class="token operator">/</span>CCKS<span class="token operator">/</span><span class="token number">2020</span><span class="token operator">/</span>ccks2020ä¸­æ–‡åŒ»å­¦æ–‡æœ¬å®ä½“å…³ç³»æŠ½å–<span class="token operator">/</span><span class="token operator">-</span><span class="token operator">-</span>outputoutput<span class="token operator">-</span><span class="token operator">-</span>bert_model<span class="token operator">/</span>media<span class="token operator">/</span>daiyizheng<span class="token operator">/</span>SSD<span class="token operator">/</span>bert<span class="token operator">-</span>pretrainmodel<span class="token operator">/</span>roberta<span class="token operator">/</span>chinese_roberta_wwm_large_ext_pytorch<span class="token operator">/</span><span class="token operator">-</span><span class="token operator">-</span>max_len<span class="token number">310</span><span class="token operator">-</span><span class="token operator">-</span>train_batch_size<span class="token number">3</span><span class="token operator">-</span><span class="token operator">-</span>learning_rate<span class="token number">2e</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">-</span><span class="token operator">-</span>epoch_num<span class="token number">100</span></code></pre><p>ä½¿ç”¨BERT,ROBERTAä»¥åŠROBERA_large,å‘ç°ROBERA_largeè®­ç»ƒæ•ˆæœæœ€å¥½(è®­ç»ƒäº†ï¼’å¤©ï¼Œæœ‰ç‚¹æ…¢)</p><h2 id="è¯„ä¼°"><a href="#è¯„ä¼°" class="headerlink" title="è¯„ä¼°"></a>è¯„ä¼°</h2><pre class=" language-python"><code class="language-python">entity_em <span class="token operator">=</span> <span class="token number">0</span>        entity_pred_num <span class="token operator">=</span> <span class="token number">0</span>        entity_gold_num <span class="token operator">=</span> <span class="token number">0</span>        tp<span class="token punctuation">,</span> fp<span class="token punctuation">,</span> fn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>        <span class="token keyword">for</span> key <span class="token keyword">in</span> answer_dict<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            triple_gold <span class="token operator">=</span> eval_file<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>gold_answer            entity_gold <span class="token operator">=</span> eval_file<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>sub_entity_list            entity_pred <span class="token operator">=</span> answer_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            triple_pred <span class="token operator">=</span> answer_dict<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            entity_em <span class="token operator">+=</span> len<span class="token punctuation">(</span>set<span class="token punctuation">(</span>entity_pred<span class="token punctuation">)</span> <span class="token operator">&amp;</span> set<span class="token punctuation">(</span>entity_gold<span class="token punctuation">)</span><span class="token punctuation">)</span>            entity_pred_num <span class="token operator">+=</span> len<span class="token punctuation">(</span>set<span class="token punctuation">(</span>entity_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>            entity_gold_num <span class="token operator">+=</span> len<span class="token punctuation">(</span>set<span class="token punctuation">(</span>entity_gold<span class="token punctuation">)</span><span class="token punctuation">)</span>            tp_tmp<span class="token punctuation">,</span> fp_tmp<span class="token punctuation">,</span> fn_tmp <span class="token operator">=</span> calculate_metric<span class="token punctuation">(</span>                triple_gold<span class="token punctuation">,</span> triple_pred<span class="token punctuation">)</span>            tp <span class="token operator">+=</span> tp_tmp            fp <span class="token operator">+=</span> fp_tmp            fn <span class="token operator">+=</span> fn_tmp        p <span class="token operator">=</span> tp <span class="token operator">/</span> <span class="token punctuation">(</span>tp <span class="token operator">+</span> fp<span class="token punctuation">)</span> <span class="token keyword">if</span> tp <span class="token operator">+</span> fp <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token comment" spellcheck="true">#-->ç²¾ç¡®ç‡</span>        r <span class="token operator">=</span> tp <span class="token operator">/</span> <span class="token punctuation">(</span>tp <span class="token operator">+</span> fn<span class="token punctuation">)</span> <span class="token keyword">if</span> tp <span class="token operator">+</span> fn <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token comment" spellcheck="true">#å¬å›ç‡</span>        f <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> p <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token keyword">if</span> p <span class="token operator">+</span> r <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token comment" spellcheck="true"># f1-score</span></code></pre><p>æœ€æ€»ç»“æœï¼štrain f1:0.71  dev 0.59 test 0.56</p><h2 id="ä¼˜åŒ–æ–¹å‘"><a href="#ä¼˜åŒ–æ–¹å‘" class="headerlink" title="ä¼˜åŒ–æ–¹å‘"></a>ä¼˜åŒ–æ–¹å‘</h2><ol><li>fine-tuneä¸€äº›åŒ»å­¦æ•°æ®åšé¢„è®­ç»ƒ</li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…³ç³»æŠ½å– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TorchServe</title>
      <link href="/2020/09/14/torchserve/"/>
      <url>/2020/09/14/torchserve/</url>
      
        <content type="html"><![CDATA[<h1 id="TorchServe"><a href="#TorchServe" class="headerlink" title="TorchServe"></a>TorchServe</h1><h2 id="ä»€ä¹ˆæ˜¯TorchServe"><a href="#ä»€ä¹ˆæ˜¯TorchServe" class="headerlink" title="ä»€ä¹ˆæ˜¯TorchServe"></a>ä»€ä¹ˆæ˜¯TorchServe</h2><p>TorchServeæ˜¯ç”¨äºæœåŠ¡PyTorchæ¨¡å‹çš„çµæ´»æ˜“ç”¨çš„å·¥å…·ã€‚å®ƒæ²¡æœ‰TFXçš„å¤æ‚æ€§ï¼Œå› æ­¤ï¼Œå®ƒæ²¡æœ‰æä¾›é‚£ä¹ˆå¤šçš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯å®Œæˆå·¥ä½œçš„ç›´æ¥æ–¹æ³•ï¼</p><p><img src="/2020/09/14/torchserve/1.png"></p><p>â€‹       TorchServeæä¾›äº†ä¸€ç»„å¿…è¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å™¨ï¼Œæ¨¡å‹å­˜æ¡£å™¨å·¥å…·ï¼ŒAPIç«¯ç‚¹è§„èŒƒï¼Œæ—¥å¿—è®°å½•ï¼Œåº¦é‡ï¼Œæ‰¹å¤„ç†æ¨æ–­å’Œæ¨¡å‹å¿«ç…§ç­‰ã€‚å®ƒè¿˜æä¾›äº†ä¸€ç³»åˆ—é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œå¯¹å®šåˆ¶æ¨ç†æœåŠ¡çš„æ”¯æŒï¼Œå•å…ƒæµ‹è¯•ä»¥åŠé€šè¿‡JMeteræ”¶é›†åŸºå‡†æ•°æ®çš„ç®€ä¾¿æ–¹æ³•ã€‚ç›®å‰ï¼Œå®ƒå¤„äºå®éªŒé˜¶æ®µï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒçš„å·¥ä½œåŸç†å°±åƒæ˜¯ä¸€ç§é­…åŠ›ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡åé¢çš„éƒ¨åˆ†ä¸­è¿›è¡Œæµ‹è¯•ã€‚</p><ul><li>æ”¯æŒ<a href="https://huggingface.co/">HuggingFace</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ åº“ï¼Œå…¶ä»»åŠ¡æ˜¯ä¸ºæ‰€æœ‰äººæé«˜NLPçš„ä½¿ç”¨ç¨‹åº¦ï¼Œå¹¶æä¾›æ–‡æ¡£å’Œç¤ºä¾‹</li><li>æ”¯æŒ<a href="https://github.com/NVIDIA/waveglow">Nvidia Waveglow</a>ï¼ˆä¸€ä¸ªåŸºäºæµçš„è¯­éŸ³åˆæˆç”Ÿæˆç½‘ç»œï¼Œæä¾›æ–‡æ¡£å’Œç¤ºä¾‹ï¼‰</li><li>ä¸Model Zooç´§å¯†é›†æˆï¼ŒModel Zooæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ³¨å†Œè¡¨ï¼Œå…¶ä¸­åŒ…å«æ ¹æ®æµè¡Œçš„é¢„è®­ç»ƒæ¨¡å‹åˆ›å»ºçš„æ¨¡å‹æ¡£æ¡ˆ</li><li>æ”¯æŒ<a href="https://aws.amazon.com/cloudformation/">AWS Cloud Forming</a>ï¼Œå¯é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶ï¼ˆYAMLæˆ–JSONï¼‰æ–¹ä¾¿åœ°åœ¨EC2å®ä¾‹ä¸Šå¯åŠ¨æœåŠ¡å™¨</li><li>æ”¯æŒé€šè¿‡<a href="https://jiffyclub.github.io/snakeviz/">snakevize</a>åˆ†æå™¨å¯¹TorchServe Pythonæ‰§è¡Œ<a href="https://jiffyclub.github.io/snakeviz/">æ€§èƒ½</a>åˆ†æï¼Œä»¥è¯¦ç»†æŠ¥å‘Šæ‰§è¡Œæ—¶é—´</li><li>å…·æœ‰æ¸…æ™°è¯´æ˜çš„é‡æ„æ–‡æ¡£</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li>JAVA å®‰è£…ã€€JDK&gt;=8</li></ul><p>For Ubuntu:</p><pre><code>sudo apt-get install openjdk-11-jdk</code></pre><p>For CentOS:</p><pre><code>openjdk-11-jdksudo yum install java-11-openjdk</code></pre><p>For macOS:</p><pre><code>brew tap AdoptOpenJDK/openjdkbrew cask install adoptopenjdk11</code></pre><p><code>torch</code>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šå®‰è£…TorchServe ã€‚è¯¥é¡¹ç›®ä¸­çš„å¤§å¤šæ•°ç¤ºä¾‹éƒ½éœ€è¦ä½¿ç”¨Torchã€‚</p><ul><li>For virtualenv</li></ul><pre><code>#For CPU/GPUpip install torch torchvision torchtext</code></pre><ul><li>For conda</li></ul><pre><code>#For CPUconda install -c pytorch -c powerai pytorch torchtext torchvision#For GPUconda install -c pytorch -c powerai pytorch torchtext torchvision cudatoolkit=10.1</code></pre><h3 id="pip-å®‰è£…"><a href="#pip-å®‰è£…" class="headerlink" title="pip å®‰è£…"></a>pip å®‰è£…</h3><p><strong>From PyTorch official repositories</strong></p><pre><code>pip install -f https://download.pytorch.org/whl/torch_stable.html torchserve torch-model-archiver</code></pre><h3 id="condaå®‰è£…"><a href="#condaå®‰è£…" class="headerlink" title="condaå®‰è£…"></a>condaå®‰è£…</h3><pre><code>conda install -c pytorch torchserve torch-model-archiver</code></pre><h3 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h3><h3 id="CPU-only"><a href="#CPU-only" class="headerlink" title="CPU only"></a>CPU only</h3><p>For specific versions use:</p><pre><code>docker run --rm -it -p 8080:8080 -p 8081:8081 pytorch/torchserve:0.1-cpu</code></pre><p>For the latest version you can use the <code>latest</code> tag:</p><pre><code>docker run --rm -it -p 8080:8080 -p 8081:8081 pytorch/torchserve:latest</code></pre><h3 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h3><p>For specific versions use:</p><pre><code>docker run --rm -it --gpus all -p 8080:8080 -p 8081:8081 pytorch/torchserve:0.1-cuda10.1-cudnn7-runtime</code></pre><p>For the latest version you can use the <code>gpu-latest</code> tag:</p><pre><code>docker run --rm -it --gpus all -p 8080:8080 -p 8081:8081 pytorch/torchserve:latest-gpu</code></pre><blockquote><p>ä¸ªäººæ¨èä½¿ç”¨Dockerå®‰è£…ï¼Œçœå»å®‰è£…ç¯å¢ƒçš„éº»çƒ¦ï¼</p></blockquote><h2 id="ç¤ºä¾‹ä¸€"><a href="#ç¤ºä¾‹ä¸€" class="headerlink" title="ç¤ºä¾‹ä¸€"></a>ç¤ºä¾‹ä¸€</h2><p>å®‰è£…TorchServeï¼Œè¯·æŒ‰ç…§<a href="https://github.com/pytorch/serve/blob/master/README.md#installing-torchserve-with-pip">GitHubä¸Š</a>çš„è¯´æ˜è¿›è¡Œæ“ä½œ</p><ol><li>ä¸‹è½½TorchServeå­˜å‚¨åº“ä»¥è®¿é—®ç¤ºä¾‹ã€‚è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> torchserve-examples<span class="token function">cd</span> torchserve-examples<span class="token function">git</span> clone https://github.com/pytorch/serve.git</code></pre><ol start="2"><li>ä»å®˜æ–¹PyTorchæ¨¡å‹åº“ä¸­ä¸‹è½½DenseNetå›¾åƒåˆ†ç±»æ¨¡å‹ã€‚è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">wget</span> https://download.pytorch.org/models/densenet161-8d451a50.pth</code></pre><ol start="3"><li>å°†æ¨¡å‹ä»PyTorchè½¬æ¢ä¸ºTorchServeæ ¼å¼ã€‚TorchServeä½¿ç”¨æ‰©å±•åä¸º.marçš„æ¨¡å‹å­˜æ¡£æ ¼å¼ã€‚.maræ–‡ä»¶ä½¿ç”¨<code>state_dict</code>ï¼ˆå°†æ¯ä¸ªå±‚æ˜ å°„åˆ°å…¶å‚æ•°å¼ é‡çš„å­—å…¸å¯¹è±¡ï¼‰æ‰“åŒ…æ¨¡å‹æ£€æŸ¥ç‚¹æˆ–æ¨¡å‹å®šä¹‰æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>torch-model-archiver</code>TorchServeä¸­çš„å·¥å…·æ¥åˆ›å»º.maræ–‡ä»¶ã€‚æ‚¨æ— éœ€åˆ›å»ºè‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼Œåªéœ€æŒ‡å®šå³å¯<code>--handler image_classifier</code>ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ºæ‚¨è®¾ç½®å¤„ç†ç¨‹åºã€‚ç°åœ¨æ‚¨å·²ç»æœ‰äº†.maræ–‡ä»¶ï¼Œè¯·ä½¿ç”¨TorchServeæ‰˜ç®¡å®ƒã€‚è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</li></ol><pre class=" language-bash"><code class="language-bash">torch-model-archiver --model-name densenet161 \--version 1.0 --model-file serve/examples/image_classifier/densenet_161/model.py \--serialized-file densenet161-8d451a50.pth \--extra-files serve/examples/image_classifier/index_to_name.json \--handler image_classifier<span class="token function">ls</span> *.mar</code></pre><p><strong>handler</strong> è‡ªå®šä¹‰</p><p>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç±»å…·æœ‰ä»»ä½•åç§°æ¥åˆ›å»ºè‡ªå®šä¹‰å¤„ç†ç¨‹åºï¼Œä½†æ˜¯è¯¥ç±»å¿…é¡»å…·æœ‰<code>initialize</code>å’Œ<code>handle</code>æ–¹æ³•ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ModelHandler</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    A custom model handler implementation.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_context <span class="token operator">=</span> None        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">False</span>        self<span class="token punctuation">.</span>model <span class="token operator">=</span> None        self<span class="token punctuation">.</span>device <span class="token operator">=</span> None    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Invoke by torchserve for loading a model        :param context: context contains model server system properties        :return:        """</span>        <span class="token comment" spellcheck="true">#  load the model</span>        self<span class="token punctuation">.</span>manifest <span class="token operator">=</span> context<span class="token punctuation">.</span>manifest        properties <span class="token operator">=</span> context<span class="token punctuation">.</span>system_properties        model_dir <span class="token operator">=</span> properties<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"model_dir"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>properties<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"gpu_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Read model serialize/pt file</span>        serialized_file <span class="token operator">=</span> self<span class="token punctuation">.</span>manifest<span class="token punctuation">[</span><span class="token string">'model'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'serializedFile'</span><span class="token punctuation">]</span>        model_pt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>model_dir<span class="token punctuation">,</span> serialized_file<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>model_pt_path<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"Missing the model.pt file"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>model <span class="token operator">=</span> torch<span class="token punctuation">.</span>jit<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_pt_path<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Invoke by TorchServe for prediction request.        Do pre-processing of data, prediction using model and postprocessing of prediciton output        :param data: Input data for prediction        :param context: Initial context contains model server system properties.        :return: prediction output        """</span>        pred_out <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">return</span> pred_out</code></pre><p><strong>handleré«˜çº§è‡ªå®šä¹‰å¤„ç†ç¨‹åº</strong></p><p>ä»å¤´å¼€å§‹ç¼–å†™è‡ªå®šä¹‰å¤„ç†ç¨‹åº</p><p><em>é€šå¸¸ï¼Œæ‚¨åº”è¯¥ä»BaseHandleræ´¾ç”Ÿï¼Œå¹¶ä¸”åªé‡å†™è¡Œä¸ºéœ€è¦æ›´æ”¹çš„æ–¹æ³•ï¼</em>å¦‚æ‚¨åœ¨ç¤ºä¾‹ä¸­æ‰€è§ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€è¦è¦†ç›–<code>preprocess</code>æˆ–<code>postprocess</code></p><p>å°½ç®¡å¦‚æ­¤ï¼Œæ‚¨ä»ç„¶å¯ä»¥ä»å¤´å¼€å§‹ç¼–å†™ä¸€ä¸ªç±»ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒéµå¾ªå…¸å‹çš„Init-Pre-Infer-Postæ¨¡å¼åˆ›å»ºå¯ç»´æŠ¤çš„è‡ªå®šä¹‰å¤„ç†ç¨‹åºã€‚</p><pre class=" language-python"><code class="language-python"> custom handler file<span class="token comment" spellcheck="true"># model_handler.py</span><span class="token triple-quoted-string string">"""ModelHandler defines a custom model handler."""</span><span class="token keyword">from</span> ts<span class="token punctuation">.</span>torch_handler<span class="token punctuation">.</span>base_handler <span class="token keyword">import</span> BaseHandler<span class="token keyword">class</span> <span class="token class-name">ModelHandler</span><span class="token punctuation">(</span>BaseHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    A custom model handler implementation.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_context <span class="token operator">=</span> None        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Initialize model. This will be called during model loading time        :param context: Initial context contains model server system properties.        :return:        """</span>        self<span class="token punctuation">.</span>_context <span class="token operator">=</span> context        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token comment" spellcheck="true">#  load the model, refer 'custom handler class' above for details</span>    <span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Transform raw input into model input data.        :param batch: list of raw requests, should match batch size        :return: list of preprocessed model input data        """</span>        <span class="token comment" spellcheck="true"># Take the input data and make it inference ready</span>        preprocessed_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> preprocessed_data <span class="token keyword">is</span> None<span class="token punctuation">:</span>            preprocessed_data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> preprocessed_data    <span class="token keyword">def</span> <span class="token function">inference</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_input<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Internal inference methods        :param model_input: transformed model input data        :return: list of inference output in NDArray        """</span>        <span class="token comment" spellcheck="true"># Do some inference call to engine here and return output</span>        model_output <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>model_input<span class="token punctuation">)</span>        <span class="token keyword">return</span> model_output    <span class="token keyword">def</span> <span class="token function">postprocess</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inference_output<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Return inference result.        :param inference_output: list of inference output        :return: list of predict results        """</span>        <span class="token comment" spellcheck="true"># Take output from network and post-process to desired format</span>        postprocess_output <span class="token operator">=</span> inference_output        <span class="token keyword">return</span> postprocess_output    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Invoke by TorchServe for prediction request.        Do pre-processing of data, prediction using model and postprocessing of prediciton output        :param data: Input data for prediction        :param context: Initial context contains model server system properties.        :return: prediction output        """</span>        model_input <span class="token operator">=</span> self<span class="token punctuation">.</span>preprocess<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        model_output <span class="token operator">=</span> self<span class="token punctuation">.</span>inference<span class="token punctuation">(</span>model_input<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>postprocess<span class="token punctuation">(</span>model_output<span class="token punctuation">)</span></code></pre><ol><li>æ‚¨æ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</li></ol><pre class=" language-bash"><code class="language-bash">densenet161.mar serve</code></pre><p>â€‹    ä¸»æ¨¡å‹ã€‚è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> model_store<span class="token function">mv</span> densenet161.mar model_store/torchserve --start --model-store model_store --models densenet161<span class="token operator">=</span>densenet161.mar <span class="token comment" spellcheck="true">#édockerå®‰è£…</span><span class="token comment" spellcheck="true">#dockerå®‰è£…ã€€æ¨è</span>docker run --rm -it -p 3000:8080 -p 3001:8081 -v <span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>/model_store:/home/model-server/model-store pytorch/torchserve:0.1-cpu  torchserve --start --model-store model_store --models densenet161<span class="token operator">=</span>densenet161.mar <span class="token operator">&amp;</span><span class="token operator">></span>server.log 2<span class="token operator">></span><span class="token operator">&amp;</span>1</code></pre><blockquote><p> æ‰©å±•ï¼š<code>torch-model-archiver --model-name resnet34 \--version 1.0 \--serialized-file resnet34.pt \--extra-files ./index_to_name.json,./MyHandler.py \--handler my_handler.py \--export-path model-store -f</code></p><p>å˜é‡<code>--model-name</code>å®šä¹‰äº†æ¨¡å‹çš„æœ€ç»ˆåç§°ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå®ƒå°†æ˜¯endpointçš„åç§°ç©ºé—´ï¼Œè´Ÿè´£è¿›è¡Œé¢„æµ‹ã€‚ä½ è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ª<code>--version</code>ã€‚<code>--serialized-file</code>æŒ‡å‘æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„å­˜å‚¨çš„ <code>.pt</code>æ¨¡å‹ã€‚<code>--handler</code> æ˜¯ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­è°ƒç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰handlerã€‚</p><p>å®ƒæš´éœ²äº†ä¸€ä¸ª<code>handle</code>å‡½æ•°ï¼Œæˆ‘ä»¬ä»è¯¥å‡½æ•°è°ƒç”¨è‡ªå®šä¹‰handlerä¸­çš„æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨é»˜è®¤åç§°æ¥ä½¿ç”¨é»˜è®¤handler(ä¾‹å¦‚ï¼Œ<code>--handler image_classifier</code>)ã€‚</p><p>åœ¨<code>--extra-files</code>ä¸­ï¼Œä½ éœ€è¦å°†è·¯å¾„ä¼ é€’ç»™ä½ çš„handlersæ­£åœ¨ä½¿ç”¨çš„æ‰€æœ‰æ–‡ä»¶ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å‘<code>.json</code>æ–‡ä»¶ä¸­æ·»åŠ è·¯å¾„ã€‚ä½¿ç”¨æ‰€æœ‰äººç±»å¯è¯»æ ‡ç­¾åç§°ï¼Œå¹¶åœ¨<code>MyHandler.py</code> ä¸­å®šä¹‰æ¯ä¸ªç±»åˆ«ã€‚</p><p>å¦‚æœä½ ä¼ é€’ä¸€ä¸ª<code>index_to_name.json</code>æ–‡ä»¶ï¼Œå®ƒå°†è‡ªåŠ¨åŠ è½½åˆ°handler ï¼Œå¹¶é€šè¿‡<code>self.mapping</code>è®¿é—®ã€‚</p><p><code>--export-path</code>å°±æ˜¯ <code>.mar</code>å­˜æ”¾çš„åœ°æ–¹ï¼Œæˆ‘è¿˜æ·»åŠ äº†<code>-f</code>æ¥è¦†ç›–åŸæœ‰çš„æ–‡ä»¶ã€‚</p><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>resnet34.mar</code>å­˜æ”¾åœ¨<code>./model-store</code>è·¯å¾„ä¸­ã€‚</p></blockquote><p>å‚è€ƒï¼š<a href="https://jishuin.proginn.com/p/763bfbd2c54d">https://jishuin.proginn.com/p/763bfbd2c54d</a></p><p>æ³¨æ„ï¼š(1)docker rmåªæ˜¯åˆ é™¤å®¹å™¨ï¼Œrm -v ä¸ä»…åˆ é™¤å®¹å™¨ï¼ˆå¦‚æœå®¹å™¨æœ‰ä½¿ç”¨å·ï¼Œå·ä¹Ÿä¼šè¿›è¡Œç›¸åº”çš„åˆ é™¤ï¼‰ã€‚ä¸èƒ½ä¸-dä¸€èµ·ä½¿ç”¨,æ³¨æ„è°ƒç”¨å†…éƒ¨æ¥å£3001,å¤–éƒ¨æ¥å£3000</p><ol><li>è°ƒç”¨</li></ol><pre class=" language-python"><code class="language-python">curl <span class="token operator">-</span>X POST http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">3000</span><span class="token operator">/</span>predictions<span class="token operator">/</span>densenet161 <span class="token operator">-</span>T <span class="token punctuation">.</span><span class="token operator">/</span>examples<span class="token operator">/</span>image_classifier<span class="token operator">/</span>kitten<span class="token punctuation">.</span>jpg</code></pre><p>curlçŸ¥è¯†ã€€è¯·å‚è€ƒ<a href="/2020/09/15/curl-ming-ling/" title="curlå‘½ä»¤">curlå‘½ä»¤</a></p><p>æ‚¨æ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"tiger_cat"</span><span class="token operator">:</span> <span class="token number">0.4693356156349182</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"tabby"</span><span class="token operator">:</span> <span class="token number">0.46338796615600586</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"Egyptian_cat"</span><span class="token operator">:</span> <span class="token number">0.06456131488084793</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"lynx"</span><span class="token operator">:</span> <span class="token number">0.0012828155886381865</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"plastic_bag"</span><span class="token operator">:</span> <span class="token number">0.00023323005007114261</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">]</span></code></pre><h2 id="æ‰˜ç®¡å¤šä¸ªæ¨¡å‹å¹¶æ‰©å±•å·¥ä½œ"><a href="#æ‰˜ç®¡å¤šä¸ªæ¨¡å‹å¹¶æ‰©å±•å·¥ä½œ" class="headerlink" title="æ‰˜ç®¡å¤šä¸ªæ¨¡å‹å¹¶æ‰©å±•å·¥ä½œ"></a>æ‰˜ç®¡å¤šä¸ªæ¨¡å‹å¹¶æ‰©å±•å·¥ä½œ</h2><p>TorchServeæä¾›äº†ä¸€ä¸ªç®¡ç†APIï¼Œç”¨äºåˆ—å‡ºå·²æ³¨å†Œçš„æ¨¡å‹ï¼Œå°†æ–°æ¨¡å‹æ³¨å†Œåˆ°ç°æœ‰æœåŠ¡å™¨ï¼Œå–æ¶ˆæ³¨å†Œå½“å‰æ¨¡å‹ï¼Œå¢åŠ æˆ–å‡å°‘æ¯ä¸ªæ¨¡å‹çš„å·¥ä½œäººå‘˜æ•°é‡ï¼Œæè¿°æ¨¡å‹çš„çŠ¶æ€ï¼Œæ·»åŠ ç‰ˆæœ¬ä»¥åŠè®¾ç½®é»˜è®¤ç‰ˆæœ¬ã€‚Management APIæ­£åœ¨ç«¯å£8081ä¸Šä¾¦å¬ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹åªèƒ½ä»localhostè®¿é—®ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ›´æ”¹é»˜è®¤è¡Œä¸ºã€‚</p><p>è¦æ³¨å†Œæ–°æ¨¡å‹ï¼Œè¯·å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç ä¸‹è½½æ–°æ¨¡å‹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token function">wget</span> https://download.pytorch.org/models/fasterrcnn_resnet50_fpn_coco-258fb6c6.pthtorch-model-archiver --model-name fastrcnn --version 1.0 \--model-file serve/examples/object_detector/fast-rcnn/model.py \--serialized-file fasterrcnn_resnet50_fpn_coco-258fb6c6.pth \--handler object_detector \--extra-files serve/examples/object_detector/index_to_name.json<span class="token function">mv</span> fastrcnn.mar model-store/</code></pre></li><li><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç æ³¨å†Œæ–°æ¨¡å‹ï¼š</p><pre class=" language-bash"><code class="language-bash">curl -X POST <span class="token string">"http://localhost:3001/models?url=fastrcnn.mar"</span></code></pre><p>æ‚¨æ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"Model \"fastrcnn\" registered"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æŸ¥è¯¢å·²æ³¨å†Œæ¨¡å‹çš„åˆ—è¡¨ï¼š</p><pre class=" language-bash"><code class="language-bash">curl <span class="token string">"http://localhost:3001/models"</span></code></pre><p>æ‚¨æ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"models"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"modelName"</span><span class="token operator">:</span> <span class="token string">"densenet161"</span><span class="token punctuation">,</span>            <span class="token property">"modelUrl"</span><span class="token operator">:</span> <span class="token string">"densenet161.mar"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token property">"modelName"</span><span class="token operator">:</span> <span class="token string">"fastrcnn"</span><span class="token punctuation">,</span>            <span class="token property">"modelUrl"</span><span class="token operator">:</span> <span class="token string">"fastrcnn.mar"</span>        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre></li><li><p>ç¼©æ”¾æ¨¡å‹å·¥äººã€‚æ²¡æœ‰ä¸ºæ–°æ¨¡å‹åˆ†é…å·¥äººï¼Œå› æ­¤è¯·ä½¿ç”¨ä»¥ä¸‹ä»£ç è®¾ç½®æœ€å°å·¥äººæ•°ï¼š</p><pre class=" language-bash"><code class="language-bash">curl -v -X PUT <span class="token string">"http://localhost:3000/models/fastrcnn?min_worker=2"</span>curl <span class="token string">"http://localhost:3000/models/fastrcnn"</span></code></pre><p>æ‚¨æ”¶åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">[</span>  &amp;#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token property">"modelName"</span><span class="token operator">:</span> <span class="token string">"fastrcnn"</span><span class="token punctuation">,</span>    <span class="token property">"modelVersion"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>    <span class="token property">"modelUrl"</span><span class="token operator">:</span> <span class="token string">"fastrcnn.mar"</span><span class="token punctuation">,</span>    <span class="token property">"runtime"</span><span class="token operator">:</span> <span class="token string">"python"</span><span class="token punctuation">,</span>    <span class="token property">"minWorkers"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token property">"maxWorkers"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token property">"batchSize"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token property">"maxBatchDelay"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>â€¦â€¦</code></pre><p>å¦‚æœæ‚¨çš„æ¨¡å‹æ‰˜ç®¡åœ¨å…·æœ‰è®¸å¤šå†…æ ¸çš„CPUä¸Šï¼Œä¾‹å¦‚å…·æœ‰96ä¸ªvCPUçš„c5.24xlarge EC2å®ä¾‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•è½»æ¾æ‰©å±•çº¿ç¨‹æ•°ã€‚</p></li><li><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç æ³¨é”€æ¨¡å‹ï¼š</p><pre class=" language-bash"><code class="language-bash">curl -X DELETE http://localhost:3000/models/fastrcnn/</code></pre></li><li><p>è¦å¯¹æ¨¡å‹è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œè¯·åœ¨è°ƒç”¨æ—¶<code>torch-model-archiver</code>ï¼Œå°†ç‰ˆæœ¬å·ä¼ é€’ç»™<code>--version</code>è¯·å‚è§ä»¥ä¸‹ä»£ç ï¼š</p><p>è¯·å‚è§ä»¥ä¸‹ä»£ç ï¼š</p><pre class=" language-bash"><code class="language-bash">torch-model-archiver --model-name fastrcnn --version 1.0 <span class="token punctuation">..</span>.</code></pre></li></ol><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>â€‹        TorchServeæ˜¯ä¸€ç§ç”¨äºæœåŠ¡PyTorchæ¨¡å‹çš„çµæ´»æ˜“ç”¨çš„å·¥å…·ã€‚æä¾›çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•åˆ©ç”¨å…¶å®ç”¨ç¨‹åºé€šè¿‡RESTç«¯ç‚¹ä¸ºPyTorchæ¨¡å‹æä¾›æœåŠ¡ã€‚é€šè¿‡MNISTç¤ºä¾‹å¯¹å…¶è¿›è¡Œäº†æµ‹è¯•ã€‚ä¸ºäº†è¿›ä¸€æ­¥äº†è§£ï¼Œè¯·æ·±å…¥é˜…è¯»<a href="https://pytorch.org/serve/">æ–‡æ¡£</a>å’Œ<a href="https://github.com/pytorch/serve/tree/master/examples">å®˜æ–¹ç¤ºä¾‹</a>ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BERT for Joint Intent Classification and Slot Filling</title>
      <link href="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/"/>
      <url>/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/</url>
      
        <content type="html"><![CDATA[<h1 id="BERT-for-Joint-Intent-Classification-and-Slot-Filling"><a href="#BERT-for-Joint-Intent-Classification-and-Slot-Filling" class="headerlink" title="BERT for Joint Intent Classification and Slot Filling"></a>BERT for Joint Intent Classification and Slot Filling</h1><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>â€‹      æ„å›¾åˆ†ç±»å’Œæ§½ä½å¡«å……æ˜¯è‡ªç„¶è¯­è¨€ç†è§£çš„ä¸¤ä¸ªåŸºæœ¬ä»»åŠ¡ã€‚ ä»–ä»¬ç»å¸¸é­å—å°è§„æ¨¡çš„äººç±»æ ‡ç­¾è®­ç»ƒæ•°æ®çš„æŠ˜ç£¨ï¼Œå¯¼è‡´æ³›åŒ–èƒ½åŠ›å·®ï¼Œå°¤å…¶æ˜¯å¯¹äºç¨€æœ‰å•è¯ã€‚ æœ€è¿‘ï¼Œä¸€ç§æ–°çš„è¯­è¨€è¡¨ç¤ºæ¨¡å‹BERTï¼ˆæ¥è‡ªTransformersçš„åŒå‘ç¼–ç å™¨è¡¨ç¤ºï¼‰æœ‰åŠ©äºåœ¨å¤§å‹æœªæ ‡è®°çš„è¯­æ–™åº“ä¸Šè¿›è¡Œé¢„è®­ç»ƒæ·±å±‚çš„åŒå‘è¡¨ç¤ºï¼Œå¹¶åœ¨ç®€å•çš„æ“ä½œååˆ›å»ºäº†ç”¨äºå„ç§è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡çš„æœ€æ–°æ¨¡å‹ å¾®è°ƒã€‚ ä½†æ˜¯ï¼Œåœ¨æ¢ç´¢BERTä»¥è·å¾—è‡ªç„¶è¯­è¨€ç†è§£æ–¹é¢å¹¶æ²¡æœ‰ä»˜å‡ºå¤ªå¤šåŠªåŠ›ã€‚ åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæå‡ºäº†ä¸€ç§åŸºäºBERTçš„è”åˆæ„å›¾åˆ†ç±»å’Œæ§½ä½å¡«å……æ¨¡å‹ã€‚ å®éªŒç»“æœè¡¨æ˜ï¼Œä¸åŸºäºæ³¨æ„åŠ›çš„é€’å½’ç¥ç»ç½‘ç»œæ¨¡å‹å’Œæ§½ä½é—¨æ§æ¨¡å‹ç›¸æ¯”ï¼Œæˆ‘ä»¬æå‡ºçš„æ¨¡å‹åœ¨å¤šä¸ªå…¬å…±åŸºå‡†æ•°æ®é›†ä¸Šçš„æ„å›¾åˆ†ç±»å‡†ç¡®æ€§ï¼Œæ§½ä½å¡«å……F1å’Œå¥å­çº§è¯­ä¹‰æ¡†æ¶å‡†ç¡®æ€§å‡å¾—åˆ°äº†æ˜¾ç€æé«˜ã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>â€‹     è¿‘å¹´æ¥ï¼Œè°·æ­ŒHomeã€Amazon Echoã€å¤©çŒ«ç²¾çµç­‰å¤šç§æ™ºèƒ½éŸ³ç®±è¢«éƒ¨ç½²å¹¶å–å¾—äº†å·¨å¤§æˆåŠŸï¼Œå®ç°äº†é¢å‘ç›®æ ‡çš„å¯¹è¯ï¼Œé€šè¿‡è¯­éŸ³äº¤äº’å¸®åŠ©ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚è‡ªç„¶è¯­è¨€ç†è§£(NLU)å¯¹ç›®æ ‡å¯¼å‘çš„å£è¯­å¯¹è¯ç³»ç»Ÿçš„æ€§èƒ½è‡³å…³é‡è¦ã€‚NLUé€šå¸¸åŒ…æ‹¬æ„å›¾åˆ†ç±»å’Œæ’æ§½å¡«å……ä»»åŠ¡ï¼Œç›®çš„æ˜¯ä¸ºç”¨æˆ·è¯è¯­å½¢æˆè¯­ä¹‰è§£æã€‚æ„å›¾åˆ†ç±»ä¾§é‡äºé¢„æµ‹æŸ¥è¯¢çš„æ„å›¾ï¼Œè€Œæ’æ§½å¡«å……åˆ™æå–è¯­ä¹‰æ¦‚å¿µã€‚è¡¨1æ˜¾ç¤ºäº†ä¸€ä¸ªç”¨äºç”¨æˆ·æŸ¥è¯¢çš„æ„å›¾åˆ†ç±»å’Œæ’æ§½å¡«å……çš„ä¾‹å­ã€‚</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/1.png"></p><p>â€‹    æ„å›¾åˆ†ç±»æ˜¯ä¸€ä¸ªé¢„æµ‹æ„å›¾æ ‡ç­¾yiçš„åˆ†ç±»é—®é¢˜ï¼Œè€Œæ’æ§½å¡«å……æ˜¯ä¸€ä¸ªåºåˆ—æ ‡è®°ä»»åŠ¡ï¼Œç”¨æ’æ§½æ ‡ç­¾åºåˆ—$ys= (y ^s _1, y ^s _2ï¼ŒÂ·Â·Â·ï¼Œy ^s _T)$æ ‡è®°è¾“å…¥å•è¯åºåˆ—$x= (x _1, x _2ï¼ŒÂ·Â·Â·x _T)$ã€‚åŸºäºé€’å½’ç¥ç»ç½‘ç»œ(RNN)çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯é€’å½’å•å…ƒ(GRU)å’Œé•¿çŸ­æœŸè®°å¿†(LSTM)æ¨¡å‹ï¼Œå·²ç»åœ¨æ„å›¾åˆ†ç±»å’Œæ§½å¡«å……æ–¹é¢å–å¾—äº†æœ€å…ˆè¿›çš„æ€§èƒ½ã€‚æœ€è¿‘ï¼Œäººä»¬æå‡ºäº†å‡ ç§ç”¨äºæ„å›¾åˆ†ç±»å’Œslotå¡«å……çš„è”åˆå­¦ä¹ æ–¹æ³•ï¼Œä»¥å¼€å‘å’Œå»ºæ¨¡ä¸¤ä¸ªä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ”¹è¿›ç‹¬ç«‹æ¨¡å‹çš„æ€§èƒ½ã€‚ä¹‹å‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæ³¨æ„åŠ›æœºåˆ¶æœ‰åŠ©äºrnnså¤„ç†é•¿æœŸä¾èµ–å…³ç³»ã€‚ä¸ºæ­¤ï¼Œæå‡ºäº†åŸºäºæ³¨æ„çš„è”åˆå­¦ä¹ æ–¹æ³•ï¼Œå¹¶åœ¨è”åˆæ„å›¾åˆ†ç±»å’Œç¼éš™å¡«å……æ–¹é¢å–å¾—äº†è¾ƒå¥½çš„æ•ˆæœã€‚</p><p>â€‹       ç¼ºå°‘ç”¨äºNLUå’Œå…¶ä»–è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡çš„äººç±»æ ‡ç­¾æ•°æ®ä¼šå¯¼è‡´è¾ƒå·®çš„æ³›åŒ–èƒ½åŠ›ã€‚ ä¸ºäº†è§£å†³æ•°æ®ç¨€ç–æ€§æŒ‘æˆ˜ï¼Œå»ºè®®ä½¿ç”¨å¤§é‡æŠ€æœ¯æ¥ä½¿ç”¨å¤§é‡æœªæ³¨é‡Šçš„æ–‡æœ¬æ¥è®­ç»ƒé€šç”¨è¯­è¨€è¡¨ç¤ºæ¨¡å‹ï¼Œä¾‹å¦‚ELMoå’Œç”Ÿæˆå¼é¢„è®­ç»ƒTransformer (GPT)ã€‚ é¢„è®­ç»ƒçš„æ¨¡å‹å¯ä»¥åœ¨NLPä»»åŠ¡ä¸Šè¿›è¡Œå¾®è°ƒï¼Œå¹¶ä¸”åœ¨ç‰¹å®šäºä»»åŠ¡çš„æ³¨é‡Šæ•°æ®å·²ç»å–å¾—äº†æ˜¾è‘—çš„æ”¹è¿›ã€‚æœ€è¿‘ï¼Œ(BERT)çš„åŒå‘ç¼–ç å™¨ä»£è¡¨æå‡ºäº†ä¸€ç§é¢„è®­ç»ƒæŠ€æœ¯ï¼Œå¹¶ä¸ºå„ç§NLPä»»åŠ¡åˆ›å»ºäº†æœ€å…ˆè¿›çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬é—®é¢˜å›ç­”(SQuAD v1.1)ã€è‡ªç„¶è¯­è¨€æ¨æ–­ç­‰ã€‚</p><p>ã€€ã€€ç„¶è€Œï¼Œåœ¨æ¢ç´¢BERTè¿™é¡¹å·¥ä½œçš„æŠ€æœ¯è´¡çŒ®æœ‰ä¸¤æ–¹é¢:1)æ¢ç´¢BERTé¢„è®­ç»ƒæ¨¡å‹ï¼Œè§£å†³NLUæ³›åŒ–èƒ½åŠ›è¾ƒå·®çš„é—®é¢˜;2)æå‡ºäº†ä¸€ä¸ªåŸºäºBERTçš„è”åˆæ„å›¾åˆ†ç±»å’Œæ’æ§½å¡«å……æ¨¡å‹ï¼Œå¹¶è¯æ˜äº†æ‰€ææ¨¡å‹åœ¨å¤šä¸ªå…¬å…±åŸºå‡†æ•°æ®é›†ä¸Šï¼Œä¸åŸºäºæ³¨æ„åŠ›çš„RNNæ¨¡å‹å’Œæ§½é—¨æ¨¡å‹ç›¸æ¯”ï¼Œåœ¨æ„å›¾åˆ†ç±»ç²¾åº¦ã€æ’æ§½å¡«å……F1å’Œå¥å­çº§è¯­ä¹‰æ¡†æ¶ç²¾åº¦æ–¹é¢éƒ½æœ‰æ˜¾è‘—æé«˜ã€‚</p><h2 id="Related-work"><a href="#Related-work" class="headerlink" title="Related work"></a>Related work</h2><p>â€‹        æ ¹æ®æ„å›¾ç±»åŒ–å’Œæ’æ§½å¡«å……æ˜¯å¦åˆ†åˆ«è”åˆå»ºæ¨¡ï¼Œå°†NLUæ¨¡å‹åˆ†ä¸ºç‹¬ç«‹å»ºæ¨¡æ–¹æ³•å’Œè”åˆå»ºæ¨¡æ–¹æ³•</p><h2 id="Proposed-Approach"><a href="#Proposed-Approach" class="headerlink" title="Proposed Approach"></a>Proposed Approach</h2><p>â€‹    é¦–å…ˆç®€è¦æè¿°äº†BERTæ¨¡å‹ï¼Œç„¶åä»‹ç»äº†æå‡ºçš„åŸºäºBERTçš„è”åˆæ¨¡å‹ã€‚å›¾1æ¨¡å‹çš„é«˜çº§è§†å›¾ã€‚</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/2.png"></p><h3 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h3><p>â€‹        BERTçš„æ¨¡å‹æ¶æ„æ˜¯åŸºäºåŸå§‹å˜å‹å™¨æ¨¡å‹çš„å¤šå±‚åŒå‘å˜å‹å™¨ç¼–ç å™¨ã€‚è¾“å…¥è¡¨ç¤ºæ˜¯WordPiece  embeddings  positional  embeddings,  å’Œ segment  embeddingçš„ä¸²è”ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äºå•å¥åˆ†ç±»å’Œæ ‡è®°ä»»åŠ¡ã€‚æ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„åµŒå…¥åˆ†ç±»([CLS])ä½œä¸ºç¬¬ä¸€ä¸ªtokenï¼Œæ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„token([SEP])ä½œä¸ºæœ€åçš„ä»¤ç‰Œã€‚ç»™å®šä¸€ä¸ªè¾“å…¥tokenåºåˆ—$x= (x _1ï¼Œâ€¦)$ï¼Œåˆ™BERTçš„è¾“å‡ºä¸º$H= (h _1ï¼Œâ€¦h _T)$ã€‚</p><p>â€‹      å¯¹BERTæ¨¡å‹è¿›è¡Œäº†ä¸¤ç§é¢„å¤„ç†ç­–ç•¥çš„è®­ç»ƒï¼Œåˆ†åˆ«æ˜¯å¯¹å¤§è§„æ¨¡æ— æ ‡è®°æ–‡æœ¬è¿›è¡Œæ©æ¨¡è¯­è¨€æ¨¡å‹å’Œä¸‹ä¸€å¥é¢„æµ‹ã€‚é¢„å…ˆè®­ç»ƒçš„BERTæ¨¡å‹æä¾›äº†ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ä¸Šä¸‹æ–‡ç›¸å…³çš„å¥å­è¡¨ç¤ºï¼Œé€šè¿‡å¾®è°ƒè¿‡ç¨‹ï¼Œå¯ä»¥ç”¨äºå„ç§ç›®æ ‡ä»»åŠ¡ï¼Œä¾‹å¦‚æ„å›¾åˆ†ç±»å’Œæ’æ§½å¡«å……ï¼Œç±»ä¼¼äºå®ƒåœ¨å…¶ä»–NLPä»»åŠ¡ä¸­çš„ä½¿ç”¨ã€‚</p><h3 id="Joint-Intent-Classification-and-Slot-Filling"><a href="#Joint-Intent-Classification-and-Slot-Filling" class="headerlink" title="Joint Intent Classification and Slot Filling"></a>Joint Intent Classification and Slot Filling</h3><p>â€‹    BERTå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•ä¸ºè”åˆæ„å›¾ç±»åŒ–å’Œæ§½å¡«å……æ¨¡å‹ã€‚æ ¹æ®ç¬¬ä¸€ä¸ªç‰¹æ®Šæ ‡è®°([CLS])çš„éšè—çŠ¶æ€ï¼Œè¡¨ç¤ºh1ï¼Œæ„å›¾è¢«é¢„æµ‹ä¸º</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/3.png"></p><p>â€‹      å¯¹äºæ’æ§½å¡«å……ï¼Œå…¶ä»–æ ‡è®°$h _2â€¦ï¼Œh _T$çš„æœ€ç»ˆéšè—çŠ¶æ€æ”¾å…¥softmaxå±‚ä¸Šåˆ†ç±»æ§½å¡«å……æ ‡ç­¾ã€‚ä¸ºäº†ä½¿è¯¥è¿‡ç¨‹ä¸WordPiece  tokenizationä¸€è‡´ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªtokenizationçš„è¾“å…¥è¯è¾“å…¥åˆ°WordPiece tokenizer ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸ç¬¬ä¸€ä¸ªsub-tokenå¯¹åº”çš„éšè—çŠ¶æ€ä½œä¸ºsoftmaxåˆ†ç±»å™¨çš„è¾“å…¥ã€‚</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/5.png"></p><p>å…¶ä¸­$h _n$ä¸ºå•è¯$x _n$çš„ç¬¬ä¸€ä¸ªå­ä»¤ç‰Œå¯¹åº”çš„éšè—çŠ¶æ€ã€‚</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/6.png"></p><p>ä¸ºäº†è”åˆå»ºæ¨¡æ„å›¾åˆ†ç±»å’Œå¡«æ§½ï¼Œç›®æ ‡è¢«è¡¨è¿°ä¸º</p><p><img src="/2020/09/14/bert-for-joint-intent-classification-and-slot-filling/7.png"></p><p>å­¦ä¹ ç›®æ ‡æ˜¯ä½¿æ¡ä»¶æ¦‚ç‡$(y _i, y _s|x)$æœ€å¤§åŒ–ã€‚è¯¥æ¨¡å‹é€šè¿‡æœ€å°åŒ–äº¤å‰ç†µæŸå¤±è¿›è¡Œäº†ç«¯åˆ°ç«¯çš„å¾®è°ƒã€‚</p><h2 id="Conditional-Random-Field"><a href="#Conditional-Random-Field" class="headerlink" title="Conditional Random Field"></a>Conditional Random Field</h2><p>â€‹       æ§½æ ‡ç­¾çš„é¢„æµ‹ä¾èµ–äºå¯¹å‘¨å›´å•è¯çš„é¢„æµ‹ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé‡‡ç”¨æ¡ä»¶éšæœºåŸŸ(CRF)ç­‰ç»“æ„åŒ–é¢„æµ‹æ¨¡å‹å¯ä»¥æé«˜å¡«æ§½æ€§èƒ½ã€‚é€šè¿‡ä¸ºBiLSTMç¼–ç å™¨æ·»åŠ CRFå±‚æ”¹è¿›äº†è¯­ä¹‰è§’è‰²æ ‡è®°ã€‚è¿™é‡Œï¼Œåœ¨è”åˆBERTæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œç ”ç©¶äº†æ·»åŠ CRFæ¥å»ºæ¨¡æ§½æ ‡ç­¾ä¾èµ–çš„æœ‰æ•ˆæ€§ã€‚</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bert </tag>
            
            <tag> åˆ†ç±» </tag>
            
            <tag> æ§½å¡«å…… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Joint Extraction of Entities and Relations Based on a Novel Decomposition Strategy</title>
      <link href="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/"/>
      <url>/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºäºä¸€ç§æ–°çš„åˆ†è§£ç­–ç•¥çš„å®ä½“å’Œå…³ç³»çš„è”åˆæå–"><a href="#åŸºäºä¸€ç§æ–°çš„åˆ†è§£ç­–ç•¥çš„å®ä½“å’Œå…³ç³»çš„è”åˆæå–" class="headerlink" title="åŸºäºä¸€ç§æ–°çš„åˆ†è§£ç­–ç•¥çš„å®ä½“å’Œå…³ç³»çš„è”åˆæå–"></a>åŸºäºä¸€ç§æ–°çš„åˆ†è§£ç­–ç•¥çš„å®ä½“å’Œå…³ç³»çš„è”åˆæå–</h1><p>Paper:  <a href="https://arxiv.org/pdf/1909.04273v3.pdf">https://arxiv.org/pdf/1909.04273v3.pdf</a></p><p>Code Torch <a href="https://github.com/yubowen-ph/JointER">https://github.com/yubowen-ph/JointER</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>â€‹        è”åˆæå–å®ä½“å’Œå…³ç³»çš„ç›®çš„æ˜¯é€šè¿‡å•ä¸€çš„æ¨¡å‹æ¥æ£€æµ‹å®ä½“å¯¹åŠå…¶å…³ç³»ã€‚ä»¥å¾€çš„å·¥ä½œé€šå¸¸é‡‡ç”¨å…ˆæå–ååˆ†ç±»æˆ–ç»Ÿä¸€æ ‡æ³¨çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™äº›æ–¹æ³•åœ¨æå–å®ä½“å’Œå…³ç³»çš„è¿‡ç¨‹ä¸­è¦ä¹ˆå­˜åœ¨å†—ä½™å®ä½“å¯¹ï¼Œè¦ä¹ˆå¿½ç•¥äº†é‡è¦çš„å†…éƒ¨ç»“æ„ã€‚é’ˆå¯¹è¿™äº›å±€é™æ€§ï¼Œæœ¬æ–‡é¦–å…ˆå°†è”åˆæŠ½å–ä»»åŠ¡åˆ†è§£ä¸ºä¸¤ä¸ªç›¸äº’å…³è”çš„å­ä»»åŠ¡ï¼Œå³HEæŠ½å–å’ŒTERæŠ½ å–ã€‚å‰è€…çš„å­ä»»åŠ¡æ˜¯åŒºåˆ†æ‰€æœ‰å¯èƒ½æ¶‰åŠåˆ°ç›®æ ‡å…³ç³»çš„å¤´å®ä½“ï¼Œåè€…æ˜¯è¯†åˆ«æ¯ä¸ªæå–çš„å¤´å®ä½“å¯¹åº”çš„å°¾å®ä½“å’Œå…³ç³»ã€‚ç„¶åï¼ŒåŸºäºæˆ‘ä»¬æå‡ºçš„åŸºäºè·³è½¬çš„æ ‡è®°æ–¹æ¡ˆï¼Œå°†è¿™ä¸¤ä¸ªå­ä»»åŠ¡è¿›ä¸€æ­¥åˆ†è§£ä¸ºå¤šä¸ªåºåˆ—æ ‡è®°é—®é¢˜ï¼Œå¹¶é‡‡ç”¨åˆ†å±‚è¾¹ç•Œæ ‡è®°å’Œå¤šè·¨è§£ç ç®—æ³•æ–¹ä¾¿åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚ç”±äºé‡‡ç”¨äº†åˆç†çš„åˆ†è§£ç­–ç•¥ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥å®Œå…¨æ•è·ä¸åŒæ­¥éª¤ä¹‹é—´çš„è¯­ä¹‰ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¹¶å‡å°‘ä¸ç›¸å…³å®ä½“å¯¹çš„å¹²æ‰°ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ¯”ä»¥å‰çš„å·¥ä½œæ€§èƒ½æé«˜äº†5.2%ã€5.9%å’Œ21.5% (F1å¾—åˆ†)ï¼Œåœ¨ä¸‰ä¸ªå…¬å…±æ•°æ®é›†ä¸Šè¾¾åˆ°äº†æ–°çš„æ°´å¹³ã€‚</p><h2 id="NTRODUCTION"><a href="#NTRODUCTION" class="headerlink" title="NTRODUCTION"></a>NTRODUCTION</h2><p>â€‹       ä¼ ç»Ÿçš„æµæ°´çº¿æ–¹æ³•é¦–å…ˆ è¯†åˆ«å®ä½“ï¼Œç„¶åä¸ºæ¯ä¸ªå¯èƒ½çš„æå–å®ä½“å¯¹é€‰æ‹©ä¸€ä¸ªå…³ç³»ã€‚ è¿™æ ·çš„æ¡†æ¶ä½¿ä»»åŠ¡æ˜“äºæ‰§è¡Œï¼Œä½†å´å¿½ç•¥äº†è¿™ä¸¤ä¸ªå­ä»»åŠ¡ä¹‹é—´çš„æ½œåœ¨äº¤äº’ä½œç”¨ã€‚ ä¸€ç§æ”¹è¿›çš„æ–¹æ³•æ˜¯é€šè¿‡å‚æ•°å…±äº«å…±åŒè®­ç»ƒå®ƒä»¬å°½ç®¡æ˜¾ç¤ºå‡ºä»¤äººé¼“èˆçš„ç»“æœï¼Œä½†æ˜¯è¿™äº›â€œæå–ç„¶ååˆ†ç±»â€æ–¹æ³•ä»ç„¶éœ€è¦ç”¨äºå®ä½“æå–å’Œå…³ç³»åˆ†ç±»çš„æ˜¾å¼å•ç‹¬ç»„ä»¶ã€‚ ç»“æœï¼Œå®ƒä»¬çš„å…³ç³»åˆ†ç±»å™¨å¯èƒ½ä¼šè¢«å†—ä½™å®ä½“å¯¹æ‰€è¯¯å¯¼ã€‚è¿™äº›æ¨¡å‹æ€»æ˜¯å¿½ç•¥å†…éƒ¨ç»“æ„ï¼Œä¾‹å¦‚å¤´éƒ¨å®ä½“ä¸­åŒ…å«çš„ä¾èµ–æ€§ï¼Œå°¾éƒ¨æ€§å’Œå…³ç³»ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œå°¾éƒ¨å®ä½“å’Œå…³ç³»åº”å–å†³äºç‰¹å®šçš„å®ä½“ã€‚ æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å‹ä¸èƒ½å®Œå…¨ç†è§£å¤´å®ä½“çš„è¯­ä¹‰ï¼Œé‚£ä¹ˆæå–ç›¸åº”çš„å°¾éƒ¨å®ä½“å’Œå…³ç³»å°†æ˜¯ä¸å¯é çš„ã€‚</p><p>â€‹        è”åˆä»»åŠ¡åˆ†å±‚åˆ†è§£ä¸ºå‡ ä¸ªåºåˆ—æ ‡è®°é—®é¢˜ï¼Œå…¶ä¸­éƒ¨åˆ†æ ‡è®°æ•è·äº†ä¸åŒæ–¹é¢çš„ä¿¡æ¯ã€‚ï¼ˆå‚è§å›¾1ï¼‰</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/1.png"></p><p>â€‹       ä»ä¸€å¥è¯å¼€å§‹ï¼Œé¦–å…ˆåŒºåˆ†æ‰€æœ‰å¯èƒ½æ¶‰åŠåˆ°ç›®æ ‡å…³ç³»çš„å€™é€‰å¤´å®ä½“ï¼Œç„¶åä¸ºæ¯ä¸ªæå–çš„å¤´å®ä½“æ ‡æ³¨å¯¹åº”çš„å°¾å®ä½“å’Œå…³ç³»ã€‚æˆ‘ä»¬å°†å‰ä¸€ä¸ªå­ä»»åŠ¡ç§°ä¸ºå‰ç«¯å®ä½“(HE)æå–ï¼Œåä¸€ä¸ªå­ä»»åŠ¡ç§°ä¸ºå°¾éƒ¨å®ä½“å…³ç³»(TER)æå–ã€‚è¿™ç§ extract-then-labelï¼ˆETLï¼‰å¯ä»¥é€šè¿‡å°†æå–ä¸‰å…ƒç»„çš„è”åˆæ¦‚ç‡åˆ†è§£ä¸ºæ¡ä»¶æ¦‚ç‡$(h, r, t|S) =p(h|S)p(r, t|h, S)$æ¥ç†è§£ï¼Œå…¶ä¸­$(h, r, t)$ä¸ºå¥å­$ S $ä¸­çš„ä¸‰å…ƒç»„ã€‚ä»¥è¿™ç§æ–¹å¼ï¼ŒTERæå–å™¨èƒ½å¤Ÿåœ¨æ ‡è®°å°¾å®ä½“å’Œå…³ç³»æ—¶è€ƒè™‘ç»™å®šé¦–å®ä½“çš„è¯­ä¹‰å’Œä½ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”è‡ªç„¶åœ°ï¼Œä¸€ä¸ªé¦–å®ä½“å¯ä»¥ä¸å¤šä¸ªå°¾å®ä½“è¿›è¡Œäº¤äº’ä»¥å½¢æˆ é‡å çš„å…³ç³»ã€‚ æ­¤å¤–ï¼Œä¸æå–ç„¶ååˆ†ç±»çš„æ–¹æ³•ç›¸æ¯”ï¼Œä¸å†åœ¨ç¬¬ä¸€æ­¥æå–æ‰€æœ‰å®ä½“ï¼Œä»…è¯†åˆ«å¯èƒ½å‚ä¸ç›®æ ‡ä¸‰å…ƒç»„çš„å¤´å®ä½“ï¼Œä»è€Œå‡è½»äº†å†—ä½™å®ä½“å¯¹çš„å½±å“ã€‚</p><p>â€‹     å—æå–æ€§é—®é¢˜è§£ç­”çš„å¯å‘ï¼Œè¯¥é—®é¢˜é€šè¿‡é¢„æµ‹å…¶å¼€å§‹å’Œç»“æŸç´¢å¼•æ¥è¯†åˆ«ç­”æ¡ˆèŒƒå›´ï¼Œè¿›ä¸€æ­¥ä½¿ç”¨åŸºäºèŒƒå›´çš„æ ‡è®°æ–¹æ¡ˆåˆ†è§£HEå’ŒTERæå–ã€‚ å…·ä½“æ¥è¯´ï¼Œå¯¹äºHEæå–ï¼Œåœ¨æ¯ä¸ªé¦–éƒ¨å®ä½“çš„å¼€å§‹å’Œç»“æŸä½ç½®æ ‡è®°å®ä½“ç±»å‹ã€‚ å¯¹äºTERæå–ï¼Œæˆ‘ä»¬åœ¨ä¸ç»™å®šå¤´éƒ¨å®ä½“æœ‰å…³ç³»çš„æ‰€æœ‰å°¾éƒ¨å®ä½“çš„å¼€å§‹å’Œç»“æŸä½ç½®å¤„æ³¨é‡Šå…³ç³»ç±»å‹ã€‚ä¸ºäº†å¢å¼ºè¾¹ç•Œä½ç½®ä¹‹é—´çš„å…³è”ï¼Œæå‡ºäº†ä¸€ä¸ªåˆ†å±‚çš„è¾¹ç•Œæ ‡è®°å™¨, æ ‡ç­¾å¼€å§‹å’Œç»“æŸä½ç½®ç”¨çº§è”ç»“æ„åˆ†åˆ«è§£ç ï¼Œå¹¶ç”¨å¤šè·¨è¯‘ç ç®—æ³•å°†å®ƒä»¬è§£ç åœ¨ä¸€èµ·ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨ç»Ÿä¸€çš„åŸºäºè·¨åº¦çš„æå–æ¡†æ¶ä¸­å¯¹HEå’ŒTERæå–è¿›è¡Œå»ºæ¨¡ï¼Œä»…æ ¹æ®å®ƒä»¬çš„å…ˆéªŒçŸ¥è¯†å’Œè¾“å‡ºæ ‡ç­¾é›†è¿›è¡ŒåŒºåˆ†ã€‚ æ€»ä½“è€Œè¨€ï¼Œå¯¹äºå…·æœ‰mä¸ªå¤´éƒ¨å®ä½“çš„å¥å­ï¼Œæ•´ä¸ªä»»åŠ¡è¢«åˆ†è§£ä¸º2 + 2mä¸ªåºåˆ—æ ‡è®°å­ä»»åŠ¡ï¼Œå‰2 ç”¨äºHEæ ‡ç­¾ï¼Œå¦ä¸€ä¸ª2mç”¨äºTERã€‚ä»ç›´è§‰ä¸Šè®²ï¼Œä¸æ•´ä¸ªæå–ä»»åŠ¡ç›¸æ¯”ï¼Œå•ä¸ªå­ä»»åŠ¡éå¸¸æ˜“äºå­¦ä¹ ï¼Œè¿™è¡¨æ˜é€šè¿‡ä¸å…±äº«çš„åŸºç¡€è¡¨ç¤ºå½¢å¼è¿›è¡Œåä½œè®­ç»ƒï¼Œå®ƒä»¬å¯ä»¥çº¦æŸå­¦ä¹ é—®é¢˜å¹¶è·å¾—æ›´å¥½çš„æ€»ä½“ç»“æœã€‚</p><p>â€‹       ä¸‰ä¸ªå…¬å…±æ•°æ®é›†ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„æ–¹æ³•ï¼šNYT-singleï¼ŒNYT-multiå’ŒWebNLGã€‚æå‡ºçš„æ–¹æ³•æ˜æ˜¾ä¼˜äºä»¥å‰çš„æ­£å¸¸ï¼Œé‡å å’Œå¤šå…³ç³»æå–æ–¹é¢çš„å·¥ä½œï¼Œå°†SOTA F1å¾—åˆ†æé«˜åˆ°59.0ï¼…ï¼ˆ+5.2ï¼…ï¼‰ï¼Œ78.0ï¼…ï¼ˆ+ 5.9ï¼…ï¼‰å’Œ83.1ï¼…ï¼ˆ+ 21.5ï¼…ï¼‰ã€‚</p><h2 id="METHODOLOGY"><a href="#METHODOLOGY" class="headerlink" title="METHODOLOGY"></a>METHODOLOGY</h2><h3 id="Tagging-Scheme"><a href="#Tagging-Scheme" class="headerlink" title="Tagging Scheme"></a>Tagging Scheme</h3><p>â€‹       é¦–å…ˆè€ƒè™‘å¤´éƒ¨å®ä½“ï¼ˆHEï¼‰çš„æå–ã€‚ å¦‚å‰ä¸€èŠ‚æ‰€è¿°ï¼Œå®ƒè¢«åˆ†è§£ä¸ºä¸¤ä¸ªåºåˆ—æ ‡è®°å­ä»»åŠ¡ã€‚ ç¬¬ä¸€ä¸ªå­ä»»åŠ¡ä¸»è¦é›†ä¸­åœ¨è¯†åˆ«ä¸€ä¸ªå¤´éƒ¨å®ä½“çš„èµ·å§‹ä½ç½®ã€‚ å¦‚æœä¸€ä¸ªtokenæ˜¯èµ·å§‹è¯ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºç›¸åº”çš„å®ä½“ç±»å‹ï¼Œå¦åˆ™å°†å…¶åˆ†é…ä¸ºæ ‡ç­¾â€œ Oâ€ï¼ˆå¤–éƒ¨ï¼‰ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬äºŒä¸ªå­ä»»åŠ¡æ—¨åœ¨æ ‡è¯†ä¸€ä¸ªå¤´éƒ¨å®ä½“çš„ç»ˆæ­¢ä½ç½®ï¼Œå¹¶ä¸”å…·æœ‰ç±»ä¼¼çš„æ ‡è®°è¿‡ç¨‹ï¼Œåªæ˜¯å®ä½“ç±»å‹è¢«æ ‡è®°ä¸ºä½œä¸ºç»“æŸè¯çš„tokenã€‚å¯¹äºæ¯ä¸ªè¯†åˆ«å‡ºçš„å¤´å®ä½“ï¼ŒTERæå–è¿˜åˆ†è§£ä¸ºä¸¤ä¸ªåºåˆ—æ ‡è®°å­ä»»åŠ¡ï¼Œåˆ©ç”¨è·¨åº¦è¾¹ç•Œæå–å°¾å®ä½“å¹¶åŒæ—¶é¢„æµ‹å…³ç³»ã€‚ç¬¬ä¸€ä¸ªåºåˆ—æ ‡è®°å­ä»»åŠ¡ä¸»è¦æ ‡è®°å°¾å®ä½“çš„å¼€å§‹å­—æ ‡è®°çš„å…³ç³»ç±»å‹ï¼Œç¬¬äºŒä¸ªå­ä»»åŠ¡æ ‡è®°å°¾å®ä½“çš„ç»“æŸå­—æ ‡è®°çš„å…³ç³»ç±»å‹ã€‚</p><p>â€‹        å›¾1ä¸¾ä¾‹è¯´æ˜äº†æ ‡è®°æ–¹æ¡ˆï¼Œå…¶ä¸­â€œ Unitedâ€ï¼Œâ€œ Statesâ€ï¼Œâ€œ Trumpâ€ï¼Œâ€œ Queensâ€ï¼Œâ€œ Newâ€å’Œâ€œ Cityâ€è¿™ä¸‰ä¸ªè¯å‡ä¸æœ€ç»ˆæå–ç»“æœç›¸å…³ï¼Œå› æ­¤ç”¨ç‰¹æ®Šæ ‡è®° æ ‡ç­¾ã€‚ ä¾‹å¦‚ï¼Œå•è¯â€œ Trumpâ€æ˜¯å¤´éƒ¨å®ä½“â€œ Trumpâ€çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªå•è¯ï¼Œå› æ­¤åœ¨æ ‡è®°HEæ—¶ï¼Œæ ‡è®°åœ¨å¼€å§‹å’Œç»“æŸæ ‡è®°åºåˆ—ä¸­éƒ½æ˜¯PERSONã€‚ å¯¹äºTERæå–ï¼Œå½“ç»™å®šçš„é¦–å®ä½“ä¸ºâ€œç‰¹æœ—æ™®â€æ—¶ï¼Œä¸æƒ³è¦çš„å…³ç³»æœ‰å…³çš„æœ‰ä¸¤ä¸ªå°¾å®ä½“ï¼Œå³ï¼ˆâ€Trumpâ€,PresidentOf, â€œUnited Statesâ€ï¼‰å’Œï¼ˆ(â€œTrumpâ€, BornIn, â€œNew YorkCityâ€ï¼‰ï¼Œå› æ­¤åœ¨å¼€å§‹æ ‡ç­¾åºåˆ—ä¸­ï¼Œâ€œ Unitedâ€å’Œâ€œ Newâ€åˆ†åˆ«æ ‡è®°ä¸ºPresident_Ofå’ŒBorn_Inã€‚ ç±»ä¼¼åœ°ï¼Œå¯ä»¥è·å¾—æ ‡è®°æœ‰ â€œStatesâ€å’Œ â€œCityâ€ çš„ç»“æŸæ ‡ç­¾åºåˆ—ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œä¸æœ€ç»ˆç»“æœæ— å…³çš„å…¶ä»–å•è¯éƒ½æ ‡è®°ä¸ºâ€œ Oâ€ã€‚</p><p>â€‹       æ ‡è®°æ–¹æ¡ˆä¸PA-LSTMå®Œå…¨ä¸åŒã€‚ å¯¹äºå•è¯è¯å¥å­ï¼ŒPA-LSTMæ ¹æ®ä¸åŒçš„æŸ¥è¯¢ä½ç½®æ„å»ºä¸åŒçš„æ ‡ç­¾åºåˆ—ï¼Œè€Œè¯¥æ¨¡å‹å°†åŒä¸€å¥å­æ ‡è®°ä¸ºã€€2 + 2Ã—mã€€ä»¥è¯†åˆ«æ‰€æœ‰é‡å å…³ç³»ï¼Œå…¶ä¸­å¤´å®ä½“çš„æ•°é‡å’Œm &lt;&lt; nã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬çš„æ¨¡å‹æ›´åŠ èŠ‚çœæ—¶é—´å’Œæ•ˆç‡ã€‚ æ­¤å¤–ï¼Œå®ƒä½¿ç”¨â€œ BIESâ€ç¬¦å·è¡¨ç¤ºå®ä½“ä¸­tokençš„ä½ç½®ï¼Œè€Œæˆ‘ä»¬ä»…é¢„æµ‹å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œè€Œä¸ä¼šæŸå¤±æå–å¤šè¯å®ä½“æåŠçš„èƒ½åŠ›ã€‚</p><h3 id="Hierarchical-Boundary-Tagger"><a href="#Hierarchical-Boundary-Tagger" class="headerlink" title="Hierarchical Boundary Tagger"></a>Hierarchical Boundary Tagger</h3><p>â€‹    æ ‡è®°æ–¹æ¡ˆï¼Œåˆ©ç”¨ç»Ÿä¸€çš„æ¶æ„æ¥æå–HEå’ŒTERã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œå°†è¿™ç§æå–å™¨åŒ…è£…åˆ°ä¸€ä¸ªåä¸ºâ€œå±‚æ¬¡è¾¹ç•Œæ ‡è®°å™¨â€ï¼ˆç¼©å†™ä¸ºHBTï¼‰çš„é€šç”¨æ¨¡å—ä¸­ã€‚ ä¸ºäº†é€šç”¨èµ·è§ï¼Œä¸åŒºåˆ†å¤´å’Œå°¾å®ä½“ï¼Œåœ¨æœ¬å°èŠ‚ä¸­å°†å®ƒä»¬ç»Ÿç§°ä¸ºç›®æ ‡ã€‚ å½¢å¼ä¸Šï¼Œä»å¥å­Sä¸­æå–å¸¦æœ‰æ ‡ç­¾lï¼ˆç›®æ ‡å®ä½“çš„ç±»å‹ä¸ºå¤´å®ä½“æˆ–å…³ç³»ç±»å‹ä¸ºå°¾éƒ¨å®ä½“ï¼‰çš„ç›®æ ‡tçš„æ¦‚ç‡è¢«æ™®éå»ºæ¨¡ä¸º</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/4.png"></p><p>$s ^l _t$æ˜¯æ ‡è®°å…³äº$l$çš„$t$ï¼ˆtailï¼‰çš„èµ·å§‹ç´¢å¼•ï¼Œ$e ^l _t$æ˜¯ç»“æŸç´¢å¼•ï¼è¿™ç§åˆ†è§£è¡¨æ˜ä»»åŠ¡ä¹‹é—´å­˜åœ¨è‡ªç„¶é¡ºåºï¼šé¢„æµ‹ç»“æŸä½ç½®å¯èƒ½ä¼šå—ç›Šäºèµ·å§‹ä½ç½®çš„é¢„æµ‹ç»“æœï¼Œè¿™ä¿ƒä½¿é‡‡ç”¨åˆ†å±‚æ ‡è®°ç»“æ„ã€‚<img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/2.png"></p><p>å¦‚å›¾2çš„å³é¢æ¿æ‰€ç¤ºï¼Œå°†æ¯ä¸ªå±‚ä¸ä¸€ä¸ªä»»åŠ¡å…³è”èµ·æ¥ï¼Œå¹¶å°†ä½çº§ä»»åŠ¡çš„æ ‡è®°ç»“æœä»¥åŠéšè—çŠ¶æ€ä½œä¸ºé«˜çº§ä»»åŠ¡çš„è¾“å…¥ã€‚åœ¨æœ¬å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†BiLSTMä½œä¸ºåŸºæœ¬çš„ç¼–ç å™¨ã€‚å½¢å¼ä¸Šï¼Œåœ¨æ ‡è®°å¼€å§‹ä½ç½®æ—¶ï¼Œå•è¯$x _i$çš„æ ‡è®°è¢«é¢„æµ‹ä¸ºã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/5.png"></p><p>â€‹       å…¶ä¸­$h _i$è¡¨ç¤ºæ ‡è®°tokemï¼Œ$a _i$æ˜¯è¾…åŠ©è¯å‘é‡ã€‚å¯¹äºHEæå–ï¼Œ$a _i$æ˜¯ä»æ•´ä¸ªå¥å­ä¸­å­¦ä¹ çš„å…¨å±€è¡¨ç¤ºã€‚ ä»å…¨å±€è§’åº¦è¿›è¡Œæ›´å‡†ç¡®çš„é¢„æµ‹æ˜¯æœ‰ç›Šçš„ã€‚ å¯¹äºTERæå–ï¼Œ$a _i$æ˜¯å…¨å±€è¡¨ç¤ºå’Œä¸å¤´å®ä½“ç›¸å…³çš„å‘é‡çš„ä¸²è”ï¼Œä»¥æŒ‡ç¤ºç»™å®šå¤´å®ä½“çš„ä½ç½®å’Œè¯­ä¹‰ä¿¡æ¯ã€‚ åœ¨è¿™é‡Œï¼Œé‡‡ç”¨$BiLSTM _{sta}$å°†$h _i$ä¸$a_i$èåˆä¸ºå•ä¸ªå‘é‡$h ^{sta} _i$ã€‚ç±»ä¼¼åœ°ï¼Œ$x _i$çš„ç»“æŸæ ‡è®°å¯ä»¥è®¡ç®—ã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/6.png"></p><p>ã€€ã€€å…¬å¼2-4å’Œå…¬å¼5-7çš„åŒºåˆ«æ˜¯åŒé‡çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å…¬å¼2ä¸­çš„$h _i$æ›¿æ¢ä¸º$h ^{sta} _i$ï¼Œä½¿æ¨¡å‹åœ¨é¢„æµ‹ç»“æŸä½ç½®æ—¶èƒ½å¤Ÿæ„ŸçŸ¥èµ·å§‹ä½ç½®çš„éšè—çŠ¶æ€ã€‚å…¶æ¬¡ï¼Œåœ¨å…¶ä»–æ–‡çŒ®ä¸­ä½¿ç”¨çš„ä½ç½®ç¼–ç å‘é‡çš„å¯å‘ï¼Œå°†åµŒå…¥çš„ä½ç½®$p ^{se} _i$ä½œä¸º$BiLSTM _{end}$å±‚çš„é™„åŠ è¾“å…¥ã€‚é€šè¿‡åœ¨å¯è®­ç»ƒçš„ä½ç½®åµŒå…¥çŸ©é˜µä¸­æŸ¥æ‰¾$p ^{se} _i$ï¼Œå¯ä»¥å¾—åˆ°$p ^{se} _i$</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/7.png"></p><p>â€‹        è¿™é‡Œ$s ^* $æ˜¯å½“å‰ç´¢å¼•ä¹‹å‰æœ€è¿‘çš„èµ·å§‹ä½ç½®ï¼Œå¹¶è®¡ç®—$x _i$å’Œ$s ^* $çš„ç›¸å¯¹è·ç¦»ã€‚ åœ¨$x _i$ï¼Œ$s ^âˆ— $ä¹‹å‰æ²¡æœ‰èµ·å§‹ä½ç½®ï¼Œåˆ™$p ^s _i$è¢«æŒ‡å®šä¸ºå¸¸æ•°Cï¼Œè¯¥å¸¸æ•°é€šå¸¸è®¾ç½®ä¸ºæœ€å¤§å¥å­é•¿åº¦ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ˜¾å¼åœ°é™åˆ¶äº†æå–çš„å®ä½“çš„é•¿åº¦ï¼Œå¹¶å‘Šè¯‰æ¨¡å‹ç»“æŸä½ç½®ä¸å¯èƒ½åœ¨å¼€å§‹ä½ç½®çš„å‰é¢ã€‚ä¸ºäº†é˜²æ­¢é”™è¯¯ä¼ æ’­ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨gold $p ^se$(åˆ°æœ€è¿‘çš„æ­£ç¡®èµ·å§‹ä½ç½®çš„è·ç¦»)ã€‚å°†HBTçš„è®­ç»ƒæŸå¤±(å¾…æœ€å°åŒ–)å®šä¹‰ä¸ºå¼€å§‹å’Œç»“æŸæ ‡ç­¾çš„è´Ÿå¯¹æ•°æ¦‚ç‡ä¹‹å’Œã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/8.png"></p><p>å…¶ä¸­$y ^{sta} _i$ å’Œ $y ^{end} _i$åˆ†åˆ«æ˜¯ç¬¬iä¸ªå•è¯çš„çœŸæ­£çš„å¼€å§‹æ ‡è®°å’Œç»“æŸæ ‡è®°ï¼Œnæ˜¯è¾“å…¥å¥å­çš„é•¿åº¦ã€‚</p><p>â€‹         åœ¨æ¨ç†æ—¶ï¼Œä¸ºäº†é€‚åº”å¤šç›®æ ‡æå–ä»»åŠ¡ï¼Œæˆ‘ä»¬æå‡ºäº†å¤šè·¨åº¦è¯‘ç ç®—æ³•ï¼Œå¦‚ç®—æ³•1æ‰€ç¤ºã€‚å¯¹äºæ¯ä¸ªè¾“å…¥å¥å­$S$ï¼Œæˆ‘ä»¬é¦–å…ˆåˆå§‹åŒ–å‡ ä¸ªå˜é‡(line1-4)æ¥è¾…åŠ©è§£ç :</p><p>ï¼ˆï¼‘ï¼‰nè¢«å®šä¹‰ä¸º$S$çš„é•¿åº¦</p><p>ï¼ˆï¼’ï¼‰$R$è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºé›†ï¼Œç”¨æ¥è®°å½•æ‰€æå–çš„ç›®æ ‡å’Œç±»å‹æ ‡ç­¾ã€‚</p><p>ï¼ˆï¼“ï¼‰å¼•å…¥$s ^*$ä¿æŒå½“å‰æŒ‡æ•°å‰æœ€è¿‘çš„èµ·å§‹ä½ç½®ã€‚</p><p>ï¼ˆï¼”ï¼‰å°†$p ^se$åˆå§‹åŒ–ä¸ºé•¿åº¦ä¸º$n$çš„åˆ—è¡¨ï¼Œé»˜è®¤å€¼ä¸º$C$ï¼Œä¿å­˜ä½ç½®åºåˆ—$[p ^{se} _1ï¼ŒÂ·Â·ï¼Œp ^{se} _n]$ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡å…¬å¼. 4(line5)è·å¾—å¼€å§‹æ ‡ç­¾åºåˆ—ï¼Œé€šè¿‡å…¬å¼. 8(ç¬¬6-10è¡Œ)è®¡ç®—æ¯ä¸ªæ ‡è®°çš„$p ^{sei}$ã€‚åœ¨$p ^{se}$çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æŸ¥æ‰¾ä½ç½®åµŒå…¥çŸ©é˜µå¾—åˆ°$p ^{se}$((ç¬¬11è¡Œ)ã€‚é‚£ä¹ˆæ ¹æ®å…¬å¼. 7(ç¬¬12è¡Œ)è®¡ç®—ç»“æŸä½ç½®çš„æ ‡ç­¾åºåˆ—ã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/3.png"></p><p>â€‹       å¼€å§‹è§£ç sta_tagï¼ˆSï¼‰å’Œend_tagï¼ˆSï¼‰ã€‚ é¦–å…ˆéå†sta_tagï¼ˆSï¼‰æ¥æ‰¾åˆ°ç›®æ ‡çš„èµ·å§‹ä½ç½®ï¼ˆç¬¬13è¡Œï¼‰ã€‚ å¦‚æœå½“å‰ç´¢å¼•çš„æ ‡ç­¾ä¸æ˜¯â€œ Oâ€ï¼Œåˆ™è¡¨ç¤ºè¯¥ä½ç½®å¯èƒ½æ˜¯èµ·å§‹å•è¯ï¼ˆç¬¬14è¡Œï¼‰ï¼Œç„¶åæˆ‘ä»¬å°†ä»è¯¥ç´¢å¼•éå†end_tagï¼ˆSï¼‰ä»¥æœç´¢ç»“æŸä½ç½®ï¼ˆç¬¬15è¡Œï¼‰ã€‚ åŒ¹é…æ ‡å‡†æ˜¯ï¼Œå¦‚æœç»“æŸä½ç½®çš„æ ‡ç­¾ä¸å¼€å§‹ä½ç½®ç›¸åŒï¼ˆç¬¬16è¡Œï¼‰ï¼Œåˆ™å°†ä¸¤ä¸ªç´¢å¼•ä¹‹é—´çš„å•è¯è§†ä¸ºå€™é€‰ç›®æ ‡ï¼ˆç¬¬17è¡Œï¼‰ï¼Œå¹¶å°†å¼€å§‹ä½ç½®ï¼ˆæˆ–ç»“æŸä½ç½®ï¼‰çš„æ ‡ç­¾è§†ä¸º ï¼‰è¢«è§†ä¸ºè¯¥ç›®æ ‡çš„æ ‡ç­¾ï¼ˆç¬¬18è¡Œï¼‰ã€‚ ç„¶åå°†æå–çš„ç›®æ ‡åŠå…¶æ ‡ç­¾æ·»åŠ åˆ°é›†åˆRï¼ˆç¬¬19è¡Œï¼‰ä¸­ï¼Œç»“æŸend_tagï¼ˆSï¼‰ä¸­çš„æœç´¢ä»¥ç»§ç»­éå†sta_tagï¼ˆSï¼‰ä»¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªèµ·å§‹ä½ç½®ï¼ˆç¬¬20è¡Œï¼‰ã€‚ ä¸€æ—¦sta_tagï¼ˆSï¼‰ä¸­çš„æ‰€æœ‰ç´¢å¼•éƒ½ç»è¿‡è¿­ä»£ï¼Œæ­¤è§£ç å‡½æ•°å°†é€šè¿‡è¿”å›è®°å½•çš„æ•°æ®é›†Rï¼ˆç¬¬21è¡Œï¼‰ã€‚</p><h3 id="EXTRACTION-SYSTEM"><a href="#EXTRACTION-SYSTEM" class="headerlink" title="EXTRACTION SYSTEM"></a>EXTRACTION SYSTEM</h3><p>â€‹         åˆ©ç”¨åŸºäºè·³è½¬çš„æ ‡è®°æ–¹æ¡ˆå’Œåˆ†å±‚è¾¹ç•Œæ ‡è®°å™¨ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç«¯åˆ°ç«¯ç¥ç»ç»“æ„(å›¾2)æ¥è”åˆæå–å®ä½“å’Œé‡å å…³ç³»ï¼Œé¦–å…ˆä½¿ç”¨å…±äº«çš„BiLSTMç¼–ç å™¨å¯¹å¥å­è¿›è¡Œç¼–ç ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ„é€ äº†ä¸€ä¸ªæå–å¤´å®ä½“çš„æå–å™¨ã€‚å¯¹äºæ¯ä¸€ä¸ªæå–å‡ºæ¥çš„å¤´å®ä½“ï¼Œåˆ©ç”¨å¤´å®ä½“çš„è¯­ä¹‰å’Œä½ç½®ä¿¡æ¯è§¦å‘TERæå–å™¨ï¼Œæ£€æµ‹å‡ºç›¸åº”çš„å°¾å®ä½“å’Œå…³ç³»</p><h4 id="Shared-Encode"><a href="#Shared-Encode" class="headerlink" title="Shared Encode"></a>Shared Encode</h4><p>ç»™å®šè¯­å¥$ S={x _1ï¼ŒÂ·Â·Â·ï¼Œx _n}$ï¼Œæˆ‘ä»¬åˆ©ç”¨BiLSTMå±‚åˆå¹¶æ¥è‡ªå‘å‰å’Œå‘åçš„ä¿¡æ¯</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/9.png"></p><p>â€‹       å…¶ä¸­$h _i$æ˜¯ä½ç½®$i$çš„éšè—çŠ¶æ€ï¼Œ$x _i$æ˜¯$x _i$çš„å•è¯è¡¨ç¤ºï¼Œå…¶ä¸­åŒ…å«é¢„å…ˆè®­ç»ƒè¿‡çš„åµŒå…¥å’Œå¯¹$x _i$çš„å­—ç¬¦åºåˆ—è¿è¡ŒCNNç”Ÿæˆçš„åŸºäºå­—ç¬¦çš„å•è¯è¡¨ç¤ºã€‚ä¹‹åï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨part-of-speech(POS)è¯å‘é‡æ¥ä¸°å¯Œ$x _i$ã€‚</p><h4 id="HE-Extractor"><a href="#HE-Extractor" class="headerlink" title="HE Extractor"></a>HE Extractor</h4><p>â€‹       æå–å™¨çš„ç›®çš„æ˜¯åŒºåˆ†å€™é€‰çš„å¤´å®ä½“ï¼Œæ’é™¤ä¸ç›¸å…³çš„å¤´å®ä½“ã€‚æˆ‘ä»¬é¦–å…ˆå°†$h _i$å’Œ$g$è¿æ¥èµ·æ¥ï¼Œå¾—åˆ°ç‰¹å¾å‘é‡$x _i= [h _i;g]$ï¼Œå…¶ä¸­$g$æ˜¯é€šè¿‡å¯¹æ‰€æœ‰éšè—çŠ¶æ€çš„æœ€å¤§æ± åŒ–è®¡ç®—å¾—åˆ°çš„å…¨å±€ä¸Šä¸‹æ–‡è¡¨ç¤ºã€‚å®é™…ä¸Šï¼Œ$g$ä½œä¸ºå…¬å¼2ä¸­æ¯ä¸ªtokençš„$a _i$ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨$HHE= ï½›x _1ï¼ŒÂ·Â·ï¼Œx _nï½ $è¡¨ç¤ºæ‰€æœ‰ç”¨äºæå–HEçš„è¯è¡¨ç¤ºï¼Œç„¶åå°†HHEè¾“å…¥åˆ°ä¸€ä¸ªHBTä¸­æå–å¤´éƒ¨å®ä½“ã€‚å…¶ä¸­$RHE =ï½›(h _j, type _{h _j})ï½^m _{j=1}$åŒ…å«äº†Sä¸­æ‰€æœ‰çš„å¤´éƒ¨å®ä½“å’Œå¯¹åº”çš„å®ä½“ç±»å‹æ ‡ç­¾ã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/10.png"></p><h4 id="TER-Extractor"><a href="#TER-Extractor" class="headerlink" title="TER Extractor"></a>TER Extractor</h4><p>ç±»ä¼¼äºHEæå–å™¨ï¼ŒTERæå–å™¨è¿˜ä½¿ç”¨åŸºæœ¬è¡¨ç¤ºå½¢å¼$h _i$å’Œå…¨å±€è¯å‘é‡$g$ä½œä¸ºè¾“å…¥ç‰¹å¾ã€‚ ä½†æ˜¯ï¼Œä»…å°†$h _i$å’Œ$g$ä¸²è”ä¸è¶³ä»¥æ£€æµ‹å°¾éƒ¨å®ä½“ä»¥åŠä¸ç‰¹å®šå¤´éƒ¨å®ä½“çš„å…³ç³»ã€‚ è¿›è¡ŒTERæå–æ‰€éœ€çš„å…³é”®ä¿¡æ¯åŒ…æ‹¬ï¼š</p><p>ï¼ˆ1ï¼‰å°¾éƒ¨å®ä½“å†…çš„å•è¯ï¼›</p><p>ï¼ˆ2ï¼‰è¢«ä¾èµ–çš„å¤´éƒ¨å®ä½“ï¼› </p><p>ï¼ˆ3ï¼‰è¡¨ç¤ºå…³ç³»çš„ä¸Šä¸‹æ–‡ï¼› </p><p>ï¼ˆ4ï¼‰å°¾éƒ¨å®ä½“ä¸å¤´éƒ¨å®ä½“ä¹‹é—´çš„è·ç¦»ã€‚</p><p> åŸºäºè¿™äº›è€ƒè™‘ï¼Œæå‡ºäº†ä½ç½®æ„ŸçŸ¥ï¼Œå¤´ç›®å®ä½“æ„ŸçŸ¥å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥è¡¨ç¤ºã€‚ ç»™å®šä¸€ä¸ªä¸»å®ä½“$h$ï¼Œæˆ‘ä»¬å®šä¹‰$\overline{x } _i$ä¸ºï¼š</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/11.png"></p><p>å¼ä¸­$h ^h= [h _{s _h};h _{e _h}]$è¡¨ç¤ºå¤´å®ä½“$h$çš„è¡¨ç¤ºï¼Œå…¶ä¸­$h _{s _h}$å’Œ$h _{e _h}$åˆ†åˆ«ä¸º$h$çš„å¼€å§‹å’Œç»“æŸæŒ‡æ ‡å¤„çš„éšè—çŠ¶æ€ã€‚$p ^{ht} _i$æ˜¯å¯¹$x _i$åˆ°hçš„ç›¸å¯¹è·ç¦»è¿›è¡Œç¼–ç çš„åµŒå…¥ä½ç½®ã€‚æ˜¾ç„¶ï¼Œ$[g;h _h;p ^{ht} _i]$æ˜¯ç”¨äºTERæå–çš„è¾…åŠ©ç‰¹å¾å‘é‡ï¼Œå¦‚å…¬å¼2ä¸­çš„$a _i$ã€‚</p><p>å½¢å¼ä¸Šï¼Œæˆ‘ä»¬å–$HTER={x _1ï¼ŒÂ·Â·Â·ï¼Œx _n}$ä½œä¸ºä¸€ä¸ªHBTçš„è¾“å…¥ï¼Œè¾“å‡º$RTER=ï½›(t _o, rel _o)ï½zo=1$ï¼Œå…¶ä¸­$t _o$ä¸ºç¬¬$o$ä¸ªæå–çš„å°¾éƒ¨å®ä½“ï¼Œ$rel _o$ä¸ºå…¶ä¸ç»™å®šå¤´å®ä½“çš„å…³ç³»æ ‡ç­¾ã€‚</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/12.png"></p><p>â€‹     å¯ä»¥é€šè¿‡å°†$h$å’Œ$eachï¼ˆt _oï¼Œrel _oï¼‰$ç»„åˆæˆ$ï½›ï¼ˆhï¼Œreloï¼Œtoï¼‰ï½ ^{z} _{o = 1}$æ¥ç»„åˆä¸‰å…ƒç»„ï¼Œå…¶ä¸­åŒ…å«å¥å­$S$ä¸­æ‰€æœ‰å¸¦æœ‰å¤´å®ä½“$h$çš„ä¸‰å…ƒç»„ã€‚è€Œåœ¨æ¨ç†æ—¶ï¼Œæˆ‘ä»¬ä»RHEä¸­é€ä¸€é€‰æ‹©å¤´å®ä½“ä»¥å®Œæˆæå–ä»»åŠ¡ã€‚</p><h4 id="Training-of-Joint-Extractor"><a href="#Training-of-Joint-Extractor" class="headerlink" title="Training of Joint Extractor"></a>Training of Joint Extractor</h4><p>æä¾›äº†ä¸¤ç§å­¦ä¹ æ–¹å¼æ¥è®­ç»ƒæ¨¡å‹ï¼šç”¨äºHEæå–çš„LHEå’Œç”¨äºTERæå–çš„LTERï¼Œéƒ½è¢«è¡¨ç¤ºä¸ºå…¬å¼9.ä¸ºäº†åœ¨ä»»åŠ¡ä¹‹é—´å…±äº«è¾“å…¥å¹¶è¿›è¡Œè”åˆè®­ç»ƒï¼Œå¯¹äºæ¯ä¸ªè®­ç»ƒå®ä¾‹ï¼Œæˆ‘ä»¬éšæœºé€‰æ‹©ä¸€ä¸ªå¤´éƒ¨å®ä½“ ä»å…¨å±€å¤´å®ä½“ä¸­è®¾ç½®ä¸ºTERæå–å™¨çš„æŒ‡å®šè¾“å…¥ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥å¤šæ¬¡é‡å¤æ¯ä¸ªå¥å­ä»¥ç¡®ä¿ä½¿ç”¨æ‰€æœ‰ä¸‰å…ƒç»„ï¼Œä½†æ˜¯å®éªŒç»“æœè¡¨æ˜ä¸æ˜¯å¾ˆæœ‰æ„ä¹‰ã€‚æœ€åï¼ŒæŸå¤±ç”±ä¸‹å¼ç»™å‡ºï¼š</p><p><img src="/2020/09/13/joint-extraction-of-entities-and-relations-based-on-a-novel-decomposition-strategy/13.png"></p><p>   ç„¶åï¼Œå¯¹æ¨¡å‹è¿›è¡Œéšæœºæ¢¯åº¦ä¸‹é™è®­ç»ƒã€‚è¿ç®—å¼å…¬å¼14èƒ½å¤Ÿæå–å¤´-å®ä½“ã€å°¾-å®ä½“å’Œç›¸äº’å½±å“çš„å…³ç³»ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªç»„åˆä¸­çš„é”™è¯¯å¯ä»¥äº’ç›¸çº¦æŸã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…³ç³»æŠ½å– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³ç³»æŠ½å–æ±‡æ€»</title>
      <link href="/2020/09/12/guan-xi-chou-qu-github-hui-zong/"/>
      <url>/2020/09/12/guan-xi-chou-qu-github-hui-zong/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³ç³»æŠ½å–æ±‡æ€»"><a href="#å…³ç³»æŠ½å–æ±‡æ€»" class="headerlink" title="å…³ç³»æŠ½å–æ±‡æ€»"></a>å…³ç³»æŠ½å–æ±‡æ€»</h1><p> ã€€ã€€ç›®å‰æœ‰ä¸¤å¤§ç±»æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨æµæ°´çº¿çš„æ–¹æ³•ï¼ˆPipelined Methodï¼‰è¿›è¡ŒæŠ½å–ï¼šè¾“å…¥ä¸€ä¸ªå¥å­ï¼Œé¦–å…ˆè¿›è¡Œå‘½åå®ä½“è¯†åˆ«ï¼Œç„¶åå¯¹è¯†åˆ«å‡ºæ¥çš„å®ä½“è¿›è¡Œä¸¤ä¸¤ç»„åˆï¼Œå†è¿›è¡Œå…³ç³»åˆ†ç±»ï¼Œæœ€åæŠŠå­˜åœ¨å®ä½“å…³ç³»çš„ä¸‰å…ƒç»„ä½œä¸ºè¾“å…¥ã€‚æµæ°´çº¿çš„æ–¹æ³•å­˜åœ¨çš„ç¼ºç‚¹æœ‰ï¼š1ï¼‰é”™è¯¯ä¼ æ’­ï¼Œå®ä½“è¯†åˆ«æ¨¡å—çš„é”™è¯¯ä¼šå½±å“åˆ°ä¸‹é¢çš„å…³ç³»åˆ†ç±»æ€§èƒ½ï¼›2ï¼‰å¿½è§†äº†ä¸¤ä¸ªå­ä»»åŠ¡ä¹‹é—´å­˜åœ¨çš„å…³ç³»ï¼Œä¾‹å¦‚å¦‚æœå­˜åœ¨Country-Presidentå…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“å‰ä¸€ä¸ªå®ä½“å¿…ç„¶å±äºLocationç±»å‹ï¼Œåä¸€ä¸ªå®ä½“å±äºPersonç±»å‹ï¼Œæµæ°´çº¿çš„æ–¹æ³•æ²¡æ³•åˆ©ç”¨è¿™æ ·çš„ä¿¡æ¯ã€‚3ï¼‰äº§ç”Ÿäº†æ²¡å¿…è¦çš„å†—ä½™ä¿¡æ¯ï¼Œç”±äºå¯¹è¯†åˆ«å‡ºæ¥çš„å®ä½“è¿›è¡Œä¸¤ä¸¤é…å¯¹ï¼Œç„¶åå†è¿›è¡Œå…³ç³»åˆ†ç±»ï¼Œé‚£äº›æ²¡æœ‰å…³ç³»çš„å®ä½“å¯¹å°±ä¼šå¸¦æ¥å¤šä½™ä¿¡æ¯ï¼Œæå‡é”™è¯¯ç‡ã€‚å¦ä¸€ç§æ˜¯è”åˆå­¦ä¹ ï¼Œè¾“å…¥ä¸€ä¸ªå¥å­ï¼Œé€šè¿‡å®ä½“è¯†åˆ«å’Œå…³ç³»æŠ½å–è”åˆæ¨¡å‹ï¼Œç›´æ¥å¾—åˆ°æœ‰å…³ç³»çš„å®ä½“ä¸‰å…ƒç»„ã€‚è¿™ç§å¯ä»¥å…‹æœä¸Šé¢æµæ°´çº¿æ–¹æ³•çš„ç¼ºç‚¹ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰æ›´å¤æ‚çš„ç»“æ„ã€‚</p><h2 id="æµæ°´çº¿"><a href="#æµæ°´çº¿" class="headerlink" title="æµæ°´çº¿"></a>æµæ°´çº¿</h2><h2 id="è”åˆæ¨¡å‹"><a href="#è”åˆæ¨¡å‹" class="headerlink" title="è”åˆæ¨¡å‹"></a>è”åˆæ¨¡å‹</h2><p>â€‹      åŸºäºç¥ç»ç½‘ç»œæ–¹æ³•çš„è”åˆå­¦ä¹ ï¼Œæˆ‘æŠŠç›®å‰çš„å·¥ä½œä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š1ï¼‰å‚æ•°å…±äº«ï¼ˆParameter Sharingï¼‰å’Œ2ï¼‰æ ‡æ³¨ç­–ç•¥ï¼ˆTagging Schemeï¼‰</p><h3 id="åŠæŒ‡é’ˆ-åŠæ ‡æ³¨"><a href="#åŠæŒ‡é’ˆ-åŠæ ‡æ³¨" class="headerlink" title="åŠæŒ‡é’ˆ-åŠæ ‡æ³¨"></a>åŠæŒ‡é’ˆ-åŠæ ‡æ³¨</h3><p>[DESC]</p><p>â€œåŠæŒ‡é’ˆ-åŠæ ‡æ³¨â€æ–¹æ³•å®ä½“çš„æŠ½å–å™¨ï¼ŒåŸºäºè‹ç¥çš„<a href="https://kexue.fm/archives/7161">ä¸‰å…ƒç»„æŠ½å–</a>æ–¹æ³•æ”¹é€ ï¼Œè¿™é‡Œå–æ¶ˆäº†ä¸‰å…ƒç»„æŠ½å–æ¨¡å‹ä¸­å¯¹sçš„æŠ½å–ï¼Œç›´æ¥æŠ½å–å®ä½“å¹¶åšåˆ†ç±»(ç›¸å½“äºç›´æ¥æŠ½å–på’Œo)ã€‚æ”¹é€ åçš„å®ä½“æŠ½å–æ–¹æ³•ä¸ä»…å¯ä»¥è¿ç”¨äºçŸ­å®ä½“çš„æŠ½å–ï¼Œä¹Ÿå¯ä»¥è¿ç”¨åˆ°é•¿å¥å®ä½“çš„æŠ½å–ã€‚</p><p>[github] <a href="https://github.com/StanleyLsx/entity_extractor_by_binary_tagging">https://github.com/StanleyLsx/entity_extractor_by_binary_tagging</a></p><p>[github]<a href="https://github.com/zhengyima/kg-baseline-pytorch">https://github.com/zhengyima/kg-baseline-pytorch</a> (torch baseline ç‰ˆæœ¬)</p><h2 id="Bert"><a href="#Bert" class="headerlink" title="Bert"></a>Bert</h2><p>[DESC] ä¸­æ–‡å…³ç³»æŠ½å–, äººç‰©å…³ç³»æŠ½å–</p><p>[github] <a href="https://github.com/Jacen789/relation-extraction">https://github.com/Jacen789/relation-extraction</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ±‡æ€» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å…³ç³»æŠ½å– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python argparseå‚æ•°è§£ææ¨¡å—</title>
      <link href="/2020/09/12/python-argparse-can-shu-jie-xi-mo-kuai/"/>
      <url>/2020/09/12/python-argparse-can-shu-jie-xi-mo-kuai/</url>
      
        <content type="html"><![CDATA[<h1 id="argparse"><a href="#argparse" class="headerlink" title="argparse"></a>argparse</h1><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> argparse<span class="token punctuation">(</span>å¯¼å…¥ç¨‹åºå‚æ•°æ¨¡å—<span class="token punctuation">)</span>åˆ›å»ºargparseå¯¹è±¡ï¼Œå¹¶å°†äº§å“ç®€è¦è¯´æ˜åŠ å…¥show <span class="token operator">=</span> <span class="token string">'ç¨‹åºè¯´æ˜'</span> <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span>ç¨‹åºç®€è¦è¯´æ˜<span class="token punctuation">(</span>å­—ç¬¦ä¸²<span class="token punctuation">)</span>ï¼Œè¾“å‡ºhelpæ—¶ä¼šæ˜¾ç¤ºp <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span>show<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœå‚æ•°åç§°å‰æ²¡æœ‰â€˜-â€™æˆ–â€˜--â€™åˆ™è¯¥å‚æ•°ä¸ºå¿…å¡«å‚æ•°ï¼Œå¦‚æœç¨‹åºè¿è¡Œæ—¶ä¸ç»™å®ƒèµ‹å€¼åˆ™ç¨‹åºå°†æŠ›å‡ºå¼‚å¸¸(èµ‹å€¼æ—¶ç›´æ¥ç»™å€¼å³å¯ï¼Œä¸éœ€è¾“å‚æ•°åï¼Œå‚è€ƒpingå‘½ä»¤)</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'å‚æ•°åç§°(-hæ—¶ä¼šæ˜¾ç¤º)'</span><span class="token punctuation">,</span> <span class="token string">'--åˆ«å(é€‰å¡«ï¼Œ'</span><span class="token operator">-</span>å‚æ•°åç§° <span class="token operator">=</span> <span class="token operator">-</span><span class="token operator">-</span>åˆ«å<span class="token string">')'</span>ï¼Œ<span class="token operator">+</span>å„ç§å‚æ•°ã€‚ã€‚ã€‚<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªâ€˜--â€™å‚æ•°ï¼Œå¦‚æœå‚æ•°å‰æœ‰â€˜--â€™åˆ™ä¸ºå¯é€‰å‚æ•°ã€‚åœ¨è¾“å…¥â€˜--å‚æ•°â€™åå†èµ‹å€¼ã€‚</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--å‚æ•°åç§°'</span><span class="token punctuation">,</span><span class="token operator">+</span>å„ç§å‚æ•°ã€‚ã€‚ã€‚<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªâ€˜-â€™å‚æ•°ï¼Œå¦‚æœå‚æ•°å‰æœ‰â€˜-â€™åˆ™ä¸ºå¯é€‰å‚æ•°ã€‚åœ¨è¾“å…¥â€˜-å‚æ•°â€™åå†èµ‹å€¼ã€‚æ³¨æ„ï¼šå¦‚æœå‚æ•°æœ‰åˆ«ååˆ™å®é™…å‚æ•°å€¼æ˜¯èµ‹ç»™äº†åˆ«åã€‚</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-å‚æ•°åç§°'</span><span class="token punctuation">,</span> <span class="token string">'--åˆ«å(é€‰å¡«ï¼Œ'</span><span class="token operator">-</span>å‚æ•°åç§° <span class="token operator">=</span> <span class="token operator">-</span><span class="token operator">-</span>åˆ«å<span class="token string">')'</span>ï¼Œ<span class="token operator">+</span>å„ç§å‚æ•°ã€‚ã€‚ã€‚<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–ç¨‹åºå‚æ•°çš„å€¼ï¼Œargsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é‡Œçš„è‹¥å¹²å±æ€§ç­‰äºå‚æ•°(æå–å‚æ•°çš„å€¼ï¼šargs.å‚æ•°åç§°)</span>args <span class="token operator">=</span> p<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="add-argumentæ–¹æ³•å‚æ•°è¯´æ˜ï¼š"><a href="#add-argumentæ–¹æ³•å‚æ•°è¯´æ˜ï¼š" class="headerlink" title="add_argumentæ–¹æ³•å‚æ•°è¯´æ˜ï¼š"></a>add_argumentæ–¹æ³•å‚æ•°è¯´æ˜ï¼š</h2><p>helpï¼šé’ˆå¯¹è¯¥å‚æ•°çš„è¯´æ˜ã€‚ä¾‹ï¼šhelp=â€™this display informationâ€™</p><p>typeï¼šè¯¥å‚æ•°å­—ç¬¦ç±»å‹(str,int,floatç­‰)ï¼Œå¦‚æœè¾“å…¥ç±»å‹ä¸å¯¹åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚ä¾‹ï¼štype=int</p><p>actionï¼šå½“è¯¥å‚æ•°å€¼ä¸ºâ€store_trueâ€æ—¶è¡¨ç¤ºåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæœºå…³ï¼Œå¸¦è¯¥å‚æ•°æ—¶åˆ™è¡¨ç¤ºå¼€å¯è¯¥æœºå…³(åˆ›å»ºçš„å‚æ•°(æœºå…³)æ­¤æ—¶çš„å€¼ä¸ºTrue)ï¼Œä¸å¸¦è¯¥å‚æ•°æ—¶åˆ™è¡¨ç¤ºå…³é—­è¯¥æœºå…³(åˆ›å»ºçš„å‚æ•°(æœºå…³)æ­¤æ—¶çš„å€¼ä¸ºFalse)ã€‚<br>(ä¾‹ï¼šp.add_argument(â€˜â€“vâ€™,action=â€™store_trueâ€™ï¼‰ ===&gt;å¦‚æœå¸¦è¯¥å‚æ•°åˆ™â€˜vâ€™çš„å€¼ä¸ºtrue)</p><p>choicesï¼šé™å®šå‚æ•°å€¼èŒƒå›´(è§„å®šåªæ¥æ”¶è§„å®šåˆ—è¡¨ä¸­çš„å€¼)ï¼Œå€¼ä¸ºåˆ—è¡¨ã€‚ä¾‹ï¼šchoices=[1,2,3]</p><p>defaultï¼šæŒ‡å®šå‚æ•°é»˜è®¤å€¼ã€‚ä¾‹ï¼šdefault=100</p><h2 id="åˆ›å»ºä¸¤ä¸ªäº’æ–¥çš„å‚æ•°"><a href="#åˆ›å»ºä¸¤ä¸ªäº’æ–¥çš„å‚æ•°" class="headerlink" title="åˆ›å»ºä¸¤ä¸ªäº’æ–¥çš„å‚æ•°"></a>åˆ›å»ºä¸¤ä¸ªäº’æ–¥çš„å‚æ•°</h2><pre class=" language-python"><code class="language-python">group <span class="token operator">=</span> parser <span class="token punctuation">.</span> add_mutually_exclusive_group <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span> åˆ›å»ºä¸€ä¸ªäº’æ–¥ç»„group<span class="token punctuation">.</span>add_argument <span class="token punctuation">(</span> <span class="token string">"-v"</span> <span class="token punctuation">,</span> <span class="token string">"--verbose"</span> <span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">"store_true"</span> <span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>äº’æ–¥ç»„å†…çš„å‚æ•°ä¸å¯åŒæ—¶å‡ºç°ï¼Œå¦åˆ™æŠ›å¼‚å¸¸group<span class="token punctuation">.</span>add_argument <span class="token punctuation">(</span> <span class="token string">"-q"</span> <span class="token punctuation">,</span> <span class="token string">"--quiet"</span> <span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">"store_true"</span> <span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">></span>äº’æ–¥ç»„å†…çš„å‚æ•°ä¸å¯åŒæ—¶å‡ºç°ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</code></pre><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> argparse<span class="token comment" spellcheck="true"># åˆ›å»ºå‚æ•°åŠŸèƒ½å¯¹è±¡</span>show <span class="token operator">=</span> <span class="token string">'è¿™æ˜¯ä¸€ä¸ªæ±‚é•¿æ–¹å½¢é¢ç§¯æˆ–é•¿æ–¹ä½“ä½“ç§¯çš„ç¨‹åº'</span>p <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span>show<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºå„ä¸ªå‚æ•°</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-x'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'é•¿æ–¹å½¢çš„åº•è¾¹é•¿åº¦'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-z'</span><span class="token punctuation">,</span> <span class="token string">'--kuan'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'å¦å¤–ä¸€æ¡è¾¹é•¿'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-y'</span><span class="token punctuation">,</span> <span class="token string">'--gao'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'é•¿æ–¹ä½“çš„é«˜åº¦'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ›å»ºäº’æ–¥å‚æ•°</span>group <span class="token operator">=</span> p<span class="token punctuation">.</span>add_mutually_exclusive_group<span class="token punctuation">(</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-v'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'æ±‚é•¿æ–¹å½¢é¢ç§¯'</span><span class="token punctuation">)</span>group<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-vv'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">'æ±‚é•¿æ–¹ä½“ä½“ç§¯'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æå–å‚æ•°çš„èµ‹å€¼</span>args <span class="token operator">=</span> p<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åˆ©ç”¨å‚æ•°çš„å€¼è¿›è¡Œè®¡ç®—</span><span class="token keyword">if</span> args<span class="token punctuation">.</span>v<span class="token punctuation">:</span>ã€€ã€€<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'é•¿æ–¹å½¢é¢ç§¯æ˜¯%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>x <span class="token operator">*</span> args<span class="token punctuation">.</span>kuan<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">elif</span> args<span class="token punctuation">.</span>vv<span class="token punctuation">:</span>ã€€ã€€<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'é•¿æ–¹ä½“ä½“ç§¯æ˜¯%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>x <span class="token operator">*</span> args<span class="token punctuation">.</span>kuan <span class="token operator">*</span> args<span class="token punctuation">.</span>gao<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>ã€€ã€€<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¯·ç”¨ä½¿ç”¨å‚æ•°è¡¨æ˜ä½ è¦ä½¿ç”¨çš„åŠŸèƒ½ï¼'</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pythonåŸºç¡€ </tag>
            
            <tag> å‚æ•°æ¨¡å— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorchä¸¤ç§æ¨¡å‹ä¿å­˜æ–¹å¼</title>
      <link href="/2020/09/11/pytorch-liang-chong-mo-xing-bao-cun-fang-shi/"/>
      <url>/2020/09/11/pytorch-liang-chong-mo-xing-bao-cun-fang-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="Torchæ¨¡å‹ä¿å­˜"><a href="#Torchæ¨¡å‹ä¿å­˜" class="headerlink" title="Torchæ¨¡å‹ä¿å­˜"></a>Torchæ¨¡å‹ä¿å­˜</h1><h2 id="åªä¿å­˜æ¨¡å‹å‚æ•°"><a href="#åªä¿å­˜æ¨¡å‹å‚æ•°" class="headerlink" title="åªä¿å­˜æ¨¡å‹å‚æ•°"></a>åªä¿å­˜æ¨¡å‹å‚æ•°</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ä¿å­˜</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\parameter.pkl'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åŠ è½½</span>model <span class="token operator">=</span> TheModelClass<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'\parameter.pkl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="ä¿å­˜å®Œæ•´æ¨¡å‹"><a href="#ä¿å­˜å®Œæ•´æ¨¡å‹" class="headerlink" title="ä¿å­˜å®Œæ•´æ¨¡å‹"></a>ä¿å­˜å®Œæ•´æ¨¡å‹</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ä¿å­˜</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">'\model.pkl'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># åŠ è½½</span>model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'\model.pkl'</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> torch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> torchåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CCKS2020é¢å‘ä¸­æ–‡çŸ­æ–‡æœ¬çš„å®ä½“é“¾æŒ‡ä»»åŠ¡</title>
      <link href="/2020/09/10/ccks2020-mian-xiang-zhong-wen-duan-wen-ben-de-shi-ti-lian-zhi-ren-wu/"/>
      <url>/2020/09/10/ccks2020-mian-xiang-zhong-wen-duan-wen-ben-de-shi-ti-lian-zhi-ren-wu/</url>
      
        <content type="html"><![CDATA[<h1 id="å®ä½“é“¾æŒ‡"><a href="#å®ä½“é“¾æŒ‡" class="headerlink" title="å®ä½“é“¾æŒ‡"></a>å®ä½“é“¾æŒ‡</h1><h2 id="ä»»åŠ¡ä»‹ç»"><a href="#ä»»åŠ¡ä»‹ç»" class="headerlink" title="ä»»åŠ¡ä»‹ç»"></a>ä»»åŠ¡ä»‹ç»</h2><p>é¢å‘ä¸­æ–‡çŸ­æ–‡æœ¬çš„å®ä½“é“¾æŒ‡ï¼Œç®€ç§° <strong>ELï¼ˆEntity Linkingï¼‰</strong>ã€‚å³å¯¹äºç»™å®šçš„ä¸€ä¸ªä¸­æ–‡çŸ­æ–‡æœ¬ï¼ˆå¦‚æœç´¢ Queryã€å¾®åšã€å¯¹è¯å†…å®¹ã€æ–‡ç« /è§†é¢‘/å›¾ç‰‡çš„æ ‡é¢˜ç­‰ï¼‰ï¼ŒEL å°†å…¶ä¸­çš„å®ä½“ä¸ç»™å®šçŸ¥è¯†åº“ä¸­å¯¹åº”çš„å®ä½“è¿›è¡Œå…³è”ã€‚é’ˆå¯¹ä¸­æ–‡çŸ­æ–‡æœ¬çš„å®ä½“é“¾æŒ‡å­˜åœ¨å¾ˆå¤§çš„æŒ‘æˆ˜ï¼Œä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰å£è¯­åŒ–ä¸¥é‡ï¼Œå¯¼è‡´å®ä½“æ­§ä¹‰æ¶ˆè§£å›°éš¾ï¼›<br>ï¼ˆ2ï¼‰çŸ­æ–‡æœ¬ä¸Šä¸‹æ–‡è¯­å¢ƒä¸ä¸°å¯Œï¼Œé¡»å¯¹ä¸Šä¸‹æ–‡è¯­å¢ƒè¿›è¡Œç²¾å‡†ç†è§£ï¼›<br>ï¼ˆ3ï¼‰ç›¸æ¯”è‹±æ–‡ï¼Œä¸­æ–‡ç”±äºè¯­è¨€è‡ªèº«çš„ç‰¹ç‚¹ï¼Œåœ¨çŸ­æ–‡æœ¬çš„é“¾æŒ‡é—®é¢˜ä¸Šæ›´æœ‰æŒ‘æˆ˜ã€‚</p><h2 id="ä»»åŠ¡è¯¦æƒ…"><a href="#ä»»åŠ¡è¯¦æƒ…" class="headerlink" title="ä»»åŠ¡è¯¦æƒ…"></a>ä»»åŠ¡è¯¦æƒ…</h2><p>æ­¤æ¬¡ä»»åŠ¡çš„è¾“å…¥è¾“å‡ºå®šä¹‰å¦‚ä¸‹ï¼š</p><p><strong>è¾“å…¥ï¼š</strong>ä¸­æ–‡çŸ­æ–‡æœ¬ä»¥åŠè¯¥çŸ­æ–‡æœ¬ä¸­çš„å®ä½“é›†åˆã€‚</p><p><strong>è¾“å‡ºï¼š</strong>è¾“å‡ºæ–‡æœ¬æ­¤ä¸­æ–‡çŸ­æ–‡æœ¬çš„å®ä½“é“¾æŒ‡ç»“æœã€‚æ¯ä¸ªç»“æœåŒ…å«ï¼šå®ä½“ mentionã€åœ¨ä¸­æ–‡çŸ­æ–‡æœ¬ä¸­çš„ä½ç½®åç§»ã€å…¶åœ¨ç»™å®šçŸ¥è¯†åº“ä¸­çš„ idï¼Œå¦‚æœä¸º NIL æƒ…å†µï¼Œéœ€è¦å†ç»™å‡ºå®ä½“çš„ä¸Šä½æ¦‚å¿µç±»å‹</p><h5 id="ç¤ºä¾‹è¾“å…¥ï¼š"><a href="#ç¤ºä¾‹è¾“å…¥ï¼š" class="headerlink" title="ç¤ºä¾‹è¾“å…¥ï¼š"></a>ç¤ºä¾‹è¾“å…¥ï¼š</h5><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"text_id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span>"ã€Šç…çŠæ¦œã€‹æµ·å®´_ã€åŸåˆ›å°è¯´|æƒè°‹å°è¯´ã€‘"<span class="token punctuation">,</span> <span class="token property">"mention_data"</span><span class="token operator">:</span><span class="token punctuation">[</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"ç…çŠæ¦œ"</span><span class="token punctuation">,</span>  <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"1"</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>   &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"æµ·å®´"</span><span class="token punctuation">,</span>  <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"5"</span>    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>   &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"åŸåˆ›å°è¯´"</span><span class="token punctuation">,</span>   <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"9"</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"æƒè°‹å°è¯´"</span><span class="token punctuation">,</span>   <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"14"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h5 id="ç¤ºä¾‹è¾“å‡ºï¼š"><a href="#ç¤ºä¾‹è¾“å‡ºï¼š" class="headerlink" title="ç¤ºä¾‹è¾“å‡ºï¼š"></a>ç¤ºä¾‹è¾“å‡ºï¼š</h5><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"text_id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>    <span class="token property">"text"</span><span class="token operator">:</span>"ã€Šç…çŠæ¦œã€‹æµ·å®´_ã€åŸåˆ›å°è¯´|æƒè°‹å°è¯´ã€‘"<span class="token punctuation">,</span>  <span class="token property">"mention_data"</span><span class="token operator">:</span><span class="token punctuation">[</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"kb_id"</span><span class="token operator">:</span><span class="token string">"2135131"</span><span class="token punctuation">,</span>            <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"ç…çŠæ¦œ"</span><span class="token punctuation">,</span>   <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"1"</span>   &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"kb_id"</span><span class="token operator">:</span><span class="token string">"10572965"</span><span class="token punctuation">,</span>   <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"æµ·å®´"</span><span class="token punctuation">,</span>     <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"5"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>     &amp;#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token property">"kb_id"</span><span class="token operator">:</span><span class="token string">"215143"</span><span class="token punctuation">,</span>   <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"åŸåˆ›å°è¯´"</span><span class="token punctuation">,</span>  <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"9"</span>  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token property">"kb_id"</span><span class="token operator">:</span><span class="token string">" NIL_Work "</span><span class="token punctuation">,</span>  <span class="token property">"mention"</span><span class="token operator">:</span><span class="token string">"æƒè°‹å°è¯´"</span><span class="token punctuation">,</span>   <span class="token property">"offset"</span><span class="token operator">:</span><span class="token string">"14"</span> &amp;#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h2 id="æ•°æ®ä»‹ç»"><a href="#æ•°æ®ä»‹ç»" class="headerlink" title="æ•°æ®ä»‹ç»"></a>æ•°æ®ä»‹ç»</h2><p><strong>çŸ¥è¯†åº“</strong></p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"alias"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token string">"10001"</span><span class="token punctuation">,</span> <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ”¿æ²»é¢è²Œ"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> <span class="token string">"ä¸­å…±å…šå‘˜"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ä¹‰é¡¹æè¿°"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> <span class="token string">"æ½œå±±å¿å¡”ç•ˆä¹¡å‰¯ä¸»ä»»ç§‘å‘˜ã€çºªå§”å‰¯ä¹¦è®°"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"æ€§åˆ«"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> <span class="token string">"ç”·"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"å­¦å†"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> <span class="token string">"å¤§ä¸“"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"predicate"</span><span class="token operator">:</span> <span class="token string">"ä¸­æ–‡å"</span><span class="token punctuation">,</span> <span class="token property">"object"</span><span class="token operator">:</span> <span class="token string">"å¼ å¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Person"</span><span class="token punctuation">,</span> <span class="token property">"subject"</span><span class="token operator">:</span> <span class="token string">"å¼ å¥"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>çŸ¥è¯†åº“ä¸­çš„æ¯ä¸ªå®ä½“éƒ½åŒ…å«alias, å¯¹åº”subjectå¯èƒ½çš„åˆ«åä¸€ä¸ªsubject_id(çŸ¥è¯†åº“id)ï¼Œä¸€ä¸ªsubjectåç§°ï¼Œå®ä½“çš„åˆ«å(ä¸»è¯­)ï¼Œå¯¹åº”çš„æ¦‚å¿µç±»å‹ï¼Œä»¥åŠä¸æ­¤å®ä½“ç›¸å…³çš„ä¸€ç³»åˆ—äºŒå…ƒç»„&lt; predicateï¼Œobject&gt;ï¼ˆ&lt;å±æ€§ï¼Œå±æ€§å€¼&gt;ï¼‰æˆ–è€…å«ï¼ˆè°“è¯­ï¼Œå®¾è¯­ï¼‰ä¿¡æ¯å½¢å¼ã€‚çŸ¥è¯†åº“ä¸­æ¯è¡Œä»£è¡¨çŸ¥è¯†åº“çš„ä¸€æ¡è®°å½•ï¼ˆä¸€ä¸ªå®ä½“ä¿¡æ¯ï¼‰ï¼Œæ¯æ¡è®°å½•ä¸ºjsonæ•°æ®æ ¼å¼ã€‚</p><p><strong>æ•°æ®é›†</strong></p><p>æ ‡æ³¨æ•°æ®é›†ç”±è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ç»„æˆï¼Œæ•´ä½“æ ‡æ³¨æ•°æ®å¤§çº¦10ä¸‡æ¡å·¦å³ã€‚<br>æ ‡æ³¨æ•°æ®é›†ä¸­æ¯æ¡æ•°æ®çš„æ ¼å¼ä¸ºï¼š</p><pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"text_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„å®´å¸­ - â•°ã¤é›²ä¸­å¸†â•°ã¤"</span><span class="token punctuation">,</span> <span class="token property">"mention_data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>&amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"kb_id"</span><span class="token operator">:</span> <span class="token string">"28270"</span><span class="token punctuation">,</span> <span class="token property">"mention"</span><span class="token operator">:</span> <span class="token string">"å¤©ä¸‹æ²¡æœ‰ä¸æ•£çš„å®´å¸­"</span><span class="token punctuation">,</span> <span class="token property">"offset"</span><span class="token operator">:</span> <span class="token string">"0"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"kb_id"</span><span class="token operator">:</span> <span class="token string">"NIL_Other"</span><span class="token punctuation">,</span> <span class="token property">"mention"</span><span class="token operator">:</span> <span class="token string">"â•°ã¤é›²ä¸­å¸†â•°ã¤"</span><span class="token punctuation">,</span> <span class="token property">"offset"</span><span class="token operator">:</span> <span class="token string">"12"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">]</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>kb_idå¯¹åº”çŸ¥è¯†åº“subject_idï¼Œmentionå¯¹åº”çš„æ˜¯å®ä½“ï¼</p><h2 id="è¯„ä»·æŒ‡æ ‡"><a href="#è¯„ä»·æŒ‡æ ‡" class="headerlink" title="è¯„ä»·æŒ‡æ ‡"></a>è¯„ä»·æŒ‡æ ‡</h2><p><img src="/2020/09/10/ccks2020-mian-xiang-zhong-wen-duan-wen-ben-de-shi-ti-lian-zhi-ren-wu/3.png"></p><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p><strong>çŸ¥è¯†åº“å¤„ç†</strong></p><pre class=" language-python"><code class="language-python">logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>PICKLE_PATH <span class="token operator">=</span> <span class="token string">"middle_data/kb/"</span>entity_to_kbids <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>set<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">## å®ä½“åç§°å¯¹åº”KDIDè¡¨</span>kbid_to_entities <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## KBIDå¯¹åº”çš„å®ä½“åç§°åˆ—è¡¨</span>kbid_to_text <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">## KDIDå¯¹åº”å±æ€§æ–‡æœ¬</span>kbid_to_types <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## KDIDå¯¹åº”å®ä½“ç±»å‹è¡¨</span>kbid_to_predicates <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># KBIDå¯¹åº”çš„å±æ€§åˆ—è¡¨</span>idx_to_type <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">## ç´¢å¼•ç±»å‹æ˜ å°„åˆ—è¡¨</span>type_to_idx <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">##ç±»å‹ç´¢å¼•æ˜ å°„å­—å…¸</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"/media/daiyizheng/SSD/data/CCKS/2020/ccks2020é¢å‘ä¸­æ–‡çŸ­æ–‡æœ¬çš„å®ä½“é“¾æŒ‡ä»»åŠ¡/kb.json"</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">for</span> line <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        line <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>        entities <span class="token operator">=</span> set<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token string">'alias'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        kbid <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token string">'subject_id'</span><span class="token punctuation">]</span>        type <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span>        subject <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span>        entities<span class="token punctuation">.</span>add<span class="token punctuation">(</span>subject<span class="token punctuation">)</span>        <span class="token keyword">for</span> entity <span class="token keyword">in</span> entities<span class="token punctuation">:</span>            entity_to_kbids<span class="token punctuation">[</span>entity<span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span>kbid<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#å®ä½“åç§°å¯¹åº”KDIDè¡¨</span>        kbid_to_entities<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span> <span class="token operator">=</span> entities        text_list<span class="token punctuation">,</span> predicate_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> line<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># dataä¸­çš„predicateå’Œobjectæ‹¼æ¥</span>            text_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'predicate'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            predicate_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'predicate'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>text_list<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># å¯¹å±æ€§æ–‡æœ¬éšæœºæ‰“ä¹±é¡ºåº</span>        kbid_to_text<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>text_list<span class="token punctuation">)</span>        kbid_to_predicates<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span> <span class="token operator">=</span> predicate_list        <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            kbid_to_text<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span> <span class="token operator">=</span> kbid_to_text<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>        type_list <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>        kbid_to_types<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span> <span class="token operator">=</span> type_list        <span class="token keyword">for</span> t <span class="token keyword">in</span> type_list<span class="token punctuation">:</span>            <span class="token keyword">if</span> t <span class="token operator">not</span> <span class="token keyword">in</span> type_to_idx<span class="token punctuation">:</span>                type_to_idx<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>type_to_idx<span class="token punctuation">)</span>                idx_to_type<span class="token punctuation">.</span>append<span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># ä¿å­˜pickleæ–‡ä»¶</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>entity_to_kbids<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'ENTITY_TO_KBIDS.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>kbid_to_entities<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'KBID_TO_ENTITIES.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>kbid_to_text<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'KBID_TO_TEXT.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>kbid_to_types<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'KBID_TO_TYPES.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>kbid_to_predicates<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'KBID_TO_PREDICATES.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>idx_to_type<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'IDX_TO_TYPE.pkl'</span><span class="token punctuation">)</span>    pd<span class="token punctuation">.</span>to_pickle<span class="token punctuation">(</span>type_to_idx<span class="token punctuation">,</span> PICKLE_PATH <span class="token operator">+</span> <span class="token string">'TYPE_TO_IDX.pkl'</span><span class="token punctuation">)</span>    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Process Pickle File Finish.'</span><span class="token punctuation">)</span></code></pre><p>æœ€æ€»æ•°æ®ä¿å­˜æ ¼å¼</p><pre><code>ENTITY_TO_KBIDSã€€ï½›"subject":&amp;#123;subject_id...&amp;#125;...ï½#ä¸€ä¸ªä¸»è¯­å¯¹åº”å¾ˆå¤šid,ä»£è¡¨ä¸åŒçš„è¯­ä¹‰KBID_TO_ENTITIES      &amp;#123;subject_id:"subject"...ï½## æ¯ä¸ªidåªå¯¹åº”ä¸€ä¸ªä¸»è¯­KBID_TO_TEXT              &amp;#123;subject_id:"subject"...ï½KBID_TO_TYPES           &amp;#123;subject_id:[type]...ï½KBID_TO_PREDICATES   &amp;#123;subject_id:"predicate"...ï½IDX_TO_TYPE               &amp;#123;idx:"type"...ï½TYPE_TO_IDX              &amp;#123;"type":idx...ï½</code></pre><p><strong>å®ä½“é“¾æŒ‡é¢„å¤„ç†</strong></p><p><img src="/2020/09/10/ccks2020-mian-xiang-zhong-wen-duan-wen-ben-de-shi-ti-lian-zhi-ren-wu/1.png"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_el_dataset</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> max_negs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    link_dict <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            <span class="token keyword">for</span> data <span class="token keyword">in</span> line<span class="token punctuation">[</span><span class="token string">'mention_data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">## å¯¹æµ‹è¯•é›†ç‰¹æ®Šå¤„ç†</span>                <span class="token keyword">if</span> <span class="token string">'kb_id'</span> <span class="token operator">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>                    data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'0'</span>                <span class="token comment" spellcheck="true"># KBä¸­ä¸å­˜åœ¨çš„å®ä½“ä¸è¿›è¡Œé“¾æ¥</span>                <span class="token keyword">if</span> <span class="token operator">not</span> data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                entity <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'mention'</span><span class="token punctuation">]</span>                kbids <span class="token operator">=</span> list<span class="token punctuation">(</span>entity_to_kbids<span class="token punctuation">[</span>entity<span class="token punctuation">]</span><span class="token punctuation">)</span>                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>kbids<span class="token punctuation">)</span>                num_negs <span class="token operator">=</span> <span class="token number">0</span>                <span class="token keyword">for</span> kbid <span class="token keyword">in</span> kbids<span class="token punctuation">:</span>                    <span class="token keyword">if</span> num_negs <span class="token operator">>=</span> max_negs <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">and</span> kbid <span class="token operator">!=</span> data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        <span class="token keyword">continue</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'text_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token string">'text_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'entity'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>entity<span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'offset'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'offset'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'short'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>kbid<span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'kb_text'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>kbid_to_text<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span><span class="token punctuation">)</span>                    link_dict<span class="token punctuation">[</span><span class="token string">'kb_predicate_num'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>len<span class="token punctuation">(</span>kbid_to_predicates<span class="token punctuation">[</span>kbid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">if</span> kbid <span class="token operator">!=</span> data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        link_dict<span class="token punctuation">[</span><span class="token string">'predict'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                        num_negs <span class="token operator">+=</span> <span class="token number">1</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        link_dict<span class="token punctuation">[</span><span class="token string">'predict'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    link_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>link_dict<span class="token punctuation">)</span>    type_name <span class="token operator">=</span> file_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    output_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>out_dir<span class="token punctuation">,</span> <span class="token string">"el_"</span> <span class="token operator">+</span> type_name <span class="token operator">+</span> <span class="token string">".tsv"</span><span class="token punctuation">)</span>    link_data<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf_8_sig'</span><span class="token punctuation">)</span></code></pre><p><strong>è´Ÿä¾‹é€‰å–</strong></p><p>é€šè¿‡è¯¥å®ä½“æŸ¥ENTITY_TO_KBIDSæ‰€æœ‰ä¸kidï¼Œå½“æ•°æ®é›†æŸä¸€æ¡è®°å½•kidç›¸åŒæ—¶æ­£ä¾‹ï¼Œä¸ç›¸åŒåˆ™æ˜¯è´Ÿä¾‹(åŒä¸€å®ä½“ï¼Œä¸åŒè¯­ä¹‰)è´Ÿä¾‹æœ€å¤šå–ä¸¤æ¡ï¼</p><p><strong>å®ä½“ç±»å‹é¢„å¤„ç†</strong></p><p><img src="/2020/09/10/ccks2020-mian-xiang-zhong-wen-duan-wen-ben-de-shi-ti-lian-zhi-ren-wu/2.png"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_et_dataset</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>    type_dict <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">)</span>            <span class="token keyword">for</span> data <span class="token keyword">in</span> line<span class="token punctuation">[</span><span class="token string">'mention_data'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                entity <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'mention'</span><span class="token punctuation">]</span>                <span class="token comment" spellcheck="true"># æµ‹è¯•é›†ç‰¹æ®Šå¤„ç†</span>                <span class="token keyword">if</span> <span class="token string">'kb_id'</span> <span class="token operator">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>                    entity_type <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Other'</span><span class="token punctuation">]</span>                <span class="token keyword">elif</span> data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    entity_type <span class="token operator">=</span> kbid_to_types<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    entity_type <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'kb_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span>                    <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>entity_type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        entity_type<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> entity_type<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                <span class="token keyword">for</span> e <span class="token keyword">in</span> entity_type<span class="token punctuation">:</span>                    type_dict<span class="token punctuation">[</span><span class="token string">'text_id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token string">'text_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    type_dict<span class="token punctuation">[</span><span class="token string">'entity'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>entity<span class="token punctuation">)</span>                    type_dict<span class="token punctuation">[</span><span class="token string">'offset'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'offset'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    type_dict<span class="token punctuation">[</span><span class="token string">'short_text'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    type_dict<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">)</span>    type_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>type_dict<span class="token punctuation">)</span>    output_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>out_dir<span class="token punctuation">,</span> <span class="token string">"et_"</span><span class="token operator">+</span>file_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".tsv"</span><span class="token punctuation">)</span>    type_data<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span></code></pre><h2 id="æ•°æ®è¾“å…¥"><a href="#æ•°æ®è¾“å…¥" class="headerlink" title="æ•°æ®è¾“å…¥"></a>æ•°æ®è¾“å…¥</h2><p><strong>å®ä½“é“¾æŒ‡</strong></p><p>cls+text+sep+text+sep</p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">_create_examples</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>lines<span class="token punctuation">,</span> set_type<span class="token punctuation">)</span><span class="token punctuation">:</span>        examples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            guid <span class="token operator">=</span> f<span class="token string">'&amp;#123;set_type&amp;#125;-&amp;#123;i&amp;#125;'</span>            text_a <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> line<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># entity+text</span>            text_b <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># kbä¸­çš„predicate+object</span>            label <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 0è´Ÿä¾‹ 1æ­£ä¾‹</span>            examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>InputExample<span class="token punctuation">(</span>guid<span class="token operator">=</span>guid<span class="token punctuation">,</span> text_a<span class="token operator">=</span>text_a<span class="token punctuation">,</span> text_b<span class="token operator">=</span>text_b<span class="token punctuation">,</span> label<span class="token operator">=</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> examples</code></pre><p><strong>å®ä½“åˆ†ç±»</strong></p><pre class=" language-python"><code class="language-python">  text_a <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            guid <span class="token operator">=</span> f<span class="token string">'&amp;#123;set_type&amp;#125;-&amp;#123;i&amp;#125;'</span>            text_a <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            text_b <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>            label <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>            examples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>InputExample<span class="token punctuation">(</span>                guid<span class="token operator">=</span>guid<span class="token punctuation">,</span>                text_a<span class="token operator">=</span>text_a<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#entity</span>                text_b<span class="token operator">=</span>text_b<span class="token punctuation">,</span><span class="token comment" spellcheck="true"># text</span>                label<span class="token operator">=</span>label<span class="token punctuation">,</span><span class="token comment" spellcheck="true"># classify</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><p><strong>å®ä½“é“¾æŒ‡</strong>(æ¨¡å‹åšè¯­ä¹‰ç›¸ä¼¼æ€§)</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">EntityLinkingModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args        bert_config <span class="token operator">=</span> BertConfig<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>args<span class="token punctuation">.</span>model_name_or_path<span class="token punctuation">)</span>        bert_config<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> <span class="token number">1</span>        config <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"config": bert_config&amp;#125;</span>        self<span class="token punctuation">.</span>bert <span class="token operator">=</span> BertForSequenceClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>args<span class="token punctuation">.</span>model_name_or_path<span class="token punctuation">,</span> <span class="token operator">**</span>config<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">## bertæ¨¡å‹</span>        self<span class="token punctuation">.</span>criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCEWithLogitsLoss    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token punctuation">)</span><span class="token punctuation">:</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">(</span>input_ids<span class="token operator">=</span>input_ids<span class="token punctuation">,</span> attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">)</span>        <span class="token keyword">return</span> output</code></pre><p><strong>å®ä½“åˆ†ç±»</strong>(æ¨¡å‹åˆ†ç±»)</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">EntityTypingModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args        bert_config <span class="token operator">=</span> BertConfig<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>args<span class="token punctuation">.</span>model_name_or_path<span class="token punctuation">)</span>        bert_config<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> <span class="token number">24</span>        config <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"config":bert_config&amp;#125;</span>        self<span class="token punctuation">.</span>bert <span class="token operator">=</span> BertForSequenceClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>args<span class="token punctuation">.</span>model_name_or_path<span class="token punctuation">,</span> <span class="token operator">**</span>config<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token punctuation">)</span><span class="token punctuation">:</span>        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">(</span>input_ids<span class="token operator">=</span>input_ids<span class="token punctuation">,</span> attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">)</span>        <span class="token keyword">return</span> outputs</code></pre><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><pre><code>text_id entity offset short_text type   result1  æ—å¹³ä¹‹    0  æ—å¹³ä¹‹ç­”åº”å²³çµçŠæŠ¥ä»‡ä¹‹äº‹ï¼Œä»é•¿è®¡è®®ï¼Œå¸ˆå¨˜æƒ³ä»¤ç‹å†²äº†  Other  Person1  å²³çµçŠ    5  æ—å¹³ä¹‹ç­”åº”å²³çµçŠæŠ¥ä»‡ä¹‹äº‹ï¼Œä»é•¿è®¡è®®ï¼Œå¸ˆå¨˜æƒ³ä»¤ç‹å†²äº†  Other  Person1  å¸ˆå¨˜ 18 æ—å¹³ä¹‹ç­”åº”å²³çµçŠæŠ¥ä»‡ä¹‹äº‹ï¼Œä»é•¿è®¡è®®ï¼Œå¸ˆå¨˜æƒ³ä»¤ç‹å†²äº†  Other  Other1  ä»¤ç‹å†²    21 æ—å¹³ä¹‹ç­”åº”å²³çµçŠæŠ¥ä»‡ä¹‹äº‹ï¼Œä»é•¿è®¡è®®ï¼Œå¸ˆå¨˜æƒ³ä»¤ç‹å†²äº†  Other  Person2  æ€è¿½ 0  æ€è¿½åŸæ¥æ˜¯ä¸ªè¶…çº§å¦¹æ§ï¼Œä¸æ„¿å¦¹å¦¹å«äººï¼Œç„¶è€Œå¦¹å¦¹å´å–œæ¬¢ä¸€åšè€å¸ˆ  Other  Person2  å¦¹æ§ 8  æ€è¿½åŸæ¥æ˜¯ä¸ªè¶…çº§å¦¹æ§ï¼Œä¸æ„¿å¦¹å¦¹å«äººï¼Œç„¶è€Œå¦¹å¦¹å´å–œæ¬¢ä¸€åšè€å¸ˆ  Other  Other2  å¦¹å¦¹ 13 æ€è¿½åŸæ¥æ˜¯ä¸ªè¶…çº§å¦¹æ§ï¼Œä¸æ„¿å¦¹å¦¹å«äººï¼Œç„¶è€Œå¦¹å¦¹å´å–œæ¬¢ä¸€åšè€å¸ˆ  Other  Other2  å¦¹å¦¹ 20 æ€è¿½åŸæ¥æ˜¯ä¸ªè¶…çº§å¦¹æ§ï¼Œä¸æ„¿å¦¹å¦¹å«äººï¼Œç„¶è€Œå¦¹å¦¹å´å–œæ¬¢ä¸€åšè€å¸ˆ  Other  Other</code></pre><p>æœ€ç»ˆæ¨¡å‹è¯„ä¼°ï¼š</p><p>f1:0.828 0.837</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ä½“æ­§ä¹‰æ¶ˆè§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾ç¥ç»ç½‘ç»œå¼€æ”¾æ•°æ®é›†</title>
      <link href="/2020/09/10/tu-shen-jing-wang-luo-kai-fang-shu-ju-ji/"/>
      <url>/2020/09/10/tu-shen-jing-wang-luo-kai-fang-shu-ju-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="å›¾ç¥ç»ç½‘ç»œå¼€æ”¾æ•°æ®é›†"><a href="#å›¾ç¥ç»ç½‘ç»œå¼€æ”¾æ•°æ®é›†" class="headerlink" title="å›¾ç¥ç»ç½‘ç»œå¼€æ”¾æ•°æ®é›†"></a>å›¾ç¥ç»ç½‘ç»œå¼€æ”¾æ•°æ®é›†</h1><p>å¾ˆå¤šå­¦è€…å’Œæœºæ„å‘å¸ƒäº†è®¸å¤šä¸å›¾ç›¸å…³çš„ä»»åŠ¡ï¼Œä»¥æµ‹è¯•å„ç§GNNçš„æ€§èƒ½ã€‚è¿™äº›ä»»åŠ¡ä¸€èˆ¬éƒ½ä¼šæä¾›æ•°æ®é›†ã€‚</p><p>æŒ‰ç…§ä»»åŠ¡åˆ†ç±»ï¼Œå¯ä»¥æŠŠæ•°æ®é›†åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li><strong>å¼•æ–‡ç½‘ç»œ</strong></li><li><strong>ç”ŸåŒ–å›¾</strong></li><li><strong>ç¤¾äº¤ç½‘ç»œ</strong></li><li><strong>çŸ¥è¯†å›¾è°±</strong></li><li><strong>å¼€æºæ•°æ®é›†ä»“åº“</strong></li></ul><h2 id="å¼•æ–‡ç½‘ç»œ"><a href="#å¼•æ–‡ç½‘ç»œ" class="headerlink" title="å¼•æ–‡ç½‘ç»œ"></a>å¼•æ–‡ç½‘ç»œ</h2><h3 id="Pubmed-Cora-Citeseer"><a href="#Pubmed-Cora-Citeseer" class="headerlink" title="Pubmed/Cora/Citeseer"></a><strong>Pubmed/Cora/Citeseer</strong></h3><p>å¼•æ–‡ç½‘ç»œï¼ŒèŠ‚ç‚¹ä¸ºè®ºæ–‡ã€è¾¹ä¸ºè®ºæ–‡é—´çš„å¼•ç”¨å…³ç³»ã€‚è¿™ä¸‰ä¸ªæ•°æ®é›†é€šå¸¸ç”¨äºé“¾è·¯é¢„æµ‹æˆ–èŠ‚ç‚¹åˆ†ç±»ã€‚</p><p>è¿™ä¸‰ä¸ªæ•°æ®é›†å‡æ¥è‡ªäºï¼š</p><p>ã€ŠCollective classification in network dataã€‹</p><p><strong>ä¸‹è½½é“¾æ¥å¯ä»ä»¥ä¸‹ç½‘å€æ‰¾åˆ°ï¼š</strong><a href="https://linqs.soe.ucsc.edu/data">https://linqs.soe.ucsc.edu/data</a></p><h3 id="DBLP"><a href="#DBLP" class="headerlink" title="DBLP"></a><strong>DBLP</strong></h3><p>DBLPæ˜¯å¤§å‹çš„è®¡ç®—æœºç±»æ–‡çŒ®ç´¢å¼•åº“ã€‚åŸå§‹çš„DBLPåªæ˜¯XMLæ ¼å¼ï¼Œæ¸…åå”æ°æ•™æˆçš„ä¸€ç¯‡è®ºæ–‡å°†å…¶è¿›è¡Œå¤„ç†å¹¶è·å¾—å¼•æ–‡ç½‘ç»œæ•°æ®é›†ã€‚åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‘å±•åˆ°äº†ç¬¬12ä¸ªç‰ˆæœ¬ã€‚</p><p><strong>DBLPå¼•ç”¨ç½‘ç»œè®ºæ–‡</strong>ï¼š<br>ã€ŠArnetMiner: Extraction and Mining of Academic Social Networksã€‹</p><ul><li><p>åŸå§‹æ•°æ®å¯ä»¥ä»è¿™é‡Œè·å¾—ï¼š<a href="https://dblp.uni-trier.de/xml/">https://dblp.uni-trier.de/xml/</a></p></li><li><p>å¦‚æœæ˜¯æƒ³æ‰¾å¤„ç†è¿‡çš„DBLPå¼•æ–‡ç½‘ç»œæ•°æ®é›†ï¼Œå¯ä»¥ä»è¿™é‡Œè·å¾—ï¼š<a href="https://www.aminer.cn/citation">https://www.aminer.cn/citation</a></p></li></ul><table><thead><tr><th align="left"><strong>æ•°æ®é›†</strong></th><th align="left"><strong>èŠ‚ç‚¹æ•°</strong></th><th align="left"><strong>è¾¹æ•°</strong></th><th align="left"><strong>ç‰¹å¾</strong></th><th align="left"><strong>æ ‡ç­¾</strong></th></tr></thead><tbody><tr><td align="left"><strong>Cora</strong></td><td align="left">2,708</td><td align="left">5,429</td><td align="left">1,433</td><td align="left">7</td></tr><tr><td align="left"><strong>Citeseer</strong></td><td align="left">3,327</td><td align="left">4,732</td><td align="left">3,703</td><td align="left">6</td></tr><tr><td align="left"><strong>Pubmed</strong></td><td align="left">19,717</td><td align="left">44,338</td><td align="left">500</td><td align="left">3</td></tr><tr><td align="left"><strong>DBLP_v12</strong></td><td align="left">4,894,081</td><td align="left">45,564,149</td><td align="left">-</td><td align="left">-</td></tr></tbody></table><h2 id="ç”ŸåŒ–å›¾"><a href="#ç”ŸåŒ–å›¾" class="headerlink" title="ç”ŸåŒ–å›¾"></a><strong>ç”ŸåŒ–å›¾</strong></h2><h3 id="PPI"><a href="#PPI" class="headerlink" title="PPI"></a><strong>PPI</strong></h3><p>è›‹ç™½è´¨-è›‹ç™½è´¨ç›¸äº’ä½œç”¨ï¼ˆprotein-protein interaction, PPIï¼‰æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è›‹ç™½è´¨åˆ†å­é€šè¿‡éå…±ä»·é”®å½¢æˆ è›‹ç™½è´¨å¤åˆä½“ï¼ˆprotein complexï¼‰çš„è¿‡ç¨‹ã€‚</p><p>PPIæ•°æ®é›†ä¸­å…±æœ‰24å¼ å›¾ï¼Œå…¶ä¸­è®­ç»ƒç”¨20å¼ ï¼ŒéªŒè¯/æµ‹è¯•åˆ†åˆ«2å¼ ã€‚</p><p>èŠ‚ç‚¹æœ€å¤šå¯ä»¥æœ‰121ç§æ ‡ç­¾ï¼ˆæ¯”å¦‚è›‹ç™½è´¨çš„ä¸€äº›æ€§è´¨ã€æ‰€å¤„ä½ç½®ç­‰ï¼‰ã€‚æ¯ä¸ªèŠ‚ç‚¹æœ‰50ä¸ªç‰¹å¾ï¼ŒåŒ…å«å®šä½åŸºå› é›†åˆã€ç‰¹å¾åŸºå› é›†åˆä»¥åŠå…ç–«ç‰¹å¾ã€‚</p><p><strong>PPIè®ºæ–‡</strong>ï¼šã€ŠPredicting multicellular function through multi-layer tissue networksã€‹<br><strong>PPIä¸‹è½½é“¾æ¥</strong>ï¼š<a href="http://snap.stanford.edu/graphsage/ppi.zip">http://snap.stanford.edu/graphsage/ppi.zip</a></p><h3 id="NCI-1"><a href="#NCI-1" class="headerlink" title="NCI-1"></a><strong>NCI-1</strong></h3><p>NCI-1æ˜¯å…³äºåŒ–å­¦åˆ†å­å’ŒåŒ–åˆç‰©çš„æ•°æ®é›†ï¼ŒèŠ‚ç‚¹ä»£è¡¨åŸå­ï¼Œè¾¹ä»£è¡¨åŒ–å­¦é”®ã€‚NCI-1åŒ…å«4100ä¸ªåŒ–åˆç‰©ï¼Œä»»åŠ¡æ˜¯åˆ¤æ–­è¯¥åŒ–åˆç‰©æ˜¯å¦æœ‰é˜»ç¢ç™Œç»†èƒå¢é•¿çš„æ€§è´¨ã€‚</p><p><strong>NCI-1è®ºæ–‡</strong>ï¼šã€ŠComparison of descriptor spaces for chemical compound retrieval and classiï¬cationã€‹</p><p><strong>Graph Kernel Datasetsæä¾›ä¸‹è½½</strong></p><h3 id="MUTAG"><a href="#MUTAG" class="headerlink" title="MUTAG"></a><strong>MUTAG</strong></h3><p>MUTAGæ•°æ®é›†åŒ…å«188ä¸ªç¡åŸºåŒ–åˆç‰©ï¼Œä»»åŠ¡æ˜¯åˆ¤æ–­åŒ–åˆç‰©æ˜¯èŠ³é¦™æ—è¿˜æ˜¯æ‚èŠ³æ—ã€‚</p><p><strong>MUTAGè®ºæ–‡</strong>ï¼šã€ŠStructure-activity relationship of mutagenic aromatic and heteroaromatic nitro compounds. correlation with molecular orbital energies and hydrophobicityã€‹</p><p><strong>Graph Kernel Datasetsæä¾›ä¸‹è½½</strong></p><h3 id="D-amp-D-PROTEIN"><a href="#D-amp-D-PROTEIN" class="headerlink" title="D&amp;D/PROTEIN"></a><strong>D&amp;D/PROTEIN</strong></h3><p>D&amp;Dåœ¨è›‹ç™½è´¨æ•°æ®åº“çš„éå†—ä½™å­é›†ä¸­æŠ½å–äº†äº†1178ä¸ªé«˜åˆ†è¾¨ç‡è›‹ç™½è´¨ï¼Œä½¿ç”¨ç®€å•çš„ç‰¹å¾ï¼Œå¦‚äºŒæ¬¡ç»“æ„å«é‡ã€æ°¨åŸºé…¸å€¾å‘ã€è¡¨é¢æ€§è´¨å’Œé…ä½“ï¼›å…¶ä¸­èŠ‚ç‚¹æ˜¯æ°¨åŸºé…¸ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»å°‘äº6åŸƒï¼ˆAngstromsï¼‰ï¼Œåˆ™ç”¨ä¸€æ¡è¾¹è¿æ¥ã€‚</p><p>PROTEINåˆ™æ˜¯å¦ä¸€ä¸ªè›‹ç™½è´¨ç½‘ç»œã€‚ä»»åŠ¡æ˜¯åˆ¤æ–­è¿™ç±»åˆ†å­æ˜¯å¦é…¶ç±»ã€‚<br><strong>D&amp;Dè®ºæ–‡ï¼š</strong>ã€ŠDistinguishing enzyme structures from non-enzymes without alignmentsã€‹<br><strong>D&amp;Dä¸‹è½½é“¾æ¥ï¼š</strong><a href="https://github.com/snap-stanford/GraphRNN/tree/master/dataset/DD">https://github.com/snap-stanford/GraphRNN/tree/master/dataset/DD</a></p><p><strong>PROTEINè®ºæ–‡ï¼š</strong>ã€ŠProtein function prediction via graph kernelsã€‹</p><p><strong>Graph Kernel Datasetsæä¾›ä¸‹è½½</strong></p><h3 id="PTC"><a href="#PTC" class="headerlink" title="PTC"></a><strong>PTC</strong></h3><p>PTCå…¨ç§°æ˜¯é¢„æµ‹æ¯’ç†å­¦æŒ‘æˆ˜ï¼Œç”¨æ¥å‘å±•å…ˆè¿›çš„SARæŠ€æœ¯é¢„æµ‹æ¯’ç†å­¦æ¨¡å‹ã€‚è¿™ä¸ªæ•°æ®é›†åŒ…å«äº†é’ˆå¯¹å•®é½¿åŠ¨ç‰©çš„è‡´ç™Œæ€§æ ‡è®°çš„åŒ–åˆç‰©ã€‚</p><p>æ ¹æ®å®éªŒçš„å•®é½¿åŠ¨ç‰©ç§ç±»ï¼Œä¸€å…±æœ‰4ä¸ªæ•°æ®é›†ï¼š</p><ul><li>PTC_FMï¼ˆé›Œæ€§å°é¼ ï¼‰</li><li>PTC_FRï¼ˆé›Œæ€§å¤§é¼ ï¼‰</li><li>PTC_MMï¼ˆé›„æ€§å°é¼ ï¼‰</li><li>PTC_MRï¼ˆé›„æ€§å¤§é¼ ï¼‰</li></ul><p><strong>PTCè®ºæ–‡ï¼š</strong>ã€ŠStatistical evaluation of the predictive toxicology challenge 2000-2001ã€‹</p><p><strong>Graph Kernel Datasetsæä¾›ä¸‹è½½</strong></p><h3 id="QM9"><a href="#QM9" class="headerlink" title="QM9"></a><strong>QM9</strong></h3><p>è¿™ä¸ªæ•°æ®é›†æœ‰133,885ä¸ªæœ‰æœºåˆ†å­ï¼ŒåŒ…å«å‡ ä½•ã€èƒ½é‡ã€ç”µå­ç­‰13ä¸ªç‰¹å¾ï¼Œæœ€å¤šæœ‰9ä¸ªéæ°¢åŸå­ï¼ˆé‡åŸå­ï¼‰ã€‚æ¥è‡ªGDB-17æ•°æ®åº“ã€‚</p><p><strong>QM9è®ºæ–‡ï¼š</strong>ã€ŠQuantum chemistry structures and properties of 134 kilo moleculesã€‹<br><strong>QM9ä¸‹è½½é“¾æ¥ï¼š</strong><a href="http://quantum-machine.org/datasets/">http://quantum-machine.org/datasets/</a></p><h3 id="Alchemy"><a href="#Alchemy" class="headerlink" title="Alchemy"></a><strong>Alchemy</strong></h3><p>AlchemyåŒ…å«119,487ä¸ªæœ‰æœºåˆ†å­ï¼Œå…¶æœ‰12ä¸ªé‡å­åŠ›å­¦ç‰¹å¾ï¼ˆquantum mechanical propertiesï¼‰ï¼Œæœ€å¤š14ä¸ªé‡åŸå­ï¼ˆheavy atomsï¼‰ï¼Œä»GDB MedChemæ•°æ®åº“ä¸­å–æ ·ã€‚æ‰©å±•äº†ç°æœ‰åˆ†å­æ•°æ®é›†å¤šæ ·æ€§å’Œå®¹é‡ã€‚</p><p><strong>Alchemyè®ºæ–‡ï¼š</strong>ã€ŠAlchemy: A quantum chemistry dataset for benchmarking ai modelsã€‹<br><strong>Alchemyä¸‹è½½é“¾æ¥ï¼š</strong><a href="https://alchemy.tencent.com/">https://alchemy.tencent.com/</a></p><table><thead><tr><th align="left"><strong>æ•°æ®é›†</strong></th><th align="left"><strong>å›¾æ•°</strong></th><th align="left"><strong>èŠ‚ç‚¹æ•°</strong></th><th align="left"><strong>è¾¹æ•°</strong></th><th align="left"><strong>ç‰¹å¾</strong></th><th align="left"><strong>æ ‡ç­¾</strong></th></tr></thead><tbody><tr><td align="left"><strong>PPI</strong></td><td align="left">24</td><td align="left">56,944</td><td align="left">818,716</td><td align="left">50</td><td align="left">121</td></tr><tr><td align="left"><strong>NCI-1</strong></td><td align="left">4110</td><td align="left">29.87</td><td align="left">32.30</td><td align="left">37</td><td align="left">2</td></tr><tr><td align="left"><strong>MUTAG</strong></td><td align="left">188</td><td align="left">17.93</td><td align="left">19.79</td><td align="left">7</td><td align="left">2</td></tr><tr><td align="left"><strong>D&amp;D</strong></td><td align="left">1178</td><td align="left">284.31</td><td align="left">715.65</td><td align="left">82</td><td align="left">2</td></tr><tr><td align="left"><strong>PROTEIN</strong></td><td align="left">1,113</td><td align="left">39.06</td><td align="left">72.81</td><td align="left">4</td><td align="left">2</td></tr><tr><td align="left"><strong>PTC_MR</strong></td><td align="left">344</td><td align="left">14.29</td><td align="left">14.69</td><td align="left">-</td><td align="left">2</td></tr><tr><td align="left"><strong>QM9</strong></td><td align="left">133,885</td><td align="left">-</td><td align="left">-</td><td align="left">-</td><td align="left">-</td></tr><tr><td align="left"><strong>Alchemy</strong></td><td align="left">119,487</td><td align="left">-</td><td align="left">-</td><td align="left">-</td><td align="left">-</td></tr></tbody></table><h2 id="ç¤¾äº¤ç½‘ç»œ"><a href="#ç¤¾äº¤ç½‘ç»œ" class="headerlink" title="ç¤¾äº¤ç½‘ç»œ"></a><strong>ç¤¾äº¤ç½‘ç»œ</strong></h2><h3 id="Reddit"><a href="#Reddit" class="headerlink" title="Reddit"></a><strong>Reddit</strong></h3><p>Redditæ•°æ®é›†æ˜¯ç”±æ¥è‡ªRedditè®ºå›çš„å¸–å­ç»„æˆï¼Œå¦‚æœä¸¤ä¸ªå¸–å­è¢«åŒä¸€äººè¯„è®ºï¼Œé‚£ä¹ˆåœ¨æ„å›¾çš„æ—¶å€™ï¼Œå°±è®¤ä¸ºè¿™ä¸¤ä¸ªå¸–å­æ˜¯ç›¸å…³è”çš„ï¼Œæ ‡ç­¾æ˜¯æ¯ä¸ªå¸–å­å¯¹åº”çš„ç¤¾åŒºåˆ†ç±»ã€‚</p><p><strong>Redditè®ºæ–‡ï¼š</strong>ã€ŠInductive representation learning on large graphsã€‹<br><strong>Redditä¸‹è½½é“¾æ¥ï¼š</strong><a href="https://github.com/linanqiu/reddit-dataset">https://github.com/linanqiu/reddit-dataset</a></p><h3 id="BlogCatalog"><a href="#BlogCatalog" class="headerlink" title="BlogCatalog"></a><strong>BlogCatalog</strong></h3><p>BlogCatalogæ•°æ®é›†æ˜¯ä¸€ä¸ªç¤¾ä¼šå…³ç³»ç½‘ç»œï¼Œå›¾æ˜¯ç”±åšä¸»åŠå…¶ç¤¾ä¼šå…³ç³»ï¼ˆæ¯”å¦‚å¥½å‹ï¼‰ç»„æˆï¼Œæ ‡ç­¾æ˜¯åšä¸»çš„å…´è¶£çˆ±å¥½ã€‚</p><p><strong>BlogCatalogè®ºæ–‡ï¼š</strong>ã€ŠRelational learning via latent social dimensionsã€‹<br><strong>BlogCatalogä¸‹è½½é“¾æ¥ï¼š</strong><a href="http://socialcomputing.asu.edu/datasets/BlogCatalog">http://socialcomputing.asu.edu/datasets/BlogCatalog</a></p><table><thead><tr><th align="left"><strong>æ•°æ®é›†</strong></th><th align="left"><strong>èŠ‚ç‚¹æ•°</strong></th><th align="left"><strong>è¾¹æ•°</strong></th><th align="left"><strong>ç‰¹å¾</strong></th><th align="left"><strong>æ ‡ç­¾</strong></th></tr></thead><tbody><tr><td align="left"><strong>Reddit</strong></td><td align="left">232965</td><td align="left">11606919</td><td align="left">602</td><td align="left">41</td></tr><tr><td align="left"><strong>BlogCatalog</strong></td><td align="left">10312</td><td align="left">333983</td><td align="left">-</td><td align="left">39</td></tr></tbody></table><h2 id="çŸ¥è¯†å›¾è°±"><a href="#çŸ¥è¯†å›¾è°±" class="headerlink" title="çŸ¥è¯†å›¾è°±"></a><strong>çŸ¥è¯†å›¾è°±</strong></h2><h3 id="FB13-FB15K-FB15K237"><a href="#FB13-FB15K-FB15K237" class="headerlink" title="FB13/FB15K/FB15K237"></a><strong>FB13/FB15K/FB15K237</strong></h3><p>è¿™ä¸‰ä¸ªæ•°æ®é›†æ˜¯Freebaseçš„å­é›†ã€‚å…¶ä¸­ï¼š</p><ul><li><strong>FB13</strong>ï¼šåŒ…å«13ç§å…³ç³»ã€75043ä¸ªå®ä½“ã€‚</li><li><strong>FB15K</strong>ï¼šåŒ…å«1345ç§å…³ç³»ã€14951ä¸ªå®ä½“</li><li><strong>FB15K237</strong>ï¼šåŒ…å«237ç§å…³ç³»ã€14951ä¸ªå®ä½“</li></ul><p>å¦‚æœå¸Œæœ›æ‰¾åˆ°entity idå¯¹åº”çš„å®ä½“æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ¸ é“ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰çš„å®ä½“éƒ½èƒ½æ‰¾åˆ°ï¼‰ï¼š</p><ul><li><a href="https://developers.google.com/freebase/#freebase-wikidata-mappings">https://developers.google.com/freebase/#freebase-wikidata-mappings</a></li><li><a href="http://sameas.org/">http://sameas.org/</a></li></ul><h3 id="WN11-WN18-WN18RR"><a href="#WN11-WN18-WN18RR" class="headerlink" title="WN11/WN18/WN18RR"></a><strong>WN11/WN18/WN18RR</strong></h3><p>è¿™ä¸‰ä¸ªæ˜¯WordNetçš„å­é›†ï¼š</p><ul><li><strong>WN11</strong>ï¼šåŒ…å«11ç§å…³ç³»ã€38696ä¸ªå®ä½“</li><li><strong>WN18</strong>ï¼šåŒ…å«18ç§å…³ç³»ã€40943ä¸ªå®ä½“</li><li><strong>WN18RR</strong>ï¼šåŒ…å«11ç§å…³ç³»ã€40943ä¸ªå®ä½“</li></ul><blockquote><p>ä¸ºäº†é¿å…åœ¨è¯„ä¼°æ¨¡å‹æ—¶å‡ºç°inverse relation test leakageï¼Œ<strong>å»ºè®®ä½¿ç”¨FB15K237/WN18RR</strong> æ¥æ›¿ä»£FB15K/WN18ã€‚æ›´å¤šå»ºè®®é˜…è¯»ã€ŠConvolutional 2D Knowledge Graph Embeddingsã€‹</p></blockquote><p><strong>FB15K/WN8è®ºæ–‡ï¼š</strong>ã€ŠTranslating Embeddings for Modeling Multi-relational Dataã€‹<br><strong>FB13/WN11è®ºæ–‡ï¼š</strong>ã€ŠReasoning With Neural Tensor Networks for Knowledge Base Completionã€‹<br><strong>WN18RRè®ºæ–‡ï¼š</strong>ã€ŠConvolutional 2D Knowledge Graph Embeddingsã€‹</p><p>ä»¥ä¸Š6ä¸ªçŸ¥è¯†å›¾è°±æ•°æ®é›†å‡å¯ä»è¿™é‡Œä¸‹è½½ï¼š<a href="https://github.com/thunlp/OpenKE/tree/master/benchmarks">https://github.com/thunlp/OpenKE/tree/master/benchmarks</a></p><table><thead><tr><th align="left"><strong>æ•°æ®é›†</strong></th><th align="left"><strong>å…³ç³»</strong></th><th align="left"><strong>å®ä½“æ•°</strong></th></tr></thead><tbody><tr><td align="left"><strong>FB13</strong></td><td align="left">13</td><td align="left">75043</td></tr><tr><td align="left"><strong>FB15K</strong></td><td align="left">1345</td><td align="left">14951</td></tr><tr><td align="left"><strong>FB15K237</strong></td><td align="left">237</td><td align="left">14951</td></tr><tr><td align="left"><strong>WN11</strong></td><td align="left">11</td><td align="left">38696</td></tr><tr><td align="left"><strong>WN18</strong></td><td align="left">18</td><td align="left">40943</td></tr><tr><td align="left"><strong>WN18RR</strong></td><td align="left">11</td><td align="left">40943</td></tr></tbody></table><h2 id="å¼€æºçš„æ•°æ®ä»“åº“"><a href="#å¼€æºçš„æ•°æ®ä»“åº“" class="headerlink" title="å¼€æºçš„æ•°æ®ä»“åº“"></a>å¼€æºçš„æ•°æ®ä»“åº“</h2><h3 id="Network-Repository"><a href="#Network-Repository" class="headerlink" title="Network Repository"></a><strong>Network Repository</strong></h3><p>å…·æœ‰äº¤äº’å¼å¯è§†åŒ–å’ŒæŒ–æ˜å·¥å…·çš„å›¾æ•°æ®ä»“åº“ã€‚å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç”¨è¡¨æ ¼çš„å½¢å¼å±•ç¤ºæ¯ä¸€ä¸ªå›¾æ•°æ®é›†çš„èŠ‚ç‚¹æ•°ã€éæ•°ã€å¹³å‡åº¦æ•°ã€æœ€å¤§åº¦æ•°ç­‰ã€‚</li><li>å¯è§†åŒ–å¯¹æ¯”å›¾æ•°æ®é›†ä¹‹é—´çš„å‚æ•°ã€‚</li><li>åœ¨çº¿GraphVisï¼Œå¯è§†åŒ–å›¾ç»“æ„å’Œè¯¦ç»†å‚æ•°ã€‚</li></ul><p><strong>é“¾æ¥ï¼š</strong><a href="http://networkrepository.com/">http://networkrepository.com</a></p><h3 id="Graph-Kernel-Datasets"><a href="#Graph-Kernel-Datasets" class="headerlink" title="Graph Kernel Datasets"></a><strong>Graph Kernel Datasets</strong></h3><p>å›¾æ ¸çš„åŸºå‡†æ•°æ®é›†ã€‚æä¾›äº†ä¸€ä¸ªè¡¨æ ¼ï¼Œå¯ä»¥å¿«é€Ÿå¾—åˆ°æ¯ä¸ªæ•°æ®é›†çš„èŠ‚ç‚¹æ•°é‡ã€ç±»åˆ«æ•°é‡ã€æ˜¯å¦æœ‰èŠ‚ç‚¹/è¾¹æ ‡ç­¾ã€èŠ‚ç‚¹/è¾¹ç‰¹å¾ã€‚</p><p><strong>é“¾æ¥ï¼š</strong><a href="https://ls11-www.cs.tu-dortmund.de/staff/morris/graphkerneldatasets">https://ls11-www.cs.tu-dortmund.de/staff/morris/graphkerneldatasets</a></p><h3 id="Relational-Dataset-Repository"><a href="#Relational-Dataset-Repository" class="headerlink" title="Relational Dataset Repository"></a><strong>Relational Dataset Repository</strong></h3><p>å…³ç³»æœºå™¨å­¦ä¹ çš„æ•°æ®é›†é›†åˆã€‚èƒ½å¤Ÿä»¥æ•°æ®é›†å¤§å°ã€é¢†åŸŸã€æ•°æ®ç±»å‹ç­‰æ¡ä»¶æ¥æ£€ç´¢æ•°æ®é›†ã€‚</p><p><strong>é“¾æ¥ï¼š</strong><a href="https://relational.fit.cvut.cz/">https://relational.fit.cvut.cz</a></p><h3 id="Stanford-Large-Network-Dataset-Collection"><a href="#Stanford-Large-Network-Dataset-Collection" class="headerlink" title="Stanford Large Network Dataset Collection"></a><strong>Stanford Large Network Dataset Collection</strong></h3><p>SNAPåº“åŒ…å«äº†ä¸€ä¸ªå¤§å‹å›¾ç½‘ç»œæ•°æ®é›†é›†åˆï¼Œæ‹¥æœ‰å¤§å‹ç¤¾äº¤ã€ä¿¡æ¯ç½‘ç»œã€‚åŒ…æ‹¬ï¼šå›¾åˆ†ç±»æ•°æ®åº“ã€ç¤¾äº¤ç½‘ç»œã€å¼•ç”¨ç½‘ç»œã€äºšé©¬é€Šç½‘ç»œç­‰ç­‰ï¼Œéå¸¸ä¸°å¯Œã€‚</p><p><strong>é“¾æ¥ï¼š</strong><a href="https://snap.stanford.edu/data/">https://snap.stanford.edu/data/</a></p><h3 id="Open-Graph-Benchmark"><a href="#Open-Graph-Benchmark" class="headerlink" title="Open Graph Benchmark"></a><strong>Open Graph Benchmark</strong></h3><p>OGBæ˜¯çœŸå®åŸºå‡†æ•°æ®é›†çš„é›†åˆï¼ŒåŒæ—¶æä¾›æ•°æ®åŠ è½½å™¨å’Œè¯„ä¼°å™¨ï¼ˆPyTorchï¼‰ã€‚å¯ä»¥è‡ªåŠ¨ä¸‹è½½ã€å¤„ç†å’Œåˆ‡å‰²ï¼›å®Œå…¨å…¼å®¹PyGå’ŒDGLã€‚</p><p><strong>é“¾æ¥ï¼š</strong><a href="https://ogb.stanford.edu/">https://ogb.stanford.edu/</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€æ”¾æ•°æ® </tag>
            
            <tag> å›¾ç¥ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡ ç§å¸¸è§æ¿€æ´»å‡½æ•°</title>
      <link href="/2020/09/10/ji-huo-han-shu/"/>
      <url>/2020/09/10/ji-huo-han-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡ ç§å¸¸è§æ¿€æ´»å‡½æ•°"><a href="#å‡ ç§å¸¸è§æ¿€æ´»å‡½æ•°" class="headerlink" title="å‡ ç§å¸¸è§æ¿€æ´»å‡½æ•°"></a>å‡ ç§å¸¸è§æ¿€æ´»å‡½æ•°</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦æ¿€æ´»å‡½æ•°"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ¿€æ´»å‡½æ•°" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ¿€æ´»å‡½æ•°"></a>ä¸ºä»€ä¹ˆéœ€è¦æ¿€æ´»å‡½æ•°</h2><ul><li><strong>éçº¿æ€§:</strong> é¦–å…ˆ,çº¿æ€§å‡½æ•°å¯ä»¥é«˜æ•ˆå¯é å¯¹æ•°æ®è¿›è¡Œæ‹Ÿåˆ, ä½†æ˜¯ç°å®ç”Ÿæ´»ä¸­å¾€å¾€å­˜åœ¨ä¸€äº›éçº¿æ€§çš„é—®é¢˜(å¦‚XOR), è¿™ä¸ªæ—¶å€™, æˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©æ¿€æ´»å‡½æ•°çš„éçº¿æ€§æ¥å¯¹æ•°æ®çš„åˆ†å¸ƒè¿›è¡Œé‡æ–°æ˜ å°„, ä»è€Œè·å¾—æ›´å¼ºå¤§çš„æ‹Ÿåˆèƒ½åŠ›. (è¿™ä¸ªæ˜¯æœ€ä¸»è¦çš„åŸå› , å…¶ä»–è¿˜æœ‰ä¸‹é¢è¿™äº›æ€§è´¨ä¹Ÿä½¿å¾—æˆ‘ä»¬é€‰æ‹©æ¿€æ´»å‡½æ•°ä½œä¸ºç½‘ç»œå¸¸ç”¨å±‚)</li><li><strong>å¯å¾®æ€§:</strong> è¿™ä¸€ç‚¹æœ‰åŠ©äºæˆ‘ä»¬ä½¿ç”¨æ¢¯åº¦ä¸‹é™å‘æ¥å¯¹ç½‘ç»œè¿›è¡Œä¼˜åŒ–</li><li><strong>å•è°ƒæ€§:</strong> æ¿€æ´»å‡½æ•°çš„å•è°ƒæ€§åœ¨å¯ä»¥ä½¿å•å±‚ç½‘ç»œä¿è¯ç½‘ç»œæ˜¯å‡¸ä¼˜åŒ–çš„</li><li><strong>f(x)â‰ˆx</strong>: å½“æ¿€æ´»æ»¡è¶³è¿™ä¸ªæ€§è´¨çš„æ—¶å€™, å¦‚æœå‚æ•°åˆå€¼æ˜¯å¾ˆå°çš„å€¼, é‚£ä¹ˆç¥ç»ç½‘ç»œçš„è®­ç»ƒå°†ä¼šå¾ˆé«˜æ•ˆ(å‚è€ƒResNetè®­ç»ƒæ®‹å·®æ¨¡å—çš„æ’ç­‰æ˜ å°„); å¦‚æœä¸æ»¡è¶³è¿™ä¸ªæ€§è´¨, é‚£ä¹ˆå°±éœ€è¦ç”¨å¿ƒçš„è®¾å€¼åˆå§‹å€¼( <strong>è¿™ä¸€æ¡æœ‰å¾…å•†æ¦·</strong> )</li></ul><h2 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h2><h3 id="Sigmoid"><a href="#Sigmoid" class="headerlink" title="Sigmoid"></a>Sigmoid</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>Sigmoidå‡½æ•°çš„è¾“å‡ºæ˜ å°„åœ¨**(0,1)**ä¹‹é—´ï¼Œå•è°ƒè¿ç»­ï¼Œè¾“å‡ºèŒƒå›´æœ‰é™ï¼Œå¦‚æœæ˜¯éå¸¸å¤§çš„è´Ÿæ•°ï¼Œé‚£ä¹ˆè¾“å‡ºå°±æ˜¯0ï¼›å¦‚æœæ˜¯éå¸¸å¤§çš„æ­£æ•°ï¼Œè¾“å‡ºå°±æ˜¯1ã€‚ä¼˜åŒ–ç¨³å®šï¼Œå¯ä»¥ç”¨ä½œè¾“å‡ºå±‚ã€‚</li><li>æ±‚å¯¼å®¹æ˜“ã€‚</li><li>sigmoid å‡½æ•°æ›¾ç»è¢«ä½¿ç”¨çš„å¾ˆå¤šï¼Œä¸è¿‡è¿‘å¹´æ¥ï¼Œç”¨å®ƒçš„äººè¶Šæ¥è¶Šå°‘äº†ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>å®¹æ˜“é¥±å’Œå’Œç»ˆæ­¢æ¢¯åº¦ä¼ é€’(â€œæ­»ç¥ç»å…ƒâ€)ï¼›</li><li>sigmoidå‡½æ•°çš„è¾“å‡ºæ²¡æœ‰0ä¸­å¿ƒåŒ–ã€‚</li></ol><h3 id="åŒæ›²æ­£åˆ‡å‡½æ•°ï¼ˆTanhï¼‰"><a href="#åŒæ›²æ­£åˆ‡å‡½æ•°ï¼ˆTanhï¼‰" class="headerlink" title="åŒæ›²æ­£åˆ‡å‡½æ•°ï¼ˆTanhï¼‰"></a>åŒæ›²æ­£åˆ‡å‡½æ•°ï¼ˆTanhï¼‰</h3><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ol><li>æ¯”Sigmoidå‡½æ•°æ”¶æ•›é€Ÿåº¦æ›´å¿«ã€‚</li><li>ç›¸æ¯”Sigmoidå‡½æ•°ï¼Œå…¶è¾“å‡ºä»¥0ä¸ºä¸­å¿ƒã€‚</li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š</p><p>è¿˜æ˜¯æ²¡æœ‰æ”¹å˜Sigmoidå‡½æ•°çš„æœ€å¤§é—®é¢˜â€”â€”ç”±äºé¥±å’Œæ€§äº§ç”Ÿçš„æ¢¯åº¦æ¶ˆå¤±ã€‚</p><h3 id="ä¿®æ­£çº¿æ€§å•å…ƒï¼ˆRectified-linear-unitï¼ŒReLUï¼‰"><a href="#ä¿®æ­£çº¿æ€§å•å…ƒï¼ˆRectified-linear-unitï¼ŒReLUï¼‰" class="headerlink" title="ä¿®æ­£çº¿æ€§å•å…ƒï¼ˆRectified linear unitï¼ŒReLUï¼‰"></a>ä¿®æ­£çº¿æ€§å•å…ƒï¼ˆRectified linear unitï¼ŒReLUï¼‰</h3><p><strong>ç‚¹</strong>ï¼š</p><p>1.ç›¸æ¯”èµ·Sigmoidå’Œtanhï¼ŒReLUåœ¨SGDä¸­èƒ½å¤Ÿå¿«é€Ÿæ”¶æ•›ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçº¿æ€§ï¼ˆlinearï¼‰ã€éé¥±å’Œï¼ˆnon-saturatingï¼‰çš„å½¢å¼ã€‚</p><p>2.Sigmoidå’Œtanhæ¶‰åŠäº†å¾ˆå¤šå¾ˆexpensiveçš„æ“ä½œï¼ˆæ¯”å¦‚æŒ‡æ•°ï¼‰ï¼ŒReLUå¯ä»¥æ›´åŠ ç®€å•çš„å®ç°ã€‚</p><p>3.æœ‰æ•ˆç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚</p><p>4.åœ¨æ²¡æœ‰æ— ç›‘ç£é¢„è®­ç»ƒçš„æ—¶å€™ä¹Ÿèƒ½æœ‰è¾ƒå¥½çš„è¡¨ç°ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ol><li>æ²¡æœ‰è¾¹ç•Œï¼Œå¯ä»¥ä½¿ç”¨å˜ç§ReLU: min(max(0,x), 6)</li><li>æ¯”è¾ƒè„†å¼±ï¼Œæ¯”è¾ƒå®¹æ˜“é™·å…¥å‡ºç°â€æ­»ç¥ç»å…ƒâ€çš„æƒ…å†µ</li></ol><p>â€¢ è§£å†³æ–¹æ¡ˆï¼š è¾ƒå°çš„å­¦ä¹ ç‡</p><h2 id="æ¿€æ´»å‡½æ•°çš„ä½¿ç”¨åŸåˆ™"><a href="#æ¿€æ´»å‡½æ•°çš„ä½¿ç”¨åŸåˆ™" class="headerlink" title="æ¿€æ´»å‡½æ•°çš„ä½¿ç”¨åŸåˆ™"></a>æ¿€æ´»å‡½æ•°çš„ä½¿ç”¨åŸåˆ™</h2><ol><li>ä¼˜å…ˆä½¿ç”¨ReLU, åŒæ—¶è¦è°¨æ…è®¾ç½®åˆå€¼å’Œå­¦ä¹ ç‡ ( å®é™…æ“ä½œä¸­ï¼Œå¦‚æœä½ çš„learning rate å¾ˆå¤§ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ä½ ç½‘ç»œä¸­çš„40%çš„ç¥ç»å…ƒéƒ½ â€œdeadâ€ äº†ã€‚ å½“ç„¶ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸€ä¸ªåˆé€‚çš„è¾ƒå°çš„learning rateï¼Œè¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„æƒ…å†µå…¶å®ä¹Ÿä¸ä¼šå¤ªé¢‘ç¹ )</li><li>å°è¯•ä½¿ç”¨LeakyReLU/PReLU/Maxout/ELUç­‰æ¿€æ´»å‡½æ•°</li><li>å¯ä»¥è¯•ä¸‹tanh, ä½†æ˜¯ä¸€èˆ¬ä¸ä¼šæœ‰å¤ªå¥½çš„ç»“æœ</li><li><strong>ä¸è¦ä½¿ç”¨sigmoid</strong></li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡æ³¨ç²¾çµ</title>
      <link href="/2020/09/07/biao-zhu-jing-ling/"/>
      <url>/2020/09/07/biao-zhu-jing-ling/</url>
      
        <content type="html"><![CDATA[<h1 id="æ ‡æ³¨ç²¾çµï¼ˆubantuï¼‰"><a href="#æ ‡æ³¨ç²¾çµï¼ˆubantuï¼‰" class="headerlink" title="æ ‡æ³¨ç²¾çµï¼ˆubantuï¼‰"></a>æ ‡æ³¨ç²¾çµï¼ˆubantuï¼‰</h1><ul><li><p>ä¸‹è½½æ ‡æ³¨ç²¾çµ</p><p><a href="http://www.jinglingbiaozhu.com/">http://www.jinglingbiaozhu.com/</a></p></li><li><p>åœ¨å‘½ä»¤è¡Œä¸Š</p><p>chmod a+x â€œè½¯ä»¶â€</p></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> lniux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ngnix Flask é«˜å¹¶å‘éƒ¨ç½²æ–¹æ¡ˆè¯¦ç»†æ•™ç¨‹ï¼</title>
      <link href="/2020/09/06/ngnix/"/>
      <url>/2020/09/06/ngnix/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h3><p>è™½ç„¶æ ‡é¢˜å†™çš„æ˜¯ Flaskï¼Œä½†æ˜¯ä¸‹é¢è¿™ä¸ªæ•™ç¨‹ä¸ä»…ä»…åªé€‚ç”¨äº Flask, è¿˜é€‚ç”¨äºå…¶ä»–Python web æ¡†æ¶ï¼Œè®°å¾—å¸®å¿™ç‚¹èµï¼</p><p>ä¼—æ‰€å‘¨çŸ¥ Flask æ˜¯ä¸€ä¸ªåŒæ­¥çš„æ¡†æ¶ï¼Œå¤„ç†è¯·æ±‚çš„æ—¶å€™æ˜¯ä»¥å•è¿›ç¨‹çš„æ–¹å¼ï¼Œå½“åŒæ—¶è®¿é—®çš„äººæ•°è¿‡å¤šæ—¶ï¼ŒFlask æœåŠ¡å°±ä¼šå‡ºç°é˜»å¡çš„æƒ…å†µã€‚</p><p>å°±åƒæˆ‘ä»¬ä¹°ç«è½¦ç¥¨ä¸€æ ·ï¼Œå½“ä¹°ç«è½¦ç¥¨çš„äººå¤šçš„æ—¶å€™ï¼Œæ’é˜Ÿçš„äººå°±ä¼šå¾ˆå¤šï¼Œé˜Ÿä¼å°±ä¼šå¾ˆé•¿ï¼Œç›¸åº”çš„ç­‰å¾…çš„æ—¶é—´ä¼šå˜å¾—å¾ˆé•¿ï¼</p><p>å› æ­¤ Flask, Djangoï¼Œwebpy ç­‰æ¡†æ¶è‡ªå¸¦çš„ web server æ€§èƒ½éƒ½å¾ˆå·®ï¼Œåªèƒ½ç”¨æ¥åšæµ‹è¯•ç”¨é€”ï¼Œçº¿ä¸Šå‘å¸ƒåˆ™éœ€è¦é€‰æ‹©æ›´é«˜æ€§èƒ½çš„ wsgi server ã€‚è¿™é‡Œæ¨èçš„éƒ¨ç½²æ–¹å¼ï¼šnginx + gunicorn + flask + supervisor</p><p>å…¶ä¸­æ¯ä¸ªæœåŠ¡ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>Nginxï¼šé«˜æ€§èƒ½ Web æœåŠ¡å™¨+è´Ÿè½½å‡è¡¡ï¼›</li><li>gunicornï¼šé«˜æ€§èƒ½ WSGI æœåŠ¡å™¨ï¼›</li><li>geventï¼šæŠŠ Python åŒæ­¥ä»£ç å˜æˆå¼‚æ­¥åç¨‹çš„åº“ï¼›</li><li>Supervisorï¼šç›‘æ§æœåŠ¡è¿›ç¨‹çš„å·¥å…·ï¼›</li></ul><h3 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a><strong>Gunicorn</strong></h3><p>Gunicorn å¯ä»¥æŒ‡å®šå¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼Œæœ‰å¤šç§å·¥ä½œæ¨¡å¼å¯ä»¥ä¾›ä½ é€‰æ‹©ã€‚é»˜è®¤æ˜¯åŒæ­¥çš„ sync å·¥ä½œæ¨¡å¼ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ gevent, tronado, gthread, gaiohttp ç­‰ã€‚</p><p>è¿™é‡Œæ¨è gevent, gevent æ˜¯ä¸€ä¸ªåŸºäº Greenlet åº“ï¼Œåˆ©ç”¨ python åç¨‹æ¥å®ç°ï¼Œè¿™æ ·ä½ çš„ web æœåŠ¡æ‰èƒ½å®ç°å¹¶å‘çš„åŠŸèƒ½ï¼</p><p>gunicorn æ˜¯ä¸€ä¸ª python Wsgi http serverï¼Œåªæ”¯æŒåœ¨ Unix ç³»ç»Ÿä¸Šè¿è¡Œï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç†Ÿæ‚‰ä¸€ä¸‹ä»¥ gunicorn çš„é…ç½®ä¸ä½¿ç”¨ã€‚</p><h3 id="gunicorn-çš„å®‰è£…"><a href="#gunicorn-çš„å®‰è£…" class="headerlink" title="gunicorn çš„å®‰è£…"></a>gunicorn çš„å®‰è£…</h3><p>æ³¨æ„ gunicorn ä¸èƒ½åœ¨ windows ç¯å¢ƒä¸‹ä½¿ç”¨</p><blockquote><p>pip install gunicorn</p></blockquote><p>æ¯”å¦‚æœ‰ä»¥ä¸‹ä¸€ä¸ª app çš„ py æ–‡ä»¶</p><pre><code> from flask import Flask   app = Flask(__name__)   @app.route('/')   def index():       return 'hello world!' if __name__ == '__main__':      app.run()   </code></pre><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨ flask çš„é¡¹ç›®çš„ç›®å½•ä¸‹å¦‚ä½•ä½¿ç”¨ gunicorn æ¥å¯åŠ¨å‘¢?<br>å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>gunicorn -w 4 -b 0.0.0.0:8000 app:app</code></pre><p>å…¶ä¸­ï¼š<br>ç¬¬ä¸€ä¸ª app æŒ‡çš„æ˜¯ app.py æ–‡ä»¶ï¼›<br>ç¬¬äºŒä¸ªæŒ‡çš„æ˜¯ç¬¬ä¸‰è¡Œä»£ç  flask åº”ç”¨çš„åå­—ã€‚</p><h3 id="gunicorn-çš„å‚æ•°è¯¦è§£"><a href="#gunicorn-çš„å‚æ•°è¯¦è§£" class="headerlink" title="gunicorn çš„å‚æ•°è¯¦è§£"></a>gunicorn çš„å‚æ•°è¯¦è§£</h3><p>é€šè¿‡ gunicorn -h æˆ‘ä»¬å¯ä»¥çœ‹åˆ° gunicorn æœ‰éå¸¸å¤šçš„é…ç½®é¡¹ï¼Œæˆ‘å°†ä»–ä»¬çš„å‚æ•°é…ç½®é¡¹éƒ½åˆ—å‡ºæ¥äº†ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š</p><pre><code> -c CONFIG : CONFIG,é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨ï¼›ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼› -b ADDRESS : ADDRESSï¼ŒipåŠ ç«¯å£ï¼Œç»‘å®šè¿è¡Œçš„ä¸»æœºï¼› -w INT,  --workers INTï¼šç”¨äºå¤„ç†å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸ºæ­£æ•´æ•°ï¼Œé»˜è®¤ä¸º1ï¼› -k STRTING, --worker-class STRTINGï¼šè¦ä½¿ç”¨çš„å·¥ä½œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºsyncå¼‚æ­¥ï¼Œå¯ä»¥ä¸‹è½½eventletå’Œgeventå¹¶æŒ‡å®š --threads INTï¼šå¤„ç†è¯·æ±‚çš„å·¥ä½œçº¿ç¨‹æ•°ï¼Œä½¿ç”¨æŒ‡å®šæ•°é‡çš„çº¿ç¨‹è¿è¡Œæ¯ä¸ªworkerã€‚ä¸ºæ­£æ•´æ•°ï¼Œé»˜è®¤ä¸º1ã€‚--worker-connections INTï¼šæœ€å¤§å®¢æˆ·ç«¯å¹¶å‘æ•°é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼ä¸º1000ã€‚--backlog intï¼šæœªå†³è¿æ¥çš„æœ€å¤§æ•°é‡ï¼Œå³ç­‰å¾…æœåŠ¡çš„å®¢æˆ·çš„æ•°é‡ã€‚é»˜è®¤2048ä¸ªï¼Œä¸€èˆ¬ä¸ä¿®æ”¹ï¼›-p FILE, --pid FILEï¼šè®¾ç½®pidæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦‚æœä¸è®¾ç½®å°†ä¸ä¼šåˆ›å»ºpidæ–‡ä»¶--access-logfile FILE ï¼š è¦å†™å…¥çš„è®¿é—®æ—¥å¿—ç›®å½•--access-logformat STRINGï¼šè¦å†™å…¥çš„è®¿é—®æ—¥å¿—æ ¼å¼--error-logfile FILE, --log-file FILE ï¼š  è¦å†™å…¥é”™è¯¯æ—¥å¿—çš„æ–‡ä»¶ç›®å½•ã€‚--log-level LEVEL ï¼š  é”™è¯¯æ—¥å¿—è¾“å‡ºç­‰çº§ã€‚--limit-request-line INT ï¼š HTTPè¯·æ±‚å¤´çš„è¡Œæ•°çš„æœ€å¤§å¤§å°ï¼Œæ­¤å‚æ•°ç”¨äºé™åˆ¶HTTPè¯·æ±‚è¡Œçš„å…è®¸å¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ä¸º4094ã€‚å€¼æ˜¯0~8190çš„æ•°å­—ã€‚--limit-request-fields INT ï¼š é™åˆ¶HTTPè¯·æ±‚ä¸­è¯·æ±‚å¤´å­—æ®µçš„æ•°é‡ã€‚æ­¤å­—æ®µç”¨äºé™åˆ¶è¯·æ±‚å¤´å­—æ®µçš„æ•°é‡ä»¥é˜²æ­¢DDOSæ”»å‡»ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ä¸º100ï¼Œè¿™ä¸ªå€¼ä¸èƒ½è¶…è¿‡32768--limit-request-field-size INT ï¼š é™åˆ¶HTTPè¯·æ±‚ä¸­è¯·æ±‚å¤´çš„å¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼ä¸º8190å­—èŠ‚ã€‚å€¼æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–è€…0ï¼Œå½“è¯¥å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºå°†å¯¹è¯·æ±‚å¤´å¤§å°ä¸åšé™åˆ¶-t INT, --timeout INTï¼šè¶…è¿‡è¿™ä¹ˆå¤šç§’åå·¥ä½œå°†è¢«æ€æ‰ï¼Œå¹¶é‡æ–°å¯åŠ¨ã€‚ä¸€èˆ¬è®¾å®šä¸º30ç§’ï¼›--daemonï¼šæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ï¼Œé»˜è®¤falseï¼›--chdir ï¼šåœ¨åŠ è½½åº”ç”¨ç¨‹åºä¹‹å‰åˆ‡æ¢ç›®å½•ï¼›--graceful-timeout INTï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ä¸º30ï¼Œåœ¨è¶…æ—¶(ä»æ¥æ”¶åˆ°é‡å¯ä¿¡å·å¼€å§‹)ä¹‹åä»ç„¶æ´»ç€çš„å·¥ä½œå°†è¢«å¼ºè¡Œæ€æ­»ï¼›ä¸€èˆ¬ä½¿ç”¨é»˜è®¤ï¼›--keep-alive INTï¼šåœ¨keep-aliveè¿æ¥ä¸Šç­‰å¾…è¯·æ±‚çš„ç§’æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹å€¼ä¸º2ã€‚ä¸€èˆ¬è®¾å®šåœ¨1~5ç§’ä¹‹é—´ã€‚--reloadï¼šé»˜è®¤ä¸ºFalseã€‚æ­¤è®¾ç½®ç”¨äºå¼€å‘ï¼Œæ¯å½“åº”ç”¨ç¨‹åºå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œéƒ½ä¼šå¯¼è‡´å·¥ä½œé‡æ–°å¯åŠ¨ã€‚--spewï¼šæ‰“å°æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„æ¯ä¸€æ¡è¯­å¥ï¼Œé»˜è®¤Falseã€‚æ­¤é€‰æ‹©ä¸ºåŸå­æ€§çš„ï¼Œå³è¦ä¹ˆå…¨éƒ¨æ‰“å°ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰“å°ï¼›--check-config ï¼šæ˜¾ç¤ºç°åœ¨çš„é…ç½®ï¼Œé»˜è®¤å€¼ä¸ºFalseï¼Œå³æ˜¾ç¤ºã€‚-e ENV,  --env ENVï¼š è®¾ç½®ç¯å¢ƒå˜é‡ï¼›</code></pre><p>æ˜¯ä¸æ˜¯è§‰å¾— gunicorn çš„å‚æ•°å¾ˆå¤šï¼Ÿåœ¨éƒ¨ç½²çš„æ—¶å€™å¦‚æœè¾“å…¥è¿™ä¹ˆå¤§ä¸€ä¸²å‘½ä»¤ï¼Œæˆ‘ç›¸ä¿¡å°±ç®—æ˜¯å¯¹å‚æ•°å¾ˆç†Ÿæ‚‰çš„äººï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šè¾“é”™ï¼</p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´æ–¹ä¾¿çš„æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶ï¼é‚£å°±æ˜¯ç”¨ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨ã€‚</p><h3 id="ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨"><a href="#ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨" class="headerlink" title="ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨"></a>ä»¥é…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨</h3><p>ä¸€èˆ¬è¿™ä¸ªé…ç½®æ–‡ä»¶åæ˜¯ gunicorn.conf.py æˆ–è€… config.pyã€‚å…¶ä¸­éƒ¨åˆ†ä»£ç å¦‚ä¸‹:</p><pre><code> # å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•° workers = 4 # æŒ‡å®šæ¯ä¸ªå·¥ä½œè€…çš„çº¿ç¨‹æ•° threads = 2 # ç«¯å£ 5000 bind = '0.0.0.0:5000'# è®¾ç½®å®ˆæŠ¤è¿›ç¨‹,å°†è¿›ç¨‹äº¤ç»™supervisorç®¡ç†daemon = 'false'# å·¥ä½œæ¨¡å¼åç¨‹worker_class = 'gevent'# è®¾ç½®æœ€å¤§å¹¶å‘é‡worker_connections = 2000# è®¾ç½®è¿›ç¨‹æ–‡ä»¶ç›®å½•pidfile = '/var/run/gunicorn.pid'# è®¾ç½®è®¿é—®æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯æ—¥å¿—è·¯å¾„accesslog = "log/access.log"errorlog = "log/debug.log"loglevel = "debug"# è®¾ç½®æ—¥å¿—è®°å½•æ°´å¹³loglevel = 'warning'</code></pre><p>ä»£ç é‡Œé¢çš„æ³¨é‡Šéƒ½å¾ˆè¯¦ç»†äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å‡ ç‚¹éœ€è¦è¯´æ˜çš„ï¼š</p><h4 id="1-æ—¥å¿—"><a href="#1-æ—¥å¿—" class="headerlink" title="1.æ—¥å¿—"></a>1.æ—¥å¿—</h4><p>é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>éœ€è¦logç›®å½•å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå¯åŠ¨ä¼šæŠ¥é”™</li><li>accesslog æ˜¯è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡ access_log_format è®¾ç½®è®¿é—®æ—¥å¿—æ ¼å¼</li><li>loglevel ç”¨äºæ§åˆ¶ errorlog çš„ä¿¡æ¯çº§åˆ«</li></ul><p>ä¸è¿‡æ›´å»ºè®®ä½¿ç”¨ logging æ¨¡å—æ¥ç®¡ç†æ—¥å¿—</p><h4 id="2-workers"><a href="#2-workers" class="headerlink" title="2. workers"></a>2. workers</h4><ul><li>worker_class æ˜¯æŒ‡å¼€å¯çš„æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æ¨¡å¼ç±»å‹ï¼Œé»˜è®¤ä¸º sync æ¨¡å¼ï¼Œè¿™ä¸ªä½¿ç”¨ gevent æ¨¡å¼ï¼Œgevent æ˜¯ python çš„ä¸€ä¸ªé«˜å¹¶å‘åº“</li><li>workers æ˜¯å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•° ï¼Œåœ¨ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­ï¼Œå–çš„æ˜¯æœåŠ¡å™¨çš„ CPUçš„æ•°é‡ã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ•°å­—ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜è¦æ³¨æ„éƒ¨ç½²æœºå™¨çš„æ€§èƒ½ï¼Œä¸èƒ½æ— é™åˆ¶å¤šå¼€ã€‚ä¸€èˆ¬æ˜¯æ ¹æ®æœåŠ¡å™¨çš„ CPUæ ¸å¿ƒæ•°æ¥ç¡®å®šçš„ï¼</li><li>workers = multiprocessing * cpu_count() * 2 + 1</li></ul><p>é…ç½®æ–‡ä»¶æå®šä¹‹åï¼Œå¯åŠ¨å‘½ä»¤å°±å¾ˆç®€å•äº†ã€‚å¯åŠ¨ gunicorn å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>gunicorn -c gunicorn.conf app:app</code></pre><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a><strong>Nginx</strong></h3><p>Nginx å®é™…ä¸Šåªèƒ½å¤„ç†é™æ€èµ„æºè¯·æ±‚ï¼Œé‚£ä¹ˆå¯¹äºåŠ¨æ€è¯·æ±‚æ€ä¹ˆåšå‘¢ã€‚è¿™å°±éœ€è¦ç”¨åˆ° Nginx çš„ <code>upstream</code> æ¨¡å—å¯¹è¿™äº›è¯·æ±‚è¿›è¡Œè½¬å‘ï¼Œå³åå‘ä»£ç†ã€‚Nginx åœ¨è¿™é‡Œä¸»è¦æ˜¯ç”¨æ¥åšè´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶å®ƒèƒ½ç¼“å­˜ä¸€äº›åŠ¨æ€å†…å®¹</p><h3 id="å®‰è£…-nginx"><a href="#å®‰è£…-nginx" class="headerlink" title="å®‰è£… nginx"></a><strong>å®‰è£… nginx</strong></h3><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class=" language-text"><code class="language-text">sudo apt-get install nginx</code></pre><p>nginx å®‰è£…å®Œåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ§åˆ¶ nginx çš„å¼€å¯å’Œå…³é—­</p><pre class=" language-text"><code class="language-text">sudo /etc/init.d/nginx restart // é‡å¯sudo /etc/init.d/nginx start å¼€å¯sudo /etc/init.d/nginx stop å…³é—­</code></pre><h3 id="centoså®‰è£…"><a href="#centoså®‰è£…" class="headerlink" title="centoså®‰è£…"></a>centoså®‰è£…</h3><pre class=" language-shell"><code class="language-shell">#å®‰è£…nginxå‰é¦–å…ˆè¦ç¡®è®¤ç³»ç»Ÿä¸­å®‰è£…äº†gccã€pcre-develã€zlib-develã€openssl-develyum -y install gcc pcre-devel zlib-devel openssl openssl-devel</code></pre><p>nginxä¸‹è½½åœ°å€ï¼š<a href="https://nginx.org/download/">https://nginx.org/download/</a></p><pre class=" language-shell"><code class="language-shell">## è§£å‹tar -zxvf nginx-1.9.9.tar.gz##è¿›å…¥nginxç›®å½•cd nginx-1.9.9## é…ç½®./configure --prefix=/usr/local/nginx# makemakemake install# æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ# cdåˆ°åˆšæ‰é…ç½®çš„å®‰è£…ç›®å½•/usr/loca/nginx/./sbin/nginx -t</code></pre><p>6996#0: open() â€œ/usr/local/nginx/logs/access.logâ€ failed (2: No such file or directory)</p><p>åŸå› åˆ†æï¼šnginx/ç›®å½•ä¸‹æ²¡æœ‰logsæ–‡ä»¶å¤¹</p><p>è§£å†³æ–¹æ³•ï¼š</p><pre class=" language-shell"><code class="language-shell">mkdir logschmod 700 logs</code></pre><p>æ­£å¸¸æƒ…å†µçš„ä¿¡æ¯è¾“å‡ºï¼š</p><p>nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</p><p>å¯åŠ¨nginx </p><pre class=" language-shell"><code class="language-shell">cd /usr/local/nginx/sbin./nginx //å¯åŠ¨nginx</code></pre><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥æœåŠ¡å™¨çš„ipåœ°å€ï¼Œå¦‚ï¼š192.168.1.12</p><pre class=" language-shell"><code class="language-shell">ping 192.168.1.12</code></pre><p>[error] invalid PID number â€œâ€ in â€œ/usr/local/nginx/logs/nginx.pidâ€</p><p>è§£å†³æ–¹æ³•ï¼šç”¨æŒ‡å®šæ–‡ä»¶åŠ è½½nginxé…ç½®æ–‡ä»¶<br>[root@localhost nginx]/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</p><h3 id="é…ç½®-nginx"><a href="#é…ç½®-nginx" class="headerlink" title="é…ç½® nginx"></a><strong>é…ç½® nginx</strong></h3><p>Nginx é…ç½®æ–‡ä»¶ä½äº /usr/local/nginx/conf/nginx.conf</p><h4 id="éƒ¨ç½²å•ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶"><a href="#éƒ¨ç½²å•ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶" class="headerlink" title="éƒ¨ç½²å•ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶"></a>éƒ¨ç½²å•ä¸ªåº”ç”¨çš„é…ç½®æ–‡ä»¶</h4><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token keyword">listen</span>     <span class="token number">8080</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç›‘å¬8080ç«¯å£,å¯ä»¥è‡ªè¡Œé…ç½®</span>    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># é…ç½®åŸŸå</span>    <span class="token comment" spellcheck="true"># åŠ¨æ€è¯·æ±‚è½¬å‘åˆ° 9600 ç«¯å£(gunicorn):</span>    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token keyword">proxy_pass</span>   <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">9600</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_read_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_send_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><h4 id="é…ç½®å¤šä¸ªåº”ç”¨çš„é…ç½®ä¿¡æ¯"><a href="#é…ç½®å¤šä¸ªåº”ç”¨çš„é…ç½®ä¿¡æ¯" class="headerlink" title="é…ç½®å¤šä¸ªåº”ç”¨çš„é…ç½®ä¿¡æ¯"></a>é…ç½®å¤šä¸ªåº”ç”¨çš„é…ç½®ä¿¡æ¯</h4><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token keyword">listen</span>     <span class="token number">8080</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># ç›‘å¬8080ç«¯å£,å¯ä»¥è‡ªè¡Œé…ç½®</span>    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># é…ç½®åŸŸå</span>    <span class="token comment" spellcheck="true"># åŠ¨æ€è¯·æ±‚è½¬å‘åˆ° 9600 ç«¯å£(gunicorn):</span>    <span class="token keyword">location</span> <span class="token operator">/</span> app1<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token keyword">proxy_pass</span>   <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">9600</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_read_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_send_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token keyword">location</span> <span class="token operator">/</span> app2<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token keyword">proxy_pass</span>   <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">9601</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_read_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>       <span class="token keyword">proxy_send_timeout</span> <span class="token number">300</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p>ä¿®æ”¹å®Œä¹‹åä¿å­˜ï¼Œé‡å¯ nginx.</p><h3 id="Supervisor"><a href="#Supervisor" class="headerlink" title="Supervisor"></a><strong>Supervisor</strong></h3><h3 id="å®‰è£…-supervisor"><a href="#å®‰è£…-supervisor" class="headerlink" title="å®‰è£… supervisor"></a><strong>å®‰è£… supervisor</strong></h3><p>å‘½ä»¤å¦‚ä¸‹:</p><pre class=" language-text"><code class="language-text">pip install supervisor</code></pre><p>åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼š</p><pre class=" language-text"><code class="language-text">echo_supervisord_conf > supervisor.conf</code></pre><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶æœ€åº•éƒ¨æ·»åŠ ç›¸åº”é…ç½®</p><pre class=" language-text"><code class="language-text">[include] è‡ªå·±çš„é¡¹ç›®é…ç½®  [program:project]  directory = /home/jerry/Code/project       ; ç¨‹åºçš„å¯åŠ¨ç›®å½•  command = /home/jerry/.virtualenvs/parsing/bin/gunicorn -w 4 -worker-class gevent -bind 0.0.0.0:9600 app:app  ; å¯åŠ¨å‘½ä»¤numprocs=1           ; number of processes copies to start (def 1)   autostart = true     ; åœ¨ supervisord å¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨   startsecs = 1        ; å¯åŠ¨ 1 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†   autorestart = true   ; ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯   startretries = 3     ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3   user = root          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨   redirect_stderr = true          ; æŠŠ stderr é‡å®šå‘åˆ° stdoutï¼Œé»˜è®¤ false   stdout_logfile_maxbytes = 20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MB   stdout_logfile_backups = 10     ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•° stdout_logfile=/home/jerry/Code/project/log/gunicorn.log       ; log æ—¥å¿—stderr_logfile=/home/jerry/Code/project/log/gunicorn.error     ; é”™è¯¯æ—¥å¿—</code></pre><p>ç¼–è¾‘å®Œä¹‹åä¿å­˜ï¼Œå¯åŠ¨ supervisorã€‚è¿™é‡Œçš„å¯åŠ¨å‘½ä»¤å’Œåœ¨å‘½ä»¤è¡Œç”¨ gunicorn å¯åŠ¨çš„å‘½ä»¤æ˜¯ä¸€è‡´çš„ï¼Œå…¶ä¸­ -w æ˜¯æŒ‡æœåŠ¡çš„è¿›ç¨‹æ•°ï¼Œè¯¦ç»†å‘½ä»¤æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„é‚£ç¯‡æ–‡ç« å“ˆã€‚</p><h3 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a><strong>åŸºæœ¬å‘½ä»¤</strong></h3><p>é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨ supervisor</p><pre class=" language-text"><code class="language-text">supervisord -c supervisor.conf </code></pre><p>æŸ¥çœ‹ supervisor çš„çŠ¶æ€</p><pre class=" language-text"><code class="language-text">supervisorctl -c supervisor.conf status </code></pre><p>é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶,æ¯æ¬¡ä¿®æ”¹ä¹‹åè®°å¾—é‡æ–°è½½å…¥</p><pre class=" language-text"><code class="language-text">supervisorctl -c supervisor.conf reload</code></pre><p>å¯åŠ¨æŒ‡å®š/æ‰€æœ‰ supervisor ç®¡ç†çš„ç¨‹åºè¿›ç¨‹</p><pre class=" language-text"><code class="language-text">supervisorctl -c supervisor.conf start [all]|[appname]</code></pre><p>å…³é—­æŒ‡å®š/æ‰€æœ‰ supervisorç®¡ç†çš„ç¨‹åºè¿›ç¨‹</p><pre class=" language-text"><code class="language-text">supervisorctl -c supervisor.conf stop [all]|[appname]</code></pre><p>è¿™æ—¶å€™é€šè¿‡ <a href="https://link.zhihu.com/?target=http://127.0.0.1:8080">http://127.0.0.1:8080</a> å°±èƒ½è®¿é—®ä½ çš„åº”ç”¨äº†! æƒ³çŸ¥é“æ•ˆæœå¦‚ä½•ï¼Œå¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œæ¯”å¦‚åœ¨ä»£ç ä¸­å¢åŠ  sleep,æˆ–è€…è‡ªå·±åŠ¨æ‰‹å†™ä¸ªè„šæœ¬æµ‹è¯•ï¼</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://cocofe.cn/2017/07/25/%E5%90%8C%E6%97%B6%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%A4%9A%E4%B8%AAFlask%E5%BA%94%E7%94%A8/">http://cocofe.cn/2017/07/25/%E5%90%8C%E6%97%B6%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%A4%9A%E4%B8%AAFlask%E5%BA%94%E7%94%A8/</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> falsk </tag>
            
            <tag> ngnix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bahdanau å’Œ Luong ä¸¤ç§ Attention æœºåˆ¶çš„åŒºåˆ«</title>
      <link href="/2020/09/05/bahdanau-he-luong-liang-chong-attention-ji-zhi-de-qu-bie/"/>
      <url>/2020/09/05/bahdanau-he-luong-liang-chong-attention-ji-zhi-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<h1 id="Bahdanau-å’Œ-Luong-ä¸¤ç§-Attention-æœºåˆ¶çš„åŒºåˆ«"><a href="#Bahdanau-å’Œ-Luong-ä¸¤ç§-Attention-æœºåˆ¶çš„åŒºåˆ«" class="headerlink" title="Bahdanau å’Œ Luong ä¸¤ç§ Attention æœºåˆ¶çš„åŒºåˆ«"></a>Bahdanau å’Œ Luong ä¸¤ç§ Attention æœºåˆ¶çš„åŒºåˆ«</h1><p>è½¬è½½è‡³<a href="https://zhuanlan.zhihu.com/p/129316415">https://zhuanlan.zhihu.com/p/129316415</a></p><p><img src="/2020/09/05/bahdanau-he-luong-liang-chong-attention-ji-zhi-de-qu-bie/1.jpg"></p><ul><li><strong>æ³¨æ„åŠ›çš„è®¡ç®—æ–¹å¼ä¸åŒ</strong><br>åœ¨ Luong Attention æœºåˆ¶ä¸­ï¼Œç¬¬ t æ­¥çš„æ³¨æ„åŠ› $c  _t$æ˜¯ç”± decoder ç¬¬ t æ­¥çš„ hidden state$h _t$ ä¸ encoder ä¸­çš„æ¯ä¸€ä¸ª hidden state $\overline{h} _s$ åŠ æƒè®¡ç®—å¾—å‡ºçš„ã€‚è€Œåœ¨ Bahdanau Attention æœºåˆ¶ä¸­ï¼Œç¬¬ t æ­¥çš„æ³¨æ„åŠ›$c  _t$  æ˜¯ç”± decoder ç¬¬ t-1 æ­¥çš„ hidden state $h _{t-1}$ ä¸ encoder ä¸­çš„æ¯ä¸€ä¸ª hidden state $\overline {h} _s$ åŠ æƒè®¡ç®—å¾—å‡ºçš„ã€‚</li><li><strong>decoder çš„è¾“å…¥è¾“å‡ºä¸åŒ</strong><br>åœ¨ Bahdanau Attention æœºåˆ¶ä¸­ï¼Œdecoder åœ¨ç¬¬ t æ­¥æ—¶ï¼Œè¾“å…¥æ˜¯ç”±æ³¨æ„åŠ›  $c  _t$ ä¸å‰ä¸€æ­¥çš„ hidden state $h _{t-1}$  æ‹¼æ¥ï¼ˆconcatenateï¼‰å¾—å‡ºçš„ï¼Œå¾—åˆ°ç¬¬ t æ­¥çš„ hidden state $ h _t $  å¹¶ç›´æ¥è¾“å‡º $ \widehat{y} _t$ ã€‚è€Œ Luong Attention æœºåˆ¶åœ¨ decoder éƒ¨åˆ†å»ºç«‹äº†ä¸€å±‚é¢å¤–çš„ç½‘ç»œç»“æ„ï¼Œä»¥æ³¨æ„åŠ› $c _t $ ä¸åŸ decoder ç¬¬ t æ­¥çš„ hidden state $h _t$  æ‹¼æ¥ä½œä¸ºè¾“å…¥ï¼Œå¾—åˆ°ç¬¬ t æ­¥çš„ hidden state  $ \widetilde{h} _t$  å¹¶è¾“å‡º $\widehat{y} _t$  ã€‚</li></ul><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼ŒBahdanau Attention æœºåˆ¶çš„è®¡ç®—æµç¨‹ä¸º $h _{t-1} \rightarrow a _t \rightarrow c _t \rightarrow h _t$ ã€‚è€Œ Luong attention æœºåˆ¶çš„è®¡ç®—æµç¨‹ä¸º  $h _{t} \rightarrow a _t \rightarrow c _t \rightarrow h _t$ ã€‚ç›¸è¾ƒè€Œè¨€ï¼Œ Luong attention æœºåˆ¶ä¸­çš„ decoder åœ¨æ¯ä¸€æ­¥ä½¿ç”¨å½“å‰æ­¥ï¼ˆè€Œéå‰ä¸€æ­¥ï¼‰çš„ hidden state æ¥è®¡ç®—æ³¨æ„åŠ›ï¼Œä»é€»è¾‘ä¸Šæ›´è‡ªç„¶ï¼Œä½†éœ€è¦ä½¿ç”¨ä¸€å±‚é¢å¤–çš„ RNN decoder æ¥è®¡ç®—è¾“å‡ºã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> attention </tag>
            
            <tag> æ³¨æ„åŠ›æœºåˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GRAPH-BERT: Only Attention is Needed for Learning Graph Representations</title>
      <link href="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/"/>
      <url>/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/</url>
      
        <content type="html"><![CDATA[<h1 id="GRAPH-BERT-Only-Attention-is-Needed-for-Learning-Graph-Representations"><a href="#GRAPH-BERT-Only-Attention-is-Needed-for-Learning-Graph-Representations" class="headerlink" title="GRAPH-BERT: Only Attention is Needed for Learning Graph Representations"></a>GRAPH-BERT: Only Attention is Needed for Learning Graph Representations</h1><p>Paper<a href="https://link.zhihu.com/?target=https://github.com/jwzhanggy/Graph-Bert">GRAPH-BERT: Only Attention is Needed for Learning Graph Representations</a></p><p>Code<a href="https://link.zhihu.com/?target=https://github.com/jwzhanggy/Graph-Bert">torch</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><ul><li><p>æ¨¡å‹å‡æ­»(suspended animation)ï¼šéšç€è®­ç»ƒå±‚æ•°åŠ æ·±ï¼Œæ¨¡å‹ä¸å†å¯¹è¾“å…¥æ•°æ®å“åº”ï¼›</p></li><li><p>è¿‡åº¦å¹³æ»‘(over-smoothing)ï¼šéšç€è®­ç»ƒå±‚æ•°åŠ æ·±ï¼Œæ‰€æœ‰ç»“ç‚¹çš„embeddingä¼šè¶Šæ¥è¶Šç›¸ä¼¼ï¼›</p></li><li><p>å¹¶è¡ŒåŒ–å¤„ç†(paralelization)ï¼šåœ¨å¤§å›¾ä¸Šæ— æ³•å¹¶è¡ŒåŒ–å¤„ç†</p></li></ul><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæå‡ºï¼›é¢æ–°çš„ç¥ç»ç½‘ç»œï¼ˆGraph-Bertï¼‰ï¼Œä»–å®Œå…¨åŸºäºæ³¨æ„åŠ›æœºåˆ¶å»å­¦ä¹ èŠ‚ç‚¹ç‰¹å¾ï¼Œæ²¡æœ‰ä½¿ç”¨èšç±»ç®—å­.ä¸»è¦é€šè¿‡å­å›¾æ¥è®­ç»ƒï¼Œ</p><p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/1.png"></p><p>GRAPH-BERTæ¶‰åŠå‡ ä¸ªéƒ¨åˆ†ï¼š</p><p>ä»åŸå§‹å¤§å›¾ä¸­é‡‡æ ·æ— è¿æ¥å­å›¾ï¼ˆlinkless graphï¼‰</p><p>è¾“å…¥ç»“ç‚¹embedding</p><p>å¤„ç†åŸºäºå›¾çš„transformer-encoder</p><p>åŸºäºå›¾çš„transformer-decoder</p><h4 id="å­å›¾é‡‡æ ·"><a href="#å­å›¾é‡‡æ ·" class="headerlink" title="å­å›¾é‡‡æ ·"></a><strong>å­å›¾é‡‡æ ·</strong></h4><p>â€‹        ä¸ºäº†æ›´å¥½åœ°å¤„ç†å¤§å›¾ï¼ˆå¹¶è¡ŒåŒ–ï¼‰ï¼Œgraph-berté€‰æ‹©åœ¨é‡‡æ ·å­å›¾ä¸Šè¿›è¡Œè®­ç»ƒã€‚ä½¿ç”¨äº†ä¸€ç§åŸºäºå›¾äº²å¯†åº¦çŸ©é˜µ çš„é‡‡æ ·æ–¹æ¡ˆï¼š<strong>ã€Œtop-k intimacyã€</strong>ï¼Œå…¶ä¸­$S(i,j)$è¡¨ç¤ºèŠ‚ç‚¹$v _i$å’Œ$v -j$ç»“ç‚¹ ä¹‹é—´çš„äº²å¯†åº¦ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$S = \alpha \cdot (I - (1- \alpha) \cdot A) ^{-1}$</p><p>â€‹      å…¶ä¸­ï¼Œ$\alpha$ æ˜¯ä¸€ä¸ª[0, 1]ä¹‹é—´çš„è¶…å‚æ•°ï¼ˆé€šå¸¸å–0.15ï¼‰ï¼Œ$A = AD ^-1$ è¡¨ç¤ºåˆ—è§„èŒƒåŒ–é‚»æ¥çŸ©é˜µï¼Œ $A$ä¸ºå›¾çš„é‚»æ¥çŸ©é˜µï¼Œ $D$ä¸ºå¯¹åº”çš„å¯¹è§’çŸ©é˜µ $D(i,i) = \sum _{j} A(i,j)$ã€‚</p><p>â€‹      é‚£ä¹ˆå¯¹äºä¸€ä¸ªç»™å®šçš„ç›®æ ‡ç»“ç‚¹ï¼Œå°±å¯ä»¥åˆ©ç”¨ä¸Šé¢å®šä¹‰çš„äº²å¯†åº¦æ¥æ‰¾å‡ºå…¶ä¸Šä¸‹æ–‡ç»“ç‚¹</p><p>â€‹     å°†è¾“å…¥å‘é‡åµŒå…¥åˆ°graph-transformeræ¨¡å‹ä¸­å®é™…ä¸ŠåŒ…æ‹¬å››ä¸ªéƒ¨åˆ†</p><ul><li><p><strong>åŸå§‹ç‰¹å¾embedding</strong></p><p>å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ˜ å°„æ“ä½œå°†åŸå§‹ç‰¹å¾è¡¨ç¤ºåˆ°æ–°çš„å…±äº«çš„ç‰¹å¾ç©ºé—´ï¼Œè®°ä¸º$e _j ^{(x)} = Embed(x _j) \in R ^{d _n \times 1}$</p><p>å¯¹äºä¸åŒçš„è¾“å…¥å¯ä»¥æœ‰ä¸åŒçš„æ˜ å°„å‡½æ•°ï¼Œå¦‚CNN/LSTM/BERTç­‰</p></li><li><p><strong>Weisfeiler-Lehman ç»å¯¹è§’è‰²embedding</strong></p><p>Weisfeiler-Lehmanç®—æ³•æ˜¯ç”¨æ¥ç¡®å®šä¸¤ä¸ªå›¾æ˜¯å¦æ˜¯åŒæ„çš„ï¼Œå…¶åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡è¿­ä»£å¼åœ°èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯æ¥åˆ¤æ–­å½“å‰ä¸­å¿ƒèŠ‚ç‚¹çš„ç‹¬ç«‹æ€§(Identity)ï¼Œä»è€Œæ›´æ–°æ•´å¼ å›¾çš„ç¼–ç è¡¨ç¤ºã€‚</p><p>å°†èŠ‚ç‚¹WLç»å¯¹è§’è‰²åµŒå…¥å‘é‡å®šä¹‰ä¸º</p><p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/2.png"></p><p>æœ‰å…³æ›´å¤šWLç®—æ³•çš„ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™ä¸ªslidesï¼šGraph Kernel</p></li><li><p><strong>åŸºäºäº²å¯†åº¦çš„ç›¸å¯¹ä½ç½®embedding</strong></p><p>ä¸Šä¸€èŠ‚è®¡ç®—çš„åµŒå…¥å¯ä»¥è¡¨ç¤ºå…¨å±€çš„ä¿¡æ¯ï¼Œè€Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯è·å–å±€éƒ¨ä¿¡æ¯ã€‚</p><p>å½¢å¼ä¸Šï¼Œå¯¹äºnode $v _j$ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„position - embed()å‡½æ•°æå–å…¶åŸºäºæ—¶é—´å¤æ‚åº¦çš„ç›¸å¯¹ä½ç½®åµŒå…¥ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/3.png"></li><li><p><strong>åŸºäºç›¸å¯¹è·ç¦»embedding</strong></p><p>â€‹    å¯¹ä¸¤ä¸ªç»“ç‚¹åœ¨åŸå§‹å¤§å›¾ä¸­çš„è·ç¦»ï¼ˆé—´éš”è¾¹çš„æ•°é‡ï¼‰è¿›è¡Œembeddingè¡¨ç¤ºï¼Œä¸»è¦æ˜¯ä¸ºäº†å¹³è¡¡ä¸Šè¿°ä¸¤æ­¥çš„embedding</p><p>â€‹     å½¢å¼ä¸Šï¼Œå¯¹äºå­å›¾ä¸­çš„node$v _j âˆˆV _i$ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç›¸å¯¹äºåŸå§‹è¾“å…¥å›¾çš„è·³æ•°è¡¨ç¤ºä¸º$Hï¼ˆv _j; v _iï¼‰$ï¼Œå¯ç”¨äºå°†å…¶åµŒå…¥å‘é‡å®šä¹‰ä¸º</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/4.png"></li><li><h4 id="Transfomerç¼–ç å™¨"><a href="#Transfomerç¼–ç å™¨" class="headerlink" title="Transfomerç¼–ç å™¨"></a><strong>Transfomerç¼–ç å™¨</strong></h4><p>é¦–å…ˆæ˜¯å¯¹å‰é¢å¾—åˆ°çš„å››ä¸ªembeedingè¿›è¡Œèšåˆï¼Œ</p><p>èšåˆçš„å‡½æ•°æœ‰å¾ˆå¤šå¯ä»¥é€‰æ‹©ï¼Œæ–‡ç« é‡Œä½œè€…å°±ä½¿ç”¨äº†æœ€ç®€å•çš„åŠ å’Œæ“ä½œã€‚èšåˆä¹‹åå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰ç»“ç‚¹çš„è¾“å…¥è¡¨ç¤º</p></li></ul><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/5.png"><ul><li><p><strong>æ›´æ–°</strong></p><p>$g _i$ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹è¾“å…¥çŸ¢é‡å¯ä»¥ç»„ç»‡æˆä¸€ä¸ªçŸ©é˜µ$H ^{(0)} =[h _i ^{(0)}, h _{i,1} ^{(0)},â€¦,h _{i,k} ^{(0)}] ^T \in R ^{(k+1) \cdot d _n} $</p><p>ç„¶åå°±æ˜¯è¿›è¡ŒNå±‚çš„transformer encoderçš„è¿­ä»£æ›´æ–°</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/6.png"><p>ç¬¦å·$G-Res H ^{(l-1)} , X _i$ï¼Œè¡¨ç¤ºå›¾æ®‹å·®é¡¹ï¼Œ$X _i \in R ^{(k+1) \cdot d _n}$ æ˜¯å­å›¾giä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åŸå§‹ç‰¹å¾ã€‚</p></li><li><p><strong>è¾“å‡º</strong></p><p>ç»è¿‡Då±‚çš„ç¼–ç ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¯¹åº”æ¯ä¸ªç»“ç‚¹çš„è¡¨ç¤ºï¼Œ ä¹‹åå°±å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸‹æ¸¸ä»»åŠ¡æ¥ä½¿ç”¨è¿™äº›å‘é‡è¡¨ç¤ºã€‚</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/7.png"></li></ul><h2 id="é¢„è®­ç»ƒ"><a href="#é¢„è®­ç»ƒ" class="headerlink" title="é¢„è®­ç»ƒ"></a><strong>é¢„è®­ç»ƒ</strong></h2><p>é¢„è®­ç»ƒåŒ…æ‹¬ä¸¤é¡¹ä»»åŠ¡:</p><ul><li><p><strong>èŠ‚ç‚¹å±æ€§é‡å»º</strong></p><p>å¯¹äºç›®æ ‡ç»“ç‚¹ $v _i$ï¼ŒåŸå§‹ç‰¹å¾ä¸º $x _i$ï¼Œæˆ‘ä»¬é€šè¿‡GRAPH-BERTç¼–ç å±‚å¯ä»¥å¾—åˆ°å…¶éšè—è¡¨ç¤º $z _i$ï¼Œ ç„¶åç»è¿‡ä¸€å±‚FCæ˜ å°„å$\widehat{x } _i = FC(z _i)$é‡å»ºåŸå§‹ç‰¹å¾ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰åŸºäºèŠ‚ç‚¹åŸå§‹å±æ€§é‡æ„çš„æŸå¤±é¡¹</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/8.png"></li><li><p><strong>å›¾ç»“æ„é‡å»º</strong></p><p>è¿™ä¸€éƒ¨åˆ†å…¶å®æ˜¯è€ƒè™‘äº†å›¾çš„ç»“æ„ä¿¡æ¯ï¼Œåˆ©ç”¨ä¸¤ä¸ªèŠ‚ç‚¹è¡¨ç¤ºçš„cosè·ç¦»ä¸ä¹‹å‰æå‰ç®—å¥½çš„äº²å¯†åº¦æ‰“åˆ†ï¼Œæ¥åšæŸå¤±ã€‚</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/9.png"><p>å…¶ä¸­ï¼Œ$\widehat{S}(i,j) = \widehat{s}  _{i,j}$</p></li></ul><h2 id="æ¨¡å‹è½¬ç§»å’Œå¾®è°ƒ"><a href="#æ¨¡å‹è½¬ç§»å’Œå¾®è°ƒ" class="headerlink" title="æ¨¡å‹è½¬ç§»å’Œå¾®è°ƒ"></a>æ¨¡å‹è½¬ç§»å’Œå¾®è°ƒ</h2><p>â€‹       ä»¥èŠ‚ç‚¹åˆ†ç±»å’Œå›¾èšç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œå…¶ä¸­å›¾èšç±»å¯ä»¥ç›´æ¥ä½¿ç”¨å­¦ä¹ çš„è¡¨ç¤ºå½¢å¼ï¼Œä½†æ˜¯å¯¹èŠ‚ç‚¹åˆ†ç±»ä»»åŠ¡å¿…é¡»è¿›è¡Œå¾®è°ƒ</p><ul><li><p><strong>èŠ‚ç‚¹åˆ†</strong></p><p>å®šä¹‰è®­ç»ƒæ‰¹å¤„ç†ä¸­å¼•å…¥çš„èŠ‚ç‚¹åˆ†ç±»ä¸¢å¤±é¡¹</p><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/10.png"></li><li><p><strong>å›¾èšç±»</strong></p><p>å›¾èšç±»çš„ç›®æ ‡å‡½æ•°å®šä¹‰å¦‚ä¸‹</p></li></ul><img src="/2020/09/03/graph-bert-only-attention-is-needed-for-learning-graph-representations/11.png"><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bert </tag>
            
            <tag> GNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beam search ç®—æ³•</title>
      <link href="/2020/09/03/beam-search-suan-fa/"/>
      <url>/2020/09/03/beam-search-suan-fa/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½è‡³<a href="https://www.zhihu.com/question/54356960">https://www.zhihu.com/question/54356960</a></p><h1 id="beam-search-åŸç†"><a href="#beam-search-åŸç†" class="headerlink" title="beam search åŸç†"></a>beam search åŸç†</h1><p>ã€€ã€€seq2seqä½œä¸ºä¸€ä¸ªæ¡ä»¶è¯­è¨€æ¨¡å‹ï¼Œå½¢å¼åŒ–æ¥è¯´ï¼Œå®ƒç›´æ¥å¯¹P(y|x)P(y|x)è¿›è¡Œå»ºæ¨¡ï¼Œåœ¨ç”Ÿæˆyyçš„è¿‡ç¨‹ä¸­ï¼Œå§‹ç»ˆæœ‰xxä½œä¸ºæ¡ä»¶ï¼Œæ­£å¦‚ä¸‹å›¾çš„æ¡ä»¶æ¦‚ç‡æ‰€ç¤ºã€‚</p><p><img src="/2020/09/03/beam-search-suan-fa/1.jpg"></p><p>â€‹       seq2seqçš„é¢„æµ‹è¿‡ç¨‹ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªè´ªå¿ƒçš„é¢„æµ‹è¿‡ç¨‹ï¼Œå³åœ¨Decoder RNNçš„æ¯ä¸€æ­¥éƒ½è´ªå¿ƒé€‰æ‹©$\widehat{y}^t$æ¦‚ç‡æœ€å¤§çš„é‚£ä¸ªè¯ã€‚</p><ul><li>greedy search(è´ªå¿ƒç®—æ³•)é—®é¢˜ï¼š<ul><li>è´ªå¿ƒåªèƒ½ä¿è¯æ¯ä¸€æ­¥æ˜¯æœ€ä¼˜çš„ï¼Œæ— æ³•ä¿è¯é¢„æµ‹å‡ºæ¥çš„å¥å­æ•´ä½“æ˜¯æœ€ä¼˜çš„ã€‚</li><li>å¦‚æœåœ¨tæ—¶åˆ»è´ªå¿ƒé€‰æ‹©çš„è¯ä¸æ˜¯å…¨å±€æœ€ä¼˜ï¼Œä¼šå¯¼è‡´tæ—¶åˆ»å¾€åçš„æ‰€æœ‰é¢„æµ‹è¯éƒ½æ˜¯é”™è¯¯çš„ã€‚</li><li>å¦‚æœæ¯ä¸ªæ—¶é—´æ­¥éƒ½ç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„æƒ…å†µçš„è¯ï¼Œæ—¶é—´å¤æ‚åº¦$O(V^T)$åˆå¤ªé«˜äº†ã€‚</li></ul></li></ul><p>â€‹       Beam searchæœç´¢ç­–ç•¥æ˜¯è´ªå¿ƒç­–ç•¥å’Œç©·ä¸¾ç­–ç•¥çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼Œå®ƒåœ¨é¢„æµ‹çš„æ¯ä¸€æ­¥ï¼Œéƒ½ä¿ç•™Top-ké«˜æ¦‚ç‡çš„è¯ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ã€‚kç§°ä¸ºbeam sizeï¼Œkè¶Šå¤§ï¼Œå¾—åˆ°æ›´å¥½ç»“æœçš„å¯èƒ½æ€§æ›´å¤§ï¼Œä½†è®¡ç®—æ¶ˆè€—ä¹Ÿè¶Šå¤§ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„Top-ké«˜æ¦‚ç‡ä¸ä»…ä»…æŒ‡å½“å‰æ—¶åˆ»çš„$\widehat{y} ^t$çš„æœ€é«˜æ¦‚ç‡ï¼Œè€Œæ˜¯æˆªæ­¢ç›®å‰è¿™æ¡è·¯å¾„ä¸Šçš„ç´¯è®¡æ¦‚ç‡ä¹‹å’Œï¼Œå¦‚ä¸‹å›¾çš„å…¬å¼æ‰€ç¤ºã€‚</p><p><img src="/2020/09/03/beam-search-suan-fa/2.jpg"></p><p>â€‹       ä¸¾ä¾‹å¦‚ä¸‹ï¼Œå‡è®¾k=2ï¼Œç¬¬ä¸€ä¸ªæ—¶é—´æ­¥ä¿ç•™Top-2çš„è¯ä¸ºâ€heâ€å’Œâ€Iâ€ï¼Œä»–ä»¬åˆ†åˆ«ä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ã€‚â€heâ€è¾“å…¥é¢„æµ‹è¾“å‡ºå‰ä¸¤åæ˜¯â€hitâ€å’Œâ€struckâ€ï¼Œåˆ™â€hitâ€è¿™æ¡è·¯çš„ç´¯åŠ æ¦‚ç‡æ˜¯â€heâ€çš„æ¦‚ç‡åŠ ä¸Šâ€hitâ€çš„æ¦‚ç‡=-1.7ï¼Œç±»ä¼¼çš„å¯ä»¥ç®—å‡ºå…¶ä»–å‡ ä¸ªè¯å¯¹åº”è·¯å¾„çš„æ¦‚ç‡æ‰“åˆ†ã€‚æœ€ååœ¨è¿™4æ¡è·¯ä¸Šä¿ç•™k=2æ¡è·¯ï¼Œæ‰€ä»¥â€hitâ€å’Œâ€wasâ€å¯¹åº”è·¯å¾„ä¿ç•™ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ï¼›â€struckâ€å’Œâ€gotâ€å¯¹åº”è·¯å¾„è¢«å‰ªæã€‚</p><p><img src="/2020/09/03/beam-search-suan-fa/3.jpg"></p><p>â€‹      æœ€ç»ˆçš„æœç´¢æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ¯ä¸ªæ—¶é—´æ­¥éƒ½åªä¿ç•™äº†k=2ä¸ªèŠ‚ç‚¹å¾€ä¸‹ç»§ç»­æœç´¢ã€‚æœ€åâ€pieâ€å¯¹åº”çš„è·¯å¾„æ‰“åˆ†æœ€é«˜ï¼Œé€šè¿‡å›æº¯æ³•å¾—åˆ°æ¦‚ç‡æœ€é«˜çš„ç¿»è¯‘å¥å­ã€‚è¯·æ³¨æ„ï¼Œbeam searchä½œä¸ºä¸€ç§å‰ªæç­–ç•¥ï¼Œå¹¶ä¸èƒ½ä¿è¯å¾—åˆ°å…¨å±€æœ€ä¼˜è§£ï¼Œä½†å®ƒèƒ½ä»¥è¾ƒå¤§çš„æ¦‚ç‡å¾—åˆ°å…¨å±€æœ€ä¼˜è§£ï¼ŒåŒæ—¶ç›¸æ¯”äºç©·ä¸¾æœç´¢æå¤§çš„æé«˜äº†æœç´¢æ•ˆç‡ã€‚</p><p><img src="/2020/09/03/beam-search-suan-fa/4.jpg"></p><p>åœ¨beam searchçš„è¿‡ç¨‹ä¸­ï¼Œä¸åŒè·¯å¾„é¢„æµ‹è¾“å‡ºç»“æŸæ ‡å¿—ç¬¦&lt; END &gt;çš„æ—¶é—´ç‚¹å¯èƒ½ä¸ä¸€æ ·ï¼Œæœ‰äº›è·¯å¾„å¯èƒ½æå‰ç»“æŸäº†ï¼Œç§°ä¸ºå®Œå…¨è·¯å¾„ï¼Œæš‚æ—¶æŠŠè¿™äº›å®Œå…¨è·¯å¾„æ”¾ä¸€è¾¹ï¼Œå…¶ä»–è·¯å¾„æ¥ç€beam searchã€‚beam searchçš„åœæ­¢æ¡ä»¶æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæœ€å¤§çš„æœç´¢æ—¶é—´æ­¥æ•°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ”¶é›†åˆ°çš„æœ€å¤šçš„å®Œå…¨è·¯å¾„æ•°ã€‚</p><p>â€‹    å½“beam searchç»“æŸæ—¶ï¼Œéœ€è¦ä»næ¡å®Œå…¨è·¯å¾„ä¸­é€‰ä¸€ä¸ªæ‰“åˆ†æœ€é«˜çš„è·¯å¾„ä½œä¸ºæœ€ç»ˆç»“æœã€‚ç”±äºä¸åŒè·¯å¾„çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œè€Œbeam searchæ‰“åˆ†æ˜¯ç´¯åŠ é¡¹ï¼Œç´¯åŠ è¶Šå¤šæ‰“åˆ†è¶Šä½ï¼Œæ‰€ä»¥éœ€è¦ç”¨é•¿åº¦å¯¹æ‰“åˆ†è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸åœ¨beam searchçš„è¿‡ç¨‹ä¸­å°±ç›´æ¥ç”¨ä¸‹é¢çš„å½’ä¸€åŒ–æ‰“åˆ†æ¥æ¯”è¾ƒå‘¢ï¼Ÿå› ä¸ºåœ¨æ ‘æœç´¢çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ—¶åˆ»æ¯”è¾ƒçš„ä¸¤æ¡è·¯å¾„çš„é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œå³åˆ†æ¯æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å½’ä¸€åŒ–æ‰“åˆ†å’Œéå½’ä¸€åŒ–æ‰“åˆ†çš„å¤§å°å…³ç³»æ˜¯ä¸€æ ·çš„ï¼Œå³åœ¨beam searchçš„è¿‡ç¨‹ä¸­å°±æ²¡å¿…è¦å¯¹æ‰“åˆ†è¿›è¡Œå½’ä¸€åŒ–äº†ã€‚</p><p><img src="/2020/09/03/beam-search-suan-fa/5.jpg"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åºåˆ— </tag>
            
            <tag> Seq2Seq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GNN</title>
      <link href="/2020/09/03/gnn/"/>
      <url>/2020/09/03/gnn/</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>markdownæ•°å­¦å…¬å¼</title>
      <link href="/2020/09/03/markdown-shu-xue-gong-shi/"/>
      <url>/2020/09/03/markdown-shu-xue-gong-shi/</url>
      
        <content type="html"><![CDATA[<p>markdownæ”¯æŒå®Œæ•´LaTexæ•°å­¦å…¬å¼è¯­æ³•</p><h4 id="1-ä¸Šæ ‡å’Œä¸‹æ ‡"><a href="#1-ä¸Šæ ‡å’Œä¸‹æ ‡" class="headerlink" title="1.ä¸Šæ ‡å’Œä¸‹æ ‡"></a>1.ä¸Šæ ‡å’Œä¸‹æ ‡</h4><ul><li>ä¸‹æ ‡ä½¿ç”¨ç¬¦å·<code>Y_1</code>è¡¨è¾¾,å…¬å¼è¡¨è¾¾ç»“æœä¸º: $Y _1$</li><li>ä¸Šæ ‡ä½¿ç”¨ <code>X^{2m}</code>æˆ–è€…<code>X^2</code>, å…¶ä¸­è¾ƒä¸ºå¤æ‚çš„è¡¨è¾¾å¼ç”¨<code>{}</code>åŒ…å«å¦‚$X ^{2m}$</li></ul><h4 id="2-å¸¸è§è¿ç®—ç¬¦"><a href="#2-å¸¸è§è¿ç®—ç¬¦" class="headerlink" title="2.å¸¸è§è¿ç®—ç¬¦"></a>2.å¸¸è§è¿ç®—ç¬¦</h4><table><thead><tr><th>ç¬¦å·</th><th>è¡¨è¾¾å¼</th><th>ç¬¦å·</th><th>è¡¨è¾¾å¼</th><th>ç¬¦å·</th><th>è¡¨è¾¾å¼</th></tr></thead><tbody><tr><td>$\pm$</td><td>\pm</td><td>$\times$</td><td>\times</td><td>$\div$</td><td>\div</td></tr><tr><td>$\cdot$</td><td>\cdot</td><td>$\leq$</td><td>\leq</td><td>$\geq$</td><td>\geq</td></tr><tr><td>$\neq$</td><td>\neq</td><td>$\approx$</td><td>\approx</td><td>$\equiv$</td><td>\equiv</td></tr><tr><td>$\in$</td><td>\in</td><td>$\notin$</td><td>\notin</td><td>$\subset$</td><td>\subset</td></tr><tr><td>$ \supset $</td><td>\supset</td><td>$\bigcap$</td><td>\bigcap</td><td>$\bigcup$</td><td>\bigcup</td></tr></tbody></table><h4 id="3-ç‰¹æ®Šç¬¦å·"><a href="#3-ç‰¹æ®Šç¬¦å·" class="headerlink" title="3.ç‰¹æ®Šç¬¦å·"></a>3.ç‰¹æ®Šç¬¦å·</h4><ul><li>æ±‚å’Œç¬¦å·: ä½¿ç”¨<code>\sum</code> è½¬ä¹‰è¡¨è¾¾æ±‚å’Œç¬¦å·,ä¸‹é™ç¬¦å·ä½¿ç”¨<code>_{m}</code>,ä¸Šé™ç¬¦å·ä½¿ç”¨<code>^\infty</code>, å¦‚:  $\sum _{m} ^\infty$</li><li>ç§¯åˆ†ç¬¦å·: <code>\int_0^1</code>è½¬ä¹‰è¡¨è¾¾ç§¯åˆ†ç¬¦å·, å¦‚: $\int _0 ^1$</li><li>æé™ç¬¦å·: <code>\lim_{å˜é‡ \to è¡¨è¾¾å¼} è¡¨è¾¾å¼</code>, å¦‚ $\lim _{1 \to 5} è¡¨è¾¾å¼$</li><li>å‘é‡ç¬¦å·: <code>\vec{a}</code>è½¬ä¹‰è¡¨è¾¾å‘é‡, å¦‚: $\vec{a}$</li><li>ç©ºæ ¼ç¬¦å·: markdownæ”¯æŒå››ç§ç©ºæ ¼<code>\, ã€\;ã€\quad å’Œ \qquad</code></li></ul><h4 id="4-å¸Œè…Šå­—æ¯çš„å¤§å°å†™"><a href="#4-å¸Œè…Šå­—æ¯çš„å¤§å°å†™" class="headerlink" title="4.å¸Œè…Šå­—æ¯çš„å¤§å°å†™"></a>4.å¸Œè…Šå­—æ¯çš„å¤§å°å†™</h4><p>å¸Œè…Šå­—æ¯çš„å¤§å†™ä½¿ç”¨é¦–å­—æ¯å¤§å†™<code>\Gamma</code>è½¬ä¹‰,å°å†™ä½¿ç”¨é¦–å­—æ¯å°å†™<code>\gamma</code>è½¬ä¹‰, å…¬å¼è¡¨è¾¾ç»“æœä¸º: $\Gamma$  å’Œ   $\gamma$</p><h4 id="5-å…³äºæ³¨é‡Š"><a href="#5-å…³äºæ³¨é‡Š" class="headerlink" title="5.å…³äºæ³¨é‡Š"></a>5.å…³äºæ³¨é‡Š</h4><ul><li>å…¬å¼æ³¨é‡Š: ä½¿ç”¨<code>\text{å†…å®¹}</code>è½¬ä¹‰æ³¨é‡Š,å…¬å¼è¡¨è¾¾ç»“æœä¸º: $\text{å…¬å¼æ³¨é‡Š}$</li><li>æ–‡å­—é¢œè‰²: ä½¿ç”¨<code>\color{é¢œè‰²}{æ–‡å­—}</code>è½¬ä¹‰è¡¨è¾¾å¸¦é¢œè‰²çš„æ–‡å­—,å…¬å¼è¡¨è¾¾ç»“æœä¸º:  $\color{green}{æ–‡å­—}$</li></ul><h4 id="6-åˆ†æ•°"><a href="#6-åˆ†æ•°" class="headerlink" title="6.åˆ†æ•°"></a>6.åˆ†æ•°</h4><p>åˆ†æ•°ä½¿ç”¨<code>\frac{part I}{part II}</code>è½¬ä¹‰è¡¨è¾¾,å…¬å¼è¡¨è¾¾ç»“æœä¸º: $\frac{part I}{part II}$</p><h4 id="7-å…¬å¼ä¸­çš„å¤§æ‹¬å·æˆ–å¤§åˆ†éš”ç¬¦"><a href="#7-å…¬å¼ä¸­çš„å¤§æ‹¬å·æˆ–å¤§åˆ†éš”ç¬¦" class="headerlink" title="7.å…¬å¼ä¸­çš„å¤§æ‹¬å·æˆ–å¤§åˆ†éš”ç¬¦"></a>7.å…¬å¼ä¸­çš„å¤§æ‹¬å·æˆ–å¤§åˆ†éš”ç¬¦</h4><ul><li>åœ¨é…å¯¹ç¬¦å·ä¸­.å¦‚å…¬å¼ä¸­çš„æ‹¬å·ä½¿ç”¨<code>\left(</code>è¡¨è¾¾å·¦æ‹¬å·,ä½¿ç”¨<code>\right)</code>è½¬ä¹‰è¡¨è¾¾å‘å³çš„æ‹¬å·;å¦‚: $\left( x _i \right)$</li><li>åœ¨éé…å¯¹ç¬¦å·ä¸­ä»¥<code>\left. å…¶ä»– \rightç¬¦å·</code> æˆ– <code>\leftç¬¦å· å…¶ä»– \right.</code> è¡¨éé…å¯¹çš„è¾ƒå¤§ç¬¦å·.å¦‚: $\left. \frac{du}{dx}\right| _{x=0}$</li><li>æ³¨: è½¬ä¹‰è¡¨è¾¾ä¸éœ€è¦<code>{ å’Œ }</code></li></ul><h4 id="8-ä¸Šåˆ’çº¿ä¸ä¸‹åˆ’çº¿"><a href="#8-ä¸Šåˆ’çº¿ä¸ä¸‹åˆ’çº¿" class="headerlink" title="8.ä¸Šåˆ’çº¿ä¸ä¸‹åˆ’çº¿"></a>8.ä¸Šåˆ’çº¿ä¸ä¸‹åˆ’çº¿</h4><p>ä¸Šåˆ’çº¿ä½¿ç”¨<code>\overline{}</code>è½¬ä¹‰è¡¨è¾¾,ä¸‹åˆ’çº¿ä½¿ç”¨<code>\underline{}</code>è½¬ä¹‰è¡¨è¾¾,å…¬å¼è¡¨è¾¾ç»“æœä¸º: $\overline{a+b+c+d}$å’Œ$\underline{}$</p><h4 id="9-å¼€æ ¹å·"><a href="#9-å¼€æ ¹å·" class="headerlink" title="9.å¼€æ ¹å·"></a>9.å¼€æ ¹å·</h4><p>å¤šæ¬¡æ–¹æ ¹ä½¿ç”¨<code>\sqrt[n]{x}</code>,å…¶ä¸­<code>n</code>è¡¨ç¤ºæ ¹çš„æ¬¡æ•°,<code>x</code>è¡¨ç¤ºè¢«å¼€æ–¹é¡¹,å…¬å¼è¡¨è¾¾ç»“æœä¸º: $\sqrt[n]{x}$</p><h4 id="10-ä½¿ç”¨HTMLè¯­æ³•è¡¨è¾¾æ•°å­¦å…¬å¼"><a href="#10-ä½¿ç”¨HTMLè¯­æ³•è¡¨è¾¾æ•°å­¦å…¬å¼" class="headerlink" title="10.ä½¿ç”¨HTMLè¯­æ³•è¡¨è¾¾æ•°å­¦å…¬å¼"></a>10.ä½¿ç”¨HTMLè¯­æ³•è¡¨è¾¾æ•°å­¦å…¬å¼</h4><ul><li>ä¸Šæ ‡ä¸ä¸‹æ ‡çš„è¡¨è¾¾: ä½¿ç”¨æ ‡ç­¾<code>&lt;sub&gt;</code>å’Œ<code>&lt;sup&gt;</code>è¡¨è¾¾, è¡¨è¾¾ç»“æœä¸º: text ä¸text</li><li>ä¸Šåˆ’çº¿è¡¨è¾¾: ä½¿ç”¨æ ‡ç­¾<code>&lt;SPAN style="TEXT-DECORATION: overline"&gt;X&lt;/SPAN&gt;</code>è¡¨è¾¾,è¡¨è¾¾ç»“æœä¸º: <span style="TEXT-DECORATION: overline">X</span></li></ul><h4 id="11-è¡¥å……"><a href="#11-è¡¥å……" class="headerlink" title="11.è¡¥å……"></a>11.è¡¥å……</h4><p>å¯¹äºéƒ¨åˆ†ç¬¦å·æ— æ³•ç”¨ markdown çš„å…¬å¼è¡¨è¾¾,å¯ä»¥ä½¿ç”¨ <code>\ç¬¦å·</code> è½¬ä¹‰è¡¨è¾¾,å¦‚$ % $ç­‰</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/95886235">æ•°å­¦å…¬å¼</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
            <tag> æ•°å­¦å…¬å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XLNet</title>
      <link href="/2020/08/31/xlnet/"/>
      <url>/2020/08/31/xlnet/</url>
      
        <content type="html"><![CDATA[<h1 id="XLNet"><a href="#XLNet" class="headerlink" title="XLNet"></a>XLNet</h1><p>Paper: <a href="https://arxiv.org/abs/1906.08237v2">XLNet: Generalized Autoregressive Pretraining for Language Understanding</a></p><p>Code:<a href="https://github.com/graykode/xlnet-Pytorch">torch</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BART</title>
      <link href="/2020/08/28/bart/"/>
      <url>/2020/08/28/bart/</url>
      
        <content type="html"><![CDATA[<h1 id="BART"><a href="#BART" class="headerlink" title="BART"></a>BART</h1><p>bratæ˜¯linuxä¸‹çš„ä¸€æ¬¾åº”ç”¨äºwebserverç«¯çš„æ–‡æœ¬æ ‡æ³¨å·¥å…·ï¼Œå¯ç”¨äºæ ‡æ³¨å¦‚ä¸‹ç±»å‹ä¿¡æ¯ï¼š<br>ï¼ˆ1ï¼‰å®ä½“ï¼šå‘½åå®ä½“ï¼Œå¯ç”¨äºNERï¼›<br>ï¼ˆ2ï¼‰å…³ç³»ï¼šå®ä½“é—´å…³ç³»ï¼Œå¯ç”¨äºå…³ç³»æŠ½å–ï¼›<br>ï¼ˆ3ï¼‰äº‹ä»¶ï¼šå®ä½“å‚ä¸çš„äº‹ä»¶ï¼›<br>ï¼ˆ4ï¼‰å±æ€§ï¼šäº‹ä»¶æˆ–å®ä½“çš„å±æ€§ï¼Œå¸¸ç”¨äºçŸ¥è¯†å›¾è°±ã€‚</p><p>æœ¬æ–‡å°†ä¾æ¬¡ä»‹ç»bratçš„å®‰è£…ã€é…ç½®å’ŒåŸºæœ¬ä½¿ç”¨ã€‚</p><h2 id="bratçš„å®‰è£…"><a href="#bratçš„å®‰è£…" class="headerlink" title="bratçš„å®‰è£…"></a>bratçš„å®‰è£…</h2><h3 id="åŸºæœ¬ç¯å¢ƒé…ç½®"><a href="#åŸºæœ¬ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºæœ¬ç¯å¢ƒé…ç½®"></a>åŸºæœ¬ç¯å¢ƒé…ç½®</h3><p>ã€ç³»ç»Ÿç¯å¢ƒã€‘<br><code>bratåªèƒ½ç”¨äºlinuxä¸‹ï¼Œè‹¥ä¸ºwindowsç³»ç»Ÿï¼Œè¯·å®‰è£…äºlinuxè™šæ‹Ÿæœºä¸Šã€‚</code></p><p>ã€webç¯å¢ƒã€‘<br>å®˜æ–¹å»ºè®®ä½¿ç”¨ä½¿ç”¨Apache2è¿›è¡Œwebé…ç½®ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…apache2ï¼š</p><pre class=" language-shell"><code class="language-shell">sudo apt-get upgradesudo apt-get updatesudo apt-get install apache2</code></pre><p>å®‰è£…å®Œæ¯•åï¼Œä¼šåœ¨ /var ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªwww/htmlç›®å½•ï¼Œä¸‹é¢bartçš„å®‰è£…è·¯å¾„å‡åœ¨å…¶ä¸­ï¼š</p><pre class=" language-she"><code class="language-she">cd /var/www/html</code></pre><h3 id="å®‰è£…æµç¨‹"><a href="#å®‰è£…æµç¨‹" class="headerlink" title="å®‰è£…æµç¨‹"></a>å®‰è£…æµç¨‹</h3><p>ï¼ˆ1ï¼‰ä¸‹è½½bratçš„releaseç‰ˆæœ¬(<a href="https://github.com/nlplab/brat/releases/tag/v1.3p1">https://github.com/nlplab/brat/releases/tag/v1.3p1</a>)</p><p>ï¼ˆ2ï¼‰å°†å…¶æŒªè‡³/var/www/htmlè·¯å¾„ä¸‹ï¼Œè§£å‹å¹¶é‡å‘½åä¸ºbrat</p><pre class=" language-shell"><code class="language-shell">unzip brat-1.3p1.zipmv brat-1.3p1 brat</code></pre><p>ï¼ˆ3ï¼‰ä¿®æ”¹bratè·¯å¾„æƒé™</p><pre class=" language-shell"><code class="language-shell">sudo chmod 777 -R /var/www/html/brat</code></pre><p>ï¼ˆ4ï¼‰è¿›å…¥bratç›®å½•ï¼Œè¿›è¡Œå®‰è£…ï¼Œå¹¶æ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±ç­‰ä¿¡æ¯</p><pre class=" language-shell"><code class="language-shell">cd /var/www/html/bratsudo ./install.sh</code></pre><p>ï¼ˆ5ï¼‰é…ç½®apache2.confæ–‡ä»¶</p><pre class=" language-shell"><code class="language-shell">sudo vim /etc/apache2/apache2.conf</code></pre><p>åœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥å¦‚ä¸‹å†…å®¹ï¼ˆæ³¨æ„ç¼©è¿›ï¼Œè‹¥å¯åŠ¨apache2æœåŠ¡æ—¶å€™æŠ¥é”™â€œâ€¦the control process exited with error codeâ€¦â€ï¼Œå»ºè®®æ‰‹åŠ¨ç¼©è¿›ï¼ˆ4ä¸‹ç©ºæ ¼é”®ï¼‰ï¼‰ï¼š</p><pre class=" language-shell"><code class="language-shell"><Directory /var/www/html/brat>ã€€ã€€AllowOverride Options Indexes FileInfo Limitã€€ã€€Require all grantedã€€ã€€AddType application/xhtml+xml .xhtmlã€€ã€€AddType font/ttf .ttfã€€ã€€Options +ExecCGIã€€ã€€AddHandler cgi-script .cgi</Directory></code></pre><p>ï¼ˆ6ï¼‰å»ºç«‹Apache2å’Œcgiæ¨¡å—çš„è½¯é“¾æ¥ï¼Œå…¶å…·ä½“è¯´æ˜å¯è§issue #1141</p><pre class=" language-shell"><code class="language-shell">cd /etc/apache2/mods-enabledsudo ln -s ../mods-available/cgi.load</code></pre><p>ï¼ˆ7ï¼‰braté»˜è®¤ä¸æ”¯æŒä¸­æ–‡æ ‡æ³¨ï¼Œå› æ­¤éœ€æ‰‹åŠ¨ä¿®æ”¹bratä¸»ç›®å½•/server/srcè·¯å¾„ä¸‹çš„projectconfig.pyæ–‡ä»¶çš„ç¬¬162è¡Œä»£ç </p><pre class=" language-shell"><code class="language-shell">sudo vim /var/www/html/brat/server/src/projectconfig.py</code></pre><p>å°†å…¶æ”¹ä¸ºï¼š</p><pre class=" language-shell"><code class="language-shell">n  = re.sub(r'[^a-zA-Z0-9_-]', '_', n)æ”¹ä¸ºn = re.sub(u'[^a-zA-Z\u4e00-\u9fa5<>,0-9_-]', '_', n)</code></pre><p>â€‹    å¦‚æœå·²ç»é…ç½®äº†æ”¯æŒä¸­æ–‡ï¼Œä½†æ˜¯ä»ç„¶æŠ¥ä¸æ”¯æŒçš„å­—ç¬¦çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯ä½ çš„é…ç½®é‡Œé¢æœ‰ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ï¼Œè¦ä¹ˆå…¨éƒ¨æ”¹æˆè‹±æ–‡æ ‡ç‚¹ï¼Œè¦ä¹ˆä¿®æ”¹ä¸Šé¢çš„æ­£åˆ™ï¼Œå¦‚ä¸‹ï¼ˆä¿®æ”¹ä¹‹åè®°å¾—é‡å¯apache2æœåŠ¡ï¼‰ï¼š</p><pre class=" language-shell"><code class="language-shell"># n  = re.sub(r'[^a-zA-Z0-9_-]', '_', n)n = re.sub(u'[^a-zA-Z\u4e00-\u9fa5<>\u2014-\uff1b,0-9_-]', '_', n)</code></pre><p>â€‹    å¦‚æœä¿®æ”¹ä¹‹åï¼Œä»ç„¶æœ‰å­—ç¬¦é—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®æ–‡ä»¶çš„ç¼–ç æ ¼å¼æ˜¯å¦æ˜¯UTF-8ï¼Œä¸”æ˜¯æ ‡å‡†çš„UTF-8ï¼Œè€Œä¸æ˜¯å¸¦BOMçš„UTF-8ï¼Œå…·ä½“å¯ä»¥ä½¿ç”¨Notepad++æ‰“å¼€æ–‡ä»¶å†ç¼–ç é€‰é¡¹ä¸­æŸ¥çœ‹å’Œè½¬æ¢</p><ul><li><p>å¦‚æœä½¿ç”¨bratåŠ è½½æœ¬åœ°æ–‡ä»¶çš„æ—¶å€™æŠ¥é”™â€œunable to read text file xxx/xxx/xxx/xxx.txt â€ï¼Œè¯·ç¡®ä¿ä½ çš„txtæ–‡ä»¶å’Œannæ–‡ä»¶å·²ç»æˆæƒç»™å½“å‰linuxç³»ç»Ÿçš„ç™»å½•ç”¨æˆ·ï¼Œæˆæƒæ–¹å¼å¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹å¼ï¼š</p><p><code>sudo chmod 777 xxx.txt</code></p><p><code>sudo chmod 777 xxx.ann</code></p></li></ul><p>ï¼ˆ8ï¼‰é‡å¯Apache2</p><pre class=" language-shell"><code class="language-shell">sudo service apache2 restartï¼ˆ9ï¼‰è®¿é—®æœ¬åœ°bratåœ°å€ï¼Œè‹¥é¡µé¢æ­£å¸¸ï¼Œå³å®‰è£…é…ç½®æ— è¯¯ã€‚</code></pre><h2 id="bratçš„åŸºæœ¬ä½¿ç”¨"><a href="#bratçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="bratçš„åŸºæœ¬ä½¿ç”¨"></a>bratçš„åŸºæœ¬ä½¿ç”¨</h2><h3 id="é¡¹ç›®æ–‡ä»¶çš„é…ç½®"><a href="#é¡¹ç›®æ–‡ä»¶çš„é…ç½®" class="headerlink" title="é¡¹ç›®æ–‡ä»¶çš„é…ç½®"></a>é¡¹ç›®æ–‡ä»¶çš„é…ç½®</h3><p>é¡¹ç›®æ–‡ä»¶å»ºè®®æ”¾åœ¨å¦‚ä¸‹è·¯å¾„ï¼ˆè‹¥æ— ï¼Œè‡ªè¡Œåˆ›å»ºï¼‰ï¼š</p><pre class=" language-shell"><code class="language-shell">cd /var/www/html/brat/data/projects</code></pre><p>æ¯ä¸ªé¡¹ç›®ä¸‹æ€»å…±æœ‰4ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºï¼š<br>ï¼ˆ1ï¼‰annotation.conf è§„å®šäº†é¡¹ç›®ä¸­çš„æ‰€æœ‰å®ä½“ã€äº‹ä»¶ã€å…³ç³»å’Œå±æ€§ç±»å‹<br>ï¼ˆ2ï¼‰visual.conf è§„å®šäº†annotation.conf æ‰€æœ‰å®ä½“ã€äº‹ä»¶ã€å…³ç³»å’Œå±æ€§ç±»å‹çš„æ˜¾ç¤ºæ–‡å­—å’Œé¢œè‰²ç­‰é…ç½®<br>ï¼ˆ3ï¼‰project_name.txt é¡¹ç›®çš„è¯­èŠæ–‡æœ¬<br>ï¼ˆ4ï¼‰project_name.ann æ ‡æ³¨åçš„ç»“æœæ–‡ä»¶</p><h3 id="annotation-conf-æ–‡ä»¶çš„é…ç½®"><a href="#annotation-conf-æ–‡ä»¶çš„é…ç½®" class="headerlink" title="annotation.conf æ–‡ä»¶çš„é…ç½®"></a>annotation.conf æ–‡ä»¶çš„é…ç½®</h3><p>ï¼ˆ1ï¼‰å®šä¹‰å®ä½“entities</p><p>æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå®ä½“åç§°ï¼Œè‹¥éœ€è¦å®šä¹‰å±‚æ¬¡åŒ–çš„å®ä½“ï¼Œåˆ™åœ¨ä¸‹ä¸€å±‚å®ä½“å‰åŠ å…¥Tabé”®ã€‚</p><pre class=" language-shell"><code class="language-shell">[entities]# Definition of entities.# Format is a simple list with one type per line.Person    Male    FemaleOrganizationGPE</code></pre><p>ï¼ˆ2ï¼‰å®šä¹‰å…³ç³»relations</p><p>æ¯ä¸€è¡Œè¡¨ç¤ºä¸€æ¡å…³ç³»ï¼Œå®šä¹‰äº†å…³ç³»åç§°ï¼Œä»¥åŠå…³ç³»åŒæ–¹çš„å®ä½“ã€‚</p><p>å…¶åŸºæœ¬çš„é…ç½®è§„åˆ™ä¸ºï¼š<br>a). æ¯ä¸€è¡Œå¼€å¤´ä¸ºå…³ç³»åç§°ï¼›<br>b). å…³ç³»åç§°åä¸ºç©ºæ ¼ï¼Œç©ºæ ¼åä¸ºç›¸å…³çš„å®ä½“ä¿¡æ¯ï¼Œå…¶æ ¼å¼ä¸ºArg1:å®ä½“1ï¼ŒArg2:å®ä½“2ï¼Œè¡¨ç¤ºä»å®ä½“1â€”&gt;å®ä½“2çš„å…³ç³»ï¼›<br>c) è‹¥éœ€è¦å®šä¹‰åŒå‘å…³ç³»ï¼Œåˆ™è¡¥å……<rel-type>:symmetric-transitiveã€‚</rel-type></p><pre class=" language-shell"><code class="language-shell">[relations]# Definition of (binary) relations.# Format in brief: one relation per line, with first space-separated# field giving the relation type and the rest of the line the# comma-separated arguments in ROLE:TYPE format. The roles are# typically "Arg1" and "Arg2".Located            Arg1:Person, Arg2:GPEGeographical_part  Arg1:GPE,    Arg2:GPEFamily             Arg1:Person, Arg2:PersonEmployment         Arg1:Person, Arg2:GPEOwnership          Arg1:Person, Arg2:OrganizationOrigin             Arg1:Organization, Arg2:GPEAlias              Arg1:Person, Arg2:Person, <REL-TYPE>:symmetric-transitive</code></pre><p>ï¼ˆ3ï¼‰å®šä¹‰äº‹ä»¶events</p><p>æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªäº‹ä»¶ï¼Œå®šä¹‰äº†äº‹ä»¶åç§°ï¼Œä»¥åŠäº‹ä»¶å‚ä¸æ–¹çš„å®ä½“ä¿¡æ¯ã€‚</p><p>å…¶åŸºæœ¬çš„é…ç½®è§„åˆ™ä¸ºï¼š<br>a) æ¯ä¸€è¡Œå¼€å¤´ä¸ºäº‹ä»¶åï¼›<br>b) äº‹ä»¶åç§°åä¸ºç©ºæ ¼ï¼Œç©ºæ ¼åä¸ºç›¸å…³çš„å®ä½“ä¿¡æ¯ï¼Œå…¶æ ¼å¼ä¸ºArg1:å®ä½“1ï¼ŒArg2:å®ä½“2<br>c) å¯é€šè¿‡å®šä¹‰<name>=å®ä½“1|å®ä½“2æ¥å°†å®ä½“è¿›è¡Œç»„åˆ;<br>d) æ¯ä¸ªäº‹ä»¶ï¼Œå¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä¸­é€‚é…ç¬¦æ¥é™åˆ¶æŸä¸ªå®ä½“çš„å‚ä¸ä¸å¦ä»¥åŠå‚ä¸ä¸ªæ•°ï¼šï¼Ÿè¡¨ç¤ºå¯å‚ä¸ï¼Œå¯ä¸å‚ä¸ï¼›* è¡¨ç¤ºå¯å‚ä¸0æ¬¡æˆ–å¤šæ¬¡ï¼›+è¡¨ç¤ºè‡³å°‘å‚ä¸ä¸€æ¬¡ï¼›{2}è¡¨ç¤ºå¿…é¡»ä¸º2ä¸ªå®ä½“ï¼Œå…¶ä»–æ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼ã€‚<br>e) è‹¥ä¸ºå±‚æ¬¡æ€§çš„äº‹ä»¶ï¼Œåˆ™å¯é€šè¿‡åœ¨ä¸Šä¸€å±‚äº‹ä»¶åç§°å‰æ·»åŠ !ï¼Œä»¥ä½¿å…¶ä¸å‚ä¸å…·ä½“æ ‡æ³¨ï¼ˆå› æ­¤ï¼Œå…¶ä»…åšæ³¨é‡Šæ€§çš„å±‚æ¬¡åŒ–ï¼‰</name></p><pre class=" language-shell"><code class="language-shell">[events]# Definition of events.# Format in brief: one event per line, with first space-separated# field giving the event type and the rest of the line the# comma-separated arguments in ROLE:TYPE format. Arguments may be# specified as either optional (by appending "?" to role) or repeated# (by appending either "*" for "0 or more" or "+" for "1 or more").# this is a macro definition, used for brevity<POG>=Person|Organization|GPE# the "!" before a type specifies that it cannot be used for annotation# (hierarchy structure only.)!Life    Be-born   Person-Arg:Person, Place-Arg?:GPE    Marry     Person-Arg&#123;2&#125;:Person, Place-Arg?:GPE    Divorce   Person-Arg&#123;2&#125;:Person, Place-Arg?:GPE    Die       Person-Arg:Person, Agent-Arg?:<POG>, Place-Arg?:GPE!Transaction    Transfer-ownership  Buyer-Arg:<POG>, Seller-Arg:<POG>, Artifact-Arg:Organization    Transfer-money    Giver-Arg:<POG>, Recipient-Arg:<POG>, Beneficiary-Arg:<POG>!Business    Start-org  Agent-Arg?:<POG>, Org-Arg:Organization    Merge-org  Org-Arg&#123;2&#125;:Organization    End-org    Org-Arg:Organization</code></pre><p>ï¼ˆ4ï¼‰å®šä¹‰å±æ€§attributes</p><p>æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå±æ€§ï¼Œå¯ä¾é™„äºäº‹ä»¶æˆ–å®ä½“å¯¹è±¡ã€‚</p><p>å…¶åŸºæœ¬çš„é…ç½®è§„åˆ™ä¸ºï¼š<br>a) æ¯ä¸€è¡Œå¼€å¤´ä¸ºå±æ€§åï¼›<br>b) äº‹ä»¶åç§°åä¸ºTabç¬¦ï¼ŒTabç¬¦åä¸ºå…·ä½“çš„å±æ€§å®šä¹‰ï¼Œå…¶æ ¼å¼ä¸€èˆ¬ä¸ºArg:<event>ï¼Œè¡¨ç¤ºä¸ºäº‹ä»¶å±æ€§ï¼ŒEVENTå¯æ”¹ä¸ºENTITYè¡¨ç¤ºå®ä½“å±æ€§ã€‚<br>cï¼‰è‹¥æ”¹è¡Œå®šä¹‰ç›´æ¥ç»“æŸï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸ª2å…ƒå±æ€§ï¼›è‹¥ä¸ºå¤šå€¼å±æ€§ï¼Œåˆ™åœ¨Arg:<event>åéœ€è¿›ä¸€æ­¥è¡¥å……,Value:å€¼1|å€¼2|å€¼3ã€‚</event></event></p><pre class=" language-shell"><code class="language-shell">[attributes]# Definition of entity and event attributes.# Format in brief: first tab-separated field is attribute name, second# a set of key-value pairs. The latter must define "Arg:" which# specifies what the attribute can attach to (typically "<EVENT>").# If no other keys are defined, the attribute is binary (present or# absent). If "Value:" with multiple alternatives is defined, the# attribute can have one of the given values.Negation     Arg:<EVENT>Confidence   Arg:<EVENT>, Value:High|Neutral|Low</code></pre><p>2.1.2 visual.conf æ–‡ä»¶çš„é…ç½®<br>ï¼ˆ1ï¼‰å®šä¹‰æ˜¾ç¤ºæ ‡ç­¾labels</p><p>ç”¨äºå®šä¹‰å®ä½“ã€å…³ç³»ã€äº‹ä»¶å’Œå±æ€§ç­‰å¯¹è±¡çš„æ˜¾ç¤ºæ ‡ç­¾ï¼Œå¸¸ç”¨äºæ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾ï¼ˆåŸå§‹annotation.conf æ–‡ä»¶ä¸ºè‹±æ–‡æ—¶ï¼‰æˆ–é˜²æ­¢åŸå§‹å„å¯¹è±¡çš„åç§°è¿‡ç¨‹è€Œéš¾ä»¥æ˜¾ç¤ºã€‚</p><p>å…¶å®šä¹‰éå¸¸ç®€å•ï¼š</p><pre class=" language-shell"><code class="language-shell">[labels]### Entity typesPerson | PersonOrganization | Organization | OrgGPE | Geo-political entity | GPE</code></pre><p>ï¼ˆ2ï¼‰å®šä¹‰æ˜¾ç¤ºé¢œè‰²drawing<br>ç”¨äºå®šä¹‰å®ä½“ã€å…³ç³»ã€äº‹ä»¶å’Œå±æ€§ç­‰å¯¹è±¡çš„æ˜¾ç¤ºé¢œè‰²ï¼Œä»¥åœ¨webserveræ ‡æ³¨æ—¶äºˆä»¥åŒºåˆ†ã€‚</p><p>å…¶å®šä¹‰éå¸¸ç®€å•ï¼š</p><pre class=" language-shell"><code class="language-shell">Person    bgColor:#ffccaaOrganization    bgColor:#8fb2ffGPE    bgColor:#7fe2ff</code></pre><p>2.1.3 project_name.txt æ–‡ä»¶çš„é…ç½®<br>è¯¥æ–‡ä»¶å³ä¸ºéœ€è¦è¿›è¡Œæ ‡æ³¨çš„åŸå§‹è¯­æ–™æ–‡ä»¶ï¼Œä¸ºæ–¹ä¾¿æ ‡æ³¨ï¼Œä¸€èˆ¬åœ¨æ”¾å…¥æ ‡æ³¨é¡¹ç›®æ–‡ä»¶å¤¹ä¹‹å‰ï¼Œå»ºè®®è¿›è¡Œæ–‡æœ¬é¢„å¤„ç†ã€‚</p><p>2.1.4 project_name.ana æ–‡ä»¶çš„é…ç½®<br>è¯¥æ–‡ä»¶å³ä¸ºæ ‡æ³¨åçš„ç»“æœæ–‡ä»¶ï¼Œéšç€æ ‡æ³¨è¿‡ç¨‹å…¶åŒæ­¥è‡ªåŠ¨æ›´æ–°ã€‚åœ¨æœ€å¼€å§‹ï¼Œå…¶ä¸ºç©ºæ–‡ä»¶ã€‚</p><p>2.2 åŸºäºwebserverçš„æ–‡æœ¬æ ‡æ³¨<br>ï¼ˆ1ï¼‰è®¿é—®æœ¬åœ°bratåœ°å€ï¼›(<a href="http://localhost/brat">http://localhost/brat</a>)<br>ï¼ˆ2ï¼‰ç™»å½•è´¦å·å’Œå¯†ç ï¼›<br>ï¼ˆ3ï¼‰é€‰æ‹©<code>/var/www/html/brat/data/projects</code>æ–‡ä»¶å¤¹å†…çš„å…·ä½“é¡¹ç›®ä¸‹çš„<code>project_name.txt</code>è¯­æ–™æ–‡ä»¶ï¼Œå¼€å§‹æ ‡æ³¨ï¼›<br>ï¼ˆ4ï¼‰é€‰æ‹©æ–‡æœ¬å­—æ®µï¼Œå¼¹å‡ºã€å®ä½“å€™é€‰æ¡†ã€‘ï¼Œå³å¯å®šä¹‰å®ä½“ï¼›<br>ï¼ˆ5ï¼‰æ‹–åŠ¨æ ‡æ³¨å¥½çš„å®ä½“å³å¯å®šä¹‰è¿æ¥å…³ç³»ï¼›<br>ï¼ˆ6ï¼‰åŒå‡»æ ‡ç­¾ï¼Œå³å¯å¯¹æ ‡ç­¾è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤ã€‚</p><p>æ³¨æ„: è‹¥æ˜¾ç¤ºæ— æ³•åŠ è½½æœ¬åœ°æ–‡ä»¶æˆ–æ— æ³•ä¿®æ”¹é™æ€æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ºæƒé™é—®é¢˜ï¼Œä¿®æ”¹è¯¥é¡¹ç›®æ–‡ä»¶å¤¹æƒé™å³å¯ã€‚</p><p>2.3 anaæ–‡ä»¶çš„åŸºæœ¬è§£è¯»<br>ä¸€ä¸ªå…¸å‹çš„æ ‡æ³¨å¥½çš„anaç»“æœæ–‡ä»¶å¦‚ä¸‹ï¼š</p><p>T1    äººå 11 13    é©¬äº‘<br>T2    åœ°ç‚¹ 16 18    æ­å·<br>R1    æ¥è‡ª Arg1:T1 Arg2:T2<br>T3    äººå 23 25    é©¬äº‘<br>T4    æ—¶é—´ 0 10    1964å¹´9æœˆ10æ—¥<br>T5    äººå 61 63    çˆ¶äº²<br>T6    äººå 81 83    é©¬äº‘<br>T7    åœ°ç‚¹ 69 71    æ±Ÿå—<br>T8    äººå 99 101    é‡‘åº¸<br>T9    äººå 129 131    é©¬äº‘</p><ul><li>å®¶å± T3 T5<br>T10    äººå 86 88    çˆ¶äº²<br>R2    æ¥è‡ª Arg1:T5 Arg2:T7    </li><li>å®¶å± T6 T10</li></ul><p>æ¯ä¸€è¡Œè¡¨ç¤ºæ ‡æ³¨å¥½çš„å®ä½“ã€å…³ç³»ã€äº‹ä»¶æˆ–å±æ€§å¯¹è±¡ã€‚</p><p>å¯¹äºå®ä½“å¯¹è±¡ï¼Œå…¶å…±æœ‰5ä¸ªå­—æ®µï¼Œå„å­—æ®µé—´ç”¨ç©ºæ ¼åŒºåˆ†ï¼Œå…¶æ„ä¹‰ä¾æ¬¡ä¸ºï¼š<br>ï¼ˆ1ï¼‰ç¼–å·ï¼Œå¦‚T1è¡¨ç¤ºç¼–å·ä¸º1çš„å®ä½“ï¼›<br>ï¼ˆ2ï¼‰å®ä½“ç±»å‹ï¼Œå¦‚äººå;<br>ï¼ˆ3ï¼‰è¯¥å®ä½“åœ¨æ•´ä¸ªæ–‡æœ¬ä¸­çš„èµ·å§‹ä½ç½®ï¼›<br>ï¼ˆ4ï¼‰è¯¥å®ä½“åœ¨æ•´ä¸ªæ–‡æœ¬ä¸­çš„ç»ˆæ­¢ä½ç½®ï¼›<br>ï¼ˆ5ï¼‰å®ä½“å¯¹åº”çš„æ–‡æœ¬ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šæ•´ä¸ªæ–‡æœ¬çš„é¡ºåºä¸ºå„è¡Œæ–‡æœ¬çš„æ‹¼æ¥ï¼ˆä¿ç•™\nç­‰ç¬¦å·ï¼‰ï¼Œæ•´ä¸ªæ–‡æœ¬çš„èµ·å§‹ä½ç½®ç¼–å·ä¸º0ï¼Œèµ·å§‹ä½ç½®-&gt;ç»ˆæ­¢ä½ç½®é‡‡ç”¨å·¦å¼€å³é—­çš„å¯¹åº”å…³ç³»ï¼ˆå¯ç†è§£ä¸ºåˆ‡ç‰‡ï¼‰ï¼Œå¦‚[11, 13]è¡¨ç¤ºå ç”¨11ã€12ä¸¤ä¸ªä½ç½®ã€‚</p><p>å¯¹äºå•å‘å…³ç³»å¯¹è±¡ï¼ŒåŒ…æ‹¬4ä¸ªå­—æ®µï¼Œå…¶æ„ä¹‰ä¾æ¬¡ä¸ºï¼š<br>ï¼ˆ1ï¼‰ç¼–å·ï¼Œå¦‚R1è¡¨ç¤ºç¼–å·ä¸º1çš„å…³ç³»ï¼›<br>ï¼ˆ2ï¼‰å…³ç³»ç±»å‹ï¼Œå¦‚åœ°ç‚¹;<br>ï¼ˆ3ï¼‰å…³ç³»èµ·å§‹å®ä½“ç¼–ç ï¼Œå¦‚Arg1:T1<br>ï¼ˆ4ï¼‰å…³ç³»æŒ‡å‘å®ä½“ç¼–ç ï¼Œå¦‚Arg2:T2</p><p>å¯¹äºåŒå‘å…³ç³»å¯¹è±¡ï¼Œä¹ŸåŒ…æ‹¬4ä¸ªå­—æ®µï¼Œå…¶æ„ä¹‰ä¾æ¬¡ä¸ºï¼š<br>ï¼ˆ1ï¼‰*å·<br>ï¼ˆ2ï¼‰å…³ç³»ç±»å‹ï¼Œå¦‚å®¶å±;<br>ï¼ˆ3ï¼‰å…³ç³»èµ·å§‹å®ä½“ç¼–ç ï¼Œå¦‚T3<br>ï¼ˆ4ï¼‰å…³ç³»æŒ‡å‘å®ä½“ç¼–ç ï¼Œå¦‚T5</p><p>ã€Referenceã€‘ï¼š</p><ol><li><a href="https://blog.csdn.net/p_jinsan/article/details/96152078">Bratæ ‡æ³¨å·¥å…·ï¼ˆæœ¬åœ°ï¼‰å®‰è£…åŠä½¿ç”¨</a></li><li>[æ–‡æœ¬æ ‡æ³¨å·¥å…·brat</li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½åå®ä½“è¯†åˆ« </tag>
            
            <tag> æ ‡æ³¨å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TextCNN</title>
      <link href="/2020/08/27/textcnn/"/>
      <url>/2020/08/27/textcnn/</url>
      
        <content type="html"><![CDATA[<h1 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h1><p>Paper <a href="http://www.aclweb.org/anthology/D14-1181">Convolutional Neural Networks for Sentence Classification(2014)</a></p><p>code<a href=""></a></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p> å°†CNNåº”ç”¨åˆ°æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå¤šä¸ªä¸åŒkernelæ¥æå–å¥å­ä¸­çš„ä¿¡æ¯ï¼ˆç±»ä¼¼äºngramï¼‰ï¼Œä»è€Œæ•æ‰å±€éƒ¨ç›¸å…³æ€§ã€‚</p><h3 id="ç½‘ç»œæ¶æ„"><a href="#ç½‘ç»œæ¶æ„" class="headerlink" title="ç½‘ç»œæ¶æ„"></a>ç½‘ç»œæ¶æ„</h3><p><img src="/2020/08/27/textcnn/1.png"></p><p><img src="/2020/08/27/textcnn/2.png"></p><p>TextCNNè¯¦ç»†è¿‡ç¨‹ï¼š</p><ul><li><strong>Embedding</strong>ï¼šç¬¬ä¸€å±‚æ˜¯å›¾ä¸­æœ€å·¦è¾¹çš„7ä¹˜5çš„å¥å­çŸ©é˜µï¼Œæ¯è¡Œæ˜¯è¯å‘é‡ï¼Œç»´åº¦=5ï¼Œè¿™ä¸ªå¯ä»¥ç±»æ¯”ä¸ºå›¾åƒä¸­çš„åŸå§‹åƒç´ ç‚¹ã€‚</li><li><strong>Convolution</strong>ï¼šç„¶åç»è¿‡ kernel_sizes=(2,3,4) çš„ä¸€ç»´å·ç§¯å±‚ï¼Œæ¯ä¸ªkernel_size æœ‰ä¸¤ä¸ªè¾“å‡º channelã€‚</li><li><strong>MaxPolling</strong>ï¼šç¬¬ä¸‰å±‚æ˜¯ä¸€ä¸ª1-max poolingå±‚ï¼Œè¿™æ ·ä¸åŒé•¿åº¦å¥å­ç»è¿‡poolingå±‚ä¹‹åéƒ½èƒ½å˜æˆå®šé•¿çš„è¡¨ç¤ºã€‚</li><li><strong>FullConnection and Softmax</strong>ï¼šæœ€åæ¥ä¸€å±‚å…¨è¿æ¥çš„ softmax å±‚ï¼Œè¾“å‡ºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡æœ¬åˆ†ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BertåŸç†</title>
      <link href="/2020/08/27/bert-yuan-li/"/>
      <url>/2020/08/27/bert-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="BertåŸç†"><a href="#BertåŸç†" class="headerlink" title="BertåŸç†"></a>BertåŸç†</h2><p>Paper <a href="https://arxiv.org/abs/1810.04805">Pre-training of Deep Bidirectional Transformers for Language Understanding</a></p><p>Code <a href="https://github.com/codertimo/BERT-pytorch">torch</a>   <a href="https://github.com/google-research/bert">tensorflow</a>   </p><h2 id="æ¨¡å‹æ¶æ„"><a href="#æ¨¡å‹æ¶æ„" class="headerlink" title="æ¨¡å‹æ¶æ„"></a>æ¨¡å‹æ¶æ„</h2><p>â€‹       BERT å…¨ç§°ä¸º <strong>Bidirectional Encoder Representation from Transformer</strong>ï¼Œæ˜¯ Google ä»¥æ— ç›‘ç£çš„æ–¹å¼åˆ©ç”¨å¤§é‡<strong>æ— æ ‡æ³¨</strong>æ–‡æœ¬ã€Œç‚¼æˆã€çš„è¯­è¨€æ¨¡å‹ï¼Œå…¶æ¶æ„ä¸º <a href="/2020/08/26/transformer-yuan-li/" title="Transformer">Transformer</a> ä¸­çš„ Encoderï¼ˆBERT=Encoder of Transformerï¼‰</p><p><img src="/2020/08/27/bert-yuan-li/1.png"></p><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul><li><code>L</code>ï¼šTransformer blocksï¼›</li><li><code>H</code>ï¼šhidden sizeï¼›</li><li><code>A</code>ï¼šself-attention headsï¼›</li></ul><p>$ {BERT}_\textbf{BASE: } L=12, H=768, A=12, \text {Total Parameters=} 110 M $</p><p>${BERT}_\textbf{LARGE: } L=24, H=1024, A=16, \text {Total Parameters=} 340 M$</p><h3 id="æ— ç›‘ç£é¢„è®­ç»ƒæ·±åº¦åŒå‘è¯­è¨€æ¨¡å‹"><a href="#æ— ç›‘ç£é¢„è®­ç»ƒæ·±åº¦åŒå‘è¯­è¨€æ¨¡å‹" class="headerlink" title="æ— ç›‘ç£é¢„è®­ç»ƒæ·±åº¦åŒå‘è¯­è¨€æ¨¡å‹"></a>æ— ç›‘ç£é¢„è®­ç»ƒæ·±åº¦åŒå‘è¯­è¨€æ¨¡å‹</h3><p><img src="/2020/08/27/bert-yuan-li/2.png"></p><h4 id="æ¨¡å‹è¾“å…¥"><a href="#æ¨¡å‹è¾“å…¥" class="headerlink" title="æ¨¡å‹è¾“å…¥"></a>æ¨¡å‹è¾“å…¥</h4><ul><li>æœ€å¤§æ”¯æŒé•¿åº¦ä¸º 512ï¼›</li><li>æ¯ä¸ªå¥å­ç¬¬ä¸€ä¸ª token æ€»æ˜¯ â€œspecial classiï¬cation embeddingâ€ï¼Œç”¨ <code>[CLS]</code> è¡¨ç¤ºï¼›</li><li>å¦‚æœè¾“å…¥çš„æ˜¯ä¸¤ä¸ªå¥å­ï¼Œåˆ™ç”¨ <code>[SEP]</code> åˆ†éš”ï¼›</li><li>Segment Embeddingsï¼šä½¿ç”¨å¯å­¦ä¹ çš„ A å’Œ B è¡¨ç¤ºä¸¤ä¸ªå¥å­çš„åµŒå…¥ã€‚å½“åªæœ‰ä¸€ä¸ªå¥å­æ—¶ï¼Œå…¨éƒ¨éƒ½æ˜¯ Aã€‚</li></ul><h4 id="é¢„è®­ç»ƒä»»åŠ¡"><a href="#é¢„è®­ç»ƒä»»åŠ¡" class="headerlink" title="é¢„è®­ç»ƒä»»åŠ¡"></a>é¢„è®­ç»ƒä»»åŠ¡</h4><h5 id="Task1-Masked-LM"><a href="#Task1-Masked-LM" class="headerlink" title="Task1: Masked LM"></a>Task1: Masked LM</h5><p>ä¸ºäº†æ„å»ºä¸€ä¸ªæ·±å±‚çš„çœŸåŒå‘è¯­è¨€æ¨¡å‹ï¼Œä½†æ˜¯æ ‡å‡†çš„è¯­è¨€æ¨¡å‹æ˜¯ä½¿ç”¨äº†é©¬å°”å¯å¤«é“¾è¿›è¡Œçš„å•å‘ç¼–ç ï¼Œå³ä½¿ä½¿ç”¨ LTR ä¸ RTLï¼Œä½†ä¹Ÿæ˜¯å‡çš„åŒå‘ç¼–ç ï¼Œæ€§èƒ½ä¼šå—åˆ°æå¤§çš„å½±å“ã€‚ä½¿ç”¨å®Œå½¢å¡«ç©ºæœºåˆ¶å¯ä»¥é¿å…æ ‡å‡†çš„è¯­è¨€æ¨¡å‹çš„ç¼–ç ç“¶é¢ˆã€‚<br><strong>å®Œå½¢å¡«ç©ºç­–ç•¥</strong>ï¼šéšæœºçš„ mask æ‰ 15% çš„å•è¯ï¼Œç„¶åä½¿ç”¨ç¼–ç å™¨æœ€åçš„ hidden state è¿‡ä¸€å±‚ softmax è¿›è¡Œå®Œå½¢å¡«ç©ºé¢„æµ‹ã€‚<br>ä½†æ˜¯è¿™ç§ç­–ç•¥ä¼šæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œä»¥ä¸‹æ˜¯å†…å®¹å’Œè§£å†³æ–¹æ¡ˆï¼š</p><h6 id="Downside-1-mismatch"><a href="#Downside-1-mismatch" class="headerlink" title="Downside 1: mismatch"></a>Downside 1: mismatch</h6><p>è¿™æ ·åšæ„é€ äº†ä¸€ç§ <strong>mismatch</strong>ï¼šå› ä¸º <code>[MASK]</code> æ°¸è¿ä¸ä¼šå‡ºç°åœ¨ fine-tuning é˜¶æ®µï¼Œæ‰€ä»¥ pre-training ä¸ fine-tuning å‡ºç°äº† mismatchã€‚<br>ç¼“è§£æ–¹æ¡ˆï¼šå¯¹äºéšæœºé€‰æ‹©çš„ 15% å¾… mask å•è¯ï¼Œä¸æ˜¯ç›´æ¥å°†å®ƒæ›¿æ¢ä¸º <code>[MASK]</code>ï¼Œè€Œæ˜¯å†åšä¸€æ¬¡éšæœºï¼š</p><ul><li>80%ï¼šå°†è¯¥è¯æ›¿æ¢ä¸º <code>[MASK]</code></li><li>10%ï¼šå°†è¯¥è¯æ›¿æ¢ä¸ºä¸€ä¸ªéšæœºçš„è¯è¯­</li><li>10%ï¼šä¸æ›¿æ¢</li></ul><p>åŸå› ï¼šTransformer Encoder ä¸çŸ¥é“å“ªä¸ªå•è¯è¢«è¦æ±‚åšé¢„æµ‹ï¼Œå“ªä¸ªå•è¯è¢«éšæœºæ›¿æ¢æ‰äº†ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªè¾“å…¥çš„å•è¯ï¼Œå®ƒéƒ½å¿…é¡»ä¿æŒä¸Šä¸‹æ–‡åµŒå…¥ï¼›è€Œä¸”ï¼Œç°åœ¨è¿™ç§ç­–ç•¥ä¸‹éšæœºæ›¿æ¢æ‰çš„å•è¯åªæœ‰ 1.5%ï¼Œå‡ ä¹ä¸ä¼šå½±å“æ¨¡å‹çš„è¯­è¨€å»ºæ¨¡èƒ½åŠ›ã€‚ï¼ˆå…¶å®è¿™éƒ¨åˆ†è§£é‡Šæœ‰ç‚¹ç‰µå¼ºï¼Œæœ‰å¾…æ·±åˆ»ç†è§£ï¼‰</p><h6 id="Downside-2-slower"><a href="#Downside-2-slower" class="headerlink" title="Downside 2: slower"></a>Downside 2: slower</h6><p>ç°åœ¨ä½¿ç”¨çš„ MLM æ¨¡å‹ï¼Œæ¯ä¸ª batch åªæœ‰ 15% çš„å•è¯è¢«é¢„æµ‹ï¼Œæ‰€ä»¥æ”¶æ•›é€Ÿåº¦ç¡®å®æ…¢äº†ã€‚ä½†æ˜¯æ•ˆæœå¸¦æ¥çš„æå‡å´å¾ˆå¤§ã€‚</p><h5 id="Task2-Next-Sentence-Prediction"><a href="#Task2-Next-Sentence-Prediction" class="headerlink" title="Task2: Next Sentence Prediction"></a>Task2: Next Sentence Prediction</h5><p>NLP ä¸­æœ‰å¾ˆå¤š<strong>å¥å­å…³ç³»</strong>æ€§çš„ä»»åŠ¡ï¼Œè¿™éƒ¨åˆ†çš„èƒ½åŠ›ä¸èƒ½é€šè¿‡ Task1 çš„ MLM æ¥ä¿˜è·åˆ°ï¼Œæ‰€ä»¥åŠ å…¥äº†ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡è¿›è¡Œå¤šä»»åŠ¡å­¦ä¹ ã€‚<br>ç­–ç•¥ï¼š50% çš„å¥å­å¯¹ï¼Œå°†ç¬¬äºŒå¥æ›¿æ¢ä¸ºéšæœºçš„å¥å­æ¥æ„å»ºè´Ÿæ ·æœ¬ã€‚</p><h4 id="å…¶ä»–ç»†èŠ‚"><a href="#å…¶ä»–ç»†èŠ‚" class="headerlink" title="å…¶ä»–ç»†èŠ‚"></a>å…¶ä»–ç»†èŠ‚</h4><ul><li>è®­ç»ƒè¯­æ–™ï¼šBooksCorpus (800M words) + English Wikipedia (2,500M words)</li><li>batch sizeï¼š256</li><li>Adamï¼šÎ³=1eâˆ’4,Î²1=0.9,Î²2=âˆ’.999ï¼Œwarmup</li><li>dropoutï¼š0.1</li><li>GELU</li><li>lossï¼šä¸¤ä¸ªä»»åŠ¡çš„ loss å’Œ</li></ul><h3 id="ä¸‹æ¸¸ç›‘ç£ä»»åŠ¡å¾®è°ƒ"><a href="#ä¸‹æ¸¸ç›‘ç£ä»»åŠ¡å¾®è°ƒ" class="headerlink" title="ä¸‹æ¸¸ç›‘ç£ä»»åŠ¡å¾®è°ƒ"></a>ä¸‹æ¸¸ç›‘ç£ä»»åŠ¡å¾®è°ƒ</h3><p><img src="/2020/08/27/bert-yuan-li/3.png"></p><ul><li><p>å•å¥/å¥å­å¯¹åˆ†ç±»ä»»åŠ¡ï¼šç›´æ¥ä½¿ç”¨ <code>[CLS]</code> çš„ hidden state è¿‡ä¸€å±‚ softmax è¿›è¡Œé¢„æµ‹ï¼›</p></li><li><p>QA ä»»åŠ¡ï¼šå°†é—®é¢˜å’Œç­”æ¡ˆæ‰€åœ¨çš„æ®µæ‹¼æ¥èµ·æ¥ï¼Œä½¿ç”¨æœ€åçš„ç­”æ¡ˆæ®µçš„ hidden state å‘é‡æ¥è®¡ç®—æŸä¸ªå•è¯æ˜¯ç­”æ¡ˆå¼€å§‹å•è¯å’Œç»“æŸå•è¯çš„æ¦‚ç‡ï¼Œè¿›è€Œè¿›è¡Œé¢„æµ‹ã€‚</p><p>$\begin{align*}<br>P^S_i&amp;=\frac{e^{S\cdot T_i}}{\sum_j{e^{S\cdot T_j}}} \<br>P^E_i&amp;=\frac{e^{E\cdot T_i}}{\sum_j{e^{E\cdot T_j}}}<br>\end{align*}$</p></li><li><p>å…¶ä¸­ï¼ŒS å’Œ E æ˜¯éœ€è¦ä¸‹æ¸¸ fine-tuning é˜¶æ®µè®­ç»ƒçš„å¼€å§‹å‘é‡å’Œç»“æŸå‘é‡ã€‚åœ¨æ¨æ–­é˜¶æ®µï¼Œä¼šå¼ºè¡Œé™åˆ¶ç»“æŸçš„ä½ç½®å¿…é¡»åœ¨å¼€å§‹çš„ä½ç½®ä¹‹åã€‚</p></li><li><p>åºåˆ—æ ‡æ³¨ä»»åŠ¡ï¼šç›´æ¥å°†åºåˆ—æ‰€æœ‰ token çš„æœ€åä¸€å±‚ hidden state å–‚è¿›ä¸€ä¸ªåˆ†ç±»å±‚ï¼ˆæ²¡æœ‰ä½¿ç”¨è‡ªå›å½’ã€CRFï¼‰</p></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢„è®­ç»ƒæ¨¡å‹ </tag>
            
            <tag> Encoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TransformeråŸç†</title>
      <link href="/2020/08/26/transformer-yuan-li/"/>
      <url>/2020/08/26/transformer-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½è‡³ã€€<a href="https://zhuanlan.zhihu.com/p/44121378">https://zhuanlan.zhihu.com/p/44121378</a></p><p>ã€€ã€€ã€€ã€€<a href="https://zhuanlan.zhihu.com/p/43493999">https://zhuanlan.zhihu.com/p/43493999</a></p><h1 id="TransformeråŸç†"><a href="#TransformeråŸç†" class="headerlink" title="TransformeråŸç†"></a>TransformeråŸç†</h1><p>Paper <a href="https://arxiv.org/abs/1706.03762">Attention is All You Need</a></p><p>Code <a href="https://github.com/harvardnlp/annotated-transformer">torch</a></p><h2 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h2><p><img src="/2020/08/26/transformer-yuan-li/1.jpg"></p><p>â€‹         å’Œå¤§å¤šæ•°seq2seqæ¨¡å‹ä¸€æ ·ï¼Œtransformerçš„ç»“æ„ä¹Ÿæ˜¯ç”±encoderå’Œdecoderç»„æˆã€‚åœ¨Encoderæ–¹é¢ï¼Œ6ä¸ªç¼–ç å™¨ç»„ä»¶ååŒå·¥ä½œï¼Œç»„æˆä¸€ä¸ªå¤§çš„ç¼–ç å™¨ï¼Œè§£ç å™¨åŒæ ·ç”±6ä¸ªè§£ç å™¨ç»„ä»¶ç»„æˆã€‚æˆ‘ä»¬å…ˆçœ‹Encoderã€‚6ä¸ªç¼–ç å™¨ç»„ä»¶ä¾æ¬¡æ’åˆ—ï¼Œæ¯ä¸ªç»„ä»¶å†…éƒ¨éƒ½æ˜¯ç”±ä¸€ä¸ªå¤šå¤´attentionåŠ ä¸Šä¸€ä¸ªå‰é¦ˆç½‘ç»œï¼Œattenionå’Œå‰é¦ˆçš„è¾“å‡ºéƒ½ç»è¿‡å±‚å½’ä¸€åŒ–ï¼ˆLayerNormalizationï¼‰ï¼Œå¹¶ä¸”éƒ½æœ‰å„è‡ªçš„æ®‹å·®ç½‘ç»œ ã€‚Decoderå‘¢ï¼Œç»„ä»¶çš„é…ç½®åŸºæœ¬ç›¸åŒï¼Œ ä¸åŒçš„æ˜¯Decoderæœ‰ä¸¤ä¸ªå¤šå¤´attentionæœºåˆ¶ï¼Œä¸€ä¸ªæ˜¯å…¶è‡ªèº«çš„maskè‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ä»Encoderåˆ°Decoderçš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œè€Œä¸”æ˜¯Decoderå†…éƒ¨å…ˆåšä¸€æ¬¡attentionåå†æ¥æ”¶Encoderçš„è¾“å‡ºã€‚</p><h3 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h3><p>Encoderç”±N=6ä¸ªç›¸åŒçš„layerç»„æˆï¼ŒlayeræŒ‡çš„å°±æ˜¯ä¸Šå›¾å·¦ä¾§çš„å•å…ƒï¼Œæœ€å·¦è¾¹æœ‰ä¸ªâ€œNxâ€ï¼Œè¿™é‡Œæ˜¯x6ä¸ªã€‚æ¯ä¸ªLayerç”±ä¸¤ä¸ªsub-layerç»„æˆï¼Œåˆ†åˆ«æ˜¯multi-head self-attention mechanismå’Œfully connected feed-forward networkã€‚å…¶ä¸­æ¯ä¸ªsub-layeréƒ½åŠ äº†residual connectionå’Œnormalisationï¼Œå› æ­¤å¯ä»¥å°†sub-layerçš„è¾“å‡ºè¡¨ç¤ºä¸ºï¼š</p><p>sub_layer_output = LayerNorm( + (subLayer(x)))</p><ul><li><strong>Self-Attention</strong></li></ul><p><img src="/2020/08/26/transformer-yuan-li/2.jpg"></p><p>ä¸Šå›¾ä¸­å·¦è¾¹æ˜¯ä¸€ä¸ªRNNæ¨¡å‹ï¼ŒTransformerçš„æ ¸å¿ƒå°±æ˜¯å°†éœ€è¦æŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œè®¡ç®—çš„RNNå˜ä¸ºå³è¾¹å¯ä»¥å¹¶è¡ŒåŒ–çš„Self-Attentionã€‚</p><p>æ¥ä¸‹æ¥è¯¦ç»†è¯´æ˜Self-Attentionæ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚</p><p><img src="/2020/08/26/transformer-yuan-li/3.jpg"></p><p>ä¸Šå›¾ä¸­x1ã€x2ã€x3ã€x4æ˜¯å•è¯çš„one-hotå½¢å¼ï¼Œå¤„ç†åå¾—åˆ°Embeddingå½¢å¼çš„a1ã€a2ã€a3ã€a4ä½œä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œè¿™ä¸€æ­¥å®é™…ä¸Šå°±æ˜¯word2vecè¿‡ç¨‹ã€‚</p><p>a1ã€a2ã€a3ã€a4åˆ†åˆ«ä¹˜ä¸Šä¸€äº›çŸ©é˜µï¼ˆå°±æ˜¯å¯¹ä¸¤å±‚ç¥ç»å…ƒè¿›è¡Œå…¨è¿æ¥æ“ä½œï¼Œè®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼‰å¾—åˆ°å„è‡ªçš„qã€kã€vï¼Œqç›¸å½“äº<strong>query</strong>ç”¨æ¥åŒ¹é…kï¼Œkç›¸å½“äº<strong>key</strong>ç”¨æ¥è¢«qåŒ¹é…ï¼Œvç›¸å½“äº<strong>value</strong>æŒ‡è¢«ç”¨æ¥æå–çš„ä¿¡æ¯ï¼Œå…·ä½“æ€ä¹ˆç”¨åè¾¹ä¼šè¯´ã€‚è¿™é‡Œçœ‹ä¸æ˜ç™½æ²¡æœ‰å…³ç³»ï¼Œåªéœ€è¦çŸ¥é“æœ‰è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿å°±å¯ä»¥äº†ï¼Œä¸‹é¢ç”¨åˆ°çš„æ—¶å€™å†è¿”å›æ¥çœ‹ä¸€ä¸‹å°±å¥½ã€‚</p><img src="/2020/08/26/transformer-yuan-li/4.jpg" style="zoom:50%;"><p>ç„¶åè¦åšçš„å°±æ˜¯<strong>ç”¨æ¯ä¸ª query q å»å¯¹æ¯ä¸ª key k åš attention</strong>ï¼Œè¿™ä¸ªattentionçš„æ ¸å¿ƒå°±æ˜¯åŒ¹é…qå’Œkç„¶å<strong>è¾“å‡ºå¾—åˆ†Î±</strong>ï¼ˆå¯å°†æ­¤æ­¥çœ‹ä½œæ˜¯è®¡ç®—äºŒè€…çš„ç›¸ä¼¼åº¦ï¼‰ã€‚é¦–å…ˆç”¨q1åˆ†åˆ«å»attention k1ã€k2ã€k3ã€k4å¾—åˆ°Î±1,1ã€Î±1,2ã€Î±1,3ã€Î±1,4ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/08/26/transformer-yuan-li/5.jpg"></p><p>Î±çš„è®¡ç®—å…¬å¼å¦‚ä¸‹</p><img src="/2020/08/26/transformer-yuan-li/6.jpg" style="zoom:50%;"><p>è¿™é‡Œåˆ†æ¯ä¸Šçš„$\sqrt(d)$ç›¸å½“äºå¯¹è®¡ç®—ç»“æœè¿›è¡Œäº†ä¸€æ¬¡ç¼©æ”¾ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯$\sqrt(d)$ åŸè®ºæ–‡ä½œè€…ä¹Ÿæ²¡æœ‰è¯¦ç»†è§£é‡Šï¼Œä¸€èˆ¬å°±ç›´æ¥é»˜è®¤ä½¿ç”¨è¿™ä¸ªå€¼äº†ã€‚</p><p>å¾—åˆ°Î±1,1ã€Î±1,2ã€Î±1,3ã€Î±1,4åè¿›è¡Œsoftmaxå¤„ç†è·å¾—$\widehat{\alpha} _{1,1} ã€€ \widehat{\alpha} _{1,2}  ã€€\widehat{\alpha} _{1,3}ã€€  \widehat{\alpha} _{1,4}$å¦‚ä¸‹ï¼š</p><p><img src="/2020/08/26/transformer-yuan-li/7.jpg"></p><p>è¿˜è®°ä¸è®°å¾—æˆ‘ä»¬å‰é¢è®²è¿‡Î±æ˜¯q1å¯¹æ¯ä¸ªkåšçš„attentionåŒ¹é…ï¼Œé‚£ä¹ˆè¿™é‡Œçš„$\widehat{\alpha} _{1,1} ã€€ \widehat{\alpha} _{1,2}  ã€€\widehat{\alpha} _{1,3}ã€€  \widehat{\alpha} _{1,4}$ å°±<strong>ç›¸å½“äºè·å¾—äº†ä¸€ç³»åˆ—é’ˆå¯¹v1ã€v2ã€v3ã€v4çš„æƒé‡</strong>ï¼Œæƒé‡å’Œå¯¹åº”çš„å€¼éƒ½æœ‰äº†å°±è‡ªç„¶è€Œç„¶æƒ³åˆ°äº†<strong>åŠ æƒå¹³å‡</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—åˆ°äº†è¾“å‡ºseqçš„ç¬¬ä¸€ä¸ªç»“æœb1ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2020/08/26/transformer-yuan-li/8.jpg"></p><p>ä»è¿‡ç¨‹é‡Œä¸éš¾å‘ç°ï¼Œè¿™é‡Œ<strong>b1çš„äº§ç”Ÿå…¶å®attendåˆ°äº†æ•´ä¸ªå¥å­çš„æ‰€æœ‰ä¿¡æ¯</strong>ï¼Œè¿™å°±æ˜¯Self-Attentionçš„å¦™ç”¨ï¼Œå®Œç¾è§£å†³äº†ä¹‹å‰RNNã€LSTMç­‰å¯¹äºé•¿è·ç¦»å•è¯æ— æ³•attendåˆ°çš„é—®é¢˜ã€‚</p><p>åˆšæ‰æˆ‘ä»¬åªè®¡ç®—äº†b1ï¼Œå¯¹äºåé¢çš„b2ï¼ˆå¦‚ä¸‹ï¼‰ã€b3ã€â€¦â€¦ç±»ä¼¼ï¼Œè€Œä¸”ä¸éš¾å‘ç°ï¼Œè¿™äº›è®¡ç®—è¿‡ç¨‹å®Œå…¨å¯ä»¥åŒæ—¶è¿›è¡Œï¼Œä¸åƒä¹‹å‰çš„RNNå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ç»™å®šåºåˆ—ä¾æ¬¡è®¡ç®—ã€‚</p><p><img src="/2020/08/26/transformer-yuan-li/9.jpg"></p><p>é‚£ä¹ˆæˆ‘ä»¬å†å›åˆ°Self-Attention Layerä¸­ï¼ŒæŠŠæ‰€æœ‰å‚æ•°è€ƒè™‘è¿›æ¥æ•´ä¸ªæµç¨‹å†™æˆçŸ©é˜µçš„å½¢å¼å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><p><img src="/2020/08/26/transformer-yuan-li/10.jpg"></p><p>åæ­£å°±æ˜¯ä¸€å †çŸ©é˜µä¹˜æ³•ï¼Œè€Œè¿™æ°æ°æ˜¯GPUéå¸¸æ“…é•¿çš„è¿ç®—ã€‚</p><ul><li><strong>Multi-head Self-attention</strong></li></ul><p>å°†å•ä¸ªSelf-attentionè¿›è¡Œåˆ†è£‚å°±å¾—åˆ°Multi-head Self-attentionï¼Œè¿™é‡Œä»¥2ä¸ªheadsä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼ˆå®é™…ä½¿ç”¨æ—¶headæ•°ç›®ä¹Ÿæ˜¯éœ€è¦ä½œä¸ºå‚æ•°è¿›è¡Œè°ƒçš„ï¼‰ã€‚</p><p><img src="/2020/08/26/transformer-yuan-li/11.jpg"></p><p>ä¸Šå›¾å°† $q ^i$ åˆ†åˆ«ä¹˜2ä¸ªä¸åŒçš„çŸ©é˜µå°±å¾—åˆ°å°† $q ^{i,1}$ å’Œ $q ^{i,2}$ ï¼Œkå’Œvçš„å¤„ç†è¿‡ç¨‹ç±»ä¼¼ï¼Œç„¶åæŒ‰ç…§Self-attentionçš„æµç¨‹æœ€ç»ˆå¾—åˆ°å°† $b ^{i,1}$ ï¼ŒåŒç†è·å¾— $b ^{i,2}$ ï¼Œ</p><p><img src="/2020/08/26/transformer-yuan-li/12.jpg"></p><p>å¾—åˆ°çš„ $b ^{i,1}$ å’Œ $b ^{i,2}$ å¯ä»¥ç›´æ¥è¿æ¥å½¢æˆ $b ^{i}$ ï¼Œå½“ç„¶å¦‚æœå¯¹è¿æ¥äº§ç”Ÿçš„ç»´åº¦ä¸æ»¡æ„ä¹Ÿå¯ä»¥ç»§ç»­ä¹˜ä¸Šä¸ªçŸ©é˜µè¿›è¡Œé™ç»´ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><img src="/2020/08/26/transformer-yuan-li/13.jpg" style="zoom:67%;"><p>ä¸ºä»€ä¹ˆéœ€è¦å¤šheadså‘¢ï¼Ÿå› ä¸º<strong>ä¸åŒheadä¹‹é—´attentionçš„ç‚¹å¯èƒ½ä¸å¤ªä¸€æ ·</strong>ï¼Œæ¯”å¦‚æœ‰çš„headæ›´é‡è§†å’Œè‡ªå·±é‚»è¿‘ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼Œè€Œå…¶ä»–çš„headå¯èƒ½æ›´å®¹æ˜“æ³¨æ„åˆ°å…¨å±€ä¿¡æ¯ï¼Œè¿™æ ·è®¸å¤šheadså°±å¯ä»¥å„å¸å…¶èŒè¿›è¡Œæ›´å¤æ‚çš„ä»»åŠ¡ã€‚</p><ul><li><p><strong>The Residual Connection æ®‹å·®è¿æ¥</strong></p><p>â€‹       sublayeræœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¤šå¤´self-attentionå±‚ï¼Œå¦ä¸€ä¸ªæ˜¯å‰é¦ˆç½‘ç»œï¼ˆfeed_forwardï¼‰ã€‚è¾“å…¥xå…ˆè¿›å…¥å¤šå¤´self-attentionï¼Œç”¨ä¸€ä¸ªæ®‹å·®ç½‘ç»œåŠ æˆï¼Œæ¥ç€é€šè¿‡å‰é¦ˆç½‘ç»œï¼Œ å†ç”¨ä¸€ä¸ªæ®‹å·®ç½‘ç»œåŠ æˆã€‚</p><p>è®©æˆ‘ä»¬ä»è¾“å…¥xå¼€å§‹ï¼Œå†ä»å¤´ç†ä¸€éè¿™ä¸ªè¿‡ç¨‹:</p><img src="/2020/08/26/transformer-yuan-li/16.png" style="zoom:67%;"><img src="/2020/08/26/transformer-yuan-li/18.png" style="zoom:67%;"></li></ul><ul><li>è¾“å…¥x</li><li>xåšä¸€ä¸ªå±‚å½’ä¸€åŒ–ï¼š x1 = norm(x)</li><li>è¿›å…¥å¤šå¤´self-attention: x2 = self_attn(x1)</li><li>æ®‹å·®åŠ æˆï¼šx3 = x + x2</li><li>å†åšä¸ªå±‚å½’ä¸€åŒ–ï¼šx4 = norm(x3)</li><li>ç»è¿‡å‰é¦ˆç½‘ç»œ: x5 = feed_forward(x4)</li><li>æ®‹å·®åŠ æˆ: x6 = x3 + x5</li><li>è¾“å‡ºx6</li></ul><ul><li><strong>å±‚å½’ä¸€åŒ–</strong></li></ul><p><strong>BatchNormalization</strong></p><p>â€‹       BatchNormalizationçš„å‡ºç°æ— ç–‘æ˜¯å¹¿å¤§AIè°ƒå‚ä¾ çš„ç¦éŸ³ï¼Œå°†å¤§å®¶ä»ç¹ççš„æƒé‡åˆå§‹åŒ–ã€å­¦ä¹ ç‡è°ƒèŠ‚ä¸­é‡Šæ”¾å‡ºæ¥ã€‚å®ƒä¸ä»…èƒ½å¤Ÿå¤§å¤§åŠ å¿«æ”¶æ•›é€Ÿåº¦ï¼Œè¿˜è‡ªå¸¦æ­£åˆ™åŒ–åŠŸèƒ½ï¼Œæ˜¯Google 2015å¹´æå‡ºçš„ã€‚</p><p>æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªé‡è¦çš„å‡è®¾æ˜¯ï¼š<strong>æ•°æ®æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„</strong>ã€‚è®­ç»ƒé›†åˆæµ‹è¯•é›†çš„æ•°æ®æ˜¯åŒåˆ†å¸ƒçš„ï¼Œè¿™æ ·æ¨¡å‹æ‰æœ‰å¥½çš„æ³›åŒ–æ•ˆæœã€‚ç¥ç»ç½‘ç»œå…¶å®ä¹Ÿæ˜¯åœ¨å­¦ä¹ è¿™ä¸ªåˆ†å¸ƒã€‚åœ¨è¿™ä¸ªå‡è®¾å‰æä¸‹ï¼Œä¸€æ—¦æˆ‘ä»¬çŸ¥é“äº†ï¼ˆxï¼Œyï¼‰çš„è”åˆåˆ†å¸ƒï¼Œå¾ˆå¤šé—®é¢˜å°±èƒ½é€šè¿‡æ¡ä»¶æ¦‚ç‡P(xâˆ£y)P(x|y)P(xâˆ£y)è®¡ç®—å‡ºæ¥äº†ã€‚ä½†æ˜¯åœ¨å®é™…è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ•°æ®ç»è¿‡å‰ä¸€ä¸ªéšè—å±‚å‘åä¸€ä¸ªéšè—å±‚ä¼ æ’­ï¼ˆçº¿æ€§+éçº¿æ€§è¿ç®—ï¼‰ï¼Œåˆ†å¸ƒé€šå¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼ˆä½œè€…ç§°ä¹‹ä¸º<strong>Internal Covariate Shift</strong>ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ç½‘ç»œå­¦ä¹ å˜æ…¢ã€‚</p><p>â€‹         å¯¹æ¯ä¸€ä¸ªMini-Batchçš„æ‰€æœ‰æ ·æœ¬çš„æ¯ä¸€ç»´ç‰¹å¾ï¼Œè®¡ç®—ä¸¤ä¸ªç»Ÿè®¡é‡ï¼šå‡å€¼å’Œæ–¹å·®ï¼Œç„¶ååšä¸€ä¸ªå½’ä¸€åŒ–æ“ä½œ,è¿™æ ·å°±å˜æˆäº†æ­£æ€åˆ†å¸ƒäº†ã€‚ä½†æ˜¯åªè¿™æ ·åšä¹Ÿæœ‰é—®é¢˜ï¼Œé¦–å…ˆï¼Œè°è¯´æ•°æ®ä¸€å®šæ˜¯æ­£æ€åˆ†å¸ƒçš„ï¼Œåæ­£æ€ä¸è¡Œå—ï¼Ÿç¬¬äºŒï¼ŒæŠŠæ•°æ®å…¨éƒ¨æ‹‰åˆ°æ¥è¿‘0çš„ä½ç½®ï¼Œsigmoidä¸å°±æ¥è¿‘äºä¸€ä¸ªçº¿æ€§å‡½æ•°äº†å—ï¼Œæ²¡æœ‰èµ·åˆ°æ¿€æ´»çš„ä½œç”¨å•Šï¼ˆçº¿æ€§æ¿€æ´»å‡½æ•°+çº¿æ€§æ“ä½œç­‰ä»·äºä¸€å±‚çº¿æ€§æ“ä½œï¼‰ã€‚</p><img src="/2020/08/26/transformer-yuan-li/19.png" style="zoom:67%;"><p><strong>LayerNormalization</strong></p><ul><li>å¯¹batch_sizeéå¸¸æ•æ„Ÿã€‚BatchNormalizationçš„ä¸€ä¸ªé‡è¦å‡ºå‘ç‚¹æ˜¯ä¿æŒæ¯å±‚è¾“å…¥çš„æ•°æ®åŒåˆ†å¸ƒã€‚å›æƒ³ä¸‹å¼€å§‹é‚£ä¸ªç‹¬ç«‹åŒåˆ†å¸ƒçš„å‡è®¾ã€‚å‡å¦‚å–çš„batch_sizeå¾ˆå°ï¼Œé‚£æ˜¾ç„¶æœ‰äº›Mini-Batchçš„æ•°æ®åˆ†å¸ƒå°±å¾ˆå¯èƒ½ä¸æ•´ä¸ªæ•°æ®é›†çš„åˆ†å¸ƒä¸ä¸€è‡´äº†ï¼Œåˆå‡ºç°äº†é‚£ä¸ªé—®é¢˜ï¼Œæ•°æ®åˆ†å¸ƒä¸ä¸€è‡´ï¼Œè¿™å°±ç­‰äºè¯´æ²¡èµ·åˆ°åŒåˆ†å¸ƒçš„ä½œç”¨äº†ï¼Œæˆ–è€…è¯´åŒåˆ†å¸ƒå¾—ä¸å……åˆ†ã€‚å®éªŒä¹Ÿè¯æ˜ï¼Œbatch_sizeå–å¾—å¤§ä¸€ç‚¹ï¼Œ æ•°æ®shuffleçš„å¥½ä¸€ç‚¹ï¼ŒBatchNormalizationçš„æ•ˆæœå°±è¶Šå¥½ã€‚</li><li>ä¸èƒ½å¾ˆæ–¹ä¾¿åœ°ç”¨äºRNNã€‚è¿™å…¶å®æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜çš„å¼•ç”³ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹<strong>Figure 6</strong>ä¸­çš„å‡å€¼å’Œæ–¹å·®çš„è®¡ç®—å…¬å¼ã€‚å¯¹æ‰€æœ‰æ ·æœ¬æ±‚å‡å€¼ã€‚å¯¹äºå›¾ç‰‡è¿™ç±»ç­‰é•¿çš„è¾“å…¥æ¥è¯´ï¼Œè¿™å¾ˆå®¹æ˜“æ“ä½œï¼Œåœ¨æ¯ä¸ªç»´åº¦åŠ åŠ é™¤é™¤å°±å¯ä»¥äº†ï¼Œå› ä¸ºç»´åº¦æ€»æ˜¯ä¸€è‡´çš„ã€‚è€Œå¯¹äºä¸ç­‰é•¿çš„æ–‡æœ¬æ¥è¯´ï¼ŒRNNä¸­çš„æ¯ä¸ªtime stepå…±äº«äº†åŒä¸€ç»„æƒé‡ã€‚åœ¨åº”ç”¨BatchNormalizationæ—¶ï¼Œè¿™å°±è¦æ±‚å¯¹æ¯ä¸ªtime stepçš„batch_sizeä¸ªè¾“å…¥è®¡ç®—ä¸€ä¸ªå‡å€¼å’Œæ–¹å·®ã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªå¥å­Séå¸¸é•¿ï¼Œé‚£å°±æ„å‘³ç€å¯¹Sè€Œè¨€ï¼Œæ€»ä¼šæœ‰ä¸ªtime_stepçš„batch_sizeä¸º1ï¼Œå‡å€¼æ–¹å·®æ²¡æ„ä¹‰ï¼Œè¿™å°±å¯¼è‡´äº†BatchNormalizationåœ¨RNNä¸Šæ— ç”¨æ­¦ä¹‹åœ°äº†</li></ul><p>LayerNormalizationçš„ä¸»è¦å˜åŒ–åœ¨äºï¼š</p><ul><li><p>ä¸å†å¯¹Mini-Batchä¸­çš„Nçš„æ ·æœ¬åœ¨å„ä¸ªç»´åº¦åšå½’ä¸€åŒ–ï¼Œè€Œæ˜¯é’ˆå¯¹åŒä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒåšå½’ä¸€åŒ–ã€‚å½’ä¸€åŒ–å…¬å¼ä¸ºï¼š$\mu ^1 =  \frac {1}{H} \sum _{H} ^{1}{\alpha _i ^1}$</p><p>$\sigma ^1 = \sqrt{\frac {1} {H} { \sum _{H} ^{1} (\alpha _i ^1 - \mu _i ^1)}} $</p><p>å…¶ä¸­ï¼ŒHæŒ‡çš„æ˜¯ä¸€å±‚ç¥ç»ç½‘ç»œçš„ç¥ç»å…ƒä¸ªæ•°ã€‚æˆ‘ä»¬å†å›æƒ³ä¸‹BatchNormalizationï¼Œå…¶å®å®ƒæ˜¯åœ¨æ¯ä¸ªç¥ç»å…ƒä¸Šå¯¹batch_sizeä¸ªæ•°æ®åšå½’ä¸€åŒ–ï¼Œæ¯ä¸ªç¥ç»å…ƒçš„å‡å€¼å’Œæ–¹å·®å‡ä¸ç›¸åŒã€‚è€ŒLayerNormalizationåˆ™æ˜¯å¯¹<strong>æ‰€æœ‰ç¥ç»å…ƒ</strong>åšä¸€ä¸ªå½’ä¸€åŒ–ï¼Œè¿™å°±è·Ÿbatch_sizeæ— å…³äº†ã€‚å“ªæ€•batch_sizeä¸º1ï¼Œè¿™é‡Œçš„å‡å€¼å’Œæ–¹å·®åªå’Œç¥ç»å…ƒçš„ä¸ªæ•°æœ‰å…³ç³»</p></li><li><p>æµ‹è¯•çš„æ—¶å€™å¯ä»¥ç›´æ¥åˆ©ç”¨LNï¼Œæ‰€ä»¥è®­ç»ƒæ—¶ä¸ç”¨ä¿å­˜å‡å€¼å’Œæ–¹å·®ï¼Œè¿™èŠ‚çœäº†å†…å­˜ç©ºé—´</p></li></ul><img src="/2020/08/26/transformer-yuan-li/20.png" style="zoom:67%;"><p>â€‹         ç¤ºæ„äº†ä¸¤ç§æ–¹å¼çš„åŒºåˆ«ã€‚å‡è®¾æœ‰Nä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬çš„ç‰¹å¾ç»´åº¦ä¸º4ï¼Œå›¾ä¸­æ¯ä¸ªå°åœ†ä»£è¡¨ä¸€ä¸ªç‰¹å¾ï¼Œç‰¹å¾1ï¼Œç‰¹å¾2ç­‰ç­‰ï¼Œç‰¹å¾4ã€‚BatchNormalizationæ˜¯åœ¨Nä¸ªåŒä¸€ç‰¹å¾ï¼ˆå¦‚ç‰¹å¾1ï¼‰ä¸Šæ±‚å‡å€¼å’Œæ–¹å·®ï¼Œè¿™é‡Œè¦å¯¹æ¯ä¸ªç‰¹å¾æ±‚1æ¬¡ï¼Œå…±4æ¬¡ã€‚å¯¹ç…§ä¸€ä¸‹ä¸Šé¢è¯´çš„ï¼Œä¸‡ä¸€æœ‰ä¸ªæ ·æœ¬æœ‰5ä¸ªç‰¹å¾ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡æ³•ç©äº†ã€‚LayerNormalizationå‘¢ï¼Œåˆ«çš„æ ·æœ¬éƒ½å’Œæˆ‘æ²¡å•¥å…³ç³»ï¼Œæœ‰å¤šå°‘ä¸ªç‰¹å¾æˆ‘æŠŠè¿™äº›ç‰¹å¾æ±‚ä¸ªå‡å€¼æ–¹å·®å°±å¥½äº†ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªå«â€æ‰¹å½’ä¸€åŒ–â€œï¼Œå¦ä¸€ä¸ªå«â€å±‚å½’ä¸€åŒ–â€œäº†ã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œä¹Ÿå°±ç†è§£äº†ä¸ºä»€ä¹ˆTransformerä¸­ä½¿ç”¨LNè€Œä¸æ˜¯BNã€‚</p><p>â€‹        å½“ç„¶BatchNormalizationä¹Ÿä¸æ˜¯åƒç´ çš„ï¼Œè™½ç„¶å®ƒåœ¨å¤„ç†ä¸ç­‰é•¿åºåˆ—ä¸Šå­˜åœ¨å¤©ç”Ÿçš„ç¼ºé™·ï¼Œä½†æ˜¯é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒçš„æ•ˆæœéƒ½è¦å¥½äºå…¶ä»–Normalizationæ–¹å¼ï¼ˆæ¯”å¦‚LNï¼ŒWNï¼ŒINï¼‰ã€‚ç›´è§‰ä¸Šï¼ŒBNè²Œä¼¼æ›´å¥½ç†è§£ä¸€ç‚¹ï¼Œ</p><ul><li><p><strong>å‰é¦ˆç½‘ç»œ</strong></p><p>æ¯ä¸ªencoderLayerä¸­ï¼Œå¤šå¤´attentionåä¼šæ¥ä¸€ä¸ªå‰é¦ˆç½‘ç»œã€‚è¿™ä¸ªå‰é¦ˆç½‘ç»œå…¶å®æ˜¯ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œ:</p><p>â€‹     $FFN(x) = max(0,xW _1 + b _1)W _2 + b _2$</p><p>è¿™ä¸¤å±‚çš„ä½œç”¨ç­‰ä»·äºä¸¤ä¸ª kenerl_size=1çš„ä¸€ç»´å·ç§¯æ“ä½œã€‚</p></li></ul><ul><li><p><strong>è¯å‘é‡</strong></p><p>è¯å‘é‡ï¼Œå°†è¯è¯­å˜æˆd_modelç»´çš„å‘é‡ã€‚</p></li></ul><ul><li><strong>Positional Encoding</strong></li></ul><img src="/2020/08/26/transformer-yuan-li/14.jpg" style="zoom:67%;"><p>é¦–å…ˆ $p ^i$ é‡‡ç”¨one-hotå½¢å¼è¡¨ç¤ºç»™å®šè¯å‡ºç°çš„ä½ç½®ï¼Œå‡ºç°åœ¨ç¬¬iä¸ªä½ç½®å°±å°†å¯¹åº”ä½ç½®è®¾ä¸º1å…¶ä»–ç»´åº¦è®¾ä¸º0ï¼Œç„¶åé€šè¿‡çŸ©é˜µè¿ç®—å¾—åˆ°ä¸ $\alpha ^i$ ç›¸åŒç»´åº¦çš„ $e ^i$ çš„ï¼Œè¿™ä¸ª  $e ^i$  å°±åŒ…å«äº†å•è¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨ä¹‹å‰  $W ^p$  çš„åŸºç¡€ä¸Šç›´æ¥å°† $e ^i$ åŠ ä¸Šè¿›è¡Œè¿ç®—å³å¯ã€‚è¿™é‡Œæ¯”è¾ƒè¯¡å¼‚çš„åœ°æ–¹æ˜¯äº§ç”Ÿ $e ^i$ çš„  $W ^p$  çŸ©é˜µå¹¶ä¸æ˜¯è®­ç»ƒå¾—æ¥çš„ï¼Œè€Œæ˜¯é€šè¿‡äººå·¥æ‰‹åŠ¨ç»™å®šçš„ï¼Œè¿™ä¹Ÿæ˜¯åŸè®ºæ–‡æ¯”è¾ƒåŒªå¤·æ‰€æ€çš„ä¸€ä¸ªç‚¹äº†ã€‚ä¸‹å›¾æ˜¯æœ‰äººå°†è¿™ä¸ª  $W ^p$  çŸ©é˜µå¯è§†åŒ–åçš„æ ·å­:</p><img src="/2020/08/26/transformer-yuan-li/15.jpg" style="zoom:67%;"><p>â€‹        ç”±äºTransformeræ²¡æœ‰ç”¨åˆ°CNNå’ŒRNNï¼Œå› æ­¤ï¼Œå¥å­å•è¯ä¹‹é—´çš„ä½ç½®ä¿¡æ¯å°±æ²¡æœ‰åˆ©ç”¨åˆ°ã€‚æ˜¾ç„¶ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºç¿»è¯‘æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ŒåŒæ ·ä¸€å¥è¯ï¼Œæ¯ä¸ªå•è¯çš„æ„æ€èƒ½å¤Ÿå‡†ç¡®çš„ç¿»è¯‘å‡ºæ¥ï¼Œä½†å¦‚æœé¡ºåºä¸å¯¹ï¼Œè¡¨è¾¾å‡ºæ¥çš„æ„æ€å°±æˆªç„¶ä¸åŒäº†ã€‚ä¸¾ä¸ªæ —å­æ„Ÿå—ä¸€ä¸‹ï¼ŒåŸå¥ï¼šâ€A man went through the Big Buddhist Templeâ€œ, ç¿»è¯‘æˆï¼šâ€äººè¿‡å¤§ä½›å¯ºâ€œå’Œâ€å¯ºä½›å¤§è¿‡äººâ€œï¼Œæ„æ€å°±å®Œå…¨ä¸åŒäº†ã€‚</p><p>â€‹      é‚£ä¹ˆå¦‚ä½•è¡¨è¾¾ä¸€ä¸ªåºåˆ—çš„ä½ç½®ä¿¡æ¯å‘¢ï¼Ÿå¯¹äºæŸä¸€ä¸ªå•è¯æ¥è¯´ï¼Œä»–çš„ä½ç½®ä¿¡æ¯ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼šä¸€æ˜¯ç»å¯¹ä½ç½®ï¼ŒäºŒæ˜¯ç›¸å¯¹ä½ç½®ã€‚ç»å¯¹ä½ç½®å†³å®šäº†å•è¯åœ¨ä¸€ä¸ªåºåˆ—ä¸­çš„ç¬¬å‡ ä¸ªä½ç½®ï¼Œç›¸å¯¹ä½ç½®å†³å®šäº†åºåˆ—çš„æµå‘ã€‚ä½œè€…åˆ©ç”¨äº†æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°æ¥è¿›è¡Œä½ç½®ç¼–ç ï¼š</p><p>$PE_{(pos,2i)} = sin(pos / 10000^{2i/d_{\text{model}}})$</p><p>$PE_{(pos,2i+1)} = cos(pos / 10000^{2i/d_{\text{model}}}) $</p><p>å…¶ä¸­posæ˜¯å•è¯å¤„äºå¥å­çš„ç¬¬å‡ ä¸ªä½ç½®ã€‚æˆ‘ä»¬æ¥è€ƒå¯Ÿä¸€ä¸‹ç¬¬ä¸€ä¸ªå…¬å¼ï¼Œçœ‹æ˜¯å¦æ¯ä¸ªä½ç½®éƒ½èƒ½å¾—åˆ°ä¸€ä¸ªå”¯ä¸€çš„å€¼ä½œä¸ºç¼–ç ã€‚ä¸ºç®€å•èµ·è§ï¼Œä¸å¦¨ä»¤i=0ï¼Œé‚£ä¹ˆï¼š</p><p>$PE(pos,0)=sin(pos)$</p><p>æˆ‘ä»¬åè¿‡æ¥æƒ³ï¼Œå‡å¦‚å­˜åœ¨ä½ç½®jå’Œkçš„ç¼–ç å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±æœ‰ï¼š</p><p>$sin(i)=sin(j)$</p><p>$i, j ä¸ºéè´Ÿæ•´æ•°ä¸”ä¸ºéè´Ÿæ•´æ•°ä¸”ä¸ºéè´Ÿæ•´æ•°ä¸”iä¸ç­‰äºj$</p><p>ä»¥ä¸Šä¸¤å¼éœ€è¦åŒæ—¶æ»¡è¶³ï¼Œå¯ç­‰ä»·ä¸ºï¼š</p><p>$i=(âˆ’1)kâ‹…j+kâ‹…Ï€$</p><p>$i, j $ä¸ºéè´Ÿæ•´æ•°ä¸”ä¸ºéè´Ÿæ•´æ•°ä¸”ä¸ºéè´Ÿæ•´æ•°ä¸”iä¸ç­‰äºjä¸”ä¸”ä¸”$k$ä¸ºæ•´æ•°</p><p>åŒæ—¶æˆç«‹ï¼Œè¿™å°±æ„å‘³ç€ï¼š</p><p>$Ï€=\frac{[iâˆ’(âˆ’1)kâ‹…j]}{k}$</p><p>â€‹     è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå·¦è¾¹æ˜¯ä¸ªæ— ç†æ•°ï¼ˆæ— é™ä¸å¾ªç¯å°æ•°ï¼‰ï¼Œè€Œå³è¾¹æ˜¯ä¸ªæœ‰ç†æ•°ã€‚é€šè¿‡åè¯æ³•å°±è¯æ˜äº†åœ¨è¿™ç§è¡¨ç¤ºä¸‹ï¼Œæ¯ä¸ªä½ç½®ç¡®å®æœ‰å”¯ä¸€çš„ç¼–ç ã€‚</p><p>â€‹    ä¸Šé¢çš„è®¨è®ºå¹¶æœªè€ƒè™‘içš„ä½œç”¨ã€‚iå†³å®šäº†é¢‘ç‡çš„å¤§å°ï¼Œä¸åŒçš„iå¯ä»¥çœ‹æˆæ˜¯ä¸åŒçš„é¢‘ç‡ç©ºé—´ä¸­çš„ç¼–ç ï¼Œæ˜¯ç›¸äº’æ­£äº¤çš„ï¼Œé€šè¿‡æ”¹å˜içš„å€¼ï¼Œå°±èƒ½å¾—åˆ°å¤šç»´åº¦çš„ç¼–ç ï¼Œç±»ä¼¼äºè¯å‘é‡çš„ç»´åº¦ã€‚$2i&lt;=512$, ä¸€å…±512ç»´ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“2iå¤§äºd_modelæ—¶ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Œè¿™æ—¶sinå‡½æ•°çš„å‘¨æœŸä¼šå˜å¾—éå¸¸å¤§ï¼Œå‡½æ•°å€¼ä¼šéå¸¸æ¥è¿‘äº0ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ï¼Œå› ä¸ºè¿™æ ·å’Œè¯å‘é‡å°±ä¸åœ¨ä¸€ä¸ªé‡çº§äº†ï¼Œä½ç½®ç¼–ç çš„ä½œç”¨è¢«å‰Šå¼±äº†ã€‚å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½ç½®ç¼–ç æ˜¯ä¸å‚ä¸è®­ç»ƒçš„ï¼Œè€Œè¯å‘é‡æ˜¯å‚ä¸è®­ç»ƒçš„ã€‚ä½œè€…é€šè¿‡å®éªŒå‘ç°ï¼Œä½ç½®ç¼–ç å‚ä¸è®­ç»ƒä¸å¦å¯¹æœ€ç»ˆçš„ç»“æœå¹¶æ— å½±å“ã€‚</p><p>â€‹      ä¹‹æ‰€ä»¥å¯¹å¥‡å¶ä½ç½®åˆ†åˆ«ç¼–ç ï¼Œæ˜¯å› ä¸ºç¼–ç å‰ä¸€ä¸ªä½ç½®æ˜¯å¯ä»¥ç”±å¦ä¸€ä¸ªä½ç½®çº¿æ€§è¡¨ç¤ºçš„ï¼ˆå…¬å·®ä¸º1çš„ç­‰å·®æ•°åˆ—ï¼‰ï¼Œåœ¨ç¼–ç ä¹‹åä¹Ÿå¸Œæœ›èƒ½ä¿ç•™è¿™ç§çº¿æ€§ã€‚æˆ‘ä»¬ä»¥ç¬¬1ä¸ªä½ç½®å’Œç¬¬k+1ä¸ªä½ç½®ä¸ºä¾‹ï¼Œè¿˜æ˜¯ä»¤i=0ï¼š</p><p>$PE(1,0)=cos(1)$</p><p>$PE(k,0)=sin(1+k)=sin(1)cos(k)+cos(1)sin(k)=A+Bâ‹…PE(1,0)$</p><h3 id="Deocder"><a href="#Deocder" class="headerlink" title="Deocder"></a>Deocder</h3><p>Decoderå’ŒEncoderçš„ç»“æ„å·®ä¸å¤šï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªattentionçš„sub-layerï¼Œè¿™é‡Œå…ˆæ˜ç¡®ä¸€ä¸‹decoderçš„è¾“å…¥è¾“å‡ºå’Œè§£ç è¿‡ç¨‹ï¼š</p><ul><li>è¾“å‡ºï¼šå¯¹åº”iä½ç½®çš„è¾“å‡ºè¯çš„æ¦‚ç‡åˆ†å¸ƒ</li><li>è¾“å…¥ï¼šencoderçš„è¾“å‡º &amp; å¯¹åº”i-1ä½ç½®decoderçš„è¾“å‡ºã€‚æ‰€ä»¥ä¸­é—´çš„attentionä¸æ˜¯self-attentionï¼Œå®ƒçš„Kï¼ŒVæ¥è‡ªencoderï¼ŒQæ¥è‡ªä¸Šä¸€ä½ç½®decoderçš„è¾“å‡º</li><li>è§£ç ï¼š<strong>è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼Œç¼–ç å¯ä»¥å¹¶è¡Œè®¡ç®—ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨encodingå‡ºæ¥ï¼Œä½†è§£ç ä¸æ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰åºåˆ—è§£å‡ºæ¥çš„ï¼Œè€Œæ˜¯åƒrnnä¸€æ ·ä¸€ä¸ªä¸€ä¸ªè§£å‡ºæ¥çš„</strong>ï¼Œå› ä¸ºè¦ç”¨ä¸Šä¸€ä¸ªä½ç½®çš„è¾“å…¥å½“ä½œattentionçš„query</li></ul><p>æ˜ç¡®äº†è§£ç è¿‡ç¨‹ä¹‹åæœ€ä¸Šé¢çš„å›¾å°±å¾ˆå¥½æ‡‚äº†ï¼Œè¿™é‡Œä¸»è¦çš„ä¸åŒå°±æ˜¯æ–°åŠ çš„å¦å¤–è¦è¯´ä¸€ä¸‹æ–°åŠ çš„attentionå¤šåŠ äº†ä¸€ä¸ªmaskï¼Œå› ä¸ºè®­ç»ƒæ—¶çš„outputéƒ½æ˜¯ground truthï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿é¢„æµ‹ç¬¬iä¸ªä½ç½®æ—¶ä¸ä¼šæ¥è§¦åˆ°æœªæ¥çš„ä¿¡æ¯ã€‚</p><p>åŠ äº†maskçš„attentionåŸç†å¦‚å›¾ï¼ˆå¦é™„multi-head attentionï¼‰ï¼š</p><img src="/2020/08/26/transformer-yuan-li/21.jpg" style="zoom:67%;"><ul><li><p><strong>çº¿æ€§å±‚å’Œsoftmax</strong></p><p>â€‹        æ•´ä¸ªæ¨¡å‹çš„æœ€åä¸€æ­¥äº†ã€‚ä»Decoderæ‹¿åˆ°çš„è¾“å‡ºæ˜¯ç»´åº¦ä¸ºï¼ˆbatch_size, max_seq_len, d_modelï¼‰çš„æµ®ç‚¹å‹å¼ é‡ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°æœ€ç»ˆæ¯ä¸ªå•è¯é¢„æµ‹çš„ç»“æœï¼Œé¦–å…ˆç”¨ä¸€ä¸ªçº¿æ€§å±‚å°†d_modelæ˜ å°„åˆ°vocabçš„ç»´åº¦ï¼Œå¾—åˆ°æ¯ä¸ªå•è¯çš„å¯èƒ½æ€§ï¼Œç„¶åé€å…¥softmaxï¼Œæ‰¾åˆ°æœ€å¯èƒ½çš„å•è¯ã€‚</p><p>â€‹       çº¿æ€§å±‚çš„å‚æ•°ä¸ªæ•°ä¸º d_model*vocab_size,  ä¸€èˆ¬æ¥è¯´ï¼Œvocab_sizeä¼šæ¯”è¾ƒå¤§ï¼Œæ‹¿20000ä¸ºä¾‹,é‚£ä¹ˆåªè¿™å±‚çš„å‚æ•°å°±æœ‰512 * 20000ä¸ª,çº¦ä¸º10çš„8æ¬¡æ–¹ï¼Œéå¸¸æƒŠäººã€‚è€Œåœ¨è¯å‘é‡é‚£ä¸€å±‚ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¿™ä¸ªæ•°å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€ç§æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯å°†è¿™ä¸¤ä¸ªå…¨è¿æ¥å±‚çš„å‚æ•°å…±äº«ï¼Œä¼šèŠ‚çœä¸å°‘å†…å­˜ï¼Œè€Œä¸”æ•ˆæœä¹Ÿä¸ä¼šå·®ã€‚</p></li></ul><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ç»ˆäºå¯ä»¥å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹é‚£å¼ éå¸¸ç»å…¸å´å¾ˆéš¾ç›´æ¥ç†è§£çš„Transformerç»“æ„å›¾äº†ã€‚</p><img src="/2020/08/26/transformer-yuan-li/16.jpg" style="zoom:67%;"><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> attention </tag>
            
            <tag> æ³¨æ„åŠ›æœºåˆ¶ </tag>
            
            <tag> Encoder Decoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TensorFlow Serving</title>
      <link href="/2020/08/23/tensorflow-serving/"/>
      <url>/2020/08/23/tensorflow-serving/</url>
      
        <content type="html"><![CDATA[<h1 id="tensorflow"><a href="#tensorflow" class="headerlink" title="tensorflow"></a>tensorflow</h1><h2 id="TensorFlow-Servingæ¨¡å‹éƒ¨ç½²"><a href="#TensorFlow-Servingæ¨¡å‹éƒ¨ç½²" class="headerlink" title="TensorFlow Servingæ¨¡å‹éƒ¨ç½²"></a>TensorFlow Servingæ¨¡å‹éƒ¨ç½²</h2><h3 id="TensorFlow-Serving"><a href="#TensorFlow-Serving" class="headerlink" title="TensorFlow Serving"></a>TensorFlow Serving</h3><p>TensorFlow Servingæ˜¯ä¸€ç§çµæ´»çš„é«˜æ€§èƒ½æœåŠ¡ç³»ç»Ÿï¼Œé€‚ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œä¸“ä¸ºç”Ÿäº§ç¯å¢ƒè€Œè®¾è®¡ã€‚TensorFlow Servingå¯ä»¥è½»æ¾éƒ¨ç½²æ–°ç®—æ³•å’Œå®éªŒï¼ŒåŒæ—¶ä¿æŒç›¸åŒçš„æœåŠ¡å™¨æ¶æ„å’ŒAPIã€‚TensorFlow Servingæä¾›ä¸TensorFlowæ¨¡å‹çš„å¼€ç®±å³ç”¨é›†æˆï¼Œä½†å¯ä»¥è½»æ¾æ‰©å±•ä»¥æä¾›å…¶ä»–ç±»å‹çš„æ¨¡å‹å’Œæ•°æ®ã€‚</p><p><img src="/2020/08/23/tensorflow-serving/serving%E5%9B%BE.png"></p><h3 id="å®‰è£…Tensorflow-Serving"><a href="#å®‰è£…Tensorflow-Serving" class="headerlink" title="å®‰è£…Tensorflow Serving"></a>å®‰è£…Tensorflow Serving</h3><p>å®‰è£…è¿‡ç¨‹è¯¦ç»†å‚è€ƒå®˜ç½‘</p><blockquote><p><a href="https://www.tensorflow.org/serving/setup">https://www.tensorflow.org/serving/setup</a></p></blockquote><ul><li>ä½¿ç”¨Dockerå®‰è£…è¿›è¡Œï¼Œé¦–å…ˆä½ çš„ç”µè„‘å½“ä¸­å·²ç»å®‰è£…è¿‡dockerå®¹å™¨<ul><li>ä¸‹è½½æ¡Œé¢ç‰ˆæœ¬ï¼š<a href="https://www.docker.com/products/docker-desktop">https://www.docker.com/products/docker-desktop</a></li></ul></li></ul><h3 id="TensorFlow-Serving-Docker"><a href="#TensorFlow-Serving-Docker" class="headerlink" title="TensorFlow Serving Docker"></a>TensorFlow Serving Docker</h3><ol><li><p>è·å–æœ€æ–°TF Serving dockeré•œåƒ</p><pre class=" language-shell"><code class="language-shell">docker pull tensorflow/serving</code></pre></li><li><p>æŸ¥çœ‹dockeré•œåƒ</p><pre class=" language-shell"><code class="language-shell">docker images</code></pre></li><li><p>è¿è¡Œtf servingï¼ˆå³åˆ›å»ºä¸€ä¸ªdockerå®¹å™¨æ¥è¿è¡Œï¼‰</p><pre class=" language-shell"><code class="language-shell">docker run -p 8501:8501 -p 8500:8500 --mount type=bind,source=/home/ubuntu/detectedmodel/commodity,target=/models/commodity -e MODEL_NAME=commodity -t tensorflow/serving</code></pre><p>è¯´æ˜ï¼š</p><ul><li><code>-p 8501:8501</code> ä¸ºç«¯å£æ˜ å°„ï¼Œ<code>-p ä¸»æœºç«¯å£:dockerå®¹å™¨ç¨‹åº(tf serving)ä½¿ç”¨ç«¯å£</code>ï¼Œè®¿é—®ä¸»æœº8501ç«¯å£å°±ç›¸å½“äºè®¿é—®äº†tf servingç¨‹åºçš„8501ç«¯å£</li><li>tf serving ä½¿ç”¨8501ç«¯å£å¯¹å¤–æä¾›HTTPæœåŠ¡ï¼Œä½¿ç”¨8500å¯¹å¤–æä¾›gRPCæœåŠ¡ï¼Œè¿™é‡ŒåŒæ—¶å¼€æ”¾äº†ä¸¤ä¸ªç«¯å£çš„ä½¿ç”¨</li><li><code>--mount type=bind,source=/home/ubuntu/detectedmodel/commodity,target=/models/commodity</code> ä¸ºæ–‡ä»¶æ˜ å°„ï¼Œå°†ä¸»æœº(source)çš„æ¨¡å‹æ–‡ä»¶æ˜ å°„åˆ°dockerå®¹å™¨ç¨‹åºï¼ˆtarget)çš„ä½ç½®ï¼Œä»¥ä¾¿tf servingä½¿ç”¨æ¨¡å‹ï¼Œ<code>target</code>å‚æ•°ä¸º<code>/models/æˆ‘çš„æ¨¡å‹</code></li><li><code>-e MODEL_NAME=commodity</code>è®¾ç½®äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåä¸º<code>MODEL_NAME</code>ï¼Œæ­¤å˜é‡è¢«tf servingè¯»å–ï¼Œç”¨æ¥æŒ‰åå­—å¯»æ‰¾æ¨¡å‹ï¼Œä¸ä¸Šé¢targetå‚æ•°ä¸­<code>æˆ‘çš„æ¨¡å‹</code>å¯¹åº”</li><li><code>-t</code> ä¸ºtf servingåˆ›å»ºä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œä¾›ç¨‹åºè¿è¡Œ</li><li><code>tensorflow/serving</code>ä¸ºé•œåƒå</li></ul></li></ol><p>tensorflow servingæ˜¯ä¸­çµæ´»çš„é«˜æ€§èƒ½æœåŠ¡ç³»ç»Ÿï¼Œé€‚ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œä¸“ç”¨äºç”Ÿäº§ç¯å¢ƒè®¾è®¡ã€‚</p><ul><li>è®­ç»ƒæ¨¡å‹ä¸éƒ¨ç½²ç¯å¢ƒè¿›è¡Œéš”ç¦»</li><li>çƒ­æ›´æ–°<ul><li>ç¬¬ä¸€ç‰ˆæœ¬ï¼šéƒ¨ç½²èµ·æ¥</li><li>ç¬¬äºŒç‰ˆæœ¬ï¼Œé‡æ–°è®­ç»ƒæ–°çš„æ›´å¥½çš„æ¨¡å‹ï¼Œä¿å­˜åˆ°åŸæ¥éƒ¨ç½²çš„è·¯å¾„å³å¯</li><li>tensorflowä¼šæ ¹æ®æ–‡ä»¶å¤¹æ—¶é—´æˆ³ï¼Œè‡ªåŠ¨æ›¿æ¢å’Œä½¿ç”¨æ–°çš„æ¨¡å‹</li></ul></li><li>docker å¼€èµ·tensorflow serving æ¨¡å‹æœåŠ¡å‘½ä»¤<ul><li>8500 grpcæ¥å£</li><li>8501 HTTPæœåŠ¡</li><li>type=bind,source=/home/ubantu/detectedmodel/commodity,target=/models/commodity # æ¨¡å‹è·¯å¾„æ–‡ä»¶å¤¹<ul><li>target: /models/ å›ºå®šå†™æ³•</li><li>/models/*/:    *ä»£è¡¨æ¨¡å‹æ–‡ä»¶å¤¹</li></ul></li></ul></li></ul><h3 id="tensorflow-serving-ä¸åŒç‰ˆæœ¬æ¨¡å‹éƒ¨ç½²"><a href="#tensorflow-serving-ä¸åŒç‰ˆæœ¬æ¨¡å‹éƒ¨ç½²" class="headerlink" title="tensorflow serving ä¸åŒç‰ˆæœ¬æ¨¡å‹éƒ¨ç½²"></a>tensorflow serving ä¸åŒç‰ˆæœ¬æ¨¡å‹éƒ¨ç½²</h3><p>â€‹        ä½¿ç”¨tfservingå’ŒdockeråŒæ—¶éƒ¨ç½²å¤šä¸ªæ¨¡å‹ï¼Œä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„æ¨¡å‹ï¼ŒåŸºæœ¬çš„æµç¨‹ä¸éƒ¨ç½²å•ä¸ªæ¨¡å‹çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œ(å…³äºè¿è¡Œtfservingå®¹å™¨ä½¿ç”¨å•ä¸ªæ¨¡å‹è¿›è¡Œé¢„æµ‹çš„ç›¸å…³æ­¥éª¤å¯ä»¥å‚è§ ä½¿ç”¨dockerå’Œtf servingæ­å»ºæ¨¡å‹é¢„æµ‹æœåŠ¡ã€‚)ä¸åŒä¹‹å¤„åœ¨äºéœ€è¦ç”¨åˆ°ä¸€ä¸ªå¤šæ¨¡å‹çš„é…ç½®æ–‡ä»¶ã€‚é¦–å…ˆå¾—åˆ°å¤šä¸ªå¯ä»¥ç”¨äºtfservingé¢„æµ‹çš„æ¨¡å‹æ–‡ä»¶ï¼Œç›¸å…³æ­¥éª¤å¯ä»¥å‚è€ƒä½¿ç”¨savedModelä¿å­˜æ¨¡å‹ã€‚æœ¬ä¾‹ä¸­ç”¨ä½¿ç”¨savedModelä¿å­˜æ¨¡å‹ä¸­çš„ç›¸å…³ä»£ç ç”Ÿæˆä¸‰ä¸ªæ¨¡å‹ï¼Œåˆ†åˆ«å»ºç«‹ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå°†å¾—åˆ°çš„æ¨¡å‹åˆ†åˆ«æ”¾å…¥ï¼Œæœ€åçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹å›¾ã€‚å…¶ä¸­100001æ–‡ä»¶å¤¹è¡¨ç¤ºæ¨¡å‹çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨model1ä¸‹æ”¾ç½®ä¸åŒç‰ˆæœ¬çš„æ¨¡å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåŠ è½½å…·æœ‰è¾ƒå¤§ç‰ˆæœ¬å·æ•°å­—çš„æ¨¡å‹ã€‚</p><p><img src="/2020/08/23/tensorflow-serving/%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2.png"></p><h3 id="å¤šæ¨¡å‹éƒ¨ç½²"><a href="#å¤šæ¨¡å‹éƒ¨ç½²" class="headerlink" title="å¤šæ¨¡å‹éƒ¨ç½²"></a>å¤šæ¨¡å‹éƒ¨ç½²</h3><p>åœ¨multiModelæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶<code>model.config</code>ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><pre class=" language-shell"><code class="language-shell">model_config_list:&#123;    config:&#123;      name:"model1",      base_path:"/models/multiModel/model1",      model_platform:"tensorflow"    &#125;,    config:&#123;      name:"model2",      base_path:"/models/multiModel/model2",      model_platform:"tensorflow"    &#125;,    config:&#123;      name:"model3",      base_path:"/models/multiModel/model3",      model_platform:"tensorflow"    &#125; &#125;</code></pre><p>é…ç½®æ–‡ä»¶å®šä¹‰äº†æ¨¡å‹çš„åç§°å’Œæ¨¡å‹åœ¨å®¹å™¨å†…çš„è·¯å¾„ï¼Œç°åœ¨è¿è¡Œtfservingå®¹å™¨ :</p><pre class=" language-shell"><code class="language-shell">docker run -p 8501:8501 --mount type=bind,source=/home/jerry/tmp/multiModel/,target=/models/multiModel  -t tensorflow/serving --model_config_file=/models/multiModel/models.config &>server.log 2>&1</code></pre><p><strong>è¯·æ±‚é¢„æµ‹</strong>ï¼š</p><pre class=" language-she"><code class="language-she">import requests import numpy as np SERVER_URL = 'http://localhost:8501/v1/models/model3:predict'  #æ³¨æ„SERVER_URLä¸­çš„â€˜model3â€™æ˜¯configæ–‡ä»¶ä¸­å®šä¹‰çš„æ¨¡å‹name,ä¸æ˜¯æ–‡ä»¶å¤¹åç§°def prediction():     predict_request='&#123;"instances":%s&#125;' % str([[[10]*7]*7])     print(predict_request)     response = requests.post(SERVER_URL, data=predict_request)     print(response)    prediction = response.json()['predictions'][0]     print(prediction) if __name__ == "__main__":     prediction()</code></pre><h3 id="æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬"><a href="#æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬" class="headerlink" title="æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬"></a>æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬</h3><p>å¦‚æœä¸€ä¸ªæ¨¡å‹æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œå¹¶åœ¨é¢„æµ‹çš„æ—¶å€™å¸Œæœ›æŒ‡å®šæ¨¡å‹çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ã€‚<br>ä¿®æ”¹model.configæ–‡ä»¶ï¼Œå¢åŠ model_version_policyï¼š</p><pre class=" language-shell"><code class="language-shell">model_config_list:&#123;    config:&#123;      name:"model1",      base_path:"/models/multiModel/model1",      model_platform:"tensorflow",      model_version_policy:&#123;        all:&#123;&#125;      &#125;    &#125;,    config:&#123;      name:"model2",      base_path:"/models/multiModel/model2",      model_platform:"tensorflow",      model_version_policy: &#123;       specific: &#123;        versions: 101,        versions: 202       &#125;    &#125;    &#125;,    config:&#123;      name:"model3",      base_path:"/models/multiModel/model3",      model_platform:"tensorflow",       model_version_policy: &#123;       latest: &#123;        num_versions: N       &#125;    &#125;    &#125; &#125;</code></pre><p>è¯·æ±‚é¢„æµ‹çš„æ—¶å€™ï¼Œå¦‚æœè¦ä½¿ç”¨ç‰ˆæœ¬ä¸º100001çš„æ¨¡å‹ï¼Œåªè¦ä¿®æ”¹SERVER_URLä¸ºï¼š</p><p>`SERVER_URL = â€˜<a href="http://localhost:8501/v1/models/model1/versions/100001:predict'">http://localhost:8501/v1/models/model1/versions/100001:predict'</a> </p><p>tfservingæ”¯æŒæ¨¡å‹çš„Hot Plugï¼Œä¸Šè¿°å®¹å™¨è¿è¡Œèµ·æ¥ä¹‹åï¼Œå¦‚æœåœ¨å®¿ä¸»æœºçš„ /home/jerry/tmp/multiModel/model1/ æ–‡ä»¶å¤¹ä¸‹æ–°å¢æ¨¡å‹æ–‡ä»¶å¦‚100003/ï¼Œtfservingä¼šè‡ªåŠ¨åŠ è½½æ–°æ¨¡å‹ï¼›åŒæ ·å¦‚æœç§»é™¤ç°æœ‰æ¨¡å‹ï¼Œtfservingä¹Ÿä¼šè‡ªåŠ¨å¸è½½æ¨¡å‹ã€‚</p><h2 id="ä»£ç demo"><a href="#ä»£ç demo" class="headerlink" title="ä»£ç demo"></a>ä»£ç demo</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> models<span class="token punctuation">,</span>layers<span class="token punctuation">,</span>optimizers<span class="token comment" spellcheck="true">## æ ·æœ¬æ•°é‡</span>n <span class="token operator">=</span> <span class="token number">800</span><span class="token comment" spellcheck="true">## ç”Ÿæˆæµ‹è¯•ç”¨æ•°æ®é›†</span>X <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token punctuation">[</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>minval<span class="token operator">=</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>maxval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span> w0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span>Y <span class="token operator">=</span> X@w0 <span class="token operator">+</span> b0 <span class="token operator">+</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span>n<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    mean <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># @è¡¨ç¤ºçŸ©é˜µä¹˜æ³•,å¢åŠ æ­£æ€æ‰°åŠ¨</span><span class="token comment" spellcheck="true">## å»ºç«‹æ¨¡å‹</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>clear_session<span class="token punctuation">(</span><span class="token punctuation">)</span>inputs <span class="token operator">=</span> layers<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name <span class="token operator">=</span><span class="token string">"inputs"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#è®¾ç½®è¾“å…¥åå­—ä¸ºinputs</span>outputs <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"outputs"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>inputs<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#è®¾ç½®è¾“å‡ºåå­—ä¸ºoutputs</span>linear <span class="token operator">=</span> models<span class="token punctuation">.</span>Model<span class="token punctuation">(</span>inputs <span class="token operator">=</span> inputs<span class="token punctuation">,</span>outputs <span class="token operator">=</span> outputs<span class="token punctuation">)</span>linear<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## ä½¿ç”¨fitæ–¹æ³•è¿›è¡Œè®­ç»ƒ</span>linear<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">"rmsprop"</span><span class="token punctuation">,</span>loss<span class="token operator">=</span><span class="token string">"mse"</span><span class="token punctuation">,</span>metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"mae"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>linear<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>batch_size <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>epochs <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>  tf<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"w = "</span><span class="token punctuation">,</span>linear<span class="token punctuation">.</span>layers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>kernel<span class="token punctuation">)</span>tf<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"b = "</span><span class="token punctuation">,</span>linear<span class="token punctuation">.</span>layers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## å°†æ¨¡å‹ä¿å­˜æˆpbæ ¼å¼æ–‡ä»¶</span>export_path <span class="token operator">=</span> <span class="token string">"./data/linear_model/"</span>version <span class="token operator">=</span> <span class="token string">"1"</span>       <span class="token comment" spellcheck="true">#åç»­å¯ä»¥é€šè¿‡ç‰ˆæœ¬å·è¿›è¡Œæ¨¡å‹ç‰ˆæœ¬è¿­ä»£ä¸ç®¡ç†</span>linear<span class="token punctuation">.</span>save<span class="token punctuation">(</span>export_path<span class="token operator">+</span>version<span class="token punctuation">,</span> save_format<span class="token operator">=</span><span class="token string">"tf"</span><span class="token punctuation">)</span> </code></pre><h3 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h3><pre class=" language-python"><code class="language-python">!curl <span class="token operator">-</span>d <span class="token string">'&amp;#123;"instances": [[1.0, 2.0], [5.0,7.0]]&amp;#125;'</span>  <span class="token operator">-</span>X POST http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8501</span><span class="token operator">/</span>v1<span class="token operator">/</span>models<span class="token operator">/</span>linear_model<span class="token punctuation">:</span>predict</code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">##HTTP</span><span class="token keyword">import</span> json<span class="token keyword">import</span> requestsdata <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"signature_name": "serving_default", "instances": [[1.0, 2.0], [5.0,7.0]]&amp;#125;)</span>headers <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"content-type": "application/json"&amp;#125;</span>json_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://localhost:8501/v1/models/linear_model:predict'</span><span class="token punctuation">,</span>        data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>predictions <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"predictions"</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## grpc</span></code></pre><h2 id="å‚è€ƒå†…å®¹ï¼š"><a href="#å‚è€ƒå†…å®¹ï¼š" class="headerlink" title="å‚è€ƒå†…å®¹ï¼š"></a>å‚è€ƒå†…å®¹ï¼š</h2><p><a href="https://www.jianshu.com/p/d11a5c3dc757">TensorFlow Servingä½¿ç”¨æŒ‡å—</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿ç»´ </tag>
            
            <tag> éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Get To The Point Summarization with Pointer Generator Networks ä»£ç è§£æ</title>
      <link href="/2020/08/22/get-to-the-point-summarization-with-pointer-generator-networks-dai-ma-jie-xi/"/>
      <url>/2020/08/22/get-to-the-point-summarization-with-pointer-generator-networks-dai-ma-jie-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="Get-To-The-Point-Summarization-with-Pointer-Generator-Networks-ä»£ç è§£æ"><a href="#Get-To-The-Point-Summarization-with-Pointer-Generator-Networks-ä»£ç è§£æ" class="headerlink" title="Get To The Point Summarization with Pointer Generator Networks ä»£ç è§£æ"></a>Get To The Point Summarization with Pointer Generator Networks ä»£ç è§£æ</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Get To The Point  Summarization with Pointer-Generator Networks</title>
      <link href="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/"/>
      <url>/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/</url>
      
        <content type="html"><![CDATA[<h1 id="Get-To-The-Point-Summarization-with-Pointer-Generator-Networks"><a href="#Get-To-The-Point-Summarization-with-Pointer-Generator-Networks" class="headerlink" title="Get To The Point: Summarization with Pointer-Generator Networks"></a>Get To The Point: Summarization with Pointer-Generator Networks</h1><p><a href="https://arxiv.org/pdf/1704.04368.pdf">paper</a></p><p><a href="https://github.com/abisee/pointer-generator">code</a></p><p><a href="https://github.com/zingp/NLP/tree/master/P007PytorchPointerGeneratorNetwork">pytorch æ”¹åŠ¨ç‰ˆ</a></p><p><a href="https://github.com/hquzhuguofeng/New-Pointer-Generator-Networks-for-Summarization-Chinese">å…¶ä»–code</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p> ã€€ã€€ç¥ç»åºåˆ—åˆ°åºåˆ—æ¨¡å‹æ‘˜è¦æä¾›äº†ä¸€ç§å¯è¡Œçš„æ–°æ–¹æ³•ã€‚é¦–å…ˆä½¿ç”¨äº†æ··åˆæŒ‡é’ˆç½‘ç»œä»åŸå§‹é›†ä¸­å¤åˆ¶å•è¯ï¼Œè¿™äº›æŒ‡é’ˆèƒ½å‡†ç¡®çš„å¤åˆ¶ä¿¡æ¯ï¼ŒåŒæ—¶ä¿ç•™äº§ç”Ÿå•è¯çš„ç”Ÿæˆå™¨ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–°é—»ä¿¡æ¯æ¥è®°å½•è¢«æ€»ç»“çš„å†…å®¹ï¼Œè¿™å°±é˜²æ­¢äº†é‡å¤ã€‚å°†æ¨¡å‹åº”ç”¨åˆ°CNNæ¯æ—¥é‚®æŠ¥çš„æ‘˜è¦ä»»åŠ¡ï¼Œæ¯”å½“å‰çš„SOTAæå‡è‡³å°‘2ç‚¹ã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>â€‹        ä¸¤ç§å¹¿æ³›çš„æ–¹æ³•:æå–å’ŒæŠ½è±¡ã€‚æå–æ–¹æ³•ä¸“é—¨ä»ç›´æ¥ä»æºæ–‡æœ¬è·å–çš„æ®µè½(é€šå¸¸æ˜¯æ•´ä¸ªè¯­ä¹‰)ä¸­æ”¶é›†æ€»ç»“ï¼Œè€ŒæŠ½è±¡æ–¹æ³•åˆ™å¯èƒ½ç”Ÿæˆæºæ–‡æœ¬ä¸­æ²¡æœ‰çš„æ–°å•è¯å’ŒçŸ­è¯­ï¼Œå°±åƒäººç±»ç¼–å†™çš„æ‘˜è¦é€šå¸¸é‚£æ ·ã€‚</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/1.png">       </p><p>â€‹         å›¾ï¼‘ åŸºçº¿æ³¨æ„åºåˆ—æ¨¡å‹ã€‚è¯¥æ¨¡å‹å¯ä»¥è€ƒè™‘æºæ–‡æœ¬ä¸­çš„ç›¸å…³è¯ï¼Œç”Ÿæˆæ–°çš„è¯.ä¾‹å¦‚ï¼ŒæŠ½è±¡åŒ–çš„æ€»ç»“ä¸­äº§ç”Ÿæ–°é¢–çš„å•è¯beat,</p><p>å¯ä»¥æ³¨æ„åˆ°åŸæ–‡ä¸­çš„å•è¯victoryå’Œwinã€‚</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/2.png"></p><p>â€‹      å›¾ï¼“Pointer-generatoræ¨¡å‹ã€‚æ¯ä¸€ä¸ªè§£ç å™¨æ—¶é—´æ­¥é•¿å¯¹åº”ä¸€ä¸ªç”Ÿæˆæ¦‚ç‡ ${pen} _{gen} \in {[0, 1]}$è®¡ç®—å‡ºä»è¯æ±‡ä¸­ç”Ÿæˆå•è¯å’Œä»åŸæ–‡ä¸­å¤åˆ¶å•è¯çš„æ¦‚ç‡ã€‚å¯¹è¯æ±‡åˆ†å¸ƒå’Œæ³¨æ„åˆ†å¸ƒè¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå¾—åˆ°æœ€ç»ˆçš„åˆ†å¸ƒï¼Œå¹¶æ®æ­¤è¿›è¡Œé¢„æµ‹ã€‚æœ€ç»ˆå‘è¡Œç‰ˆä¸­åŒ…å«äº†è¯æ±‡è¡¨ä¹‹å¤–çš„æ–‡ç« è¯ï¼Œæ¯”å¦‚2-0ã€‚</p><p>â€‹      RNNä½¿æ–‡æœ¬ç”Ÿæˆæˆä¸ºå¯èƒ½ï¼Œä½†æ˜¯ä¸å‡†ç¡®åœ°å†ç°äº‹å®çš„ç»†èŠ‚ï¼Œä¸èƒ½å¤„ç†OOV é—®é¢˜ï¼Œä»¥åŠé‡å¤è‡ªå·±ã€‚</p><p>ã€€ã€€hybrid pointer-generator networkå¹³è¡¡äº†æŠ½å–å¼å’ŒæŠ½è±¡å¼ï¼Œè§£å†³äº†ç»†èŠ‚å’ŒOOV é—®é¢˜ï¼Œä¿ç•™ç”Ÿæˆå•è¯çš„èƒ½åŠ›ã€‚</p><p>   ã€€ä»ç¥ç»æœºå™¨ç¿»è¯‘ä¸­æå‡ºäº†ä¸€ç§æ–°çš„è¦†ç›–èŒƒå›´å‘é‡çš„å˜ä½“ï¼Œç”¨äºè·Ÿè¸ªå’Œæ§åˆ¶æºæ–‡æ¡£çš„è¦†ç›–èŒƒå›´ï¼Œè¯æ˜äº†è¦†ç›–èŒƒå›´å¯¹äºæ¶ˆé™¤é‡å¤æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚</p><h2 id="Our-Models"><a href="#Our-Models" class="headerlink" title="Our Models"></a>Our Models</h2><ul><li>sequence-to-sequence  åŸºçº¿æ¨¡å‹</li><li>pointer-generatoræ¨¡å‹</li><li>æ·»åŠ è¦†ç›–æœºåˆ¶çš„ä¸Šé¢ä¸¤ä¸ªæ¨¡å‹</li></ul><h3 id="Sequence-to-sequence-attentional-mode"><a href="#Sequence-to-sequence-attentional-mode" class="headerlink" title="Sequence-to-sequence attentional mode"></a>Sequence-to-sequence attentional mode</h3><p>sequence-to-sequence  åŸºçº¿æ¨¡å‹ï¼Œç±»ä¼¼å›¾ï¼‘ï¼Œtoknesè¾“å…¥ç¼–ç å™¨(å•å±‚åŒå‘LSTM)ï¼Œç”Ÿæˆç¼–ç å™¨éšè—çŠ¶æ€åºåˆ—$h _i$ã€‚åœ¨æ¯$t$æ­¥ä¸­ï¼Œè§£ç å™¨(ä¸€ä¸ªå•å±‚å•å‘LSTM)æ¥æ”¶åˆ°å‰ä¸€ä¸ªè¯å‘é‡ï¼ŒåŒæ—¶äº§ç”Ÿ$s _t$,$a ^t$æ³¨æ„åŠ›åˆ†å¸ƒ</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/3.png"></p><p>$ v, W _h, W _s , {b} _{attn} $ æ˜¯å¯å­¦ä¹ çš„å‚æ•°ï¼Œæ³¨æ„åŠ›çš„åˆ†å¸ƒå¯ä»¥è¢«çœ‹ä½œæ˜¯æºè¯çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå‘Šè¯‰è§£ç å™¨åœ¨å“ªé‡Œå¯»æ‰¾ä¸‹ä¸€ä¸ªè¯ã€‚ç„¶åï¼Œä½¿ç”¨æ³¨æ„åŠ›åˆ†å¸ƒæ¥äº§ç”Ÿç¼–ç å™¨éšè—çŠ¶æ€çš„åŠ æƒå’Œï¼Œç§°ä¸ºä¸Šä¸‹æ–‡å‘é‡$h _t$</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/4.png"></p><p>ä¸Šä¸‹æ–‡å‘é‡å¯ä»¥çœ‹ä½œæ˜¯ä»æºå†…å®¹çš„å›ºå®šå¤§å°çš„è¡¨ç¤º,ä¸è¯‘ç å™¨çŠ¶æ€è¿æ¥åœ¨ä¸€èµ·,é€šè¿‡ä¸¤ä¸ªçº¿æ€§å±‚æä¾›ï¼Œä»è€Œäº§ç”Ÿè¯æ±‡åˆ†å¸ƒ$P _{vocab}$</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/5.png"></p><p>$V , Vâ€², b, bâ€™$ æ˜¯å¯å­¦ä¹ å‚æ•°ï¼Œ$P _{vocab}$æ˜¯è¯¥è¯æ±‡è¡¨ä¸­æ‰€æœ‰å•è¯çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†æœ€ç»ˆçš„åˆ†å¸ƒï¼Œä»¥ä¾¿æˆ‘ä»¬é¢„æµ‹å•è¯$w$</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/6.png"></p><p>è¯¥æ—¶é—´æ­¥é•¿çš„ç›®æ ‡å•è¯$w ^âˆ— _t$çš„è´Ÿå¯¹æ•°ä¼¼ç„¶å€¼</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/7.png"></p><p>æ•´ä¸ªåºåˆ—çš„æŸå¤±æ˜¯</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/8.png"></p><h3 id="Pointer-generator-network"><a href="#Pointer-generator-network" class="headerlink" title="Pointer-generator network"></a>Pointer-generator network</h3><p>â€‹    æŒ‡é’ˆç”Ÿæˆå™¨ç½‘ç»œæ˜¯åŸºçº¿å’ŒæŒ‡é’ˆç½‘ç»œçš„æ··åˆä½“, å…è®¸é€šè¿‡æŒ‡é’ˆå¤åˆ¶å•è¯ï¼Œä¹Ÿå…è®¸ä»å›ºå®šè¯æ±‡è¡¨ç”Ÿæˆå•è¯ã€‚</p><p>â€‹    åœ¨æŒ‡é’ˆç”Ÿæˆå™¨æ¨¡å‹,å¦‚å›¾ï¼“ï¼Œæ³¨æ„åˆ†å¸ƒå’Œä¸Šä¸‹æ–‡å‘é‡$h ^âˆ— _t$æŒ‰ç…§Sequence-to-sequence attentional modeæ¥è®¡ç®—ï¼Œæ­¤å¤–ï¼Œç”Ÿæˆæ¦‚ç‡$p _{gen} \in [0,1]$æ˜¯ä»ä¸Šä¸‹æ–‡å‘é‡$h ^âˆ— _t$ã€è§£ç å™¨çŠ¶æ€$s _t$å’Œè§£ç å™¨è¾“å…¥$x _t$è®¡ç®—å‡ºæ¥çš„ã€‚</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/9.png"></p><p>vectors$ w _{hâˆ—}$, $w _s$, $w _x$ and scalar $b _{ptr}$ æ˜¯å­¦ä¹ å‚æ•°, $Ïƒ$æ˜¯sigmoid, $p _{gen}$ è¢«ç”¨ä½œé€šè¿‡ä»PvocabæŠ½æ ·ä»è¯æ±‡è¡¨ä¸­ç”Ÿæˆä¸€ä¸ªå•è¯,è¿˜æ˜¯é€šè¿‡ä»æ³¨æ„åˆ†å¸ƒ$a ^t$æŠ½æ ·ä»è¾“å…¥åºåˆ—ä¸­å¤åˆ¶ä¸€ä¸ªå•è¯ã€‚</p><p>æ‰©å±•è¯æ±‡è¡¨ä¸Šçš„å¦‚ä¸‹æ¦‚ç‡åˆ†å¸ƒ</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/10.png"></p><p>å¦‚æœ$w$æ˜¯è¯æ±‡è¡¨ä»¥å¤–çš„å•è¯(OOV)ï¼Œé‚£ä¹ˆ$P _{vocab(w)}$ä¸ºé›¶;ç±»ä¼¼åœ°ï¼Œå¦‚æœwæ²¡æœ‰å‡ºç°åœ¨æºæ–‡æ¡£ä¸­ï¼Œé‚£ä¹ˆ$\sum _{i:wi=w} a ^t _i$ ä¸ºï¼ï¼Œç”ŸæˆOOVå•è¯çš„èƒ½åŠ›æ˜¯æŒ‡é’ˆç”Ÿæˆå™¨æ¨¡å‹çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€;åŸºçº¿ç­‰æ¨¡å‹è¢«é™åˆ¶åœ¨é¢„å…ˆè®¾ç½®çš„è¯æ±‡è¡¨ä¸­ã€‚</p><h3 id="Coverage-mechanism"><a href="#Coverage-mechanism" class="headerlink" title="Coverage mechanism"></a>Coverage mechanism</h3><p>é‡å¤æ˜¯åºåˆ—åˆ°åºåˆ—æ¨¡å‹çš„å¸¸è§é—®é¢˜ï¼Œåœ¨ç”Ÿæˆå¤šå¥æ–‡æœ¬æ—¶å°¤å…¶çª, é‡‡ç”¨Tuç­‰äººçš„è¦†ç›–æ¨¡å‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æˆ‘ä»¬çš„è¦†ç›–æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä¿æŒå åŠ å‘é‡$c ^t$ï¼Œå‰ä¸€ä¸ªè§£ç å™¨æ—¶é—´æ­¥ä¸Šçš„æ³¨æ„åŠ›åˆ†å¸ƒçš„æ€»å’Œã€‚</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/11.png"></p><p>$c _t$æ˜¯æºæ–‡æ¡£è¯ä¸Šçš„ä¸€ä¸ª(æœªå½’ä¸€åŒ–çš„)åˆ†å¸ƒï¼Œå®ƒè¡¨ç¤ºè¿™äº›è¯ä»æ³¨æ„æœºåˆ¶å¾—åˆ°çš„è¦†ç›–ç¨‹åº¦ã€‚$c _0$æ˜¯ä¸€ä¸ªé›¶å‘é‡ï¼Œç¬¬ä¸€ä¸ªæ—¶é—´æ­¥éª¤ä¸­ï¼Œæ²¡æœ‰åŒ…å«ä»»ä½•æºæ–‡æ¡£ã€‚</p><p>è¦†ç›–å‘é‡ä½œä¸ºå…³æ³¨æœºåˆ¶çš„é¢å¤–è¾“å…¥ï¼Œå˜åŒ–æ–¹ç¨‹</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/12.png"></p><p>$w _c$æ˜¯ä¸$v$ç›¸åŒé•¿åº¦çš„å¯å­¦ä¹ å‚æ•°,ç¡®ä¿äº†æ³¨æ„æœºåˆ¶å½“å‰çš„å†³ç­–,å®¹æ˜“é¿å…é‡å¤å…³æ³¨ç›¸åŒçš„ä½ç½®ï¼Œä»è€Œé¿å…äº§ç”Ÿé‡å¤çš„æ–‡æœ¬ã€‚</p><p>å‘ç°æœ‰å¿…è¦é¢å¤–å®šä¹‰é™„åŠ æŸå¤±ï¼Œä»¥æƒ©ç½šé‡å¤å¤„ç†ç›¸åŒåœ°ç‚¹ã€‚</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/13.png"></p><p>æ³¨æ„è¦†ç›–ç‡æŸå¤±æ˜¯æœ‰ç•Œçš„;ç‰¹åˆ«æ˜¯$covloss _t &lt;= \sum _{i}{a ^t _i } = 1$ å…¬å¼(12)ä¸åŒäºæœºå™¨ç¿»è¯‘ä¸­ä½¿ç”¨çš„è¦†ç›–æŸå¤±ã€‚å‡è®¾åº”è¯¥æœ‰ä¸€ä¸ªå¤§çº¦ä¸€å¯¹ä¸€çš„ç¿»è¯‘æ¯”ç‡;å› æ­¤ï¼Œå¦‚æœæœ€ç»ˆçš„è¦†ç›–ç‡å‘é‡å¤§äºæˆ–å°äº1ï¼Œå°±ä¼šå—åˆ°æƒ©ç½šã€‚</p><p>æŸå¤±å‡½æ•°æ›´çµæ´»,å› ä¸ºæ€»ç»“ä¸åº”è¯¥è¦æ±‚ç»Ÿä¸€çš„è¦†ç›–èŒƒå›´ï¼Œæˆ‘ä»¬åªæƒ©ç½šæ¯ä¸ªæ³¨æ„åŠ›åˆ†å¸ƒå’Œç›®å‰çš„è¦†ç›–èŒƒå›´ä¹‹é—´çš„é‡å â€”â€”é˜²æ­¢é‡å¤å…³æ³¨ã€‚æœ€åï¼Œåœ¨ä¸»æŸå¤±å‡½æ•°ä¸­åŠ å…¥ç”±è¶…å‚æ•°å‚æ•°æ¨¡å‹æ¨¡å‹é‡æ–°åŠ æƒçš„å¤ç›–æŸå¤±ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å¤åˆæŸå¤±å‡½æ•°</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/14.png"></p><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><ul><li>Neural abstractive summarization</li></ul><p>â€‹         DUC-2004and Gigaword, two sentence-level summarizationdatasets.</p><p>â€‹         theCNN/Daily Maildataset</p><p>â€‹        åœ¨å®Œæ•´çš„æ•°æ®é›†ä¸Šï¼Œåªæœ‰ä¸¤ä¸ªç»“æœå‘è¡¨äº†</p><ul><li>Pointer-generator networks.</li></ul><p>ã€€ã€€ã€€æœ¬æ–‡æ¨¡å‹æ–¹æ³•ä¸Miaoå’ŒBlun-somå¼ºè¿«æ³¨æ„å¥å­å‹ç¼©æ¨¡å‹å’ŒGuç­‰äººçš„CopyNetæ¨¡å‹æ¯”è¾ƒæ¥è¿‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç»†å¾®çš„å·®å¼‚</p><p>ã€€ã€€ã€€ï¼ˆï¼‘ï¼‰è®¡ç®—äº†ä¸€ä¸ªæ˜¾å¼æ¦‚ç‡$p _{gen}$ , Guç­‰äººé€šè¿‡ä¸€ä¸ªå…±äº«çš„$softmax$å‡½æ•°è¯±å¯¼</p><p>ã€€ã€€ã€€ï¼ˆï¼’ï¼‰å°†æ³¨æ„åŠ›çš„å¾ªç¯åˆ†å¸ƒä½œä¸ºå¤åˆ¶åˆ†å¸ƒï¼Œè€ŒGuç­‰äººåˆ™å°†æ³¨æ„åŠ›çš„å¾ªç¯åˆ†å¸ƒä½œä¸ºå¤åˆ¶åˆ†å¸ƒã€‚ä½¿ç”¨ä¸¤ä¸ªå•ç‹¬çš„åˆ†å¸ƒ</p><p>ã€€ã€€ã€€ï¼ˆï¼“ï¼‰å½“ä¸€ä¸ªè¯åœ¨æºæ–‡æœ¬ä¸­å¤šæ¬¡å‡ºç°æ—¶ï¼Œæˆ‘ä»¬çš„æ¦‚ç‡è´¨é‡æ¥è‡ªäºæ‰€æœ‰å¯¹åº”çš„æ³¨æ„åˆ†å¸ƒéƒ¨åˆ†ï¼Œ</p><p>â€‹                       æœ‰æ•ˆåœ°è®¡ç®—ä¸€ä¸ªæ˜ç¡®çš„è¯èƒ½ä½¿æˆ‘ä»¬åŒæ—¶æé«˜æˆ–é™ä½æ‰€æœ‰ç”Ÿæˆçš„è¯æˆ–æ‰€æœ‰å¤åˆ¶çš„è¯çš„æ¦‚ç‡</p><p>â€‹                       æŒ‡é’ˆæœºåˆ¶ä¼šå¤åˆ¶ä¸€ä¸ªå•è¯ï¼ŒåŒæ—¶æ³¨æ„åˆ°å®ƒåœ¨æºæ–‡æœ¬ä¸­å¤šæ¬¡å‡ºç°</p><p>è®­ç»ƒäº†å®ƒä»¬çš„æŒ‡é’ˆç»„ä»¶ï¼Œä½¿å…¶åªé’ˆå¯¹è¯æ±‡è¡¨å¤–çš„å•è¯æˆ–å‘½åçš„å®ä½“æ¿€æ´»ï¼Œè€Œä¸”å®ƒä»¬æ²¡æœ‰æ··åˆæ¥è‡ªå¤åˆ¶åˆ†å¸ƒå’Œè¯æ±‡åˆ†å¸ƒçš„æ¦‚ç‡ã€‚</p><p>è§‚å¯Ÿåˆ°æ··åˆæ¨¡å‹å¯ä»¥è®©è¯­è¨€æ¨¡å‹å’Œå¤åˆ¶æœºåˆ¶ä¸€èµ·å·¥ä½œï¼Œä»¥æ‰§è¡ŒæŠ½è±¡å¤åˆ¶ã€‚</p><ul><li>Coverage</li></ul><p>ã€€ã€€ã€€åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªæ³¨æ„åˆ†å¸ƒé™¤ä»¥å‰ä¸€ä¸ªæ³¨æ„åˆ†å¸ƒçš„å’Œï¼Œæœ‰æ•ˆåœ°æŠ‘åˆ¶äº†é‡å¤æ³¨æ„ã€‚å°è¯•è¿‡è¿™ç§æ–¹æ³•ï¼Œä½†å‘ç°å®ƒç ´åæ€§å¤ªå¤§ï¼Œæ‰­æ›²äº†æ³¨æ„åŠ›æœºåˆ¶çš„ä¿¡å·ï¼Œé™ä½äº†è¡¨ç°ã€‚å‡è®¾æ—©æœŸçš„å¹²é¢„æ–¹æ³•ï¼ˆä¾‹å¦‚è¦†ç›–ç‡ï¼‰æ¯”äº‹åçš„æ–¹æ³•ï¼ˆä¾‹å¦‚æš‚æ—¶æ³¨æ„ï¼‰æ›´å¯å–ï¼Œå› ä¸ºå®ƒæ¯”å®Œå…¨å¿½ç•¥å†³ç­–æ›´èƒ½å‘ŠçŸ¥æ³¨æ„æœºåˆ¶ä»¥å¸®åŠ©åšå‡ºæ›´å¥½çš„å†³ç­–ã€‚è¿™ä¸€ç†è®ºæ˜¯ç”±æˆ‘ä»¬çš„ROUGE è¯„åˆ†çš„è¦†ç›–èŒƒå›´çš„å·¨å¤§æå‡æ‰€æ”¯æŒçš„ï¼Œç›¸å¯¹äºæ—¶é—´æ³¨æ„åŠ›å¯¹åŒä¸€ä»»åŠ¡çš„åˆºæ¿€è¾ƒå°ã€‚</p><h2 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h2><p>CNN/Daily  Maildatase</p><h2 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a>Experiments</h2><p>model : hidden-size:256   embedding-dim: 128   å­—å…¸å¤§å° 50K</p><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/15.png"></p><p>è¡¨1ï¼šæµ‹è¯•é›†ä¸Šçš„ROUGE F1å’ŒMETEORå¾—åˆ†ã€‚ä¸ŠåŠéƒ¨åˆ†çš„æ¨¡å‹å’ŒåŸºå‡†çº¿æ˜¯æ´»è·ƒçš„ï¼Œä¸‹åŠéƒ¨åˆ†çš„æ¨¡å‹å’ŒåŸºå‡†çº¿æ˜¯å¯æå–çš„ã€‚*æ ‡è®°åœ¨åŒ¿åæ•°æ®é›†ä¸Šè¿›è¡Œäº†è®­ç»ƒå’Œè¯„ä¼°ï¼Œå› æ­¤ä¸åœ¨åŸå§‹æ–‡æœ¬ä¸Šçš„ç»“æœä¸¥æ ¼ä¸å…·æœ‰å¯æ¯”æ€§ã€‚å®˜æ–¹ROUGEçš„æŠ¥å‘Šï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ROUGEå¾—åˆ†çš„95%ç½®ä¿¡åŒºé—´æœ€å¤šä¸º0.25ã€‚ä½¿ç”¨è¿‘ä¼¼éšæœºæ£€éªŒï¼Œå‘ç°ä»50kåŸºçº¿åˆ°æŒ‡é’ˆç”Ÿæˆå™¨æ¨¡å‹ä»¥åŠä»æŒ‡é’ˆç”Ÿæˆå™¨åˆ°æŒ‡é’ˆç”Ÿæˆå™¨+è¦†ç›–ç‡æ¨¡å‹çš„METEORæ”¹è¿›åœ¨ç»Ÿè®¡ä¸Šéƒ½å…·æœ‰æ˜¾ç€æ„ä¹‰p&lt;0.01ã€‚</p><p> æŒ‡é’ˆå’Œè¦†ç›–æœºåˆ¶åªå‘ç½‘ç»œå¼•å…¥å¾ˆå°‘çš„é™„åŠ å‚æ•° , å¯¹äºè¯æ±‡è¡¨å¤§å°ä¸º50kçš„æ¨¡å‹ï¼ŒåŸºçº¿æ¨¡å‹æœ‰21,499,600ä¸ªå‚æ•°ï¼ŒæŒ‡é’ˆç”Ÿæˆå™¨æ·»åŠ äº†1153ä¸ªé¢å¤–çš„å‚æ•°($w _{hâˆ—} , w _s,w _x , b _{ptr}$) , è¦†ç›–ç‡å¢åŠ äº†512ä¸ªé¢å¤–çš„å‚æ•°($w _c$)</p><p>é¢„è®­ç»ƒæœªä½¿ç”¨ä¸ºembedding, ä½¿ç”¨Adagrad è¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ ç‡ä¸º0.15ï¼Œåˆå§‹ç´¯åŠ å™¨å€¼ä¸º0.1ã€‚</p><p>ä½¿ç”¨æœ€å¤§æ¢¯åº¦èŒƒæ•°ä¸º2çš„æ¢¯åº¦å‰ªè£ï¼Œä½†ä¸ä½¿ç”¨ä»»ä½•å½¢å¼çš„æ­£åˆ™åŒ–ã€‚</p><p>åœ¨éªŒè¯é›†ä¸Šä½¿ç”¨æŸå¤±æ¥å®ç°æ—©æœŸåœæ­¢ã€‚</p><p>åœ¨è®­ç»ƒæœŸé—´å’Œæµ‹è¯•æ—¶ï¼Œå°†æ–‡ç« æˆªæ–­ä¸º400ä¸ªtokensï¼Œå¹¶ä¸”åœ¨è®­ç»ƒæ—¶å°†é•¿åº¦é™åˆ¶ä¸º100ä¸ªtokensï¼Œåœ¨æµ‹è¯•æ—¶é™åˆ¶ä¸º120ä¸ªtokens, batch_size ,batchä¸º16</p><p>æ•´ä½“çš„è®­ç»ƒæ—¶é—´ç¼©çŸ­</p><p>è®­ç»ƒä¸å¸¦æŸå¤±å‡½æ•°çš„è¦†ç›–æ¨¡å‹ï¼Œå¸Œæœ›æ³¨æ„æœºåˆ¶å¯ä»¥è‡ªå·±å­¦ä¹ ä¸é‡å¤åœ°æ³¨æ„ç›¸åŒçš„ä½ç½®ï¼Œä½†å‘ç°è¿™æ˜¯æ— æ•ˆçš„ï¼Œæ²¡æœ‰æ˜æ˜¾çš„é‡å¤å‡å°‘ã€‚</p><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/16.png"></p><p>å›¾ï¼”ã€€è¦†ç›–æ¶ˆé™¤äº†ä¸å¿…è¦çš„é‡å¤ã€‚æ¥è‡ªæˆ‘ä»¬çš„éè¦†ç›–æ¨¡å‹çš„æ‘˜è¦åŒ…å«è®¸å¤šé‡å¤çš„n-gramï¼Œè€Œæˆ‘ä»¬çš„è¦†ç›–æ¨¡å‹äº§ç”Ÿçš„å‚è€ƒæ‘˜è¦çš„æ•°å­—ä¸ä¹‹ç›¸ä¼¼</p><h2 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h2><h3 id="Comparison-with-extractive-systems"><a href="#Comparison-with-extractive-systems" class="headerlink" title="Comparison with extractive systems"></a>Comparison with extractive systems</h3><ol><li><p>æ–°é—»æ–‡ç« çš„å¼€å¤´å¾€å¾€æ˜¯æœ€é‡è¦çš„ä¿¡æ¯;</p></li><li><p>ä»»åŠ¡çš„æ€§è´¨å’ŒROUGEåº¦é‡ä½¿æå–æ–¹æ³•å’Œlead-3åŸºçº¿éš¾ä»¥å‡»è´¥ã€‚æŠ½è±¡å¼•å…¥äº†æ›´å¤šçš„é€‰é¡¹ï¼Œè¿›ä¸€æ­¥é™ä½äº†åŒ¹é…å¼•ç”¨å’Œçš„å¯èƒ½æ€§</p></li><li><p>ç”±äºä»»åŠ¡çš„ä¸»è§‚æ€§ä»¥åŠæœ‰æ•ˆæ‘˜è¦çš„å¤šæ ·æ€§ï¼ŒROUGEä¼¼ä¹ä¼šå¥–åŠ±å®‰å…¨çš„ç­–ç•¥ï¼Œä¾‹å¦‚é€‰æ‹©å‡ºç°çš„å†…å®¹æˆ–ä¿ç•™åŸå§‹æªè¾ã€‚</p></li></ol><p><img src="/2020/08/21/get-to-the-point-summarization-with-pointer-generator-networks/17.png"></p><p>å›¾ï¼– è™½ç„¶æœ€å¥½çš„æ¨¡å‹æ˜¯æŠ½è±¡çš„ï¼Œä½†å®ƒä¸ä¼šäº§ç”Ÿæ–°å¥‡çš„å›¾å½¢(ä¾‹å¦‚æ²¡æœ‰å‡ºç°åœ¨æºæ–‡æœ¬ä¸­çš„n-gram)å’Œå¼•ç”¨æ‘˜è¦ä¸€æ ·é¢‘ç¹ã€‚åŸºçº¿æ¨¡å‹äº§ç”Ÿäº†æ›´å¤šæ–°å¥‡çš„å›¾å½¢ï¼Œä½†å…¶ä¸­è®¸å¤šæ˜¯é”™è¯¯çš„ï¼</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>â€‹      åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæå‡ºäº†ä¸€ä¸ªè¦†ç›–çš„æ··åˆæŒ‡é’ˆç”Ÿæˆå™¨æ¶æ„ï¼Œå¹¶å±•ç¤ºäº†å®ƒå‡å°‘äº†ä¸å‡†ç¡®æ€§å’Œé‡å¤ã€‚å°†æ¨¡å‹åº”ç”¨åˆ°ä¸€ä¸ªæ–°çš„å…·æœ‰æŒ‘æˆ˜æ€§çš„é•¿æ–‡æœ¬æ•°æ®é›†ä¸Šï¼Œå¹¶ä¸”æ˜¾è‘—ä¼˜äºSOATç»“æœã€‚æ¨¡å‹æ‰©å±•äº†è®¸å¤šæŠ½è±¡èƒ½åŠ›ï¼Œä½†æ˜¯å¦‚ä½•å®ç°æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ä»ç„¶æ˜¯ä¸€ä¸ªæœ‰å¾…ç ”ç©¶çš„é—®é¢˜ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSCaching Simple and Efficient Negative Sampling for Knowledge Graph  Embedding</title>
      <link href="/2020/08/20/nscaching-simple-and-efficient-negative-sampling-for-knowledge-graph-embedding/"/>
      <url>/2020/08/20/nscaching-simple-and-efficient-negative-sampling-for-knowledge-graph-embedding/</url>
      
        <content type="html"><![CDATA[<h1 id="NSCaching-Simple-and-Efficient-Negative-Sampling-for-Knowledge-Graph-Embedding"><a href="#NSCaching-Simple-and-Efficient-Negative-Sampling-for-Knowledge-Graph-Embedding" class="headerlink" title="NSCaching Simple and Efficient Negative Sampling for Knowledge Graph Embedding"></a>NSCaching Simple and Efficient Negative Sampling for Knowledge Graph Embedding</h1><p><a href="https://arxiv.org/pdf/1812.06410.pdf">paper</a></p><p><a href="https://github.com/yzhangee/NSCaching">code github</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>å¤§æ¦‚åœ¨2020-08-24çœ‹å®Œå®Œæˆ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çŸ¥è¯†å›¾è°± </tag>
            
            <tag> è´Ÿé‡‡æ · </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seq2Seq with Attention</title>
      <link href="/2020/08/16/seq2seq-with-attention/"/>
      <url>/2020/08/16/seq2seq-with-attention/</url>
      
        <content type="html"><![CDATA[<h1 id="Seq2Seq-with-AttentionåŸç†"><a href="#Seq2Seq-with-AttentionåŸç†" class="headerlink" title="Seq2Seq with AttentionåŸç†"></a>Seq2Seq with AttentionåŸç†</h1><ul><li>RNNç»“æ„çš„å±€é™<ul><li>ç”±é•¿åºåˆ—åˆ°å®šé•¿å‘é‡è½¬åŒ–è€Œé€ æˆçš„ä¿¡æ¯æŸå¤±çš„ç“¶é¢ˆ</li><li>æ ‡å‡†çš„Seq2Seqåªå…³æ³¨å½“å‰çš„hidden state</li></ul></li></ul><h2 id="Seq2Seq-with-Attention"><a href="#Seq2Seq-with-Attention" class="headerlink" title="Seq2Seq with Attention"></a>Seq2Seq with Attention</h2><p>â€‹     attentionæ¨¡å‹æœ€æ—©å‡ºç°äºcvé¢†åŸŸï¼Œè€Œé¦–æ¬¡ç”¨äºè§£å†³nlpé—®é¢˜æ˜¯åœ¨2014å¹´[3]ï¼Œseq2seq+attention åº”ç”¨äºæœºå™¨ç¿»è¯‘ä»»åŠ¡ã€‚ä»¥è‹±è¯‘æ±‰ä¸ºä¾‹ï¼Œå½“è§£ç å™¨å¯¹è‹±æ–‡è¿›è¡Œè§£ç æ—¶ï¼Œæ˜¯ä¸€ä¸ªè¯ä¸€ä¸ªè¯ç”Ÿæˆçš„ï¼Œè€Œæ‰€ç”Ÿæˆçš„æ¯ä¸ªè¯å¯¹åº”çš„è‹±æ–‡éƒ¨åˆ†åº”è¯¥æ˜¯ä¸åŒï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œè§£ç å™¨è§£ç æ—¶ä¸åŒstepæ‰€åˆ†é…çš„æ³¨æ„åŠ›æ˜¯ä¸åŒçš„ã€‚ å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚çœ‹å›¾è¯´è¯ï¼ˆç”¨ä¸€å¥è¯æè¿°ä¸€å¹…å›¾ï¼‰ï¼Œæ‰€ç”Ÿæˆçš„è¯è¯­åº”è¯¥å¯¹åº”å›¾ä¸­çš„ä¸åŒéƒ¨åˆ†ï¼Œå³è§£ç å™¨åœ¨è§£ç æ—¶ï¼Œåº”è¯¥ç»™å›¾ä¸­â€œåˆé€‚â€çš„éƒ¨ä½ï¼Œåˆ†é…æ›´å¤šçš„æ³¨æ„åŠ›ï¼ˆæƒé‡ï¼‰ã€‚</p><p><img src="/2020/08/16/seq2seq-with-attention/1.jpg"></p><p>â€‹       çº¢åœˆæ ‡è¯†çš„æ˜¯ç¼–ç å™¨ï¼Œå…¶ä¸­hä»£è¡¨æºæ–‡æœ¬çš„è¯­ä¹‰è¡¨ç¤ºï¼›ç´«åœˆæ ‡è¯†çš„è§£ç å™¨ï¼Œå…¶ä¸­sä»£è¡¨ç›®æ ‡æ–‡æœ¬çš„åºåˆ—çŠ¶æ€ã€‚cè¡¨ç¤ºæ³¨æ„åŠ›å‘é‡ï¼Œç”¨æ¥åœ¨è§£ç æ—¶ï¼Œæ§åˆ¶æºæ–‡æœ¬ä¸åŒä½ç½®çš„attentionåˆ†é…ã€‚</p><p><img src="/2020/08/16/seq2seq-with-attention/2.jpeg"></p><ul><li>è¾“å…¥ã€€$x = (x _1, x _2, x _3,â€¦x _T)$</li><li>è¾“å‡ºã€€$y = (y _1, y _2, y _3,â€¦, y _T)$</li><li>$ h _t = RNN _{enc}(x _t, h _{t-1})$, Encoderæ–¹é¢æ¥å—çš„æ˜¯æ¯ä¸ªå•è¯Word Embedding, å’Œä¸Šä¸€ä¸ªæ—¶é—´ç‚¹çš„hidden state, è¾“å‡ºçš„æ˜¯è¿™ä¸ªæ—¶é—´ç‚¹çš„hidden stateï¼</li><li>$s _t = RNN _{enc}(y _{t-1}, s _{t-1})$ Decoderæ–¹é¢çš„æ¥å—ç›®æ ‡å¥å­å•è¯Word Embeddingï¼Œå’Œä¸Šä¸€ä¸ªæ—¶é—´ç‚¹çš„hidden state</li><li>$c _i = \sum _{j=1} ^{T _x}({\alpha} _{ij}h _j)$ context vector æ˜¯ä¸€ä¸ªå¯¹äºencoder è¾“å‡ºçš„hidden states çš„ä¸€ä¸ªåŠ æƒå¹³å‡</li><li>$\alpha _{ij} = \frac{exp(e _{ij})}{\sum _{k=1} ^{T _x}exp(e _{ij}) }$ æ¯ä¸€ä¸ªencoderçš„hidden statesçš„ä¸€ä¸ªåŠ æƒå¹³å‡</li><li>$e _{ij} = score(s _{t-1}, h _j)$ é€šè¿‡decoderçš„hidden states åŠ ä¸Šencoderçš„hidden states æ¥è®¡ç®—ä¸€ä¸ªåˆ†æ•°ï¼Œç”¨äºæƒé‡(4)</li><li>$ \widehat{s} = tanh(W _c[c _t; s _t])$,å°†context vector å’Œdecoder çš„hidden statesä¸²èµ·æ¥</li><li>$p(y _t|y&lt;t,x) = softmax(W _t \widehat{s _t})$ è®¡ç®—æœ€åçš„è¾“å‡ºæ¦‚ç‡ã€‚</li><li>ä»¥ä¸Šçš„æ­¥éª¤æ˜¯luongåœ¨paper[4]é‡Œæ”¹è‰¯çš„decoderè®¡ç®—æ–¹å¼ï¼Œpaper[3]ä¸­åœ¨è®¡ç®—ä¸­åŠ å…¥äº†$c _t$ï¼‰</li></ul><h3 id="Attentionæ‰©å±•"><a href="#Attentionæ‰©å±•" class="headerlink" title="Attentionæ‰©å±•"></a>Attentionæ‰©å±•</h3><p>â€‹    luongåœ¨paper[4] æå‡ºäº†ä¸€ç§attentionæ”¹è‰¯æ–¹æ¡ˆï¼Œå°†attentionåˆ’åˆ†ä¸ºäº†ä¸¤ç§å½¢å¼ï¼šglobalï¼Œ local.<br>globalæ–¹å¼è®¤ä¸ºattentionåº”è¯¥åœ¨æ‰€æœ‰æºæ–‡æœ¬ä¸Šè¿›è¡Œï¼Œè€Œlocalæ–¹å¼è®¤ä¸ºattentionä»…åº”è¯¥åœ¨éƒ¨åˆ†æºæ–‡æœ¬ä¸Šè¿›è¡Œã€‚globalç†å¿µä¸paper[3]ç›¸åŒï¼Œå…·ä½“è®¡ç®—æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>$$score(h _t, \overline{h _s}) = \begin{cases}h _t ^T \overline{h _s}    \quad\quad\quad   dot\\ h _t ^TW _a\overline{h _s}      \quad\quad\quad general \\  v _a^Ttanh(W _a[h _t; \overline{h _s}]    \quad\quad\quad  concat \end{cases} $$</p><p>å…¶ä¸­â€œconcatâ€ ä¸ paper[3] ä¸­çš„è®¡ç®—æ–¹å¼ç›¸åŒã€‚<br>ç¬¬ä¸€ç§ï¼šdot</p><p><img src="/2020/08/16/seq2seq-with-attention/3.jpeg"></p><p>è¾“å…¥æ˜¯encoderçš„æ‰€æœ‰hidden states H: å¤§å°ä¸º <strong>(hid dim, sequence length)</strong> ã€‚decoderåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šçš„hidden stateï¼Œ sï¼š å¤§å°ä¸º <strong>ï¼ˆhid dim, 1ï¼‰</strong> ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šæ—‹è½¬Hä¸ºï¼ˆsequence length, hid dim) ä¸<strong>s</strong>åšç‚¹ä¹˜å¾—åˆ°ä¸€ä¸ª å¤§å°ä¸º(sequence length, 1)çš„åˆ†æ•°ã€‚</p><p>ç¬¬äºŒæ­¥ï¼š<strong>å¯¹åˆ†æ•°åšsoftmaxå¾—åˆ°ä¸€ä¸ªåˆä¸º1çš„æƒé‡</strong>ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼šå°†Hä¸ç¬¬äºŒæ­¥å¾—åˆ°çš„æƒé‡åšç‚¹ä¹˜å¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º(hid dim, 1)çš„context vectorã€‚</p><p>ç¬¬äºŒç§ï¼šgeneral</p><p><img src="/2020/08/16/seq2seq-with-attention/4.jpeg"></p><p>è¾“å…¥æ˜¯encoderçš„æ‰€æœ‰hidden states H: å¤§å°ä¸º <strong>(hid dim1, sequence length)</strong> ã€‚decoderåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šçš„hidden stateï¼Œ sï¼š å¤§å°ä¸º <strong>ï¼ˆhid dim2, 1ï¼‰</strong>ã€‚æ­¤å¤„ä¸¤ä¸ªhidden stateçš„çº¬åº¦å¹¶ä¸ä¸€æ ·ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼šæ—‹è½¬Hä¸ºï¼ˆsequence length, hid dim1) ä¸ <strong>Wa å¤§å°ä¸º[ hid dim1, hid dim 2)]</strong> åšç‚¹ä¹˜ï¼Œ å†å’Œsåšç‚¹ä¹˜å¾—åˆ°ä¸€ä¸ª å¤§å°ä¸º(sequence length, 1)çš„åˆ†æ•°ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šå¯¹åˆ†æ•°åš<strong>softmax</strong>å¾—åˆ°ä¸€ä¸ªåˆä¸º1çš„æƒé‡ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼šå°†Hä¸ç¬¬äºŒæ­¥å¾—åˆ°çš„æƒé‡åšç‚¹ä¹˜å¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º(hid dim, 1)çš„context vectorã€‚</p><h3 id="éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>éœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><ul><li>decoder ç«¯çš„stståˆå§‹åŒ–ï¼š$s _0 = tanh(Wh _b ^1)$, å–encoderçš„åå‘RNNçš„åˆæ€çš„éçº¿æ€§ï¼Œä½œä¸ºdecoderçš„åˆæ€</li><li>teacher forcingæ¨¡å¼ä¸æµ‹è¯•æ—¶ï¼ˆç”Ÿæˆæ¨¡å¼ï¼‰ä¸åŒï¼Œæ‰€ä»¥è®­ç»ƒè¿‡ç¨‹ä¸èƒ½å®Œå…¨éƒ½ç”¨teacher forcingï¼Œteacher forcing ä¸ ç”Ÿæˆæ¨¡å¼åº”æŒ‰æ¯”ä¾‹åˆ†é…</li><li>beamsearch åªæ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ç”¨åˆ°</li><li>å¦‚æœencoder ä¸ decoder çš„åºåˆ—éƒ½å¾ˆé•¿ï¼Œæ˜¾å­˜è£…ä¸ä¸‹ã€‚å¯è€ƒè™‘å¯¹decoderç«¯è¿›è¡Œæˆªæ–­ï¼Œåˆ†æ­¥ä¼˜åŒ–ï¼ˆpytorchä¸­ ä½¿ç”¨ state = state.detach()ï¼‰</li><li>codingæ—¶ï¼Œå°½é‡åˆ«ç”¨forå¾ªç¯ï¼Œä¼šæå¤§é™ä½è®¡ç®—æ•ˆç‡</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Attentionä¸ä¼ ç»Ÿçš„Seq2Seqæ¨¡å‹ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ä¸åŒï¼š</p><ul><li><p>encoderæä¾›äº†æ›´å¤šçš„æ•°æ®ç»™åˆ°decoderï¼Œ<strong>encoderä¼šæŠŠæ‰€æœ‰çš„èŠ‚ç‚¹çš„hidden stateæä¾›ç»™decoder</strong>ï¼Œè€Œä¸ä»…ä»…åªæ˜¯encoderæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„hidden state ã€‚</p></li><li><p>decoderå¹¶ä¸æ˜¯ç›´æ¥æŠŠæ‰€æœ‰encoderæä¾›çš„hidden stateä½œä¸ºè¾“å…¥ï¼Œè€Œæ˜¯é‡‡å–ä¸€ç§é€‰æ‹©æœºåˆ¶ï¼ŒæŠŠæœ€ç¬¦åˆå½“å‰ä½ç½®çš„hidden stateé€‰å‡ºæ¥ï¼Œå…·ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç¡®å®šå“ªä¸€ä¸ªhidden stateä¸å½“å‰èŠ‚ç‚¹å…³ç³»æœ€ä¸ºå¯†åˆ‡ï¼›</li></ul></li><li><p>è®¡ç®—æ¯ä¸€ä¸ªhidden stateçš„åˆ†æ•°å€¼ï¼›</p><ul><li>å¯¹æ¯ä¸ªåˆ†æ•°å€¼åšä¸€ä¸ªsoftmaxçš„è®¡ç®—ï¼Œè¿™èƒ½è®©ç›¸å…³æ€§é«˜çš„hidden stateçš„åˆ†æ•°å€¼æ›´å¤§ï¼Œç›¸å…³æ€§ä½çš„hidden stateçš„åˆ†æ•°å€¼æ›´ä½ã€‚</li></ul></li></ul><p>è®¡ç®—ç»†èŠ‚æ±‡æ€»å¦‚ä¸‹ï¼š</p><p>$p(y _t|y&lt;t,x) = softmax(W_s \widehat{s _t})$</p><p>$\widehat{s _t} =tanh(W _c[c _t; s _t])$</p><p>$s _t = f _d(y _{t-1}, s _{t-1})$</p><p>$c _t =\sum\alpha _{tj} h _j$</p><p>$\alpha _{ij} = softmax(e _{ij})$</p><p>$e _{ij} = a(s _{t-1}, h _j) = v _a ^Ttanh(W _{s _{t-1}} + Uh _j)$</p><p>$h _t = f _e(x _t, h _{t-1})$ æ³¨ï¼š$f _e$ å¯ä½¿ç”¨LSTMï¼Œ GRuï¼Œ Bi-LSTM ç­‰</p><h2 id="Attentiom-ç¼ºç‚¹"><a href="#Attentiom-ç¼ºç‚¹" class="headerlink" title="Attentiom ç¼ºç‚¹"></a>Attentiom ç¼ºç‚¹</h2><p>m-&gt;åŸæ–‡é•¿åº¦</p><p>t-&gt;ç¿»è¯‘é•¿åº¦</p><p>æ ‡å‡†Seq2Seqã€€ï¼¯(m+t)  time complexity</p><p>Seq2Seq +Attention ï¼¯(mt) time complexity</p><p>[1] Sutskever I, Vinyals O, Le Q V. Sequence to sequence learning with neural networks[C] Advances in neural information processing systems. 2014.<br>[2] Cho K, Van MerriÃ«nboer B, Gulcehre C, et al. Learning phrase representations using RNN encoder-decoder for statistical machine translation[J]. arXiv, 2014.<br>[3] Bahdanau D, Cho K, Bengio Y. Neural machine translation by jointly learning to align and translate[J]. arXiv, 2014. &amp; ICLR, 2015.<br>[4] Luong M T, Pham H, Manning C D. Effective approaches to attention-based neural machine translation[J]. arXiv, 2015.</p><h4 id="å‚è€ƒç½‘å€ï¼š"><a href="#å‚è€ƒç½‘å€ï¼š" class="headerlink" title="å‚è€ƒç½‘å€ï¼š"></a>å‚è€ƒç½‘å€ï¼š</h4><p><a href="https://mp.weixin.qq.com/s/0k71fKKv2SRLv9M6BjDo4w">çœŸæ­£çš„å®Œå…¨å›¾è§£Seq2Seq Attentionæ¨¡å‹</a>ï¼ˆéå¸¸å¥½ï¼‰<br><a href="https://blog.csdn.net/xy_free/article/details/80397426">seq2seq + attention è¯¦è§£</a>ï¼ˆéå¸¸å¥½ï¼‰<br><a href="https://blog.csdn.net/u012526436/article/details/86293981">Attentionæœºåˆ¶è¯¦è§£</a>ï¼ˆæœ‰åŠ¨å›¾ï¼‰<br><a href="https://blog.csdn.net/mystery_guest/article/details/82119527">ã€æœºå™¨å­¦ä¹ ã€‘ã€seq2seqæ¨¡å‹ä¸attentionæœºåˆ¶ï¼ŒBeam Searchã€‘</a><br><a href="https://www.jianshu.com/p/1c24eba3ba9c">ã€è®ºæ–‡ç¬”è®°ã€‘Effective Approaches to Attention-based Neural Machine Translation</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åºåˆ—åˆ°åºåˆ—æ¨¡å‹ </tag>
            
            <tag> Encoder Decoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Seq2Seq</title>
      <link href="/2020/08/15/seq2seq/"/>
      <url>/2020/08/15/seq2seq/</url>
      
        <content type="html"><![CDATA[<h1 id="Seq2SeqåŸç†"><a href="#Seq2SeqåŸç†" class="headerlink" title="Seq2SeqåŸç†"></a>Seq2SeqåŸç†</h1><h2 id="Seq2Seqæ¨¡å‹ç®€ä»‹"><a href="#Seq2Seqæ¨¡å‹ç®€ä»‹" class="headerlink" title="Seq2Seqæ¨¡å‹ç®€ä»‹"></a>Seq2Seqæ¨¡å‹ç®€ä»‹</h2><p>â€‹      å…¨ç§°<strong>Sequence to sequence</strong>ï¼Œç”±<strong>Encoder</strong>å’Œ<strong>Decoder</strong>ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªRNNCellï¼ˆRNNã€LSTMã€GRUç­‰ï¼‰ç»“æ„ã€‚Encoderå°†ä¸€ä¸ªåºåˆ—ç¼–ç ä¸ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„è¯­ä¹‰å‘é‡ï¼ŒDecoderå°†è¯¥è¯­ä¹‰å‘é‡è§£ç ä¸ºå¦ä¸€ä¸ªåºåˆ—ã€‚</p><p>â€‹      Seq2Seqæ¨¡å‹æ˜¯è¾“å‡ºçš„é•¿åº¦ä¸ç¡®å®šæ—¶é‡‡ç”¨çš„æ¨¡å‹, è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯åœ¨æœºå™¨ç¿»è¯‘çš„ä»»åŠ¡ä¸­å‡ºç°ï¼Œå°†ä¸€å¥ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œé‚£ä¹ˆè¿™å¥è‹±æ–‡çš„é•¿åº¦æœ‰å¯èƒ½ä¼šæ¯”ä¸­æ–‡çŸ­ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šæ¯”ä¸­æ–‡é•¿ï¼Œæ‰€ä»¥è¾“å‡ºçš„é•¿åº¦å°±ä¸ç¡®å®šäº†ã€‚</p><ul><li>ç‰¹ç‚¹ï¼šè¾“å…¥åºåˆ—å’Œè¾“å‡ºåºåˆ—çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œè¾“å‡ºåºåˆ—é•¿åº¦å¯ä»¥ä¸ç­‰äºè¾“å…¥åºåˆ—é•¿åº¦ã€‚</li><li>è®­ç»ƒï¼šå¯¹Encoderå’ŒDecoderè¿›è¡Œè”åˆè®­ç»ƒï¼Œä½¿ç»™å®šè¾“å…¥åºåˆ—çš„ç›®æ ‡åºåˆ—çš„æ¡ä»¶æ¦‚ç‡æœ€å¤§åŒ–ã€‚</li><li>åº”ç”¨ ï¼šseq2seqæ¨¡å‹å¯ä»¥åœ¨ç»™å®šè¾“å…¥åºåˆ—çš„æƒ…å†µä¸‹ç”Ÿæˆç›®æ ‡åºåˆ—ï¼Œä¹Ÿå¯ä»¥å¯¹ä¸€å¯¹åºåˆ—è¿›è¡Œè¯„åˆ†(ä»¥æ¡ä»¶æ¦‚ç‡è¡¨ç¤º)ã€‚æ¯”å¦‚æœºå™¨ç¿»è¯‘ã€æ–‡æœ¬æ‘˜è¦ç”Ÿæˆã€å¯¹è¯ç”Ÿæˆç­‰ã€‚</li></ul><h2 id="æ¡†æ¶ä¸€"><a href="#æ¡†æ¶ä¸€" class="headerlink" title="æ¡†æ¶ä¸€"></a>æ¡†æ¶ä¸€</h2><p>è¯¥æ¡†æ¶Paper<a href="https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf"> Sequence to Sequence Learning with Neural Networks  </a></p><p><img src="/2020/08/15/seq2seq/1.png"></p><p>Encoderè¾“å…¥åºåˆ—A B Cï¼Œç”Ÿæˆè¯­ä¹‰å‘é‡$c$ä½œä¸ºDecoderçš„åˆå§‹éšè—çŠ¶æ€ï¼ŒDecoderä¸­åˆå§‹æ—¶åˆ»è¾“å…¥ $&lt; EOS &gt;$ ä½œä¸ºå¼€å§‹æ ‡å¿—ï¼Œç›´è‡³è¾“å‡º $&lt; EOS &gt;$ ç»“æŸé¢„æµ‹ã€‚</p><p>å’Œæ¡†æ¶2ä¸åŒçš„æ˜¯ï¼Œè¯¥æ¡†æ¶Encoderè¾“å‡ºçš„è¯­ä¹‰å‘é‡ $c$ç›´æ¥ä½œä¸ºDecoderçš„åˆå§‹éšè—çŠ¶æ€ï¼Œå¹¶ä¸ä½œç”¨äºä¹‹åçš„æ—¶åˆ»ã€‚</p><p>è¿™ç¯‡è®ºæ–‡ä¸­ä½¿ç”¨LSTMä½œä¸ºEncoderå’ŒDecoderï¼Œä¸ºæ–¹ä¾¿æè¿°è¿™é‡Œç”¨RNNä½œä¸ºç¤ºèŒƒï¼Œå…¬å¼ä¸ºï¼š</p><ul><li><p>Encoder</p><p>$h _t = tanh([W{h} _{t-1}, x _t])$</p><p>$o _t = softmax(Vh _t +c)$  </p><p>Encoderè¾“å‡ºçš„è¯­ä¹‰å‘é‡ï¼š$c = h _T$</p></li></ul><blockquote><p>è®ºæ–‡ä½œè€…å‘ç°å°†è¾“å…¥åºåˆ—åè½¬åå†è¾“å…¥Decoderä¸­æ•ˆæœä¼šå¥½å¾ˆå¤šï¼Œä»¥ä¸‹æ˜¯ç”±æ­¤å¾—å‡ºçš„ç»“è®ºã€‚<br>We conclude that it is important to find a problem encoding that has the greatest number of short term dependencies, as they make the learning problem much simpler.</p></blockquote><ul><li><p>Decoder</p><p>$h _t = tanh(W[{h} _{t-1}, {y} _{t-1}] +b)$</p><p>$o _t = softmax(Vh _t +c)$</p><p>å…¶ä¸­ $h _0 = c$</p></li></ul><h2 id="æ¡†æ¶äºŒ"><a href="#æ¡†æ¶äºŒ" class="headerlink" title="æ¡†æ¶äºŒ"></a>æ¡†æ¶äºŒ</h2><p>è¯¥æ¡†æ¶Paperï¼š<a href="https://arxiv.org/abs/1406.1078">Learning Phrase Representations using RNN Encoderâ€“Decoder for Statistical Machine Translation</a></p><p><img src="/2020/08/15/seq2seq/2.png"></p><p>â€‹     è¿™ç¯‡è®ºæ–‡å¦ä¸€å¤§è´¡çŒ®æ˜¯æå‡ºäº†GRUï¼Œè®ºæ–‡ä¸­Encoderå’ŒDecoderéƒ½æ˜¯GRUã€‚ä¸ºäº†è¡¨è¾¾æ–¹ä¾¿ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾Encoderå’ŒDecoderéƒ½ä¸ºRNNï¼Œæ¥çœ‹ä¸€ä¸‹seq2seqçš„å…¬å¼ï¼Œæ³¨æ„ï¼š $c$ ä¸$c$ä¸æ˜¯ä¸€ä¸ªå‚æ•°ã€‚</p><ul><li><p>Encoder</p><p>$h _t = tanh(W([{h} _{t-1}, x _t]) + b)$</p><p>$o _t = softmax(Vh _t +c)$  </p><p>å…¶ä¸­ $h _t$ æ˜¯éšè—çŠ¶æ€ï¼Œ $o _t$ æ˜¯è¾“å‡ºã€‚</p><p>Encoderè¾“å‡ºçš„è¯­ä¹‰å‘é‡ï¼š$c = tanh(Uh _T)$ </p><p>â€‹         ä¾‹å¦‚ å‡è®¾æœ‰tä¸ªè¯ï¼Œæœ€ç»ˆé€šè¿‡Encoderè‡ªå®šä¹‰å‡½æ•° q å°†å„æ—¶åˆ»çš„éšçŠ¶æ€å˜æ¢ä¸ºå‘é‡c â€“&gt; $ c = q(h _0, h _1,â€¦,h _t) $</p><p>å…¶ä¸­ $U$ ä¸ºæƒé‡çŸ©é˜µï¼Œ $h _T$ æ˜¯Encoderæœ€åçš„éšè—çŠ¶æ€(è®°å½•äº†æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯)ã€‚</p></li><li><p>Decoder</p><p>$h _t = tanh(W[{h} _{t-1}, {y} _{t-1}] +b)$</p><p>$o _t = softmax(Vh _t +c)$</p><p>æ¥æ”¶åˆ°Encoderæ¥çš„è¯­ä¹‰å‘é‡$c$ ï¼Œé¦–å…ˆè¾“å…¥ä¸€ä¸ªå¼€å§‹ä¿¡å· $y _0$ ï¼ˆæ¯”å¦‚ä¸º $&lt; STRAT &gt;$ ï¼Œå’Œä¸€ä¸ªåˆå§‹åŒ–çš„éšè—çŠ¶æ€ $h _0$ï¼Œæ¥ä¸‹æ¥å°±æŒ‰ç…§ä¸Šé¢çš„å…¬å¼ä¸€ç›´ä¼ é€’ä¸‹å»ã€‚</p></li></ul><p>æ³¨æ„ï¼šè¯­ä¹‰å‘é‡ $c$ ä½œç”¨äºDecoderçš„æ¯ä¸€æ—¶åˆ»ã€‚</p><p>â€‹        $h _1= tanh(W[h _0, y _0], +b) $</p><p>â€‹        $o _1 = softmax(Vh _1, +c)$</p><p>â€‹        $h _2= tanh(W[h _1, y _1], +b) $</p><p>â€‹        $o _2 = softmax(Vh _2, +c)$</p><p>â€‹        $â€¦$</p><p>â€‹        $h _T= tanh(W[{h} _{T-1}, {y} _{T-1}], +b) $</p><p>â€‹        $o _T = softmax(Vh _T, +c)$</p><p>å…¶ä¸­ $o _t$ä¸ºæ¯ä¸ªæ—¶åˆ»çš„è¾“å‡ºï¼Œæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå‘é‡ç»´åº¦æ˜¯è¯è¡¨é•¿åº¦ï¼Œå‘é‡ä¸­çš„æ¯ä¸ªå€¼æ˜¯å¯¹åº”å•è¯çš„æ¦‚ç‡ã€‚ç›´åˆ°é¢„æµ‹å€¼ $ &lt; END &gt; $çš„æ¦‚ç‡æœ€å¤§æ—¶ï¼Œç»“æŸé¢„æµ‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/57155059">ç®€è¯´Seq2SeqåŸç†åŠå®ç°</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åºåˆ—åˆ°åºåˆ—æ¨¡å‹ </tag>
            
            <tag> Encoder Decoder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KBQAè®ºæ–‡æ±‡æ€»</title>
      <link href="/2020/08/13/kbqs-lun-wen-hui-zong/"/>
      <url>/2020/08/13/kbqs-lun-wen-hui-zong/</url>
      
        <content type="html"><![CDATA[<p>A-Joint-Model-of-Entity-Linking-and-Predicate-Recognition-for-Knowledge-Base-Question-Answering</p><p>ç¿»è¯‘é“¾æ¥ã€€<a href="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/" title="A Joint Model of Entity Linking and Predicate Recognition for Knowledge Base Question Answering">A Joint Model of Entity Linking and Predicate Recognition for Knowledge Base Question Answering</a></p><p>Part-of-Speech-Tagging-with-Bidirectional-Long-Short-Term-Memory-Recurrent-Neural-Network</p><p>ç¿»è¯‘é“¾æ¥ã€€<a href="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/" title="Part-of-Speech Tagging with Bidirectional Long Short-Term Memory Recurrent Neural Network é˜…è¯»">Part-of-Speech Tagging with Bidirectional Long Short-Term Memory Recurrent Neural Network é˜…è¯»</a></p><p>A-Chinese-Question-Answering-System-for-Single-Relation-Factoid-Questions</p><p>ç¿»è¯‘é“¾æ¥ã€€<a href="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/" title="A Chinese Question Answering System for Single-Relation Factoid Questions é˜…è¯»">A Chinese Question Answering System for Single-Relation Factoid Questions é˜…è¯»</a></p><p>Open Domain Question Answering System Based on Knowledge Base</p><p>ç¿»è¯‘é“¾æ¥ã€€<a href="/2020/08/13/open-domain-question-answering-system-based-on-knowledge-base/" title="Open Domain Question Answering System Based on Knowledge Base">Open Domain Question Answering System Based on Knowledge Base</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shell</title>
      <link href="/2020/08/12/shell/"/>
      <url>/2020/08/12/shell/</url>
      
        <content type="html"><![CDATA[<h1 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h1><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><pre class=" language-shell"><code class="language-shell">gnome-system-monitor # æŸ¥çœ‹ubantuå†…å­˜watch -d -n 2 nvidia-smi # å®šæ—¶åˆ·æ–°æ˜¾å¡å†…å­˜ä½¿ç”¨æƒ…å†µ dpkg --list | grep -i jdk # æŸ¥çœ‹javaç‰ˆæœ¬</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> lniux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Joint Model of Entity Linking and Predicate Recognition for Knowledge Base Question Answering</title>
      <link href="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/"/>
      <url>/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/</url>
      
        <content type="html"><![CDATA[<h1 id="A-Joint-Model-of-Entity-Linking-and-Predicate-Recognition-for-Knowledge-Base-Question-Answering"><a href="#A-Joint-Model-of-Entity-Linking-and-Predicate-Recognition-for-Knowledge-Base-Question-Answering" class="headerlink" title="A Joint Model of Entity Linking and Predicate Recognition for Knowledge Base Question Answering"></a>A Joint Model of Entity Linking and Predicate Recognition for Knowledge Base Question Answering</h1><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>ã€€ã€€åœ¨æœ¬paperä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ªè‡ªåŠ¨æ‰¾åˆ°æ­£ç¡®ç­”æ¡ˆçš„é—®ç­”ç³»ç»Ÿ, ç¬¬ä¸€æ­¥æ˜¯ä¸ºä¸€ä¸ªé—®é¢˜ç¡®å®šçŸ¥è¯†åº“ä¸­æ‰€æœ‰çš„å®ä½“.åˆ©ç”¨é¢„æµ‹åˆ†æ•°å¯¹ä¸»é¢˜å®ä½“çš„æ‰€æœ‰æ’åºåä¸‰å…ƒç»„åˆè¿›è¡Œlogisticå»ºæ¨¡ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨è”åˆè®­ç»ƒå®ä½“é“¾æ¥å’Œè°“è¯è¯†åˆ«æ¨¡å‹å¯¹é—®é¢˜çš„ä¸‰å…ƒç»„è¿›è¡Œé‡æ–°æ’åºï¼æœ€åï¼Œåˆ©ç”¨è§„åˆ™åŒ¹é…ä»ä¸‰å…ƒç»„ä¸­é€‰æ‹©ç­”æ¡ˆã€‚æ–¹æ³•åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„å¹³å‡f1åˆ†ä¸º57.67%ï¼Œè·å¾—CCKS 2018 COQAä»»åŠ¡ç«èµ›çš„ç¬¬äºŒåã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ã€€ã€€æœ¬æ–‡é¦–å…ˆæ˜¯é€‰æ‹©å®ä½“ï¼Œç„¶åé€‰æ‹©one-hop å’Œ two-hopè¿›è¡Œå®ä½“æ’åºï¼ç„¶åä½¿ç”¨è¯­ä¹‰åŒ¹é…æ¨¡å‹BiMPM[1]æ¥è®­ç»ƒä¸€ä¸ªç”¨äºå®ä½“é“¾æ¥å’Œè°“è¯è¯†åˆ«çš„è”åˆæ¨¡å‹æ¥å¯¹ä¸‰å…ƒç»„è¿›è¡Œé‡æ–°æ’åºã€‚æœ€åï¼ŒåŸºäºè§„åˆ™åŒ¹é…ä»ä¸‰å…ƒç»„ä¸­é€‰æ‹©ç­”æ¡ˆã€‚one-hop å’Œ two-hopä¸‰å…ƒç»„çš„é—®é¢˜å 90.02%ã€‚å› æ­¤ï¼Œæœ¬æ–‡ä¸»è¦æ¢è®¨è¿™äº›é—®é¢˜ã€‚</p><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p>ã€€ã€€KBQAæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸçš„ä¸€ä¸ªé‡è¦è¯¾é¢˜ã€‚ç›®å‰æœ‰ä¸¤ç§ä¸»æµæ–¹æ³•:åŸºäºè¯­ä¹‰è§£æå’ŒåŸºäºæ£€ç´¢ã€‚</p><p>ã€€ã€€è¯­æ„è§£æé¦–å…ˆè§£æé—®é¢˜çš„é€»è¾‘å½¢å¼ï¼Œè¯¥å½¢å¼æ˜¯ä¸€è¯¾è¯­ä¹‰æ ‘ï¼Œç»„åˆçš„æ–¹å¼æ˜¾å¼åœ°è¡¨ç¤ºé—®é¢˜çš„æ„ä¹‰ï¼Œæ ¹æ®çŸ¥è¯†åº“æ‰§è¡Œé€»è¾‘å¾—åˆ°ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•çš„é€»è¾‘å½¢å¼æœ‰åŠ©äºç†è§£é—®é¢˜çš„è¯­ä¹‰ç»“æ„ï¼Œä¹Ÿå¢åŠ äº†è¿™é¡¹ä»»åŠ¡çš„éš¾åº¦ã€‚Laiä½¿ç”¨åŸºäºè¯åµŒå…¥çš„ç‰¹å¾æœç´¢æœ€ä¼˜çš„ä¸»è¯­è°“è¯å¯¹ï¼Œå¹¶æ ¹æ®è§„åˆ™åœ¨NLPCC 2016 KBQAä»»åŠ¡ä¸­è·å¾—ç¬¬ä¸€åã€‚Laiæå‡ºäº†ä¸€ç§æ–°çš„åŸºäºæ·±åº¦cnnçš„æ–¹æ³•æ¥å¯¹ç”±æµ…å±‚ç‰¹å¾ç”Ÿæˆçš„å®ä½“-è°“è¯å¯¹è¿›è¡Œé‡æ–°æ’åºã€‚è¯¥æ–¹æ³•åœ¨NLPCC 2017 KBQAä»»åŠ¡ç«èµ›ä¸­è·å¾—ç¬¬ä¸€åã€‚Huæå‡ºäº†ä¸€ç§åŠ¨æ€æŸ¥è¯¢å›¾åŒ¹é…æ–¹æ³•ï¼Œä»æ•°æ®é©±åŠ¨çš„è§’åº¦å¤„ç†å®ä½“å’Œå…³ç³»çš„æ¶ˆæ­§ä»»åŠ¡ã€‚åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†åŸºäºæ£€ç´¢çš„æ–¹æ³•ã€‚</p><h2 id="The-Proposed-System"><a href="#The-Proposed-System" class="headerlink" title="The Proposed System"></a>The Proposed System</h2><p><img src="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/1.png"></p><p>  ç³»ç»Ÿæ¶æ„å¦‚å›¾1æ‰€ç¤ºã€‚ç¬¬ä¸€æ­¥æ˜¯é¢„å¤„ç†ï¼Œå³å¯¹è¾“å…¥é—®é¢˜è¿›è¡Œåˆ†è¯å¤„ç†ã€‚ç„¶åæ ¹æ®é¢„å¤„ç†ç»“æœè¿›è¡Œå®ä½“è¯†åˆ«æ¨¡å—ï¼Œç„¶åå¯¹å…·æœ‰æŸäº›ç‰¹å¾çš„ä¸‰å…ƒç»„è·¯å¾„è¿›è¡Œä¼˜å…ˆæ’åºï¼</p><p>ç”¨BiMPMé€‰æ‹©åŒ¹é…çš„ä¸‰å…ƒç»„è·¯å¾„ã€‚æœ€åï¼Œä»åŒ¹é…çš„å€™é€‰ä¸‰å…ƒç»„è·¯å¾„ä¸­é€‰æ‹©ç­”æ¡ˆã€‚</p><h2 id="Knowledge-Base-and-Dictionary"><a href="#Knowledge-Base-and-Dictionary" class="headerlink" title="Knowledge Base and Dictionary"></a>Knowledge Base and Dictionary</h2><p>â€‹    çŸ¥è¯†åº“(KB)å’Œå®ä½“æåŠå­—å…¸ ç”±CCKSæä¾›, æ­¤å¤–ï¼Œç”¨äºHanlpæ„å»ºäº†åˆ†å‰²è¯å…¸ï¼Œä»¥æé«˜è¯­åˆ†å‰²å’Œå®ä½“æåŠè¯†åˆ«çš„ç»“æœã€‚åˆ†å‰²å­—å…¸æ˜¯ç”±æ‰€æœ‰ä¸»é¢˜çš„KBï¼Œæ‰€æœ‰å®ä½“åŠå…¶æåˆ°çš„å­—å…¸ã€‚</p><h2 id="Topic-Entity-Recognition"><a href="#Topic-Entity-Recognition" class="headerlink" title="Topic Entity Recognition"></a>Topic Entity Recognition</h2><p>ã€€ã€€å¦‚æœé—®é¢˜åˆ†å‰²çš„è¯åœ¨å­—å…¸ä¸­ï¼Œåˆ™è¯¥è¯å±äºå®ä½“ã€‚ä»æŸäº›ç‰¹å¾æ¥çœ‹ï¼Œè¢«è¯†åˆ«çš„æåŠå®ä½“è¢«æåŠçš„æ¦‚ç‡æ˜¯ä¸åŒçš„ã€‚æˆ‘ä»¬ç³»ç»Ÿä¸­ä½¿ç”¨çš„ç‰¹æ€§å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>æœ‰è¾ƒé•¿çš„å­—ç¬¦ä¸²çš„å®ä½“æ›´å¯èƒ½æ˜¯ä¸»é¢˜å®ä½“ï¼Œè€Œä¸æ˜¯è¾ƒçŸ­çš„å®ä½“ã€‚</li><li>å®ä½“çš„TFå€¼é«˜è¯é¢‘(TF)å€¼çš„å®ä½“æ¯”ä½è¯é¢‘(TF)å€¼çš„å®ä½“æˆä¸ºä¸»é¢˜å®ä½“çš„æ¦‚ç‡æ›´ä½</li><li>å®ä½“ä¸ç–‘é—®è¯ä¹‹é—´çš„è·ç¦»é è¿‘ç–‘é—®è¯çš„é—®é¢˜ä¸­å®ä½“æ›´å¯èƒ½æ˜¯ä¸»é¢˜å®ä½“</li></ul><p>ã€€ã€€æœ€åä¸€æ­¥æ‰€è¯†åˆ«çš„è¿æ¥å®ä½“æåˆ°çš„å®ä½“å¹¶ä¸æ˜¯å®ä½“çŸ¥è¯†åº“ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ç¡®å®šå®ä½“æåŠçš„èº«ä»½é—®é¢˜ã€‚å®ä½“çš„å…³ç³»å’Œå±æ€§ä¿¡æ¯æœ‰åŠ©äºå®ä½“é“¾æ¥ï¼Œå› æ­¤é¦–å…ˆæå–å®ä½“ two-hopï¼Œæ ¹æ®æ‰€é€‰æ‹©çš„å€™é€‰å®ä½“æå–ç‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªç‰¹å¾å¯¹åŒ¹é…çš„ä¸»é¢˜å®ä½“è¿›è¡Œæ’åºå’Œé€‰æ‹©ï¼</p><ul><li>é—®é¢˜ä¸å€™é€‰å®ä½“çš„two-hopå­å›¾ä¹‹é—´çš„é‡å è¯è¶Šå¤šï¼Œæ‰€æå–çš„å®ä½“ä¸ºä¸»é¢˜å®ä½“çš„æ¦‚ç‡è¶Šå¤§ã€‚</li><li>é—®é¢˜ä¸å€™é€‰å®ä½“çš„two-hopå­å›¾ä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šå¤§ï¼Œæ‰€æå–çš„å®ä½“ä¸ºä¸»é¢˜å®ä½“çš„æ¦‚ç‡è¶Šå¤§ã€‚</li><li>é—®é¢˜å’Œä¸‰å…ƒç»„è·¯å¾„çš„å­—ç¬¦é‡å ç‰¹å¾æ˜¯ç›¸ä¼¼çš„ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯è¯¥ç‰¹æ€§ä½¿ç”¨å­—ç¬¦çº§è€Œä¸æ˜¯å•è¯çº§ã€‚</li></ul><p>åœ¨è®¡ç®—å’Œæ­£åˆ™åŒ–æ‰€æœ‰ç‰¹å¾åï¼Œåˆ©ç”¨çº¿æ€§åŠ æƒæ–¹æ³•å¯¹å€™é€‰å®ä½“è¿›è¡Œæ’åºã€‚åˆ†æ•°æ–¹ç¨‹å®šä¹‰å¦‚ä¸‹å¼ï¼Œå…¶ä¸­$w _i$è¡¨ç¤ºç‰¹å¾$i$çš„æƒé‡ã€‚</p><p>${Score} _{tpicentity} = w _1 * F _1 + w _2 * F _2  + w _3 * F _3 + w _4 * F _ 4 + w _5 * F _5 + w _6 * F _6$</p><h2 id="Predicate-Recognition"><a href="#Predicate-Recognition" class="headerlink" title="Predicate Recognition"></a>Predicate Recognition</h2><p>ã€€ã€€ä¸€ä¸ªä¸»é¢˜å®ä½“å¯ä»¥æå–å¤§çº¦349.6æ¡å€™é€‰ä¸‰å…ƒç»„è·¯å¾„ã€‚å¾ˆéš¾ä»å¦‚æ­¤å¤šçš„å€™é€‰ä¸‰å…ƒç»„è·¯å¾„ä¸­é€‰æ‹©æœ€åŒ¹é…çš„è·¯å¾„ã€‚ç¼©å°å€™é€‰ä¸‰å…ƒç»„è·¯å¾„æ˜¯æé«˜æœ€ç»ˆç»“æœçš„é‡è¦æ­¥éª¤ã€‚åœ¨æœ¬æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæå–å…³äºä¸‰å…ƒç»„è·¯å¾„è°“è¯çš„å››ä¸ªç‰¹æ€§ã€‚ç„¶ååˆ©ç”¨logisticå›å½’ç®—æ³•å¯¹å…·æœ‰ä»¥ä¸‹å››ä¸ªç‰¹å¾å’Œä¸»é¢˜å®ä½“è¯†åˆ«ç‰¹å¾çš„å€™é€‰ä¸‰å…ƒç»„è·¯å¾„è¿›è¡Œæ’åºã€‚æœ€åï¼Œæˆ‘ä»¬é€‰æ‹©å‰10æ¡ä¸‰å…ƒç»„è·¯å¾„ä½œä¸ºä¸‹ä¸€ä¸ªè¯­ä¹‰åŒ¹é…æ¨¡å—çš„å€™é€‰è·¯å¾„ã€‚</p><ul><li><p>ç–‘é—®å¥å’Œè°“è¯­ä¹‹é—´çš„å•è¯é‡å  </p><p>ä¸‰å…ƒç»„è·¯å¾„çš„é—®é¢˜è°“è¯ä¸å€™é€‰è°“è¯ä¹‹é—´å…±äº«çš„é‡å è¯è¶Šå¤šï¼Œå€™é€‰è°“è¯ä¸ºçœŸå®è°“è¯çš„æ¦‚ç‡è¶Šå¤§ã€‚</p></li><li><p>ç–‘é—®å¥ä¸è°“è¯­ä¹‹é—´çš„è¯åµŒå…¥ç›¸ä¼¼æ€§</p><p>é—®é¢˜ä¸å€™é€‰è°“è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§è¶Šå¤§ï¼Œå€™é€‰è°“è¯çœŸæ­£æ˜¯è°“è¯çš„å¯èƒ½æ€§è¶Šå¤§ã€‚</p></li><li><p>é—®é¢˜å’Œè°“è¯ä¹‹é—´çš„å­—ç¬¦é‡å </p><p>è¿™ä¸ªç‰¹æ€§å‡ ä¹ä¸ç¬¬ä¸€ä¸ªç›¸åŒã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯è¿™ä¸ªç‰¹æ€§ä½¿ç”¨charçº§è€Œä¸æ˜¯è¯æ°´å¹³</p></li></ul><ul><li><p>é—®é¢˜å’Œè°“è¯ä¹‹é—´çš„å­—ç¬¦åµŒå…¥ç›¸ä¼¼æ€§</p><p>è¿™ä¸ªç‰¹æ€§å‡ ä¹ä¸ç¬¬äºŒå¥ç›¸åŒã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯è¯¥ç‰¹æ€§ä½¿ç”¨å­—ç¬¦çº§è€Œä¸æ˜¯å•è¯çº§ã€‚</p></li></ul><h2 id="Semantic-Matching"><a href="#Semantic-Matching" class="headerlink" title="Semantic Matching"></a>Semantic Matching</h2><p>é—®é¢˜çš„å½¢å¼åŒ– </p><p>  è¿™ä¸ªæ¨¡å—çš„ç›®æ ‡æ˜¯ä»nä¸ªå€™é€‰ä¸‰å…ƒç»„è·¯å¾„{T P1, T P2ï¼Œâ€¦Qæ˜¯ç”¨æˆ·çš„é—®é¢˜ã€‚TPiæ˜¯Qçš„å€™é€‰ä¸‰å…ƒç»„è·¯å¾„ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸¤è¯„åˆ†å‡½æ•°S(TPi,Q)å¯¹æ‰€æœ‰å€™é€‰ä¸‰å…ƒç»„è·¯å¾„è¿›è¡Œè¯„åˆ†å’Œæ’åºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œnä¸º10ã€‚</p><p>BiMPM ï¼‹Fea</p><p>  å°†å•è¯åµŒå…¥å’Œæ‰€æœ‰10ä¸ªç‰¹æ€§åˆå¹¶åˆ°BiMPMä¸­ï¼Œä»¥é€‰æ‹©æœ€ä½³åŒ¹é…çš„ä¸‰å…ƒç»„è·¯å¾„ã€‚BiMPM+FeaåŒ…å«5ä¸ªå†…æ ¸å±‚ã€‚</p><ul><li>å•è¯è¡¨ç¤ºå±‚:è¯¥å±‚çš„ç›®æ ‡æ˜¯ç”¨dç»´å‘é‡è¡¨ç¤ºæ¯ä¸ªæœ‰é—®é¢˜çš„å•è¯å’Œä¸‰é‡è·¯å¾„ã€‚å°†åµŒå…¥åˆ°è®ºæ–‡ä¸­çš„å•è¯ç”¨Gensimè¿›è¡Œé¢„è®­ç»ƒï¼Œdä¸º100ã€‚</li><li>ä¸Šä¸‹æ–‡è¡¨ç¤ºå±‚:æ­¤å±‚çš„ç›®çš„æ˜¯å°†ä¸Šä¸‹æ–‡ä¿¡æ¯åˆå¹¶åˆ°é—®é¢˜å’Œä¸‰å…ƒç»„è·¯å¾„çš„æ¯ä¸ªæ—¶é—´æ­¥éª¤çš„è¡¨ç¤ºä¸­ã€‚æœ¬æ–‡ä½¿ç”¨BiLSTMå¯¹æ¯ä¸ªæ—¶é—´æ­¥é•¿è¿›è¡Œä¸Šä¸‹æ–‡åµŒå…¥ç¼–ç ã€‚</li><li>åŒ¹é…å±‚:è¿™æ˜¯æ ¸å¿ƒå±‚ï¼Œç”¨äºè·å–é—®é¢˜ä¸ä¸‰å…ƒç»„è·¯å¾„åœ¨æ—¶é—´æ­¥é•¿ä¸Šçš„ç›¸ä¼¼æ€§ã€‚æ­¤å¤–ï¼ŒåŒ¹é…æ˜¯åŒå‘çš„ï¼Œå³é—®é¢˜ä¸ä¸‰å…ƒç»„è·¯å¾„ç›¸äº’åŒ¹é…ï¼Œå¹¶åˆ†åˆ«ä»å„è‡ªçš„åŒ¹é…ä¿¡æ¯ä¸­è·å¾—åŒ¹é…ä¿¡æ¯ã€‚</li><li>èšåˆå±‚:å°†åŒ¹é…ä¿¡æ¯çš„é—®é¢˜å’Œä¸‰å…ƒç»„è·¯å¾„èšåˆä¸ºå®šé•¿ã€‚èšåˆå±‚ç”±BiLSTMç»„æˆï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€ç»ˆçš„éšè—çŠ¶æ€æ¥è¡¨ç¤ºèšåˆçš„ä¿¡æ¯ã€‚</li><li>ç‰¹å¾èšåˆå±‚:è¯¥å±‚å°†æœ€åä¸€å±‚çš„å®šé•¿å¼ é‡ä¸æˆ‘ä»¬æå–çš„10ä¸ªç‰¹å¾è¿æ¥èµ·æ¥ã€‚</li></ul><h2 id="Answers-Selection"><a href="#Answers-Selection" class="headerlink" title="Answers Selection"></a>Answers Selection</h2><p>åœ¨è¯­ä¹‰åŒ¹é…æ¨¡å—ä¸­é€‰æ‹©åŒ¹é…çš„ä¸‰å…ƒç»„è·¯å¾„ã€‚ç„¶åè§„åˆ™ç”Ÿæˆç­”æ¡ˆã€‚å›¾2æ˜¾ç¤ºäº†æˆ‘ä»¬çš„è§„åˆ™ç¤ºä¾‹ã€‚å›¾ä¸­åœ†å½¢èŠ‚ç‚¹æˆ–çŸ©å½¢èŠ‚ç‚¹ä»…è¡¨ç¤ºå®ä½“æˆ–å±æ€§å€¼ï¼Œä¸å½±å“è§„åˆ™é€‰æ‹©ç­”æ¡ˆã€‚è“è‰²ç»“ç‚¹å°±æ˜¯ç­”æ¡ˆã€‚</p><p><img src="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/2.png"></p><p>One-hop ä¸‰å…ƒè·¯å¾„:ã€€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç­”æ¡ˆæ˜¯é—®é¢˜ä¸­æ²¡æœ‰å‡ºç°çš„ä¸‰å…ƒç»„è·¯å¾„çš„ç»„ä»¶ã€‚</p><p>Two-hop ä¸‰å…ƒè·¯å¾„:ã€€å¦‚æœä¸‰å…ƒç»„è·¯å¾„ä¸­æœ€å³è¾¹çš„èŠ‚ç‚¹å’Œæœ€å·¦è¾¹çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰å‡ºç°åœ¨é—®é¢˜ä¸­ï¼Œé‚£ä¹ˆä¸­é—´çš„èŠ‚ç‚¹å°±æ˜¯ç­”æ¡ˆã€‚å¦‚æœæœ€å³è¾¹çš„èŠ‚ç‚¹æˆ–æœ€å·¦è¾¹çš„èŠ‚ç‚¹å‡ºç°åœ¨é—®é¢˜ä¸­ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå°±æ˜¯ç­”æ¡ˆã€‚</p><h2 id="Experiments-and-discussion"><a href="#Experiments-and-discussion" class="headerlink" title="Experiments and discussion"></a>Experiments and discussion</h2><p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨CCKSæ•°æ®æ¥è¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ã€‚è¯¥æ•°æ®é›†ç”±CCKS 2018è¯„ä¼°ä»»åŠ¡å‘å¸ƒï¼ŒåŒ…æ‹¬çŸ¥è¯†åº“ã€çŸ¥è¯†å®ä½“æå–æ–‡ä»¶å’Œç”¨äºè®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•çš„é—®ç­”å¯¹ã€‚çŸ¥è¯†åº“æœ‰4100ä¸‡ä¸‰å€ã€‚2018-Trainé›†ã€2018-Valé›†ã€2018-Testé›†åˆ†åˆ«åŒ…å«1283,400,400ä¸ªæ ·æœ¬ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†è·å¾—è´Ÿæ ·æœ¬ï¼Œå¯¹äºæ¯ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€‰æ‹©å‰10ä¸ªé”™è¯¯çš„å€™é€‰ä¸‰å…ƒè·¯å¾„ã€‚ä¸ºäº†å‡è½»è®­ç»ƒæ•°æ®ä¸å¹³è¡¡çš„å½±å“ï¼Œæˆ‘ä»¬å¯¹æ­£æ ·æœ¬è¿›è¡Œè¿‡é‡‡æ ·ã€‚</p><h2 id="Topic-Entity-Recognition-Result"><a href="#Topic-Entity-Recognition-Result" class="headerlink" title="Topic Entity Recognition Result"></a>Topic Entity Recognition Result</h2><p><img src="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/3.png"></p><p>è¡¨1æ˜¾ç¤ºäº†ä¸»é¢˜å®ä½“è¯†åˆ«æ¨¡å—çš„ç³»ç»Ÿæ€§èƒ½ã€‚åŸºæœ¬å‹baselineT Eåªä½¿ç”¨F1, F2, F3, F4ã€‚ç¬¬äºŒä¸ªæ¨¡å‹æ˜¯baselineT E +Embï¼Œå®ƒä¹Ÿä½¿ç”¨äº†åµŒå…¥ç‰¹æ€§F5ã€‚æœ€åä¸€ä¸ªæ˜¯baselineT E +Emb+Charï¼Œä¹Ÿä½¿ç”¨äº†åµŒå…¥ç‰¹æ€§F5å’ŒCharçº§ç‰¹æ€§F6ã€‚ä»è¡¨1å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼ŒåµŒå…¥ç‰¹å¾F5å’Œcharçº§ç‰¹å¾F6éƒ½å¯ä»¥æé«˜ä¸»é¢˜å®ä½“è¯†ï¼è¶…å‚æ•°$w _i$ä¸º[0.25,0.37ï¼Œ-0.32,0.67,0.71,0.58]ã€‚</p><h2 id="BiMPM-Re-ranking-Result"><a href="#BiMPM-Re-ranking-Result" class="headerlink" title="BiMPM Re-ranking Result"></a>BiMPM Re-ranking Result</h2><p><img src="/2020/08/12/a-joint-model-of-entity-linking-and-predicate-recognition-for-knowledge-base-question-answering/4.png"></p><p>è¡¨2æ˜¾ç¤ºäº†å®éªŒç³»ç»Ÿçš„æ€§èƒ½, åŸºæœ¬æ¨¡å‹BiMPMåªä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„å­—åµŒå…¥ã€‚ç¬¬äºŒä¸ªæ˜¯BiMPM+Feaï¼Œå®ƒä¹Ÿä½¿ç”¨äº†åŸºäºåŸºçº¿BiMPMæå–çš„10ä¸ªç‰¹å¾ã€‚æœ€åä¸€ä¸ªæ˜¯BiMPM+Fea+CVï¼Œå®ƒåˆ©ç”¨äº†åŸºäºBiMPM+Feaçš„10å€äº¤å‰éªŒè¯ã€‚æ˜æ˜¾çœ‹å‡ºï¼Œæå–çš„ç‰¹å¾å’Œäº¤å‰éªŒè¯éƒ½å¯ä»¥æé«˜f1å¾—åˆ†.æµ‹è¯•ç»“æœé«˜å‡º2.5%ï¼åŸå› æ˜¯å®ä½“é“¾æ¥åˆ†æ•°å’Œé¢„æµ‹è¯†åˆ«åˆ†æ•°å¯¹äºä¸‰å…ƒç»„è·¯å¾„çš„é¢„æ’åºæ˜¯æœ‰ç”¨çš„ã€‚</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>ä¸€ç§ç”¨äºKBQAçš„å®ä½“è¿æ¥å’Œè°“è¯è¯†åˆ«çš„è”åˆæ¨¡å‹ã€‚ç³»ç»Ÿåœ¨CCKS 2018 COQAä»»åŠ¡ä¸­ï¼Œf1å¾—åˆ†ä¸º57.67%ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kbqa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒ»ç–—çŸ¥è¯†é—®ç­”</title>
      <link href="/2020/08/10/yi-liao-zhi-shi-wen-da/"/>
      <url>/2020/08/10/yi-liao-zhi-shi-wen-da/</url>
      
        <content type="html"><![CDATA[<h1 id="åŒ»ç–—çŸ¥è¯†é—®ç­”"><a href="#åŒ»ç–—çŸ¥è¯†é—®ç­”" class="headerlink" title="åŒ»ç–—çŸ¥è¯†é—®ç­”"></a>åŒ»ç–—çŸ¥è¯†é—®ç­”</h1><p>æœ¬å†…å®¹å‚è€ƒäº†<a href="https://github.com/liuhuanyong/QASystemOnMedicalKG%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E7%94%A8%E4%BA%8E%E5%AD%A6%E4%B9%A0,%E5%9C%A8%E8%BF%99%E9%87%8C%E6%84%9F%E8%B0%A2%E5%88%98%E7%84%95%E5%8B%87%E8%80%81%E5%B8%88%E7%9A%84%E4%BB%A3%E7%A0%81%E5%88%86%E4%BA%AB">https://github.com/liuhuanyong/QASystemOnMedicalKGï¼Œä¸»è¦æ˜¯ç”¨äºå­¦ä¹ ,åœ¨è¿™é‡Œæ„Ÿè°¢åˆ˜ç„•å‹‡è€å¸ˆçš„ä»£ç åˆ†äº«</a></p><p>æ•ˆæœé¢„è§ˆã€€pcç«¯ï¼š<a href="http://106.13.47.214/full/#/knowledgeMap">http://106.13.47.214/full/#/knowledgeMap</a>ã€€</p><p>ã€€ã€€ã€€ã€€ã€€æ‰‹æœºç«¯APPä¸‹è½½ï¼ˆç›®å‰åªç”Ÿæˆå®‰å“ç«¯ï¼Œç†è®ºé¡¹ç›®å®‰å“ï¼Œios,å°ç¨‹åºéƒ½å°†å¯ä»¥ç”Ÿæˆï¼Œå¯ä»¥è·¨å¤šç«¯ï¼‰ï¼š<a href="https://pan.baidu.com/s/1hccJoHANdmn4kf251Clj_A">https://pan.baidu.com/s/1hccJoHANdmn4kf251Clj_A</a>  å¯†ç :rlv7</p><p>é¡¹ç›®ä»£ç ï¼š</p><p>ã€€ã€€ã€€ã€€çˆ¬è™«ï¼š(scrapy)<a href="https://gitee.com/daiyizheng/scrapy.git">https://gitee.com/daiyizheng/scrapy.git</a></p><p>ã€€ã€€ã€€ã€€ç½‘é¡µå‰ç«¯ï¼ˆvueï¼‰ <a href="https://gitee.com/daiyizheng/nlp-vue.git">https://gitee.com/daiyizheng/nlp-vue.git</a></p><p>â€‹               åç«¯ï¼ˆflaskï¼‰<a href="https://gitee.com/daiyizheng/nlp-flask.git">https://gitee.com/daiyizheng/nlp-flask.git</a></p><p>ã€€ã€€ã€€ã€€æ‰‹æœºappé¡¹ç›®ï¼ˆuniapp h5è·¨å¤šç«¯å¼€å‘ï¼‰ï¼š<a href="https://gitee.com/daiyizheng/NLP-uniapp.git">https://gitee.com/daiyizheng/NLP-uniapp.git</a></p><p>â€‹                æ¨¡å‹ï¼ˆhaggingfaceï¼‰<a href="https://gitee.com/daiyizheng/medicine-qa-on-knowledge-graph-with-ro-berta.git">https://gitee.com/daiyizheng/medicine-qa-on-knowledge-graph-with-ro-berta.git</a></p><h2 id="ä»»åŠ¡æè¿°"><a href="#ä»»åŠ¡æè¿°" class="headerlink" title="ä»»åŠ¡æè¿°"></a>ä»»åŠ¡æè¿°</h2><p>æœ¬é¡¹ç›®æ˜¯åŸºäºçŸ¥è¯†å›¾è°±çš„åŒ»ç–—é—®ç­”ç³»ç»Ÿï¼ŒBERT+CRFåšå‘½åå®ä½“è¯†åˆ«å’ŒBERTå¥å­åˆ†ç±»ï¼Œæœ€åå®ç°torchserveçš„éƒ¨ç½²ã€‚ï¼ˆç”±äºåŠŸèƒ½éƒ¨ç½²è¿˜æ˜¯ç®—åŠä¼ä¸šçº§ï¼ŒåæœŸæ”¹ç”¨RasaåšåŒ»ç–—çŸ¥è¯†å›¾è°±é—®ç­”ï¼‰</p><h2 id="æ•°æ®ç®€ä»‹"><a href="#æ•°æ®ç®€ä»‹" class="headerlink" title="æ•°æ®ç®€ä»‹"></a>æ•°æ®ç®€ä»‹</h2><h3 id="åŸå§‹æ•°æ®ç½‘ç»œçˆ¬å–"><a href="#åŸå§‹æ•°æ®ç½‘ç»œçˆ¬å–" class="headerlink" title="åŸå§‹æ•°æ®ç½‘ç»œçˆ¬å–"></a>åŸå§‹æ•°æ®ç½‘ç»œçˆ¬å–</h3><p>scrapy çˆ¬å–<a href="http://www.xywy.com/%E7%BD%91%E7%AB%99%E5%8C%BB%E8%8D%AF%E7%9C%8B%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8E%E5%8E%9F%E9%A1%B9%E7%9B%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%EF%BC%9A%E5%8E%9F%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFrequests%E5%BA%93%E6%9D%A5%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9A%84%EF%BC%8C%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0scrapy%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%AF%A5%E6%A1%86%E6%9E%B6%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%88%E7%88%AC%E8%99%ABscrapy%E7%9F%A5%E8%AF%86%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83https://daiyizheng.github.io/2020/06/01/scrapy/%EF%BC%89">http://www.xywy.com/ç½‘ç«™åŒ»è¯çœ‹æ•°æ®ï¼Œä¸åŸé¡¹ç›®ä¸åŒçš„æ˜¯ï¼šåŸé¡¹ç›®ä½¿ç”¨çš„æ˜¯requestsåº“æ¥çˆ¬å–æ•°æ®çš„ï¼Œä¸ªäººå­¦ä¹ scrapyæ¡†æ¶ï¼Œä½¿ç”¨è¯¥æ¡†æ¶çˆ¬å–æ•°æ®ï¼ˆçˆ¬è™«scrapyçŸ¥è¯†å¯ä»¥å‚è€ƒhttps://daiyizheng.github.io/2020/06/01/scrapy/ï¼‰</a></p><p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/8.png"></p><p>çˆ¬å–çš„æ•°æ®ç»“æ„å­˜æ”¾åœ¨mongdbä¸­,å¯ä»¥é€šè¿‡æ’ä»¶Mongo ExpressæŸ¥çœ‹</p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/10.png" style="zoom:80%;"><p>æ•°æ®å¤„ç†ï¼š</p><p>ç”±äºæ•°æ®æ ‡æ³¨æ¯”è¾ƒè´¹æ—¶é—´ï¼Œ(æ ‡æ³¨æ–¹æ³•å¯ä»¥ä½¿ç”¨æ ‡æ³¨ç²¾çµ)</p><p>ã€€ã€€åæ¥çœ‹åˆ°æœ‰äººå·²ç»è¡¨è¿‡æ•°æ®äº†ï¼Œä¸€ç›´é‡‡ç”¨äº†ä»–çš„æ•°æ®</p><p>ã€€ã€€LSTM-CRF <a href="https://gitee.com/untilwty/chatbot-base-on-Knowledge-Graph/tree/master/data_ai">https://gitee.com/untilwty/chatbot-base-on-Knowledge-Graph/tree/master/data_ai</a></p><p>å‘½åå®ä½“éƒ¨åˆ†é‡‡ç”¨äº†BIOESæ ‡æ³¨</p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/11.png"><p>å…³ç³»åˆ†ç±»ï¼š</p><p>ã€€ã€€ã€€ã€€ã€€<img src="/2020/08/10/yi-liao-zhi-shi-wen-da/12.png"></p><p>åˆ†ç±»éƒ¨åˆ†çš„æ•°æ®åšäº†æ•°æ®å¢å¼ºï¼ˆ<strong>å®ä½“å’Œå…³ç³»å€’å™</strong>ï¼‰</p><h3 id="çŸ¥è¯†å›¾è°±ç»“æ„"><a href="#çŸ¥è¯†å›¾è°±ç»“æ„" class="headerlink" title="çŸ¥è¯†å›¾è°±ç»“æ„"></a>çŸ¥è¯†å›¾è°±ç»“æ„</h3><p>çŸ¥è¯†å›¾è°±å®ä½“ç±»å‹</p><table><thead><tr><th align="left">å®ä½“ç±»å‹</th><th align="center">ä¸­æ–‡å«ä¹‰</th><th align="center">å®ä½“æ•°é‡</th><th align="left">ä¸¾ä¾‹</th></tr></thead><tbody><tr><td align="left">Check</td><td align="center">è¯Šæ–­æ£€æŸ¥é¡¹ç›®</td><td align="center">3,353</td><td align="left">æ”¯æ°”ç®¡é€ å½±;å…³èŠ‚é•œæ£€æŸ¥</td></tr><tr><td align="left">Department</td><td align="center">åŒ»ç–—ç§‘ç›®</td><td align="center">54</td><td align="left">æ•´å½¢ç¾å®¹ç§‘;çƒ§ä¼¤ç§‘</td></tr><tr><td align="left">Disease</td><td align="center">ç–¾ç—…</td><td align="center">8,807</td><td align="left">è¡€æ “é—­å¡æ€§è„‰ç®¡ç‚;èƒ¸é™ä¸»åŠ¨è„‰åŠ¨è„‰ç˜¤</td></tr><tr><td align="left">Drug</td><td align="center">è¯å“</td><td align="center">3,828</td><td align="left">äº¬ä¸‡çº¢ç—”ç–®è†;å¸ƒæ—ä½èƒºæ»´çœ¼æ¶²</td></tr><tr><td align="left">Food</td><td align="center">é£Ÿç‰©</td><td align="center">4,870</td><td align="left">ç•ªèŒ„å†²èœç‰›è‚‰ä¸¸æ±¤;ç«¹ç¬‹ç‚–ç¾Šè‚‰</td></tr><tr><td align="left">Producer</td><td align="center">åœ¨å”®è¯å“</td><td align="center">17,201</td><td align="left">é€šè¯åˆ¶è¯é’éœ‰ç´ Vé’¾ç‰‡;é’é˜³é†‹é…¸åœ°å¡ç±³æ¾ç‰‡</td></tr><tr><td align="left">Symptom</td><td align="center">ç–¾ç—…ç—‡çŠ¶</td><td align="center">5,998</td><td align="left">ä¹³è…ºç»„ç»‡è‚¥åš;è„‘å®è´¨æ·±éƒ¨å‡ºè¡€</td></tr><tr><td align="left">Total</td><td align="center">æ€»è®¡</td><td align="center">44,111</td><td align="left">çº¦4.4ä¸‡å®ä½“é‡çº§</td></tr></tbody></table><p>çŸ¥è¯†å›¾è°±å®ä½“å…³ç³»ç±»å‹</p><table><thead><tr><th align="left">å®ä½“å…³ç³»ç±»å‹</th><th align="center">ä¸­æ–‡å«ä¹‰</th><th align="center">å…³ç³»æ•°é‡</th><th align="left">ä¸¾ä¾‹</th></tr></thead><tbody><tr><td align="left">belongs_to</td><td align="center">å±äº</td><td align="center">8,844</td><td align="left">&lt;å¦‡ç§‘,å±äº,å¦‡äº§ç§‘&gt;</td></tr><tr><td align="left">common_drug</td><td align="center">ç–¾ç—…å¸¸ç”¨è¯å“</td><td align="center">14,649</td><td align="left">&lt;é˜³å¼º,å¸¸ç”¨,ç”²ç£ºé…¸é…šå¦¥æ‹‰æ˜åˆ†æ•£ç‰‡&gt;</td></tr><tr><td align="left">do_eat</td><td align="center">ç–¾ç—…å®œåƒé£Ÿç‰©</td><td align="center">22,238</td><td align="left">&lt;èƒ¸æ¤éª¨æŠ˜,å®œåƒ,é»‘é±¼&gt;</td></tr><tr><td align="left">drugs_of</td><td align="center">è¯å“åœ¨å”®è¯å“</td><td align="center">17,315</td><td align="left">&lt;é’éœ‰ç´ Vé’¾ç‰‡,åœ¨å”®,é€šè¯åˆ¶è¯é’éœ‰ç´ Vé’¾ç‰‡&gt;</td></tr><tr><td align="left">need_check</td><td align="center">ç–¾ç—…æ‰€éœ€æ£€æŸ¥</td><td align="center">39,422</td><td align="left">&lt;å•ä¾§è‚ºæ°”è‚¿,æ‰€éœ€æ£€æŸ¥,æ”¯æ°”ç®¡é€ å½±&gt;</td></tr><tr><td align="left">no_eat</td><td align="center">ç–¾ç—…å¿Œåƒé£Ÿç‰©</td><td align="center">22,247</td><td align="left">&lt;å”‡ç—…,å¿Œåƒ,æä»&gt;</td></tr><tr><td align="left">recommand_drug</td><td align="center">ç–¾ç—…æ¨èè¯å“</td><td align="center">59,467</td><td align="left">&lt;æ··åˆç—”,æ¨èç”¨è¯,äº¬ä¸‡çº¢ç—”ç–®è†&gt;</td></tr><tr><td align="left">recommand_eat</td><td align="center">ç–¾ç—…æ¨èé£Ÿè°±</td><td align="center">40,221</td><td align="left">&lt;é˜è†œç§¯æ¶²,æ¨èé£Ÿè°±,ç•ªèŒ„å†²èœç‰›è‚‰ä¸¸æ±¤&gt;</td></tr><tr><td align="left">has_symptom</td><td align="center">ç–¾ç—…ç—‡çŠ¶</td><td align="center">5,998</td><td align="left">&lt;æ—©æœŸä¹³è…ºç™Œ,ç–¾ç—…ç—‡çŠ¶,ä¹³è…ºç»„ç»‡è‚¥åš&gt;</td></tr><tr><td align="left">acompany_with</td><td align="center">ç–¾ç—…å¹¶å‘ç–¾ç—…</td><td align="center">12,029</td><td align="left">&lt;ä¸‹è‚¢äº¤é€šé™è„‰ç“£è†œå…³é—­ä¸å…¨,å¹¶å‘ç–¾ç—…,è¡€æ “é—­å¡æ€§è„‰ç®¡ç‚&gt;</td></tr><tr><td align="left">Total</td><td align="center">æ€»è®¡</td><td align="center">294,149</td><td align="left">çº¦30ä¸‡å…³ç³»é‡çº§</td></tr></tbody></table><p>çŸ¥è¯†å›¾è°±å±æ€§ç±»å‹</p><table><thead><tr><th align="left">å±æ€§ç±»å‹</th><th align="center">ä¸­æ–‡å«ä¹‰</th><th align="center">ä¸¾ä¾‹</th></tr></thead><tbody><tr><td align="left">name</td><td align="center">ç–¾ç—…åç§°</td><td align="center">å–˜æ¯æ ·æ”¯æ°”ç®¡ç‚</td></tr><tr><td align="left">desc</td><td align="center">ç–¾ç—…ç®€ä»‹</td><td align="center">åˆç§°å“®å–˜æ€§æ”¯æ°”ç®¡ç‚â€¦</td></tr><tr><td align="left">cause</td><td align="center">ç–¾ç—…ç—…å› </td><td align="center">å¸¸è§çš„æœ‰åˆèƒç—…æ¯’ç­‰â€¦</td></tr><tr><td align="left">prevent</td><td align="center">é¢„é˜²æªæ–½</td><td align="center">æ³¨æ„å®¶æ—ä¸æ‚£å„¿è‡ªèº«è¿‡æ•å²â€¦</td></tr><tr><td align="left">cure_lasttime</td><td align="center">æ²»ç–—å‘¨æœŸ</td><td align="center">6-12ä¸ªæœˆ</td></tr><tr><td align="left">cure_way</td><td align="center">æ²»ç–—æ–¹å¼</td><td align="center">â€œè¯ç‰©æ²»ç–—â€,â€æ”¯æŒæ€§æ²»ç–—â€</td></tr><tr><td align="left">cured_prob</td><td align="center">æ²»æ„ˆæ¦‚ç‡</td><td align="center">95%</td></tr><tr><td align="left">easy_get</td><td align="center">ç–¾ç—…æ˜“æ„Ÿäººç¾¤</td><td align="center">æ— ç‰¹å®šçš„äººç¾¤</td></tr></tbody></table><p>å®ä½“å…³ç³»çš„æ•°æ®åœ¨<a href="https://github.com/liuhuanyong/QASystemOnMedicalKG/tree/master/dict">https://github.com/liuhuanyong/QASystemOnMedicalKG/tree/master/dict</a></p><p>å¯ä»¥é€šè¿‡è„šæœ¬<a href="https://github.com/liuhuanyong/QASystemOnMedicalKG/blob/master/build_medicalgraph.py%E5%AF%BC%E5%85%A5neo4j(neo4j%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83https://daiyizheng.github.io/2020/05/11/neo4j/)">https://github.com/liuhuanyong/QASystemOnMedicalKG/blob/master/build_medicalgraph.pyå¯¼å…¥neo4j(neo4jçš„é…ç½®å¯ä»¥å‚è€ƒhttps://daiyizheng.github.io/2020/05/11/neo4j/)</a></p><p>æ•´ä½“æ•ˆæœ</p><p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/graph.svg"></p><h2 id="é—®ç­”ç³»ç»Ÿæ¡†æ¶"><a href="#é—®ç­”ç³»ç»Ÿæ¡†æ¶" class="headerlink" title="é—®ç­”ç³»ç»Ÿæ¡†æ¶"></a>é—®ç­”ç³»ç»Ÿæ¡†æ¶</h2><p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/13.png"></p><p>â¼€ä¸ªè¾ƒå®Œæ•´çš„é—®ç­”ç³»ç»Ÿæµç¨‹ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰æ­¥ï¼š</p><p><strong>é—®é¢˜åˆ†ææ¨¡å—</strong>ã€€</p><p>ã€€ã€€1. å®ä½“æå–<br>  ã€€ã€€2. å…³ç³»åˆ†ç±»</p><p><strong>é—®é¢˜å›ç­”æ¨¡å—</strong></p><p>ã€€æ ¹æ®å®ä½“å…³ç³»è¿›è¡Œç­”æ¡ˆæ£€ç´¢</p><h2 id="æŠ€æœ¯æ–¹æ¡ˆæµç¨‹"><a href="#æŠ€æœ¯æ–¹æ¡ˆæµç¨‹" class="headerlink" title="æŠ€æœ¯æ–¹æ¡ˆæµç¨‹"></a>æŠ€æœ¯æ–¹æ¡ˆæµç¨‹</h2><ul><li>1 è¾“å…¥é—®å¥</li><li>2 é€šè¿‡å®ä½“è¯†åˆ«æ¨¡å‹æ£€æµ‹é—®å¥ä¸­çš„å®ä½“ï¼Œå¾—åˆ°å®ä½“ï¼ˆBERT+CRFï¼‰</li><li>3 é€šè¿‡å¥å­è¯­ä¹‰è¯†åˆ«å¾—åˆ°å¥å­çš„ç±»åˆ«ï¼ˆBERTï¼‰ï¼Œå³å…³ç³»ï¼</li><li>4 é€šè¿‡å®ä½“å’Œå…³ç³»åœ¨neo4jä¸­æ£€ç´¢ç­”æ¡ˆ</li><li>5 è¾“å‡ºç­”æ¡ˆ</li></ul><h3 id="å‘½åå®ä½“è¯†åˆ«"><a href="#å‘½åå®ä½“è¯†åˆ«" class="headerlink" title="å‘½åå®ä½“è¯†åˆ«"></a>å‘½åå®ä½“è¯†åˆ«</h3><p><strong>æ¨¡å‹</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional<span class="token keyword">from</span> transformers <span class="token keyword">import</span> BertForTokenClassification<span class="token punctuation">,</span> BertTokenizer<span class="token punctuation">,</span> BertConfig<span class="token punctuation">,</span>BertModel<span class="token keyword">from</span> CRF_Model <span class="token keyword">import</span> CRF<span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> os<span class="token keyword">import</span> codeMODEL_NAME <span class="token operator">=</span> <span class="token string">"bert-base-chinese-model.bin"</span>CONFIG_NAME <span class="token operator">=</span> <span class="token string">"bert-base-chinese-config.json"</span>VOB_NAME <span class="token operator">=</span> <span class="token string">"bert-base-chinese-bert-base-chinese-vocab.txt"</span><span class="token keyword">class</span> <span class="token class-name">BertCrf</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> config_name<span class="token punctuation">:</span> str<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> str <span class="token operator">=</span> None<span class="token punctuation">,</span> num_tags<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        self<span class="token punctuation">.</span>batch_first <span class="token operator">=</span> batch_first        <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>config_name<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>                <span class="token string">"æœªæ‰¾åˆ°æ¨¡å‹é…ç½®æ–‡ä»¶ '&amp;#123;&amp;#125;'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>config_name<span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>config_name <span class="token operator">=</span> config_name        <span class="token keyword">if</span> model_name <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>                    <span class="token string">"æœªæ‰¾åˆ°æ¨¡å‹é¢„è®­ç»ƒå‚æ•°æ–‡ä»¶ '&amp;#123;&amp;#125;'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>                <span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> model_name        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> None        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bert_config <span class="token operator">=</span> BertConfig<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>self<span class="token punctuation">.</span>config_name<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_layers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> input_size<span class="token operator">=</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [batch_size, seq_len. num_directions * hidden_size]</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> num_tags<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bert_config<span class="token punctuation">.</span>num_labels <span class="token operator">=</span> num_tags        self<span class="token punctuation">.</span>model_kwargs <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'config': self.bert_config&amp;#125;</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>model_name <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>bertModel <span class="token operator">=</span> BertModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_name<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>model_kwargs<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>bertModel <span class="token operator">=</span> BertModel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bert_config<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>crf_model <span class="token operator">=</span> CRF<span class="token punctuation">(</span>num_tags<span class="token operator">=</span>num_tags<span class="token punctuation">,</span> batch_first<span class="token operator">=</span>batch_first<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                tags<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor <span class="token operator">=</span> None<span class="token punctuation">,</span>                attention_mask<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>                token_type_ids<span class="token operator">=</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                decode<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>                reduction<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"mean"</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">:</span>        emissions <span class="token operator">=</span> self<span class="token punctuation">.</span>bertModel<span class="token punctuation">(</span>input_ids<span class="token operator">=</span>input_ids<span class="token punctuation">,</span> attention_mask<span class="token operator">=</span>attention_mask<span class="token punctuation">,</span> token_type_ids<span class="token operator">=</span>token_type_ids<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        emissions<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>lstm<span class="token punctuation">(</span>emissions<span class="token punctuation">)</span>        emissions <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>emissions<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># è¿™é‡Œåœ¨seq_lençš„ç»´åº¦ä¸Šå»å¤´ï¼Œæ˜¯å»æ‰äº†[CLS]ï¼Œå»å°¾å·´æœ‰ä¸¤ç§æƒ…å†µ</span>        <span class="token comment" spellcheck="true"># 1ã€æ˜¯ &lt;pad> 2ã€[SEP]</span>        new_emissions <span class="token operator">=</span> emissions<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## [batch_size, seq_len-2, num_labels] å»æ‰cls å’Œ sep</span>        new_mask <span class="token operator">=</span> attention_mask<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## [batch_size, seq_len-2] å»æ‰cls å’Œ sep</span>        <span class="token keyword">if</span> tags <span class="token keyword">is</span> None<span class="token punctuation">:</span>            loss <span class="token operator">=</span> None            <span class="token keyword">pass</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            new_tags <span class="token operator">=</span> tags<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#</span>            loss <span class="token operator">=</span> self<span class="token punctuation">.</span>crf_model<span class="token punctuation">(</span>emissions<span class="token operator">=</span>new_emissions<span class="token punctuation">,</span> tags<span class="token operator">=</span>new_tags<span class="token punctuation">,</span> mask<span class="token operator">=</span>new_mask<span class="token punctuation">,</span> reduction<span class="token operator">=</span>reduction<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [1]</span>        <span class="token keyword">if</span> decode<span class="token punctuation">:</span>            tag_list <span class="token operator">=</span> self<span class="token punctuation">.</span>crf_model<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>emissions<span class="token operator">=</span>new_emissions<span class="token punctuation">,</span> mask<span class="token operator">=</span>new_mask<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>loss<span class="token punctuation">,</span> tag_list<span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>loss<span class="token punctuation">]</span>    <span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional<span class="token keyword">import</span> torch<span class="token keyword">import</span> code<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">class</span> <span class="token class-name">CRF</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_tags<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># if num_tags &lt;= 0:</span>        <span class="token comment" spellcheck="true">#     raise ValueError(f'invalid number of tags: &amp;#123;num_tags&amp;#125;')</span>        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_tags <span class="token operator">=</span> num_tags  <span class="token comment" spellcheck="true"># 3</span>        self<span class="token punctuation">.</span>batch_first <span class="token operator">=</span> batch_first  <span class="token comment" spellcheck="true"># true</span>        <span class="token comment" spellcheck="true"># start åˆ°å…¶ä»–tag(ä¸åŒ…å«end)çš„å¾—åˆ†</span>        self<span class="token punctuation">.</span>start_transitions <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>            torch<span class="token punctuation">.</span>empty<span class="token punctuation">(</span>num_tags<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># tensor([-0.0025, -0.0600, -0.0841], requires_grad=True)</span>        <span class="token comment" spellcheck="true"># åˆ°å…¶ä»–tag(ä¸åŒ…å«start)åˆ°endçš„å¾—åˆ†</span>        self<span class="token punctuation">.</span>end_transitions <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>            torch<span class="token punctuation">.</span>empty<span class="token punctuation">(</span>num_tags<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># tensor([-0.0673,  0.0638, -0.0416], requires_grad=True)</span>        <span class="token comment" spellcheck="true"># ä» _compute_normalizer ä¸­ next_score = broadcast_score + self.transitions + broadcast_emissions å¯ä»¥çœ‹å‡º</span>        <span class="token comment" spellcheck="true"># transitions[i][j] è¡¨ç¤ºä»ç¬¬iä¸ªtag åˆ°ç¬¬jä¸ª tagçš„åˆ†æ•°</span>        self<span class="token punctuation">.</span>transitions <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>empty<span class="token punctuation">(</span>num_tags<span class="token punctuation">,</span> num_tags<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [3,3] tensor([[1,1,1],[1,1,1],[1,1,1]])</span>        self<span class="token punctuation">.</span>reset_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#</span>    <span class="token keyword">def</span> <span class="token function">reset_parameters</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        init_range <span class="token operator">=</span> <span class="token number">0.1</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_transitions<span class="token punctuation">,</span> <span class="token operator">-</span>init_range<span class="token punctuation">,</span> init_range<span class="token punctuation">)</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>end_transitions<span class="token punctuation">,</span> <span class="token operator">-</span>init_range<span class="token punctuation">,</span> init_range<span class="token punctuation">)</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span>self<span class="token punctuation">.</span>transitions<span class="token punctuation">,</span> <span class="token operator">-</span>init_range<span class="token punctuation">,</span> init_range<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                tags<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor <span class="token operator">=</span> None<span class="token punctuation">,</span>                mask<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>                reduction<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"mean"</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># emissions.shape = [12,62,3]=[batchsize, seq_len-2, num_tag]</span>        mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [12,62]</span>        self<span class="token punctuation">.</span>_validate<span class="token punctuation">(</span>emissions<span class="token punctuation">,</span> tags<span class="token operator">=</span>tags<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>        reduction <span class="token operator">=</span> reduction<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> mask <span class="token keyword">is</span> None<span class="token punctuation">:</span>            mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>tags<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>batch_first<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># emissions.shape (seq_len,batch_size,tag_num)</span>            emissions <span class="token operator">=</span> emissions<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [62,12,3]</span>            tags <span class="token operator">=</span> tags<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [62,12]</span>            mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [62,12]</span>        <span class="token triple-quoted-string string">"""        CRFæŸå¤±å‡½æ•°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒçœŸå®è·¯å¾„çš„åˆ†æ•° å’Œ æ‰€æœ‰è·¯å¾„çš„æ€»åˆ†æ•°ã€‚çœŸå®è·¯å¾„çš„åˆ†æ•°åº”è¯¥æ˜¯æ‰€æœ‰è·¯å¾„ä¸­åˆ†æ•°æœ€é«˜çš„ã€‚        è¿™äº›åˆ†æ•°æ¥è‡ªäºCRFå±‚ï¼Œå°†è¿™ä¸¤ç±»åˆ†æ•°åŠ å’Œå³å¯å¾—åˆ°Si å’Œ è·¯å¾„åˆ†æ•°eSi        """</span>        <span class="token comment" spellcheck="true"># numerator shape: (batch_size,) [12]</span>        numerator <span class="token operator">=</span> self<span class="token punctuation">.</span>_computer_score<span class="token punctuation">(</span>emissions<span class="token operator">=</span>emissions<span class="token punctuation">,</span> tags<span class="token operator">=</span>tags<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># è®¡ç®—s(X,y)</span>        <span class="token comment" spellcheck="true"># shape: (batch_size,) [12]</span>        denominator <span class="token operator">=</span> self<span class="token punctuation">.</span>_compute_normalizer<span class="token punctuation">(</span>emissions<span class="token operator">=</span>emissions<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># è®¡ç®— log(Î£e^(x,y'))</span>        <span class="token comment" spellcheck="true"># loss function</span>        <span class="token comment" spellcheck="true"># log(Î£e^(S(X,y))) - S(Xï¼Œy)</span>        llh <span class="token operator">=</span> denominator <span class="token operator">-</span> numerator  <span class="token comment" spellcheck="true"># [batch_size]12</span>        <span class="token keyword">if</span> reduction <span class="token operator">==</span> <span class="token string">'none'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> llh        <span class="token keyword">elif</span> reduction <span class="token operator">==</span> <span class="token string">'sum'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> llh<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> reduction <span class="token operator">==</span> <span class="token string">'mean'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> llh<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">assert</span> reduction <span class="token operator">==</span> <span class="token string">'token_mean'</span>        <span class="token keyword">return</span> llh<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> mask<span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>               mask<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_validate<span class="token punctuation">(</span>emissions<span class="token operator">=</span>emissions<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>        <span class="token keyword">if</span> mask <span class="token keyword">is</span> None<span class="token punctuation">:</span>            mask <span class="token operator">=</span> emissions<span class="token punctuation">.</span>new_ones<span class="token punctuation">(</span>emissions<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>batch_first<span class="token punctuation">:</span>            emissions <span class="token operator">=</span> emissions<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [62,12,3]</span>            mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [62,12]</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_viterbi_decode<span class="token punctuation">(</span>emissions<span class="token punctuation">,</span> mask<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># åˆ¤æ–­æœ‰æ•ˆæ€§</span>    <span class="token keyword">def</span> <span class="token function">_validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>                  emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                  tags<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">,</span>                  mask<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span>torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>        <span class="token keyword">if</span> tags <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>            no_empty_seq <span class="token operator">=</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>batch_first <span class="token operator">and</span> mask<span class="token punctuation">[</span>                <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># false tensor.all()åŠŸèƒ½: å¦‚æœå¼ é‡tensorä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯True, æ‰è¿”å›True; å¦åˆ™è¿”å›False tensor.any()åŠŸèƒ½: å¦‚æœå¼ é‡tensorä¸­å­˜åœ¨ä¸€ä¸ªå…ƒç´ ä¸ºTrue, é‚£ä¹ˆè¿”å›True; åªæœ‰æ‰€æœ‰å…ƒç´ éƒ½æ˜¯Falseæ—¶æ‰è¿”å›False</span>            no_empty_seq_bf <span class="token operator">=</span> self<span class="token punctuation">.</span>batch_first <span class="token operator">and</span> mask<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># è®¡ç®—å…¬å¼s(X,y)</span>    <span class="token keyword">def</span> <span class="token function">_computer_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>                        emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>                        tags<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">,</span>                        mask<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># batch second</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">and</span> tags<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> tags<span class="token punctuation">.</span>shape        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>num_tags        <span class="token keyword">assert</span> mask<span class="token punctuation">.</span>shape <span class="token operator">==</span> tags<span class="token punctuation">.</span>shape        <span class="token keyword">assert</span> mask<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        tags<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 62        12</span>        seq_length<span class="token punctuation">,</span> batch_size <span class="token operator">=</span> tags<span class="token punctuation">.</span>shape        mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>float<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.start_transitions  start åˆ°å…¶ä»–tag(ä¸åŒ…å«end)çš„å¾—åˆ†</span>        score <span class="token operator">=</span> self<span class="token punctuation">.</span>start_transitions<span class="token punctuation">[</span>tags<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># tag[0].shape = [62] æ¯ä¸€å¥çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œstartåˆ°å…¶å®ƒtagçš„å¾—åˆ†ï¼Œéšæœºç»™ä¸€ä¸ªå€¼</span>        <span class="token comment" spellcheck="true"># code.interact(local = locals())</span>        score <span class="token operator">+=</span> emissions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># è®¡ç®—æ‰€æœ‰å¥å­ä¸­ç¬¬ä¸€ä¸ªå•è¯çš„å‘å°„çš„å¾—åˆ†</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_length<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># [1,2,...,seq_length-1]</span>            <span class="token comment" spellcheck="true"># if mask[i].sum() == 0:</span>            <span class="token comment" spellcheck="true">#     break</span>            <span class="token comment" spellcheck="true"># transitions[i][j] è¡¨ç¤ºä»ç¬¬iä¸ªtag åˆ°ç¬¬jä¸ªtagçš„åˆ†æ•°</span>            score <span class="token operator">+=</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>tags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> mask<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># Aij</span>            score <span class="token operator">+=</span> emissions<span class="token punctuation">[</span>i<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> mask<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># P&amp;#123;i,y_j&amp;#125;</span>        <span class="token comment" spellcheck="true"># è¿™é‡Œæ˜¯ä¸ºäº†è·å–æ¯ä¸€ä¸ªæ ·æœ¬æœ€åä¸€ä¸ªè¯çš„tagã€‚</span>        <span class="token comment" spellcheck="true"># shape: (batch_size,)   æ¯ä¸€ä¸ªbatch çš„çœŸå®é•¿åº¦</span>        <span class="token comment" spellcheck="true"># .long å˜æˆæ•´å‹ .sum(dim=0) è®¡ç®—æ¯ä¸ªå¥å­ä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªå­—</span>        seq_ends <span class="token operator">=</span> mask<span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># æ¯ä¸ªæ ·æœ¬æœ€åä¸€ä¸ªè¯çš„tag</span>        last_tags <span class="token operator">=</span> tags<span class="token punctuation">[</span>seq_ends<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># shape: (batch_size,) æ¯ä¸€ä¸ªæ ·æœ¬åˆ°æœ€åä¸€ä¸ªè¯çš„å¾—åˆ†åŠ ä¸Šä¹‹å‰çš„score</span>        score <span class="token operator">+=</span> self<span class="token punctuation">.</span>end_transitions<span class="token punctuation">[</span>last_tags<span class="token punctuation">]</span>        <span class="token keyword">return</span> score    <span class="token comment" spellcheck="true"># è®¡ç®— log(Î£e^(S(X,y)))</span>    <span class="token keyword">def</span> <span class="token function">_compute_normalizer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> mask<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># emissions: (seq_length, batch_size, num_tags) [62,32,3]</span>        <span class="token comment" spellcheck="true"># mask: (seq_length, batch_size)</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">and</span> mask<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> mask<span class="token punctuation">.</span>shape        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>num_tags        <span class="token keyword">assert</span> mask<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        mask <span class="token operator">=</span> mask<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>        seq_length <span class="token operator">=</span> emissions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        score <span class="token operator">=</span> self<span class="token punctuation">.</span>start_transitions <span class="token operator">+</span> emissions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># [3] + [12,3]  æ¯ä¸ªå¥å­çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œå¯¹åº”çš„3ä¸­ä¸åŒtagçš„å¾—åˆ†</span>        <span class="token comment" spellcheck="true"># code.interact(local = locals())</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_length<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># shape : (batch_size,num_tag,1) [12,3,1]</span>            <span class="token comment" spellcheck="true"># &lt;start> -> åˆ«çš„tagçš„å¾—åˆ†</span>            broadcast_score <span class="token operator">=</span> score<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># åˆå§‹åŒ–å¾—åˆ†</span>            <span class="token comment" spellcheck="true"># shape: (batch_size,1,num_tags)</span>            <span class="token comment" spellcheck="true"># æ¯ä¸ªå¥å­çš„ç¬¬iä¸ªå•è¯çš„å‘å°„åˆ†æ•° [12,1,3]</span>            broadcast_emissions <span class="token operator">=</span> emissions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># å¹¿æ’­å¾—åˆ† + transitions[i][j] è¡¨ç¤ºä»ç¬¬jä¸ªtag åˆ°ç¬¬ i ä¸ª tagçš„åˆ†æ•°+ æ¯å¥ç¬¬iä¸ªå•è¯çš„å‘å°„å¾—åˆ†  [12,3,3]</span>            next_score <span class="token operator">=</span> broadcast_score <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions <span class="token operator">+</span> broadcast_emissions            next_score <span class="token operator">=</span> torch<span class="token punctuation">.</span>logsumexp<span class="token punctuation">(</span>next_score<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [12,3]</span>            <span class="token comment" spellcheck="true"># ä¾æ¬¡å–å‡ºæ¯å¥è¯çš„iä¸ªå•è¯çš„mask, æœ‰çš„è¯ï¼Œæœ‰å¾—åˆ†ï¼Œæ²¡æœ‰çš„è¯ï¼Œå°±åŸæ¥çš„å€¼ [12,3]</span>            score <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>mask<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next_score<span class="token punctuation">,</span> score<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># shape (batch_size,num_tags)</span>        <span class="token comment" spellcheck="true"># åˆ°å…¶ä»–tag(ä¸åŒ…å«start)åˆ°endçš„å¾—åˆ†</span>        score <span class="token operator">+=</span> self<span class="token punctuation">.</span>end_transitions        <span class="token comment" spellcheck="true"># shape: (batch_size)</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>logsumexp<span class="token punctuation">(</span>score<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_viterbi_decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> emissions<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">,</span>                        mask<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>ByteTensor<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># emissions: (seq_length, batch_size, num_tags)</span>        <span class="token comment" spellcheck="true"># mask: (seq_length, batch_size)</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">and</span> mask<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> mask<span class="token punctuation">.</span>shape        <span class="token keyword">assert</span> emissions<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>num_tags        mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">assert</span> mask<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>        seq_length<span class="token punctuation">,</span> batch_size <span class="token operator">=</span> mask<span class="token punctuation">.</span>shape        <span class="token comment" spellcheck="true"># self.start_transitions  start åˆ°å…¶ä»–tag(ä¸åŒ…å«end)çš„å¾—åˆ†</span>        <span class="token comment" spellcheck="true"># &lt;start>->å…¶ä»–tagçš„å‘å°„å¾—åˆ† + æ¯å¥è¯çš„ç¬¬ä¸€ä¸ªå­—çš„tagçš„å‘å°„å¾—åˆ†</span>        <span class="token comment" spellcheck="true"># emissions.shape = [62,12,3]  start_transitions.shape = [3]</span>        score <span class="token operator">=</span> self<span class="token punctuation">.</span>start_transitions <span class="token operator">+</span> emissions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># å¹¿æ’­</span>        history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_length<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># score.shape = [32,3] -> [32,3,1]</span>            <span class="token comment" spellcheck="true"># èµ·å§‹å¾—åˆ†ï¼Œå‘å°„å¾—åˆ†, æ‰©å±•ç»´åº¦ï¼Œå…¬å¼ä¸­çš„expand previous</span>            broadcast_score <span class="token operator">=</span> score<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># emissions.shape = [62,32,3] ç„¶åemissions[i]æ˜¯æ¯å¥è¯ä¸­çš„ç¬¬iä¸ªå•è¯çš„å‘å°„å¾—åˆ†</span>            <span class="token comment" spellcheck="true"># emissions[i].shape = [32,3].unsqueeze(1) = [32,1,3]</span>            broadcast_emission <span class="token operator">=</span> emissions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># æ‰©å±•ç»´åº¦</span>            <span class="token comment" spellcheck="true">#            åˆå§‹å¾—åˆ†         + å‘å°„å¾—åˆ†         + ä¹‹å‰å¾—åˆ†+ç°åœ¨å¾—åˆ†</span>            <span class="token comment" spellcheck="true"># [32,3,3]=  [32,3,1]        + [3,3,3]          + [32,1,3]</span>            <span class="token comment" spellcheck="true">#            åˆå§‹å¾—åˆ†           å…¬å¼ä¸­çš„tï¼Œè½¬ç§»å¾—åˆ†  å‘å°„å¾—åˆ†ï¼Œå•è¯wi->tagjçš„å‘å°„æ¦‚ç‡</span>            next_score <span class="token operator">=</span> broadcast_score <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions <span class="token operator">+</span> broadcast_emission            <span class="token comment" spellcheck="true"># æ¯å¥è¯ä¸­æ¯ä¸ªå•è¯å¯¹åº”çš„tagçš„å¾—åˆ†æœ€å¤§å€¼ï¼Œtag[i]->tag[j]æœ€å¤§å¾—åˆ†</span>            <span class="token comment" spellcheck="true"># next_score.shape = [32,3] =indices.shape</span>            <span class="token comment" spellcheck="true"># è¿™ä¸ªæ—¶åˆ»ä¸­çš„æœ€å¤§å€¼è¢«ä¿ç•™ä¸‹æ¥</span>            next_score<span class="token punctuation">,</span> indices <span class="token operator">=</span> next_score<span class="token punctuation">.</span>max<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># ä¸è®¡ç®—paddingéƒ¨åˆ†çš„å¾—åˆ†</span>            score <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>mask<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next_score<span class="token punctuation">,</span> score<span class="token punctuation">)</span>            history<span class="token punctuation">.</span>append<span class="token punctuation">(</span>indices<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># éå†å®Œä¸€å¥è¯ï¼Œè¿˜å¾—åŠ ä¸Šæœ€å &lt;end> tag  [32,3]</span>        score <span class="token operator">+=</span> self<span class="token punctuation">.</span>end_transitions        <span class="token comment" spellcheck="true"># è®¡ç®—åˆ°æœ€åä¸€ä¸ªå•è¯çš„ä¸‹æ ‡</span>        seq_ends <span class="token operator">=</span> mask<span class="token punctuation">.</span>long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment" spellcheck="true"># [32]</span>        best_tags_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        jj <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> idx <span class="token keyword">in</span> range<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 32</span>            <span class="token comment" spellcheck="true"># score.shape = [32,3] æ¯å¥è¯ä¸­æ‰¾æœ€å¥½çš„tag</span>            _<span class="token punctuation">,</span> best_last_tag <span class="token operator">=</span> score<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ç„¶åæ‰¾æœ€å¥½çš„tag</span>            best_tags <span class="token operator">=</span> <span class="token punctuation">[</span>best_last_tag<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true"># history[:seq_ends[idx]].shape  (seq_ends[idx])</span>            <span class="token comment" spellcheck="true"># history çš„é•¿åº¦æ˜¯ä¸€ä¸ªå¥å­çš„é•¿åº¦ 61</span>            <span class="token comment" spellcheck="true"># history[i].shape = [32,3]</span>            <span class="token comment" spellcheck="true"># history[:seq_ends[idx] å–å¥å­é•¿åº¦ï¼Œseq_endsä¹‹åæ˜¯paddingéƒ¨åˆ†</span>            <span class="token comment" spellcheck="true"># reversed(history[:seq_ends[idx]]) å°†å¥å­åè¿‡æ¥</span>            <span class="token comment" spellcheck="true"># histç¬¬ä¸€ä¸ªå–åˆ°çš„æ˜¯æœ€åä¸€ä¸ªå­—</span>            <span class="token keyword">for</span> hist <span class="token keyword">in</span> reversed<span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token punctuation">:</span>seq_ends<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># ç”»å›¾</span>                <span class="token comment" spellcheck="true"># hist.shape = [32,3]</span>                <span class="token comment" spellcheck="true"># code.interact(local = locals())</span>                best_last_tag <span class="token operator">=</span> hist<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">[</span>best_tags<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                best_tags<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_last_tag<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            best_tags<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>            best_tags_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_tags<span class="token punctuation">)</span>        <span class="token keyword">return</span> best_tags_list</code></pre><p><strong>è®­ç»ƒå‚æ•°</strong></p><pre class=" language-shell"><code class="language-shell">  --data_dir  ./corpus/ner_data  --vob_file /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/vocab.txt  --model_config /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/config.json  --output ./output  --max_seq_length 41  --do_train  --train_batch_size 32  --eval_batch_size 32  --gradient_accumulation_steps 1  --num_train_epochs 15  --pre_train_model  /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/pytorch_model.bin</code></pre><p><strong>æ•´ä½“è®­ç»ƒç»“æœ</strong></p><pre class=" language-shell"><code class="language-shell">  O precision = 0.999725 recall = 0.999983  f1 = 0.999854 support = 181571  E-dis precision = 0.995097 recall = 0.995396  f1 = 0.995247 support = 19983  B-sym precision = 0.988231 recall = 0.985985  f1 = 0.987107 support = 7920  B-che precision = 0.996992 recall = 0.995495  f1 = 0.996243 support = 1998  E-dru precision = 0.994522 recall = 0.998500  f1 = 0.996507 support = 2000  I-che precision = 0.998802 recall = 0.997699  f1 = 0.998250 support = 10864  E-che precision = 0.998494 recall = 0.995495  f1 = 0.996992 support = 1998  E-sym precision = 0.985266 recall = 0.987879  f1 = 0.986571 support = 7920  I-dis precision = 0.994998 recall = 0.998148  f1 = 0.996571 support = 89089  S precision = 0.000000 recall = 0.000000  f1 = 0.000000 support = 22  I-sym precision = 0.993844 recall = 0.980469  f1 = 0.987111 support = 26675  B-dis precision = 0.994605 recall = 0.996347  f1 = 0.995475 support = 19983  I-dru precision = 0.996810 recall = 0.998462  f1 = 0.997635 support = 8451  B-dru precision = 0.994519 recall = 0.998000  f1 = 0.996257 support = 2000  attention AVG:precision = 0.994377 recall = 0.994253  f1 = 0.994308   all AVG:precision = 0.923708 recall = 0.923418  f1 = 0.923559 </code></pre><p>å¯¹äºåŠ æƒåçš„f1-scoreè¾¾åˆ°äº†0.99ä»¥ä¸Šï¼ŒåŸºæœ¬è¯†åˆ«å‡ºæ¥äº†ï¼Œå¯¹äºå•ä½“Sæ ‡æ³¨f1ä¸ºï¼ï¼Œå¯èƒ½åŸå› æ•°é‡å¤ªå°‘(22),æœªèƒ½è¯†åˆ«å‡ºæ¥</p><h3 id="æ„å›¾åˆ†ç±»"><a href="#æ„å›¾åˆ†ç±»" class="headerlink" title="æ„å›¾åˆ†ç±»"></a>æ„å›¾åˆ†ç±»</h3><p><strong>æ¨¡å‹</strong></p><p>é‡‡ç”¨haggingfaceè‡ªå¸¦çš„BertForSequenceClassificationï¼Œä¸€ä¸ªå¤šåˆ†ç±»æ¨¡å‹ï¼Œæ•°æ®æ ¼å¼ä¸Šé¢å·²ç»ä»‹ç»äº†ï¼Œ</p><p><strong>å‚æ•°</strong></p><pre class=" language-shell"><code class="language-shell">  --data_dir  ./corpus/classify_data  --vob_file /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/vocab.txt  --model_config /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/config.json  --output ./output  --max_seq_length 60  --do_train  --train_batch_size 32  --eval_batch_size 32  --gradient_accumulation_steps 1  --num_train_epochs 15  --pre_train_model  /media/daiyizheng/SSD/bert-pretrainmodel/roberta/chinese_roberta_wwm_ext_pytorch/pytorch_model.bin</code></pre><p><strong>æ•´ä½“ç»“æœ</strong></p><p>å¿˜äº†æˆªå›¾ï¼šæ•´ä½“åˆ†ç±»å‡†ç¡®ç‡å¤§æ¦‚æ˜¯0.72ç›¸å¯¹æ¯”è¾ƒä½</p><p>ä¾‹å¦‚ï¼š</p><pre class=" language-latex"><code class="language-latex">0    æœ‰ä»€ä¹ˆç”¨ï¼Œè‹å­œé˜¿ç”«ç‰‡drug    41    çœ¶å†…æµ·ç»µçŠ¶è¡€ç®¡ç˜¤diseaseæœ‰å•¥è¡¨ç°    02    æ€ä¹ˆæ‰å¯ä»¥é¢„é˜²ç»“è‚ è¡€ç®¡æ‰©å¼ ç—‡disease    63    æœ‰å•¥è¡¨ç°ï¼Œé›…å¸ç—…disease    0</code></pre><p>å¤§è‡´åŸå› ï¼š</p><p>ã€€ã€€ã€€ã€€ï¼‘ï¼è®­ç»ƒæ•°æ®æ¥æºäºè‡ªåˆ¶çš„é—®å¥ç”Ÿæˆå™¨ï¼Œè´¨é‡ä¸å¤Ÿé«˜</p><p>ã€€ã€€ã€€ã€€ï¼’ï¼å®ä½“ååŠ äº†å®ä½“çš„ç±»åˆ«ï¼Œå¯èƒ½åœ¨è¯­ä¹‰ä¸Šæœ‰å½±å“</p><h3 id="æ¨¡å‹éƒ¨ç½²"><a href="#æ¨¡å‹éƒ¨ç½²" class="headerlink" title="æ¨¡å‹éƒ¨ç½²"></a>æ¨¡å‹éƒ¨ç½²</h3><p>ã€€ã€€å‰æœŸä½¿ç”¨äº†flaskæ¡†æ¶æ¥åŠ è½½æ¨¡å‹ï¼Œå‘ç°å¯¹åç«¯çš„æ€§èƒ½å½±å“å¾ˆå¤§ï¼Œåç»­é‡‡ç”¨äº†torchserveæ¥éƒ¨ç½²ï¼Œå‡å°‘æ¨¡å‹å¯¹åç«¯çš„ä¾èµ–ï¼Œå¯¹é¡¹ç›®çš„å¯å¤ç”¨æ€§æœ‰å¾ˆå¤§çš„å¸®åŠ©</p><p>torchserveçš„åŠŸèƒ½å‚è€ƒ<a href="https://daiyizheng.github.io/2020/09/17/torchserve-bu-shu-zhu-yi-shi-xiang/">https://daiyizheng.github.io/2020/09/17/torchserve-bu-shu-zhu-yi-shi-xiang/</a></p><p><strong>å‘½åå®ä½“éƒ¨ç½²</strong></p><p>æ–‡ä»¶</p><pre class=" language-text"><code class="language-text">â”œâ”€â”€ best_ner.binã€€#è‡ªå·±è®­ç»ƒæœ€å¥½çš„æ¨¡å‹â”œâ”€â”€ chatbotBERT.marã€€#æ‰“åŒ…çš„æ–‡ä»¶â”œâ”€â”€ chatbot_medical_qa_ner_handler.pyã€€#å‡½æ•°å…¥å£ä»¥åŠæ¨¡å‹åŠ è½½å‡½æ•°â”œâ”€â”€ config.jsonã€€#é¢„è®­ç»ƒé…ç½®â”œâ”€â”€ config.propertiesã€€#torchserveé…ç½®æ–‡ä»¶â”œâ”€â”€ online_test.pyã€€#æ¥å£æµ‹è¯•â”œâ”€â”€ pytorch_model.bin #é¢„è®­ç»ƒæ¨¡å‹â”œâ”€â”€ vocab.txtã€€#é¢„è®­ç»ƒè¯åº“</code></pre><p>handlerä»£ç </p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TransformerClassifierHandler</span><span class="token punctuation">(</span>BaseHandler<span class="token punctuation">,</span> ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>TransformerClassifierHandler<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'__init__ the handler'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># åˆå§‹åŒ–handler, è¯»å…¥æ¨¡å‹</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Initializating the handler'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>manifest <span class="token operator">=</span> ctx<span class="token punctuation">.</span>manifest        self<span class="token punctuation">.</span>max_length <span class="token operator">=</span> <span class="token number">41</span>        properties <span class="token operator">=</span> ctx<span class="token punctuation">.</span>system_properties        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>str<span class="token punctuation">(</span>properties<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        model_dir <span class="token operator">=</span> properties<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"model_dir"</span><span class="token punctuation">)</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Loading model from &amp;#123;0&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>model_dir<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>tokenizer <span class="token operator">=</span> BertTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>model_dir<span class="token punctuation">,</span> <span class="token string">"vocab.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.device = torch.device("cuda:" + str(properties.get("gpu_id")) if torch.cuda.is_available() else "cpu")</span>        self<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># wæˆ‘è¿™è¾¹äº‘æœåŠ¡å™¨æ²¡æœ‰GPU</span>        self<span class="token punctuation">.</span>labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'E-dis'</span><span class="token punctuation">,</span> <span class="token string">'B-sym'</span><span class="token punctuation">,</span> <span class="token string">'B-che'</span><span class="token punctuation">,</span> <span class="token string">'E-dru'</span><span class="token punctuation">,</span> <span class="token string">'I-che'</span><span class="token punctuation">,</span> <span class="token string">'E-che'</span><span class="token punctuation">,</span> <span class="token string">'E-sym'</span><span class="token punctuation">,</span> <span class="token string">'I-dis'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'I-sym'</span><span class="token punctuation">,</span> <span class="token string">'B-dis'</span><span class="token punctuation">,</span> <span class="token string">'I-dru'</span><span class="token punctuation">,</span> <span class="token string">'B-dru'</span><span class="token punctuation">]</span>        model <span class="token operator">=</span> BertCrf<span class="token punctuation">(</span>config_name<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>model_dir<span class="token punctuation">,</span><span class="token string">'config.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> num_tags<span class="token operator">=</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>labels<span class="token punctuation">)</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>model_dir<span class="token punctuation">,</span><span class="token string">'best_ner.bin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Transformer model from path &amp;#123;0&amp;#125; loaded successfully'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>model_dir<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Preprocessing in the handler'</span><span class="token punctuation">)</span>        lines <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        dataset <span class="token operator">=</span> self<span class="token punctuation">.</span>input_dataset<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>lines<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">inference</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>        lines<span class="token punctuation">,</span> dataset <span class="token operator">=</span> inputs        sampler <span class="token operator">=</span> SequentialSampler<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>        dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> sampler<span class="token operator">=</span>sampler<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">)</span>        pred_list <span class="token operator">=</span> self<span class="token punctuation">.</span>ner_predict<span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span>        <span class="token keyword">return</span> pred_list    <span class="token keyword">def</span> <span class="token function">ner_predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataloader<span class="token punctuation">)</span><span class="token punctuation">:</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Preprocessing in the model prediction'</span><span class="token punctuation">)</span>        pred_token_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> batch <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>dataloader<span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">"predict"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>            batch <span class="token operator">=</span> tuple<span class="token punctuation">(</span>t<span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> batch<span class="token punctuation">)</span>            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                inputs <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'input_ids': batch[0],</span>                          <span class="token string">'attention_mask'</span><span class="token punctuation">:</span> batch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token string">'token_type_ids'</span><span class="token punctuation">:</span> batch<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token string">'decode'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>                          <span class="token string">'reduction'</span><span class="token punctuation">:</span> <span class="token string">'none'</span>                          <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>                outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>                pred_token_label <span class="token operator">=</span> pred_token_label <span class="token operator">+</span> outputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> pred_token_label    <span class="token keyword">def</span> <span class="token function">input_dataset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> lines<span class="token punctuation">)</span><span class="token punctuation">:</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'input_dataset in the handler'</span><span class="token punctuation">)</span>        all_input_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        all_attention_mask <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        all_token_type_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> text <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            inputs <span class="token operator">=</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">.</span>encode_plus<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>list<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> add_special_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span>self<span class="token punctuation">.</span>max_length<span class="token punctuation">,</span> truncation_strategy<span class="token operator">=</span><span class="token string">'longest_first'</span><span class="token punctuation">,</span> truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>            input_ids<span class="token punctuation">,</span> token_type_ids <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inputs<span class="token punctuation">[</span><span class="token string">"token_type_ids"</span><span class="token punctuation">]</span>            attention_mask <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> len<span class="token punctuation">(</span>input_ids<span class="token punctuation">)</span>            padding_length <span class="token operator">=</span> self<span class="token punctuation">.</span>max_length <span class="token operator">-</span> len<span class="token punctuation">(</span>input_ids<span class="token punctuation">)</span>            input_ids <span class="token operator">=</span> input_ids <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> padding_length<span class="token punctuation">)</span>            attention_mask <span class="token operator">=</span> attention_mask <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> padding_length<span class="token punctuation">)</span>            token_type_ids <span class="token operator">=</span> token_type_ids <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> padding_length<span class="token punctuation">)</span>            <span class="token keyword">assert</span> len<span class="token punctuation">(</span>input_ids<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">,</span> <span class="token string">"Error with input length &amp;#123;&amp;#125; vs &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>input_ids<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">)</span>            <span class="token keyword">assert</span> len<span class="token punctuation">(</span>attention_mask<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">,</span> <span class="token string">"Error with input length &amp;#123;&amp;#125; vs &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>attention_mask<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">)</span>            <span class="token keyword">assert</span> len<span class="token punctuation">(</span>token_type_ids<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">,</span> <span class="token string">"Error with input length &amp;#123;&amp;#125; vs &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>token_type_ids<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_length<span class="token punctuation">)</span>            all_input_ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span>input_ids<span class="token punctuation">)</span>            all_attention_mask<span class="token punctuation">.</span>append<span class="token punctuation">(</span>attention_mask<span class="token punctuation">)</span>            all_token_type_ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span>token_type_ids<span class="token punctuation">)</span>        all_input_ids <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>all_input_ids<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>        all_attention_mask <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>all_attention_mask<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>        all_token_type_ids <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>all_token_type_ids<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>        dataset <span class="token operator">=</span> TensorDataset<span class="token punctuation">(</span>all_input_ids<span class="token punctuation">,</span> all_attention_mask<span class="token punctuation">,</span> all_token_type_ids<span class="token punctuation">)</span>        <span class="token keyword">return</span> dataset    <span class="token keyword">def</span> <span class="token function">postprocess</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inference_output<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># TODO: Add any needed post-processing of the model predictions here</span>        logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'Preprocessing in the postprocess'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>labels<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">for</span> idx <span class="token keyword">in</span> idx_list<span class="token punctuation">]</span> <span class="token keyword">for</span> idx_list <span class="token keyword">in</span> inference_output<span class="token punctuation">]</span></code></pre><p>è„šæœ¬</p><pre class=" language-shell"><code class="language-shell">#æ‰“åŒ…torch-model-archiver \    --model-name chatbotBERT \    --version 1.0 --serialized-file ./pytorch_model.bin \    --extra-files "./config.json,./best_ner.bin,./config.json,./vocab.txt" \    --handler "chatbot_medical_qa_ner_handler.py"    #å¯åŠ¨torchserve --start --ncs --model-store model-store --models chatbotBERT.mar --ts-config ./model-store/config.properties</code></pre><p>åˆ†ç±»éƒ¨ç½²</p><pre class=" language-text"><code class="language-text">â”œâ”€â”€ best_classify.bin# è®­ç»ƒæœ€å¥½çš„æ¨¡å‹â”œâ”€â”€ best_classify.ptã€€#torchscriptæ¨¡å‹â”œâ”€â”€ chatbot_medical_qa_classify_handler.pyã€€#torchserveå…¥å£å‡½æ•°â”œâ”€â”€ Download_Transformer_models.pyã€€#modelæ–‡ä»¶è½¬torchscriptæ¨¡å‹â”œâ”€â”€ online_test.pyã€€## æ¥å£æµ‹è¯•â”œâ”€â”€ setup_config.jsonã€€## bertè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€€è¿™è¾¹æœªç”¨åˆ°â”œâ”€â”€ vocab.txt ## bertè¯å…¸</code></pre><pre class=" language-shell"><code class="language-shell">#æ‰“åŒ…torch-model-archiver \--model-name chatbotMedicalQAClassify \--version 1.0 \--serialized-file ./best_classify.pt \--handler ./chatbot_medical_qa_classify_handler.py \--extra-files "./setup_config.json,./vocab.txt"#béƒ¨ç½²torchserve --start --ncs \--model-store model-store \--models chatbotMedicalQAClassify.mar \--ts-config ./model-store/config.properties</code></pre><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯NER éƒ¨ç½²æ˜¯åŠ è½½åŸæ¨¡å‹ï¼Œè€Œclassiftyéƒ¨ç½²ç”¨çš„æ˜¯torchscriptæ¨¡å‹ï¼Œæ¨èä½¿ç”¨torchscriptï¼</p></blockquote><h4 id="å›ç­”ç”Ÿæˆ"><a href="#å›ç­”ç”Ÿæˆ" class="headerlink" title="å›ç­”ç”Ÿæˆ"></a>å›ç­”ç”Ÿæˆ</h4><p>çŸ¥è¯†å›¾è°±ä¸‰å…ƒç»„&lt;å®ä½“ï¼Œå…³ç³»ï¼Œå®ä½“&gt;æˆ–è€…æ˜¯&lt;å®ä½“ï¼Œå±æ€§ï¼Œå±æ€§å€¼&gt;</p><p>å‰é¢æŠ½å–çš„â€œåŒ»ç–—å‘½åå®ä½“â€å°±ä¸‰å…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ â€”â€”å®ä½“</p><p>å‰é¢è¿›è¡Œçš„â€œç”¨æˆ·æ„å›¾è¯†åˆ«â€åˆ™æ˜¯ä¸‰å…ƒç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ â€”â€”å…³ç³»/å±æ€§</p><p>å¾—åˆ°ä¸‰å…ƒç»„çš„è¿™ä¸¤ä¸ªå…ƒç´ å°±å¯ä»¥ç”¨cypherè¯­è¨€åœ¨neo4jå›¾æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾å¯¹åº”çš„å®ä½“æˆ–å±æ€§å€¼ï¼Œç„¶åæ„å»ºå›ç­”è¿”å›ç»™ç”¨æˆ·</p><pre class=" language-shell"><code class="language-shell">def sql_transfer(self, question_type, entities):        if not entities:            return []        # æŸ¥è¯¢è¯­å¥        sql = []        # æŸ¥è¯¢ç–¾ç—…çš„åŸå›         if question_type == 'disease_cause':            sql = ["MATCH (m:Disease) where m.name = '&#123;0&#125;' return m.name, m.cause".format(i) for i in entities]        # æŸ¥è¯¢ç–¾ç—…çš„é˜²å¾¡æªæ–½        elif question_type == 'disease_prevent':            sql = ["MATCH (m:Disease) where m.name = '&#123;0&#125;' return m.name, m.prevent".format(i) for i in entities]        # æŸ¥è¯¢ç–¾ç—…çš„æŒç»­æ—¶é—´        elif question_type == 'disease_lasttime':            sql = ["MATCH (m:Disease) where m.name = '&#123;0&#125;' return m.name, m.cure_lasttime".format(i) for i in entities]        # æŸ¥è¯¢ç–¾ç—…çš„æ²»æ„ˆæ¦‚ç‡        elif question_type == 'disease_cureprob':            sql = ["MATCH (m:Disease) where m.name = '&#123;0&#125;' return m.name, m.cured_prob".format(i) for i in entities]      '''      ...      '''        return sql</code></pre><h2 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h2><p><strong>PC</strong></p><p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/14.png"></p><p><strong>APP</strong></p><img src="/2020/08/10/yi-liao-zhi-shi-wen-da/15.jpg" style="zoom:67%;"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>ç›®å‰æ¥è¯´æ•´ä½“çš„æµç¨‹è¿˜æ˜¯æ¯”è¾ƒå®Œæ•´ï¼Œä½†å¯¹äºåœ¨å·¥ä¸šç•Œçš„è¿ç”¨æ¥è¯´è¿˜åªæ˜¯ä¸ªç©å…·ï¼</li><li>æ¨¡å‹æœ‰æé«˜çš„éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯æ•°æ®çš„æ ‡æ³¨å¤„ç†ä»¥åŠå¥å­è´¨é‡ï¼ˆæ¯”è¾ƒè´¹æ—¶é—´ï¼‰</li></ul><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/weixin_46133588/article/details/104700425">https://blog.csdn.net/weixin_46133588/article/details/104700425</a></p><p><a href="https://github.com/liuhuanyong/QASystemOnMedicalKG">https://github.com/liuhuanyong/QASystemOnMedicalKG</a></p><p>ã€€ã€€</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é—®ç­” </tag>
            
            <tag> å›¾æ•°æ®åº“ </tag>
            
            <tag> åŒ»ç–— </tag>
            
            <tag> è§„åˆ™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="/2020/08/08/git/"/>
      <url>/2020/08/08/git/</url>
      
        <content type="html"><![CDATA[<h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><h2 id="æ›´æ¢gitè¿œç¨‹ä»“åº“åœ°å€"><a href="#æ›´æ¢gitè¿œç¨‹ä»“åº“åœ°å€" class="headerlink" title="æ›´æ¢gitè¿œç¨‹ä»“åº“åœ°å€"></a>æ›´æ¢gitè¿œç¨‹ä»“åº“åœ°å€</h2><p>æ–¹æ³•ä¸€ ï¼š é€šè¿‡å‘½ä»¤ç›´æ¥ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€</p><pre class=" language-shell"><code class="language-shell">git remote æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹ä»“åº“git remote xxx æŸ¥çœ‹æŒ‡å®šè¿œç¨‹ä»“åº“åœ°å€git remote set-url origin ä½ æ–°çš„è¿œç¨‹ä»“åº“åœ°å€123</code></pre><p>æ–¹æ³•äºŒï¼š å…ˆåˆ é™¤åœ¨æ·»åŠ ä½ çš„è¿œç¨‹ä»“åº“</p><pre class=" language-shell"><code class="language-shell">git remote rm origingit remote add origin ä½ çš„æ–°è¿œç¨‹ä»“åº“åœ°å€12</code></pre><p>æ–¹æ³•ä¸‰ï¼š ç›´æ¥ä¿®æ”¹ä½ æœ¬åœ°çš„.gitæ–‡ä»¶</p><pre class=" language-shell"><code class="language-shell">è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯éœ€è¦è¿›å…¥ä½ çš„é¡¹ç›®ç›®å½•ä¸­ä¾‹å¦‚ï¼šä½ çš„é¡¹ç›®åä¸ºtestï¼Œé‚£ä¹ˆä½ å°±è¿›å…¥testæ–‡ä»¶å¤¹ã€‚**.gitæ–‡ä»¶æ˜¯éšè—æ–‡ä»¶ä½ éœ€è¦æ˜¾ç¤ºéšè—æ–‡ä»¶æ‰èƒ½çœ‹è§**</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŸ¥è¯†å›¾è°±é—®ç­”KBQAæ•°æ®é›†ä»‹ç»</title>
      <link href="/2020/08/08/zhi-shi-tu-pu-wen-da-kbqa-shu-ju-ji-jie-shao/"/>
      <url>/2020/08/08/zhi-shi-tu-pu-wen-da-kbqa-shu-ju-ji-jie-shao/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½ <a href="https://blog.csdn.net/qq_37974244/article/details/107020421">https://blog.csdn.net/qq_37974244/article/details/107020421</a></p><h1 id="ä¸€ã€WebQuestions"><a href="#ä¸€ã€WebQuestions" class="headerlink" title="ä¸€ã€WebQuestions"></a>ä¸€ã€WebQuestions</h1><p>æå‡ºè¯¥æ•°æ®é›†çš„è®ºæ–‡ï¼š<a href="https://www.aclweb.org/anthology/D13-1160/">Semantic Parsing on Freebase from Question-Answer Pairs</a></p><p>æ•°æ®é›†åœ°å€ï¼š<a href="https://worksheets.codalab.org/worksheets/0xba659fe363cb46e7a505c5b6a774dc8a">https://worksheets.codalab.org/worksheets/0xba659fe363cb46e7a505c5b6a774dc8a</a></p><p>WebQuestionsæ•°æ®é›†ï¼ˆ2013å¹´æå‡ºï¼‰æ˜¯ç”±æ–¯å¦ç¦å¤§å­¦ç ”ç©¶äººå‘˜é€šè¿‡Google Suggest APIæ„å»ºå¾—åˆ°çš„ï¼Œæ•°æ®é›†æœ¬èº«å…±åŒ…å«5810æ¡ï¼ˆé—®é¢˜ï¼Œç­”æ¡ˆï¼‰å¯¹ï¼Œå…¶ä¸­ç®€å•é—®é¢˜å æ¯”åœ¨84%ï¼Œå¤æ‚çš„å¤šè·³å’Œæ¨ç†é—®é¢˜ç›¸å¯¹è¾ƒå°‘ã€‚æ ¹æ®æå‡ºè€…çš„æœ€åˆæ•°æ®åˆ’åˆ†æ–¹å¼ï¼ŒWebQuestionsè¢«åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸¤ä¸ªé›†åˆï¼Œå…¶ä¸­è®­ç»ƒé›†åŒ…å«3778æ¡æ•°æ®ï¼Œæµ‹è¯•é›†åŒ…å«2032æ¡æ•°æ®ã€‚</p><h1 id="äºŒã€SimpleQuestions"><a href="#äºŒã€SimpleQuestions" class="headerlink" title="äºŒã€SimpleQuestions"></a>äºŒã€SimpleQuestions</h1><p>æå‡ºè¯¥æ•°æ®é›†çš„è®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1506.02075.pdf">Large-scale Simple Question Answering with Memory Networks</a></p><p>æ•°æ®é›†åœ°å€ï¼š<a href="https://research.fb.com/downloads/babi/">https://research.fb.com/downloads/babi/</a></p><p>SimpleQuestionsæ•°æ®é›†ï¼ˆ2015å¹´æå‡ºï¼‰æ˜¯ä¸€ä¸ªé’ˆå¯¹ç®€å•é—®é¢˜è€Œæ„å»ºçš„æ•°æ®é›†ï¼Œå®ƒé‡‡ç”¨äººå·¥æ ‡æ³¨çš„æ–¹æ³•æ ¹æ®çŸ¥è¯†åº“ä¸­çš„äº‹å®ç”Ÿæˆå¯¹åº”çš„é—®å¥ï¼Œå¹¶ä¸”ä»¥<strong>Freebase</strong>ä½œä¸ºç­”æ¡ˆæ¥æºã€‚è¯¥æ•°æ®é›†å…±åŒ…å«108,442æ¡æ•°æ®ï¼ˆåŒ…å«å…³ç³»æ ‡æ³¨ï¼‰ï¼Œå…¶ä¸­è®­ç»ƒé›†ä¸º75910æ¡ï¼ˆ70%ï¼‰ï¼ŒéªŒè¯é›†ä¸º10845æ¡ï¼ˆ10%ï¼‰ï¼Œæµ‹è¯•é›†ä¸º21687æ¡ï¼ˆ20%ï¼‰ã€‚</p><h1 id="ä¸‰ã€ComplexQuestions"><a href="#ä¸‰ã€ComplexQuestions" class="headerlink" title="ä¸‰ã€ComplexQuestions"></a>ä¸‰ã€ComplexQuestions</h1><p>æå‡ºè¯¥æ•°æ®é›†çš„è®ºæ–‡ï¼š<a href="https://www.aclweb.org/anthology/C16-1236/">Constraint-Based Question Answering with Knowledge Graph</a></p><p>ä½œè€…æœ¬äººçš„æ•°æ®é›†åœ°å€ï¼š<a href="https://github.com/JunweiBao/MulCQA/tree/ComplexQuestions">https://github.com/JunweiBao/MulCQA/tree/ComplexQuestions</a></p><p>ComplexQuestionsæ•°æ®é›†ï¼ˆ2016å¹´æå‡ºï¼‰æ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹å¤æ‚é—®é¢˜è€Œæ„å»ºçš„æ•°æ®é›†ï¼Œåœ¨æ„å»ºè¯¥æ•°æ®é›†è¿‡ç¨‹ä¸­ï¼Œä½œè€…ä»ä¸€ä¸ªå®é™…ä½¿ç”¨çš„æœç´¢å¼•æ“ï¼ˆå…·ä½“å“ªä¸ªæš‚æœªçŸ¥ï¼‰ä¸­ç­›é€‰å¹¶å¾—åˆ°äº†878æ¡å¯ç”¨çš„é—®ç­”å¯¹ã€‚é™¤äº†è¿™878æ¡æ•°æ®ï¼Œä½œè€…è¿˜ä»WebQuestionsç­‰æ•°æ®é›†ä¸Šé¢å¤–é€‰å‡ºäº†1222æ¡æ•°æ®ï¼Œç”±æ­¤å…±å¾—åˆ°äº†2100æ¡å¤æ‚é—®é¢˜å¯¹ã€‚æ€»ä½“æ¥è¯´ï¼Œè¯¥æ•°æ®é›†å…±åŒ…å«2100æ¡é—®ç­”å¯¹ï¼Œå…¶ä¸­è®­ç»ƒé›†ä¸ªæ•°ä¸º1300æ¡ï¼Œæµ‹è¯•é›†ä¸ªæ•°ä¸º800æ¡ã€‚</p><h1 id="å››ã€GraphQuestions"><a href="#å››ã€GraphQuestions" class="headerlink" title="å››ã€GraphQuestions"></a>å››ã€GraphQuestions</h1><p>æå‡ºè¯¥æ•°æ®é›†çš„è®ºæ–‡ï¼š<a href="https://www.aclweb.org/anthology/D16-1054/">On Generating Characteristic-rich Question Sets for QA Evaluation</a></p><p>æ•°æ®é›†åœ°å€ï¼š<a href="https://github.com/ysu1989/GraphQuestions">https://github.com/ysu1989/GraphQuestions</a></p><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒéš¾çš„æ•°æ®é›†ï¼ˆ2016å¹´æå‡ºï¼‰ï¼Œæ¶‰åŠè¾ƒå¤šæ¯”è¾ƒå¤æ‚çš„é€»è¾‘ï¼Œä»¥<strong>Freebase</strong>ä½œä¸ºçŸ¥è¯†åº“ã€‚è¯¥æ•°æ®é›†åœ¨æ„å»ºæ—¶å…ˆè®¾è®¡é—®é¢˜æ¶‰åŠçš„æ¨¡å¼ï¼ˆå³çŸ¥è¯†åº“ä¸­çš„ä¸€ä¸ªå­å›¾ï¼‰ï¼Œç„¶åè®©äººæ ¹æ®å›¾æ”¹å†™æˆè‡ªç„¶è¯­è¨€é¢˜ç›®ã€‚ä¸¾ä¸ªä¾‹å­ï¼šâ€œthe nine eleven were carried out with the involvement of what terrorist organizations?â€</p><h1 id="äº”ã€30M-Factoid-Questions"><a href="#äº”ã€30M-Factoid-Questions" class="headerlink" title="äº”ã€30M Factoid Questions"></a>äº”ã€30M Factoid Questions</h1><p>æå‡ºè¯¥æ•°æ®é›†çš„è®ºæ–‡ï¼š<a href="https://arxiv.org/pdf/1603.06807.pdf">Generating Factoid QuestionsWith Recurrent Neural Networks: The 30M Factoid Question-Answer Corpus</a></p><p>æ•°æ®é›†åœ°å€ï¼š<a href="https://academictorrents.com/details/973fb709bdb9db6066213bbc5529482a190098ce">https://academictorrents.com/details/973fb709bdb9db6066213bbc5529482a190098ce</a></p><p>è¯¥æ•°æ®é›†æ˜¯ç”±æ¨¡å‹è‡ªåŠ¨æ„å»ºçš„ï¼ŒåŒ…å«30Mçš„é—®ç­”å¯¹ã€‚æŒ‰ç…§è®ºæ–‡ä¸­çš„è¯´æ³•ï¼Œé—®å¥è´¨é‡å’Œäººç±»æ„å»ºçš„è´¨é‡ç›¸å½“ï¼Œå¾ˆæœ‰ä½¿ç”¨ä»·å€¼ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®é›† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é—®ç­”æ•°æ® </tag>
            
            <tag> æ•°æ®ç›¸å…³è®ºæ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bert BiLSTM CRF pytorch</title>
      <link href="/2020/08/07/bert-bilstm-crf-pytorch/"/>
      <url>/2020/08/07/bert-bilstm-crf-pytorch/</url>
      
        <content type="html"><![CDATA[<h1 id="åŒ»ç–—å‘½åå®ä½“è¯†åˆ«"><a href="#åŒ»ç–—å‘½åå®ä½“è¯†åˆ«" class="headerlink" title="åŒ»ç–—å‘½åå®ä½“è¯†åˆ«"></a>åŒ»ç–—å‘½åå®ä½“è¯†åˆ«</h1><h2 id="ä»»åŠ¡æè¿°"><a href="#ä»»åŠ¡æè¿°" class="headerlink" title="ä»»åŠ¡æè¿°"></a>ä»»åŠ¡æè¿°</h2><p>â€‹       å®ä½“è¯†åˆ«ä½œä¸ºä¿¡æ¯æŠ½å–çš„ä¸€ä¸ªé‡è¦å­ä»»åŠ¡ï¼Œè¿‘äº›å¹´å·²ç»å–å¾—äº†é˜¶æ®µæ€§æˆæœã€‚å¯¹äºåŒ»å­¦é¢†åŸŸçš„è‡ªç„¶è¯­è¨€æ–‡çŒ®ï¼Œä¾‹å¦‚åŒ»å­¦æ•™æã€åŒ»å­¦ç™¾ç§‘ã€ä¸´åºŠç—…ä¾‹ã€åŒ»å­¦æœŸåˆŠã€å…¥é™¢è®°å½•ã€æ£€éªŒæŠ¥å‘Šç­‰ï¼Œè¿™äº›æ–‡æœ¬ä¸­è•´å«å¤§é‡åŒ»å­¦ä¸“ä¸šçŸ¥è¯†å’ŒåŒ»å­¦æœ¯è¯­ã€‚å°†å®ä½“è¯†åˆ«æŠ€æœ¯ä¸åŒ»å­¦ä¸“ä¸šé¢†åŸŸç»“åˆï¼Œåˆ©ç”¨æœºå™¨è¯»å–åŒ»å­¦æ–‡æœ¬ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ä¸´åºŠç§‘ç ”çš„æ•ˆç‡å’Œè´¨é‡ï¼Œå¹¶ä¸”å¯æœåŠ¡äºä¸‹æ¸¸å­ä»»åŠ¡ã€‚è¦æƒ³è®©æœºå™¨â€œè¯»æ‡‚â€åŒ»å­¦æ•°æ®ï¼Œæ ¸å¿ƒåœ¨äºè®©è®¡ç®—æœºåœ¨å¤§é‡åŒ»å­¦æ–‡æœ¬ä¸­å‡†ç¡®çš„æå–å‡ºå…³é”®ä¿¡æ¯ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†å‘½åå®ä½“è¯†åˆ«ã€å…³ç³»æŠ½å–ç­‰è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ã€‚åŒ»å­¦é¢†åŸŸä¸­éç»“æ„åŒ–çš„æ–‡æœ¬ï¼Œéƒ½æ˜¯ç”±ä¸­æ–‡è‡ªç„¶è¯­è¨€å¥å­æˆ–å¥å­é›†åˆç»„æˆã€‚å®ä½“æŠ½å–æ˜¯ä»éç»“æ„åŒ–åŒ»å­¦æ–‡æœ¬ä¸­æ‰¾å‡ºåŒ»å­¦å®ä½“ï¼Œå¦‚ç–¾ç—…ã€ç—‡çŠ¶çš„è¿‡ç¨‹ã€‚</p><h2 id="æ•°æ®ç®€ä»‹"><a href="#æ•°æ®ç®€ä»‹" class="headerlink" title="æ•°æ®ç®€ä»‹"></a>æ•°æ®ç®€ä»‹</h2><blockquote><p>åŸå§‹æ•°æ®</p></blockquote><img src="/2020/08/07/bert-bilstm-crf-pytorch/3.png" style="zoom:80%;"><p>æ ‡è®°</p><blockquote><p>BIOESæ•°æ®æ ¼å¼</p><p>æ ‡ç­¾åˆ—è¡¨å¦‚ä¸‹ï¼š</p><ul><li>Bï¼Œå³Beginï¼Œè¡¨ç¤ºå¼€å§‹</li><li>Iï¼Œå³Intermediateï¼Œè¡¨ç¤ºä¸­é—´</li><li>Eï¼Œå³Endï¼Œè¡¨ç¤ºç»“å°¾</li><li>Sï¼Œå³Singleï¼Œè¡¨ç¤ºå•ä¸ªå­—ç¬¦</li><li>Oï¼Œå³Otherï¼Œè¡¨ç¤ºå…¶ä»–ï¼Œç”¨äºæ ‡è®°æ— å…³å­—ç¬¦</li></ul></blockquote><table><thead><tr><th>åˆ†ç±»å®ä½“</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PAT</td><td><strong>ä¸´åºŠè¡¨ç°</strong></td></tr><tr><td>OPS</td><td><strong>æ‰‹æœ¯</strong></td></tr><tr><td>DSE</td><td><strong>ç–¾ç—…å’Œè¯Šæ–­</strong></td></tr><tr><td>DRG</td><td><strong>è¯ç‰©</strong></td></tr><tr><td>INF</td><td><strong>éƒ¨ä½</strong></td></tr><tr><td>LAB</td><td><strong>ç”ŸåŒ–æŒ‡æ ‡</strong></td></tr><tr><td>O</td><td><strong>å…¶ä»–</strong></td></tr></tbody></table><p>{â€˜I-PATâ€™, â€˜B-OPSâ€™, â€˜I-DSEâ€™, â€˜I-OPSâ€™, â€˜B-DSEâ€™, â€˜E-DSEâ€™, â€˜B-DRGâ€™, â€˜E-OPSâ€™, â€˜I-INFâ€™, â€˜S-PATâ€™, â€˜I-DRGâ€™, â€˜I-LABâ€™, â€˜E-LABâ€™, â€˜Oâ€™, â€˜B-PATâ€™, â€˜B-LABâ€™, â€˜E-DRGâ€™, â€˜S-LABâ€™, â€˜E-INFâ€™, â€˜S-DSEâ€™, â€˜B-INFâ€™, â€˜E-PATâ€™}</p><h5 id="æ•°æ®é›†æè¿°"><a href="#æ•°æ®é›†æè¿°" class="headerlink" title="æ•°æ®é›†æè¿°"></a>æ•°æ®é›†æè¿°</h5><p>æœ¬æ¬¡è¯„æµ‹çš„è®­ç»ƒæ•°æ®æœ‰ï¼š<br><strong>1)</strong> 1000æ¡æ ‡æ³¨æ•°æ®<br><strong>2)</strong> 1000æ¡éæ ‡æ³¨æ•°æ®ã€‚<br><strong>3)</strong> 7ä¸ªç±»åˆ«</p><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><ol><li>é€šè¿‡trainæ•°æ®ä¸­çš„æ ‡è®°å®ä½“ä¿¡æ¯, æŠ½å–å‡ºtestæ•°æ®é›†ä¸­çš„æ•°æ®, è®°å½•ac, loss, ä¿å­˜æœ€ä½³çš„æ¨¡å‹</li></ol><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p>â”œâ”€â”€ checkpointsã€€ï¼ƒï¼ƒã€€æ¨¡å‹ä¿å­˜æ–‡ä»¶<br>â”œâ”€â”€ config.pyã€€ï¼ƒï¼ƒã€€é…ç½®æ–‡ä»¶<br>â”œâ”€â”€ crf_predict.pyã€€ï¼ƒï¼ƒé¢„æµ‹<br>â”œâ”€â”€ crf.py ## ï¼£ï¼²ï¼¦æ¨¡å‹<br>â”œâ”€â”€ data ## æºæ•°æ®<br>â”œâ”€â”€ LICENSE<br>â”œâ”€â”€ main.py  # è·¯å£æ–‡ä»¶<br>â”œâ”€â”€ model.py ## æ¨¡å‹<br>â”œâ”€â”€ processed  ## é¢„å¤„ç†æ•°æ®<br>â”œâ”€â”€ README.md<br>â””â”€â”€ utils.pyã€€ï¼ƒï¼ƒã€€å·¥å…·</p><h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h2><ul><li><p>ä»·æ ¼åŸæ¥BIOESçš„æ•°æ®è½¬æˆBIOç»“æ„</p><img src="/2020/08/07/bert-bilstm-crf-pytorch/1.png" style="zoom:80%;"></li></ul><h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><pre class=" language-python"><code class="language-python">   parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--batch_size"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span>     parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--lr"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>float<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--n_epochs"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--finetuning"</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">"finetuning"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--top_rnns"</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">"top_rnns"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store_true"</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--logdir"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"checkpoints/01"</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--trainset"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"processed/processed_training_bio.txt"</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--validset"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"processed/processed_dev_bio.txt"</span><span class="token punctuation">)</span>    hp <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><blockquote><p>BILSTM(bidirectional=True, num_layers=2, input_size=768, hidden_size=768//2, batch_first=True) ## åŒå‘ï¼Œä¸¤å±‚ã€€</p><p>BERT () # ä¸­æ–‡berté¢„å¤„ç†æ¨¡å‹12å±‚768hidden_size</p><p>CRF</p></blockquote><ul><li>å…³äºCRF åŸç†ï¼Œè¯·å‚ç…§<a href="/2020/07/25/crf/" title="CRF">CRF</a></li></ul><h2 id="DATASET"><a href="#DATASET" class="headerlink" title="DATASET"></a>DATASET</h2><ul><li><p>æœ€å¤§é•¿åº¦ã€€256</p></li><li><p>CLS å¼€å¤´ã€€â€˜[SEP]â€™ã€€ç»“å°¾</p><p>sentence</p></li></ul><p>â€˜[CLS]â€™, â€˜ï¼Œâ€™, â€˜æ‚£â€™, â€˜è€…â€™, â€˜3â€™, â€˜æœˆâ€™, â€˜å‰â€™, â€˜å› â€™, â€˜â€œâ€™, â€˜ç›´â€™, â€˜è‚ â€™, â€˜ç™Œâ€™, â€˜â€â€™, â€˜äºâ€™, â€˜åœ¨â€™, â€˜æˆ‘â€™, â€˜é™¢â€™, â€˜äºâ€™, â€˜å…¨â€™, â€˜éº»â€™, â€˜ä¸Šâ€™, â€˜è¡Œâ€™, â€˜ç›´â€™, â€˜è‚ â€™, â€˜ç™Œâ€™, â€˜æ ¹â€™, â€˜æ²»â€™, â€˜æœ¯â€™, â€˜ï¼ˆâ€™, â€˜Dâ€™, â€˜Iâ€™, â€˜Xâ€™, â€˜Oâ€™, â€˜Nâ€™, â€˜æœ¯â€™, â€˜ï¼‰â€™, â€˜ï¼Œâ€™, â€˜æ‰‹â€™, â€˜æœ¯â€™, â€˜è¿‡â€™, â€˜ç¨‹â€™, â€˜é¡ºâ€™, â€˜åˆ©â€™, â€˜ï¼Œâ€™, â€˜æœ¯â€™, â€˜åâ€™, â€˜ç»™â€™, â€˜äºˆâ€™, â€˜æŠ—â€™, â€˜æ„Ÿâ€™, â€˜æŸ“â€™, â€˜åŠâ€™, â€˜è¥â€™, â€˜å…»â€™, â€˜æ”¯â€™, â€˜æŒâ€™, â€˜æ²»â€™, â€˜ç–—â€™, â€˜ï¼Œâ€™, â€˜æ‚£â€™, â€˜è€…â€™, â€˜æ¢â€™, â€˜å¤â€™, â€˜å¥½â€™, â€˜ï¼Œâ€™, â€˜åˆ‡â€™, â€˜å£â€™, â€˜æ„ˆâ€™, â€˜åˆâ€™, â€˜è‰¯â€™, â€˜å¥½â€™, â€˜[SEP]â€™</p><p>tags</p><p>â€˜[CLS]â€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜B-DSEâ€™, â€˜I-DSEâ€™, â€˜I-DSEâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜B-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜I-OPSâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜Oâ€™, â€˜[SEP]â€™</p><h2 id="å®šä¹‰ä¸»æ¨¡å‹"><a href="#å®šä¹‰ä¸»æ¨¡å‹" class="headerlink" title="å®šä¹‰ä¸»æ¨¡å‹"></a>å®šä¹‰ä¸»æ¨¡å‹</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Bert_BiLSTM_CRF</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tag_to_ix<span class="token punctuation">,</span> hidden_dim<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>Bert_BiLSTM_CRF<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>tag_to_ix <span class="token operator">=</span> tag_to_ix        self<span class="token punctuation">.</span>tagset_size <span class="token operator">=</span> len<span class="token punctuation">(</span>tag_to_ix<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.hidden = self.init_hidden()</span>        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_layers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> input_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>hidden_dim<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>transitions <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim        self<span class="token punctuation">.</span>start_label_id <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span><span class="token string">'[CLS]'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>end_label_id <span class="token operator">=</span> self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span><span class="token string">'[SEP]'</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bert <span class="token operator">=</span> BertModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">'/home/daiyizheng/.cache/torch/transformers/bert-pretrainmodel/bert/bert-base-chinese'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.bert.eval()  # çŸ¥ç”¨æ¥å–bert embedding</span>        self<span class="token punctuation">.</span>transitions<span class="token punctuation">.</span>data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>start_label_id<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>        self<span class="token punctuation">.</span>transitions<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>end_label_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>        self<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.transitions.to(self.device)</span>    <span class="token keyword">def</span> <span class="token function">init_hidden</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        åˆå§‹åŒ–LSTMéšå±‚        :return:        """</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_forward_alg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">'''        this also called alpha-recursion or forward recursion, to calculate log_prob of all barX         '''</span>        <span class="token comment" spellcheck="true"># T = self.max_seq_length</span>        T <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>          batch_size <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># alpha_recursion,forward, alpha(zt)=p(zt,bar_x_1:t)</span>        log_alpha <span class="token operator">=</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">.</span>fill_<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#[batch_size, 1, 16]</span>        <span class="token comment" spellcheck="true"># normal_alpha_0 : alpha[0]=Ot[0]*self.PIs</span>        <span class="token comment" spellcheck="true"># self.start_label has all of the score. it is log,0 is p=1</span>        log_alpha<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>start_label_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># feats: sentances -> word embedding -> lstm -> MLP -> feats</span>        <span class="token comment" spellcheck="true"># feats is the probability of emission, feat.shape=(1,tag_size)</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>            log_alpha <span class="token operator">=</span> <span class="token punctuation">(</span>log_sum_exp_batch<span class="token punctuation">(</span>self<span class="token punctuation">.</span>transitions <span class="token operator">+</span> log_alpha<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> feats<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># log_prob of all barX</span>        log_prob_all_barX <span class="token operator">=</span> log_sum_exp_batch<span class="token punctuation">(</span>log_alpha<span class="token punctuation">)</span>        <span class="token keyword">return</span> log_prob_all_barX    <span class="token keyword">def</span> <span class="token function">_score_sentence</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">,</span> label_ids<span class="token punctuation">)</span><span class="token punctuation">:</span>        T <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        batch_size <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        batch_transitions <span class="token operator">=</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">.</span>expand<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">,</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span>        batch_transitions <span class="token operator">=</span> batch_transitions<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        score <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># the 0th node is start_label->start_word,the probability of them=1. so t begin with 1.</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>            score <span class="token operator">=</span> score <span class="token operator">+</span> batch_transitions<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>label_ids<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>tagset_size<span class="token operator">+</span>label_ids<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> feats<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> label_ids<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> score    <span class="token keyword">def</span> <span class="token function">_bert_enc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        x: [batchsize, sent_len]        enc: [batch_size, sent_len, 768]        """</span>        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            encoded_layer<span class="token punctuation">,</span> _  <span class="token operator">=</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">(</span>x<span class="token punctuation">)</span>            enc <span class="token operator">=</span> encoded_layer<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> enc    <span class="token keyword">def</span> <span class="token function">_viterbi_decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">'''        Max-Product Algorithm or viterbi algorithm, argmax(p(z_0:t|x_0:t))        '''</span>        <span class="token comment" spellcheck="true"># T = self.max_seq_length</span>        T <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        batch_size <span class="token operator">=</span> feats<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># batch_transitions=self.transitions.expand(batch_size,self.tagset_size,self.tagset_size)</span>        log_delta <span class="token operator">=</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">.</span>fill_<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>        log_delta<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>start_label_id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token comment" spellcheck="true"># psi is for the vaule of the last latent that make P(this_latent) maximum.</span>        psi <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># psi[0]=0000 useless</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># delta[t][k]=max_z1:t-1( p(x1,x2,...,xt,z1,z2,...,zt-1,zt=k|theta) )</span>            <span class="token comment" spellcheck="true"># delta[t] is the max prob of the path from  z_t-1 to z_t[k]</span>            log_delta<span class="token punctuation">,</span> psi<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>self<span class="token punctuation">.</span>transitions <span class="token operator">+</span> log_delta<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># psi[t][k]=argmax_z1:t-1( p(x1,x2,...,xt,z1,z2,...,zt-1,zt=k|theta) )</span>            <span class="token comment" spellcheck="true"># psi[t][k] is the path choosed from z_t-1 to z_t[k],the value is the z_state(is k) index of z_t-1</span>            log_delta <span class="token operator">=</span> <span class="token punctuation">(</span>log_delta <span class="token operator">+</span> feats<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># trace back</span>        path <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># max p(z1:t,all_x|theta)</span>        max_logLL_allz_allx<span class="token punctuation">,</span> path<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>log_delta<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T<span class="token number">-2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># choose the state of z_t according the state choosed of z_t+1.</span>            path<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span> <span class="token operator">=</span> psi<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>path<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> max_logLL_allz_allx<span class="token punctuation">,</span> path    <span class="token keyword">def</span> <span class="token function">neg_log_likelihood</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">,</span> tags<span class="token punctuation">)</span><span class="token punctuation">:</span>        feats <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_lstm_features<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#[batch_size, max_len, 16]</span>        forward_score <span class="token operator">=</span> self<span class="token punctuation">.</span>_forward_alg<span class="token punctuation">(</span>feats<span class="token punctuation">)</span>        gold_score <span class="token operator">=</span> self<span class="token punctuation">.</span>_score_sentence<span class="token punctuation">(</span>feats<span class="token punctuation">,</span> tags<span class="token punctuation">)</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>forward_score <span class="token operator">-</span> gold_score<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_get_lstm_features</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""sentence is the ids"""</span>        <span class="token comment" spellcheck="true"># self.hidden = self.init_hidden()</span>        embeds <span class="token operator">=</span> self<span class="token punctuation">.</span>_bert_enc<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [8, 75, 768]</span>        <span class="token comment" spellcheck="true"># è¿‡lstm</span>        enc<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>lstm<span class="token punctuation">(</span>embeds<span class="token punctuation">)</span>        lstm_feats <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>enc<span class="token punctuation">)</span>        <span class="token keyword">return</span> lstm_feats  <span class="token comment" spellcheck="true"># [8, 75, 16]</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># dont confuse this with _forward_alg above.</span>        <span class="token comment" spellcheck="true"># Get the emission scores from the BiLSTM</span>        lstm_feats <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_lstm_features<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># [8, 180,768]</span>        <span class="token comment" spellcheck="true"># Find the best path, given the features.</span>        score<span class="token punctuation">,</span> tag_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>_viterbi_decode<span class="token punctuation">(</span>lstm_feats<span class="token punctuation">)</span>        <span class="token keyword">return</span> score<span class="token punctuation">,</span> tag_seq</code></pre><h2 id="è®­ç»ƒç»“æœ"><a href="#è®­ç»ƒç»“æœ" class="headerlink" title="è®­ç»ƒç»“æœ"></a>è®­ç»ƒç»“æœ</h2><blockquote><p>num_proposed:46616<br>num_correct:38213<br>num_gold:46865<br>precision=0.82<br>recall=0.82<br>f1=0.82</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LSTM </tag>
            
            <tag> CRF </tag>
            
            <tag> Bert </tag>
            
            <tag> å‘½åå®ä½“è¯†åˆ« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Part-of-Speech Tagging with Bidirectional Long Short-Term Memory Recurrent Neural Network é˜…è¯»</title>
      <link href="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/"/>
      <url>/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/</url>
      
        <content type="html"><![CDATA[<h1 id="Part-of-Speech-Tagging-with-Bidirectional-Long-Short-Term-Memory-Recurrent-Neural-Network"><a href="#Part-of-Speech-Tagging-with-Bidirectional-Long-Short-Term-Memory-Recurrent-Neural-Network" class="headerlink" title="Part-of-Speech Tagging with Bidirectional Long Short-Term Memory Recurrent Neural Network"></a>Part-of-Speech Tagging with Bidirectional Long Short-Term Memory Recurrent Neural Network</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>â€‹    <img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/1.png" style="zoom:50%;align= center"></p><p>â€‹      LSTMå¯¹æ ‡ç­¾æ•°æ®çš„ä»»åŠ¡éå¸¸æœ‰æ•ˆ,è€Œä¸”å­—å‘é‡æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¡¨ç¤ºæ–¹æ³•.æœ¬è®ºæ–‡ä½¿ç”¨å¸¦è¯åµŒå…¥çš„BLSTM-RNNè¿›è¡Œè¯æ€§æ ‡æ³¨,åœ¨Penn Treebank WSJ æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡è¾¾åˆ°97.4%</p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/3.png" style="zoom:50%;align= center"><p>æœ¬æ–‡çš„è´¡çŒ®</p><ul><li>BLSTMåœ¨è¯æ€§æ ‡æ³¨çš„æœ‰æ•ˆæ€§æ–¹æ³•</li><li>è®­ç»ƒè¯åµŒå…¥æ–¹æ³•çš„æå‡º</li><li>è¯æ˜äº†ä¸ä½¿ç”¨ç‰¹å¾ä¹Ÿå¯ä»¥è·å¾—æ ‡è®°å‡†ç¡®æ€§</li></ul><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/2.png" style="zoom:50%;align= center"><p>å¦‚å›¾, ç»™æˆ‘ä¸€ä¸ªå¥å­w1, w2ï¼Œâ€¦y1, y2ï¼Œâ€¦åˆ©ç”¨BLSTM RNNé¢„æµ‹æ¯ä¸ªå•è¯çš„æ ‡ç­¾æ¦‚ç‡åˆ†å¸ƒã€‚</p><ul><li><p>$w _i$ è¡¨ç¤ºå½“å‰è¯one-hot è¡¨ç¤º </p></li><li><p>$V$ æ˜¯è¯è¡¨</p></li><li><p>$f({w} _{i})$ ä¸‰ç»´å‘é‡,è¡¨ç¤ºåˆ¤æ–­$w _i$æ˜¯å…¨å°å†™ã€å…¨å¤§å†™è¿˜æ˜¯ä»¥å¤§å†™å­—æ¯å¼€å¤´</p></li><li><p>æ•´ä½“è¾“å…¥çš„è¯å‘é‡ä¿¡æ¯ $I _i = {W} _{1}{w} _{i} + {W} _{2}f({w} _{i})$</p></li><li><p>$W _1$è¢«å®ç°æŸ¥è¡¨è¿‡ç¨‹(ä½¿ç”¨å…¶ä»–é¢„è®­ç»ƒè¯å‘é‡)ï¼Œå‚è€ƒè¯¥è¡¨ä¸­å­˜å‚¨çš„$wi$åµŒå…¥è¯è¿”å›${W} _{1} {w} _{i}$</p></li><li><p>è¯åµŒå…¥åˆå§‹åŒ–ä¸ºå‡åŒ€åˆ†å¸ƒçš„éšæœºå€¼ï¼ŒèŒƒå›´ä»-0.1åˆ°0.1.</p></li><li><p>è¾“å‡ºå±‚æ˜¯softmaxå±‚ï¼Œå…¶ç»´åº¦ä¸ºæ ‡è®°ç±»å‹çš„æ•°é‡ã€‚</p></li><li><p>ä½¿ç”¨åå‘ä¼ æ’­å’Œæ¢¯åº¦ä¸‹é™ç®—æ³•è¿›è¡Œè®­ç»ƒ ${\prod} _{ i\in 1,â€¦n }{ { P } _{ i } ({y} _{i} | {w} _{1}, {w} _{2} â€¦ {w} _{n}) }$</p></li><li><p>è¾“å…¥è¯$w_i$ä¸­æœ€å¯èƒ½çš„æ ‡ç­¾${y} _{i}$å¯ä»¥é€‰æ‹©ä¸º${y} ^{â€˜} _{i} = arg _{ i\in 1,â€¦n } { P } _{ i } ({y} _{i} | {w} _{1}, {w} _{2} â€¦ {w} _{n}) $</p></li></ul><h2 id="è¯å‘é‡"><a href="#è¯å‘é‡" class="headerlink" title="è¯å‘é‡"></a>è¯å‘é‡</h2><p>â€‹      <img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/4.png" style="zoom:50%;align= center"></p><p>â€‹      æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„è®­ç»ƒæ— æ ‡è®°æ•°æ®åµŒå…¥è¯çš„æ–¹æ³•, ç”±éšæœºé€‰æ‹©çš„å•è¯ä»£æ›¿çš„æ­£å¸¸å¥å­ã€‚å¯¹äºé‚£äº›è¢«æ›¿æ¢çš„å•è¯ï¼Œå®ƒä»¬çš„æ ‡ç­¾æ˜¯0(ä¸æ­£ç¡®)ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰è¢«æ›¿æ¢çš„å•è¯ï¼Œå®ƒä»¬çš„æ ‡ç­¾æ˜¯1(æ­£ç¡®).ä½¿äºŒå€¼åˆ†ç±»è®­ç»ƒ</p><h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>BLSTM RNNç³»ç»Ÿæ˜¯åˆ©ç”¨CURRENTå®ç°çš„ï¼ŒCURRENTæ˜¯ä¸€ç§é‡‡ç”¨GPUåŠ é€Ÿçš„RNNæœºå™¨å­¦ä¹ åº“ã€‚</p><h3 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h3><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/6.png" style="zoom:50%;align= center"><p>ä½¿ç”¨Penn Treebankæ ‡è®°å™¨1è¿›è¡Œæ ‡è®°ã€‚ä¸€ä¸ªå•è¯ä¸­å‡ºç°çš„æ‰€æœ‰è¿ç»­å­—éƒ½æ›¿æ¢ä¸ºç¬¦å·â€œ#â€ã€‚ä¾‹å¦‚ï¼Œå•è¯â€œTel192â€å’Œâ€œTel6â€éƒ½è¢«è½¬ç§»åˆ°åŒä¸€ä¸ªå•è¯â€œTel#â€ä¸Šã€‚</p><h3 id="Hidden-Layer-Size"><a href="#Hidden-Layer-Size" class="headerlink" title="Hidden Layer Size"></a>Hidden Layer Size</h3><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/7.png" style="zoom:50%;align= center"><p>å¦‚å›¾ BLSTM RNNä¸­éšè—å±‚çš„ä¸åŒå¤§å°ä¸æµ‹è¯•é›†çš„ç²¾ç¡®åº¦æ‰€ç¤º,åœ¨ç²¾åº¦ã€æ¨¡å‹å°ºå¯¸å’Œè¿è¡Œæ—¶é—´ä¸Šä¿æŒè‰¯å¥½çš„å¹³è¡¡,100ä½œä¸ºHidden Layer Size</p><h3 id="POS-Tagging-Accuracies"><a href="#POS-Tagging-Accuracies" class="headerlink" title="POS Tagging Accuracies"></a>POS Tagging Accuracies</h3><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/8.png" style="zoom:50%;align= center"><p>å››ä¸ªå…¸å‹çš„ç³»ç»Ÿä½œä¸ºåŸºçº¿ç³»ç»Ÿ </p><ul><li><p>Stanford tagger </p></li><li><p>Moore</p></li><li><p>Shen et al</p></li><li><p>Collobert et al</p></li></ul><p><strong>BLSTM-RNN</strong></p><p>â€‹    åœ¨è¿™ä¸ªå®éªŒä¸­ä½¿ç”¨çš„è¯æ±‡æ˜¯æ‰€æœ‰å‡ºç°åœ¨WSJ Penn Treebankè®­ç»ƒé›†çš„è¯æ±‡ï¼Œä¸åŒ—ç¾æ–°é—»è¯­æ–™åº“ä¸­æœ€å¸¸è§çš„10ä¸‡ä¸ªè¯æ±‡åˆå¹¶ï¼Œå†åŠ ä¸Šä¸€ä¸ªâ€œUNKâ€ç¬¦å·ï¼Œç”¨æ¥æ›¿æ¢æ‰€æœ‰æ²¡æœ‰è¯æ±‡çš„è¯æ±‡ã€‚</p><p><strong>BLSTM-RNN+WE</strong> </p><p>â€‹     ä¸ºäº†æ„å»ºè®­ç»ƒè¯åµŒå…¥çš„è¯­æ–™åº“ï¼Œæˆ‘ä»¬å°†åŒ—ç¾æ–°é—»è¯­æ–™åº“ä¸­æ­£å¸¸å¥å­ä¸­çº¦20%çš„è¯æ›¿æ¢ä¸ºéšæœºé€‰å–çš„è¯ã€‚ç„¶åè®­ç»ƒBLSTM RNNåˆ¤æ–­å“ªä¸ªè¯è¢«æ›¿æ¢äº†.</p><p>â€‹    è¡¨2å±•ç¤ºäº†ä½¿ç”¨å•è¯åµŒå…¥è®­ç»ƒåŒ—ç¾æ–°é—»è¯­æ–™åº“çš„å‰1000ä¸‡ä¸ªå•è¯(WE(10m))ã€å‰1äº¿ä¸ªå•è¯(WE(100m))å’Œæ‰€æœ‰5.3äº¿ä¸ªå•è¯(WE(all))çš„ç»“æœã€‚WE(100m)å’ŒWE(all)æ˜¾è‘—æé«˜äº†æ€§èƒ½ã€‚è¿™è¡¨æ˜ä½¿ç”¨æ›´å¤§çš„æœªæ ‡è®°æ•°æ®é›†å¯ä»¥è¿›ä¸€æ­¥æé«˜ç»“æœã€‚</p><img src="/2020/08/07/part-of-speech-tagging-with-bidirectional-long-short-term-memory-recurrent-neural-network/10.png" style="zoom:50%;align= center"><h3 id="Different-Word-Embeddings"><a href="#Different-Word-Embeddings" class="headerlink" title="Different Word Embeddings"></a>Different Word Embeddings</h3><p>â€‹    åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œè¯„ä¼°äº†å…­ç§å·²ç»å‘å¸ƒçš„ç»è¿‡è®­ç»ƒçš„å•è¯åµŒå…¥ã€‚æ¶‰åŠè¯çš„åŸºæœ¬ä¿¡æ¯åµŒå…¥å’Œç»“æœåœ¨è¡¨3åˆ—å‡ºRCV1ä»£è¡¨è¯­æ–™é›†ã€‚OOV(è¯æ±‡)åˆ—è¡¨ç¤ºçš„å•è¯åœ¨è¯æ±‡å¤–ã€‚å•è¯åµŒå…¥çš„ç”¨æ³•ä¸å®éªŒçš„BLSTM-RNN+ä¸­ç›¸åŒï¼Œåªæ˜¯è¿™é‡Œçš„è¾“å…¥å±‚å¤§å°ç­‰äºå¤–éƒ¨å•è¯åµŒå…¥çš„ç»´æ•°ã€‚</p><p>   å…¨è¯åµŒå…¥å¸¦æ¥æ›´é«˜çš„ç²¾åº¦ã€‚ç„¶è€Œï¼Œå°½ç®¡è®­ç»ƒçš„è¯­æ–™åº“è¾ƒå¤§ï¼ŒOOVç‡è¾ƒä½ï¼Œä½†å®ƒä»¬éƒ½ä¸èƒ½é€šè¿‡å¢å¼ºBLSTM RNNæ ‡è®°æ¥è·å¾—é«˜çš„å‡†ç¡®ç‡ã€‚å®éªŒè¡¨æ˜ï¼Œè¯æ€§æ ‡æ³¨æ–¹æ³•ä¸­ï¼ŒBLSTM RNNè®­ç»ƒçš„è¯åµŒå…¥æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â€‹     BLSTM RNNç”¨äºè¯æ€§æ ‡æ³¨å’Œè®­ç»ƒè¯åµŒå…¥ã€‚ç»“åˆåœ¨å¤§é‡æœªæ ‡è®°æ•°æ®ä¸Šè®­ç»ƒçš„å•è¯åµŒå…¥ï¼Œè¿™ç§æ–¹æ³•åœ¨ä¸ä½¿ç”¨ä¸°å¯Œçš„ç‰¹å¾çš„æƒ…å†µä¸‹ï¼Œåœ¨åå°”è¡—æ—¥æŠ¥æµ‹è¯•é›†ä¸Šè·å¾—äº†æœ€å¥½çš„å‡†ç¡®æ€§ã€‚å¸¦å•è¯åµŒå…¥çš„BLSTM RNNæœ‰æœ›æˆä¸ºæ ‡ç­¾ä»»åŠ¡çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆ.</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LSTM </tag>
            
            <tag> è¯æ€§æ ‡æ³¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Open Domain Question Answering System Based on Knowledge Base</title>
      <link href="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/"/>
      <url>/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/</url>
      
        <content type="html"><![CDATA[<h1 id="Open-Domain-Question-Answering-System-Based-on-Knowledge-Base"><a href="#Open-Domain-Question-Answering-System-Based-on-Knowledge-Base" class="headerlink" title="Open Domain Question Answering System Based on Knowledge Base"></a>Open Domain Question Answering System Based on Knowledge Base</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>ã€€ã€€<img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/1.png"></p><p>ã€€ã€€é’ˆå¯¹NLP&amp;CC 2016ä¸­åŸºäºçŸ¥è¯†åº“çš„å¼€æ”¾åŸŸé—®é¢˜å›ç­”ä»»åŠ¡ï¼Œè®ºæ–‡æå‡ºäº†SEPç®—æ³•ï¼Œè‡ªåŠ¨ä»ä¸€ä¸ªç®€å•é—®å¥ä¸­æå–ä¸»è¯­è°“è¯­è¯å¯¹ï¼Œå°†å…¶ç¿»è¯‘æˆçŸ¥è¯†åº“æŸ¥è¯¢ã€‚æå‡ºäº†ä¸€ç§åŸºäºè¯å‘é‡ç›¸ä¼¼åº¦å’Œè°“è¯æ³¨æ„åº¦çš„å€™é€‰è°“è¯è¯„åˆ†æ–¹æ³•ã€‚åœ¨NLP&amp;CC 2016(KBQAå­ä»»åŠ¡)ç«èµ›ä¸­è·å¾—ç¬¬ä¸€åï¼Œæµ‹è¯•æ•°æ®f1åˆ†82.47%ã€‚æ­¤å¤–ï¼Œè¿˜è¿›è¡Œäº†ä¸€ç³»åˆ—çš„å®éªŒå’Œå…¨é¢çš„è¯¯å·®åˆ†æï¼Œä»¥æ˜¾ç¤ºæ–°æ•°æ®é›†çš„æ€§è´¨å’Œç¼ºé™·ã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>â€‹         å¼€æ”¾åŸŸé—®é¢˜å›ç­”(QA)æ˜¯ä¸€ä¸ªé‡è¦è€Œåˆå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä»æœªè§£å†³ã€‚è¿‘å¹´æ¥ï¼Œå‡ºç‰ˆäº†å¤§é‡çš„è‹±æ–‡QAè‘—ä½œã€‚ä½†æˆ‘ä»¬æ‰€çŸ¥,KBQA(åŸºäºçŸ¥è¯†åº“çš„é—®ç­”)æ•°æ®é›†2016å¹´NLP&amp;CCè¯„ä¼°ä»»åŠ¡æ˜¯ä¸­å›½ç¬¬ä¸€ä¸ªå¤§è§„æ¨¡KBQAæ•°æ®é›†ã€‚åœ¨æœ¬æ–‡ä¸­,æˆ‘ä»¬åœ¨ä¸­å›½æ•°æ®é›†é›†ä¸­ç²¾åŠ›å›ç­”å•ä¸€å…³ç³»ä¼¼æ˜¯è€Œéçš„é—®é¢˜ã€‚ä¸€ä¸ªSPEç®—æ³•KB querieç¿»è¯‘ä¸€ä¸ªä¸­æ–‡çš„é—®é¢˜ã€‚è¯¥ç®—æ³•åœ¨é€»è¾‘ä¸Šè§£å†³äº†å¤šä¸ªå…³è”é—®é¢˜ï¼Œè¯¥é—®é¢˜å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªä¸»é¢˜å®ä½“ï¼Œå¹¶ç”±è°“è¯é“¾è¿æ¥ã€‚ä½†å—é™äºæ•°æ®é›†ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œç›¸å…³å®éªŒã€‚</p><p>ã€€ã€€å€™é€‰è°“è¯è¯„ä»·æ˜¯è¯¥ç®—æ³•çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæå‡ºäº†ä¸€ç§åŸºäºè¯å‘é‡ç›¸ä¼¼åº¦å’Œè°“è¯æ³¨æ„çš„æ–°æ–¹æ³•ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™ç§æ–¹æ³•çœ‹èµ·æ¥åƒä¸€ä¸ªå¸¦æœ‰æ³¨æ„æœºåˆ¶çš„ç¥ç»ç½‘ç»œï¼Œä½†å®ƒæ˜¯å¦‚æ­¤æµ…æ˜¾ï¼Œä»¥è‡³äºé™¤äº†å•è¯å‘é‡ä¹‹å¤–ä¸éœ€è¦è®­ç»ƒä»»ä½•å‚æ•°ã€‚å› æ­¤ï¼Œå®ƒæ›´ç®€æ´ã€é«˜æ•ˆã€å¯è§£é‡Šæ€§å¼ºï¼Œå¯ä»¥æ›´çµæ´»åœ°ä¸å…ˆéªŒçŸ¥è¯†ç»“åˆï¼Œä½†ä¸§å¤±äº†æ·±åº¦ç¥ç»ç½‘ç»œè¾ƒå¼ºçš„è¡¨å¾èƒ½åŠ›ç­‰ä¼˜ç‚¹ã€‚è¿˜æœ‰å°è¯•å¤„ç†ç”±spiderã€é—®é¢˜åˆ†ç±»å’Œè®­ç»ƒæ•°æ®å¼•èµ·çš„çŸ¥è¯†åº“é”™è¯¯ï¼Œä»¥æé«˜æ€§èƒ½ã€‚æˆ‘ä»¬çš„æ–¹æ³•æµ‹è¯•æ•°æ®f1å¾—åˆ†ä¸º82.47%ï¼Œåœ¨è¯„ä¼°ä»»åŠ¡ä¸­è·å¾—ç¬¬ä¸€åã€‚</p><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p>â€‹      KBQAçš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯åŸºäºä¸€äº›è§£ææ–¹æ³•ï¼Œå¦‚è¯­ä¹‰è§£æã€ä¾èµ–è§£æå’ŒCCG(ç»„åˆç±»åˆ«è¯­æ³•)ï¼Œå°†é—®é¢˜æ˜ å°„åˆ°å®ƒçš„è¯­ä¹‰è¡¨ç¤º(ä¾‹å¦‚ä¸€é˜¶é€»è¾‘å½¢å¼)ã€‚ä½†æ˜¯è¿™äº›å·¥ä½œå¾ˆå°‘ä½¿ç”¨KBsæ¥å¸®åŠ©è¿›è¡Œè§£æï¼Œè€Œä¸”å®ƒä»¬å—åˆ°è§£ææ–¹æ³•å‡†ç¡®æ€§çš„é™åˆ¶ï¼Œåœ¨å¤„ç†ä¸­æ–‡æ—¶å°¤å…¶ä¸¥é‡ã€‚ä¸ºäº†é¿å…è¿™äº›ç¼ºç‚¹ï¼Œä¸€äº›æ–¹æ³•å€ŸåŠ©çŸ¥è¯†åº“ä»é—®é¢˜ä¸­æå–çŸ¥è¯†åº“æŸ¥è¯¢ï¼Œå¦‚æœ€è¿‘çš„WebQuestionsç ”ç©¶ã€‚</p><h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/2.png" style="zoom:80%;">   <img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/3.png" style="zoom:80%;"><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/4.png" style="zoom:80%;"><p>â€‹       ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ä¸»é¢˜å®ä½“é“¾æ¥æ–¹æ³•æ¥æå–å¯èƒ½çš„KBå®ä½“ã€‚æ ¹æ®è¯å‘é‡ç›¸ä¼¼åº¦å’Œè°“è¯æ³¨æ„åº¦å¯¹è¿™äº›å®ä½“åçš„æ‰€æœ‰è°“è¯è¿›è¡Œè¯„ä¼°ã€‚åˆ©ç”¨å®ä½“é•¿åº¦å’Œè°“è¯å¾—åˆ†çš„çº¿æ€§ç»„åˆå¯¹ä¸»è°“å¯¹è¿›è¡Œæ’åºï¼Œåˆ©ç”¨è®­ç»ƒé›†ä¸­ä»é—®é¢˜-ç­”æ¡ˆå¯¹ä¸­æå–çš„ç­”æ¡ˆæ¨¡å¼å’Œå¤„ç†å¤‡é€‰é—®é¢˜çš„å…ˆéªŒè§„åˆ™è¿›è¡Œæ’åºã€‚</p><h2 id="Topic-Entity-Linking"><a href="#Topic-Entity-Linking" class="headerlink" title="Topic Entity Linking"></a>Topic Entity Linking</h2><p>â€‹      <img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/5.png" style="zoom:80%;"></p><p>â€‹       é—®é¢˜çš„ä¸»é¢˜å®ä½“æ˜¯ç›¸åº”KBæŸ¥è¯¢çš„æ ¸å¿ƒå®ä½“ã€‚åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰ä»¥KBè¡¨ç¤ºçš„å®ä½“(å®ƒä»¬æ˜¯é—®é¢˜çš„å­å­—ç¬¦ä¸²ï¼Œä¸è¢«å…¶ä»–å®ä½“é‡å )éƒ½è¢«è§†ä¸ºæ½œåœ¨çš„ä¸»é¢˜å®ä½“ã€‚è¿˜æœ‰ä¸€ä¸ªç”±é«˜é¢‘å®ä½“ç»„æˆçš„åœæ­¢è¯åˆ—è¡¨ï¼Œä»¥å‡å°‘å™ªéŸ³å®ä½“(å¦‚â€is||æ˜¯â€ï¼Œï¼‚ä»€ä¹ˆ||whatï¼‚)å’Œæé«˜æ•ˆç‡ã€‚åœ¨æ’åºé˜¶æ®µï¼Œè€ƒè™‘å®ä½“çš„é•¿åº¦ä½œä¸ºä¸€ä¸ªç‰¹å¾ã€‚</p><p>â€‹      ä¾‹å¦‚ï¼Œé—®é¢˜çš„æ½œåœ¨ä¸»é¢˜å®ä½“ â€œåšé“æ¿é±¼è¦ç”¨åˆ°ä»€ä¹ˆè°ƒæ–™ï¼Ÿ|| What sauce will be used when you make iron fish (Chinese cuisine)?â€  æ˜¯ã€€ï¼‚é“æ¿é±¼|| iron fishï¼‚, â€œåˆ°||toâ€ å’Œã€€â€œè°ƒæ–™|| sauceâ€. â€œåš||makeâ€, â€œè¦||willâ€, â€œç”¨||useâ€, â€œå“ª andäº›â€ï¼ˆâ€å“ªäº›â€ã€€mean â€œWhatâ€ï¼‰  è¢«å¿½ç•¥ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é«˜é¢‘å®ä½“ã€‚</p><h2 id="Predicate-Scoring"><a href="#Predicate-Scoring" class="headerlink" title="Predicate Scoring"></a>Predicate Scoring</h2><p>â€‹      ä¸»é¢˜å®ä½“é“¾æ¥ä¹‹åï¼Œæœ‰ä¸€äº›æ½œåœ¨çš„å®ä½“ï¼Œå¹¶ä¸”æ¯ä¸ªå®ä½“éƒ½æœ‰ä¸€äº›KBä¸­çš„è°“è¯ã€‚ä¸€ä¸ªå¥½çš„è°“è¯å¯ä»¥å®Œç¾åœ°å¤„ç†é—®é¢˜å…¶ä½™éƒ¨åˆ†çš„è¯­ä¹‰ã€‚åˆ™å€™é€‰è°“è¯çš„åˆ†æ•°ä¸º:</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/6.png" style="zoom:80%;"><p>â€‹       ã€€ å…¶ä¸­$wp _i$æ˜¯è°“è¯­çš„ç¬¬iä¸ªè¯ï¼Œ$wq _j$æ˜¯é—®é¢˜çš„ç¬¬jä¸ªè¯ã€‚$lp _i$æ˜¯$wp _i$çš„é•¿åº¦ã€‚$Sim$ä¸ºä¸¤ä¸ªè¯çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œè¿™é‡Œé‡‡ç”¨è¯å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚æ­¤åˆ†æ•°å°†ç”¨äºæ’åé˜¶æ®µã€‚</p><p>â€‹      ã€€è¯­ä¹‰ç›¸ä¼¼æ€§è¢«è®¤ä¸ºæ˜¯è¡¨å¾è°“è¯­è¯å¯¹æœ‰é—®é¢˜è¯çš„å…³æ³¨ç¨‹åº¦ã€‚å¦‚æœp_iä¸qj1çš„ç›¸ä¼¼æ€§å¤§äºpiä¸qj2çš„ç›¸ä¼¼æ€§ï¼Œåˆ™qj1æ¶‰åŠçš„piè¯­ä¹‰è¾ƒå¤šã€‚ç”±äºåœ¨è¯„ä»·æ¯ä¸ªè°“è¯è¯æ—¶åªè€ƒè™‘ä¸€ä¸ªé—®é¢˜è¯ï¼Œå› æ­¤æ³¨æ„ç±»ä¼¼äºåŠ æƒå¯¹é½è¿‡ç¨‹ã€‚æœ€å…³å¿ƒçš„ç–‘é—®è¯æ„æˆäº†æ•´ä¸ªè°“è¯­çš„æ³¨æ„ã€‚ä»¥è°“è¯è¯çš„é•¿åº¦ä½œä¸ºæƒé‡ï¼Œå¯¹è¯çš„ç›¸ä¼¼æ€§è¿›è¡ŒåŠ æƒå¹³å‡ï¼Œè¡¡é‡è°“è¯æ˜¯å¦é€‚åˆäºæ­¤é—®é¢˜ã€‚</p><p>â€‹     ã€€å…¨ç»†åˆ†æ¨¡å¼çš„æ€§èƒ½ä¼˜äºå¸¸è§„æ¨¡å¼ï¼Œä½†ä»æ˜æ˜¾ä½äºæˆ‘ä»¬çš„ç»†åˆ†æ¨¡å¼ã€‚æ­¤å¤–ï¼ŒåŠ©è¯å’Œæ ‡ç‚¹ç¬¦å·åœ¨è¿™é‡Œè¢«å¿½ç•¥ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰æ„ä¹‰ã€‚</p><p>ã€€ã€€åˆ†è¯æ€§èƒ½æ›´å¥½æœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œåœ¨æ±‰è¯­ä¸­ï¼Œå¦‚æœä¸€ä¸ªè¯è¦†ç›–å¦ä¸€ä¸ªè¯ï¼Œå®ƒä»¬é€šå¸¸æœ‰ç›¸ä¼¼çš„è¯­ä¹‰ï¼Œç‰¹åˆ«æ˜¯åœ¨å£è¯­ä¸­ã€‚å…¶æ¬¡ï¼Œè¯ä¸è¯ä¹‹é—´å¾€å¾€å­˜åœ¨ä¸€ç§â€œç±»â€çš„å…³ç³»ï¼å› æ­¤ï¼Œè¯¥åˆ†è¯å™¨å¯ä»¥å¤„ç†å£è¯­ä¸­çµæ´»å¤šå˜çš„è¯æ±‡ã€‚</p><p>ã€€ã€€ä½¿ç”¨è¯å‘é‡è®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦åœ¨å¤„ç†ç–‘é—®å¥æ—¶å­˜åœ¨å›°éš¾ã€‚     â€œsä»€ä¹ˆæ—¶å€™||whenâ€ä¸â€œæ—¥æœŸ||dateâ€ï¼Œâ€åœ¨å“ª é‡Œ||whereâ€ and â€œåœ°ç‚¹||placeâ€ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦è¿œä½äºé¢„æœŸã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›æ‰‹å†™çš„æ¨¡å¼æ¥æŒ‡å‡ºé—®é¢˜ç±»å‹ï¼Œå¹¶ç›´æ¥åœ¨åˆ†è¯ç»“æœä¸­åŠ å…¥ä¸€äº›ç¬¦å·è¯ã€‚ç”±äºè¯­å¥éå¸¸çµæ´»ï¼Œåªå¤„ç†äº†3ç§ç±»å‹çš„é—®é¢˜(è¡¨1)ï¼Œå æ‰€æœ‰é—®é¢˜çš„10%å·¦å³ã€‚è¿™åªæ˜¯å°†è°“è¯è¯„åˆ†ä¸ä¸€äº›å…ˆå‰çš„è§„åˆ™ç»„åˆåœ¨ä¸€èµ·çš„ä¸€ä¸ªå°å°è¯•ï¼Œæœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/7.png" style="zoom:80%;"><p>è°“è¯æ³¨æ„çš„å®ä¾‹å¦‚å›¾2æ‰€ç¤ºï¼Œä½™å¼¦ç›¸ä¼¼åº¦å’Œæ˜ å°„å…³ç³»å¦‚è¡¨2æ‰€ç¤ºã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/9.png" style="zoom:80%;"><h2 id="Answer-Pattern"><a href="#Answer-Pattern" class="headerlink" title="Answer Pattern"></a>Answer Pattern</h2><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/10.png" style="zoom:80%;"><p>â€‹         ç­”æ¡ˆæ¨¡å¼æ˜¯ä»æ ‡è®°çš„é—®é¢˜-ç­”æ¡ˆå¯¹ä¸­æå–çš„è§„åˆ™ï¼Œå¯ä»¥æ­ç¤ºé—®é¢˜é™ˆè¿°ä¸å¯¹åº”æ­£ç¡®ç­”æ¡ˆçš„çŸ¥è¯†åº“ç»“æ„ä¹‹é—´çš„è”ç³»ã€‚å¯¹äºæ¯ä¸ªé—®é¢˜-ç­”æ¡ˆå¯¹ï¼Œå€™é€‰ä¸‰å…ƒç»„æ˜¯KBä¸­çš„SPO(ä¸»é¢˜-è°“è¯-å¯¹è±¡)ä¸‰å…ƒç»„ï¼Œå…¶ä¸»é¢˜æ˜¯é—®é¢˜çš„å­å­—ç¬¦ä¸²ï¼Œè€Œå¯¹è±¡ä¸ç­”æ¡ˆç›¸åŒã€‚ä½¿ç”¨å‡ ä¸ªç®€å•çš„è§„åˆ™æ¥è¿‡æ»¤é«˜å¯ä¿¡åº¦ä¸‰å…ƒç»„(ä¸»è¦åŸºäºåŒ¹é…çš„é•¿åº¦)ã€‚è¿˜æœ‰ä¸€äº›æƒ…å†µæ˜¯ï¼Œæ²¡æœ‰å€™é€‰ä¸‰å…ƒç»„ï¼Œä¸ºäº†ç¡®ä¿æœ€ä½³ä¸‰å…ƒç»„çš„é«˜ç²¾åº¦ï¼Œå¿½ç•¥è¿™äº›é—®é¢˜-ç­”æ¡ˆå¯¹ã€‚</p><p>â€‹         ç­”æ¡ˆæ¨¡å¼æå–ç¤ºä¾‹å¦‚è¡¨3æ‰€ç¤ºã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/11.png" style="zoom:80%;"><h2 id="Ranking"><a href="#Ranking" class="headerlink" title="Ranking"></a>Ranking</h2><p>â€‹       åœ¨æ’åºé˜¶æ®µï¼Œåˆ©ç”¨å®ä½“é•¿åº¦ã€è°“è¯å¾—åˆ†å’Œç­”æ¡ˆæ¨¡å¼å‡ºç°æ¬¡æ•°ç­‰ç‰¹å¾çš„çº¿æ€§ç»„åˆæ¥é€‰æ‹©é»„é‡‘ç­”æ¡ˆã€‚</p><p>â€‹       å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€äº›è§„åˆ™æ¥å¤„ç†ä¸é€‚åˆæ­¤ä½“ç³»ç»“æ„çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¯é€‰é—®é¢˜å‡ ä¹ä¸æ¶‰åŠè°“è¯çš„æ„ä¹‰ï¼Œåªæœ‰æœ‰é™çš„å¯¹è±¡å¯ä¾›é€‰æ‹©ã€‚</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p>æ•°æ®é›†ç”±NLP&amp;CC2016è¯„ä¼°ä»»åŠ¡å‘å¸ƒï¼ŒåŒ…æ‹¬ä¸€ä¸ªçŸ¥è¯†åº“å’Œç”¨äºè®­ç»ƒå’Œæµ‹è¯•çš„é—®é¢˜ç­”æ¡ˆå¯¹.</p><h2 id="Experiment-Settings"><a href="#Experiment-Settings" class="headerlink" title="Experiment Settings"></a>Experiment Settings</h2><p>â€‹       åœ¨ä¸»é¢˜å®ä½“é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œåœ¨è®­ç»ƒé¢˜å’Œæµ‹è¯•é¢˜ä¸­å‡ºç°è¶…è¿‡150æ¬¡çš„å®ä½“è¢«è§†ä¸ºåœæ­¢è¯ã€‚åœ¨24,479ä¸ªé—®é¢˜ä¸­ï¼Œæœ‰52,916ä¸ªä¸åŒçš„å®ä½“ï¼Œåªæœ‰496ä¸ªé«˜é¢‘ç‡å®ä½“ï¼Œä¸è¶³æ€»æ•°çš„1%ã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/13.png" style="zoom:80%;"><p>â€‹     ä½¿ç”¨word2vecè½¯ä»¶ç”Ÿæˆå•è¯å‘é‡ã€‚é‡‡ç”¨CBOWæ¨¡å‹ã€‚çª—å£å¤§å°ä¸º5ï¼Œå‘é‡ç»´æ•°ä¸º300ï¼Œå¯¹é¢‘ç¹è¯çš„é™é‡‡æ ·é˜ˆå€¼ä¸º20ã€‚ä»¥ç™¾åº¦ç™¾ç§‘ä¸­çš„å¥å­ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œç”Ÿæˆ155,837ä¸ªè¯å‘é‡.</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/12.png" style="zoom:80%;"><p>è®¾rä¸ºè°“è¯åˆ†æ•°ä¸å®ä½“é•¿åº¦ä¹‹é—´çš„æƒé‡æ¯”ç‡ã€‚æµ‹è¯•r (fixed w_el = 1, w_po = 100)å¯¹è®­ç»ƒé›†çš„å½±å“ï¼Œç»“æœå¦‚å›¾3æ‰€ç¤ºã€‚å½“råœ¨10åˆ°16ä¹‹é—´æ—¶ï¼Œæ€§èƒ½æ˜¯æœ€ä½³ï¼Œå› æ­¤æˆ‘ä»¬è®¾ç½®r = 10ï¼Œè¿™æ„å‘³ç€w_ps = 10ã€‚</p><h2 id="Benchmark-Systems"><a href="#Benchmark-Systems" class="headerlink" title="Benchmark Systems"></a>Benchmark Systems</h2><p>ä¸‰ä¸ªåŸºå‡†æµ‹è¯•ç³»ç»Ÿ</p><ul><li>KBQAä»»åŠ¡çš„æ­£å¼åŸºå‡†ç³»ç»Ÿã€‚æ‰€ä»¥æˆ‘ä»¬å°±å«å®ƒNLPCC</li><li>â€œæ¨¡å¼åŒ¹é…â€ï¼Œå®ƒåªä½¿ç”¨ä»è®­ç»ƒæ•°æ®ä¸­æå–çš„ç­”æ¡ˆæ¨¡å¼æ¥å›ç­”é—®é¢˜ã€‚ä¿ç•™æ ¸å¿ƒé—®é¢˜æå–ï¼Œæé«˜å‘½ä¸­ç‡ã€‚è¿™ä¸ªåŸºæµ‹è¯•çš„ç²¾åº¦ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºåœ¨è®­ç»ƒæ•°æ®æ ‡è®°ä¸ºç­”æ¡ˆçš„æ€§èƒ½,è¿™ä¹Ÿæ˜¯ä¸€ç§ä¸Šç•Œçš„è¿™ä¸ªæ•°æ®é›†ã€‚</li><li>å‘ç°æœ€é•¿çš„ä¸»è°“å¯¹é—®é¢˜å’Œç›¸åº”çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯ç­”æ¡ˆ,è¿™æ˜¯ä¸‹ç•Œçš„å‡†ç¡®æ€§æ‰€æœ‰SPEçš„ç®—æ³•ã€‚</li></ul><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/14.png" style="zoom:80%;"><p>ç³»ç»Ÿä¸ä¸€äº›åŸºå‡†æµ‹è¯•ç³»ç»Ÿè¿›è¡Œæ¯”è¾ƒ å¦‚è¡¨4æ‰€ç¤ºã€‚</p><p>â€‹        é‚£ä¹ˆå‡†ç¡®ç‡@ nç­‰äºå‡†ç¡®ç‡@ nä¹˜ä»¥å›ç­”ç‡ã€‚â€œPatternMatch+NaiveSearchâ€æ˜¯è¿™ä¸¤ç§ç³»ç»Ÿçš„ç»“åˆï¼Œç›´æ¥å°†ç­”æ¡ˆåˆ†æ•°ç›¸åŠ ã€‚</p><p>â€‹        æˆ‘ä»¬çš„ç³»ç»Ÿçš„ç²¾ç¡®åº¦@1æ¥è¿‘äºæ¨¡å¼åŒ¹é…å’ŒNaiveSearchç³»ç»Ÿçš„ç²¾ç¡®åº¦@1ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿæ˜¯åŸºäºå¼ºè§„åˆ™çš„ç³»ç»Ÿï¼Œç²¾åº¦é«˜ï¼Œå¬å›ç‡ä½ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨è¿™ä¸ªæ•°æ®é›†ä¸Šæ¥è¿‘äºç†è®ºä¸Šæœ€å¥½çš„ç³»ç»Ÿã€‚</p><p>â€‹    æˆ‘ä»¬è¿˜æµ‹è¯•äº†ç³»ç»Ÿæ ¸å¿ƒçš„æ€§èƒ½ä»¥åŠè§„åˆ™éƒ¨åˆ†çš„å½±å“ï¼Œå¦‚è¡¨5æ‰€ç¤ºã€‚ç”±äºæ‰€æœ‰ç³»ç»Ÿéƒ½æ‰“å°æœ‰åºç­”æ¡ˆè€Œä¸æ˜¯å¹¶è¡Œç­”æ¡ˆï¼Œæ‰€ä»¥æœ€ä½³ç­–ç•¥æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªç­”æ¡ˆï¼Œå› æ­¤F1å¹³å‡åˆ†ç­‰äºaccuracy@1ã€‚å› ä¸ºæ‰€æœ‰è¿™äº›æµ‹è¯•çš„â€œå›ç­”â€ç‡éƒ½æ˜¯100%ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œç”¨accuracy@Nä»£æ›¿precision@Nã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/15.png" style="zoom:80%;"><p>â€‹         åœ¨è¡¨5ä¸­ï¼Œâ€œTrâ€è¡¨ç¤ºä½¿ç”¨ä»è®­ç»ƒæ•°æ®ä¸­æå–çš„ç­”æ¡ˆæ¨¡å¼ã€‚QCoreæ˜¯æŒ‡ä½¿ç”¨é—®é¢˜çš„æ ¸å¿ƒéƒ¨åˆ†è€Œä¸æ˜¯å®Œæ•´çš„é—®é¢˜ã€‚â€œqclassificationâ€æ˜¯æŒ‡åœ¨è°“è¯è¯„åˆ†ä¸­åŠ å…¥é—®é¢˜åˆ†ç±»æ–¹æ³•ã€‚â€œAQâ€æ˜¯æŒ‡å¤‡é€‰é—®é¢˜çš„å¤„ç†åè§„åˆ™ã€‚â€œFullâ€ç­‰äºâ€œCore + Tr + QCore + qclassified + AQâ€ã€‚â€œæ ¸å¿ƒâ€ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ— ç›‘ç£çš„ç³»ç»Ÿä½¿ç”¨åŸºæœ¬çš„SPEç®—æ³•ã€‚</p><p>â€‹         ä»è¡¨5å¯ä»¥çœ‹å‡ºï¼Œæ·»åŠ çš„æ–¹æ³•ä½¿æ ¸å¿ƒç³»ç»Ÿçš„æ€§èƒ½æœ‰æ‰€æé«˜ã€‚è¿™ä¸€å½±å“ä¹‹æ‰€ä»¥ä¸æ˜¾è‘—ï¼Œæœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œé™¤äº†â€œQCoreâ€ä¹‹å¤–ï¼Œæ‰€æœ‰æ·»åŠ çš„æ–¹æ³•éƒ½åªæ¶‰åŠå¾ˆå°‘çš„é—®é¢˜ï¼Œè€ŒQCoreåªæ˜¯ä¸€ç§æ•°æ®æ¸…ç†æ–¹æ³•ã€‚å…¶æ¬¡ï¼Œè¿™äº›è§„åˆ™æ”¹å–„äº†åœ¨è®­ç»ƒæ•°æ®è¿›è¡Œäº¤å‰éªŒè¯æ—¶å‘ç°çš„ä¸€äº›ä¸è¶³ï¼Œä½†é—®é¢˜åœ¨æµ‹è¯•æ•°æ®ä¸­çš„åˆ†å¸ƒç•¥æœ‰ä¸åŒï¼Œä½¿å¾—æ•ˆæœè¾ƒå¼±ã€‚è¯¦æƒ…è§è¡¨6ã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/16.png" style="zoom:80%;"><p>â€‹     NLP&amp;CC2016è¯„ä¼°ä»»åŠ¡çš„ç»“æœå¦‚è¡¨7æ‰€ç¤º(21æ¬¡æäº¤çš„å‰5åç»“æœ)ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨æ‰€æœ‰å›¢é˜Ÿä¸­è¡¨ç°æœ€å¥½ã€‚ä¸è¡¨5ç›¸æ¯”ï¼Œå³ä½¿æ˜¯æ ¸å¿ƒç³»ç»Ÿåœ¨æœ¬æ¬¡è¯„ä¼°ä»»åŠ¡ä¸­ä¹Ÿä¼˜äºç¬¬äºŒç»„ã€‚</p><img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/17.png" style="zoom:80%;"><h2 id="Error-Analysis"><a href="#Error-Analysis" class="headerlink" title="Error Analysis        "></a>Error Analysis        <img src="/2020/08/07/open-domain-question-answering-system-based-on-knowledge-base/18.png" style="zoom:80%;"></h2><p>ã€€ã€€è¿‘ä¸€åŠçš„é”™è¯¯å®é™…ä¸Šæ˜¯ç”±äºæ ‡ç­¾é—®é¢˜æˆ–é—®é¢˜è®¾è®¡ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„é”™è¯¯ã€‚å…¶ä¸­æ¶‰åŠä¸»ä½“ä¸æ˜(31%ï¼Œå¦‚â€œå…´é¾™é•‡çš„é‚®æ”¿ç¼–ç æ˜¯å¤šå°‘â€ï¼Œä¸­å›½å…´é¾™é•‡å¾ˆå¤š)ã€çŸ¥è¯†åº“çŸ›ç›¾(5%)ã€æ„å›¾ä¸æ˜(2%)æˆ–ç­”æ¡ˆæ ‡æ³¨é”™è¯¯(5%)ã€‚30%çš„é”™è¯¯æ˜¯ç”±äºä¸æˆåŠŸçš„å®ä½“é“¾æ¥æˆ–è°“è¯è¯„åˆ†ï¼Œè¿™æ˜¯æœ€é‡è¦çš„æ”¹è¿›ç©ºé—´ã€‚æœ‰27%çš„é”™è¯¯æ˜¯ç”±äºé—®é¢˜çš„ç­”æ¡ˆä¸æ˜¯é—®é¢˜ä¸»ä½“çš„å¯¹è±¡å¼•èµ·çš„ã€‚</p><h2 id="Dataset-Analysis"><a href="#Dataset-Analysis" class="headerlink" title="Dataset Analysis"></a>Dataset Analysis</h2><p>â€‹       æœ‰äº›æ­§ä¹‰æ˜¯ç”±å…·æœ‰ç›¸åŒåç§°çš„å®ä½“é€ æˆçš„ï¼Œé—®é¢˜ä¸­æ²¡æœ‰çº¿ç´¢å¯ä»¥å¸®åŠ©åŒºåˆ†å®ƒä»¬ã€‚å…¶ä¸­4773é¢˜(19.50%)ï¼Œè®­ç»ƒé›†3189é¢˜(21.83%)ï¼Œæµ‹è¯•é›†1584é¢˜(16.05%)ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿå¯¹è¿™äº›é—®é¢˜çš„åŸå§‹å‡†ç¡®ç‡åªæœ‰62.43%ï¼Œè®­ç»ƒé›†çš„62.40%ï¼Œæµ‹è¯•é›†çš„62.50%ï¼Œå¦‚æœé€šè¿‡å¯»æ‰¾æ­£ç¡®çš„ä¸»è°“è¯å¯¹æ¥åˆ¤æ–­è¿™äº›é—®é¢˜çš„å‡†ç¡®ç‡ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåœ¨æµ‹è¯•é›†ä¸­å¯¹è¿™äº›é—®é¢˜çš„å‡†ç¡®ç‡ä¸º82.07%ã€‚å› æ­¤ï¼Œé€šè¿‡è¿™ä¸€æ”¹å˜ï¼Œç³»ç»Ÿæ€§èƒ½å°†è¾¾åˆ°85.61%ã€‚</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>â€‹     æå‡ºäº†ä¸€ä¸ªåŸºäºSPEç®—æ³•çš„KBQAç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå¯ä»¥å›ç­”ç®€å•å…³ç³»ä¸­æ–‡é—®é¢˜ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é—®ç­” </tag>
            
            <tag> LSTM </tag>
            
            <tag> è¯æ€§æ ‡æ³¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Chinese Question Answering System for Single-Relation Factoid Questions é˜…è¯»</title>
      <link href="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/"/>
      <url>/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/</url>
      
        <content type="html"><![CDATA[<h1 id="A-Chinese-Question-Answering-System-for-Single-Relation-Factoid-Questions"><a href="#A-Chinese-Question-Answering-System-for-Single-Relation-Factoid-Questions" class="headerlink" title="A Chinese Question Answering System for Single-Relation Factoid Questions"></a>A Chinese Question Answering System for Single-Relation Factoid Questions</h1><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract."></a>Abstract.</h2><p>â€‹     é’ˆå¯¹NLPCC 2017ä¸­åŸºäºçŸ¥è¯†åº“çš„å¼€æ”¾é¢†åŸŸé—®é¢˜å›ç­”çš„ä»»åŠ¡ï¼Œæ„å»ºäº†ä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨æŸ¥æ‰¾å•å…³ç³»é—®é¢˜æ‰¿è¯ºå®ä½“å’Œè°“è¯çš„é—®é¢˜å›ç­”ç³»ç»Ÿã€‚åœ¨åŸºäºç‰¹å¾çš„å®ä½“é“¾æ¥ç»„ä»¶å’ŒåŸºäºå•è¯å‘é‡çš„å€™é€‰è°“è¯ç”Ÿæˆç»„ä»¶ä¹‹åï¼Œä½¿ç”¨æ·±åº¦å·ç§¯æ–°ç½‘ç»œå¯¹å®ä½“-è°“è¯å¯¹é‡æ–°æ’åºï¼Œå¹¶ä½¿ç”¨æ‰€æœ‰ä¸­é—´åˆ†æ•°æ¥é€‰æ‹©æœ€ç»ˆçš„é¢„æµ‹ç­”æ¡ˆã€‚æˆ‘ä»¬çš„æ–¹æ³•åœ¨æµ‹è¯•æ•°æ®ä¸Šçš„f1å¾—åˆ†ä¸º47.23%ï¼Œåœ¨NLPCC 2017å…±äº«ä»»åŠ¡5(KBQAå­ä»»åŠ¡)ç«èµ›ä¸­è·å¾—ç¬¬ä¸€åã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„å®éªŒï¼Œå¯ä»¥å¸®åŠ©å…¶ä»–å¼€å‘äººå‘˜äº†è§£æˆ‘ä»¬ç³»ç»Ÿçš„æ¯ä¸ªéƒ¨åˆ†çš„è´¡çŒ®ã€‚</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>â€‹     å¼€æ”¾é¢†åŸŸçš„é—®é¢˜å›ç­”æ˜¯ä¸€ä¸ªé‡è¦è€Œåˆå…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ï¼Œå®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä»æœªå¾—åˆ°è§£å†³ã€‚è¿‘å¹´æ¥ï¼Œéšç€DBPedia[12]ã€Freebase[13]ç­‰å¤§å‹çŸ¥è¯†åº“çš„å‘å±•ï¼Œå¾ˆå¤šç ”ç©¶éƒ½é›†ä¸­åœ¨ä»çŸ¥è¯†åº“ä¸­ä¸ºå¼€æ”¾åŸŸé—®é¢˜ç”Ÿæˆç²¾ç¡®å¯é çš„ç­”æ¡ˆã€‚æœ¬æ–‡ä»‹ç»äº†ä¸€ä¸ªä¸­æ–‡å•å…³ç³»factoidé—®é¢˜çš„å›ç­”ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿæ˜¯NLPCC KBQAè¯„ä¼°ä»»åŠ¡çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚æå‡ºäº†ä¸€ç§æ–°çš„åŸºäºæ·±åº¦ç½‘ç»œç¥ç»ç½‘ç»œçš„å®ä½“-è°“è¯å¯¹é‡æ’åºæ–¹æ³•ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨æµ‹è¯•æ•°æ®ä¸Šçš„f1å¾—åˆ†ä¸º47.23%ï¼Œåœ¨è¯„ä»·ä»»åŠ¡ä¸­è·å¾—ç¬¬ä¸€å.</p><p>â€‹    åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ç¬¬2èŠ‚ä¸­å›é¡¾ç›¸å…³å·¥ä½œï¼Œåœ¨ç¬¬3èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»æˆ‘ä»¬çš„æ–¹æ³•çš„æ¶æ„ã€‚ç¬¬4èŠ‚å°†è®¨è®ºå®éªŒè®¾ç½®ã€ç»“æœå’Œå®ç°æŠ€å·§ã€‚ç¬¬äº”éƒ¨åˆ†å¯¹å…¨æ–‡è¿›è¡Œäº†æ€»ç»“ï¼Œå¹¶å¯¹æœªæ¥çš„ç ”ç©¶è¿›è¡Œäº†å±•æœ›ã€‚</p><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p>â€‹       å¼€æ”¾åŸŸé—®é¢˜å›ç­”æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸä¸­ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„é—®é¢˜ï¼Œè¢«ç§°ä¸ºaiå®Œå…¨é—®é¢˜ã€‚é€šè¿‡çŸ¥è¯†åº“å›ç­”å¼€æ”¾é¢†åŸŸé—®é¢˜å¯ä»¥ç”Ÿæˆæ›´ç²¾ç¡®å’Œå¯é çš„ç­”æ¡ˆã€‚è®¸å¤šä¼ ç»Ÿçš„KBQAæŠ€æœ¯éƒ½æ˜¯åŸºäºä¿¡æ¯æ£€ç´¢[7][8]å’Œè¯­ä¹‰è§£æ[9][10][11]ã€‚æœ€è¿‘ï¼Œä¸€äº›ç ”ç©¶åˆ©ç”¨è¡¨ç¤ºå­¦ä¹ æ¥ç¡®å®šå®ä½“æåŠä¸çŸ¥è¯†åº“å®ä½“[1]ã€é—®é¢˜æ¨¡å¼ã€çŸ¥è¯†åº“è°“è¯[1]æˆ–çŸ¥è¯†åº“å­å›¾[2]ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚ä»–ä»¬è¯æ˜äº†ç¥ç»ç½‘ç»œæ–¹æ³•å¯ä»¥æ›´å¥½åœ°å¤„ç†é«˜çº§è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚åœ¨å¤„ç†å¤æ‚çš„è‡ªç„¶è¯­è¨€ä»»åŠ¡ï¼Œå¦‚å›ç­”é—®é¢˜æ—¶ï¼Œå°†ç¥ç»ç½‘ç»œä¸ä¼ ç»Ÿçš„æµ…å±‚ç‰¹å¾ç›¸ç»“åˆæ˜¯æœ‰ç›Šçš„ã€‚æŒ‰ç…§ä»–ä»¬çš„æƒ³æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå°†ä¼ ç»Ÿçš„æµ…å±‚ç‰¹å¾ä¸CNNsç‰¹å¾ç»“åˆåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚</p><p>â€‹    NLPCCç»„ç»‡ä¸­å›½KBQAè¯„ä¼°ä»»åŠ¡å·²æœ‰ä¸‰å¹´ã€‚Yeçš„ç³»ç»Ÿ[18]åœ¨NLPCC 2015ä¸­æ–‡KBQAä»»åŠ¡ä¸­å–å¾—äº†æœ€å¥½çš„æ€§èƒ½ï¼Œè¯¥ç³»ç»Ÿå°†ä¸»é¢˜è°“è¯æå–ç®—æ³•ä¸webçŸ¥è¯†æ£€ç´¢ç›¸ç»“åˆã€‚Lai[19]åœ¨NLPCC 2016 KBQAä»»åŠ¡ä¸­ä½¿ç”¨åŸºäºè¯å‘é‡çš„ç‰¹å¾æœç´¢æœ€ä¼˜çš„ä¸»è¯­è°“è¯å¯¹ï¼Œå–å¾—äº†æœ€å¥½çš„æ€§èƒ½ã€‚Yang[20]ç»“åˆäº†åŸºäºç‰¹å¾çš„å®ä½“é“¾æ¥ã€åŸºäºæœ´ç´ è´å¶æ–¯çš„ç­”æ¡ˆé€‰æ‹©å’ŒåŸºäºCNNsçš„é‡æ–°æ’åºï¼Œè·å¾—äº†2016å¹´çš„ç¬¬äºŒåã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä¸»è¦å—åˆ°ä»–ä»¬çš„ä½œå“[19][20]çš„å¯å‘ï¼Œä½†æ˜¯æˆ‘ä»¬å®ç°äº†ä¸€ç§æ–°é¢–çš„CNNæ¶æ„ï¼Œå¹¶é€‚å½“çš„ç»“åˆäº†ä»–ä»¬ç³»ç»Ÿçš„ä¼˜ç‚¹ã€‚æˆ‘ä»¬è¿˜æ”¹è¿›äº†[19]ä¸­åŸºäºè¯å‘é‡çš„è°“è¯é€‰æ‹©ç®—æ³•ï¼Œæˆ‘ä»¬çš„å®ä½“é“¾æ¥æ–¹æ³•ä¸[20]ç•¥æœ‰ä¸åŒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§ç²¾å·§çš„ç”Ÿæˆå¯¹æŠ—æ–¹æ³•ï¼Œå¦‚è´Ÿé‡‡æ ·æ–¹æ³•æ¥å¤„ç†CNNè®­ç»ƒä¸­çš„æ•°æ®ä¸å¹³è¡¡ã€‚</p><p>â€‹      æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­å´­éœ²å¤´è§’ã€‚æœ€è¿‘ï¼Œä¸€äº›å·¥ä½œå°è¯•åœ¨NLPä»»åŠ¡ä¸­ä½¿ç”¨æ·±å±‚æ¶æ„ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»[5]å’Œæœºå™¨ç¿»è¯‘[6]ã€‚ä»–ä»¬éµå¾ªäº†VGG[14]å’ŒResNet[15]çš„è®¾è®¡ï¼Œä½¿ç”¨çª„æ»¤æ³¢å™¨å’Œå‰©ä½™è¿æ¥æ¥å‡å°‘å‚æ•°ï¼Œä½¿æ·±å±‚æ¶æ„æ›´æ˜“äºè®­ç»ƒã€‚æˆ‘ä»¬è¿˜å°è¯•åœ¨ç³»ç»Ÿä¸­å®ç°æ·±åº¦cnnï¼Œä½†éµå¾ªGoogLeNet[16]æ¶æ„ï¼Œä½¿ç”¨å¸¦æœ‰å‰©ä½™è¿æ¥çš„å¤šè§†è§’è¿‡æ»¤å™¨ã€‚</p><h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p>â€‹      æˆ‘ä»¬çš„ç³»ç»Ÿæ¶æ„å¦‚å›¾1æ‰€ç¤ºã€‚å—å‰äºº[19]çš„å¯å‘ï¼Œé‡‡ç”¨äº†ä¸€äº›æ‰‹å†™çš„è§„åˆ™æ¥çº æ­£çŸ¥è¯†åº“ä¸­æ„å¤–çš„ç‰¹æ®Šç¬¦å·ä»¥åŠä»é—®é¢˜ä¸­æå–æ ¸å¿ƒè¡¨è¾¾å¼ç­‰èœ˜è››é”™è¯¯ã€‚ç„¶åï¼Œä½¿ç”¨åŸºäºç‰¹å¾çš„æ–¹æ³•æ¥é€‰æ‹©æ‰¿è¯ºçš„å®ä½“æåŠï¼Œç„¶åä½¿ç”¨åŸºäºè°“è¯çš„æ— ç›‘ç£è¯å‘é‡è¯„åˆ†æ–¹æ³•ã€‚å€™é€‰å®ä½“-è°“è¯å¯¹ç”Ÿæˆåï¼Œåˆ©ç”¨æ·±åº¦CNNsæ¨¡å‹å¯¹å€™é€‰å®ä½“-è°“è¯å¯¹é‡æ–°æ’åºã€‚æ‰€æœ‰çš„ä¸­é—´åˆ†æ•°è¢«ç”¨æ¥é€‰æ‹©æœ€ç»ˆçš„é¢„æµ‹ç­”æ¡ˆã€‚</p><p>â€‹     ç”¨äºé¢„å¤„ç†NLPCCæ•°æ®é›†çš„è§„åˆ™å‡ ä¹ä¸ä¹‹å‰çš„å·¥ä½œç›¸åŒ(å‚è§[19]ä¸­çš„é™„å½•)ã€‚ä½†æ˜¯åœ¨å¤„ç†çŸ¥è¯†åº“æ—¶ï¼Œåˆ é™¤è§„åˆ™ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœä¸€ä¸ªé—®é¢˜çš„æ ¸å¿ƒè¡¨è¾¾æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæˆ‘ä»¬ä¼šæ·»åŠ å•è¯â€œintroductionâ€ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç³»ç»Ÿå°±ä¼šå°è¯•å¯¹è¿™ä¸ªå®ä½“è¿›è¡Œä»‹ç»ã€‚æ— è®ºå¦‚ä½•ï¼Œ7631ä¸ªé—®é¢˜ä¸­åªæœ‰26ä¸ªé—®é¢˜æ˜¯å—è¿™ä¸ªå¼•å¯¼æŠ€å·§å½±å“çš„ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/1.png" style="zoom:70%;"><h2 id="Entity-Linking"><a href="#Entity-Linking" class="headerlink" title="Entity Linking"></a>Entity Linking</h2><p>â€‹       ä¸€ä¸ªKBå®ä½“â€œæå¨œ(è·³æ°´è¿åŠ¨å‘˜)â€æ˜¯ç”±å®ä½“åç§°â€œæå¨œâ€å’Œå®ä½“è§£é‡Šâ€œè·³æ°´è¿åŠ¨å‘˜â€(æœ‰æ—¶ç¼ºå¸­)ç»„æˆçš„ã€‚é—®é¢˜çš„ä¸»é¢˜å®ä½“æ˜¯ç›¸åº”çŸ¥è¯†åº“æŸ¥è¯¢çš„æ ¸å¿ƒå®ä½“ï¼Œå®ä½“æåŠæ˜¯é—®é¢˜çš„å­ä¸²ï¼Œå®ƒåŒ…å«ä¸»é¢˜å®ä½“ã€‚å½“ä¸”ä»…å½“æåŠä¸ä¸»é¢˜å®ä½“ç›¸åŒï¼Œæˆ–åªæ˜¯åç§°ï¼Œæˆ–é€šä¿¡åœ¨æä¾›çš„æ–‡ä»¶â€œnlpcc-iccpol 2016.kbqa.kb.mention2idâ€ä¸­æåŠæ—¶ï¼Œå®ä½“æåŠåŒ…å«ä¸€ä¸ªä¸»é¢˜å®ä½“ã€‚å—[20]çš„å¯å‘ï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸€ç§åŸºäºç‰¹æ€§çš„GBDT(gradient boost decision tree)æ¥ä»æ‰€æœ‰å¯èƒ½çš„é—®é¢˜å­ä¸²ä¸­é€‰æ‹©æåˆ°çš„å®ä½“ã€‚</p><p>â€‹     ä¸ºäº†åŸ¹å…»ç›‘ç£å®ä½“é“¾æ¥æ¨¡å‹ï¼Œé»„é‡‘æåˆ°æ ‡ç­¾æ˜¯å…ˆå†³æ¡ä»¶ã€‚é»„é‡‘æç¤ºå¿…é¡»åŒ…å«ä¸€ä¸ªä¸é»„é‡‘ç­”æ¡ˆç›¸åŒçš„å¯¹è±¡çš„KBå®ä½“ã€‚ä¸ºäº†ä¿è¯é»„é‡‘æ ‡æ³¨çš„ç²¾åº¦ï¼Œé‡‡ç”¨äº†æåŠé—´çš„è¦†ç›–èŒƒå›´ã€æåŠé•¿åº¦å’Œä½ç½®ç­‰å¤šæ¡è§„åˆ™ï¼Œæ¯ä¸ªé—®é¢˜æœ€å¤šæœ‰ä¸€ä¸ªé»„é‡‘æ ‡æ³¨ã€‚ç»Ÿè®¡ç»“æœè§è¡¨1ã€‚äººå·¥æ£€æŸ¥ï¼Œå¤§å¤šæ•°è¢«æ’é™¤çš„å€™é€‰æåˆ°æ˜¯æœ‰ç¼ºé™·çš„ã€‚</p><p>â€‹    å®ä½“é“¾æ¥æ¨¡å‹æ‰€é‡‡ç”¨çš„æ‰€æœ‰ç‰¹æ€§å¦‚ä¸‹æ‰€ç¤ºï¼Œç±»ä¼¼äºä¹‹å‰[20]çš„é€æ°´å·¥ä½œã€‚ä½†æ²¡æœ‰è€ƒè™‘è¯æ€§ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†ç‰¹å¾éƒ½æœ‰å¤šä¸ªè§’åº¦ã€‚ç”±äºæˆ‘ä»¬æåˆ°çš„æ˜¯å­å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯è¿ç»­å•è¯ï¼Œè€Œæ˜¯æ±‰å­—ï¼Œå› æ­¤ä½¿ç”¨FMM(å‰å‘æœ€å¤§åŒ¹é…)æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå•è¯ï¼Œä½¿ç”¨RMM(åå‘æœ€å¤§åŒ¹é…)æŸ¥æ‰¾æœ€åä¸€ä¸ªå•è¯ã€‚GBDTæ¨¡å‹æ˜¯é’ˆå¯¹glodenæåˆ°çš„åŸºäºè¿™äº›ç‰¹æ€§çš„é—®é¢˜è¿›è¡Œè®­ç»ƒçš„ã€‚è®¾ç½®å’Œç»“æœåœ¨ç¬¬4èŠ‚ä¸­æ˜¾ç¤ºã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/2.png" style="zoom:70%;"><ul><li>ä½ç½®å’Œé•¿åº¦ã€‚æå­—å¤´ã€ä¸­é—´å’Œå°¾çš„ç»å¯¹å’Œç›¸å¯¹ä½ç½®ã€‚æåŠçš„ç»å¯¹é•¿åº¦å’Œç›¸å¯¹é•¿åº¦ã€‚æåˆ°çš„æ˜¯ä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„æ±‰å­—ã€‚</li><li>DFå¾—åˆ†ã€‚æ‰€æœ‰é—®é¢˜ä¸­æåˆ°çš„å­—ç¬¦ä¸²çš„IDFå¾—åˆ†ã€‚æ ¹æ®wikipedia 1ï¼Œæˆ‘ä»¬ä½¿ç”¨4ç§æ–¹æ³•è®¡ç®—IDFå¾—åˆ†ã€‚</li><li>å…¶ä»–ç‰¹æ€§ã€‚æåŠä¸­æ˜¯å¦æœ‰ä¸­æ–‡ï¼ŒæåŠæ˜¯å¦ç­‰åŒäºå®ä½“åç§°ï¼ŒæåŠæ˜¯å¦è¢«å…¶ä»–æåŠæ‰€è¦†ç›–ã€‚</li></ul><h2 id="Candidate-Predicates-Generation"><a href="#Candidate-Predicates-Generation" class="headerlink" title="Candidate Predicates Generation"></a>Candidate Predicates Generation</h2><p>â€‹     æˆ‘ä»¬ä½¿ç”¨ä¸[19]ç›¸åŒçš„æ–¹æ³•æ¥è¯„ä¼°é—®é¢˜æ¨¡å¼çš„è¯­ä¹‰æ˜¯å¦èƒ½è¦†ç›–è°“è¯(å‚è§eq 1)ï¼Œä½†åˆ é™¤äº†å¤§éƒ¨åˆ†æŠ€å·§ï¼Œå¦‚é—®é¢˜åˆ†ç±»å’Œé«˜é¢‘å®ä½“è¿‡æ»¤ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç§å˜ä½“(è§eq 2)æ¥è¯„ä»·è°“è¯çš„è¯­ä¹‰æ˜¯å¦èƒ½è¦†ç›–é—®é¢˜æ¨¡å¼ï¼Œå…¶ä¸­ave qæ˜¯æ‰€æœ‰é—®é¢˜ä¸­å•è¯çš„å¹³å‡å‘é‡ï¼Œç”¨äºåŒ¹é…åœæ­¢è¯ã€‚æœ¬èŠ‚çš„åˆ†è¯æ–¹æ³•ä¸[19]ç›¸åŒã€‚å› æ­¤ï¼Œæ‰€æœ‰ç–‘é—®å¥å’Œè°“è¯­ä¸­å¯èƒ½å‡ºç°çš„è¯éƒ½ä¼šè¢«è€ƒè™‘åœ¨å†…ã€‚å…³äºè¯¥åŸºäºè¯å‘é‡çš„è¯„ä»·æ–¹æ³•çš„è¯¦ç»†è¯´æ˜ä»¥åŠå¯¹æ‰€é€‰æ‹©çš„åˆ†è¯æ–¹æ³•çš„è®¨è®ºå¯ä»¥åœ¨[19]çš„3.2èŠ‚ä¸­æ‰¾åˆ°ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/3.png" style="zoom:67%;"><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/4.png" style="zoom:100%;"><p>â€‹     ä¸ºäº†åœ¨é‡æ–°æ’åºè¿‡ç¨‹ä¸­é™åˆ¶å€™é€‰å®ä½“-è°“è¯å¯¹çš„æ•°é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›ç‰¹å¾çš„çº¿æ€§ç»„åˆ(å‚è§eq 3)æ¥è¿‡æ»¤ä¸å¤ªå¯èƒ½çš„å€™é€‰ï¼Œç±»ä¼¼äºä¹‹å‰çš„å·¥ä½œ[19]ã€‚å…¶ä¸­l menè¡¨ç¤ºæ‰€æåˆ°çš„é•¿åº¦ï¼Œl preè¡¨ç¤ºæ‰€æåˆ°çš„é•¿åº¦ã€‚å¦‚æœä¸€ä¸ªå®ä½“æ¶‰åŠå¤šä¸ªå…·æœ‰ç›¸åŒè°“è¯çš„KBå®ä½“ï¼Œåˆ™åªè€ƒè™‘ç¬¬ä¸€ä¸ªå®ä½“çš„è°“è¯(æŒ‰KBæ–‡ä»¶ä¸­çš„å¤–è§‚æ’åº)ï¼Œå› æ­¤ä¸ä¼šç”Ÿæˆé‡å¤çš„å®ä½“-è°“è¯å¯¹ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/5.png" style="zoom:100%;"><h2 id="Deep-CNNs-Architecture"><a href="#Deep-CNNs-Architecture" class="headerlink" title="Deep CNNs Architecture"></a>Deep CNNs Architecture</h2><p>â€‹     é‡‡ç”¨æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œå¯¹å€™é€‰å®ä½“è°“è¯å¯¹è¿›è¡Œé‡æ–°æ’åºã€‚æäº¤ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ·±åº¦CNNsæ¨¡å‹çš„è¯¦ç»†æ¶æ„å¦‚å›¾2æ‰€ç¤ºã€‚è¯¥æ¨¡å‹è¯„ä¼°äº†é¢„å‘½é¢˜æ¨¡å¼ä¸é—®é¢˜æ¨¡å¼çš„ç›¸ä¼¼æ€§ï¼Œå³æœªæåŠå®ä½“çš„é—®é¢˜ã€‚ä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„è¯å‘é‡æ¥è¡¨ç¤ºè¾“å…¥ï¼Œç„¶åæ˜¯å‡ ä¸ªå·ç§¯å—(å›¾2ä¸­çš„2ä¸ªå·ç§¯å—)æ¥ç”Ÿæˆé«˜çº§ç‰¹å¾ã€‚ç„¶åï¼Œåœ¨æœ€å¤§æ± åŒ–å±‚ä¹‹åï¼Œé‡‡ç”¨element-wiseä¹˜æ³•æ¥ç»„åˆæ¥è‡ªé—®é¢˜å’Œè°“è¯çš„ç‰¹æ€§ã€‚æœ€åï¼Œä½¿ç”¨å¸¦dropoutçš„å¤šå±‚æ„ŸçŸ¥å™¨æ¥è¯„ä¼°æœ€ç»ˆçš„ç›¸ä¼¼åº¦ã€‚å·ç§¯å±‚çš„å‚æ•°åœ¨è°“è¯å’Œé—®é¢˜çš„å¤„ç†ä¹‹é—´å…±äº«ã€‚</p><p>â€‹     å—GoogLeNet[16]çš„å¯å‘ï¼Œåœ¨æ¯ä¸ªå·ç§¯å—ä¸­æœ‰å¤šä¸ªæ»¤æ³¢å™¨å®½åº¦(åœ¨å›¾2ä¸­ï¼Œ256ä¸ªå®½åº¦ä¸º1,512ä¸ªå®½åº¦ä¸º2çš„æ»¤æ³¢å™¨ï¼Œ256ä¸ªå®½åº¦ä¸º3çš„æ»¤æ³¢å™¨)ï¼Œåœ¨ResNet[15]ä¹‹åï¼Œç›¸é‚»å—ä¹‹é—´å­˜åœ¨æ®‹å·®è¿æ¥ã€‚å—æ›´æ·±çš„æ¨¡å‹å’Œè®¡ç®—èƒ½åŠ›å¸¦æ¥çš„æ± æ”¹è¿›çš„é™åˆ¶ï¼Œæäº¤ç‰ˆæœ¬åªæœ‰2å—.</p><h2 id="Ranking"><a href="#Ranking" class="headerlink" title="Ranking"></a>Ranking</h2><p>â€‹     é‡‡ç”¨æ‰€æœ‰ä¸­é—´åˆ†å€¼çš„çº¿æ€§ç»„åˆæ¥ç”Ÿæˆå€™é€‰ç­”æ¡ˆçš„æœ€ç»ˆæ’åã€‚è‡ªé«˜ç²¾åº¦å®ä½“è¿æ¥(3.1èŠ‚)å’Œå•ä¸€åŠŸèƒ½çš„è‰¯å¥½çš„æ€§èƒ½ç”±æ·±cnn(3.3èŠ‚)æˆ–åŸºäºè¯å‘é‡çš„æ–¹æ³•(3.2èŠ‚),ç»“åˆæ–¹ç¨‹æ˜¯éå¸¸ç²—ç•¥çš„ä¸ç²¾ç»†è°ƒæ•´(è§eq 4),ç”·æ€§,f,å’ŒS cnnå®ä½“æåˆ°åˆ†æ•°,entity-predicateå¯¹åŸºäºè¯å‘é‡æ–¹æ³•çš„è¯„ä¼°,è¯„ä¼°åˆ†åˆ«ç”±cnnå’Œè°“è¯ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/6.png" style="zoom:100%;"><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p>â€‹     æ•°æ®é›†ç”±NLPCC 2017è¯„ä¼°ä»»åŠ¡å‘å¸ƒï¼ŒåŒ…æ‹¬ä¸€ä¸ªçŸ¥è¯†åº“å’Œç”¨äºè®­ç»ƒå’Œæµ‹è¯•çš„é—®ç­”å¯¹ã€‚çŸ¥è¯†ä¸­å¤§çº¦æœ‰4300ä¸‡ä¸ªSPOå¯¹ï¼Œå…¶ä¸­æ¶‰åŠçº¦600ä¸‡ä¸ªä¸»é¢˜ã€60ä¸‡ä¸ªè°“è¯å’Œ1600ä¸‡ä¸ªå¯¹è±¡ã€‚2017-è®­ç»ƒé›†åŒ…å«14,609å¯¹2016-è®­ç»ƒè¯•é¢˜-ç­”æ¡ˆå’Œ9,870å¯¹2016-æµ‹è¯•è¯•é¢˜-ç­”æ¡ˆã€‚2017å¹´æµ‹è¯•é›†åŒ…å«7631å¯¹é—®ç­”ã€‚ç­”æ¡ˆç”±äººæ ‡è®°ï¼Œå¤§å¤šæ•°é—®é¢˜å¯ä»¥ç”±KBå¯¹è±¡å›ç­”ã€‚</p><h3 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h3><p>â€‹      æˆ‘ä»¬ç³»ç»Ÿä¸­çš„æ‰€æœ‰å•è¯å‘é‡ä¸ä¹‹å‰çš„å·¥ä½œ[19]ä¸­çš„å•è¯å‘é‡åˆ—è¡¨ç›¸åŒï¼Œè¯¥å·¥ä½œä½¿ç”¨äº†Tomas Mikolov 1ç”Ÿæˆçš„word2vectorå·¥å…·å’Œåœ¨Baidubaikeè¯­åº“ä¸Šè®­ç»ƒçš„CBOW[17]æ¨¡å‹ã€‚åˆ†è¯ä½¿ç”¨çš„è¯è¡¨ç”±è¯å‘é‡è¡¨ä¸­çš„æ‰€æœ‰è¯ç»„æˆã€‚</p><p>â€‹    GBDTå®ä½“é“¾æ¥æ¨¡å‹ä¸­ä½¿ç”¨çš„å‚æ•°ä¸º:max depth=8, eta=0.1, objective=reg:logistic, nrounds=100ã€‚åœ¨è®­ç»ƒCNNæ¨¡å‹æ—¶ï¼Œbatch sizeä¸º64,loss functionä¸ºbinary crossentropy, optimizerä¸ºadadelta[23]ã€‚æäº¤ç‰ˆæœ¬å·²ç»è®­ç»ƒäº†21ä¸ªepochï¼Œä½†æ˜¯ç›¸åŒè®¾ç½®ä¸‹æœ€å¥½çš„f1å¾—åˆ†å‡ºç°åœ¨7ä¸ªepochå®Œæˆæ—¶ï¼Œè¾¾åˆ°47.35%ã€‚CNNæ¨¡å‹ç”±keraså®ç°ã€‚</p><p>â€‹    åœ¨å®ä½“é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œåªæœ‰æ’åå‰ä¸‰ä¸”å¾—åˆ†é«˜äºæ’åå‰ä¸‰è€…æ„æ„¿0.01å€çš„æåŠï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„æåŠè¿‡æ»¤è§„åˆ™ã€‚åªæœ‰å‰20ä¸ªå€™é€‰çš„å®ä½“-è°“è¯å¯¹å°†è¢«ç”¨äºcnnã€‚</p><p>   é’ˆå¯¹ç½‘ç»œç¥ç»ç½‘ç»œåœ¨è®­ç»ƒæ—¶æ®µæ€§èƒ½ä¸ç¨³å®šçš„é—®é¢˜ï¼Œæå‡ºäº†ä¸€ç§é›†æˆå­¦ä¹ æ–¹æ³•ã€‚S cnnæ˜¯8ä¸ªcnnè¾“å‡ºçš„å¹³å‡å€¼ã€‚å…¶ä¸­4ä¸ªå…·æœ‰ä¸å›¾2ç›¸åŒçš„æ¶æ„ï¼Œå…¶ä»–çš„ä¸å›¾2ç›¸ä¼¼ï¼Œä½†åœ¨æ¯ä¸ªå·ç§¯å—ä¸­éƒ½æœ‰384ä¸ªå®½åº¦ä¸º1çš„è¿‡æ»¤å™¨å’Œ640ä¸ªå®½åº¦ä¸º2çš„è¿‡æ»¤å™¨ã€‚æ‰€æœ‰çš„CNNæ¨¡å‹åœ¨åˆå§‹åŒ–æ—¶éƒ½æœ‰ä¸åŒçš„ç§å­.</p><p>   è™½ç„¶åœ¨è®­ç»ƒCNNæ¨¡å‹ä¹‹å‰ï¼Œåœ¨ç”Ÿæˆå€™é€‰è°“è¯æ—¶ï¼Œå¤§éƒ¨åˆ†çš„è´Ÿå®ä½“-è°“è¯å¯¹å·²ç»è¢«è¿‡æ»¤æ‰äº†ï¼Œä½†æ˜¯æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„æ•°é‡ä»ç„¶æ˜¯ä¸å¹³è¡¡çš„ã€‚å› æ­¤é‡‡ç”¨äº†åŠ¨æ€è´Ÿé‡‡æ ·çš„æ–¹æ³•ã€‚è´Ÿçš„å®ä½“è°“è¯å¯¹P ep içš„å¯èƒ½æ€§å¦‚eq 5æ‰€ç¤ºï¼Œå…¶ä¸­æ’åep iæ˜¯è¯¥å®ä½“è°“è¯å¯¹åœ¨æœ€åä¸€æ¬¡è¿­ä»£ç»“æŸæ—¶å¾—åˆ†çš„é—®é¢˜çš„æ’åã€‚å®ƒå°±åƒä¸€ä¸ªç®€å•çš„ç”Ÿæˆå¯¹æŠ—æœºåˆ¶ï¼Œå…¶ä¸­ç”Ÿæˆæ¨¡å‹æ˜¯åˆ¤åˆ«æ¨¡å‹çš„æœ€åä¸€æ¬¡è¿­ä»£ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/7.png" style="zoom:100%;"><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p>â€‹      <img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/8.png" style="zoom:100%;"></p><p>â€‹      æˆ‘ä»¬çš„å®ä½“é“¾æ¥æ¨¡å‹çš„ç»“æœå¦‚è¡¨2æ‰€ç¤ºã€‚æˆ‘ä»¬ä½¿ç”¨5å€äº¤å‰éªŒè¯å¯¹2016å¹´å’Œ2017å¹´çš„è®­ç»ƒæ•°æ®é›†ä»¥åŠæ¯ä¸ªæµ‹è¯•æ•°æ®é›†ä¸ç›¸åº”çš„è®­ç»ƒæ•°æ®è¿›è¡Œæµ‹è¯•ã€‚Rec_filteræ˜¯æåŠè¿‡æ»¤å™¨è§„åˆ™çš„å¬å›ã€‚ä¸ä¹‹å‰[20]çš„å·¥ä½œç›¸æ¯”ï¼Œåœ¨2016å¹´çš„è®­ç»ƒæ•°æ®ä¸Šï¼Œæˆ‘ä»¬çš„æ¨¡å‹çš„å‡†ç¡®ç‡(98.75%)ç•¥ä½äºä»–ä»¬çš„he f1-score(99.04%)ã€‚ä½†ä»–ä»¬åªæ ‡æ³¨äº†14033ä¸ªé—®é¢˜ï¼Œè€Œæˆ‘ä»¬æ ‡æ³¨äº†14306ï¼Œæ•°æ®ä¸­çš„æ¯ä¸ªé—®é¢˜éƒ½åªæœ‰ä¸€ä¸ªé»„é‡‘æåŠã€‚å› æ­¤ï¼Œå“ªä¸€ç§æ¨¡å¼æ›´å¥½è¿˜ä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚</p><p>â€‹    å€™é€‰è°“è¯ç”Ÿæˆä¸€äº›è¯¦ç»†ä¿¡æ¯å¦‚è¡¨3æ‰€ç¤ºï¼ŒåŒ…æ‹¬é—®é¢˜æ•°é‡ã€æ¯ä¸ªé—®é¢˜æåˆ°çš„å€™é€‰è¯æ•°é‡å’Œæ¯ä¸ªé—®é¢˜å€™é€‰çŸ¥è¯†åº“ä¸‰å…ƒç»„çš„æ•°é‡ã€‚ç”±äº2017å¹´æµ‹è¯•æ•°æ®ä¸­æ’åå‰ä¸€çš„å®ä½“é“¾æ¥çš„å‡†ç¡®ç‡é™ä½ï¼Œå®ä½“è¿‡æ»¤å™¨åœ¨æ¯ä¸ªé—®é¢˜ä¸­è‡ªåŠ¨æŒæœ‰æ›´å¤šçš„å®ä½“æåŠã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/9.png" style="zoom:100%;"><p>â€‹     <img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/10.png" style="zoom:100%;"></p><p>â€‹          å¦å¤–ï¼ŒåŸºäºè¯å‘é‡çš„æ–¹æ³•åœ¨ä¸åŒè®¾ç½®ä¸‹å¯¹2016æµ‹è¯•é›†çš„ç»“æœå¦‚è¡¨4æ‰€ç¤ºã€‚Baselineæ˜¯NLPCC 2016 KBQAä»»åŠ¡[19]ä¸­æœ€å¥½çš„ç³»ç»Ÿã€‚ä½†æ˜¯ä¸ºäº†ä¸æˆ‘ä»¬çš„æ–¹æ³•è¿›è¡Œå…¬æ­£çš„æ¯”è¾ƒï¼Œå¯¹äºç›¸åŒçš„å®ä½“-è°“è¯å¯¹ï¼Œåªåº”ç­”ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤top-nç²¾åº¦(n&gt;1)å°†ä½äºæŠ¥å‘Šçš„ç²¾åº¦ã€‚baseline -rulesæ˜¯ä¸€ä¸ªæ²¡æœ‰é—®é¢˜åˆ†ç±»å’ŒåŸºäºæ¨¡å¼è®­ç»ƒç­‰æŠ€å·§çš„åŸºçº¿ç³»ç»Ÿï¼Œè¿™æ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„å®é™…åŸºçº¿ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™äº›è§„åˆ™åº”è¯¥è¢«CNNsè‡ªåŠ¨æ€»ç»“å‡ºæ¥ã€‚æ•´ä¸ªç³»ç»Ÿé‡‡ç”¨äº†å®ä½“é“¾æ¥è¿‡æ»¤å™¨å’ŒåŸºäºåå‘è¯å‘é‡çš„ç›¸ä¼¼åº¦æŸ¥è¯¢ã€‚ä»è¡¨4å¯ä»¥çœ‹å‡ºï¼Œå®ä½“é“¾æ¥å’Œåå‘ç›¸ä¼¼åº¦éƒ½å¯ä»¥æé«˜æ€§èƒ½ï¼Œå€™é€‰å®ä½“çš„é™åˆ¶å¯ä»¥å¤§å¹…åº¦æå‡pre@20ï¼Œè¿™æ˜¯CNNé‡æ–°æ’åºçš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡ã€‚</p><p>â€‹    CNNå¯¹æˆ‘ä»¬ä¸åŒæ·±åº¦çš„CNNæ¨¡å‹çš„2017æµ‹è¯•é›†çš„ç»“æœé‡æ–°æ’åºå¦‚è¡¨5æ‰€ç¤ºã€‚+s f &amp;s menä»£è¡¨ensemble CNNså’Œprevious featuresçš„ç»„åˆã€‚æ¯ä¸ªå—æœ‰1024ä¸ªè¿‡æ»¤å™¨ï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚ä¼¼ä¹è¶Šæ·±å…¥è¶Šèƒ½å¸¦æ¥ä¸ç¨³å®šçš„æ”¹å–„ã€‚ç”±äºè®¡ç®—èƒ½åŠ›çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¾ˆå¥½åœ°è°ƒæ•´æ»¤æ³¢å™¨æ•°é‡å’Œå—ç»“æ„ç­‰å‚æ•°ã€‚å› æ­¤ï¼Œæ·±å±‚æ¶æ„ä»æœ‰å¾ˆå¤§çš„æ½œåŠ›ã€‚æˆ‘ä»¬æäº¤æ¶æ„ä¸­æœ€å¥½çš„pre@1æ˜¯47.35%ï¼Œå®ƒåŒ…å«8ä¸ª2å—æ¨¡å‹ã€‚åœ¨2017å¹´æµ‹è¯•é›†ä¸Šï¼ŒåŸºäºå•è¯å‘é‡çš„ç‰¹å¾s få¯ä»¥è¾¾åˆ°43.10%ï¼Œå°†æ¸—é€ç‰¹å¾ä¸cnnç»“åˆå¾—åˆ°æ˜æ˜¾çš„æé«˜ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/11.png" style="zoom:100%;"><p>â€‹      æäº¤ä½“ç³»ç»“æ„çš„è¯¦ç»†ç»“æœå¦‚è¡¨6æ‰€ç¤ºã€‚CNNæ¨¡å‹è®­ç»ƒäº†2016å¹´æ•°æ®é›†çš„17ä¸ªepochå’Œ2017å¹´æ•°æ®é›†çš„7ä¸ªepochã€‚æ ¹æ®[19]ï¼Œå¦‚æœé€šè¿‡æ‰¾åˆ°æ­£ç¡®çš„å®ä½“-è°“è¯å¯¹æ¥åˆ¤æ–­æ€§èƒ½ï¼ŒåŸºçº¿ç³»ç»Ÿåœ¨2016æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡é«˜è¾¾85.61%ï¼Œè€Œæˆ‘ä»¬çš„ç³»ç»Ÿåœ¨2016æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º89.65%ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/12.png" style="zoom:100%;"><p>â€‹      NLPCC2017è¯„ä¼°ä»»åŠ¡æäº¤ç»“æœå¦‚è¡¨7æ‰€ç¤º(14æ¬¡æäº¤çš„å‰5åç»“æœ)ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨æ‰€æœ‰å›¢é˜Ÿä¸­å–å¾—äº†æœ€å¥½çš„æˆç»©ã€‚</p><h2 id="Upper-Bound-Analysis"><a href="#Upper-Bound-Analysis" class="headerlink" title="Upper Bound Analysis"></a>Upper Bound Analysis</h2><p>â€‹      æµ‹è¯•æ•°æ®é›†ä¸æ˜¯KBå¯¹è±¡ï¼Œå…¶ä¸­14%çš„ä¸»é¢˜å®ä½“æåˆ°çš„æ˜¯KBå®ä½“çš„åˆ«åï¼Œæ²¡æœ‰åœ¨æ–‡ä»¶â€œnlpcc-iccpol 2016.kbqa.kbä¸­æåŠã€‚mention2idâ€ï¼Œä½¿æˆ‘ä»¬çš„å®ä½“å–œæ¬¢æ–¹æ³•ä¸ä»–ä»¬æˆä¸ºæ— æ•ˆçš„ã€‚å› æ­¤ï¼Œåˆ«åé“¾æ¥ä¹Ÿéå¸¸é‡è¦ï¼Œé™¤äº†ç»™å®šçš„çŸ¥è¯†åº“ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ›´å¤šçš„ä¿¡æ¯ã€‚</p><img src="/2020/08/06/a-chinese-question-answering-system-for-single-relation-factoid-questions/13.png" style="zoom:100%;"><h3 id="Further-Experiments"><a href="#Further-Experiments" class="headerlink" title="Further Experiments"></a>Further Experiments</h3><p>â€‹    æˆ‘ä»¬ä¹Ÿåœ¨qaldæ•°æ®é›†2çš„ä¸€ä¸ªå­é›†ä¸Šåšäº†å®éªŒã€‚ç”±äºqaldä¸­çš„è®­ç»ƒæ•°æ®å¯¹äºæ·±åº¦CNNæ¨¡å‹æ¥è¯´ä¸å¤Ÿå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†ä»…é™s fçš„è®¾ç½®ï¼Œè¿™æ˜¯ä¸€ç§æ— ç›‘ç£çš„æ–¹æ³•ã€‚ä»qord -6 task 1çš„è®­ç»ƒé›†(åŒ…å«350ä¸ªé—®é¢˜çš„RDFæ•°æ®ä¸Šçš„å¤šè¯­è¨€é—®é¢˜å›ç­”)ä¸­é€‰å‡º78ä¸ªè‹±è¯­å•å…³ç³»factoidé—®é¢˜ï¼Œç³»ç»Ÿèƒ½æ­£ç¡®å›ç­”å…¶ä¸­çš„82%(64/78)ï¼Œè¯´æ˜è¯­è¨€ä¸æ˜¯ç³»ç»Ÿçš„é™åˆ¶ã€‚</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>â€‹     æœ¬æ–‡æå‡ºäº†ä¸€ä¸ªå¤æ‚çš„KBQAç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿç”±åŸºäºç‰¹å¾çš„å®ä½“å–œå¥½ã€åŸºäºè¯å‘é‡çš„å€™é€‰è°“è¯ç”Ÿæˆå’ŒåŸºäºæ·±åº¦cnnçš„é‡æ’åºæ–¹æ³•ç»„æˆï¼Œèƒ½å¤Ÿå›ç­”ç®€å•å…³ç³»çš„ä¸­æ–‡é—®é¢˜ã€‚é’ˆå¯¹CNNsè¾“å…¥çš„ä¸å¹³è¡¡ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç”Ÿæˆçš„å¯¹æŠ—æ–¹æ³•ï¼Œå¦‚è´Ÿé‡‡æ ·æ–¹æ³•ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿåœ¨NLPCC 2017å…±äº«ä»»åŠ¡5 (KBQAå­ä»»åŠ¡)ç«èµ›ä¸­è·å¾—ç¬¬ä¸€åã€‚æ–‡ä¸­è¿˜æ¼”ç¤ºäº†è¯¦ç»†çš„å®éªŒç»“æœï¼Œè¿™æœ‰åŠ©äºå…¶ä»–å¼€å‘äººå‘˜ç†è§£æˆ‘ä»¬çš„ç»„ä»¶æ‰€åšçš„è´¡çŒ®ã€‚åœ¨å°†æ¥ï¼Œæˆ‘ä»¬å°†æ‰©å±•æˆ‘ä»¬çš„ç³»ç»Ÿä»¥å›ç­”å¤šå…³ç³»é—®é¢˜ï¼Œå¹¶å°è¯•ç»„åˆæ¥è‡ªçŸ¥è¯†åº“ä¸‰å…ƒç»„å¯¹è±¡çš„ä¿¡æ¯ã€‚</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KBQA </tag>
            
            <tag> é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HMM - æ— ç›‘ç£</title>
      <link href="/2020/08/03/hmm/"/>
      <url>/2020/08/03/hmm/</url>
      
        <content type="html"><![CDATA[<h1 id="éšé©¬å°”ç§‘å¤«"><a href="#éšé©¬å°”ç§‘å¤«" class="headerlink" title="éšé©¬å°”ç§‘å¤«"></a>éšé©¬å°”ç§‘å¤«</h1><h2 id="ä¸¤ä¸ªå‡è®¾"><a href="#ä¸¤ä¸ªå‡è®¾" class="headerlink" title="ä¸¤ä¸ªå‡è®¾"></a>ä¸¤ä¸ªå‡è®¾</h2><ul><li>é½æ¬¡æ€§å‡è®¾ï¼Œï¼ˆçŠ¶æ€ä¸å‰ä¸€ä¸ªçŠ¶æ€æœ‰å…³ï¼‰</li><li>è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾ï¼Œè¾“å‡ºä»…ä¸å½“å‰çŠ¶æ€æœ‰å…³</li></ul><h2 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h2><ul><li><p>è¯„ä¼°é—®é¢˜ï¼šå·²çŸ¥æ¨¡å‹å‚æ•°$ Î»= (A, B, Ï€)$ï¼Œè®¡ç®—æŸä¸ªè§‚æµ‹åºåˆ—å‘ç”Ÿçš„æ¦‚ç‡ï¼Œå³æ±‚P(O|Î»)ï¼Œå³<strong>æ¦‚ç‡è®¡ç®—é—®é¢˜</strong>ï¼›</p><p><strong>å‰å‘-åå‘ç®—æ³•ï¼š</strong>ç»™å®šæ¨¡å‹$Î»=(A,B,Ï€)$å’Œè§‚æµ‹åºåˆ—$Q={q_1,q_2,â€¦,q_T}$ï¼Œè®¡ç®—æ¨¡å‹Î»ä¸‹è§‚æµ‹åˆ°åºåˆ—Qå‡ºç°çš„æ¦‚ç‡$P(Q|Î»)$ã€‚</p></li><li><p>å­¦ä¹ é—®é¢˜ï¼šå¦‚ä½•è°ƒæ•´æ¨¡å‹å‚æ•° $Î»=(Ï€, A, B)$ï¼Œä½¿å¾—$P(O|Î»)$æœ€å¤§ï¼Ÿ</p><p><strong>Baum-Welchç®—æ³•ï¼š</strong>å·²çŸ¥è§‚æµ‹åºåˆ—$Q={q_1,q_2,â€¦,q_T}$ï¼Œä¼°è®¡æ¨¡å‹$Î»=(A,B,Ï€)$çš„å‚æ•°ï¼Œä½¿å¾—åœ¨è¯¥æ¨¡å‹ä¸‹è§‚æµ‹åºåˆ—$P(Q|Î»)$æœ€å¤§ã€‚</p></li><li><p>è§£ç é—®é¢˜ï¼šç»™å‡ºè§‚æµ‹åºåˆ—Oå’Œæ¨¡å‹Î¼ï¼Œæ€æ ·é€‰æ‹©ä¸€ä¸ªéšè—çŠ¶æ€åºåˆ—S$s_1,s_2,â€¦{s}_{t+1}$ï¼Œèƒ½æœ€å¥½çš„è§£é‡Šè§‚æµ‹åºåˆ—Oï¼›</p><p><strong>Viterbiç®—æ³•ï¼š</strong>ç»™å®šæ¨¡å‹$Î»=(A,B,Ï€)$å’Œè§‚æµ‹åºåˆ—$Q={q_1,q_2,â€¦,q_T}$ï¼Œæ±‚ä½¿è§‚æµ‹åºåˆ—æ¡ä»¶æ¦‚ç‡$P(I|Qï¼ŒÎ»)$æœ€å¤§çš„çŠ¶æ€åºåˆ—Iã€‚</p></li></ul><h3 id="HMMçš„ç»„æˆ"><a href="#HMMçš„ç»„æˆ" class="headerlink" title="ï¼¨ï¼­ï¼­çš„ç»„æˆ"></a>ï¼¨ï¼­ï¼­çš„ç»„æˆ</h3><p>äº”å…ƒç»„ï¼š$\lambda = (N, M, A, B, pi)$</p><p>ç®€è®°ï¼š$\lambda = ( A, B, pi)$</p><p>Nï¼šçŠ¶æ€æ•°ç›®</p><p>ï¼­ï¼šå¯èƒ½çš„è§‚æµ‹æ•°ç›®</p><p>ï¼¡ï¼šä¸æ—¶é—´æ— å…³çš„çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ</p><p>ï¼¢ï¼šç»™å®šçŠ¶æ€ä¸‹ï¼Œè§‚æµ‹å€¼æ¦‚ç‡åˆ†å¸ƒ</p><p>piï¼šåˆå§‹çŠ¶æ€ç©ºé—´çš„æ¦‚ç‡åˆ†å¸ƒ</p><ul><li><p>å‰å‘ç®—æ³•</p><p>æ€æƒ³ï¼šé«˜æ•ˆé€’å½’å‘å‰å˜é‡ã€€ï¼Œä»¥æ±‚æœ€ç»ˆç»“æœ</p><p>å‰å‘å˜é‡ã€€$\alpha_t(i) = P(O_1, O_2,O_3â€¦.O_t, q_t=S_i|\lambda), 1&lt;= t &lt;= T$</p><p>åˆå§‹çŠ¶æ€ï¼š$\alpha _1(i) = pi _i b _i(O _1)$</p><p>é€’å½’ï¼š${\alpha}_{t+1}(j) = [\sum _{i=1}^{N}{\alpha} _{i}*{a} _{ij}] * {b} _{j}({O} _{t+1})$</p><p>ç»“æŸï¼š$P(O|\lambda) = \sum _{i=1}^{N}{\alpha} _{T}(i)$</p></li><li><p>åå‘ç®—æ³•</p><p>æ€æƒ³ï¼šä¸å‘å‰ç®—æ³•ç±»ä¼¼</p><p>åå‘å˜é‡ï¼š${\beta} _{t}(i) = P({O} _{1}{O} _{2}â€¦., {q} _{t}= {S} _{i} | \lambda)$</p><p>åˆå§‹çŠ¶æ€ã€€$\beta _T(i) = 1$</p><p>é€’å½’   ${\beta} _{i} = {\sum} _{i=j}^{N}{a} _{ij} * {b} _{j}({O} _{t+1}) * {\beta} _{t+1}(j)$</p><p>ç»“æŸ  $P(O|\lambda)=\pi_ib_i(o_1)\beta_1(i)$</p></li><li><p>viterbiç®—æ³•</p><p>ç›®æ ‡: ç»™å®šä¸€ä¸ªè§‚æµ‹åºåˆ—å’ŒHMMæ¨¡å‹,å¦‚ä½•æœ‰æ•ˆé€‰æ‹©â€æœ€ä¼˜â€çŠ¶æ€åºåˆ—,ä»¥â€æœ€å¥½çš„è§£é‡Šâ€è§‚å¯Ÿåºåˆ—</p><p>æ€æƒ³:åˆ©ç”¨åŠ¨æ€è§„åˆ’æ±‚è§£, å¤æ‚åº¦$O{N}^{2}T$</p><p>Viterbiå˜é‡  ${\delta} _{t}(i) = {\max} _{q1 â€¦qt-1}  P({q} _{1},  {q} _{2} â€¦.., {q} _{t} = {S} _{t}, {O} _{1} â€¦.. {O} _{t} | \lambda)$</p><p>é€’å½’  ${\delta} _{t+1}(i) = [{\max} _{j}{\delta} _{t}(j) * {\alpha} _{ij} ] * {b} _{i}({O} _{t+1})$</p><p>è·¯å¾„å˜é‡  $\varphi _t(i)$ è®°å½•æ¦‚ç‡æœ€å¤§çš„è·¯å¾„ä¸Šå½“å‰çŠ¶æ€çš„å‰ä¸€ä¸ªçŠ¶æ€</p></li></ul><h2 id="HMMä¸‰ä¸ªç®—æ³•çš„ä½œç”¨ï¼š"><a href="#HMMä¸‰ä¸ªç®—æ³•çš„ä½œç”¨ï¼š" class="headerlink" title="HMMä¸‰ä¸ªç®—æ³•çš„ä½œç”¨ï¼š"></a>HMMä¸‰ä¸ªç®—æ³•çš„ä½œç”¨ï¼š</h2><ul><li><p>forwardç®—æ³•ï¼šï¼ˆè¯„ä¼°ï¼‰ç»™å®šä¸€HMMæ¨¡å‹ï¼Œè®¡ç®—ä¸€è§‚å¯Ÿåºåˆ—<em>O1O2â€¦OLEN</em>å‡ºç°çš„æ¦‚ç‡ã€‚</p></li><li><p>viterbiç®—æ³•ï¼šï¼ˆè§£ç ï¼‰ç»™å®šä¸€HMMæ¨¡å‹ï¼Œè®¡ç®—ä¸€è§‚å¯Ÿåºåˆ—<em>O1O2â€¦OLEN</em>å¯¹åº”çš„æœ€å¯èƒ½çš„éšè—åºåˆ—<em>H1H2â€¦HLEN</em>åŠè¯¥éšè—åºåˆ—å‡ºç°çš„æ¦‚ç‡ã€‚</p></li><li><p>forward-backwardç®—æ³•ï¼šï¼ˆå­¦ä¹ ï¼‰ç»™å®šä¸€è§‚å¯Ÿåºåˆ—<em>O1O2â€¦OLENï¼Œ</em>æ±‚è§£èƒ½å¤Ÿæ‹Ÿåˆè¿™ä¸ªåºåˆ—çš„HMMæ¨¡å‹ã€‚</p></li></ul><h2 id="HMMä¸‰ä¸ªç®—æ³•ä¹‹é—´çš„å…³ç³»ï¼š"><a href="#HMMä¸‰ä¸ªç®—æ³•ä¹‹é—´çš„å…³ç³»ï¼š" class="headerlink" title="HMMä¸‰ä¸ªç®—æ³•ä¹‹é—´çš„å…³ç³»ï¼š"></a>HMMä¸‰ä¸ªç®—æ³•ä¹‹é—´çš„å…³ç³»ï¼š</h2><ul><li><p>forwardç®—æ³•ä¸­çš„forwardå˜é‡å°±æ˜¯forward-backforwardç®—æ³•ä¸­çš„forwardå˜é‡ï¼Œè€Œbackwardå˜é‡ä¸forwardå˜é‡æ˜¯ç±»ä¼¼çš„ï¼›</p></li><li><p>forward-backwardç®—æ³•æ˜¯ä¸ºäº†é€šè¿‡ç±»ä¼¼æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•æ‰¾åˆ°å±€éƒ¨æœ€ä¼˜çš„æ¨¡å‹å‚æ•°ï¼Œåœ¨è¿­ä»£è¿‡ç¨‹ä¸­forwardå˜é‡å’Œbackwardå˜é‡èµ·äº†å¾ˆå¤§ä½œç”¨ï¼›</p></li><li><p>viterbiç®—æ³•å’Œforwardç®—æ³•å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯forwardç®—æ³•è¿­ä»£è¿‡ç¨‹éœ€è¦çš„æ˜¯sumï¼Œviterbiç®—æ³•è¿­ä»£è¿‡ç¨‹éœ€è¦çš„æ˜¯maxï¼Œè€Œä¸”viterbiç®—æ³•é™¤äº†è¾“å‡ºæ¦‚ç‡ï¼Œè¿˜è¦ç”¨é€†æ¨è¿‡ç¨‹æ±‚è§£è·¯å¾„ï¼›</p></li><li><p>å½“ç”¨forward-backwardç®—æ³•æ±‚è§£å‡ºæ¨¡å‹å‚æ•°ä¹‹åï¼Œç”¨æˆ·ç»™å‡ºä¸€ä¸ªè§‚å¯Ÿåºåˆ—ï¼Œç”¨viterbiç®—æ³•å°±èƒ½æ±‚å‡ºæœ€å¯èƒ½çš„éšè—åºåˆ—ä»¥åŠæ¦‚ç‡äº†ã€‚ </p></li></ul><h2 id="HMMå®ç°åº“"><a href="#HMMå®ç°åº“" class="headerlink" title="HMMå®ç°åº“"></a>HMMå®ç°åº“</h2><p>hmmlearnå®ç°äº†ä¸‰ç§HMMæ¨¡å‹ç±»ï¼ŒæŒ‰ç…§è§‚æµ‹çŠ¶æ€æ˜¯è¿ç»­çŠ¶æ€è¿˜æ˜¯ç¦»æ•£çŠ¶æ€ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>è¿ç»­è§‚æµ‹çŠ¶æ€ï¼šGaussianHMMå’ŒGMMHMMï¼›</li><li>ç¦»æ•£è§‚æµ‹çŠ¶æ€ï¼šMultinomial</li></ul><p>githubï¼š<a href="https://github.com/hmmlearn/hmmlearn">https://github.com/hmmlearn/hmmlearn</a></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">class</span> <span class="token class-name">HMM</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Ann<span class="token punctuation">,</span> Bnm<span class="token punctuation">,</span> pi1n<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>A <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>Ann<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># çŠ¶æ€è½¬ç§»æ¦‚ç‡ NxN</span>        self<span class="token punctuation">.</span>B <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>Bnm<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># è§‚æµ‹æ¦‚ç‡çŸ©é˜µ NxM</span>        self<span class="token punctuation">.</span>pi <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>pi1n<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡ï¼Œ1xN</span>        self<span class="token punctuation">.</span>N <span class="token operator">=</span> self<span class="token punctuation">.</span>A<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#ç¬¬ä¸€ç»´é•¿åº¦ï¼ŒNç§çŠ¶æ€</span>        self<span class="token punctuation">.</span>M <span class="token operator">=</span> self<span class="token punctuation">.</span>B<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#ç¬¬äºŒç»´é•¿åº¦ï¼ŒMç§è§‚æµ‹ç»“æœ</span>    <span class="token keyword">def</span> <span class="token function">printhmm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================================="</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"HMM content: N ="</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">,</span> <span class="token string">",M ="</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>M<span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hmm.A "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" hmm.B "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"      "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"       "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hmm.pi"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=================================================="</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># å‡½æ•°åç§°ï¼šForward *åŠŸèƒ½ï¼šå‰å‘ç®—æ³•ä¼°è®¡å‚æ•° *å‚æ•°:phmm:æŒ‡å‘HMMçš„æŒ‡é’ˆ</span>    <span class="token comment" spellcheck="true"># T:è§‚å¯Ÿå€¼åºåˆ—çš„é•¿åº¦ O:è§‚å¯Ÿå€¼åºåˆ—</span>    <span class="token comment" spellcheck="true"># alpha:è¿ç®—ä¸­ç”¨åˆ°çš„ä¸´æ—¶æ•°ç»„ pprob:è¿”å›å€¼,æ‰€è¦æ±‚çš„æ¦‚ç‡</span>    <span class="token keyword">def</span> <span class="token function">Forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> pprob<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#     1. Initialization åˆå§‹åŒ–</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># åˆå§‹çŠ¶æ€ä¸ºiä¸”æ»¡è¶³O(0)çš„æ¦‚ç‡ï¼Œa|t=0ï¼ˆiï¼‰</span>            alpha<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#     2. Induction é€’å½’</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                sum <span class="token operator">=</span> <span class="token number">0.0</span>   <span class="token comment" spellcheck="true"># ä¸­é—´é‡</span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    sum <span class="token operator">+=</span> alpha<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>                alpha<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> sum <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#     3. Termination ç»ˆæ­¢</span>        sum <span class="token operator">=</span> <span class="token number">0.0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            sum <span class="token operator">+=</span> alpha<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">#   T-1æ—¶å€™çš„ç»ˆæ­¢æ€</span>        pprob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*=</span> sum   <span class="token comment" spellcheck="true"># sumæ˜¯æ‰€æœ‰å¯èƒ½ç»ˆæ­¢çŠ¶æ€çš„åŠ æƒå’Œ</span>    <span class="token comment" spellcheck="true"># å¸¦ä¿®æ­£çš„å‰å‘ç®—æ³•</span>    <span class="token comment" spellcheck="true"># scale[t] èµ°åˆ°ç¬¬tæ­¥éª¤æ—¶ï¼Œç¬¦åˆå‰å‘æ‰€æœ‰çŠ¶æ€çš„æ¦‚ç‡ï¼Œå°±æ˜¯tæ—¶åˆ»çš„Nç§çŠ¶æ€çš„åŠ æƒå’Œ</span>    <span class="token keyword">def</span> <span class="token function">ForwardWithScale</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> pprob<span class="token punctuation">)</span><span class="token punctuation">:</span>        scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>        <span class="token comment" spellcheck="true">#     1. Initialization</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            alpha<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> alpha<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            alpha<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">/=</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#     2. Induction</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            scale<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                sum <span class="token operator">=</span> <span class="token number">0.0</span>                <span class="token comment" spellcheck="true"># alpha[t + 1, j] ä½¿ç”¨äº†alpha[t, i]ï¼Œæ˜¯ä¸€ä¸ªä¸æ–­è¿­ä»£çš„è¿‡ç¨‹                </span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    sum <span class="token operator">+=</span> alpha<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>                alpha<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> sum <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                <span class="token comment" spellcheck="true"># scale[t] tæ—¶åˆ» æ»¡è¶³å‰å‘æ‰€æœ‰oï¼ˆtï¼‰çš„æ¦‚ç‡</span>                scale<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> alpha<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># alpha[t, j]æ˜¯tæ—¶åˆ»ï¼Œæ­¤çŠ¶æ€ä¸ºjçš„æ¦‚ç‡å¯èƒ½æ€§</span>                alpha<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/=</span> scale<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true">#     3. Termination</span>        <span class="token comment" spellcheck="true"># æ‰€æœ‰tæ—¶é—´çš„ä¿¡æ¯ç†µï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ   ä¸ºäº†æ±‚å–æå¤§ä¼¼ç„¶å‡½æ•°åšå‡†å¤‡ï¼Ÿ</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>            pprob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>scale<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#np.logä»¥eä¸ºåº•</span>    <span class="token comment" spellcheck="true"># å‡½æ•°åç§°ï¼šBackward * åŠŸèƒ½:åå‘ç®—æ³•ä¼°è®¡å‚æ•° * å‚æ•°:phmm:æŒ‡å‘HMMçš„æŒ‡é’ˆ</span>    <span class="token comment" spellcheck="true"># T:è§‚å¯Ÿå€¼åºåˆ—çš„é•¿åº¦ O:è§‚å¯Ÿå€¼åºåˆ—</span>    <span class="token comment" spellcheck="true"># beta:è¿ç®—ä¸­ç”¨åˆ°çš„ä¸´æ—¶æ•°ç»„ pprob:è¿”å›å€¼ï¼Œæ‰€è¦æ±‚çš„æ¦‚ç‡</span>    <span class="token keyword">def</span> <span class="token function">Backword</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> pprob<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#     1. Intialization</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># æœ€åä¸€ä¸ªä¸ºiæ—¶ï¼ŒPï¼ˆo(t=T)| iT=q(i))=1</span>            beta<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>        <span class="token comment" spellcheck="true">#     2. Induction</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment" spellcheck="true"># ä»æœ€åä¸€ä¸ªå¾€å‰æ•°åˆ°ç¬¬0ä¸ªï¼ˆstartï¼Œstopï¼Œstepï¼‰</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                sum <span class="token operator">=</span> <span class="token number">0.0</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    sum <span class="token operator">+=</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> beta<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>                beta<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> sum        <span class="token comment" spellcheck="true">#     3. Termination</span>        pprob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>        <span class="token comment" spellcheck="true"># æ‰€æœ‰æ»¡è¶³åºåˆ—çš„çŠ¶æ€å’Œï¼Œpprob[0]æ˜¯æ‰€æœ‰çš„åˆå§‹çŠ¶æ€</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            pprob<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> beta<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># å¸¦ä¿®æ­£çš„åå‘ç®—æ³•</span>    <span class="token keyword">def</span> <span class="token function">BackwardWithScale</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#     1. Intialization</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            beta<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>        <span class="token comment" spellcheck="true">#     2. Induction</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                sum <span class="token operator">=</span> <span class="token number">0.0</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    sum <span class="token operator">+=</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> beta<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span>                <span class="token comment" spellcheck="true"># æœ€ç»ˆç›®çš„æ˜¯æ±‚å¾—æ¯ç§çŠ¶æ€å tæ—¶åˆ»çš„æ¦‚ç‡å¤§å°ï¼Œæœ€ç»ˆæ€æ— æ‰€è°“çš„ï¼Ÿ</span>                beta<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> sum <span class="token operator">/</span> scale<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># Viterbiç®—æ³•</span>    <span class="token comment" spellcheck="true"># è¾“å…¥ï¼šAï¼ŒBï¼Œpi,O è¾“å‡ºP(O|lambda)æœ€å¤§æ—¶Poptimalçš„è·¯å¾„I</span>    <span class="token keyword">def</span> <span class="token function">viterbi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> O<span class="token punctuation">)</span><span class="token punctuation">:</span>        T <span class="token operator">=</span> len<span class="token punctuation">(</span>O<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># åˆå§‹åŒ–</span>        delta <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># deltaæ˜¯é’ˆå¯¹tæ—¶åˆ»ï¼Œt+1æ—¶åˆ»çš„æœ€ä¼˜è·¯å¾„çš„æ¦‚ç‡å€¼</span>        phi <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># è®°å½•</span>        I <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>T<span class="token punctuation">,</span> np<span class="token punctuation">.</span>int<span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># 0æ—¶åˆ» åˆæ€*å˜æˆBiï¼ˆO1ï¼‰æ—¶åˆ»çš„æ¦‚ç‡</span>            delta<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            phi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># é€’æ¨</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                delta<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>delta<span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span>                phi<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>delta<span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># ç»ˆç»“</span>        prob <span class="token operator">=</span> delta<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># Tæ—¶åˆ»çš„æœ€å¤§å€¼å¯¹åº”çš„çŠ¶æ€ æ˜¯ æœ€ä¼˜è·¯å¾„</span>        I<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> delta<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å–å¾—æœ€å¤§å€¼æ—¶ Tæ—¶åˆ»çš„å˜é‡</span>        <span class="token comment" spellcheck="true"># çŠ¶æ€åºåˆ—æ±‚å–ï¼Œä»æœ€å¤§å€¼å¾€å‰å€’æ¨</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            I<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> phi<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> I<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> I<span class="token punctuation">,</span> prob  <span class="token comment" spellcheck="true"># probæ˜¯æœ€ç»ˆæ—¶åˆ»çš„çŠ¶æ€</span>    <span class="token comment" spellcheck="true"># è®¡ç®—gamma : æ»¡è¶³è§‚æµ‹åºåˆ—ï¼Œåœ¨tæ—¶åˆ»å¤„äºçŠ¶æ€içš„æ¦‚ç‡  å‰å‘æ¦‚ç‡*åå‘æ¦‚ç‡ TxNçŸ©é˜µ</span>    <span class="token comment" spellcheck="true"># è¿”å›å€¼ gamma[T, N] äºŒç»´åˆ—è¡¨</span>    <span class="token keyword">def</span> <span class="token function">ComputeGamma</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>            denominator <span class="token operator">=</span> <span class="token number">0.0</span> <span class="token comment" spellcheck="true"># åˆ†æ¯</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> alpha<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> beta<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span>                denominator <span class="token operator">+=</span> gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> j<span class="token punctuation">]</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">/</span> denominator  <span class="token comment" spellcheck="true"># é™¤ä»¥æ€»æ¦‚ç‡</span>    <span class="token comment" spellcheck="true"># è®¡ç®—sai(i,j) ä¸ºç»™å®šè®­ç»ƒåºåˆ—Oå’Œæ¨¡å‹lambdaæ—¶ï¼š</span>    <span class="token comment" spellcheck="true"># tæ—¶åˆ» içŠ¶æ€ï¼Œt+1æ—¶åˆ» jçŠ¶æ€ åœ¨ä¸¤ä¸ªæ—¶åˆ»N*Nç§å¯èƒ½æ€§ä¸‹çš„æ¦‚ç‡</span>    <span class="token comment" spellcheck="true"># è¿”å›å€¼ xi[T, N, N]</span>    <span class="token keyword">def</span> <span class="token function">ComputeXi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">,</span> xi<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sum <span class="token operator">=</span> <span class="token number">0.0</span>            <span class="token comment" spellcheck="true"># tæ—¶åˆ»æ—¶å€™ï¼ŒæŠŠxiåºåˆ—å¡«æ»¡</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># å‰å‘xåå‘x içŠ¶æ€è½¬ç§»åˆ°jçŠ¶æ€çš„æ¦‚ç‡aij x ä¸‹ä¸€ä¸ªæ˜¾ç¤ºæˆO(t+1)çš„æ¦‚ç‡bj(o(t+1))</span>                    <span class="token comment" spellcheck="true"># t+1æ—¶åˆ»æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥ç›´æ¥ç”¨beta[t + 1, j]</span>                    xi<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> alpha<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> beta<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>j<span class="token punctuation">,</span> O<span class="token punctuation">[</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                    sum <span class="token operator">+=</span> xi<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>            <span class="token comment" spellcheck="true"># å½’ä¸€åŒ–</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    xi<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/=</span> sum    <span class="token comment" spellcheck="true"># Baum-Welchç®—æ³•</span>    <span class="token comment" spellcheck="true"># è¾“å…¥ Lä¸ªè§‚å¯Ÿåºåˆ—Oï¼Œåˆå§‹æ¨¡å‹ï¼šHMM=&amp;#123;A,B,pi,N,M&amp;#125;</span>    <span class="token keyword">def</span> <span class="token function">BaumWelch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> L<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#  åˆè¯•å‚æ•°</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Baum-Welch"</span><span class="token punctuation">)</span>        DELTA <span class="token operator">=</span> <span class="token number">0.01</span>        round <span class="token operator">=</span> <span class="token number">0</span>        flag <span class="token operator">=</span> <span class="token number">1</span>        probf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># åªæœ‰ probf[0]çš„æ€ªèƒ</span>        delta <span class="token operator">=</span> <span class="token number">0.0</span>        deltaprev <span class="token operator">=</span> <span class="token number">0.0</span>        probprev <span class="token operator">=</span> <span class="token number">0.0</span>        ratio <span class="token operator">=</span> <span class="token number">0.0</span>        deltaprev <span class="token operator">=</span> <span class="token number">10e</span><span class="token operator">-</span><span class="token number">70</span>        <span class="token comment" spellcheck="true">#  åˆå§‹åŒ–</span>        xi <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true"># 9x2x2</span>        pi <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 1x9</span>        denominatorA <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 1x2 åˆ†æ¯</span>        denominatorB <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 1x2</span>        numeratorA <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">,</span> self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 2x2  åˆ†å­</span>        numeratorB <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">,</span> self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># 2x2  NxM</span>        scale <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># 1x9</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            probf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>            <span class="token comment" spellcheck="true"># E - step</span>            <span class="token comment" spellcheck="true"># Lä¸ªé•¿åº¦ä¸ºTçš„è§‚æµ‹åºåˆ—ï¼Œç”±äºé½æ¬¡æ€§ï¼Œå¿½ç•¥æ—¶é—´tå‚æ•°å¯¹ lamda(A, B, pi)çš„å½±å“</span>            <span class="token keyword">for</span> l <span class="token keyword">in</span> range<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># self.ForwardWithScale(T, O[l], alpha, scale, probf)</span>                self<span class="token punctuation">.</span>Forward<span class="token punctuation">(</span>T<span class="token punctuation">,</span> O<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> probf<span class="token punctuation">)</span>                self<span class="token punctuation">.</span>Backword<span class="token punctuation">(</span>T<span class="token punctuation">,</span> O<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> beta<span class="token punctuation">,</span> probf<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># self.BackwardWithScale(T, O[l], beta, scale)</span>                self<span class="token punctuation">.</span>ComputeGamma<span class="token punctuation">(</span>T<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span>                self<span class="token punctuation">.</span>ComputeXi<span class="token punctuation">(</span>T<span class="token punctuation">,</span> O<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">,</span> xi<span class="token punctuation">)</span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> gamma<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># piåˆå§‹å€¼+0æ—¶åˆ»å¤„äºiçš„æ¦‚ç‡ï¼Œç”¨Lä¸ªåˆæ€åšä¿®æ­£</span>                    <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token comment" spellcheck="true"># Aå’ŒBæœ‰åŒºåˆ«å— ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</span>                        denominatorA<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># 1x2 æ»¡è¶³è§‚æµ‹åºåˆ—ï¼Œæ‰€æœ‰çŠ¶æ€ä¸ºiçš„æ¦‚ç‡</span>                        denominatorB<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># 1x2</span>                    denominatorB<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> gamma<span class="token punctuation">[</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># BåŠ ä¸Šäº†æœ€åä¸€ä¸ªçš„çŠ¶æ€</span>                    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            numeratorA<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> xi<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># æ»¡è¶³è§‚æµ‹åºåˆ—ï¼Œä»iåˆ°jçš„æ¦‚ç‡</span>                    <span class="token keyword">for</span> k <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># æ‰€æœ‰åºåˆ—ä¸­ï¼Œæ»¡è¶³çš„ä¸ªæ•°</span>                            <span class="token keyword">if</span> O<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">==</span> k<span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># è§‚æµ‹åºåˆ—tä¸­ æˆ‘ä»¬æ­£åœ¨è€ƒå¯Ÿçš„é‚£ä¸ª</span>                                numeratorB<span class="token punctuation">[</span>i<span class="token punctuation">,</span> k<span class="token punctuation">]</span> <span class="token operator">+=</span> gamma<span class="token punctuation">[</span>t<span class="token punctuation">,</span> i<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># ç”±äºiçŠ¶æ€ å¯¼è‡´ è§‚æµ‹ä¸ºk çš„æ¦‚ç‡ï¼</span>            <span class="token comment" spellcheck="true"># M - step</span>            <span class="token comment" spellcheck="true"># é‡ä¼° pi çŠ¶æ€è½¬ç§»çŸ©é˜µA å’Œ è§‚å¯Ÿæ¦‚ç‡çŸ©é˜µB</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">## 0.001 / self.N å¹³æ»‘</span>                self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>N <span class="token operator">+</span> <span class="token number">0.999</span> <span class="token operator">*</span> pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> L  <span class="token comment" spellcheck="true"># pi[i]åœ¨E-stepç®—äº† Læ¬¡</span>                <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># è¿™é‡Œä¸ç”¨ç®¡ï¼Œå› ä¸ºnumeratorA[i, j] å’Œ denominatorA[i] éƒ½ç®—äº† Læ¬¡</span>                    self<span class="token punctuation">.</span>A<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>N <span class="token operator">+</span> <span class="token number">0.999</span> <span class="token operator">*</span> numeratorA<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">/</span> denominatorA<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                    numeratorA<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>  <span class="token comment" spellcheck="true"># ä¸ºäº†ä¸‹ä¸€è½®çš„è¿­ä»£</span>                <span class="token keyword">for</span> k <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>M<span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>B<span class="token punctuation">[</span>i<span class="token punctuation">,</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.001</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>M <span class="token operator">+</span> <span class="token number">0.999</span> <span class="token operator">*</span> numeratorB<span class="token punctuation">[</span>i<span class="token punctuation">,</span> k<span class="token punctuation">]</span> <span class="token operator">/</span> denominatorB<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                    numeratorB<span class="token punctuation">[</span>i<span class="token punctuation">,</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>                <span class="token comment" spellcheck="true"># ä¸ºäº†ä¸‹ä¸€è½®çš„è¿­ä»£çš„åˆå§‹åŒ–</span>                pi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> denominatorA<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> denominatorB<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span>            <span class="token comment" spellcheck="true"># Flagå†³å®šæ­¤æ¬¡è¿­ä»£ï¼Œç›´æ¥ä¸‹ä¸€æ¬¡è¿­ä»£</span>            <span class="token comment" spellcheck="true"># æ²¡æœ‰æ›´æ–°å‚æ•°ï¼Ÿ A[i, j]ï¼ŒB[i, k]ï¼Œpi[i]åœ¨ä¸Šé¢å·²ç»æ›´æ–°å®Œäº†</span>            <span class="token comment" spellcheck="true"># æ²¡æœ‰æŠŠæ›´æ–°çš„å‚æ•°ä¿å­˜ä¸‹æ¥</span>            <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>      <span class="token comment" spellcheck="true"># æ²¡æœ‰æ›´æ–°å‚æ•°ï¼Ÿ</span>                flag <span class="token operator">=</span> <span class="token number">0</span>                probprev <span class="token operator">=</span> probf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                ratio <span class="token operator">=</span> <span class="token number">1</span>                <span class="token keyword">continue</span>            delta <span class="token operator">=</span> probf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> probprev  <span class="token comment" spellcheck="true"># æ›´æ–°çš„å¤§å°</span>            ratio <span class="token operator">=</span> delta <span class="token operator">/</span> deltaprev   <span class="token comment" spellcheck="true"># å’Œä¸Šä¸€æ¬¡ç›¸æ¯”æ›´æ–°çš„é€Ÿç‡</span>            probprev <span class="token operator">=</span> probf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># ä¸Šä¸€æ¬¡å‚æ•°å­˜å‚¨ä¸€è½®</span>            deltaprev <span class="token operator">=</span> delta      <span class="token comment" spellcheck="true"># ä¸Šä¸€æ¬¡æ›´æ–°å¤§å°å­˜å‚¨ä¸‹æ¥å—ã€‚ã€‚ã€‚ã€‚</span>            round <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token comment" spellcheck="true"># ratio æ›´æ–°ç‡å°äºé˜ˆå€¼ 0.01ï¼Œç»“æŸEMè¿­ä»£</span>            <span class="token keyword">if</span> ratio <span class="token operator">&lt;=</span> DELTA<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Num iterationï¼š "</span><span class="token punctuation">,</span> round<span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Python my HMM"</span><span class="token punctuation">)</span>    A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.8125</span><span class="token punctuation">,</span> <span class="token number">0.1875</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.875</span><span class="token punctuation">,</span> <span class="token number">0.125</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    pi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>    hmm <span class="token operator">=</span> HMM<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> pi<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># N=2ï¼Œ2ä¸ªçŠ¶æ€ï¼› M=2ï¼Œ2ç§è§‚æµ‹ç»“æœ</span>    O <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    L <span class="token operator">=</span> len<span class="token punctuation">(</span>O<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true"># L=3</span>    T <span class="token operator">=</span> len<span class="token punctuation">(</span>O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># T=9ï¼Œæ—¶é—´é•¿åº¦åºåˆ—ä¸º9ï¼Ÿ</span>    alpha <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> hmm<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># 9x2</span>    beta <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> hmm<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>    gamma <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span> hmm<span class="token punctuation">.</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float<span class="token punctuation">)</span>    hmm<span class="token punctuation">.</span>BaumWelch<span class="token punctuation">(</span>L<span class="token punctuation">,</span> T<span class="token punctuation">,</span> O<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span>    a <span class="token operator">=</span> hmm<span class="token punctuation">.</span>viterbi<span class="token punctuation">(</span>O<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    hmm<span class="token punctuation">.</span>printhmm<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="å‚è€ƒè¯´æ˜"><a href="#å‚è€ƒè¯´æ˜" class="headerlink" title="å‚è€ƒè¯´æ˜"></a>å‚è€ƒè¯´æ˜</h2><p><a href="https://www.bilibili.com/video/BV1MW41167Rf?from=search&amp;seid=13221277013126441324">ç™½æ¿è§†é¢‘</a></p><p><a href="https://blog.csdn.net/YZXnuaa/article/details/79525488">å‚è€ƒ1</a></p><p><a href="https://wenku.baidu.com/view/2f0d944769eae009581bec04.html">å‚è€ƒ2</a></p><p><a href="https://www.cnblogs.com/liuerdou/p/11332428.html">å‚è€ƒ3</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½åå®ä½“ </tag>
            
            <tag> åºåˆ—æ ‡æ³¨ </tag>
            
            <tag> é©¬å°”ç§‘å¤« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HMM - æœ‰ç›‘ç£</title>
      <link href="/2020/08/03/hmm-you-jian-du/"/>
      <url>/2020/08/03/hmm-you-jian-du/</url>
      
        <content type="html"><![CDATA[<h1 id="éšé©¬å°”ç§‘å¤«"><a href="#éšé©¬å°”ç§‘å¤«" class="headerlink" title="éšé©¬å°”ç§‘å¤«"></a>éšé©¬å°”ç§‘å¤«</h1><p>æœªå®Œ,å¾…ç»­â€¦â€¦â€¦..</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> utils <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span class="token keyword">class</span> <span class="token class-name">HMM_NER</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> char2idx_path<span class="token punctuation">,</span> tag2idx_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># è½½å…¥ä¸€äº›å­—å…¸</span>        <span class="token comment" spellcheck="true"># char2idx: å­— è½¬æ¢ä¸º token</span>        self<span class="token punctuation">.</span>char2idx <span class="token operator">=</span> load_dict<span class="token punctuation">(</span>char2idx_path<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># tag2idx: æ ‡ç­¾è½¬æ¢ä¸º token</span>        self<span class="token punctuation">.</span>tag2idx <span class="token operator">=</span> load_dict<span class="token punctuation">(</span>tag2idx_path<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># idx2tag: tokenè½¬æ¢ä¸ºæ ‡ç­¾</span>        self<span class="token punctuation">.</span>idx2tag <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;v: k for k, v in self.tag2idx.items()&amp;#125;</span>        <span class="token comment" spellcheck="true"># åˆå§‹åŒ–éšçŠ¶æ€æ•°é‡(å®ä½“æ ‡ç­¾æ•°)å’Œè§‚æµ‹æ•°é‡(å­—æ•°)</span>        self<span class="token punctuation">.</span>tag_size <span class="token operator">=</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tag2idx<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> max<span class="token punctuation">(</span><span class="token punctuation">[</span>v <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>char2idx<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># åˆå§‹åŒ–A, B, piä¸ºå…¨0</span>        self<span class="token punctuation">.</span>transition <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_size<span class="token punctuation">,</span>                                    self<span class="token punctuation">.</span>tag_size<span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>emission <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_size<span class="token punctuation">,</span>                                  self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>pi <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tag_size<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># åç½®, ç”¨æ¥é˜²æ­¢log(0)æˆ–ä¹˜0çš„æƒ…å†µ</span>        self<span class="token punctuation">.</span>epsilon <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">8</span>    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_dic_path<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        fitç”¨æ¥è®­ç»ƒHMMæ¨¡å‹        :param train_dic_path: è®­ç»ƒæ•°æ®ç›®å½•        """</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"initialize training..."</span><span class="token punctuation">)</span>        train_dic <span class="token operator">=</span> load_data<span class="token punctuation">(</span>train_dic_path<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># ä¼°è®¡è½¬ç§»æ¦‚ç‡çŸ©é˜µ, å‘å°„æ¦‚ç‡çŸ©é˜µå’Œåˆå§‹æ¦‚ç‡çŸ©é˜µçš„å‚æ•°</span>        self<span class="token punctuation">.</span>estimate_transition_and_initial_probs<span class="token punctuation">(</span>train_dic<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>estimate_emission_probs<span class="token punctuation">(</span>train_dic<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># take the logarithm</span>        <span class="token comment" spellcheck="true"># å–logé˜²æ­¢è®¡ç®—ç»“æœä¸‹æº¢</span>        self<span class="token punctuation">.</span>pi <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>transition <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>self<span class="token punctuation">.</span>transition<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>emission <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>self<span class="token punctuation">.</span>emission<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"DONE!"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">estimate_emission_probs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        å‘å°„çŸ©é˜µå‚æ•°çš„ä¼°è®¡        estimate p( Observation | Hidden_state )        :param train_dic:        :return:        """</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"estimating emission probabilities..."</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> dic <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>train_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> char<span class="token punctuation">,</span> tag <span class="token keyword">in</span> zip<span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dic<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>emission<span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag2idx<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">,</span>                              self<span class="token punctuation">.</span>char2idx<span class="token punctuation">[</span>char<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>        self<span class="token punctuation">.</span>emission<span class="token punctuation">[</span>self<span class="token punctuation">.</span>emission <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>epsilon        self<span class="token punctuation">.</span>emission <span class="token operator">/=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>emission<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">estimate_transition_and_initial_probs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        è½¬ç§»çŸ©é˜µå’Œåˆå§‹æ¦‚ç‡çš„å‚æ•°ä¼°è®¡, ä¹Ÿå°±æ˜¯bigramäºŒå…ƒæ¨¡å‹        estimate p( Y_t+1 | Y_t )        :param train_dic:        :return:        """</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"estimating transition and initial probabilities..."</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> dic <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>train_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i<span class="token punctuation">,</span> tag <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag2idx<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>                curr_tag <span class="token operator">=</span> self<span class="token punctuation">.</span>tag2idx<span class="token punctuation">[</span>tag<span class="token punctuation">]</span>                next_tag <span class="token operator">=</span> self<span class="token punctuation">.</span>tag2idx<span class="token punctuation">[</span>dic<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                self<span class="token punctuation">.</span>transition<span class="token punctuation">[</span>curr_tag<span class="token punctuation">,</span> next_tag<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>        self<span class="token punctuation">.</span>transition<span class="token punctuation">[</span>self<span class="token punctuation">.</span>transition <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>epsilon        self<span class="token punctuation">.</span>transition <span class="token operator">/=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>transition<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>pi<span class="token punctuation">[</span>self<span class="token punctuation">.</span>pi <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>epsilon        self<span class="token punctuation">.</span>pi <span class="token operator">/=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_p_Obs_State</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> char<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># è®¡ç®—p( observation | state)</span>        <span class="token comment" spellcheck="true"># å¦‚æœå½“å‰å­—å±äºæœªçŸ¥, åˆ™è®²p( observation | state)è®¾ä¸ºå‡åŒ€åˆ†å¸ƒ</span>        char_token <span class="token operator">=</span> self<span class="token punctuation">.</span>char2idx<span class="token punctuation">.</span>get<span class="token punctuation">(</span>char<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> char_token <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tag_size<span class="token punctuation">)</span><span class="token operator">/</span>self<span class="token punctuation">.</span>tag_size<span class="token punctuation">)</span>        <span class="token keyword">return</span> np<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>emission<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> char_token<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># é¢„æµ‹å¹¶æ‰“å°å‡ºé¢„æµ‹ç»“æœ</span>        <span class="token comment" spellcheck="true"># ç»´ç‰¹æ¯”ç®—æ³•è§£ç </span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">"è¾“å…¥æ–‡æœ¬ä¸ºç©º!"</span><span class="token punctuation">)</span>        best_tag_id <span class="token operator">=</span> self<span class="token punctuation">.</span>viterbi_decode<span class="token punctuation">(</span>text<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>print_func<span class="token punctuation">(</span>text<span class="token punctuation">,</span> best_tag_id<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">print_func</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">,</span> best_tags_id<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ç”¨æ¥æ‰“å°é¢„æµ‹ç»“æœ</span>        <span class="token keyword">for</span> char<span class="token punctuation">,</span> tag_id <span class="token keyword">in</span> zip<span class="token punctuation">(</span>text<span class="token punctuation">,</span> best_tags_id<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>char<span class="token operator">+</span><span class="token string">"_"</span><span class="token operator">+</span>self<span class="token punctuation">.</span>idx2tag<span class="token punctuation">[</span>tag_id<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"|"</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">viterbi_decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        ç»´ç‰¹æ¯”è§£ç , è¯¦è§è§†é¢‘æ•™ç¨‹æˆ–æ–‡å­—ç‰ˆæ•™ç¨‹        :param text: ä¸€æ®µæ–‡æœ¬string        :return: æœ€å¯èƒ½çš„éšçŠ¶æ€è·¯å¾„        """</span>        <span class="token comment" spellcheck="true"># å¾—åˆ°åºåˆ—é•¿åº¦</span>        seq_len <span class="token operator">=</span> len<span class="token punctuation">(</span>text<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># åˆå§‹åŒ–T1å’ŒT2è¡¨æ ¼</span>        T1_table <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tag_size<span class="token punctuation">]</span><span class="token punctuation">)</span>        T2_table <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>seq_len<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tag_size<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># å¾—åˆ°ç¬¬1æ—¶åˆ»çš„å‘å°„æ¦‚ç‡</span>        start_p_Obs_State <span class="token operator">=</span> self<span class="token punctuation">.</span>get_p_Obs_State<span class="token punctuation">(</span>text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># è®¡ç®—ç¬¬ä¸€æ­¥åˆå§‹æ¦‚ç‡, å¡«å…¥è¡¨ä¸­</span>        T1_table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>pi <span class="token operator">+</span> start_p_Obs_State        T2_table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> seq_len<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># ç»´ç‰¹æ¯”ç®—æ³•åœ¨æ¯ä¸€æ—¶åˆ»è®¡ç®—è½åˆ°æ¯ä¸€ä¸ªéšçŠ¶æ€çš„æœ€å¤§æ¦‚ç‡å’Œè·¯å¾„</span>            <span class="token comment" spellcheck="true"># å¹¶æŠŠä»–ä»¬æš‚å­˜èµ·æ¥</span>            <span class="token comment" spellcheck="true"># è¿™é‡Œç”¨åˆ°äº†çŸ©é˜µåŒ–è®¡ç®—æ–¹æ³•, è¯¦è§è§†é¢‘æ•™ç¨‹</span>            p_Obs_State <span class="token operator">=</span> self<span class="token punctuation">.</span>get_p_Obs_State<span class="token punctuation">(</span>text<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            p_Obs_State <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>p_Obs_State<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>            prev_score <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>T1_table<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># å¹¿æ’­ç®—æ³•, å‘å°„æ¦‚ç‡å’Œè½¬ç§»æ¦‚ç‡å¹¿æ’­ + è½¬ç§»æ¦‚ç‡</span>            curr_score <span class="token operator">=</span> prev_score <span class="token operator">+</span> self<span class="token punctuation">.</span>transition <span class="token operator">+</span> p_Obs_State            <span class="token comment" spellcheck="true"># å­˜å…¥T1 T2ä¸­</span>            T1_table<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>curr_score<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>            T2_table<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>curr_score<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># å›æº¯</span>        best_tag_id <span class="token operator">=</span> int<span class="token punctuation">(</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>T1_table<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        best_tags <span class="token operator">=</span> <span class="token punctuation">[</span>best_tag_id<span class="token punctuation">,</span> <span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>seq_len<span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            best_tag_id <span class="token operator">=</span> int<span class="token punctuation">(</span>T2_table<span class="token punctuation">[</span>i<span class="token punctuation">,</span> best_tag_id<span class="token punctuation">]</span><span class="token punctuation">)</span>            best_tags<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_tag_id<span class="token punctuation">)</span>        <span class="token keyword">return</span> list<span class="token punctuation">(</span>reversed<span class="token punctuation">(</span>best_tags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> HMM_NER<span class="token punctuation">(</span>char2idx_path<span class="token operator">=</span><span class="token string">"./dicts/char2idx.json"</span><span class="token punctuation">,</span>                    tag2idx_path<span class="token operator">=</span><span class="token string">"./dicts/tag2idx.json"</span><span class="token punctuation">)</span>    model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token string">"./corpus/train_data.txt"</span><span class="token punctuation">)</span>    model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token string">"æˆ‘åœ¨ä¸­å›½åƒç¾å›½çš„é¢åŒ…"</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘½åå®ä½“ </tag>
            
            <tag> åºåˆ—æ ‡æ³¨ </tag>
            
            <tag> é©¬å°”ç§‘å¤« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastText</title>
      <link href="/2020/07/26/fasttext/"/>
      <url>/2020/07/26/fasttext/</url>
      
        <content type="html"><![CDATA[<h1 id="Fasttext"><a href="#Fasttext" class="headerlink" title="Fasttext"></a>Fasttext</h1><p>Paper:<a href="https://arxiv.org/pdf/1607.01759.pdf">Bag of Tricks for Efficient Text Classification(2016)</a></p><p>code:<a href="https://gitee.com/daiyizheng/nlp/blob/master/1-3FastText/FastText-torch.py">Torch</a></p><h2 id="Fasttext-ç‰¹ç‚¹"><a href="#Fasttext-ç‰¹ç‚¹" class="headerlink" title="Fasttext ç‰¹ç‚¹"></a>Fasttext ç‰¹ç‚¹</h2><ol><li>æ¨¡å‹ç®€å•ï¼Œåªæœ‰ä¸€å±‚çš„éšå±‚ä»¥åŠè¾“å‡ºå±‚ï¼Œå› æ­¤è®­ç»ƒé€Ÿåº¦éå¸¸å¿«</li><li>ä¸éœ€è¦è®­ç»ƒè¯å‘é‡ï¼ŒFasttextè‡ªå·±ä¼šè®­ç»ƒ</li><li>ä¸¤ä¸ªä¼˜åŒ–ï¼šHierarchical Softmaxã€N-gram</li></ol><h2 id="Fasttextæ¨¡å‹æ¶æ„"><a href="#Fasttextæ¨¡å‹æ¶æ„" class="headerlink" title="Fasttextæ¨¡å‹æ¶æ„"></a>Fasttextæ¨¡å‹æ¶æ„</h2><p>ã€€ã€€fastTextæ¨¡å‹æ¶æ„å’Œword2vecä¸­çš„CBOWå¾ˆç›¸ä¼¼ï¼Œ ä¸åŒä¹‹å¤„æ˜¯fastTexté¢„æµ‹æ ‡ç­¾è€ŒCBOWé¢„æµ‹çš„æ˜¯ä¸­é—´è¯ï¼Œå³æ¨¡å‹æ¶æ„ç±»ä¼¼ä½†æ˜¯æ¨¡å‹çš„ä»»åŠ¡ä¸åŒã€‚</p><h3 id="CBOWæ¶æ„"><a href="#CBOWæ¶æ„" class="headerlink" title="CBOWæ¶æ„"></a>CBOWæ¶æ„</h3><p><img src="/2020/07/26/fasttext/2.png" alt="CBOW"></p><p>ã€€ã€€word2vecå°†ä¸Šä¸‹æ–‡å…³ç³»è½¬åŒ–ä¸ºå¤šåˆ†ç±»ä»»åŠ¡ï¼Œè¿›è€Œè®­ç»ƒé€»è¾‘å›å½’æ¨¡å‹ï¼Œè¿™é‡Œçš„ç±»åˆ«æ•°é‡|V|è¯åº“å¤§å°ã€‚</p><p>é€šå¸¸çš„æ–‡æœ¬æ•°æ®ä¸­ï¼Œè¯åº“å°‘åˆ™æ•°ä¸‡ï¼Œå¤šåˆ™ç™¾ä¸‡ï¼Œåœ¨è®­ç»ƒä¸­ç›´æ¥è®­ç»ƒå¤šåˆ†ç±»é€»è¾‘å›å½’å¹¶ä¸ç°å®ã€‚</p><p>word2vecä¸­æä¾›äº†ä¸¤ç§é’ˆå¯¹å¤§è§„æ¨¡å¤šåˆ†ç±»é—®é¢˜çš„ä¼˜åŒ–æ‰‹æ®µï¼Œ negative sampling å’Œhierarchical softmaxã€‚</p><p>åœ¨ä¼˜åŒ–ä¸­ï¼Œnegative sampling åªæ›´æ–°å°‘é‡è´Ÿé¢ç±»ï¼Œä»è€Œå‡è½»äº†è®¡ç®—é‡ã€‚</p><p>hierarchical softmax å°†è¯åº“è¡¨ç¤ºæˆå‰ç¼€æ ‘ï¼Œä»æ ‘æ ¹åˆ°å¶å­çš„è·¯å¾„å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—äºŒåˆ†ç±»å™¨ï¼Œä¸€æ¬¡å¤šåˆ†ç±»è®¡ç®—çš„å¤æ‚åº¦ä»|V|é™ä½åˆ°äº†æ ‘çš„é«˜åº¦ã€‚æ•´ä½“çš„å¤æ‚åº¦ä»ã€‚</p><h3 id="Fasttextæ¶æ„"><a href="#Fasttextæ¶æ„" class="headerlink" title="Fasttextæ¶æ„"></a>Fasttextæ¶æ„</h3><p><img src="/2020/07/26/fasttext/3.png" alt="Fasttext"></p><p>ã€€ã€€ã€€fastTextæ¨¡å‹æ¶æ„:å…¶ä¸­$x _1,x _2,â€¦,x _{Nâˆ’1},x _N$è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬ä¸­çš„n-gramå‘é‡ï¼Œæ¯ä¸ªç‰¹å¾æ˜¯è¯å‘é‡çš„å¹³å‡å€¼ã€‚è¿™å’Œå‰æ–‡ä¸­æåˆ°çš„cbowç›¸ä¼¼ï¼Œcbowç”¨ä¸Šä¸‹æ–‡å»é¢„æµ‹ä¸­å¿ƒè¯ï¼Œè€Œæ­¤å¤„ç”¨å…¨éƒ¨çš„n-gramå»é¢„æµ‹æŒ‡å®šç±»åˆ«ã€‚</p><ul><li>[Math Processing Error] ä¸€ä¸ªå¥å­çš„ç‰¹å¾ï¼Œåˆå§‹å€¼ä¸ºéšæœºç”Ÿæˆ(ä¹Ÿå¯ä»¥é‡‡ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡)</li><li>hidden:$X _i$çš„å¹³å‡å€¼ <em>x</em></li><li>output: æ ·æœ¬æ ‡ç­¾</li></ul><h4 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h4><p><img src="/2020/07/26/fasttext/4.png"></p><p>N:æ ·æœ¬ä¸ªæ•°</p><p>$y _n$:ç¬¬nä¸ªæ ·æœ¬å¯¹åº”çš„ç±»åˆ«</p><p>f:æŸå¤±å‡½æ•°softmaxt</p><p>$x _n$:ç¬¬nä¸ªæ ·æœ¬çš„å½’ä¸€åŒ–ç‰¹å¾</p><p>Aï¼šæƒé‡çŸ©é˜µï¼ˆæ„å»ºè¯ï¼Œembeddingï¼‰</p><p>Bï¼šæƒé‡ä¸¾è¯ï¼ˆéšå±‚åˆ°è¾“å‡ºå±‚ï¼‰</p><p>è¯å‘é‡åˆå§‹åŒ–</p><p>ä¸€ä¸ªå¥å­çš„embeddingä¸º[$iw _1,iw _2,â€¦.iw _n,ow _1,ow _2,â€¦ow _s$]</p><p> $iw _i$:è¯­æ–™ä¸­å‡ºç°çš„è¯ï¼Œæ’åœ¨æ•°ç»„çš„å‰é¢</p><p>$ow _i$:n-gramæˆ–n-charç‰¹å¾</p><p>åˆå§‹åŒ–ä¸ºéšæœºæ•°, å¦‚æœæä¾›é¢„è®­ç»ƒçš„è¯å‘é‡ï¼Œå¯¹åº”çš„è¯é‡‡ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</p><h4 id="å±‚æ¬¡softmax"><a href="#å±‚æ¬¡softmax" class="headerlink" title="å±‚æ¬¡softmax"></a>å±‚æ¬¡softmax</h4><p><img src="/2020/07/26/fasttext/5.png"></p><p>â€‹    å½“è¯­æ–™ç±»åˆ«è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨hierarchical Softmax(hs)å‡è½»è®¡ç®—é‡ hsåˆ©ç”¨Huffman æ ‘å®ç°ï¼Œè¯(ç”Ÿæˆè¯å‘é‡)æˆ–label(åˆ†ç±»é—®é¢˜)ä½œä¸ºå¶å­èŠ‚ç‚¹ æ ¹æ®è¯æˆ–labelçš„countæ„å»ºHuffman æ ‘ï¼Œåˆ™å¶å­åˆ°rootä¸€å®šå­˜åœ¨ä¸€æ¡è·¯å¾„åˆ©ç”¨é€»è¾‘å›å½’äºŒåˆ†ç±»è®¡ç®—loss</p><h3 id="n-gramå’Œn-char"><a href="#n-gramå’Œn-char" class="headerlink" title="n-gramå’Œn-char"></a>n-gramå’Œn-char</h3><p>Fasttextæ–¹æ³•ä¸åŒä¸word2vecæ–¹æ³•ï¼Œå¼•å…¥äº†ä¸¤ç±»ç‰¹å¾å¹¶è¿›è¡Œembeddingã€‚å…¶ä¸­n-gramé¢—ç²’åº¦æ˜¯è¯ä¸è¯ä¹‹é—´ï¼Œn-charæ˜¯å•ä¸ªè¯ä¹‹é—´ã€‚ä¸¤ç±»ç‰¹å¾çš„å­˜å‚¨å‡é€šè¿‡è®¡ç®—hashå€¼çš„æ–¹æ³•å®ç°ã€‚ </p><p>n-gram</p><p>ç¤ºä¾‹: who am I? n-gramè®¾ç½®ä¸º2</p><p>n-gramç‰¹å¾æœ‰ï¼Œwho, who am, am, am I, I<br>n-char<br>ç¤ºä¾‹: where, n=3, è®¾ç½®èµ·æ­¢ç¬¦&lt;, &gt;<br>n-charç‰¹å¾æœ‰ï¼Œ&lt;wh, whe, her, ere, er&gt;</p><h2 id="FastTextè¯å‘é‡ä¸word2vecå¯¹æ¯”"><a href="#FastTextè¯å‘é‡ä¸word2vecå¯¹æ¯”" class="headerlink" title="FastTextè¯å‘é‡ä¸word2vecå¯¹æ¯”"></a>FastTextè¯å‘é‡ä¸word2vecå¯¹æ¯”</h2><ul><li>æ¨¡å‹çš„è¾“å‡ºå±‚ <ul><li>word2vecçš„è¾“å‡ºå±‚ï¼Œå¯¹åº”ä¸‹ä¸€ä¸ªå•è¯çš„æ¦‚ç‡æœ€å¤§å€¼ï¼›fasttextçš„è¾“å‡ºå±‚æ˜¯åˆ†ç±»çš„label</li></ul></li><li>æ¨¡å‹çš„è¾“å…¥å±‚ï¼š<ul><li>word2vecçš„è¾“å…¥å±‚ï¼Œæ˜¯ context window å†…çš„wordï¼›è€Œfasttext å¯¹åº”çš„æ•´ä¸ªsentenceçš„å†…å®¹ï¼ŒåŒ…æ‹¬wordï¼Œä¹ŸåŒ…æ‹¬ n-gramçš„å†…å®¹ï¼›</li></ul></li></ul><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> fasttext<span class="token comment" spellcheck="true">## 1 is positive, 0 is negative</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'train.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__1 i love you\n'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__1 he loves me\n'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__1 she likes baseball\n'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__0 i hate you\n'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__0 sorry for that\n'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'__label__0 this is awful'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'sorry hate you'</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## è®­ç»ƒ</span>trainDataFile <span class="token operator">=</span> <span class="token string">'train.txt'</span>classifier <span class="token operator">=</span> fasttext<span class="token punctuation">.</span>train_supervised<span class="token punctuation">(</span>    input<span class="token operator">=</span>trainDataFile<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">## æ–‡ä»¶è¾“å…¥</span>    label_prefix<span class="token operator">=</span><span class="token string">'__label__'</span><span class="token punctuation">,</span>ã€€<span class="token comment" spellcheck="true">## labelå‰ç¼€</span>    dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"># è¯å‘é‡ç»´åº¦</span>    epoch<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>ã€€<span class="token comment" spellcheck="true">## epochæ¬¡æ•°</span>    lr<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>ã€€<span class="token comment" spellcheck="true"># å­¦ä¹ ç‡</span>    lr_update_rate<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#ã€€å¤šå°‘æ­¥æ›´æ–°å­¦ä¹ ç‡</span>    min_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># æœ€å°‘çš„å•è¯å‡ºç°æ¬¡æ•°</span>    loss<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">,</span>ã€€<span class="token comment" spellcheck="true">## loss function &amp;#123;ns, hs, softmax&amp;#125; [softmax] </span>    word_ngrams<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>ã€€<span class="token comment" spellcheck="true"># n-gram çª—å£å¤§å°</span>    bucket<span class="token operator">=</span><span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">## å¶å­æ•°</span><span class="token comment" spellcheck="true">## ä¿å­˜æ¨¡å‹</span>classifier<span class="token punctuation">.</span>save_model<span class="token punctuation">(</span><span class="token string">"Model.bin"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æµ‹è¯•é›†æµ‹è¯•</span>testDataFile <span class="token operator">=</span> <span class="token string">'test.txt'</span>classifier <span class="token operator">=</span> fasttext<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">'Model.bin'</span><span class="token punctuation">)</span>result <span class="token operator">=</span> classifier<span class="token punctuation">.</span>test<span class="token punctuation">(</span>testDataFile<span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'æµ‹è¯•é›†ä¸Šæ•°æ®é‡'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'æµ‹è¯•é›†ä¸Šå‡†ç¡®ç‡'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'æµ‹è¯•é›†ä¸Šå¬å›ç‡'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>res <span class="token operator">=</span> classifier<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>text<span class="token operator">=</span>testDataFile<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><h2 id="Fasttext-å‚æ•°"><a href="#Fasttext-å‚æ•°" class="headerlink" title="Fasttext å‚æ•°"></a>Fasttext å‚æ•°</h2><pre class=" language-shell"><code class="language-shell">The following arguments are mandatory:  -input              training file path  -output             output file pathThe following arguments are optional:  -verbose            verbosity level [2]The following arguments for the dictionary are optional:  -minCount           minimal number of word occurrences [1]  -minCountLabel      minimal number of label occurrences [0]  -wordNgrams         max length of word ngram [1]  -bucket             number of buckets [2000000]  -minn               min length of char ngram [0]  -maxn               max length of char ngram [0]  -t                  sampling threshold [0.0001]  -label              labels prefix [__label__]The following arguments for training are optional:  -lr                 learning rate [0.1]  -lrUpdateRate       change the rate of updates for the learning rate [100]  -dim                size of word vectors [100]  -ws                 size of the context window [5]  -epoch              number of epochs [5]  -neg                number of negatives sampled [5]  -loss               loss function &#123;ns, hs, softmax&#125; [softmax]  -thread             number of threads [12]  -pretrainedVectors  pretrained word vectors for supervised learning []  -saveOutput         whether output params should be saved [0]The following arguments for quantization are optional:  -cutoff             number of words and ngrams to retain [0]  -retrain            finetune embeddings if a cutoff is applied [0]  -qnorm              quantizing the norm separately [0]  -qout               quantizing the classifier [0]  -dsub               size of each sub-vector [2]</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡æœ¬åˆ†ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CRF</title>
      <link href="/2020/07/25/crf/"/>
      <url>/2020/07/25/crf/</url>
      
        <content type="html"><![CDATA[<h1 id="CRF"><a href="#CRF" class="headerlink" title="CRF"></a>CRF</h1><h2 id="CRF-èƒ½åšä»€ä¹ˆ"><a href="#CRF-èƒ½åšä»€ä¹ˆ" class="headerlink" title="CRF èƒ½åšä»€ä¹ˆ"></a>CRF èƒ½åšä»€ä¹ˆ</h2><p>â€‹     CRFæ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¨¡å‹ã€‚æˆ‘ä»¬è¿™é‡Œåªè®¨è®ºLinear Chain CRFæ¨¡å‹ï¼Œä¸æ¶‰åŠæ›´generalçš„CRFæ¨¡å‹ã€‚å¤§éƒ¨åˆ†æ—¶å€™åŒå­¦ä»¬èƒ½å¤Ÿæ¥è§¦åˆ°çš„CRFæ¨¡å‹éƒ½æ˜¯Linear Chain CRFã€‚æ˜¯ä¸€ä¸ªåºåˆ—åŒ–æ ‡æ³¨ç®—æ³•ï¼ˆsequence labeling algorithmï¼‰ï¼Œæ¥æ”¶ä¸€ä¸ªè¾“å…¥åºåˆ—å¦‚ $X = (x _1, x _2,â€¦. x _n)$ å¹¶ä¸”è¾“å‡ºç›®æ ‡åºåˆ—$Y = (y _1, y _2,â€¦. y _n)$ ã€‚</p><h2 id="CRFä¸å…¶ä»–"><a href="#CRFä¸å…¶ä»–" class="headerlink" title="CRFä¸å…¶ä»–"></a>CRFä¸å…¶ä»–</h2><p>éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHidden Markov Modelï¼ŒHMMï¼‰ï¼Œæœ€å¤§ç†µé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆMaximum Entropy Markov Modelï¼ŒMEMMï¼‰ä»¥åŠæ¡ä»¶éšæœºåœºï¼ˆConditional Random Fieldï¼ŒCRFï¼‰æ˜¯åºåˆ—æ ‡æ³¨ä¸­æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€åŸºæœ¬çš„ä¸‰ä¸ªæ¨¡å‹ã€‚</p><p>HMMé¦–å…ˆå‡ºç°ï¼ŒMEMMå…¶æ¬¡ï¼ŒCRFæœ€åã€‚ä¸‰ä¸ªç®—æ³•ä¸»è¦æ€æƒ³å¦‚ä¸‹ï¼š</p><p>1ï¼‰HMMæ¨¡å‹æ˜¯å¯¹è½¬ç§»æ¦‚ç‡å’Œè¡¨ç°æ¦‚ç‡ç›´æ¥å»ºæ¨¡ï¼Œç»Ÿè®¡å…±ç°æ¦‚ç‡ï¼ŒHMMå°±æ˜¯å…¸å‹çš„æ¦‚ç‡æœ‰å‘å›¾ï¼Œå…¶å°±æ˜¯æ¦‚ç‡æœ‰å‘å›¾çš„è®¡ç®—æ¦‚ç‡æ–¹å¼ã€‚</p><p>2ï¼‰MEMMæ¨¡å‹æ˜¯å¯¹è½¬ç§»æ¦‚ç‡å’Œè¡¨ç°æ¦‚ç‡å»ºç«‹è”åˆæ¦‚ç‡ï¼Œç»Ÿè®¡æ—¶ç»Ÿè®¡çš„æ˜¯æ¡ä»¶æ¦‚ç‡ï¼Œä½†MEMMå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼Œæ˜¯å› ä¸ºMEMMåªåœ¨å±€éƒ¨åšå½’ä¸€åŒ–ã€‚</p><p>3ï¼‰CRFæ¨¡å‹ä¸­ï¼Œç»Ÿè®¡äº†å…¨å±€æ¦‚ç‡ï¼Œåœ¨ åšå½’ä¸€åŒ–æ—¶ï¼Œè€ƒè™‘äº†æ•°æ®åœ¨å…¨å±€çš„åˆ†å¸ƒï¼Œè€Œä¸æ˜¯ä»…ä»…åœ¨å±€éƒ¨å½’ä¸€åŒ–ï¼Œè¿™æ ·å°±è§£å†³äº†MEMMä¸­çš„æ ‡è®°åç½®ï¼ˆlabel biasï¼‰çš„é—®é¢˜ã€‚</p><p><strong>æœ¬è´¨ä¸Šï¼ŒCRFæœ‰ä»¥ä¸‹ä¸‰ä¸ªä¼˜ç‚¹ï¼š</strong></p><p>1ï¼‰ä¸HMMæ¯”è¾ƒï¼ŒCRFæ²¡æœ‰HMMé‚£æ ·ä¸¥æ ¼çš„ç‹¬ç«‹æ€§å‡è®¾æ¡ä»¶ï¼Œå› è€Œå¯ä»¥å®¹çº³ä»»æ„çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ç‰¹å¾è®¾è®¡çµæ´»ï¼ˆä¸MEä¸€æ ·ï¼‰ </p><p>2ï¼‰ä¸ä¸MEMMæ¯”è¾ƒï¼Œç”±äºCRFè®¡ç®—å…¨å±€æœ€ä¼˜è¾“å‡ºèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡ï¼Œå®ƒè¿˜å…‹æœäº†æœ€å¤§ç†µé©¬å°”å¯å¤«æ¨¡å‹æ ‡è®°åç½®ï¼ˆLabel-biasï¼‰çš„ç¼ºç‚¹ã€‚ Â­Â­</p><p>3ï¼‰CRFæ˜¯åœ¨ç»™å®šéœ€è¦æ ‡è®°çš„è§‚å¯Ÿåºåˆ—çš„<strong>æ¡ä»¶ä¸‹</strong>ï¼Œè®¡ç®—æ•´ä¸ªæ ‡è®°åºåˆ—çš„è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œè€Œä¸æ˜¯åœ¨ç»™å®šå½“å‰çŠ¶æ€æ¡ä»¶ä¸‹ï¼Œå®šä¹‰ä¸‹ä¸€ä¸ªçŠ¶æ€çš„çŠ¶æ€åˆ†å¸ƒã€‚å‡¡äº‹éƒ½æœ‰ä¸¤é¢ï¼Œæ­£ç”±äºè¿™äº›ä¼˜ç‚¹ï¼ŒCRFéœ€è¦è®­ç»ƒçš„å‚æ•°æ›´å¤šï¼Œä¸MEMMå’ŒHMMç›¸æ¯”ï¼Œå®ƒå­˜åœ¨è®­ç»ƒä»£ä»·å¤§ã€å¤æ‚åº¦é«˜çš„ç¼ºç‚¹ã€‚ </p><h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><p>â€‹      ç›®å‰åºåˆ—æ ‡æ³¨çš„ä½¿ç”¨æ–¹æ³•: HMMã€CRFã€LSTM/Bi-LSTMã€LSTM/Bi-LSTM+CRF</p><p>â€‹      é‡‡ç”¨Bi-LSTM+CRFå°±æ˜¯ç»“åˆäº†Bi-LSTMçš„ç‰¹å¾è¡¨è¾¾èƒ½åŠ›ä¸CRFçš„æ— å‘å›¾ç”Ÿæˆæ¨¡å‹çš„ä¼˜ç‚¹ï¼Œæˆä¸ºç»å…¸å°±æ˜¯å¿…ç„¶ã€‚å…¶å…¸å‹æ¶æ„å¦‚ä¸‹å›¾ï¼š</p>   <img src="/2020/07/25/crf/1.jpg" style="zoom:80%;"><p> æ³¨ï¼šåœ¨Bi-LSTM+CRFæ¶æ„ä¸­ï¼ŒCRFæœ€ç»ˆçš„è®¡ç®—åŸºäºçŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µå’Œå‘å°„æ¦‚ç‡çŸ©é˜µ(å‡æŒ‡éå½’ä¸€åŒ–æ¦‚ç‡)ã€‚è€ŒBi-LSTMçš„è¾“å‡ºå°±å……å½“äº†ä¸Šè¿°å‘å°„æ¦‚ç‡çŸ©é˜µçš„è§’è‰²ã€‚</p><h2 id="åŸç†è§£æ"><a href="#åŸç†è§£æ" class="headerlink" title="åŸç†è§£æ"></a>åŸç†è§£æ</h2><p>â€‹       ç›´æ¥åˆ©ç”¨LSTMè¿›è¡Œåºåˆ—æ ‡æ³¨ã€‚ä½†æ˜¯è¿™æ ·çš„åšæ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>æ¯ä¸ªæ—¶åˆ»çš„è¾“å‡ºæ²¡æœ‰è€ƒè™‘ä¸Šä¸€æ—¶åˆ»çš„è¾“å‡ºã€‚</strong>ä»¥â€œæˆ‘ å–œæ¬¢ è·‘æ­¥â€ä¸ºä¾‹ï¼ŒLSTMè¾“å‡ºâ€œå–œæ¬¢â€çš„æ ‡ç­¾æ˜¯â€œåŠ¨è¯â€ï¼Œè€Œâ€œè·‘æ­¥â€çš„æ ‡ç­¾å¯èƒ½ä¹Ÿæ˜¯â€œåŠ¨è¯â€ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œâ€œåè¯â€æ ‡ç­¾æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºâ€œè·‘æ­¥â€è¿™é‡Œæ˜¯ä¸€é¡¹è¿åŠ¨ã€‚ä¹Ÿå°±æ˜¯â€œåŠ¨è¯â€+â€œåè¯â€è¿™ä¸ªè§„åˆ™å¹¶æ²¡æœ‰è¢«LSTMæ¨¡å‹æ•æ‰åˆ°ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™æ ·ä½¿ç”¨LSTM<strong>æ— æ³•å¯¹æ ‡ç­¾è½¬ç§»å…³ç³»è¿›è¡Œå»ºæ¨¡</strong>ã€‚<strong>CRFæœ‰ä¸¤ç±»ç‰¹å¾å‡½æ•°ï¼Œä¸€ç±»æ˜¯é’ˆå¯¹è§‚æµ‹åºåˆ—ä¸çŠ¶æ€çš„å¯¹åº”å…³ç³»ï¼ˆå¦‚â€œæˆ‘â€ä¸€èˆ¬æ˜¯â€œåè¯â€ï¼‰ï¼Œä¸€ç±»æ˜¯é’ˆå¯¹çŠ¶æ€é—´å…³ç³»ï¼ˆå¦‚â€œåŠ¨è¯â€åä¸€èˆ¬è·Ÿâ€œåè¯â€ï¼‰ã€‚åœ¨LSTM+CRFæ¨¡å‹ä¸­ï¼Œå‰ä¸€ç±»ç‰¹å¾å‡½æ•°çš„è¾“å‡ºç”±LSTMçš„è¾“å‡ºæ›¿ä»£ï¼Œåä¸€ç±»ç‰¹å¾å‡½æ•°å°±å˜æˆäº†æ ‡ç­¾è½¬ç§»çŸ©é˜µ</strong>ã€‚</p><h2 id="æ ‡ç­¾çš„scoreå’ŒæŸå¤±å‡½æ•°çš„å®šä¹‰"><a href="#æ ‡ç­¾çš„scoreå’ŒæŸå¤±å‡½æ•°çš„å®šä¹‰" class="headerlink" title="æ ‡ç­¾çš„scoreå’ŒæŸå¤±å‡½æ•°çš„å®šä¹‰"></a>æ ‡ç­¾çš„scoreå’ŒæŸå¤±å‡½æ•°çš„å®šä¹‰</h2><p>Bi-LSTM æœ€åè¾“å‡ºä¸€èˆ¬æ˜¯ï¼»batch_size,seq_len, target_sizeï¼½ï¼Œtarget_sizeç›¸å½“äºæ˜¯æ¯ä¸ªè¯æ˜ å°„åˆ°tagçš„å‘å°„æ¦‚ç‡å€¼ï¼Œè®¾Bi-LSTMçš„è¾“å‡ºçŸ©é˜µä¸º${P} _{ij}$ä»£è¡¨è¯$w _i$æ˜ å°„åˆ°$tag _j$çš„éå½’ä¸€åŒ–æ¦‚ç‡ã€‚å¯¹äºCRFæ¥è¯´ï¼Œæˆ‘ä»¬å‡å®šå­˜åœ¨ä¸€ä¸ªè½¬ç§»çŸ©é˜µ${A} _{ij}$ï¼Œä»£è¡¨$tag _i$è½¬ç§»åˆ°$tag _j$çš„è½¬ç§»æ¦‚ç‡ã€‚ å¯¹äºè¾“å…¥åºåˆ— <strong>X</strong> å¯¹åº”çš„è¾“å‡ºtagåºåˆ— yï¼Œå®šä¹‰åˆ†æ•°ä¸º</p><p>$s(X, y) = {\sum} ^{n} _{i=0}{A} _{ {y} _{i+1} , y _i} + {\sum} ^{n} _{i=0}{P} _{i, y _i}$</p><p>åˆ©ç”¨Softmaxå‡½æ•°ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªæ­£ç¡®çš„tagåºåˆ—yå®šä¹‰ä¸€ä¸ªæ¦‚ç‡å€¼ï¼ˆ$\widetilde { Y } $ä»£è¡¨æ‰€æœ‰çš„tagåºåˆ—ï¼ŒåŒ…æ‹¬ä¸å¯èƒ½å‡ºç°çš„ï¼‰</p><p>$P(y|X) = \frac { {e} ^{s(X, y)} }{ {\sum} _{\widetilde { Y } \in {Y} _{X}}{ {e} ^{s(X, \widetilde { Y })} } } $</p><p>å› è€Œåœ¨è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€å¤§åŒ–ä¼¼ç„¶æ¦‚ç‡p(y|X)å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å¯¹æ•°ä¼¼ç„¶</p><p>$log(p(y|X)) = log(\frac { {e} ^{s(X, y)} }{ {\sum} _{\widetilde { Y } \in {Y} _{X}}{ {e} ^{s(X, \widetilde { Y })} } }) = S(X, y) - log({ {\sum} _{\widetilde { Y } \in {Y} _{X}}{ {e} ^{s(X, \widetilde { Y })} } })$</p><p>æ‰€ä»¥æˆ‘ä»¬å°†æŸå¤±å‡½æ•°å®šä¹‰ä¸º-log(p(y|X))ï¼Œå°±å¯ä»¥åˆ©ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥è¿›è¡Œç½‘ç»œçš„å­¦ä¹ äº†ã€‚ <strong>loss function:</strong></p><p>$Loss = log({ {\sum} _{\widetilde { Y } \in {Y} _{X}}{ {e} ^{s(X, \widetilde { Y })} } })ã€€- S(X, y)$</p><p>åœ¨å¯¹æŸå¤±å‡½æ•°è¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼ŒS(X,y)çš„è®¡ç®—å¾ˆç®€å•ï¼Œè€Œ</p><p>$log({ {\sum} _{\widetilde { Y } \in {Y} _{X}}{ {e} ^{s(X, \widetilde { Y })}}})$</p><p>ï¼ˆä¸‹é¢è®°ä½œlogsumexpï¼‰çš„è®¡ç®—ç¨å¾®å¤æ‚ä¸€äº›ï¼Œå› ä¸ºéœ€è¦è®¡ç®—æ¯ä¸€æ¡å¯èƒ½è·¯å¾„çš„åˆ†æ•°ã€‚è¿™é‡Œç”¨ä¸€ç§ç®€ä¾¿çš„æ–¹æ³•ï¼Œå¯¹äºåˆ°è¯${w} _{i+1}$çš„è·¯å¾„ï¼Œå¯ä»¥å…ˆæŠŠåˆ°è¯$w _i$çš„logsumexpè®¡ç®—å‡ºæ¥ï¼Œå› ä¸º</p><p>$log({\sum} _{e}^{log({\sum}{e} ^{x} )+ y})  = log({\sum} {\sum} {e} ^{x+y})$</p><p>å› æ­¤å…ˆè®¡ç®—æ¯ä¸€æ­¥çš„è·¯å¾„åˆ†æ•°å’Œç›´æ¥è®¡ç®—å…¨å±€åˆ†æ•°ç›¸åŒï¼Œä½†è¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘è®¡ç®—çš„æ—¶é—´ã€‚</p><p>æˆ‘ä»¬è¿›ä¸€æ­¥ç®€åŒ–</p><p>$Z(X, y) = {e} ^{s(X, \widetilde { Y })}$</p><blockquote><p>å…¶ä¸­çš„logsumexpæ˜¯å„ç§ç§‘å­¦è¿ç®—åº“ï¼ˆnumpy, pytorchï¼‰ä¸­éƒ½ä¼šæä¾›çš„åŸºæœ¬è¿ç®—ã€‚</p><p>$log{\sum} _{i} {e} ^{Z(X, y)} = max _i {Z _i} + log ({\sum} _{i}{e (Z _i - max _i (Z _i))})$</p></blockquote><h2 id="Pytorch-å®˜æ–¹ä»£ç è§£æ"><a href="#Pytorch-å®˜æ–¹ä»£ç è§£æ" class="headerlink" title="Pytorch å®˜æ–¹ä»£ç è§£æ"></a><a href="https://pytorch.org/tutorials/beginner/nlp/advanced_tutorial.html?highlight=crf">Pytorch å®˜æ–¹ä»£ç è§£æ</a></h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">as</span> autograd<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optimtorch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">argmax</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># return the argmax as a python int</span>    _<span class="token punctuation">,</span> idx <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>vec<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> idx<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">prepare_sequence</span><span class="token punctuation">(</span>seq<span class="token punctuation">,</span> to_ix<span class="token punctuation">)</span><span class="token punctuation">:</span>    idxs <span class="token operator">=</span> <span class="token punctuation">[</span>to_ix<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> seq<span class="token punctuation">]</span>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>idxs<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># TODO ä»¥ä¸€ç§æ•°å€¼ç¨³å®šæ€§ç®—æ³•æ±‚log_sum_exp: å…ˆæ ‡å‡†åŒ–ï¼Œå–å‡ºè¡Œä¸­æœ€å¤§å€¼è¿›è¡Œbroadcastï¼Œè®©æ¯ä¸ªå…ƒç´ å‡å»æœ€å¤§å€¼åæ±‚expç„¶åå†æ±‚å’Œ</span><span class="token keyword">def</span> <span class="token function">log_sum_exp</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">## z(x) -> log(âˆ‘_i exp(z_i)) =  max_i(z_i) + log(âˆ‘_i)exp(z_i - max_i(z_i))</span>    max_score <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> argmax<span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">]</span>    max_score_broadcast <span class="token operator">=</span> max_score<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> vec<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> max_score <span class="token operator">+</span> torch<span class="token punctuation">.</span>log<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>vec <span class="token operator">-</span> max_score_broadcast<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">BiLSTM_CRF</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> tag_to_ix<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> hidden_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>BiLSTM_CRF<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>embedding_dim <span class="token operator">=</span> embedding_dim        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim        self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> vocab_size        self<span class="token punctuation">.</span>tag_to_ix <span class="token operator">=</span> tag_to_ix        self<span class="token punctuation">.</span>tagset_size <span class="token operator">=</span> len<span class="token punctuation">(</span>tag_to_ix<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># tag_size : 3 + 2</span>        self<span class="token punctuation">.</span>word_embeds <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>embedding_dim<span class="token punctuation">,</span> hidden_dim <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> num_layers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bidirectional<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO æŠŠLSTM è¾“å‡ºæ˜ å°„åˆ°çŠ¶æ€ç©ºé—´ï¼ˆtag spaceï¼‰</span>        self<span class="token punctuation">.</span>hidden2tag <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO çŠ¶æ€è½¬ç§»çŸ©é˜µå‚æ•°:T(i,j)è¡¨ç¤ºä»çŠ¶æ€ j è½¬ç§»åˆ°çŠ¶æ€ i çš„æ¦‚ç‡ï¼Œè¿™æ ·ç¬¬iè¡Œå°±æ˜¯æ‰€æœ‰çŠ¶æ€è½¬ç§»åˆ°çŠ¶æ€içš„æ¦‚ç‡</span>        self<span class="token punctuation">.</span>transitions <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO æ ¹æ®ä¸Šé¢çŸ©é˜µå…ƒç´ å®šä¹‰ï¼šé™åˆ¶ä¸èƒ½ä»å…¶ä»–çŠ¶æ€è½¬ç§»åˆ°èµ·å§‹çŠ¶æ€ï¼Œä¸èƒ½ä»ç»“æŸçŠ¶æ€è½¬ç§»åˆ°å…¶ä»–ä»»ä½•çŠ¶æ€</span>        self<span class="token punctuation">.</span>transitions<span class="token punctuation">.</span>data<span class="token punctuation">[</span>tag_to_ix<span class="token punctuation">[</span>START_TAG<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>        self<span class="token punctuation">.</span>transitions<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> tag_to_ix<span class="token punctuation">[</span>STOP_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10000</span>        self<span class="token punctuation">.</span>hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>init_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># dont confuse this with _forward_alg above.</span>        <span class="token comment" spellcheck="true"># Get the emission scores from the BiLSTM</span>        lstm_feats <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_lstm_features<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Find the best path, given the features.</span>        score<span class="token punctuation">,</span> tag_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>_viterbi_decode<span class="token punctuation">(</span>lstm_feats<span class="token punctuation">)</span>        <span class="token keyword">return</span> score<span class="token punctuation">,</span> tag_seq    <span class="token keyword">def</span> <span class="token function">init_hidden</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token triple-quoted-string string">'''        _forward_algæ±‚å‡ºçš„æ˜¯æŸå¤±å‡½æ•°çš„log-sum-expè¿™ä¸€é¡¹ï¼Œå¦ä¸€é¡¹æ¯”è¾ƒç®€å•        å› ä¸ºè®¡ç®—è¯¯å·®scoreéœ€è¦è®¡ç®—æ¯ä¸€æ¡å¯èƒ½è·¯å¾„çš„åˆ†æ•°ã€‚è¿™é‡Œç”¨ä¸€ç§ç®€ä¾¿çš„æ–¹æ³•ï¼Œå¯¹äºåˆ°è¯w_(i+1)çš„è·¯å¾„ï¼Œ        å¯ä»¥å…ˆæŠŠåˆ°è¯w_içš„log-sum-expè®¡ç®—å‡ºæ¥ï¼Œç„¶åç´¯åŠ ï¼Œç±»ä¼¼é€’æ¨çš„æ€æƒ³    '''</span>    <span class="token keyword">def</span> <span class="token function">_forward_alg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">)</span><span class="token punctuation">:</span>        init_alphas <span class="token operator">=</span> torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">.</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO èµ·å§‹çŠ¶æ€scoreå®šä¹‰ä¸º0</span>        init_alphas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>START_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>        forward_var <span class="token operator">=</span> init_alphas        <span class="token comment" spellcheck="true"># TODO ä¾æ¬¡éå†å¥å­ä¸­çš„æ‰€æœ‰è¯</span>        <span class="token comment" spellcheck="true"># feats : (seq_len,tag_size) LSTMæ˜ å°„åˆ°tag spaceçš„ç»“æœ</span>        <span class="token keyword">for</span> feat <span class="token keyword">in</span> feats<span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">## TODO å¥å­ä¸­æ²¡æœ‰cls sepæˆ–è€…start end</span>            alphas_t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># å½“å‰æ—¶é—´æ­¥çš„forward tensor</span>            <span class="token keyword">for</span> next_tag <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># TODO éå†å½“å‰æ—¶é—´æ­¥(word)çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€</span>                <span class="token comment" spellcheck="true"># TODO å¹¿æ’­å½“å‰çŠ¶æ€å€¼ä¸ºtag_sizeå¤§å°ï¼Œç”¨äºå’Œè½¬ç§»åˆ°å½“å‰æ—¶é—´æ­¥çš„é‚£äº›çŠ¶æ€æ“ä½œï¼Œå³ transiton[next_tag]</span>                emit_score <span class="token operator">=</span> feat<span class="token punctuation">[</span>next_tag<span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># TODO å…¶ä»–çŠ¶æ€è½¬ç§»åˆ°next_tagï¼ˆå½“å‰çŠ¶æ€ï¼‰çš„æ¦‚ç‡</span>                trans_score <span class="token operator">=</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>next_tag<span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment" spellcheck="true"># TODO next_tag_var[i] æ˜¯ è®¡ç®—log-sum-exp ä¹‹å‰ çŠ¶æ€ i -> åˆ°çŠ¶æ€ next_tag å€¼</span>                next_tag_var <span class="token operator">=</span> forward_var <span class="token operator">+</span> trans_score <span class="token operator">+</span> emit_score                alphas_t<span class="token punctuation">.</span>append<span class="token punctuation">(</span>log_sum_exp<span class="token punctuation">(</span>next_tag_var<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># view(1) æŠŠscalarå˜ä¸º[scalar]</span>            <span class="token comment" spellcheck="true"># TODO æ­¤æ—¶ forward_var:size (1ï¼Œtag_size) ä½œä¸ºä¸‹ä¸€ä¸ªè¯word_(i+1)çš„åˆå§‹å€¼</span>            forward_var <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>alphas_t<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO æœ€ä¼˜åŠ ä¸Šæ‰€æœ‰çŠ¶æ€è½¬ç§»åˆ°ç»“æŸçŠ¶æ€çš„å€¼</span>        terminal_var <span class="token operator">=</span> forward_var <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>STOP_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># TODO æ±‚å‡ºæœ€ç»ˆlog-sum-expå€¼</span>        alpha <span class="token operator">=</span> log_sum_exp<span class="token punctuation">(</span>terminal_var<span class="token punctuation">)</span>        <span class="token keyword">return</span> alpha    <span class="token keyword">def</span> <span class="token function">_get_lstm_features</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>init_hidden<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># self.word_embeds(sentence).shape : (seq_len,voca_size)</span>        embeds <span class="token operator">=</span> self<span class="token punctuation">.</span>word_embeds<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># seq_len x batch_size x voca_size</span>        lstm_out<span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>lstm<span class="token punctuation">(</span>embeds<span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden<span class="token punctuation">)</span>        lstm_out <span class="token operator">=</span> lstm_out<span class="token punctuation">.</span>view<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hidden_dim<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[seq_len, batch_size, hiidden_size]</span>        lstm_feats <span class="token operator">=</span> self<span class="token punctuation">.</span>hidden2tag<span class="token punctuation">(</span>lstm_out<span class="token punctuation">)</span>        <span class="token keyword">return</span> lstm_feats    <span class="token triple-quoted-string string">'''        è¿™é‡Œæ±‚å‡ºæŸå¤±å‡½æ•°å¦ä¸€é¡¹    '''</span>    <span class="token keyword">def</span> <span class="token function">_score_sentence</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">,</span> tags<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># Gives the score of a provided tag sequence</span>        score <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO åŠ ä¸Šèµ·å§‹çŠ¶æ€</span>        tags <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>START_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span><span class="token punctuation">,</span> tags<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO æ ¹æ®æŸå¤±å‡½æ•°å®šä¹‰ transitions[tags[i + 1], tags[i]] è¡¨ç¤ºä» çŠ¶æ€iåˆ°çŠ¶æ€(i+1)çš„æ¦‚ç‡</span>        <span class="token comment" spellcheck="true"># TODO feat[tag[i]] è¡¨ç¤º word[i] åˆ° tag[i] çš„å‘å°„æ¦‚ç‡ï¼Œè¿™é‡Œç”¨ tag[i+1] å› ä¸ºå‰é¢å¡«å……äº†èµ·å§‹çŠ¶æ€ï¼Œ</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> feat <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>feats<span class="token punctuation">)</span><span class="token punctuation">:</span>            score <span class="token operator">=</span> score <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>tags<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> feat<span class="token punctuation">[</span>tags<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        score <span class="token operator">=</span> score <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>STOP_TAG<span class="token punctuation">]</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> score    <span class="token keyword">def</span> <span class="token function">_viterbi_decode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feats<span class="token punctuation">)</span><span class="token punctuation">:</span>        backpointers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># Initialieze the viterbi variables in log spac</span>        init_vvars <span class="token operator">=</span> torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">.</span><span class="token punctuation">)</span>        init_vvars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>START_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># forward_var at step i holds the viterbi variables for step i-1</span>        forward_var <span class="token operator">=</span> init_vvars        <span class="token keyword">for</span> feat <span class="token keyword">in</span> feats<span class="token punctuation">:</span>            bptrs_t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># holds the backpointers for this step</span>            viterbivars_t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># holds the viterbi variables for this step</span>            <span class="token keyword">for</span> next_tag <span class="token keyword">in</span> range<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tagset_size<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># next_tag_var[i] holds the viterbi variable for tag i at the</span>                <span class="token comment" spellcheck="true"># previous step, plus the score of transitioning</span>                <span class="token comment" spellcheck="true"># from tag i to next_tag.</span>                <span class="token comment" spellcheck="true"># We don't include the emission scores here because the max</span>                <span class="token comment" spellcheck="true"># does not depend on them (we add them in below)</span>                next_tag_var <span class="token operator">=</span> forward_var <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>next_tag<span class="token punctuation">]</span>                best_tag_id <span class="token operator">=</span> argmax<span class="token punctuation">(</span>next_tag_var<span class="token punctuation">)</span>                bptrs_t<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_tag_id<span class="token punctuation">)</span>                viterbivars_t<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_tag_var<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>best_tag_id<span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># Now add in the emission scores, and assign forward_var to the set</span>            <span class="token comment" spellcheck="true"># of viterbi variables we just computed</span>            forward_var <span class="token operator">=</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>viterbivars_t<span class="token punctuation">)</span> <span class="token operator">+</span> feat<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            backpointers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>bptrs_t<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Transition to STOP_TAG</span>        terminal_var <span class="token operator">=</span> forward_var <span class="token operator">+</span> self<span class="token punctuation">.</span>transitions<span class="token punctuation">[</span>self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>STOP_TAG<span class="token punctuation">]</span><span class="token punctuation">]</span>        best_tag_id <span class="token operator">=</span> argmax<span class="token punctuation">(</span>terminal_var<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># TODO åˆ°è¾¾STOP_TAGæœ€å¤§çš„åˆ†æ•°</span>        path_score <span class="token operator">=</span> terminal_var<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>best_tag_id<span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># Follow the back pointers to decode the best path.</span>        best_path <span class="token operator">=</span> <span class="token punctuation">[</span>best_tag_id<span class="token punctuation">]</span>        <span class="token keyword">for</span> bptrs_t <span class="token keyword">in</span> reversed<span class="token punctuation">(</span>backpointers<span class="token punctuation">)</span><span class="token punctuation">:</span>            best_tag_id <span class="token operator">=</span> bptrs_t<span class="token punctuation">[</span>best_tag_id<span class="token punctuation">]</span>            best_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>best_tag_id<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Pop off the start tag (we dont want to return that to the caller)</span>        start <span class="token operator">=</span> best_path<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">assert</span> start <span class="token operator">==</span> self<span class="token punctuation">.</span>tag_to_ix<span class="token punctuation">[</span>START_TAG<span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># Sanity check</span>        best_path<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> path_score<span class="token punctuation">,</span> best_path    <span class="token keyword">def</span> <span class="token function">neg_log_likelihood</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentence<span class="token punctuation">,</span> tags<span class="token punctuation">)</span><span class="token punctuation">:</span>        feats <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_lstm_features<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># size : (seq_len,tag_size)</span>        forward_score <span class="token operator">=</span> self<span class="token punctuation">.</span>_forward_alg<span class="token punctuation">(</span>feats<span class="token punctuation">)</span>        gold_score <span class="token operator">=</span> self<span class="token punctuation">.</span>_score_sentence<span class="token punctuation">(</span>feats<span class="token punctuation">,</span> tags<span class="token punctuation">)</span>        <span class="token keyword">return</span> forward_score <span class="token operator">-</span> gold_scoreSTART_TAG <span class="token operator">=</span> <span class="token string">"&lt;START>"</span>STOP_TAG <span class="token operator">=</span> <span class="token string">"&lt;STOP>"</span>EMBEDDING_DIM <span class="token operator">=</span> <span class="token number">5</span>HIDDEN_DIM <span class="token operator">=</span> <span class="token number">4</span><span class="token comment" spellcheck="true"># Make up some training data</span>training_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>    <span class="token string">"the wall street journal reported today that apple corporation made money"</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">"B I I I O O O B I O O"</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>    <span class="token string">"georgia tech is a university in georgia"</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">"B I O O O O B"</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>word_to_ix <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span><span class="token keyword">for</span> sentence<span class="token punctuation">,</span> tags <span class="token keyword">in</span> training_data<span class="token punctuation">:</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> sentence<span class="token punctuation">:</span>        <span class="token keyword">if</span> word <span class="token operator">not</span> <span class="token keyword">in</span> word_to_ix<span class="token punctuation">:</span>            word_to_ix<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>word_to_ix<span class="token punctuation">)</span>tag_to_ix <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"B": 0, "I": 1, "O": 2, START_TAG: 3, STOP_TAG: 4&amp;#125;</span>ix_to_tag <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> tag_to_ix<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ix_to_tag<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> kmodel <span class="token operator">=</span> BiLSTM_CRF<span class="token punctuation">(</span>len<span class="token punctuation">(</span>word_to_ix<span class="token punctuation">)</span><span class="token punctuation">,</span> tag_to_ix<span class="token punctuation">,</span> EMBEDDING_DIM<span class="token punctuation">,</span> HIDDEN_DIM<span class="token punctuation">)</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># # Check predictions before training</span><span class="token comment" spellcheck="true"># with torch.no_grad():</span><span class="token comment" spellcheck="true">#     precheck_sent = prepare_sequence(training_data[0][0], word_to_ix)</span><span class="token comment" spellcheck="true">#     precheck_tags = torch.tensor([tag_to_ix[t] for t in training_data[0][1]], dtype=torch.long)</span><span class="token comment" spellcheck="true">#     # print(model(precheck_sent))</span><span class="token comment" spellcheck="true"># Make sure prepare_sequence from earlier in the LSTM section is loaded</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># again, normally you would NOT do 300 epochs, it is toy data</span>    <span class="token keyword">for</span> sentence<span class="token punctuation">,</span> tags <span class="token keyword">in</span> training_data<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># Step 1. Remember that Pytorch accumulates gradients.</span>        <span class="token comment" spellcheck="true"># We need to clear them out before each instance</span>        model<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Step 2. Get our inputs ready for the network, that is,</span>        <span class="token comment" spellcheck="true"># turn them into Tensors of word indices.</span>        sentence_in <span class="token operator">=</span> prepare_sequence<span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> word_to_ix<span class="token punctuation">)</span>        targets <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>tag_to_ix<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token keyword">for</span> t <span class="token keyword">in</span> tags<span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Step 3. Run our forward pass.</span>        <span class="token comment" spellcheck="true"># TODO è¿™é‡ŒåŒºåˆ«äºä¸€èˆ¬çš„è®­ç»ƒæ¨¡å‹ï¼Œä¸€èˆ¬æ¨¡å‹æ˜¯ä»forwardçš„è¾“å‡ºç”¨äºè®¡ç®—è¯¯å·®</span>        <span class="token comment" spellcheck="true"># TODO è€Œè¿™é‡Œå› ä¸ºåŠ ä¸Šäº†CRFæ¨¡å‹ï¼Œåœ¨neg_log_likelihoodå®šä¹‰äº†CRFè¯¯å·®ç”¨äºæ¢¯åº¦æ›´æ–°</span>        loss <span class="token operator">=</span> model<span class="token punctuation">.</span>neg_log_likelihood<span class="token punctuation">(</span>sentence_in<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Step 4. Compute the loss, gradients, and update the parameters by</span>        <span class="token comment" spellcheck="true"># calling optimizer.step()</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="viterbi-è§£ç "><a href="#viterbi-è§£ç " class="headerlink" title="viterbi è§£ç "></a>viterbi è§£ç </h2><p>å…·ä½“è¯·å‚è€ƒã€€<a href="/2020/07/08/viterbi-suan-fa/" title="viterbiç®—æ³•">viterbiç®—æ³•</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/59845590">å‚è€ƒï¼‘</a></p><p><a href="https://www.seoxiehui.cn/article-215601-1.html">å‚è€ƒå…¬å¼</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CRF </tag>
            
            <tag> åºåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŸ¥è¯†é—®ç­”KBQA</title>
      <link href="/2020/07/20/zhi-shi-wen-da-kbqa/"/>
      <url>/2020/07/20/zhi-shi-wen-da-kbqa/</url>
      
        <content type="html"><![CDATA[<h1 id="çŸ¥è¯†é—®ç­”KBQA"><a href="#çŸ¥è¯†é—®ç­”KBQA" class="headerlink" title="çŸ¥è¯†é—®ç­”KBQA"></a>çŸ¥è¯†é—®ç­”KBQA</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>â€‹    åŸºäºçŸ¥è¯†å›¾è°±çš„è‡ªåŠ¨é—®ç­”ï¼ˆQuestion Answering over Knowledge Base, å³ KBQAï¼‰é—®é¢˜çš„å¤§æ¦‚å½¢å¼æ˜¯ï¼Œé¢„å…ˆç»™å®šä¸€ä¸ªçŸ¥è¯†åº“ï¼ˆæ¯”å¦‚Freebaseï¼‰ï¼ŒçŸ¥è¯†åº“ä¸­åŒ…å«ç€å¤§é‡çš„å…ˆéªŒçŸ¥è¯†æ•°æ®ï¼Œç„¶ååˆ©ç”¨è¿™äº›çŸ¥è¯†èµ„æºè‡ªåŠ¨å›ç­”è‡ªç„¶è¯­è¨€å½¢æ€çš„é—®é¢˜ï¼ˆæ¯”å¦‚â€œè‚‰å¤¹é¦æ˜¯æ±Ÿè‹çš„ç¾é£Ÿå—â€ï¼Œâ€œè™µä»Šå¹´å¤šå¤§äº†â€ç­‰äººæ°‘ç¾¤ä¼—å–œé—»ä¹è§çš„é—®é¢˜ï¼‰ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯çŸ¥è¯†åº“"><a href="#ä»€ä¹ˆæ˜¯çŸ¥è¯†åº“" class="headerlink" title="ä»€ä¹ˆæ˜¯çŸ¥è¯†åº“"></a>ä»€ä¹ˆæ˜¯çŸ¥è¯†åº“</h2><p>ä»¥çŸ¥è¯†ä¸ºä¸»è¦å•ä½ï¼Œå®ä½“ä¸ºä¸»è¦è½½ä½“ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒçŸ¥è¯†ï¼ˆæˆ–è€…äº‹å®ï¼‰ä¸»è¦ä»¥ä¸‰å…ƒç»„å½¢å¼å‘ˆç°ï¼š&lt;å¤´å®ä½“ï¼Œå…³ç³»ï¼Œå°¾å®ä½“&gt;ï¼Œå…¶ä¸­å®ä½“å³äººã€åœ°ç‚¹ã€æˆ–ç‰¹å®šæ¦‚å¿µç­‰ä¸‡ç‰©ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ&lt;è™µï¼Œæ”¹å˜äº†ï¼Œä¸­å›½&gt; å°±æ˜¯ä¸€æ¡ç®€å•çš„ä¸‰å…ƒç»„ç¤ºä¾‹ï¼Œå…¶ä¸­å¤´å°¾çš†ä¸ºçŸ¥è¯†åº“ä¸­å›ºæœ‰çš„å®ä½“å•å…ƒã€‚</p><h2 id="æ–¹æ³•æ¡†æ¶"><a href="#æ–¹æ³•æ¡†æ¶" class="headerlink" title="æ–¹æ³•æ¡†æ¶"></a>æ–¹æ³•æ¡†æ¶</h2><p><img src="/2020/07/20/zhi-shi-wen-da-kbqa/1.png"></p><p>å¯¹ç€å›¾è¯´ï¼šå‡è®¾è¦å›ç­”â€œWhere was Leslie Cheung bornâ€è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦åˆ†å››æ­¥ï¼š</p><ol><li><strong>å®ä½“è¯†åˆ«ï¼ˆNamed Entity Recognitionï¼‰</strong>ï¼Œå³æŠŠé—®é¢˜ä¸­çš„ä¸»è¦å®ä½“çš„åå­—ä»é—®é¢˜ä¸­æŠ½å‡ºæ¥ï¼Œè¿™æ ·æ‰çŸ¥é“åº”è¯¥å»çŸ¥è¯†åº“ä¸­æœå–å“ªä¸ªå®ä½“çš„ä¿¡æ¯æ¥è§£å†³é—®é¢˜ï¼Œå³å›¾ä¸­æŠŠâ€œLeslie Cheungâ€è¿™ä¸ªäººåæŠ½å‡ºæ¥ï¼›</li><li><strong>å®ä½“é“¾æ¥ï¼ˆEntity Linkingï¼‰</strong>ï¼ŒæŠŠæŠ½å–å‡ºæ¥çš„å®ä½“åå’ŒçŸ¥è¯†åº“ä¸­å…·ä½“çš„å®ä½“å¯¹åº”èµ·æ¥ï¼Œåšè¿™ä¸€æ­¥æ˜¯å› ä¸ºï¼Œç”±äºåŒåå®ä½“çš„å­˜åœ¨ï¼Œåå­—ä¸æ˜¯å®ä½“çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ä½“ç‹¬ä¸€æ— äºŒçš„ç¼–å·ï¼ˆidï¼‰æ‰æ˜¯ï¼Œæ‰¾åˆ°äº†å®ä½“åæ²¡åµç”¨ï¼Œå¿…é¡»è¦å¯¹åº”åˆ°çŸ¥è¯†åº“ä¸­å…·ä½“çš„å®ä½“idï¼Œæ‰èƒ½åœ¨çŸ¥è¯†åº“ä¸­æŠŠå…·ä½“å®ä½“æ‰¾åˆ°ï¼Œè·å–ç›¸å…³ä¿¡æ¯ã€‚å³å›¾ä¸­å°†â€œLeslie Cheungâ€æ˜ å°„åˆ°â€œm.sdjk1sâ€è¿™ä¸ª id ä¸Šï¼ˆFreebase çš„å®ä½“ id æ˜¯è¿™ä¸ªæ ¼å¼çš„ï¼‰ã€‚è¿™ä¸€æ­¥ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç›´æ¥æœâ€œå§“åâ€å«â€œLeslie Cheungâ€çš„å®ä½“æ˜¯æœä¸åˆ°çš„ï¼Œå› ä¸ºâ€œLeslie Cheungâ€å…¶å®æ˜¯æŸä¸ªå®ä½“çš„â€œå¤–æ–‡åâ€ï¼Œä»–çš„â€œå§“åâ€å«â€œå¼ å›½è£â€ï¼Œä»¥åŠæœ‰æ—¶å€™è¿˜ä¼šæœ‰å¤šä¸ªå«â€œLeslie Cheungâ€çš„äººã€‚å…·ä½“è§£å†³æ–¹å¼åé¢å†è¯´ã€‚</li><li><strong>å…³ç³»é¢„æµ‹ï¼ˆRelation Predictionï¼‰ï¼Œ</strong>æ ¹æ®åŸé—®å¥ä¸­é™¤å»å®ä½“åä»¥å¤–çš„å…¶ä»–è¯è¯­é¢„æµ‹å‡ºåº”è¯¥ä»çŸ¥è¯†åº“ä¸­å“ªä¸ªå…³ç³»å»è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œ<strong>æ˜¯æ•´ä¸ªé—®é¢˜ä¸­æœ€ä¸»è¦çš„ä¸€æ­¥</strong>ã€‚å³å›¾ä¸­ä»â€œWhere was <e> bornâ€é¢„æµ‹å‡ºâ€œpeople.person.place_of_birthâ€ï¼ˆFreebase çš„å…³ç³»åæ ¼å¼ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œå‡ºç”Ÿåœ°â€ï¼‰è¿™ä¸ªå…³ç³»åº”è¯¥è¿æ¥ç€é—®é¢˜çš„ä¸»è¦å®ä½“â€œLeslie Cheungâ€ä¸è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚</e></li><li><strong>æ‰¾åˆ°äº†å®ä½“ä¸å…³ç³»</strong>ï¼Œç›´æ¥åœ¨çŸ¥è¯†åº“ä¸­æŠŠå¯¹åº”çš„ä¸‰å…ƒç»„æ£€ç´¢å‡ºæ¥ï¼Œå³ â€œ&lt;m.sdjk1s,<br>people.person.place_of_birth, m.s1kjds&gt;â€ï¼Œé‚£ä¹ˆè¿™æ¡ä¸‰å…ƒç»„çš„å°¾å®ä½“ï¼Œå³â€œm.s1kjdsâ€å°±æ˜¯é—®é¢˜çš„ç­”æ¡ˆï¼ŒæŸ¥è¯¢å…¶åå­—ï¼Œå°±æ˜¯â€œHong Kongâ€ã€‚</li></ol><blockquote><p>KBQA çš„è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªæ–¹å‘</p><ol><li>é€šè¿‡é€»è¾‘è¡¨è¾¾å¼ç›´æ¥ç”Ÿæˆ SPARQLï¼ˆæ•°æ®åº“æŸ¥è¯¢è¯­è¨€ï¼Œç±»ä¼¼ SQL é‚£ç§ï¼‰æŸ¥æ•°æ®åº“</li><li>å°±æ˜¯æŒ‰ä¸Šé¢è¯´çš„æ¡†æ¶é‚£å››æ­¥ï¼Œä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ¡†æ¶æ¥åš</li></ol></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸‰å…ƒç»„ </tag>
            
            <tag> é—®ç­” </tag>
            
            <tag> çŸ¥è¯†å›¾è°± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BPEåˆ†è¯ç®—æ³•</title>
      <link href="/2020/07/18/bpe-fen-ci-suan-fa/"/>
      <url>/2020/07/18/bpe-fen-ci-suan-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="BPE-WordPiece"><a href="#BPE-WordPiece" class="headerlink" title="BPE(WordPiece)"></a>BPE(WordPiece)</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>2018å¹´æœ€ç«çš„è®ºæ–‡è¦å±googleçš„BERTï¼Œä¸è¿‡ä»Šå¤©æˆ‘ä»¬ä¸ä»‹ç»BERTçš„æ¨¡å‹ï¼Œè€Œæ˜¯è¦ä»‹ç»BERTä¸­çš„ä¸€ä¸ªå°æ¨¡å—WordPieceã€‚</p><h2 id="WordPieceåŸç†"><a href="#WordPieceåŸç†" class="headerlink" title="WordPieceåŸç†"></a>WordPieceåŸç†</h2><p>ç°åœ¨åŸºæœ¬æ€§èƒ½å¥½ä¸€äº›çš„NLPæ¨¡å‹ï¼Œä¾‹å¦‚OpenAI GPTï¼Œgoogleçš„BERTï¼Œåœ¨æ•°æ®é¢„å¤„ç†çš„æ—¶å€™éƒ½ä¼šæœ‰WordPieceçš„è¿‡ç¨‹ã€‚WordPieceå­—é¢ç†è§£æ˜¯æŠŠwordæ‹†æˆpieceä¸€ç‰‡ä¸€ç‰‡ï¼Œå…¶å®å°±æ˜¯è¿™ä¸ªæ„æ€ã€‚</p><p>WordPieceçš„ä¸€ç§ä¸»è¦çš„å®ç°æ–¹å¼å«åšBPEï¼ˆByte-Pair Encodingï¼‰åŒå­—èŠ‚ç¼–ç ã€‚</p><p>BPEçš„è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºæŠŠä¸€ä¸ªå•è¯å†æ‹†åˆ†ï¼Œä½¿å¾—æˆ‘ä»¬çš„æ­¤è¡¨ä¼šå˜å¾—ç²¾ç®€ï¼Œå¹¶ä¸”å¯“æ„æ›´åŠ æ¸…æ™°ã€‚</p><p>æ¯”å¦‚â€lovedâ€,â€lovingâ€,â€lovesâ€è¿™ä¸‰ä¸ªå•è¯ã€‚å…¶å®æœ¬èº«çš„è¯­ä¹‰éƒ½æ˜¯â€œçˆ±â€çš„æ„æ€ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»¥å•è¯ä¸ºå•ä½ï¼Œé‚£å®ƒä»¬å°±ç®—ä¸ä¸€æ ·çš„è¯ï¼Œåœ¨è‹±è¯­ä¸­ä¸åŒåç¼€çš„è¯éå¸¸çš„å¤šï¼Œå°±ä¼šä½¿å¾—è¯è¡¨å˜çš„å¾ˆå¤§ï¼Œè®­ç»ƒé€Ÿåº¦å˜æ…¢ï¼Œè®­ç»ƒçš„æ•ˆæœä¹Ÿä¸æ˜¯å¤ªå¥½ã€‚</p><p>BPEç®—æ³•é€šè¿‡è®­ç»ƒï¼Œèƒ½å¤ŸæŠŠä¸Šé¢çš„3ä¸ªå•è¯æ‹†åˆ†æˆâ€lovâ€,â€edâ€,â€ingâ€,â€esâ€å‡ éƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥æŠŠè¯çš„æœ¬èº«çš„æ„æ€å’Œæ—¶æ€åˆ†å¼€ï¼Œæœ‰æ•ˆçš„å‡å°‘äº†è¯è¡¨çš„æ•°é‡ã€‚</p><h2 id="BPEç®—æ³•"><a href="#BPEç®—æ³•" class="headerlink" title="BPEç®—æ³•"></a>BPEç®—æ³•</h2><p>BPEçš„å¤§æ¦‚è®­ç»ƒè¿‡ç¨‹ï¼šé¦–å…ˆå°†è¯åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„å­—ç¬¦ï¼Œç„¶ååœ¨è¯çš„èŒƒå›´å†…ç»Ÿè®¡å­—ç¬¦å¯¹å‡ºç°çš„æ¬¡æ•°ï¼Œæ¯æ¬¡å°†æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦å¯¹ä¿å­˜èµ·æ¥ï¼Œç›´åˆ°å¾ªç¯æ¬¡æ•°ç»“æŸã€‚</p><p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹BPEç®—æ³•ã€‚</p><p>æˆ‘ä»¬åŸå§‹è¯è¡¨å¦‚ä¸‹ï¼š</p><p>{â€˜l o w e r â€˜: 2, â€˜n e w e s t â€˜: 6, â€˜w i d e s t â€˜: 3, â€˜l o w â€˜: 5}</p><p>å…¶ä¸­çš„keyæ˜¯è¯è¡¨çš„å•è¯æ‹†åˆ†å±‚å­—æ¯ï¼Œå†åŠ ä»£è¡¨ç»“å°¾ï¼Œvalueä»£è¡¨è¯å‡ºç°çš„é¢‘ç‡ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¯ä¸€æ­¥åœ¨æ•´å¼ è¯è¡¨ä¸­æ‰¾å‡ºé¢‘ç‡æœ€é«˜ç›¸é‚»åºåˆ—ï¼Œå¹¶æŠŠå®ƒåˆå¹¶ï¼Œä¾æ¬¡å¾ªç¯ã€‚</p><pre><code>åŸå§‹è¯è¡¨ &amp;#123;'l o w e r &lt;/w&gt;': 2, 'n e w e s t &lt;/w&gt;': 6, 'w i d e s t &lt;/w&gt;': 3, 'l o w &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('s', 't') 9åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'n e w e st &lt;/w&gt;': 6, 'l o w e r &lt;/w&gt;': 2, 'w i d e st &lt;/w&gt;': 3, 'l o w &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('e', 'st') 9åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'l o w e r &lt;/w&gt;': 2, 'l o w &lt;/w&gt;': 5, 'w i d est &lt;/w&gt;': 3, 'n e w est &lt;/w&gt;': 6&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('est', '&lt;/w&gt;') 9åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'l o w e r &lt;/w&gt;': 2, 'n e w est&lt;/w&gt;': 6, 'l o w &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('l', 'o') 7åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'lo w e r &lt;/w&gt;': 2, 'n e w est&lt;/w&gt;': 6, 'lo w &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('lo', 'w') 7åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'low e r &lt;/w&gt;': 2, 'n e w est&lt;/w&gt;': 6, 'low &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('n', 'e') 6åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'low e r &lt;/w&gt;': 2, 'ne w est&lt;/w&gt;': 6, 'low &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('w', 'est&lt;/w&gt;') 6åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'low e r &lt;/w&gt;': 2, 'ne west&lt;/w&gt;': 6, 'low &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('ne', 'west&lt;/w&gt;') 6åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'low e r &lt;/w&gt;': 2, 'newest&lt;/w&gt;': 6, 'low &lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('low', '&lt;/w&gt;') 5åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w i d est&lt;/w&gt;': 3, 'low e r &lt;/w&gt;': 2, 'newest&lt;/w&gt;': 6, 'low&lt;/w&gt;': 5&amp;#125;å‡ºç°æœ€é¢‘ç¹çš„åºåˆ— ('i', 'd') 3åˆå¹¶æœ€é¢‘ç¹çš„åºåˆ—åçš„è¯è¡¨ &amp;#123;'w id est&lt;/w&gt;': 3, 'newest&lt;/w&gt;': 6, 'low&lt;/w&gt;': 5, 'low e r &lt;/w&gt;': 2&amp;#125;</code></pre><p>è¿™æ ·æˆ‘ä»¬é€šè¿‡BPEå¾—åˆ°äº†æ›´åŠ åˆé€‚çš„è¯è¡¨äº†ï¼Œè¿™ä¸ªè¯è¡¨å¯èƒ½ä¼šå‡ºç°ä¸€äº›ä¸æ˜¯å•è¯çš„ç»„åˆï¼Œä½†æ˜¯è¿™ä¸ªæœ¬èº«æ˜¯æœ‰æ„ä¹‰çš„ä¸€ç§å½¢å¼ï¼ŒåŠ é€ŸNLPçš„å­¦ä¹ ï¼Œæå‡ä¸åŒè¯ä¹‹é—´çš„è¯­ä¹‰çš„åŒºåˆ†åº¦ã€‚</p><ol><li><p>å•è¯æŒ‰ç…§charåˆ†è¯ï¼Œ å•è¯ç»“å°¾æ›¿æ¢ä¸ºæŸå­—ç¬¦ï¼ˆ\w or -ï¼‰</p></li><li><p>æ„é€ vocabï¼šå°†ç›¸è¿çš„charç»„æˆpairï¼Œé¢‘æ¬¡ä¸ºwordçš„cnt</p></li><li><p>é€‰å–é¢‘æ¬¡æœ€é«˜çš„max_pairï¼Œå°†vocabä¸­çš„max_pairåˆå¹¶ã€‚ ï¼ˆé¢‘æ¬¡æœ€é«˜çš„å¯èƒ½æœ‰å¤šä¸ªpairï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªåˆå¹¶ï¼‰<br> å‚è€ƒä»£ç ï¼š</p></li></ol><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">process_raw_words</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> endtag<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''æŠŠå•è¯åˆ†å‰²æˆæœ€å°çš„ç¬¦å·ï¼Œå¹¶ä¸”åŠ ä¸Šç»“å°¾ç¬¦å·'''</span>    vocabs <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    <span class="token keyword">for</span> word<span class="token punctuation">,</span> count <span class="token keyword">in</span> words<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># åŠ ä¸Šç©ºæ ¼</span>        word <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'([a-zA-Z])'</span><span class="token punctuation">,</span> r<span class="token string">' \1'</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span>        word <span class="token operator">+=</span> <span class="token string">' '</span> <span class="token operator">+</span> endtag        vocabs<span class="token punctuation">[</span>word<span class="token punctuation">]</span> <span class="token operator">=</span> count    <span class="token keyword">return</span> vocabs<span class="token keyword">def</span> <span class="token function">get_symbol_pairs</span><span class="token punctuation">(</span>vocabs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">''' è·å¾—è¯æ±‡ä¸­æ‰€æœ‰çš„å­—ç¬¦pairï¼Œè¿ç»­é•¿åº¦ä¸º2ï¼Œå¹¶ç»Ÿè®¡å‡ºç°æ¬¡æ•°    Args:        vocabs: å•è¯dictï¼Œ(word, count)å•è¯çš„å‡ºç°æ¬¡æ•°ã€‚å•è¯å·²ç»åˆ†å‰²ä¸ºæœ€å°çš„å­—ç¬¦    Returns:        pairs: ((ç¬¦å·1, ç¬¦å·2), count)    '''</span>    <span class="token comment" spellcheck="true"># pairs = collections.defaultdict(int)</span>    pairs <span class="token operator">=</span> dict<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> word<span class="token punctuation">,</span> freq <span class="token keyword">in</span> vocabs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># å•è¯é‡Œçš„ç¬¦å·</span>        symbols <span class="token operator">=</span> word<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>symbols<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            p <span class="token operator">=</span> <span class="token punctuation">(</span>symbols<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> symbols<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            pairs<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> pairs<span class="token punctuation">.</span>get<span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> freq    <span class="token keyword">return</span> pairs<span class="token keyword">def</span> <span class="token function">merge_symbols</span><span class="token punctuation">(</span>symbol_pair<span class="token punctuation">,</span> vocabs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''æŠŠvocabsä¸­çš„æ‰€æœ‰å•è¯ä¸­çš„'a b'å­—ç¬¦ä¸²ç”¨'ab'æ›¿æ¢    Args:        symbol_pair: (a, b) ä¸¤ä¸ªç¬¦å·        vocabs: ç”¨subword(symbol)è¡¨ç¤ºçš„å•è¯ï¼Œ(word, count)ã€‚å…¶ä¸­wordä½¿ç”¨subwordç©ºæ ¼åˆ†å‰²    Returns:        vocabs_new: æ›¿æ¢'a b'ä¸º'ab'çš„æ–°è¯æ±‡è¡¨    '''</span>    vocabs_new <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    raw <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>symbol_pair<span class="token punctuation">)</span>    merged <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>symbol_pair<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># éå­—æ¯å’Œæ•°å­—å­—ç¬¦åšè½¬ä¹‰</span>    bigram <span class="token operator">=</span> re<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>raw<span class="token punctuation">)</span>    p <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'(?&lt;!\S)'</span> <span class="token operator">+</span> bigram <span class="token operator">+</span> r<span class="token string">'(?!\S)'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> word<span class="token punctuation">,</span> count <span class="token keyword">in</span> vocabs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        word_new <span class="token operator">=</span> p<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>merged<span class="token punctuation">,</span> word<span class="token punctuation">)</span>        vocabs_new<span class="token punctuation">[</span>word_new<span class="token punctuation">]</span> <span class="token operator">=</span> count    <span class="token keyword">return</span> vocabs_newraw_words <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"low": 5, "lower": 2, "newest": 6, "widest": 3&amp;#125;</span>vocabs <span class="token operator">=</span> process_raw_words<span class="token punctuation">(</span>raw_words<span class="token punctuation">)</span>num_merges <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">print</span><span class="token punctuation">(</span>vocabs<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># &lt;class 'dict'>: &amp;#123;' l o w -': 5, ' l o w e r -': 2, ' n e w e s t -': 6, ' w i d e s t -': 3&amp;#125;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_merges<span class="token punctuation">)</span><span class="token punctuation">:</span>    pairs <span class="token operator">=</span> get_symbol_pairs<span class="token punctuation">(</span>vocabs<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># é€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„pair</span>    symbol_pair <span class="token operator">=</span> max<span class="token punctuation">(</span>pairs<span class="token punctuation">,</span> key<span class="token operator">=</span>pairs<span class="token punctuation">.</span>get<span class="token punctuation">)</span>    vocabs <span class="token operator">=</span> merge_symbols<span class="token punctuation">(</span>symbol_pair<span class="token punctuation">,</span> vocabs<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>vocabs<span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> åˆ†è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mongodb docker éƒ¨ç½²-éé›†ç¾¤</title>
      <link href="/2020/07/08/mongodb-docker-bu-shu-fei-ji-qun/"/>
      <url>/2020/07/08/mongodb-docker-bu-shu-fei-ji-qun/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-éƒ¨ç½²-MongoDB"><a href="#Docker-éƒ¨ç½²-MongoDB" class="headerlink" title="Docker éƒ¨ç½² MongoDB"></a>Docker éƒ¨ç½² MongoDB</h1><h3 id="1-æ‹‰å–-docker-é•œåƒ"><a href="#1-æ‹‰å–-docker-é•œåƒ" class="headerlink" title="1. æ‹‰å– docker é•œåƒ"></a>1. æ‹‰å– docker é•œåƒ</h3><pre><code>docker pull mongo:3.4</code></pre><h3 id="2-è¿è¡Œ"><a href="#2-è¿è¡Œ" class="headerlink" title="2. è¿è¡Œ"></a>2. è¿è¡Œ</h3><pre><code>docker run -d --name mongodb --volume /root/docker/mongo/data:/data/db -p 27017:27017 mongo:3.4 --auth</code></pre><h3 id="3-è¿›å…¥-mongo"><a href="#3-è¿›å…¥-mongo" class="headerlink" title="3. è¿›å…¥ mongo"></a>3. è¿›å…¥ mongo</h3><pre><code>docker exec -it mongodb mongo</code></pre><h3 id="4-åˆ›å»ºæ•°æ®åº“å¸å·"><a href="#4-åˆ›å»ºæ•°æ®åº“å¸å·" class="headerlink" title="4. åˆ›å»ºæ•°æ®åº“å¸å·"></a>4. åˆ›å»ºæ•°æ®åº“å¸å·</h3><pre><code>use admin;db.createUser(&amp;#123; user: 'root', pwd: '123456', roles: [ &amp;#123; role: "root", db: "admin" &amp;#125; ] &amp;#125;);</code></pre><h3 id="5-å®‰è£…-mongo-express-å¯è§†åŒ–å·¥å…·"><a href="#5-å®‰è£…-mongo-express-å¯è§†åŒ–å·¥å…·" class="headerlink" title="5. å®‰è£… mongo-express å¯è§†åŒ–å·¥å…·"></a>5. å®‰è£… mongo-express å¯è§†åŒ–å·¥å…·</h3><pre><code>docker pull mongo-expressdocker run -d --name mongo-express -p 8081:8081 --link mongodb:mongo --env ME_CONFIG_MONGODB_ADMINUSERNAME='root' --env ME_CONFIG_MONGODB_ADMINPASSWORD='123456' mongo-express</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éé›†ç¾¤ </tag>
            
            <tag> mongo </tag>
            
            <tag> docker éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>viterbiç®—æ³•</title>
      <link href="/2020/07/08/viterbi-suan-fa/"/>
      <url>/2020/07/08/viterbi-suan-fa/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸€ç‰‡åšå®¢é€šä¿—æ˜“æ‡‚ï¼Œæˆ‘è¿™è¾¹ç›´æ¥æ‹¿è¿‡æ¥äº†</p><p>è½¬è½½è‡³ã€€<a href="https://www.zhihu.com/question/20136144">https://www.zhihu.com/question/20136144</a></p><h1 id="ç»´ç‰¹æ¯”ç®—æ³•"><a href="#ç»´ç‰¹æ¯”ç®—æ³•" class="headerlink" title="ç»´ç‰¹æ¯”ç®—æ³•"></a>ç»´ç‰¹æ¯”ç®—æ³•</h1><p><img src="/2020/07/08/viterbi-suan-fa/1.jpg"></p><p>â€‹     viterbiç»´ç‰¹æ¯”ç®—æ³•è§£å†³çš„æ˜¯ç¯±ç¬†å‹çš„å›¾çš„æœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œå›¾çš„èŠ‚ç‚¹æŒ‰åˆ—ç»„ç»‡ï¼Œæ¯åˆ—çš„èŠ‚ç‚¹æ•°é‡å¯ä»¥ä¸ä¸€æ ·ï¼Œæ¯ä¸€åˆ—çš„èŠ‚ç‚¹åªèƒ½å’Œç›¸é‚»åˆ—çš„èŠ‚ç‚¹ç›¸è¿ï¼Œä¸èƒ½è·¨åˆ—ç›¸è¿ï¼ŒèŠ‚ç‚¹ä¹‹é—´æœ‰ç€ä¸åŒçš„è·ç¦»ï¼Œè·ç¦»çš„å€¼å°±ä¸åœ¨å›¾ä¸Šä¸€ä¸€æ ‡æ³¨å‡ºæ¥äº†ï¼Œå¤§å®¶è‡ªè¡Œè„‘è¡¥</p><p>ç­”æ¡ˆï¼šviterbi (ç»´ç‰¹æ¯”)ç®—æ³•ã€‚</p><p>è¿‡ç¨‹éå¸¸ç®€å•ï¼š</p><p>ä¸ºäº†æ‰¾å‡ºSåˆ°Eä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä»¬å…ˆä»Så¼€å§‹ä»å·¦åˆ°å³ä¸€åˆ—ä¸€åˆ—åœ°æ¥çœ‹ã€‚</p><p>é¦–å…ˆèµ·ç‚¹æ˜¯Sï¼Œä»Såˆ°Aåˆ—çš„è·¯å¾„æœ‰ä¸‰ç§å¯èƒ½ï¼šS-A1ã€S-A2ã€S-A3ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/2.jpg"></p><p>â€‹    æˆ‘ä»¬ä¸èƒ½æ­¦æ–­åœ°è¯´S-A1ã€S-A2ã€S-A3ä¸­çš„å“ªä¸€æ®µå¿…å®šæ˜¯å…¨å±€æœ€çŸ­è·¯å¾„ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç›®å‰ä¸ºæ­¢ä»»ä½•ä¸€æ®µéƒ½æœ‰å¯èƒ½æ˜¯å…¨å±€æœ€çŸ­è·¯å¾„çš„å¤‡é€‰é¡¹ã€‚</p><p>   æˆ‘ä»¬ç»§ç»­å¾€å³çœ‹ï¼Œåˆ°äº†Båˆ—ã€‚æŒ‰Båˆ—çš„B1ã€B2ã€B3é€ä¸ªåˆ†æã€‚</p><p>å…ˆçœ‹B1ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/3.jpg"></p><p>å¦‚ä¸Šå›¾ï¼Œç»è¿‡B1çš„æ‰€æœ‰è·¯å¾„åªæœ‰3æ¡ï¼š</p><p>S-A1-B1</p><p>S-A2-B1</p><p>S-A3-B1</p><p>ä»¥ä¸Šè¿™ä¸‰æ¡è·¯å¾„ï¼Œå„èŠ‚ç‚¹è·ç¦»åŠ èµ·æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å…¶ä¸­å“ªä¸€æ¡æ˜¯æœ€çŸ­çš„ã€‚å‡è®¾S-A3-B1æ˜¯æœ€çŸ­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çŸ¥é“äº†ç»è¿‡B1çš„æ‰€æœ‰è·¯å¾„å½“ä¸­S-A3-B1æ˜¯æœ€çŸ­çš„ï¼Œå…¶å®ƒä¸¤æ¡è·¯å¾„è·¯å¾„S-A1-B1å’ŒS-A2-B1éƒ½æ¯”S-A3-B1é•¿ï¼Œç»å¯¹ä¸æ˜¯ç›®æ ‡ç­”æ¡ˆï¼Œå¯ä»¥å¤§èƒ†åœ°åˆ æ‰äº†ã€‚åˆ æ‰äº†ä¸å¯èƒ½æ˜¯ç­”æ¡ˆçš„è·¯å¾„ï¼Œå°±æ˜¯viterbiç®—æ³•ï¼ˆç»´ç‰¹æ¯”ç®—æ³•ï¼‰çš„é‡ç‚¹ï¼Œå› ä¸ºåé¢æˆ‘ä»¬å†ä¹Ÿä¸ç”¨è€ƒè™‘è¿™äº›è¢«åˆ æ‰çš„è·¯å¾„äº†ã€‚ç°åœ¨ç»è¿‡B1çš„æ‰€æœ‰è·¯å¾„åªå‰©ä¸€æ¡è·¯å¾„äº†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/4.jpg"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹B2ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/5.jpg"></p><p>åŒç†ï¼Œå¦‚ä¸Šå›¾ï¼Œç»è¿‡B2çš„è·¯å¾„æœ‰3æ¡ï¼š</p><p>S-A1-B2</p><p>S-A2-B2</p><p>S-A3-B2</p><p>è¿™ä¸‰æ¡è·¯å¾„ä¸­ï¼Œå„èŠ‚ç‚¹è·ç¦»åŠ èµ·æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œæˆ‘ä»¬è‚¯å®šä¹Ÿå¯ä»¥çŸ¥é“å…¶ä¸­å“ªä¸€æ¡æ˜¯æœ€çŸ­çš„ï¼Œå‡è®¾S-A1-B2æ˜¯æœ€çŸ­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çŸ¥é“äº†ç»è¿‡B2çš„æ‰€æœ‰è·¯å¾„å½“ä¸­S-A1-B2æ˜¯æœ€çŸ­çš„ï¼Œå…¶å®ƒä¸¤æ¡è·¯å¾„è·¯å¾„S-A2-B2å’ŒS-A3-B1ä¹Ÿå¯ä»¥åˆ æ‰äº†ã€‚ç»è¿‡B2æ‰€æœ‰è·¯å¾„åªå‰©ä¸€æ¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/6.jpg"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹B3ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/7.jpg"></p><p>åŒç†ï¼Œå¦‚ä¸Šå›¾ï¼Œç»è¿‡B3çš„è·¯å¾„ä¹Ÿæœ‰3æ¡ï¼š</p><p>S-A1-B3</p><p>S-A2-B3</p><p>S-A3-B3</p><p>è¿™ä¸‰æ¡è·¯å¾„ä¸­æˆ‘ä»¬ä¹Ÿè‚¯å®šå¯ä»¥ç®—å‡ºå…¶ä¸­å“ªä¸€æ¡æ˜¯æœ€çŸ­çš„ï¼Œå‡è®¾S-A2-B3æ˜¯æœ€çŸ­çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çŸ¥é“äº†ç»è¿‡B3çš„æ‰€æœ‰è·¯å¾„å½“ä¸­S-A2-B3æ˜¯æœ€çŸ­çš„ï¼Œå…¶å®ƒä¸¤æ¡è·¯å¾„è·¯å¾„S-A1-B3å’ŒS-A3-B3ä¹Ÿå¯ä»¥åˆ æ‰äº†ã€‚ç»è¿‡B3çš„æ‰€æœ‰è·¯å¾„åªå‰©ä¸€æ¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/8.jpg"></p><p>ç°åœ¨å¯¹äºBåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹æˆ‘ä»¬éƒ½è¿‡äº†ä¸€éï¼ŒBåˆ—çš„æ¯ä¸ªèŠ‚ç‚¹æˆ‘ä»¬éƒ½åˆ é™¤äº†ä¸€äº›ä¸å¯èƒ½æ˜¯ç­”æ¡ˆçš„è·¯å¾„ï¼Œçœ‹çœ‹æˆ‘ä»¬å‰©ä¸‹å“ªäº›å¤‡é€‰çš„æœ€çŸ­è·¯å¾„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/9.jpg"></p><p>ä¸Šå›¾æ˜¯æˆ‘ä»¬åˆ æ‰äº†å…¶å®ƒä¸å¯èƒ½æ˜¯æœ€çŸ­è·¯å¾„çš„æƒ…å†µï¼Œç•™ä¸‹äº†ä¸‰ä¸ªæœ‰å¯èƒ½æ˜¯æœ€çŸ­çš„è·¯å¾„ï¼šS-A3-B1ã€S-A1-B2ã€S-A2-B3ã€‚ç°åœ¨æˆ‘ä»¬å°†è¿™ä¸‰æ¡å¤‡é€‰çš„è·¯å¾„æ”¾åœ¨ä¸€èµ·æ±‡æ€»åˆ°ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/12.jpg"></p><p>S-A3-B1ã€S-A1-B2ã€S-A2-B3éƒ½æœ‰å¯èƒ½æ˜¯å…¨å±€çš„æœ€çŸ­è·¯å¾„çš„å¤‡é€‰è·¯å¾„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯åˆ¤æ–­å“ªä¸€æ¡ä¸€å®šæ˜¯å…¨å±€æœ€çŸ­è·¯å¾„çš„å­è·¯å¾„ã€‚</p><p>   å¦‚æœæˆ‘ä»¬ä½ è®¤ä¸ºæ²¡æ¯›ç—…å°±ç»§ç»­å¾€ä¸‹çœ‹Cåˆ—ï¼Œå¦‚æœä¸ç†è§£ï¼Œå›å¤´å†çœ‹ä¸€éï¼Œå‰é¢çš„æ­¥éª¤å†³å®šä½ æ˜¯å¦èƒ½çœ‹æ‡‚viterbiç®—æ³•ï¼ˆç»´ç‰¹æ¯”ç®—æ³•ï¼‰ã€‚</p><p>â€‹    æ¥ä¸‹æ¥è®²åˆ°Cåˆ—äº†ï¼Œç±»ä¼¼ä¸Šé¢è¯´çš„Båˆ—ï¼Œæˆ‘ä»¬ä»C1ã€C2ã€C3ä¸€ä¸ªä¸ªèŠ‚ç‚¹åˆ†æã€‚</p><p>ç»è¿‡C1èŠ‚ç‚¹çš„è·¯å¾„æœ‰ï¼š</p><p>S-A3-B1-C1ã€S-A1-B2-C1ã€S-A2-B3-C1</p><p><img src="/2020/07/08/viterbi-suan-fa/13.jpg"></p><p>å’ŒBåˆ—çš„åšæ³•ä¸€æ ·ï¼Œä»è¿™ä¸‰æ¡è·¯å¾„ä¸­æ‰¾åˆ°æœ€çŸ­çš„é‚£æ¡ï¼ˆå‡å®šæ˜¯S-A3-B1-C1ï¼‰ï¼Œå…¶å®ƒä¸¤æ¡è·¯å¾„åŒæ ·é“ç†å¯ä»¥åˆ æ‰äº†ã€‚é‚£ä¹ˆç»è¿‡C1çš„æ‰€æœ‰è·¯å¾„åªå‰©ä¸€æ¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/14.jpg"></p><p>åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç»è¿‡C2å’ŒC3èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œæ±‡æ€»ä¸€ä¸‹ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/15.jpg"></p><p>åˆ°è¾¾Cåˆ—æ—¶æœ€ç»ˆä¹Ÿåªå‰©3æ¡å¤‡é€‰çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰è¶³å¤Ÿä¿¡æ¯æ–­å®šå“ªæ¡æ‰æ˜¯å…¨å±€æœ€çŸ­ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ç»§ç»­çœ‹EèŠ‚ç‚¹ï¼Œæ‰èƒ½å¾—å‡ºæœ€åçš„ç»“è®ºã€‚</p><p>åˆ°Eçš„è·¯å¾„ä¹Ÿåªæœ‰3ç§å¯èƒ½æ€§ï¼š</p><p><img src="/2020/07/08/viterbi-suan-fa/16.jpg"></p><p>Eç‚¹å·²ç»æ˜¯ç»ˆç‚¹äº†ï¼Œæˆ‘ä»¬ç¨å¾®å¯¹æ¯”ä¸€ä¸‹è¿™ä¸‰æ¡è·¯å¾„çš„æ€»é•¿åº¦å°±èƒ½çŸ¥é“å“ªæ¡æ˜¯æœ€çŸ­è·¯å¾„äº†ã€‚</p><p><img src="/2020/07/08/viterbi-suan-fa/17.jpg"></p><p>åœ¨æ•ˆç‡æ–¹é¢ç›¸å¯¹äºç²—æš´åœ°éå†æ‰€æœ‰è·¯å¾„ï¼Œviterbi ç»´ç‰¹æ¯”ç®—æ³•åˆ°è¾¾æ¯ä¸€åˆ—çš„æ—¶å€™éƒ½ä¼šåˆ é™¤ä¸ç¬¦åˆæœ€çŸ­è·¯å¾„è¦æ±‚çš„è·¯å¾„ï¼Œå¤§å¤§é™ä½æ—¶é—´å¤æ‚åº¦ã€‚</p><h2 id="å…¬å¼æ¨å¯¼"><a href="#å…¬å¼æ¨å¯¼" class="headerlink" title="å…¬å¼æ¨å¯¼"></a>å…¬å¼æ¨å¯¼</h2><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡</p><p><img src="/2020/07/08/viterbi-suan-fa/1.png"></p><p>è¿™ä¸ª$v _t(j)$è¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬çœ‹åˆ°äº†å‰ $t$ ä¸ª è§‚æµ‹å€¼ï¼Œé€šè¿‡äº†$t-1$ä¸ªèƒ½å¤Ÿå–å¾—æœ€å¤§æ¦‚ç‡çš„éšçŠ¶æ€ï¼Œä¸”ç¬¬tä¸ªçŠ¶æ€å€¼ä¸ºjçš„æ¦‚ç‡å€¼ã€‚</p><p>ä¸forwardç®—æ³•ç±»ä¼¼ï¼Œ$v _{t-1}$ä¸$v _t$ä¹‹é—´ä¹Ÿå­˜åœ¨ç€æŸç§é€’æ¨å…³ç³»ã€‚</p><p><img src="/2020/07/08/viterbi-suan-fa/2.png"></p><p>å…¶ä¸­ $a _{ij}$ è¡¨ç¤ºä»éšçŠ¶æ€i åˆ° éšçŠ¶æ€ $j$çš„è½¬æ¢æ¦‚ç‡, $b _j(o_t)$è¡¨ç¤ºä»éšçŠ¶æ€ $j$ ç”Ÿæˆè§‚æµ‹å€¼ $o _t$ çš„æ¦‚ç‡ã€‚</p><p>$max _ {j=1} ^N v _T(j) $</p><p>åˆå§‹åŒ–</p><p><img src="/2020/07/08/viterbi-suan-fa/3"></p><p>bt: backtrack,ä¸€å¼ äºŒç»´è¡¨æ ¼ï¼Œè®°å½•äº†å½“å‰ä½ç½®çš„ä¸Šä¸€ä¸ªéšçŠ¶æ€çš„å€¼ã€‚</p><p>é€’æ¨å…¬å¼</p><p><img src="/2020/07/08/viterbi-suan-fa/4.png"></p><p>æœ€ç»ˆç»“æœ</p><p><img src="/2020/07/08/viterbi-suan-fa/5.png"></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>â€‹       å¾ˆå¤šäººéƒ½ç”¨éšé©¬å°”ç§‘å¤«æ¨¡å‹æ¥å›ç­”viterbiç®—æ³•ï¼Œå…¶å®viterbiç®—æ³•åªæ˜¯è§£å†³éšé©¬ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼ˆæ±‚è§‚å¯Ÿåºåˆ—çš„æœ€å¯èƒ½çš„æ ‡æ³¨åºåˆ—ï¼‰çš„ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨äºviterbiç®—æ³•å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–æ–¹å¼å®ç°ï¼ˆå¦‚ç©·ä¸¾æ³•ï¼‰ï¼›è€Œviterbiç®—æ³•å¯ä»¥ç”¨äºè§£å†³éšé©¬ç¬¬ä¸‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç”¨äºè§£å†³å…¶ä»–é—®é¢˜ã€‚æ‰€ä»¥åƒä¸‡ä¸è¦æŠŠviterbiç®—æ³•å’Œéšé©¬å°”ç§‘å¤«æ¨¡å‹ç­‰ä»·äº†ã€‚</p><p>â€‹       viterbiç®—æ³•å…¶å®å°±æ˜¯å¤šæ­¥éª¤æ¯æ­¥å¤šé€‰æ‹©æ¨¡å‹çš„æœ€ä¼˜é€‰æ‹©é—®é¢˜ï¼Œå…¶åœ¨æ¯ä¸€æ­¥çš„æ‰€æœ‰é€‰æ‹©éƒ½ä¿å­˜äº†å‰ç»­æ‰€æœ‰æ­¥éª¤åˆ°å½“å‰æ­¥éª¤å½“å‰é€‰æ‹©çš„æœ€å°æ€»ä»£ä»·ï¼ˆæˆ–è€…æœ€å¤§ä»·å€¼ï¼‰ä»¥åŠå½“å‰ä»£ä»·çš„æƒ…å†µä¸‹å‰ç»§æ­¥éª¤çš„é€‰æ‹©ã€‚ä¾æ¬¡è®¡ç®—å®Œæ‰€æœ‰æ­¥éª¤åï¼Œé€šè¿‡å›æº¯çš„æ–¹æ³•æ‰¾åˆ°æœ€ä¼˜é€‰æ‹©è·¯å¾„ã€‚ç¬¦åˆè¿™ä¸ªæ¨¡å‹çš„éƒ½å¯ä»¥ç”¨viterbiç®—æ³•è§£å†³ï¼Œéšé©¬æ¨¡å‹çš„ç¬¬ä¸‰é—®é¢˜åˆšå¥½ç¬¦åˆè¿™ä¸ªæ¨¡å‹ï¼Œæ‰€ä»¥æ‰é‡‡ç”¨äº†viterbiç®—æ³•ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">run_viterbi</span><span class="token punctuation">(</span>emission_scores<span class="token punctuation">,</span> trans_scores<span class="token punctuation">,</span> start_scores<span class="token punctuation">,</span> end_scores<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Run the Viterbi algorithm.    N - number of tokens (length of sentence)    L - number of labels    As an input, you are given:    - Emission scores, as an NxL array    - Transition scores (Yp -> Yc), as an LxL array    - Start transition scores (S -> Y), as an Lx1 array    - End transition scores (Y -> E), as an Lx1 array    You have to return a tuple (s,y), where:    - s is the score of the best sequence    - y is the size N array/seq of integers representing the best sequence.    """</span>    L <span class="token operator">=</span> start_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">assert</span> end_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> L    <span class="token keyword">assert</span> trans_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> L    <span class="token keyword">assert</span> trans_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> L    <span class="token keyword">assert</span> emission_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> L    N <span class="token operator">=</span> emission_scores<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">## start</span>    scores <span class="token operator">=</span> <span class="token number">0.0</span> <span class="token operator">+</span> start_scores<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># L x 1 </span>    prevs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>N<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        emit_scores <span class="token operator">=</span> emission_scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># L x 1ã€€</span>        scores <span class="token operator">=</span> scores <span class="token operator">+</span> emit_scores <span class="token operator">+</span> trans_scores <span class="token comment" spellcheck="true"># L x L t-1çŠ¶æ€çš„å…¨éƒ¨åˆ†é‡ï¼‹å½“å‰tæ—¶åˆ»çš„å‘å°„çŠ¶æ€ï¼‹ä»t-ï¼‘è½¬ç§»åˆ°tçŠ¶æ€çš„å€¼</span>        prevs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>scores<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        scores <span class="token operator">=</span> scores<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># L x 1 </span>    scores <span class="token operator">=</span> <span class="token punctuation">(</span>scores<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> end_scores<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> emission_scores<span class="token punctuation">[</span>N<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># L ï¼ƒã€€æœ€åçš„scores </span>    y <span class="token operator">=</span> <span class="token punctuation">[</span>scores<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">## æ±‚æœ€åä½ç½®çš„æœ€å¤§å€¼ç´¢å¼•</span>    score <span class="token operator">=</span> scores<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æ±‚æœ€åä½ç½®çš„æœ€å¤§å€¼</span>    <span class="token keyword">for</span> indices <span class="token keyword">in</span> prevs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">##å€’å™ä»æœ€åä¸€ä¸ªå›æº¯æœ€ä¼˜çš„è·¯å¾„</span>        last_index <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        new_index <span class="token operator">=</span> indices<span class="token punctuation">[</span>last_index<span class="token punctuation">]</span>        y <span class="token operator">=</span> <span class="token punctuation">[</span>new_index<span class="token punctuation">]</span> <span class="token operator">+</span> y    <span class="token keyword">return</span> <span class="token punctuation">[</span>score<span class="token punctuation">,</span> y<span class="token punctuation">]</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">run_viterbi_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A simple tester for Viterbi algorithm.    This function generates a bunch of random emission and transition scores,    and computes the best sequence by performing a brute force search over all    possible sequences and scoring them. It then runs Viterbi code to see what    is the score and sequence returned by it.    Compares both the best sequence and its score to make sure Viterbi is correct.    """</span>    <span class="token keyword">from</span> viterbi <span class="token keyword">import</span> run_viterbi    <span class="token keyword">from</span> numpy <span class="token keyword">import</span> random    <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np    <span class="token keyword">from</span> itertools <span class="token keyword">import</span> product    maxN <span class="token operator">=</span> <span class="token number">7</span> <span class="token comment" spellcheck="true"># maximum length of a sentence (min is 1)</span>    maxL <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment" spellcheck="true"># maximum number of labels (min is 2)</span>    num_tests <span class="token operator">=</span> <span class="token number">1000</span> <span class="token comment" spellcheck="true"># number of sentences to generate</span>    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    tolerance <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span> <span class="token comment" spellcheck="true"># how close do the scores have to be?</span>    emission_var <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token comment" spellcheck="true"># variance of the gaussian generating emission scores</span>    trans_var <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token comment" spellcheck="true"># variance of the gaussian generating transition scores</span>    passed_y <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># how many times the correct sequence was predicted</span>    passed_s <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># how many times the correct score was returned</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_tests<span class="token punctuation">)</span><span class="token punctuation">:</span>        N <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> maxN<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>        L <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> maxL<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Generate the scores</span>        emission_scores <span class="token operator">=</span> random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> emission_var<span class="token punctuation">,</span> <span class="token punctuation">(</span>N<span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>        trans_scores <span class="token operator">=</span> random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> trans_var<span class="token punctuation">,</span> <span class="token punctuation">(</span>L<span class="token punctuation">,</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>        start_scores <span class="token operator">=</span> random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> trans_var<span class="token punctuation">,</span> L<span class="token punctuation">)</span>        end_scores <span class="token operator">=</span> random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> trans_var<span class="token punctuation">,</span> L<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># run viterbi</span>        <span class="token punctuation">(</span>viterbi_s<span class="token punctuation">,</span>viterbi_y<span class="token punctuation">)</span> <span class="token operator">=</span> run_viterbi<span class="token punctuation">(</span>emission_scores<span class="token punctuation">,</span> trans_scores<span class="token punctuation">,</span> start_scores<span class="token punctuation">,</span> end_scores<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print "Viterbi", viterbi_s, viterbi_y</span>        <span class="token comment" spellcheck="true"># compute the best sequence and score</span>        best_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        best_s <span class="token operator">=</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>inf        <span class="token keyword">for</span> y <span class="token keyword">in</span> product<span class="token punctuation">(</span>range<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># all possible ys</span>            <span class="token comment" spellcheck="true"># compute its score</span>            score <span class="token operator">=</span> <span class="token number">0.0</span>            score <span class="token operator">+=</span> start_scores<span class="token punctuation">[</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>N<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                score <span class="token operator">+=</span> trans_scores<span class="token punctuation">[</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>                score <span class="token operator">+=</span> emission_scores<span class="token punctuation">[</span>i<span class="token punctuation">,</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>            score <span class="token operator">+=</span> emission_scores<span class="token punctuation">[</span>N<span class="token number">-1</span><span class="token punctuation">,</span>y<span class="token punctuation">[</span>N<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            score <span class="token operator">+=</span> end_scores<span class="token punctuation">[</span>y<span class="token punctuation">[</span>N<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            <span class="token comment" spellcheck="true"># update the best</span>            <span class="token keyword">if</span> score <span class="token operator">></span> best_s<span class="token punctuation">:</span>                best_s <span class="token operator">=</span> score                best_y <span class="token operator">=</span> list<span class="token punctuation">(</span>y<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print "Brute", best_s, best_y</span>        <span class="token comment" spellcheck="true"># mismatch if any label prediction doesn't match</span>        match_y <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>best_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> viterbi_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> best_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>                match_y <span class="token operator">=</span> <span class="token boolean">False</span>        <span class="token keyword">if</span> match_y<span class="token punctuation">:</span> passed_y <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># the scores should also be very close</span>        <span class="token keyword">if</span> abs<span class="token punctuation">(</span>viterbi_s<span class="token operator">-</span>best_s<span class="token punctuation">)</span> <span class="token operator">&lt;</span> tolerance<span class="token punctuation">:</span>            passed_s <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Passed(y)"</span><span class="token punctuation">,</span> passed_y<span class="token operator">*</span><span class="token number">100.0</span><span class="token operator">/</span>num_tests<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Passed(s)"</span><span class="token punctuation">,</span> passed_s<span class="token operator">*</span><span class="token number">100.0</span><span class="token operator">/</span>num_tests<span class="token punctuation">)</span>    <span class="token keyword">assert</span> passed_y <span class="token operator">==</span> num_tests    <span class="token keyword">assert</span> passed_s <span class="token operator">==</span> num_tests<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    run_viterbi_test<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> è·¯å¾„è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NNLM</title>
      <link href="/2020/07/06/nnlm/"/>
      <url>/2020/07/06/nnlm/</url>
      
        <content type="html"><![CDATA[<h1 id="NNLM-åŸç†"><a href="#NNLM-åŸç†" class="headerlink" title="NNLM åŸç†"></a>NNLM åŸç†</h1><p>Paper: <a href="http://www.jmlr.org/papers/volume3/bengio03a/bengio03a.pdf">A Neural Probabilistic Language Model(2003)</a></p><p>æœ¬æ–‡ç®—æ˜¯è®­ç»ƒè¯­è¨€æ¨¡å‹çš„ç»å…¸ä¹‹ä½œï¼ŒBengio å°†ç¥ç»ç½‘ç»œå¼•å…¥è¯­è¨€æ¨¡å‹çš„è®­ç»ƒä¸­ï¼Œå¹¶å¾—åˆ°äº†è¯å‘é‡è¿™ä¸ªå‰¯äº§ç‰©ã€‚è¯å‘é‡å¯¹åé¢æ·±åº¦å­¦ä¹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æ–¹é¢æœ‰å¾ˆå¤§çš„è´¡çŒ®ï¼Œä¹Ÿæ˜¯è·å–è¯çš„è¯­ä¹‰ç‰¹å¾çš„æœ‰æ•ˆæ–¹æ³•</p><p>å…¶ä¸»è¦æ¶æ„ä¸ºä¸‰å±‚ç¥ç»ç½‘ç»œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2020/07/06/nnlm/1.webp"></p><p>ç°åœ¨çš„ä»»åŠ¡æ˜¯è¾“å…¥ wtâˆ’n+1,â€¦,wtâˆ’1 è¿™å‰ n-1 ä¸ªå•è¯ï¼Œç„¶åé¢„æµ‹å‡ºä¸‹ä¸€ä¸ªå•è¯ wt</p><p>æ•°å­¦ç¬¦å·è¯´æ˜ï¼š</p><ul><li>C(i)ï¼šå•è¯ w å¯¹åº”çš„è¯å‘é‡ï¼Œå…¶ä¸­ i ä¸ºè¯ w åœ¨æ•´ä¸ªè¯æ±‡è¡¨ä¸­çš„ç´¢å¼•</li><li>Cï¼šè¯å‘é‡ï¼Œå¤§å°ä¸º |V|Ã—m çš„çŸ©é˜µ</li><li>|V|ï¼šè¯æ±‡è¡¨çš„å¤§å°ï¼Œå³é¢„æ–™åº“ä¸­å»é‡åçš„å•è¯ä¸ªæ•°</li><li>mï¼šè¯å‘é‡çš„ç»´åº¦ï¼Œä¸€èˆ¬æ˜¯ 50 åˆ° 200</li><li>Hï¼šéšè—å±‚çš„ weight</li><li>dï¼šéšè—å±‚çš„ bias</li><li>Uï¼šè¾“å‡ºå±‚çš„ weight</li><li>bï¼šè¾“å‡ºå±‚çš„ bias</li><li>Wï¼šè¾“å…¥å±‚åˆ°è¾“å‡ºå±‚çš„ weight</li><li>hï¼šéšè—å±‚ç¥ç»å…ƒä¸ªæ•°</li></ul><p>è®¡ç®—æµç¨‹ï¼š</p><ol><li>é¦–å…ˆå°†è¾“å…¥çš„ n-1 ä¸ªå•è¯ç´¢å¼•è½¬ä¸ºè¯å‘é‡ï¼Œç„¶åå°†è¿™ n-1 ä¸ªè¯å‘é‡è¿›è¡Œ concatï¼Œå½¢æˆä¸€ä¸ª (n-1)*w çš„å‘é‡ï¼Œç”¨ X è¡¨ç¤º</li><li>å°† X é€å…¥éšè—å±‚è¿›è¡Œè®¡ç®—ï¼Œhiddenout=tanh(d+Xâˆ—H)</li><li>è¾“å‡ºå±‚å…±æœ‰ |V| ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ yi è¡¨ç¤ºé¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ i çš„æ¦‚ç‡ï¼Œy çš„è®¡ç®—å…¬å¼ä¸º y=b+Xâˆ—W+${ hidden } _{ out }$âˆ—U</li></ol><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># encoding: utf-8</span><span class="token triple-quoted-string string">'''@author: daiyizheng: (C) Copyright 2017-2019, Personal exclusive right.@contact: 387942239@qq.com@software: tool@application:@file: NNLM-torch.py@time: 2020-07-06 ä¸‹åˆ11:30@desc:'''</span><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Time : 2020-07-06 09:36</span><span class="token comment" spellcheck="true"># @Author : daiyizheng</span><span class="token comment" spellcheck="true"># @Site :</span><span class="token comment" spellcheck="true"># @File : NNLM.py</span><span class="token comment" spellcheck="true"># @Software: PyCharm</span><span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> Data<span class="token triple-quoted-string string">"""å®šä¹‰ç±»å‹"""</span>dtype <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensor<span class="token triple-quoted-string string">"""å®šä¹‰è¯æ±‡è¡¨"""</span>sentences <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"i like dog"</span><span class="token punctuation">,</span> <span class="token string">"i love coffee"</span><span class="token punctuation">,</span> <span class="token string">"i hate milk"</span><span class="token punctuation">]</span>word_list <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ['i', 'like', 'dog', 'dog', 'i', 'love', 'coffee', 'i', 'hate', 'milk']</span>word_list <span class="token operator">=</span> list<span class="token punctuation">(</span>set<span class="token punctuation">(</span>word_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ['i', 'like', 'dog', 'love', 'coffee', 'hate', 'milk']</span>word_dict <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;w: i for i, w in enumerate(word_list)&amp;#125; # &amp;#123;'i':0, 'like':1, 'dog':2, 'love':3, 'coffee':4, 'hate':5, 'milk':6&amp;#125;</span>number_dict <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;i: w for i, w in enumerate(word_list)&amp;#125; # &amp;#123;0:'i', 1:'like', 2:'dog', 3:'love', 4:'coffee', 5:'hate', 6:'milk'&amp;#125;</span>n_class <span class="token operator">=</span> len<span class="token punctuation">(</span>word_dict<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># number of Vocabulary, just like |V|, in this task n_class=7</span><span class="token comment" spellcheck="true"># NNLM(Neural Network Language Model) Parameter</span>n_step <span class="token operator">=</span> len<span class="token punctuation">(</span>sentences<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token comment" spellcheck="true"># n-1 in paper, look back n_step words and predict next word. In this task n_step=2</span>n_hidden <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># h in paper</span>m <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># m in paper, word embedding dim</span><span class="token keyword">def</span> <span class="token function">make_batch</span><span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">:</span>    input_batch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    target_batch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> sen <span class="token keyword">in</span> sentences<span class="token punctuation">:</span>        word <span class="token operator">=</span> sen<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>        input <span class="token operator">=</span> <span class="token punctuation">[</span>word_dict<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># [0, 1], [0, 3], [0, 5]</span>        target <span class="token operator">=</span> word_dict<span class="token punctuation">[</span>word<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 2, 4, 6</span>        input_batch<span class="token punctuation">.</span>append<span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [[0, 1], [0, 3], [0, 5]]</span>        target_batch<span class="token punctuation">.</span>append<span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [2, 4, 6]</span>    <span class="token keyword">return</span> input_batch<span class="token punctuation">,</span> target_batch<span class="token triple-quoted-string string">"""é¢„å¤„ç†æ•°æ®"""</span>input_data<span class="token punctuation">,</span> target_data <span class="token operator">=</span> make_batch<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""æ•°æ®è½¬ä¸ºlongtensor"""</span>input_data<span class="token punctuation">,</span> target_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span>target_data<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""æ•°æ®æ‰¹å¤„ç†"""</span>dataset <span class="token operator">=</span> Data<span class="token punctuation">.</span>TensorDataset<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> target_data<span class="token punctuation">)</span>loader <span class="token operator">=</span> Data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token boolean">True</span> <span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># dataset batch_size, shuffle</span><span class="token keyword">class</span> <span class="token class-name">NNLM</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>NNLM<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>C <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>n_class<span class="token punctuation">,</span> m<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>H <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_step <span class="token operator">*</span> m<span class="token punctuation">,</span> n_hidden<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_step <span class="token operator">*</span> m<span class="token punctuation">,</span> n_class<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>d <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_hidden<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>U <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_hidden<span class="token punctuation">,</span> n_class<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>b <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>n_class<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">'''        X: [batch_size, n_step]        '''</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>C<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [batch_size, n_step] => [batch_size, n_step, m]</span>        X <span class="token operator">=</span> X<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> n_step <span class="token operator">*</span> m<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [batch_size, n_step * m]</span>        hidden_out <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d <span class="token operator">+</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>H<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [batch_size, n_hidden]</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>b <span class="token operator">+</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>W<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>hidden_out<span class="token punctuation">,</span> self<span class="token punctuation">.</span>U<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [batch_size, n_class]</span>        <span class="token keyword">return</span> outputmodel <span class="token operator">=</span> NNLM<span class="token punctuation">(</span><span class="token punctuation">)</span>criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Training</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">for</span> batch_x<span class="token punctuation">,</span> batch_y <span class="token keyword">in</span> loader<span class="token punctuation">:</span>    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>    output <span class="token operator">=</span> model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># output : [batch_size, n_class], batch_y : [batch_size] (LongTensor, not one-hot)</span>    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch:'</span><span class="token punctuation">,</span> <span class="token string">'%04d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'cost ='</span><span class="token punctuation">,</span> <span class="token string">'&amp;#123;:.6f&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>loss<span class="token punctuation">)</span><span class="token punctuation">)</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Predict</span>predict <span class="token operator">=</span> model<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keepdim <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># Test</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>sen<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>n_step<span class="token punctuation">]</span> <span class="token keyword">for</span> sen <span class="token keyword">in</span> sentences<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'->'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>number_dict<span class="token punctuation">[</span>n<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> predict<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯­è¨€æ¨¡å‹ </tag>
            
            <tag> è¯å‘é‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Word2vec</title>
      <link href="/2020/07/05/word2vec/"/>
      <url>/2020/07/05/word2vec/</url>
      
        <content type="html"><![CDATA[<h1 id="Word2vec"><a href="#Word2vec" class="headerlink" title="Word2vec"></a>Word2vec</h1><p>Word2vecæ˜¯è°·æ­Œå›¢é˜Ÿåœ¨2013å¹´å¼€æºæ¨å‡ºçš„ä¸€ä¸ªä¸“é—¨ç”¨äºè·å–è¯å‘é‡çš„å·¥å…·åŒ…ï¼Œå…¶æ ¸å¿ƒç®—æ³•æ˜¯å¯¹NNLMè¿ç®—é‡æœ€å¤§çš„é‚£éƒ¨åˆ†è¿›è¡Œäº†æ•ˆç‡ä¸Šçš„æ”¹è¿›ï¼Œè®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="Word2vecåŸç†è§£æ"><a href="#Word2vecåŸç†è§£æ" class="headerlink" title="Word2vecåŸç†è§£æ"></a>Word2vecåŸç†è§£æ</h2><p>word2vecæœ‰ä¸¤ç§æ¨¡å‹â€“CBOWå’ŒSkip-gramï¼Œè¿™ä¸¤ä¸ªæ¨¡å‹ç›®çš„éƒ½æ˜¯é€šè¿‡è®­ç»ƒè¯­è¨€æ¨¡å‹ä»»åŠ¡ï¼Œå¾—åˆ°è¯å‘é‡ã€‚CBOWçš„è¯­è¨€æ¨¡å‹ä»»åŠ¡æ˜¯ç»™å®šä¸Šä¸‹æ–‡é¢„æµ‹å½“å‰è¯ï¼ŒSkip-gramçš„è¯­è¨€æ¨¡å‹ä»»åŠ¡æ˜¯æ ¹æ®å½“å‰è¯é¢„æµ‹å…¶ä¸Šä¸‹æ–‡ã€‚</p><p>Word2vecè¿˜æä¾›äº†ä¸¤ç§æ¡†æ¶â€“Hierarchical Softmaxå’ŒNegative-Samplingï¼Œæ‰€ä»¥word2vecæœ‰å››ç§å®ç°æ–¹å¼ï¼Œä¸‹é¢å°†å¯¹å…¶åŸç†è¿›è¡Œä»‹ç»ã€‚</p><h2 id="CBOW"><a href="#CBOW" class="headerlink" title="CBOW"></a>CBOW</h2><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>CBOWçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨ç»™å®šä¸Šä¸‹æ–‡ï¼Œé¢„æµ‹å½“å‰è¯ï¼Œå…¶ç»“æ„è¡¨ç¤ºä¸º</p><p><img src="/2020/07/05/word2vec/1.png">CBOWç»“æ„</p><p>æˆ‘ä»¬çŸ¥é“åŸºäºç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹çš„ç›®æ ‡å‡½æ•°é€šå¸¸æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œè¿™é‡ŒCBOWçš„ç›®æ ‡å‡½æ•°åº”è¯¥å°±æ˜¯</p><p><img src="/2020/07/05/word2vec/2.png"></p><p>å…¶ä¸­æ˜¯å•è¯çš„ä¸Šä¸‹æ–‡ï¼Œæ˜¯è¯å…¸ã€‚æ‰€ä»¥æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹åº”è¯¥å°±æ˜¯çš„æ„é€ ä¸Šï¼ŒNNLMå’ŒWord2vecçš„æœ¬è´¨åŒºåˆ«ä¹Ÿæ˜¯åœ¨äºè¯¥æ¡ä»¶æ¦‚ç‡å‡½æ•°çš„æ„é€ æ–¹å¼ä¸åŒã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h3 id="åŸºäºHierarchical-Softmax"><a href="#åŸºäºHierarchical-Softmax" class="headerlink" title="åŸºäºHierarchical Softmax"></a>åŸºäºHierarchical Softmax</h3><p>CBOWæ¨¡å‹çš„è®­ç»ƒä»»åŠ¡æ˜¯åœ¨ç»™å®šä¸Šä¸‹æ–‡ï¼Œé¢„æµ‹å½“å‰è¯ã€‚åŸºäºHierarchical Softmaxçš„CBOWç»“æ„ç›¸å½“äºåœ¨NNLMä¸Šçš„æ”¹è¿›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2020/07/05/word2vec/3.png">      </p><p>â€‹                                                    åŸºäºHierarchical Softmaxçš„CBOWæ¨¡å‹</p><p>CBOWæ¨¡å‹ä¸€å…±æ˜¯æœ‰ä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯è¾“å…¥å±‚ï¼ˆinput layerï¼‰ï¼ŒæŠ•å½±å±‚ï¼ˆprojection layerï¼‰å’Œè¾“å‡ºå±‚ï¼ˆoutput layerï¼‰ã€‚</p><p>è¾“å…¥å±‚ï¼šè¾“å…¥æ˜¯å½“å‰è¯çš„ä¸Šä¸‹æ–‡ï¼Œå…±2cä¸ªè¯å‘é‡</p><p>æŠ•å½±å±‚ï¼šæŠ•å½±å±‚å°†2cä¸ªè¯å‘é‡è¿›è¡Œç´¯åŠ ï¼Œå¾—åˆ°${ X }<em>{ w }$ï¼Œå³${ X }</em>{ w }=\sum { <em>{ i=1 }^{ 2c }{ v({ Countext(w) }</em>{ i }) } } $ï¼Œè¿™é‡Œä¸åŒ…å«å½“å‰è¯çš„å‘é‡è¡¨ç¤º</p><p>è¾“å‡ºå±‚ï¼šè¾“å‡ºæ˜¯ä¸€ä¸ªç”¨è¯­æ–™ä¸­å‡ºç°çš„è¯ä¸ºå¶å­ç»“ç‚¹æ„å»ºçš„Huffmanæ ‘ï¼Œç»“ç‚¹çš„æƒå€¼æ˜¯å„è¯åœ¨è¯­æ–™ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚å›¾ä¸­çš„Huffmanæ ‘å…±Nä¸ªç»“ç‚¹ï¼Œå¯¹åº”è¯­æ–™ä¸­çš„Nä¸ªè¯ï¼Œéå¶å­ç»“ç‚¹N-1ä¸ªï¼Œå³å›¾ä¸­æ ‡é»„çš„ã€‚</p><p>åŸºäºHierarchical Softmaxçš„CBOWæ¨¡å‹å’Œä¹‹å‰ä»‹ç»çš„NNLMçš„ä¸»è¦åŒºåˆ«ï¼š</p><ul><li>ä»è¾“å…¥å±‚åˆ°æŠ•å½±å±‚ï¼ŒCBOWé‡‡ç”¨çš„æ˜¯æ±‚å’Œï¼Œè€ŒNNLMæ˜¯æ‹¼æ¥</li><li>CBOWæ²¡æœ‰éšè—å±‚</li><li>è¾“å‡ºå±‚ï¼ŒåŸºäºHierarchical Softmaxçš„CBOWæ˜¯æ ‘å½¢ç»“æ„ï¼ŒNNLMæ˜¯çº¿æ€§ç»“æ„</li></ul><p>ä¹‹å‰è¯´è¿‡ï¼ŒNNLMçš„ä¸»è¦è¿ç®—é‡å°±æ˜¯åœ¨äºéšè—å±‚å’Œè¾“å‡ºå±‚çš„softmaxçš„è®¡ç®—é‡ï¼ŒåŸºäºHierarchical Softmaxçš„æ–¹æ³•é€šè¿‡å¯¹è¿™äº›å…³é”®ç‚¹è¿›è¡Œäº†é’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œå»æ‰äº†éšè—å±‚ï¼Œæ›´æ”¹äº†è¾“å‡ºç»“æ„ï¼Œå¤§å¤§æå‡äº†è¿ç®—æ•ˆç‡ã€‚ä¸‹é¢ä»‹ç»åŸºäºHierarchical Softmaxçš„CBOWæ˜¯å¦‚ä½•åˆ©ç”¨æ ‘ç»“æ„è®­ç»ƒå¾—åˆ°è¯å‘é‡çš„ã€‚</p><p>å¯¹äºhuffmançš„æŸä¸ªå¶å­ç»“ç‚¹ï¼Œå‡è®¾è¯¥ç»“ç‚¹å¯¹åº”è¯å…¸ä¸­çš„è¯wï¼Œå®šä¹‰ä»¥ä¸‹ç¬¦å·</p><ul><li>${ p } ^{ w }$ï¼šä»æ ¹ç»“ç‚¹å‡ºå‘åˆ°è¾¾å¯¹åº”çš„å¶å­ç»“ç‚¹çš„è·¯å¾„</li><li>${ l } ^{ w }$ï¼šè·¯å¾„${ p }^{ w }$ä¸­åŒ…å«çš„ç»“ç‚¹ä¸ªæ•°</li><li>${ p}  <em>{1} ^{ w },{ p } _{ 2 } ^{ w },{ p } _{ 3 } ^{ w }â€¦{ p } _{ { l } ^{ w } } ^{ w }$ï¼šè·¯å¾„${ p }^{ w }$ä¸­çš„${l}^{ w }$ä¸ªç»“ç‚¹ï¼Œå…¶ä¸­${ p } _{ 1 }^{ w }$ä»£è¡¨æ ¹ç»“ç‚¹ï¼Œ${ p }</em>{ { l }^{ w } }^{ w }$ä»£è¡¨è¯å¯¹åº”çš„ç»“ç‚¹</li><li>${ d }<em>{ 2 }^{ w },{ d }</em>{ 2 }^{ w },{ d }<em>{ 2 }^{ w }â€¦{ d }</em>{ 2 }^{ w }\in { 0,1} $ï¼šè¯wçš„Huffmanç¼–ç ï¼Œ${ l }^{ w }-1$ç”±ä½ç¼–ç æ„æˆï¼Œå³æ ¹ç»“ç‚¹ä¸å¯¹åº”ç¼–ç </li><li>${ \theta  }<em>{ 1 }^{ w },{ { \theta  } }</em>{ 1 }^{ w },{ { \theta  } }<em>{ 1 }^{ w }â€¦{ { \theta  } }</em>{ 1 }^{ w }\in { R }^{ m }$ï¼š${ p }^{ w }$è·¯å¾„ä¸­éå¶å­ç»“ç‚¹å¯¹åº”çš„å‘é‡ï¼Œ${ \theta  }_{ j }^{ w }$ä»£è¡¨è·¯å¾„${ p }^{ w }$ä¸­ç¬¬$j$ä¸ªéå¶å­ç»“ç‚¹å¯¹åº”çš„å‘é‡</li></ul><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹è¯´æ˜è¿ç®—åŸç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè€ƒè™‘å½“å‰è¯$w$=â€œè¶³çƒâ€ï¼Œé‚£ä¹ˆå›¾ä¸­çš„çº¢è‰²è¾¹ä¸²èµ·æ¥çš„5ä¸ªç»“ç‚¹å°±æ„æˆè·¯å¾„${ p }^{ w }$ï¼Œå…¶é•¿åº¦${ l }^{ w }=5$æ˜¯è·¯å¾„${ p }<em>{ 1 }^{ w },{ p }</em>{ 2 }^{ w },{ p }<em>{ 3 }^{ w },{ p }</em>{ 4 }^{ w },{ p }<em>{ 5 }^{ w }$çš„5ä¸ªç»“ç‚¹ï¼Œå…¶ä¸­å¯¹åº”çš„${ p }</em>{ 1 }^{ w }$æ˜¯æ ¹ç»“ç‚¹ï¼Œåˆ†åˆ«æ˜¯1ï¼Œ0ï¼Œ0ï¼Œ1ï¼Œå³å½“å‰è¯â€œè¶³çƒâ€çš„Huffmanç¼–ç ä¸º1001ï¼Œ${ \theta  }<em>{ 1 }^{ w },{ \theta  }</em>{ 2 }^{ w },{ \theta  }<em>{ 3 }^{ w },{ \theta  }</em>{ 4 }^{ w }$åˆ†åˆ«æ˜¯è·¯å¾„ä¸Š4ä¸ªéå¶å­ç»“ç‚¹å¯¹åº”çš„å‘é‡ã€‚</p><p><img src="/2020/07/05/word2vec/4.png">   </p><p>â€‹                                                           CBOWåŸç†ç¤ºä¾‹</p><p>æ‰€ä»¥ï¼Œè®²äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬çš„é‡ç‚¹$p(w|Countext(w))$ç©¶ç«Ÿæ˜¯æ€ä¹ˆæ„å»ºçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“è¯åº“é‡Œçš„æ¯ä¸€ä¸ªè¯éƒ½å¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªHuffmanç¼–ç ï¼Œå¦‚æœæŠŠHuffmanæ ‘æ¯ä¸€ä¸ªç»“ç‚¹éƒ½çœ‹æˆä¸€æ¬¡äºŒåˆ†ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­è¨€æ¨¡å‹çš„ä»»åŠ¡å°±å˜æˆè¾“å…¥ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—å½“å‰è¯çš„Huffmanç¼–ç å¯¹åº”çš„è·¯å¾„çš„æ¦‚ç‡æœ€å¤§ã€‚è¿™é‡Œçº¦å®šå°†ä¸€ä¸ªç»“ç‚¹è¿›è¡ŒäºŒåˆ†ç±»æ—¶ï¼Œåˆ†åˆ°å·¦è¾¹ä¸ºè´Ÿç±»ï¼Œåˆ†åˆ°å³è¾¹ä¸ºæ­£ç±»ï¼ˆä¸»è¦ä¸ºäº†å’Œæºç å¯¹åº”ï¼‰ï¼Œå³</p><p><img src="/2020/07/05/word2vec/5.png"></p><p>ç”±å‰é¢ä»‹ç»çš„é€»è¾‘å›å½’å¯ä»¥çŸ¥é“ï¼Œç»“ç‚¹åˆ†ä¸ºæ­£ç±»çš„æ¦‚ç‡æ˜¯</p><p><img src="/2020/07/05/word2vec/6.png"></p><p>æ‰€ä»¥åˆ†ä¸ºè´Ÿç±»çš„æ¦‚ç‡å°±æ˜¯$1-\theta ({ X }<em>{ w }^{ T }\Theta )$ã€‚è¿™é‡Œçš„${ X }</em>{ w }$å°±æ˜¯å½“å‰è¯$w$çš„ä¸Šä¸‹æ–‡é€šè¿‡æ±‚å’Œå¾—åˆ°çš„ï¼Œ$\Theta$å°±æ˜¯æ¯ä¸€ä¸ªç»“ç‚¹çš„${ \Theta }_{ i }^{ w }$ï¼Œæ˜¯å¾…è®­ç»ƒå‚æ•°ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼Œè¿˜æ˜¯å‰é¢è¯´çš„å½“å‰è¯æ˜¯â€œè¶³çƒâ€ï¼Œä»æ ¹ç»“ç‚¹å‡ºå‘åˆ°è¾¾è¿™ä¸ªè¯ä¸€å…±éœ€è¦ç»è¿‡4æ¬¡äºŒåˆ†ç±»</p><ul><li>ç¬¬ä¸€æ¬¡ï¼š$P({ d }<em>{ 2 }^{ w }|{ X }</em>{ w },{ \Theta  }<em>{ 1 }^{ w })=1-\sigma ({ X }</em>{ w }^{ T }{ \Theta  }_{ 1 }^{ w })$</li><li>ç¬¬äºŒæ¬¡ï¼š$P({ d }<em>{ 3 }^{ w }|{ X }</em>{ w },{ \Theta  }<em>{ 2 }^{ w })=\sigma ({ X }</em>{ w }^{ T }{ \Theta  }_{ 2 }^{ w })$</li><li>ç¬¬ä¸‰æ¬¡ï¼š$P({ d }<em>{ 4 }^{ w }|{ X }</em>{ w },{ \Theta  }<em>{ 3 }^{ w })=\sigma ({ X }</em>{ w }^{ T }{ \Theta  }_{ 3 }^{ w })$</li><li>ç¬¬å››æ¬¡ï¼š$P({ d }<em>{ 5 }^{ w }|{ X }</em>{ w },{ \Theta  }<em>{ 4 }^{ w })=1-\sigma ({ X }</em>{ w }^{ T }{ \Theta  }_{ 4 }^{ w })$</li></ul><p>æ‰€ä»¥å¯¹äºå½“å‰è¯â€œè¶³çƒâ€ï¼Œæˆ‘ä»¬çš„æ¡ä»¶æ¦‚ç‡å‡½æ•°ä¸º</p><p><img src="/2020/07/05/word2vec/7.png"></p><p>ç”±ä¸Šé¢çš„å°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•å‡ºä¸€èˆ¬çš„æ¡ä»¶æ¦‚ç‡å…¬å¼</p><p><img src="/2020/07/05/word2vec/8.png"></p><p>å…¶ä¸­</p><p><img src="/2020/07/05/word2vec/9.png"></p><p>å†™æˆæ•´ä½“è¡¨è¾¾å¼</p><p><img src="/2020/07/05/word2vec/10.png"></p><p>æ‰€ä»¥æˆ‘ä»¬è¦ä¼˜åŒ–çš„ç›®æ ‡å‡½æ•°å°±æ˜¯</p><p><img src="/2020/07/05/word2vec/11.png"></p><p>ä»¤</p><p><img src="/2020/07/05/word2vec/12.png"></p><p>ä½¿ç”¨éšæœºæ¢¯åº¦ä¸Šå‡æ³•è¿›è¡Œç›®æ ‡å‡½æ•°ä¼˜åŒ–ï¼Œä¸‹é¢æ¨å¯¼ä¸€ä¸‹æ¢¯åº¦çš„è®¡ç®—</p><p><img src="/2020/07/05/word2vec/13.png"></p><p>æ‰€ä»¥ï¼Œæ›´æ–°å‚æ•°æ—¶</p><p><img src="/2020/07/05/word2vec/14.png"></p><p>å…¶ä¸­ï¼Œ$\eta $æ˜¯å­¦ä¹ ç‡ã€‚</p><p>åŒç†å¯ä»¥è®¡ç®—å¾—åˆ°</p><p><img src="/2020/07/05/word2vec/15.png"></p><p>æˆ‘ä»¬æœ€ç»ˆæƒ³ä¼˜åŒ–çš„å‘é‡æ˜¯è¯è¡¨ä¸­çš„æ¯ä¸€ä¸ªè¯å‘é‡ï¼Œè€Œæ˜¯å½“å‰è¯ä¸Šä¸‹æ–‡çš„ç´¯åŠ ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•æ›´æ–°æ¯ä¸ªè¯çš„å‘é‡è¡¨ç¤ºå‘¢ï¼Ÿword2vecä¸­çš„åšæ³•å¾ˆç®€å•ç›´æ¥ï¼Œå°±æ˜¯å°†${ X }_{ w }$çš„æ¢¯åº¦å˜åŒ–ç­‰æ•ˆäºæ¯ä¸ªè¯çš„æ¢¯åº¦å˜åŒ–ï¼Œå³</p><p><img src="/2020/07/05/word2vec/16.png"></p><p>è‡³æ­¤,åŸºäºHierarchical Softmaxçš„CBOWæ¨¡å‹çš„åŸç†å°±ä»‹ç»å®Œäº†ï¼Œé€šè¿‡ä¸æ–­è®­ç»ƒå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è¯å‘é‡è¡¨ã€‚</p><h3 id="åŸºäºNegative-Sampling"><a href="#åŸºäºNegative-Sampling" class="headerlink" title="åŸºäºNegative-Sampling"></a>åŸºäºNegative-Sampling</h3><p>åŸºäºNegative-Samplingï¼ˆè´Ÿé‡‡æ ·ï¼ŒNEGï¼‰çš„æ–¹æ³•çš„ç›®çš„æ˜¯è¿›ä¸€æ­¥æå‡è®­ç»ƒé€Ÿåº¦ï¼ŒåŒæ—¶æ”¹å–„è¯å‘é‡çš„è´¨é‡ã€‚NEGä¸å†ä½¿ç”¨ç›¸å¯¹å¤æ‚çš„huffmanæ ‘ï¼Œè€Œæ˜¯ä½¿ç”¨ç®€å•çš„éšæœºè´Ÿé‡‡æ ·ï¼Œå¤§å¹…åº¦æå‡æ€§èƒ½ã€‚</p><p>CBOWæ˜¯åˆ©ç”¨ä¸Šä¸‹æ–‡é¢„æµ‹å½“å‰è¯ï¼Œé‚£ä¹ˆå°†å½“å‰è¯æ›¿æ¢ä¸ºå…¶ä»–è¯æ—¶ï¼Œå°±æ„æˆäº†ä¸€ä¸ªè´Ÿæ ·æœ¬ã€‚</p><p>ä¹¦é¢ä¸€ç‚¹ï¼Œå¯¹äºç»™å®šçš„$Context(w)$ï¼Œè¯$w$å°±æ˜¯ä¸€ä¸ªæ­£æ ·æœ¬ï¼Œå…¶ä»–è¯å°±æ˜¯è´Ÿæ ·æœ¬ï¼Œå‡è®¾æˆ‘ä»¬é€šè¿‡è´Ÿé‡‡æ ·æ–¹æ³•é€‰å–å¥½ä¸€ä¸ªå…³äºçš„è´Ÿæ ·æœ¬å­é›†$NEG(w)$ã€‚å¾—åˆ°æ ·æœ¬é›†åï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–</p><p><img src="/2020/07/05/word2vec/17.png"></p><p>å…¶ä¸­</p><p><img src="/2020/07/05/word2vec/18.png"></p><p>æ‰€ä»¥</p><p><img src="/2020/07/05/word2vec/19.png"></p><p>è¿™é‡Œï¼Œ${ X}<em>{ w }^{ T }$è¿˜æ˜¯ä»£è¡¨ä¸Šä¸‹æ–‡$Context(w)$çš„è¯å‘é‡ä¹‹å’Œï¼Œ${\Theta}^{u}$è¡¨ç¤ºè¯å¯¹åº”çš„ä¸€ä¸ªå¾…è®­ç»ƒè¾…åŠ©å‘é‡ã€‚ç›´è§‚ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯æœ€å¤§åŒ–${\sigma({X}</em>{w}^{T}{\Theta}^{w})}$çš„åŒæ—¶ï¼Œæœ€å°åŒ–${\sigma({X}_{w}^{T}{\Theta}^{u})}$ï¼Œå…¶ä¸­$u\in{NEG(w)}$ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§åŒ–æ­£æ ·æœ¬çš„æ¦‚ç‡çš„åŒæ—¶æœ€å°åŒ–è´Ÿæ ·æœ¬çš„æ¦‚ç‡ã€‚</p><p>å¯¹äºç»™å®šçš„è¯­æ–™åº“Cï¼Œæœ€ç»ˆçš„ç›®æ ‡å‡½æ•°æ˜¯</p><p><img src="/2020/07/05/word2vec/20.png"></p><p>ä¸ºäº†æ¨å¯¼æ¢¯åº¦æ›´æ–°çš„è¿‡ç¨‹ï¼Œä»¤</p><p><img src="/2020/07/05/word2vec/21.png"></p><p>æ‰€ä»¥</p><p><img src="/2020/07/05/word2vec/22.png"></p><p>åŒç†</p><p><img src="/2020/07/05/word2vec/23.png"></p><h2 id="Skip-gram"><a href="#Skip-gram" class="headerlink" title="Skip-gram"></a>Skip-gram</h2><h3 id="ç»“æ„-1"><a href="#ç»“æ„-1" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>Skip-gramçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨ç»™å®šçš„å½“å‰è¯${w}<em>{t}$ï¼Œé¢„æµ‹ä¸Šä¸‹æ–‡${w}</em>{t-2},{w}<em>{t-1},{w}</em>{t+1},{w}_{t+2}$ï¼Œå…¶ç»“æ„è¡¨ç¤ºä¸º</p><p><img src="/2020/07/05/word2vec/s1.png"></p><p>â€‹                                                  Skip-gramç»“æ„</p><p>æˆ‘ä»¬çŸ¥é“åŸºäºç¥ç»ç½‘ç»œçš„è¯­è¨€æ¨¡å‹çš„ç›®æ ‡å‡½æ•°é€šå¸¸æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œè¿™é‡ŒSkip-gramçš„ç›®æ ‡å‡½æ•°åº”è¯¥å°±æ˜¯</p><p><img src="/2020/07/05/word2vec/s2.png"></p><p>å…¶ä¸­$Context(w)$æ˜¯å•è¯$w$çš„ä¸Šä¸‹æ–‡ï¼Œ$C$æ˜¯è¯å…¸ã€‚æ‰€ä»¥æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹åº”è¯¥å°±æ˜¯$P(Context(w|w))$çš„æ„é€ ä¸Šã€‚</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="åŸºäºHierarchical-Softmax-1"><a href="#åŸºäºHierarchical-Softmax-1" class="headerlink" title="åŸºäºHierarchical Softmax"></a>åŸºäºHierarchical Softmax</h4><p>å‰é¢è¯´äº†ï¼ŒSkip-gramçš„è¯­è¨€æ¨¡å‹ä»»åŠ¡æ˜¯æ ¹æ®å½“å‰è¯é¢„æµ‹å…¶ä¸Šä¸‹æ–‡ï¼ŒåŸç†ä¸Šå’ŒCBOWå¾ˆç›¸ä¼¼ï¼ŒåŸºäºHierarchical Softmaxçš„Skip-gramçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2020/07/05/word2vec/s3.png">   </p><p>â€‹                                               åŸºäºHierarchical Softmaxçš„Skip-gramæ¨¡å‹</p><p>è¾“å…¥å±‚ï¼šä¸­å¿ƒè¯$w$çš„è¯å‘é‡$v(w)$</p><p>æŠ•å½±å±‚ï¼šæ’ç­‰æŠ•å½±ï¼Œåªæ˜¯ä¸ºäº†å’ŒCBOWæ¨¡å‹è¿›è¡Œå¯¹ç§°ç±»æ¯”</p><p>è¾“å‡ºå±‚ï¼šå’ŒCBOWä¸€æ ·ï¼Œæ˜¯ä¸€é¢—huffmanæ ‘</p><p>Skip-gramçš„é‡ç‚¹æ˜¯æ¡ä»¶æ¦‚ç‡å‡½æ•°$P(Context(w)|w)$çš„æ„é€ ï¼ŒSKip-gramä¸­å¯¹äºè¯¥æ¡ä»¶æ¦‚ç‡å‡½æ•°çš„å®šä¹‰ä¸º</p><p><img src="/2020/07/05/word2vec/s4.png"></p><p>æ‰€ä»¥ï¼ŒSkip-gramçš„ç›®æ ‡å‡½æ•°ä¸º</p><p><img src="/2020/07/05/word2vec/s5.png"></p><p>ä»¤</p><p><img src="/2020/07/05/word2vec/s6.png"></p><p>åˆ™</p><p><img src="/2020/07/05/word2vec/s7.png"></p><p>æ‰€ä»¥</p><p><img src="/2020/07/05/word2vec/s8.png"></p><p>åŒç†</p><p><img src="/2020/07/05/word2vec/s9.png"></p><h3 id="åŸºäº-Negative-Sampling"><a href="#åŸºäº-Negative-Sampling" class="headerlink" title="åŸºäº Negative-Sampling"></a>åŸºäº Negative-Sampling</h3><p>åŸºäºè´Ÿé‡‡æ ·çš„skip-gramæ¨¡å‹åŸºæœ¬ä¸å‰é¢åŸºäºè´Ÿé‡‡æ ·çš„CBOWæ¨å¯¼çš„ç±»ä¼¼ï¼Œç›®æ ‡å‡½æ•°ä¸º</p><p><img src="/2020/07/05/word2vec/s10.png"></p><p>ä¹Ÿå°±æ˜¯å½“ç»™å®šå½“å‰è¯æ—¶ï¼Œå¸Œæœ›å…¶ä¸Šä¸‹æ–‡$Context(w)$å‡ºç°çš„æ¦‚ç‡æœ€å¤§ï¼Œå…¶ä¸­</p><p><img src="/2020/07/05/word2vec/s11.png"></p><p>è¿™é‡Œ$g(u)$ä»£è¡¨çš„å°±æ˜¯ä¸Šä¸‹æ–‡$Context(w)$ä¸­æŸä¸ªè¯$u$å‡ºç°çš„æ¦‚ç‡ï¼Œ$NEG(u)$è¡¨ç¤ºå¤„ç†è¯$u$æ—¶ç”Ÿæˆçš„è´Ÿæ ·æœ¬å­é›†ï¼Œ$v(w)$æ˜¯è¾“å…¥çš„å½“å‰è¯ï¼Œ$\Theta^{z}$æ˜¯å¾…è®­ç»ƒçš„è¾…åŠ©å‘é‡ã€‚</p><p>æ‰€ä»¥</p><p><img src="/2020/07/05/word2vec/s12.png"></p><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œéœ€è¦å¯¹ä¸Šä¸‹æ–‡$Context(w)$ä¸­çš„æ¯ä¸€ä¸ªè¯åšä¸€æ¬¡è´Ÿé‡‡æ ·ã€‚å®é™…ä¸Šï¼Œä½œè€…åœ¨æºç å®ç°è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è¿™ä¹ˆåšï¼Œè€Œæ˜¯é’ˆå¯¹$w$è¿›è¡Œäº†$|Context(w)|$æ¬¡è´Ÿé‡‡æ ·ï¼Œè¿™æ ·ä¾èµ–ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°å˜æˆ</p><p><img src="/2020/07/05/word2vec/s13.png"></p><p>å…¶ä¸­</p><p><img src="/2020/07/05/word2vec/s14.png"></p><p>è¿™é‡Œ${NEG(w)}$è¡¨ç¤ºå¤„ç†è¯$\tilde { w } $æ—¶ç”Ÿæˆçš„è´Ÿé‡‡æ ·å­é›†ã€‚</p><p>æœ€ç»ˆçš„ç›®æ ‡å‡½æ•°å˜æˆ</p><p><img src="/2020/07/05/word2vec/s15.png"></p><p>è€ƒè™‘æ¢¯åº¦æ›´æ–°ï¼Œä»¤</p><p><img src="/2020/07/05/word2vec/s16.png"></p><p>æ‰€ä»¥</p><p><img src="/2020/07/05/word2vec/s17.png"></p><p>åŒç†</p><p><img src="/2020/07/05/word2vec/s18.png"></p><h2 id="Word2vecä¸å¯å¿½è§†çš„é—®é¢˜"><a href="#Word2vecä¸å¯å¿½è§†çš„é—®é¢˜" class="headerlink" title="Word2vecä¸å¯å¿½è§†çš„é—®é¢˜"></a>Word2vecä¸å¯å¿½è§†çš„é—®é¢˜</h2><p>â€‹     Word2vecç®—æ³•è™½ç„¶åœ¨å‰äº›å¹´å–å¾—äº†è‰¯å¥½çš„æ•ˆæœï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸è¶³ä¹‹å¤„ï¼Œå…¶ä¸­æœ€ä¸å¯å¿½è§†çš„é—®é¢˜å°±æ˜¯<strong>ä¸€è¯å¤šä¹‰</strong>çš„é—®é¢˜ã€‚Word2vecä¸­æœ€åå¯¹æ¯ä¸€ä¸ªè¯ç”Ÿæˆä¸€ä¸ªå›ºå®šçš„å‘é‡è¡¨ç¤ºï¼Œé‚£ä¹ˆå¯¹äºç›¸åŒå•è¯æœ‰å¤šä¸ªå«ä¹‰æ—¶ï¼Œå°±ä¸èƒ½å¾ˆå¥½çš„è§£å†³ã€‚æ¯”å¦‚bankï¼Œæ—¢æœ‰é“¶è¡Œçš„æ„æ€ï¼Œä¹Ÿæœ‰å²¸è¾¹çš„æ„æ€ï¼Œå½“ç®—æ³•çš„ç»“æœåªæœ‰ä¸€ä¸ªå›ºå®šå‘é‡å¯¹å…¶è¿›è¡Œè¡¨å¾æ—¶ï¼Œå¿…ç„¶å¯¼è‡´è¿™ä¸ªè¯çš„è¡¨å¾ä¸å¤Ÿå‡†ç¡®ã€‚</p><h2 id="PyTorch-ä»£ç å®ç°"><a href="#PyTorch-ä»£ç å®ç°" class="headerlink" title="PyTorch ä»£ç å®ç°"></a>PyTorch ä»£ç å®ç°</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> Datadtype <span class="token operator">=</span> torch<span class="token punctuation">.</span>FloatTensordevice <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""æ–‡æœ¬é¢„å¤„ç†"""</span>sentences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"jack like dog"</span><span class="token punctuation">,</span> <span class="token string">"jack like cat"</span><span class="token punctuation">,</span> <span class="token string">"jack like animal"</span><span class="token punctuation">,</span>  <span class="token string">"dog cat animal"</span><span class="token punctuation">,</span> <span class="token string">"banana apple cat dog like"</span><span class="token punctuation">,</span> <span class="token string">"dog fish milk like"</span><span class="token punctuation">,</span>  <span class="token string">"dog cat animal like"</span><span class="token punctuation">,</span> <span class="token string">"jack like apple"</span><span class="token punctuation">,</span> <span class="token string">"apple like"</span><span class="token punctuation">,</span> <span class="token string">"jack like banana"</span><span class="token punctuation">,</span>  <span class="token string">"apple banana jack movie book music like"</span><span class="token punctuation">,</span> <span class="token string">"cat dog hate"</span><span class="token punctuation">,</span> <span class="token string">"cat dog like"</span><span class="token punctuation">]</span>word_sequence <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ['jack', 'like', 'dog', 'jack', 'like', 'cat', 'animal',...]</span>vocab <span class="token operator">=</span> list<span class="token punctuation">(</span>set<span class="token punctuation">(</span>word_sequence<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># build words vocabulary</span>word2idx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;w: i for i, w in enumerate(vocab)&amp;#125; # &amp;#123;'jack':0, 'like':1,...&amp;#125;</span><span class="token triple-quoted-string string">"""æ¨¡å‹ç›¸å…³å‚æ•°"""</span><span class="token comment" spellcheck="true"># Word2Vec Parameters</span>batch_size <span class="token operator">=</span> <span class="token number">8</span>embedding_size <span class="token operator">=</span> <span class="token number">2</span>  <span class="token comment" spellcheck="true"># 2 dim vector represent one word</span>C <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># window size</span>voc_size <span class="token operator">=</span> len<span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""æ•°æ®é¢„å¤„ç†"""</span><span class="token comment" spellcheck="true"># 1.</span>skip_grams <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> idx <span class="token keyword">in</span> range<span class="token punctuation">(</span>C<span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_sequence<span class="token punctuation">)</span> <span class="token operator">-</span> C<span class="token punctuation">)</span><span class="token punctuation">:</span>  center <span class="token operator">=</span> word2idx<span class="token punctuation">[</span>word_sequence<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># center word</span>  context_idx <span class="token operator">=</span> list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>idx <span class="token operator">-</span> C<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> idx <span class="token operator">+</span> C <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># context word idx</span>  context <span class="token operator">=</span> <span class="token punctuation">[</span>word2idx<span class="token punctuation">[</span>word_sequence<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> context_idx<span class="token punctuation">]</span>  <span class="token keyword">for</span> w <span class="token keyword">in</span> context<span class="token punctuation">:</span>    skip_grams<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>center<span class="token punctuation">,</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2.</span><span class="token keyword">def</span> <span class="token function">make_data</span><span class="token punctuation">(</span>skip_grams<span class="token punctuation">)</span><span class="token punctuation">:</span>  input_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  output_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>skip_grams<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    input_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>voc_size<span class="token punctuation">)</span><span class="token punctuation">[</span>skip_grams<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    output_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>skip_grams<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> input_data<span class="token punctuation">,</span> output_data<span class="token comment" spellcheck="true"># 3.</span>input_data<span class="token punctuation">,</span> output_data <span class="token operator">=</span> make_data<span class="token punctuation">(</span>skip_grams<span class="token punctuation">)</span>input_data<span class="token punctuation">,</span> output_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>input_data<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span>output_data<span class="token punctuation">)</span>dataset <span class="token operator">=</span> Data<span class="token punctuation">.</span>TensorDataset<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> output_data<span class="token punctuation">)</span>loader <span class="token operator">=</span> Data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""æ„å»ºæ¨¡å‹"""</span><span class="token comment" spellcheck="true"># Model</span><span class="token keyword">class</span> <span class="token class-name">Word2Vec</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    super<span class="token punctuation">(</span>Word2Vec<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># W and V is not Traspose relationship</span>    self<span class="token punctuation">.</span>W <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>voc_size<span class="token punctuation">,</span> embedding_size<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>V <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>embedding_size<span class="token punctuation">,</span> voc_size<span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">(</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># X : [batch_size, voc_size] one-hot</span>    <span class="token comment" spellcheck="true"># torch.mm only for 2 dim matrix, but torch.matmul can use to any dim</span>    hidden_layer <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>W<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># hidden_layer : [batch_size, embedding_size]</span>    output_layer <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>hidden_layer<span class="token punctuation">,</span> self<span class="token punctuation">.</span>V<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># output_layer : [batch_size, voc_size]</span>    <span class="token keyword">return</span> output_layermodel <span class="token operator">=</span> Word2Vec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""è®­ç»ƒ"""</span><span class="token comment" spellcheck="true"># Training</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>batch_x<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>loader<span class="token punctuation">)</span><span class="token punctuation">:</span>        batch_x <span class="token operator">=</span> batch_x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        batch_y <span class="token operator">=</span> batch_y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span>        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> label <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">:</span>  W<span class="token punctuation">,</span> WT <span class="token operator">=</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>  x<span class="token punctuation">,</span>y <span class="token operator">=</span> float<span class="token punctuation">(</span>W<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> float<span class="token punctuation">(</span>W<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>  plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>label<span class="token punctuation">,</span> xy<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> xytext<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> textcoords<span class="token operator">=</span><span class="token string">'offset points'</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯­è¨€æ¨¡å‹ </tag>
            
            <tag> è¯å‘é‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNN(smapleRNN LSTM  GRU)</title>
      <link href="/2020/06/06/rnn/"/>
      <url>/2020/06/06/rnn/</url>
      
        <content type="html"><![CDATA[<h1 id="RNN-smapleRNN-LSTM-GRU"><a href="#RNN-smapleRNN-LSTM-GRU" class="headerlink" title="RNN(smapleRNN LSTM  GRU)"></a>RNN(smapleRNN LSTM  GRU)</h1><h3 id="çŸ­æœŸè®°å¿†"><a href="#çŸ­æœŸè®°å¿†" class="headerlink" title="çŸ­æœŸè®°å¿†"></a><strong>çŸ­æœŸè®°å¿†</strong></h3><p>RNNå—åˆ°çŸ­æœŸè®°å¿†çš„å½±å“ã€‚å¦‚æœåºåˆ—å¾ˆé•¿ï¼Œä»–ä»¬å°†å¾ˆéš¾å°†ä¿¡æ¯ä»è¾ƒæ—©çš„æ—¶é—´æ­¥ä¼ é€åˆ°åé¢çš„æ—¶é—´æ­¥ã€‚å› æ­¤ï¼Œå¦‚æœä½ å°è¯•å¤„ç†ä¸€æ®µæ–‡æœ¬è¿›è¡Œé¢„æµ‹ï¼ŒRNNå¯èƒ½ä¼šé—æ¼å¼€å¤´çš„é‡è¦ä¿¡æ¯ã€‚</p><p>åœ¨åå‘ä¼ æ’­æœŸé—´ï¼ŒRNNå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼ˆæ¢¯åº¦ç”¨äºæ›´æ–°ç¥ç»ç½‘ç»œæƒé‡çš„å€¼ï¼‰ã€‚æ¢¯æ¶ˆå¤±åº¦é—®é¢˜æ˜¯å½“æ¢¯åº¦åå‘ä¼ æ’­éšç€æ—¶é—´çš„æ¨æ¢¯åº¦é€æ¸æ”¶ç¼©ã€‚å¦‚æœæ¢¯åº¦å€¼å˜å¾—éå¸¸å°ï¼Œåˆ™ä¸ä¼šäº§ç”Ÿå¤ªå¤šçš„å­¦ä¹ ã€‚</p><p><img src="/2020/06/06/rnn/lstm_gru-1.jpg"></p><p>æ¢¯åº¦æ›´æ–°è§„åˆ™</p><p>å› æ­¤ï¼Œåœ¨é€’å½’ç¥ç»ç½‘ç»œä¸­ï¼Œè·å¾—å°æ¢¯åº¦æ›´æ–°çš„å±‚ä¼šåœæ­¢å­¦ä¹ ã€‚é‚£äº›é€šå¸¸æ˜¯è¾ƒæ—©çš„å±‚ã€‚å› ä¸ºè¿™äº›å±‚ä¸å†å­¦ä¹ ï¼ŒRNNä¼šå¿˜è®°å®ƒåœ¨è¾ƒé•¿åºåˆ—ä¸­çœ‹åˆ°çš„å†…å®¹ï¼Œå› æ­¤åªæœ‰çŸ­æœŸè®°å¿†ã€‚</p><h2 id="LSTMå’ŒGRUè§£å†³æ–¹æ¡ˆ"><a href="#LSTMå’ŒGRUè§£å†³æ–¹æ¡ˆ" class="headerlink" title="LSTMå’ŒGRUè§£å†³æ–¹æ¡ˆ"></a><strong>LSTMå’ŒGRUè§£å†³æ–¹æ¡ˆ</strong></h2><p>LSTMå’ŒGRUæ˜¯ä½œä¸ºçŸ­æœŸè®°å¿†çš„è§£å†³æ–¹æ¡ˆè€Œåˆ›å»ºçš„ã€‚å®ƒä»¬å…·æœ‰ç§°ä¸ºé—¨ï¼ˆgateï¼‰çš„å†…éƒ¨æœºåˆ¶ï¼Œå®ƒå¯ä»¥è°ƒèŠ‚ä¿¡æ¯æµã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-2.jpg"></p><p>è¿™äº›é—¨å¯ä»¥äº†è§£åºåˆ—ä¸­å“ªäº›æ•°æ®é‡è¦ä»¥è¿›è¡Œä¿ç•™æˆ–ä¸¢å¼ƒã€‚è¿™æ ·ï¼Œå®ƒå¯ä»¥å°†ç›¸å…³ä¿¡æ¯ä¼ é€’åˆ°é•¿åºåˆ—ä¸­è¿›è¡Œé¢„æµ‹ã€‚ç°æœ‰çš„åŸºäºRNNçš„å‡ ä¹æ‰€æœ‰æŠ€æœ¯ç»“æœéƒ½æ˜¯é€šè¿‡LSTMå’ŒGRUè¿™ä¸¤ä¸ªç½‘ç»œå®ç°çš„ã€‚LSTMå’ŒGRUè¿›è¡Œè¯­éŸ³è¯†åˆ«ï¼Œè¯­éŸ³åˆæˆå’Œæ–‡æœ¬ç”Ÿæˆï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸ºè§†é¢‘ç”Ÿæˆå­—å¹•ã€‚</p><p>å°†é€šè¿‡ç›´è§‚çš„è§£é‡Šå’Œæ’å›¾æ¥è¿›è¡Œè§£é‡Šï¼Œå°½é‡é¿å…ä½¿ç”¨æ•°å­¦ã€‚</p><h2 id="ç›´è§‰"><a href="#ç›´è§‰" class="headerlink" title="ç›´è§‰"></a>ç›´è§‰</h2><p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªæ€æƒ³å®éªŒå¼€å§‹ã€‚å‡è®¾ä½ åœ¨ç½‘ä¸ŠæŸ¥çœ‹è¯„è®ºæ¥å†³å®šä½ æ˜¯å¦è¦ä¹°Lifeéº¦ç‰‡ã€‚ä½ ä¼šé¦–å…ˆé˜…è¯»è¯„è®ºï¼Œç¡®å®šæŸäººè®¤ä¸ºéº¦ç‰‡å¥½ä¸å¥½</p><p><img src="/2020/06/06/rnn/lstm-gru-3.jpg"></p><p>å½“ä½ é˜…è¯»è¯„è®ºæ—¶ï¼Œä½ çš„å¤§è„‘ä¸‹æ„è¯†åœ°åªä¼šè®°ä½é‡è¦çš„å…³é”®è¯ã€‚ä½ ä¼šé€‰æ‹©â€œamazingâ€å’Œâ€œperfectly balanced breakfastâ€è¿™æ ·çš„è¯æ±‡ã€‚ä½ ä¸å¤ªå…³å¿ƒâ€œthisâ€ï¼Œâ€œgiveâ€ï¼Œâ€œallâ€ï¼Œâ€œshouldâ€ç­‰å­—æ ·ã€‚å¦‚æœæœ‹å‹ç¬¬äºŒå¤©é—®ä½ è¯„è®ºè¯´ä»€ä¹ˆï¼Œä½ ä¸€èˆ¬ä¸ä¼šä¸€å­—ä¸æ¼åœ°è®°ä½å®ƒã€‚ä½ å¯èƒ½è¿˜è®°å¾—ä¸»è¦è§‚ç‚¹ï¼Œæ¯”å¦‚â€œwill definitely be buying againâ€ã€‚å¦‚æœä½ æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆå…¶ä»–çš„å•è¯å°±ä¼šä»è®°å¿†ä¸­é€æ¸æ¶ˆå¤±ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-4.gif"></p><p>è¿™å°±æ˜¯LSTMæˆ–GRUçš„ä½œç”¨ã€‚å®ƒå¯ä»¥å­¦ä¹ åªä¿ç•™ç›¸å…³ä¿¡æ¯æ¥è¿›è¡Œé¢„æµ‹ï¼Œå¿˜è®°ä¸ç›¸å…³çš„æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®°å¾—çš„å•è¯è®©ä½ åˆ¤æ–­éº¦ç‰‡æ˜¯å¥½çš„ã€‚</p><h2 id="RNNçš„å›é¡¾"><a href="#RNNçš„å›é¡¾" class="headerlink" title="RNNçš„å›é¡¾"></a>RNNçš„å›é¡¾</h2><p>ä¸ºäº†ç†è§£LSTMæˆ–GRUå¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹RNNã€‚RNNçš„å·¥ä½œåŸç†æ˜¯ï¼šç¬¬ä¸€ä¸ªè¯è¢«è½¬æ¢æˆæœºå™¨å¯è¯»çš„å‘é‡ã€‚ç„¶åRNNé€ä¸ªå¤„ç†å‘é‡åºåˆ—ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-2.gif"></p><p>é€ä¸ªå¤„ç†åºåˆ—</p><p>å¤„ç†æ—¶ï¼Œå®ƒå°†å…ˆå‰çš„éšè—çŠ¶æ€ä¼ é€’ç»™åºåˆ—çš„ä¸‹ä¸€æ­¥ã€‚éšè—çŠ¶æ€å……å½“ç¥ç»ç½‘ç»œçš„è®°å¿†ã€‚å®ƒä¿å­˜ç€ç½‘ç»œä»¥å‰è§è¿‡çš„æ•°æ®ä¿¡æ¯ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-5.gif"></p><p>å°†éšè—çŠ¶æ€ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥</p><p>è®©æˆ‘ä»¬è§‚å¯ŸRNNçš„ä¸€ä¸ªå•å…ƒæ ¼ï¼Œçœ‹çœ‹å¦‚ä½•è®¡ç®—éšè—çŠ¶æ€ã€‚é¦–å…ˆï¼Œå°†è¾“å…¥å’Œå…ˆå‰éšè—çŠ¶æ€ç»„åˆæˆä¸€ä¸ªå‘é‡ã€‚è¿™ä¸ªå‘é‡ç°åœ¨å«æœ‰å½“å‰è¾“å…¥å’Œå…ˆå‰è¾“å…¥çš„ä¿¡æ¯ã€‚å‘é‡ç»è¿‡tanhæ¿€æ´»ï¼Œè¾“å‡ºæ–°çš„éšè—çŠ¶æ€ï¼Œæˆ–ç½‘ç»œçš„è®°å¿†ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-6.gif"></p><h2 id="TANHæ¿€æ´»"><a href="#TANHæ¿€æ´»" class="headerlink" title="TANHæ¿€æ´»"></a>TANHæ¿€æ´»</h2><p>tanhæ¿€æ´»ç”¨äºå¸®åŠ©è°ƒèŠ‚æµç»ç½‘ç»œçš„å€¼ã€‚tanhå‡½æ•°å°†å€¼å‹ç¼©åœ¨-1å’Œ1ä¹‹é—´ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-7.webp"></p><p>Tanhå°†å€¼å‹ç¼©åˆ°-1å’Œ1ä¹‹é—´</p><p>å½“å‘é‡æµç»ç¥ç»ç½‘ç»œæ—¶ï¼Œç”±äºå„ç§æ•°å­¦è¿ç®—ï¼Œå®ƒç»å†äº†è®¸å¤šå˜æ¢ã€‚å‡è®¾ä¸€ä¸ªå€¼è¿ç»­ä¹˜ä»¥3ã€‚ä½ å¯ä»¥çœ‹åˆ°æŸäº›å€¼å¦‚ä½•çˆ†ç‚¸å¢é•¿çš„ï¼Œå¯¼è‡´å…¶ä»–å€¼çœ‹èµ·æ¥å¾®ä¸è¶³é“ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-8.gif"></p><p>æ²¡æœ‰tanhçš„çŸ¢é‡å˜æ¢</p><p>tanhå‡½æ•°ç¡®ä¿å€¼åœ¨-1å’Œ1ä¹‹é—´ï¼Œä»è€Œè°ƒèŠ‚ç¥ç»ç½‘ç»œçš„è¾“å‡ºã€‚ä½ å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç›¸åŒå€¼é€šè¿‡tanhå‡½æ•°ä¿æŒç•Œé™ä¹‹é—´ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-9.webp"></p><p>ä½¿ç”¨tanhçš„çŸ¢é‡å˜æ¢</p><p>è¿™æ˜¯ä¸€ä¸ªRNNã€‚å®ƒå†…éƒ¨çš„æ“ä½œå¾ˆå°‘ï¼Œä½†åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼ˆå¦‚çŸ­åºåˆ—ï¼‰å·¥ä½œå¾—å¾ˆå¥½ã€‚RNNä½¿ç”¨çš„è®¡ç®—èµ„æºæ¯”å®ƒçš„è¿›åŒ–å˜ä½“LSTMå’ŒGRUè¦å°‘å¾—å¤šã€‚</p><h2 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h2><p>LSTMå…·æœ‰ä¸RNNç±»ä¼¼çš„æ§åˆ¶æµã€‚å®ƒåœ¨å‰å‘ä¼ æ’­æ—¶å¤„ç†ä¼ é€’ä¿¡æ¯çš„æ•°æ®ã€‚åŒºåˆ«åœ¨äºLSTMå•å…ƒå†…çš„æ“ä½œã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-10.jpg"></p><p>LSTMå•å…ƒåŠå…¶æ“ä½œ</p><p>è¿™äº›æ“ä½œç”¨äºå…è®¸LSTMä¿ç•™æˆ–å¿˜è®°ä¿¡æ¯ã€‚è¿™äº›æ“ä½œå¯èƒ½ä¼šæœ‰ç‚¹éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é€æ­¥ä»‹ç»è¿™äº›å®ƒä»¬ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><p>LSTMçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å•å…ƒçŠ¶æ€ï¼ˆcell stateï¼‰ï¼Œå®ƒæ˜¯å¤šç§ä¸åŒçš„é—¨ã€‚å•å…ƒçŠ¶æ€å……å½“ä¼ è¾“çš„é«˜é€Ÿå…¬è·¯ï¼Œåœ¨åºåˆ—é“¾ä¸­ä¼ é€’ç›¸å…³ä¿¡æ¯ã€‚ä½ å¯ä»¥å°†å…¶è§†ä¸ºç½‘ç»œçš„è®°å¿†ã€‚ç†è®ºä¸Šï¼Œå•å…ƒçŠ¶æ€å¯ä»¥åœ¨åºåˆ—çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹ä¸­æºå¸¦ç›¸å…³ä¿¡æ¯ã€‚å› æ­¤ï¼Œå³ä½¿æ¥è‡ªè¾ƒæ—©æ—¶é—´æ­¥çš„ä¿¡æ¯ä¹Ÿå¯ç”¨äºè¾ƒæ™šæ—¶é—´æ­¥ï¼Œä»è€Œå‡å°‘çŸ­æœŸè®°å¿†çš„å½±å“ã€‚éšç€å•å…ƒçŠ¶æ€ç»§ç»­è¿›è¡Œï¼Œä¿¡æ¯é€šè¿‡é—¨è¢«æ·»åŠ æˆ–ç§»é™¤åˆ°å•å…ƒçŠ¶æ€ã€‚é—¨æ˜¯ä¸åŒçš„ç¥ç»ç½‘ç»œï¼Œç”¨æ¥å†³å®šå“ªäº›ä¿¡æ¯å¯ä»¥å…è®¸è¿›å…¥å•å…ƒçŠ¶æ€ã€‚åœ¨è®­ç»ƒä¸­ï¼Œé—¨å¯ä»¥çŸ¥é“å“ªäº›ä¿¡æ¯æ˜¯éœ€è¦ä¿å­˜æˆ–å¿˜è®°çš„ã€‚</p><h2 id="SIGMOID"><a href="#SIGMOID" class="headerlink" title="SIGMOID"></a>SIGMOID</h2><p>â€œé—¨â€åŒ…æ‹¬sigmoidæ¿€æ´»ã€‚å®ƒç±»ä¼¼äºtanhæ¿€æ´»ï¼Œä½†ä¸æ˜¯åœ¨-1å’Œ1ä¹‹é—´å‹ç¼©å€¼ï¼Œè€Œæ˜¯åœ¨0å’Œ1ä¹‹é—´å–å€¼ã€‚è¿™æœ‰åŠ©äºæ›´æ–°æˆ–å¿˜è®°æ•°æ®ï¼Œå› ä¸ºä»»ä½•æ•°å­—ä¹˜ä»¥0éƒ½æ˜¯0ï¼Œä½¿å€¼æ¶ˆå¤±æˆ–è€…è¯´è¢«â€œé—å¿˜â€ã€‚ä»»ä½•æ•°å­—ä¹˜ä»¥1éƒ½æ˜¯ç›¸åŒçš„å€¼ï¼Œå› æ­¤å€¼ä¿æŒç›¸åŒâ€ã€‚ç½‘ç»œå¯ä»¥äº†è§£å“ªäº›æ•°æ®ä¸é‡è¦å¯ä»¥è¢«é—å¿˜ï¼Œæˆ–è€…å“ªäº›æ•°æ®éœ€è¦ä¿å­˜ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-11.gif"></p><p>Sigmoidå°†å€¼å‹ç¼©è‡³0å’Œ1ä¹‹é—´</p><p>è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸åŒçš„å¤§é—¨åœ¨åšä»€ä¹ˆï¼Œä¸æ˜¯å—ï¼Ÿå› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªä¸åŒçš„é—¨æ¥è°ƒèŠ‚LSTMå•å…ƒä¸­çš„ä¿¡æ¯æµã€‚å¿˜è®°é—¨ï¼Œè¾“å…¥é—¨å’Œè¾“å‡ºé—¨ã€‚</p><h2 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a>é—å¿˜é—¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»‹ç»é—å¿˜é—¨ï¼ˆforget gateï¼‰ã€‚æ­¤é—¨å†³å®šåº”ä¸¢å¼ƒæˆ–ä¿ç•™å“ªäº›ä¿¡æ¯ã€‚æ¥è‡ªå…ˆå‰éšè—çŠ¶æ€å’Œæ¥è‡ªå½“å‰è¾“å…¥çš„ä¿¡æ¯é€šè¿‡sigmoidå‡½æ•°ä¼ é€’ã€‚å€¼ä»‹äº0å’Œ1ä¹‹é—´ã€‚è¶Šæ¥è¿‘0è¶Šå®¹æ˜“é—å¿˜ï¼Œè¶Šæ¥è¿‘1åˆ™æ„å‘³ç€è¦ä¿ç•™ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-12.webp"></p><p>é—å¿˜é—¨æ“ä½œ</p><h2 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a>è¾“å…¥é—¨</h2><p>è¦æ›´æ–°å•å…ƒçŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥é—¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å…ˆå‰çš„éšè—çŠ¶æ€å’Œå½“å‰è¾“å…¥ä¼ é€’ç»™sigmoidå‡½æ•°ã€‚è¿™å†³å®šäº†é€šè¿‡å°†å€¼è½¬æ¢ä¸º0åˆ°1æ¥æ›´æ–°å“ªäº›å€¼ã€‚0è¡¨ç¤ºä¸é‡è¦ï¼Œ1è¡¨ç¤ºé‡è¦ã€‚ä½ è¿˜å°†éšè—çŠ¶æ€å’Œå½“å‰è¾“å…¥ä¼ é€’ç»™tanhå‡½æ•°ï¼Œå°†å®ƒä»¬å‹ç¼©åˆ°-1å’Œ1ä¹‹é—´ä»¥å¸®åŠ©è°ƒèŠ‚ç½‘ç»œã€‚ç„¶åå°†tanhè¾“å‡ºä¸sigmoidè¾“å‡ºç›¸ä¹˜ã€‚sigmoidè¾“å‡ºå°†å†³å®šå“ªäº›ä¿¡æ¯å¾ˆé‡è¦ï¼Œéœ€è¦tanhè¾“å‡ºä¿å­˜ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-13.webp"></p><p>è¾“å…¥é—¨æ“ä½œ</p><h2 id="å•å…ƒçŠ¶æ€"><a href="#å•å…ƒçŠ¶æ€" class="headerlink" title="å•å…ƒçŠ¶æ€"></a>å•å…ƒçŠ¶æ€</h2><p>ç°åœ¨æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è®¡ç®—å•å…ƒçŠ¶æ€ã€‚é¦–å…ˆï¼Œå•å…ƒçŠ¶æ€é€ç‚¹ä¹˜ä»¥é—å¿˜å‘é‡ã€‚å¦‚æœå®ƒä¹˜ä»¥æ¥è¿‘0çš„å€¼ï¼Œåˆ™æœ‰å¯èƒ½åœ¨å•å…ƒçŠ¶æ€ä¸­ä¸¢å¼ƒå€¼ã€‚ç„¶åæˆ‘ä»¬ä»è¾“å…¥é—¨è·å–è¾“å‡ºå¹¶è¿›è¡Œé€ç‚¹åŠ æ³•ï¼Œå°†å•å…ƒçŠ¶æ€æ›´æ–°ä¸ºç¥ç»ç½‘ç»œå‘ç°ç›¸å…³çš„æ–°å€¼ã€‚è¿™å°±å¾—åˆ°äº†æ–°çš„å•å…ƒçŠ¶æ€ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-14.webp"></p><p>è®¡ç®—ç»†èƒçŠ¶æ€</p><h2 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h2><p>æœ€åæˆ‘ä»¬æœ‰è¾“å‡ºé—¨ã€‚è¾“å‡ºé—¨å†³å®šä¸‹ä¸€ä¸ªéšè—çŠ¶æ€æ˜¯ä»€ä¹ˆã€‚è¯·è®°ä½ï¼Œéšè—çŠ¶æ€åŒ…å«æœ‰å…³å…ˆå‰è¾“å…¥çš„ä¿¡æ¯ã€‚éšè—çŠ¶æ€ä¹Ÿç”¨äºé¢„æµ‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†å…ˆå‰çš„éšè—çŠ¶æ€å’Œå½“å‰è¾“å…¥ä¼ é€’ç»™sigmoidå‡½æ•°ã€‚ç„¶åæˆ‘ä»¬å°†æ–°çš„å•å…ƒçŠ¶æ€ä¼ é€’ç»™tanhå‡½æ•°ã€‚å°†tanhè¾“å‡ºä¸sigmoidè¾“å‡ºç›¸ä¹˜ï¼Œä»¥å†³å®šéšè—çŠ¶æ€åº”æºå¸¦çš„ä¿¡æ¯ã€‚å®ƒçš„è¾“å‡ºæ˜¯éšè—çŠ¶æ€ã€‚ç„¶åå°†æ–°çš„å•å…ƒçŠ¶æ€å’Œæ–°çš„éšè—çŠ¶æ€ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-15.gif"></p><p>è¾“å‡ºé—¨æ“ä½œ</p><p>å›é¡¾ä¸€ä¸‹ï¼Œé—å¿˜é—¨å†³å®šäº†å“ªäº›å†…å®¹ä¸å‰é¢çš„æ—¶é—´æ­¥ç›¸å…³ã€‚è¾“å…¥é—¨å†³å®šäº†ä»å½“å‰æ—¶é—´æ­¥æ·»åŠ å“ªäº›ä¿¡æ¯ã€‚è¾“å‡ºé—¨å†³å®šä¸‹ä¸€ä¸ªéšè—çŠ¶æ€åº”è¯¥æ˜¯ä»€ä¹ˆã€‚</p><h2 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h2><p>é€šè¿‡æŸ¥çœ‹ä»£ç æœ‰äº›äººå¯ä»¥æ›´å¥½çš„ç†è§£ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨pythonä¼ªä»£ç çš„ä¾‹å­ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-16.jpg"></p><p>pythonä¼ªä»£ç </p><p>å°±æ˜¯è¿™äº›ï¼LSTMç½‘ç»œçš„æ§åˆ¶æµç¨‹æ˜¯å‡ ä¸ªå¼ é‡æ“ä½œå’Œä¸€ä¸ªforå¾ªç¯ã€‚ä½ å¯ä»¥ä½¿ç”¨éšè—çŠ¶æ€è¿›è¡Œé¢„æµ‹ã€‚ç»“åˆæ‰€æœ‰è¿™äº›æœºåˆ¶ï¼ŒLSTMèƒ½å¤Ÿé€‰æ‹©åœ¨åºåˆ—å¤„ç†æœŸé—´éœ€è¦è®°ä½æˆ–å¿˜è®°å“ªäº›ä¿¡æ¯ã€‚</p><h2 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h2><p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“LSTMæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°çœ‹ä¸€ä¸‹GRUã€‚GRUæ˜¯æ–°ä¸€ä»£RNNï¼Œä¸LSTMéå¸¸ç›¸ä¼¼ã€‚GRUä¸ä½¿ç”¨å•å…ƒçŠ¶æ€ï¼Œè€Œæ˜¯ä½¿ç”¨éšè—çŠ¶æ€æ¥ä¼ è¾“ä¿¡æ¯ã€‚å®ƒä¹Ÿåªæœ‰ä¸¤ä¸ªé—¨ï¼Œä¸€ä¸ªé‡ç½®é—¨å’Œä¸€ä¸ªæ›´æ–°é—¨ï¼ˆreset gate and update gateï¼‰ã€‚</p><p><img src="/2020/06/06/rnn/lstm-gru-17.jpg"></p><p>GRUå•å…ƒå’Œå®ƒçš„é—¨</p><h2 id="æ›´æ–°é—¨"><a href="#æ›´æ–°é—¨" class="headerlink" title="æ›´æ–°é—¨"></a>æ›´æ–°é—¨</h2><p>æ›´æ–°é—¨çš„ä½œç”¨ç±»ä¼¼äºLSTMçš„é—å¿˜å’Œè¾“å…¥é—¨ã€‚å®ƒå†³å®šè¦ä¸¢å¼ƒå“ªäº›ä¿¡æ¯å’Œè¦æ·»åŠ å“ªäº›æ–°ä¿¡æ¯ã€‚</p><h2 id="é‡ç½®é—¨"><a href="#é‡ç½®é—¨" class="headerlink" title="é‡ç½®é—¨"></a>é‡ç½®é—¨</h2><p>é‡ç½®é—¨æ˜¯å¦ä¸€ä¸ªç”¨æ¥å†³å®šè¦å¿˜è®°å¤šå°‘è¿‡å»çš„ä¿¡æ¯çš„é—¨ã€‚</p><p>è¿™å°±æ˜¯GRUã€‚GRUçš„å¼ é‡æ“ä½œè¾ƒå°‘ï¼›å› æ­¤ï¼Œä»–ä»¬çš„è®­ç»ƒé€Ÿåº¦è¦æ¯”LSTMå¿«ä¸€äº›ã€‚ä½†è¿˜è¯´ä¸æ¸…å“ªä¸ªæ›´å¥½ã€‚ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆé€šå¸¸éƒ½ä¼šå°è¯•ï¼Œä»¥ç¡®å®šå“ªä¸€ä¸ªæ›´é€‚åˆä»–ä»¬çš„ç”¨ä¾‹ã€‚</p><h2 id="lstmçš„å˜ç§gruå…¬å¼"><a href="#lstmçš„å˜ç§gruå…¬å¼" class="headerlink" title="lstmçš„å˜ç§gruå…¬å¼"></a>lstmçš„å˜ç§gruå…¬å¼</h2><p>ç°åœ¨æ¥è®²è¿°lstmçš„å˜ç§ï¼šå¾ªç¯é—¨å•å…ƒï¼ˆGated Recurrent Unitï¼ŒGRUï¼‰ï¼Œç”± <a href="https://link.zhihu.com/?target=http://arxiv.org/pdf/1406.1078v3.pdf">Cho, et al. (2014)</a>æå‡ºã€‚å®ƒç»„åˆäº†é—å¿˜é—¨å’Œè¾“å…¥é—¨åˆ°ä¸€ä¸ªå•ç‹¬çš„â€œæ›´æ–°é—¨â€ä¸­ã€‚å®ƒä¹Ÿåˆå¹¶äº†cell stateå’Œhidden stateï¼Œå¹¶ä¸”åšäº†ä¸€äº›å…¶ä»–çš„æ”¹å˜ã€‚ç»“æœæ¨¡å‹æ¯”æ ‡å‡†LSTMæ¨¡å‹æ›´ç®€å•ï¼Œå¹¶ä¸”æ­£è¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œä¸‹é¢è¯¦ç»†è¯´æ˜ï¼š</p><p><img src="/2020/06/06/rnn/lstm-gru-18.jpg"></p><p>é¦–å…ˆä»‹ç»GRUçš„ä¸¤ä¸ªé—¨ï¼Œåˆ†åˆ«æ˜¯reset gate $ r_{ t }$å’Œ<code>update gate</code>  $z_{ t }$ï¼Œè®¡ç®—æ–¹æ³•å’ŒLSTMä¸­é—¨çš„è®¡ç®—æ–¹æ³•ä¸€è‡´ï¼š</p><p><img src="/2020/06/06/rnn/lstm-gru-19.jpg"></p><p>ç„¶åæ˜¯è®¡ç®—å€™é€‰éšè—å±‚ï¼ˆcandidate hidden layerï¼‰ $ \overset \sim{h_t}  $ï¼Œè¿™ä¸ªå€™é€‰éšè—å±‚ å’ŒLSTMä¸­çš„$\overset { \sim  }{ c } _{ t }$æ˜¯ç±»ä¼¼ï¼Œå¯ä»¥çœ‹æˆæ˜¯å½“å‰æ—¶åˆ»çš„æ–°ä¿¡æ¯ï¼Œå…¶ä¸­  $ r_t $ç”¨æ¥æ§åˆ¶éœ€è¦ ä¿ç•™å¤šå°‘ä¹‹å‰çš„è®°å¿†ï¼Œæ¯”å¦‚å¦‚æœ  $ r_{ t }$ä¸º0ï¼Œé‚£ä¹ˆ $\overset { \sim  }{ h }  _{ t }$ åªåŒ…å«å½“å‰è¯çš„ä¿¡æ¯ï¼š</p><p><img src="/2020/06/06/rnn/lstm-gru-20.jpg"></p><p>æœ€å  $z_{ t }$ æ§åˆ¶éœ€è¦ä»å‰ä¸€æ—¶åˆ»çš„éšè—å±‚  ${ h }_{ t-1 }$ä¸­é—å¿˜å¤šå°‘ä¿¡æ¯ï¼Œéœ€è¦åŠ å…¥å¤šå°‘å½“å‰ æ—¶åˆ»çš„éšè—å±‚ä¿¡æ¯   $\overset { \sim  }{ h }  _{ t }$ ï¼Œæœ€åå¾—åˆ°  $\overset { \sim  }{ h }  _{ t }$  ï¼Œç›´æ¥å¾—åˆ°æœ€åè¾“å‡ºçš„éšè—å±‚ä¿¡æ¯ï¼Œ éœ€è¦æ³¨æ„è¿™é‡Œä¸LSTMçš„åŒºåˆ«æ˜¯GRUä¸­æ²¡æœ‰output gateï¼š</p><p><img src="/2020/06/06/rnn/lstm-gru-21.jpg"></p><blockquote><p>ä¸€èˆ¬æ¥è¯´é‚£äº›å…·æœ‰çŸ­è·ç¦»ä¾èµ–çš„å•å…ƒreset gateæ¯”è¾ƒæ´»è·ƒï¼ˆå¦‚æœ  $ r_{ t }$ ä¸º1ï¼Œè€Œ   $z_{ t }$ ä¸º0 é‚£ä¹ˆç›¸å½“äºå˜æˆäº†ä¸€ä¸ªæ ‡å‡†çš„RNNï¼Œèƒ½å¤„ç†çŸ­è·ç¦»ä¾èµ–ï¼‰ï¼Œå…·æœ‰é•¿è·ç¦»ä¾èµ–çš„å•å…ƒ<code>update gate</code>æ¯”è¾ƒæ´»è·ƒã€‚</p></blockquote><p>â€‹    </p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾ªç¯ç¥ç»ç½‘ç»œ </tag>
            
            <tag> åºåˆ—æ¨¡å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>scrapy</title>
      <link href="/2020/06/01/scrapy/"/>
      <url>/2020/06/01/scrapy/</url>
      
        <content type="html"><![CDATA[<h1 id="scrapy"><a href="#scrapy" class="headerlink" title="scrapy"></a>scrapy</h1><h3 id="scrapyå®˜æ–¹æ–‡æ¡£"><a href="#scrapyå®˜æ–¹æ–‡æ¡£" class="headerlink" title="scrapyå®˜æ–¹æ–‡æ¡£"></a>scrapyå®˜æ–¹æ–‡æ¡£</h3><blockquote><p><a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/index.html">https://scrapy-chs.readthedocs.io/zh_CN/0.24/index.html</a></p></blockquote><h2 id="scrapyçš„æ¦‚å¿µ"><a href="#scrapyçš„æ¦‚å¿µ" class="headerlink" title="scrapyçš„æ¦‚å¿µ"></a>scrapyçš„æ¦‚å¿µ</h2><p><strong>Scrapyæ˜¯ä¸€ä¸ªPythonç¼–å†™çš„å¼€æºç½‘ç»œçˆ¬è™«æ¡†æ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªè¢«è®¾è®¡ç”¨äºçˆ¬å–ç½‘ç»œæ•°æ®ã€æå–ç»“æ„æ€§æ•°æ®çš„æ¡†æ¶ã€‚</strong></p><blockquote><p>Scrapy ä½¿ç”¨äº†Twisted[â€˜twÉªstÉªd]å¼‚æ­¥ç½‘ç»œæ¡†æ¶ï¼Œå¯ä»¥åŠ å¿«æˆ‘ä»¬çš„ä¸‹è½½é€Ÿåº¦ã€‚</p></blockquote><blockquote><p>Scrapyæ–‡æ¡£åœ°å€ï¼š<a href="http://scrapy-chs.readthedocs.io/zh_CN/1.0/intro/overview.html">http://scrapy-chs.readthedocs.io/zh_CN/1.0/intro/overview.html</a></p></blockquote><h3 id="scrapyæ¡†æ¶çš„ä½œç”¨"><a href="#scrapyæ¡†æ¶çš„ä½œç”¨" class="headerlink" title="scrapyæ¡†æ¶çš„ä½œç”¨"></a>scrapyæ¡†æ¶çš„ä½œç”¨</h3><blockquote><p>å°‘é‡çš„ä»£ç ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿçš„æŠ“å–</p></blockquote><h3 id="scrapyçš„å·¥ä½œæµç¨‹"><a href="#scrapyçš„å·¥ä½œæµç¨‹" class="headerlink" title="scrapyçš„å·¥ä½œæµç¨‹"></a>scrapyçš„å·¥ä½œæµç¨‹</h3><h4 id="å›é¡¾ä¹‹å‰çš„çˆ¬è™«æµç¨‹"><a href="#å›é¡¾ä¹‹å‰çš„çˆ¬è™«æµç¨‹" class="headerlink" title="å›é¡¾ä¹‹å‰çš„çˆ¬è™«æµç¨‹"></a>å›é¡¾ä¹‹å‰çš„çˆ¬è™«æµç¨‹</h4><p><img src="/2020/06/01/scrapy/1.3.1.%E7%88%AC%E8%99%AB%E6%B5%81%E7%A8%8B-1.png"></p><h4 id="ä¸Šé¢çš„æµç¨‹å¯ä»¥æ”¹å†™ä¸º"><a href="#ä¸Šé¢çš„æµç¨‹å¯ä»¥æ”¹å†™ä¸º" class="headerlink" title="ä¸Šé¢çš„æµç¨‹å¯ä»¥æ”¹å†™ä¸º"></a>ä¸Šé¢çš„æµç¨‹å¯ä»¥æ”¹å†™ä¸º</h4><p><img src="/2020/06/01/scrapy/1.3.2.%E7%88%AC%E8%99%AB%E6%B5%81%E7%A8%8B-2.png"></p><h4 id="3-3-scrapyçš„æµç¨‹"><a href="#3-3-scrapyçš„æµç¨‹" class="headerlink" title="3.3 scrapyçš„æµç¨‹"></a>3.3 scrapyçš„æµç¨‹</h4><p><img src="/2020/06/01/scrapy/1.3.3.scrapy%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></p><h5 id="å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š"><a href="#å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š" class="headerlink" title="å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š"></a>å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</h5><ol><li>çˆ¬è™«ä¸­èµ·å§‹çš„urlæ„é€ æˆrequestå¯¹è±¡â€“&gt;çˆ¬è™«ä¸­é—´ä»¶â€“&gt;å¼•æ“â€“&gt;è°ƒåº¦å™¨</li><li>è°ƒåº¦å™¨æŠŠrequestâ€“&gt;å¼•æ“â€“&gt;ä¸‹è½½ä¸­é—´ä»¶â€”&gt;ä¸‹è½½å™¨</li><li>ä¸‹è½½å™¨å‘é€è¯·æ±‚ï¼Œè·å–responseå“åº”â€”-&gt;ä¸‹è½½ä¸­é—´ä»¶â€”-&gt;å¼•æ“â€”&gt;çˆ¬è™«ä¸­é—´ä»¶â€”&gt;çˆ¬è™«</li><li>çˆ¬è™«æå–urlåœ°å€ï¼Œç»„è£…æˆrequestå¯¹è±¡â€”-&gt;çˆ¬è™«ä¸­é—´ä»¶â€”&gt;å¼•æ“â€”&gt;è°ƒåº¦å™¨ï¼Œé‡å¤æ­¥éª¤2</li><li>çˆ¬è™«æå–æ•°æ®â€”&gt;å¼•æ“â€”&gt;ç®¡é“å¤„ç†å’Œä¿å­˜æ•°æ®</li></ol><h5 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h5><ul><li>å›¾ä¸­ä¸­æ–‡æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ååŠ ä¸Šå»çš„</li><li>å›¾ä¸­ç»¿è‰²çº¿æ¡çš„è¡¨ç¤ºæ•°æ®çš„ä¼ é€’</li><li>æ³¨æ„å›¾ä¸­ä¸­é—´ä»¶çš„ä½ç½®ï¼Œå†³å®šäº†å…¶ä½œç”¨</li><li>æ³¨æ„å…¶ä¸­å¼•æ“çš„ä½ç½®ï¼Œæ‰€æœ‰çš„æ¨¡å—ä¹‹å‰ç›¸äº’ç‹¬ç«‹ï¼Œåªå’Œå¼•æ“è¿›è¡Œäº¤äº’</li></ul><h4 id="scrapyçš„ä¸‰ä¸ªå†…ç½®å¯¹è±¡"><a href="#scrapyçš„ä¸‰ä¸ªå†…ç½®å¯¹è±¡" class="headerlink" title="scrapyçš„ä¸‰ä¸ªå†…ç½®å¯¹è±¡"></a>scrapyçš„ä¸‰ä¸ªå†…ç½®å¯¹è±¡</h4><ul><li>requestè¯·æ±‚å¯¹è±¡ï¼šç”±url method post_data headersç­‰æ„æˆ</li><li>responseå“åº”å¯¹è±¡ï¼šç”±url body status headersç­‰æ„æˆ</li><li>itemæ•°æ®å¯¹è±¡ï¼šæœ¬è´¨æ˜¯ä¸ªå­—å…¸</li></ul><h4 id="scrapyä¸­æ¯ä¸ªæ¨¡å—çš„å…·ä½“ä½œç”¨"><a href="#scrapyä¸­æ¯ä¸ªæ¨¡å—çš„å…·ä½“ä½œç”¨" class="headerlink" title="scrapyä¸­æ¯ä¸ªæ¨¡å—çš„å…·ä½“ä½œç”¨"></a>scrapyä¸­æ¯ä¸ªæ¨¡å—çš„å…·ä½“ä½œç”¨</h4><h5 id="æ³¨æ„ï¼š-1"><a href="#æ³¨æ„ï¼š-1" class="headerlink" title="æ³¨æ„ï¼š"></a><img src="/2020/06/01/scrapy/1.3.4%E7%BB%84%E4%BB%B6%E4%BD%9C%E7%94%A8.png">æ³¨æ„ï¼š</h5><ul><li>çˆ¬è™«ä¸­é—´ä»¶å’Œä¸‹è½½ä¸­é—´ä»¶åªæ˜¯è¿è¡Œé€»è¾‘çš„ä½ç½®ä¸åŒï¼Œä½œç”¨æ˜¯é‡å¤çš„ï¼šå¦‚æ›¿æ¢UAç­‰</li></ul><h2 id="scrapyçš„å…¥é—¨ä½¿ç”¨"><a href="#scrapyçš„å…¥é—¨ä½¿ç”¨" class="headerlink" title="scrapyçš„å…¥é—¨ä½¿ç”¨"></a>scrapyçš„å…¥é—¨ä½¿ç”¨</h2><h3 id="å®‰è£…scrapy"><a href="#å®‰è£…scrapy" class="headerlink" title="å®‰è£…scrapy"></a>å®‰è£…scrapy<br></h3><p>å‘½ä»¤:<br><br>â€‚â€‚â€‚â€‚sudo apt-get install scrapy<br><br>æˆ–è€…ï¼š<br><br>â€‚â€‚â€‚â€‚pip/pip3 install scrapy</p><h3 id="2-scrapyé¡¹ç›®å¼€å‘æµç¨‹"><a href="#2-scrapyé¡¹ç›®å¼€å‘æµç¨‹" class="headerlink" title="2 scrapyé¡¹ç›®å¼€å‘æµç¨‹"></a>2 scrapyé¡¹ç›®å¼€å‘æµç¨‹</h3><ol><li>åˆ›å»ºé¡¹ç›®:<br><br>â€‚â€‚â€‚â€‚scrapy startproject mySpider</li><li>ç”Ÿæˆä¸€ä¸ªçˆ¬è™«:<br><br>â€‚â€‚â€‚â€‚scrapy genspider xywx xywx.com</li><li>æå–æ•°æ®:<br><br>â€‚â€‚â€‚â€‚æ ¹æ®ç½‘ç«™ç»“æ„åœ¨spiderä¸­å®ç°æ•°æ®é‡‡é›†ç›¸å…³å†…å®¹</li><li>ä¿å­˜æ•°æ®:<br><br>â€‚â€‚â€‚â€‚ä½¿ç”¨pipelineè¿›è¡Œæ•°æ®åç»­å¤„ç†å’Œä¿å­˜</li></ol><h3 id="3-åˆ›å»ºé¡¹ç›®"><a href="#3-åˆ›å»ºé¡¹ç›®" class="headerlink" title="3. åˆ›å»ºé¡¹ç›®"></a>3. åˆ›å»ºé¡¹ç›®</h3><blockquote><p>é€šè¿‡å‘½ä»¤å°†scrapyé¡¹ç›®çš„çš„æ–‡ä»¶ç”Ÿæˆå‡ºæ¥ï¼Œåç»­æ­¥éª¤éƒ½æ˜¯åœ¨é¡¹ç›®æ–‡ä»¶ä¸­è¿›è¡Œç›¸å…³æ“ä½œ</p><p>åˆ›å»ºscrapyé¡¹ç›®çš„å‘½ä»¤ï¼š<br><br>â€‚â€‚â€‚â€‚scrapy startproject &lt;é¡¹ç›®åå­—&gt;<br><br>ç¤ºä¾‹ï¼š<br><br>â€‚â€‚â€‚â€‚scrapy startproject myspider</p></blockquote><p>ç”Ÿæˆçš„ç›®å½•å’Œæ–‡ä»¶ç»“æœå¦‚ä¸‹ï¼š<img src="/2020/06/01/scrapy/2.1.scrapyå…¥é—¨ä½¿ç”¨-1.png" width="60%"> </p><h3 id="4-åˆ›å»ºçˆ¬è™«"><a href="#4-åˆ›å»ºçˆ¬è™«" class="headerlink" title="4. åˆ›å»ºçˆ¬è™«"></a>4. åˆ›å»ºçˆ¬è™«</h3><blockquote><p>é€šè¿‡å‘½ä»¤åˆ›å»ºå‡ºçˆ¬è™«æ–‡ä»¶ï¼Œçˆ¬è™«æ–‡ä»¶ä¸ºä¸»è¦çš„ä»£ç ä½œä¸šæ–‡ä»¶ï¼Œé€šå¸¸ä¸€ä¸ªç½‘ç«™çš„çˆ¬å–åŠ¨ä½œéƒ½ä¼šåœ¨çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™ã€‚</p></blockquote><p>å‘½ä»¤ï¼š<br><br>â€‚â€‚â€‚â€‚<strong>åœ¨é¡¹ç›®è·¯å¾„ä¸‹æ‰§è¡Œ</strong>:<br><br>â€‚â€‚â€‚â€‚scrapy genspider &lt;çˆ¬è™«åå­—&gt; &lt;å…è®¸çˆ¬å–çš„åŸŸå&gt;<br></p><p><strong>çˆ¬è™«åå­—</strong>: ä½œä¸ºçˆ¬è™«è¿è¡Œæ—¶çš„å‚æ•°<br><br><strong>å…è®¸çˆ¬å–çš„åŸŸå</strong>: ä¸ºå¯¹äºçˆ¬è™«è®¾ç½®çš„çˆ¬å–èŒƒå›´ï¼Œè®¾ç½®ä¹‹åç”¨äºè¿‡æ»¤è¦çˆ¬å–çš„urlï¼Œå¦‚æœçˆ¬å–çš„urlä¸å…è®¸çš„åŸŸä¸é€šåˆ™è¢«è¿‡æ»¤æ‰ã€‚<br></p><p>ç¤ºä¾‹ï¼š</p><pre class=" language-shell"><code class="language-shell">    cd myspider    scrapy genspider xywy  xywy.com</code></pre><h3 id="5-å®Œå–„çˆ¬è™«"><a href="#5-å®Œå–„çˆ¬è™«" class="headerlink" title="5. å®Œå–„çˆ¬è™«"></a>5. å®Œå–„çˆ¬è™«</h3><h4 id="5-1-åœ¨-myspider-myspider-spiders-xywx-pyä¸­ä¿®æ”¹å†…å®¹å¦‚ä¸‹"><a href="#5-1-åœ¨-myspider-myspider-spiders-xywx-pyä¸­ä¿®æ”¹å†…å®¹å¦‚ä¸‹" class="headerlink" title="5.1 åœ¨/myspider/myspider/spiders/xywx.pyä¸­ä¿®æ”¹å†…å®¹å¦‚ä¸‹:"></a>5.1 åœ¨/myspider/myspider/spiders/xywx.pyä¸­ä¿®æ”¹å†…å®¹å¦‚ä¸‹:</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">from</span> myspider<span class="token punctuation">.</span>items <span class="token keyword">import</span> MyspiderItem<span class="token keyword">from</span>  copy <span class="token keyword">import</span> deepcopy<span class="token keyword">class</span> <span class="token class-name">XywySpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'xywy'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'xywy.com'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># å…è®¸çˆ¬å–çš„èŒƒå›´</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://jib.xywy.com/'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># å¼€å§‹çˆ¬å–çš„urlåœ°å€</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> MyspiderItem<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–åå¯ç›´æ¥ä½¿ç”¨</span>        <span class="token keyword">for</span> page <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> page                basic_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/gaishu/%s.htm'</span> <span class="token operator">%</span> page  <span class="token comment" spellcheck="true">## ç®€ä»‹</span>                <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>basic_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_basic_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> page<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">parse_basic_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        åŸºæœ¬ä¿¡æ¯è§£æ        :param response:        :return:        """</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//strong[@class="db f20 fYaHei fb jib-articl-tit tc pr"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>        category <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="wrap mt10 nav-bar"]/a/text()'</span><span class="token punctuation">)</span>        desc <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="jib-articl-con jib-lh-articl"]/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        ps <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="mt20 articl-know"]/p'</span><span class="token punctuation">)</span>        infobox <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> p <span class="token keyword">in</span> ps<span class="token punctuation">:</span>            info <span class="token operator">=</span> p<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\xa0'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            infobox<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>        category_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> cate <span class="token keyword">in</span> category<span class="token punctuation">:</span> <span class="token comment" spellcheck="true">## ç–¾ç—…åˆ†ç±», å¤šåˆ†ç±»</span>            category_content <span class="token operator">=</span> cate<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> category_content <span class="token operator">and</span> category_content <span class="token operator">!=</span> <span class="token string">"ç–¾ç—…ç™¾ç§‘"</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">## å»æ‰ä¸éœ€è¦çš„åˆ†ç±»</span>                category_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cate<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        basic_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>        basic_data<span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span> <span class="token operator">=</span> category_list        basic_data<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> title<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'ç®€ä»‹'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        basic_data<span class="token punctuation">[</span><span class="token string">'desc'</span><span class="token punctuation">]</span> <span class="token operator">=</span> desc        basic_data<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> infobox        item<span class="token punctuation">[</span><span class="token string">'basic'</span><span class="token punctuation">]</span> <span class="token operator">=</span> basic_data        cause_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/cause/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## åŸå› </span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>cause_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_cause_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_cause_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        ps <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//p'</span><span class="token punctuation">)</span>        infobox <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> p <span class="token keyword">in</span> ps<span class="token punctuation">:</span>            info <span class="token operator">=</span> p<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\xa0'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> info<span class="token punctuation">:</span>                infobox<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'cause'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>infobox<span class="token punctuation">)</span>        prevent_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/prevent/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">##æ²»ç–—</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>prevent_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_prevent_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_prevent_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        ps <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//p'</span><span class="token punctuation">)</span>        infobox <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> p <span class="token keyword">in</span> ps<span class="token punctuation">:</span>            info <span class="token operator">=</span> p<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\xa0'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> info<span class="token punctuation">:</span>                infobox<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'prevent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>infobox<span class="token punctuation">)</span>        symptom_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/symptom/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">##</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>symptom_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_symptom_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_symptom_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        symptoms <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//a[@class="gre" ]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>        ps <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//p'</span><span class="token punctuation">)</span>        detail <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> p <span class="token keyword">in</span> ps<span class="token punctuation">:</span>            info <span class="token operator">=</span> p<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\xa0'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            detail<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>        symptoms_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>        symptoms_data<span class="token punctuation">[</span><span class="token string">'symptoms'</span><span class="token punctuation">]</span> <span class="token operator">=</span> symptoms        symptoms_data<span class="token punctuation">[</span><span class="token string">'symptoms_detail'</span><span class="token punctuation">]</span> <span class="token operator">=</span> detail        item<span class="token punctuation">[</span><span class="token string">'symptom'</span><span class="token punctuation">]</span> <span class="token operator">=</span> symptoms_data        inspect_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/inspect/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">##</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>inspect_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_inspect_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_inspect_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        inspects <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//li[@class="check-item"]/a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'inspect'</span><span class="token punctuation">]</span> <span class="token operator">=</span> inspects        treat_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/treat/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## æ²»ç–—</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>treat_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_treat_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_treat_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        ps <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[starts-with(@class,"mt20 articl-know")]/p'</span><span class="token punctuation">)</span>        infobox <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> p <span class="token keyword">in</span> ps<span class="token punctuation">:</span>            info <span class="token operator">=</span> p<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'string(.)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\xa0'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'   '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>            infobox<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'treat'</span><span class="token punctuation">]</span> <span class="token operator">=</span> infobox        food_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/food/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## é£Ÿç‰©</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>food_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_food_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_food_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        divs <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="diet-img clearfix mt20"]'</span><span class="token punctuation">)</span>        food_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            food_data<span class="token punctuation">[</span><span class="token string">'good'</span><span class="token punctuation">]</span> <span class="token operator">=</span> divs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>            food_data<span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">]</span> <span class="token operator">=</span> divs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>            food_data<span class="token punctuation">[</span><span class="token string">'recommand'</span><span class="token punctuation">]</span> <span class="token operator">=</span> divs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/p/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"food"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'food'</span><span class="token punctuation">]</span> <span class="token operator">=</span> food_data        drug_url <span class="token operator">=</span> <span class="token string">'http://jib.xywy.com/il_sii/drug/%s.htm'</span> <span class="token operator">%</span> item<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">## è¯ç‰©</span>        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>drug_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_drug_url<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"item": deepcopy(item)&amp;#125;)</span>    <span class="token keyword">def</span> <span class="token function">parse_drug_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        item <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'item'</span><span class="token punctuation">]</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            drugs <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="fl drug-pic-rec mr30"]/p/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"drup"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>        item<span class="token punctuation">[</span><span class="token string">'drug'</span><span class="token punctuation">]</span> <span class="token operator">=</span> drugs        <span class="token keyword">yield</span> item</code></pre><h5 id="æ³¨æ„ï¼š-2"><a href="#æ³¨æ„ï¼š-2" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h5><ul><li>scrapy.Spiderçˆ¬è™«ç±»ä¸­å¿…é¡»æœ‰åä¸ºparseçš„è§£æ</li><li>å¦‚æœç½‘ç«™ç»“æ„å±‚æ¬¡æ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å…¶ä»–è§£æå‡½æ•°</li><li>åœ¨è§£æå‡½æ•°ä¸­æå–çš„urlåœ°å€å¦‚æœè¦å‘é€è¯·æ±‚ï¼Œåˆ™å¿…é¡»å±äºallowed_domainsèŒƒå›´å†…ï¼Œä½†æ˜¯start_urlsä¸­çš„urlåœ°å€ä¸å—è¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­çš„è¯¾ç¨‹ä¸­å­¦ä¹ å¦‚ä½•åœ¨è§£æå‡½æ•°ä¸­æ„é€ å‘é€è¯·æ±‚</li><li>å¯åŠ¨çˆ¬è™«çš„æ—¶å€™æ³¨æ„å¯åŠ¨çš„ä½ç½®ï¼Œæ˜¯åœ¨é¡¹ç›®è·¯å¾„ä¸‹å¯åŠ¨</li><li>parse()å‡½æ•°ä¸­ä½¿ç”¨yieldè¿”å›æ•°æ®ï¼Œ<strong>æ³¨æ„ï¼šè§£æå‡½æ•°ä¸­çš„yieldèƒ½å¤Ÿä¼ é€’çš„å¯¹è±¡åªèƒ½æ˜¯ï¼šBaseItem, Request, dict, None</strong></li></ul><h4 id="5-2-å®šä½å…ƒç´ ä»¥åŠæå–æ•°æ®ã€å±æ€§å€¼çš„æ–¹æ³•"><a href="#5-2-å®šä½å…ƒç´ ä»¥åŠæå–æ•°æ®ã€å±æ€§å€¼çš„æ–¹æ³•" class="headerlink" title="5.2 å®šä½å…ƒç´ ä»¥åŠæå–æ•°æ®ã€å±æ€§å€¼çš„æ–¹æ³•"></a>5.2 å®šä½å…ƒç´ ä»¥åŠæå–æ•°æ®ã€å±æ€§å€¼çš„æ–¹æ³•</h4><blockquote><p>è§£æå¹¶è·å–scrapyçˆ¬è™«ä¸­çš„æ•°æ®: åˆ©ç”¨xpathè§„åˆ™å­—ç¬¦ä¸²è¿›è¡Œå®šä½å’Œæå–</p></blockquote><ol><li>response.xpathæ–¹æ³•çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªç±»ä¼¼listçš„ç±»å‹ï¼Œå…¶ä¸­åŒ…å«çš„æ˜¯selectorå¯¹è±¡ï¼Œæ“ä½œå’Œåˆ—è¡¨ä¸€æ ·ï¼Œä½†æ˜¯æœ‰ä¸€äº›é¢å¤–çš„æ–¹æ³•</li><li>é¢å¤–æ–¹æ³•extract()ï¼šè¿”å›ä¸€ä¸ªåŒ…å«æœ‰å­—ç¬¦ä¸²çš„åˆ—è¡¨</li><li>é¢å¤–æ–¹æ³•extract_first()ï¼šè¿”å›åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ä¸ºç©ºæ²¡æœ‰è¿”å›None</li></ol><h4 id="5-3-responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§"><a href="#5-3-responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§" class="headerlink" title="5.3 responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§"></a>5.3 responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§</h4><ul><li>response.urlï¼šå½“å‰å“åº”çš„urlåœ°å€</li><li>response.request.urlï¼šå½“å‰å“åº”å¯¹åº”çš„è¯·æ±‚çš„urlåœ°å€</li><li>response.headersï¼šå“åº”å¤´</li><li>response.requests.headersï¼šå½“å‰å“åº”çš„è¯·æ±‚å¤´</li><li>response.bodyï¼šå“åº”ä½“ï¼Œä¹Ÿå°±æ˜¯htmlä»£ç ï¼Œbyteç±»å‹</li><li>response.statusï¼šå“åº”çŠ¶æ€ç </li></ul><h3 id="6-ä¿å­˜æ•°æ®"><a href="#6-ä¿å­˜æ•°æ®" class="headerlink" title="6 ä¿å­˜æ•°æ®"></a>6 ä¿å­˜æ•°æ®</h3><blockquote><p>åˆ©ç”¨ç®¡é“pipelineæ¥å¤„ç†(ä¿å­˜)æ•°æ®</p></blockquote><h4 id="6-1-åœ¨pipelines-pyæ–‡ä»¶ä¸­å®šä¹‰å¯¹æ•°æ®çš„æ“ä½œ"><a href="#6-1-åœ¨pipelines-pyæ–‡ä»¶ä¸­å®šä¹‰å¯¹æ•°æ®çš„æ“ä½œ" class="headerlink" title="6.1 åœ¨pipelines.pyæ–‡ä»¶ä¸­å®šä¹‰å¯¹æ•°æ®çš„æ“ä½œ"></a>6.1 åœ¨pipelines.pyæ–‡ä»¶ä¸­å®šä¹‰å¯¹æ•°æ®çš„æ“ä½œ</h4><ol><li>å®šä¹‰ä¸€ä¸ªç®¡é“ç±»<br></li><li>é‡å†™ç®¡é“ç±»çš„process_itemæ–¹æ³•</li><li>process_itemæ–¹æ³•å¤„ç†å®Œitemä¹‹åå¿…é¡»è¿”å›ç»™å¼•æ“</li></ol><pre><code>import jsonclass xywxPipeline():    # çˆ¬è™«æ–‡ä»¶ä¸­æå–æ•°æ®çš„æ–¹æ³•æ¯yieldä¸€æ¬¡itemï¼Œå°±ä¼šè¿è¡Œä¸€æ¬¡    # è¯¥æ–¹æ³•ä¸ºå›ºå®šåç§°å‡½æ•°    def process_item(self, item, spider):        print(item)        return item</code></pre><h4 id="6-2-åœ¨settings-pyé…ç½®å¯ç”¨ç®¡é“"><a href="#6-2-åœ¨settings-pyé…ç½®å¯ç”¨ç®¡é“" class="headerlink" title="6.2 åœ¨settings.pyé…ç½®å¯ç”¨ç®¡é“"></a>6.2 åœ¨settings.pyé…ç½®å¯ç”¨ç®¡é“</h4><pre><code>ITEM_PIPELINES = &amp;#123;    'myspider.pipelines.xywxPipeline': 400&amp;#125;</code></pre><p>é…ç½®é¡¹ä¸­é”®ä¸ºä½¿ç”¨çš„ç®¡é“ç±»ï¼Œç®¡é“ç±»ä½¿ç”¨.è¿›è¡Œåˆ†å‰²ï¼Œç¬¬ä¸€ä¸ªä¸ºé¡¹ç›®ç›®å½•ï¼Œç¬¬äºŒä¸ªä¸ºæ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªä¸ºå®šä¹‰çš„ç®¡é“ç±»ã€‚<br><br>é…ç½®é¡¹ä¸­å€¼ä¸ºç®¡é“çš„ä½¿ç”¨é¡ºåºï¼Œè®¾ç½®çš„æ•°å€¼çº¦å°è¶Šä¼˜å…ˆæ‰§è¡Œï¼Œè¯¥å€¼ä¸€èˆ¬è®¾ç½®ä¸º1000ä»¥å†…ã€‚<br></p><h3 id="7-è¿è¡Œscrapy"><a href="#7-è¿è¡Œscrapy" class="headerlink" title="7. è¿è¡Œscrapy"></a>7. è¿è¡Œscrapy</h3><p>å‘½ä»¤ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œscrapy crawl &lt;çˆ¬è™«åå­—&gt;</p><p>ç¤ºä¾‹ï¼šscrapy crawl xywx</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> çˆ¬è™« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®é‡‡é›† </tag>
            
            <tag> æ•°æ®å¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker</title>
      <link href="/2020/05/15/docker/"/>
      <url>/2020/05/15/docker/</url>
      
        <content type="html"><![CDATA[<h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><h2 id="ä¸€ã€å®‰è£…Docker"><a href="#ä¸€ã€å®‰è£…Docker" class="headerlink" title="ä¸€ã€å®‰è£…Docker"></a>ä¸€ã€å®‰è£…Docker</h2><pre class=" language-shell"><code class="language-shell"># 1ã€yum åŒ…æ›´æ–°åˆ°æœ€æ–° yum update# 2ã€å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ï¼Œ yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–çš„ yum install -y yum-utils device-mapper-persistent-data lvm2# 3ã€ è®¾ç½®yumæºyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo# 4ã€ å®‰è£…dockerï¼Œå‡ºç°è¾“å…¥çš„ç•Œé¢éƒ½æŒ‰ y yum install -y docker-ce# 5ã€ æŸ¥çœ‹dockerç‰ˆæœ¬ï¼ŒéªŒè¯æ˜¯å¦éªŒè¯æˆåŠŸdocker -v</code></pre><h2 id="Docker-å¸¸è§å‘½ä»¤"><a href="#Docker-å¸¸è§å‘½ä»¤" class="headerlink" title="Docker å¸¸è§å‘½ä»¤"></a>Docker å¸¸è§å‘½ä»¤</h2><pre class=" language-shell"><code class="language-shell">step3ï¼šå¯åŠ¨dockeræœåŠ¡systemclt start dockerstep4ï¼šæŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸsystemclt status dockerè‡ªåŠ¨å¯åŠ¨systemctl&nbsp;&nbsp;enable&nbsp;dockerstep5ï¼šä½¿ç”¨dockerå‘½ä»¤&nbsp;docker imageså¤‡æ³¨ï¼šæŸ¥çœ‹dockerå·²ç»å®‰è£…çš„é•œåƒ è£¸æœºçŠ¶æ€ä¸‹ä¸ºç©ºä¸‰ ä½¿ç”¨dockerå®‰è£…mysqlstep1ï¼šä½¿ç”¨docker pull æ‹‰å–docker hubä»“åº“ä¸­mysqlé•œåƒ ï¼ˆæ³¨æ„å¤‡æ³¨ï¼‰mysqlé•œåƒç‰ˆæœ¬å¦‚ä¸‹ï¼šdocker pull mysql:8.0å¤‡æ³¨ï¼šdocker pull é»˜è®¤åˆ°å®˜æ–¹å‚è€ƒæ‹‰å– &nbsp;mysqlï¼š8.0 &nbsp; é•œåƒåï¼šé•œåƒtag &nbsp; &nbsp;&nbsp;å®˜æ–¹åœ°å€ä¸ºå›½å¤–åœ°å€å®‰è£…ç¼“æ…¢å¯è¿›è¡Œé…ç½®step2ï¼šä¿®æ”¹é•œåƒæ–‡ä»¶æ‹‰å–åœ°å€ä¸ºustc&nbsp;vi /etc/docker/daemon.jsonå¤‡æ³¨ï¼šinsert ç¼–è¾‘å†…å®¹å¦‚ä¸‹ &nbsp; &nbsp; &nbsp;å¹¶esc &nbsp;è¾“å…¥:wq ä¿å­˜é€€å‡º &nbsp;&#123;"registry-mirrors":["https://docker.mirrors.ustc.edu.cn"]&#125;step3ï¼šé‡å¯docker &nbsp;&nbsp;é‡æ–°è¿›è¡Œstep1 å®‰è£…é€Ÿåº¦å˜å¿«systemclt restart dockerstep4ï¼šæŸ¥çœ‹é•œåƒå®‰è£…æƒ…å†µdocker imagesåˆ›å»ºå®¹å™¨å‘½ä»¤ï¼šdocker run-iï¼šè¡¨ç¤ºè¿è¡Œå®¹å™¨-tï¼šè¡¨ç¤ºå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥å…¶å‘½ä»¤è¡Œã€‚åŠ å…¥è¿™ä¸¤ä¸ªå‚æ•°åï¼Œå®¹å™¨åˆ›å»ºå°±èƒ½ç™»å½•è¿›å»ã€‚å³åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚--name :ä¸ºåˆ›å»ºçš„å®¹å™¨å‘½åã€‚-vï¼šè¡¨ç¤ºç›®å½•æ˜ å°„å…³ç³»ï¼ˆå‰è€…æ˜¯å®¿ä¸»æœºç›®å½•ï¼Œåè€…æ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªï¼våšå¤šä¸ªç›®å½•æˆ–æ–‡ä»¶æ˜ å°„ã€‚æ³¨æ„ï¼šæœ€å¥½åšç›®å½•æ˜ å°„ï¼Œåœ¨å®¿ä¸»æœºä¸Šåšä¿®æ”¹ï¼Œç„¶åå…±äº«åˆ°å®¹å™¨ä¸Šã€‚-dï¼šåœ¨runåé¢åŠ ä¸Š-då‚æ•°,åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå®ˆæŠ¤å¼å®¹å™¨åœ¨åå°è¿è¡Œï¼ˆè¿™æ ·åˆ›å»ºå®¹å™¨åä¸ä¼šè‡ªåŠ¨ç™»å½•å®¹å™¨ï¼Œå¦‚æœåªåŠ -i -tä¸¤ä¸ªå‚æ•°ï¼Œåˆ›å»ºåå°±ä¼šè‡ªåŠ¨è¿›å»å®¹å™¨ï¼‰ã€‚-pï¼šè¡¨ç¤ºç«¯å£æ˜ å°„ï¼Œå‰è€…æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œåè€…æ˜¯å®¹å™¨å†…çš„æ˜ å°„ç«¯å£ã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ª-påšå¤šä¸ªç«¯å£æ˜ å°„ï¼ˆ1ï¼‰äº¤äº’å¼æ–¹å¼åˆ›å»ºå®¹å™¨docker run -it --name=å®¹å™¨åç§° é•œåƒåç§°:æ ‡ç­¾ /bin/bashè¿™æ—¶æˆ‘ä»¬é€šè¿‡pså‘½ä»¤æŸ¥çœ‹ï¼Œå‘ç°å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„å®¹å™¨ï¼ŒçŠ¶æ€ä¸ºå¯åŠ¨çŠ¶æ€ é€€å‡ºå½“å‰å®¹å™¨exitï¼ˆ2ï¼‰å®ˆæŠ¤å¼æ–¹å¼åˆ›å»ºå®¹å™¨ï¼šdocker run -di --name=å®¹å™¨åç§° é•œåƒåç§°:æ ‡ç­¾ç™»å½•å®ˆæŠ¤å¼å®¹å™¨æ–¹å¼ï¼šdocker exec -it å®¹å™¨åç§° (æˆ–è€…å®¹å™¨ID) /bin/bashå¦‚æœæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨å†…å¯ä»¥ä½¿ç”¨cpå‘½ä»¤docker cp éœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½• å®¹å™¨åç§°:å®¹å™¨ç›®å½•ä¹Ÿå¯ä»¥å°†æ–‡ä»¶ä»å®¹å™¨å†…æ‹·è´å‡ºæ¥docker cp å®¹å™¨åç§°:å®¹å™¨ç›®å½• éœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½•ç›®å½•æŒ‚è½½æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå°†å®¿ä¸»æœºçš„ç›®å½•ä¸å®¹å™¨å†…çš„ç›®å½•è¿›è¡Œæ˜ å°„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å®¿ä¸»æœºæŸä¸ªç›®å½•çš„æ–‡ä»¶ä»è€Œå»å½±å“å®¹å™¨ã€‚åˆ›å»ºå®¹å™¨ æ·»åŠ -vå‚æ•° åè¾¹ä¸º   å®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œä¾‹å¦‚ï¼šdocker run -di -v /usr/local/myhtml:/usr/local/myhtml --name=mycentos3 centos:7å¦‚æœä½ å…±äº«çš„æ˜¯å¤šçº§çš„ç›®å½•ï¼Œå¯èƒ½ä¼šå‡ºç°æƒé™ä¸è¶³çš„æç¤ºã€‚è¿™æ˜¯å› ä¸ºCentOS7ä¸­çš„å®‰å…¨æ¨¡å—selinuxæŠŠæƒé™ç¦æ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å‚æ•°  --privileged=true  æ¥è§£å†³æŒ‚è½½çš„ç›®å½•æ²¡æœ‰æƒé™çš„é—®é¢˜æŸ¥çœ‹å®¹å™¨IPåœ°å€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨è¿è¡Œçš„å„ç§æ•°æ®docker inspect å®¹å™¨åç§°ï¼ˆå®¹å™¨IDï¼‰ ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç›´æ¥è¾“å‡ºIPåœ°å€docker inspect --format='&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;' å®¹å™¨åç§°ï¼ˆå®¹å™¨IDï¼‰step5ï¼šå¯åŠ¨dockerä¸­é•œåƒdocker run --name mysql8.0 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:8.0æˆ–è€…sudo&nbsp;docker&nbsp;run&nbsp;-d&nbsp;-p&nbsp;3307:3306&nbsp;--restart&nbsp;always&nbsp;-e&nbsp;MYSQL_ROOT_PASSWORD="123456"&nbsp;--name&nbsp;mysql57&nbsp;-v&nbsp;/docker/mysql56/config/my.cnf:/etc/my.cnf&nbsp;-v&nbsp;/docker/mysql57/data:/var/lib/mysql&nbsp;mysql:5.6å¤‡æ³¨ ï¼š--name æœåŠ¡å¯åŠ¨åˆ«åè®¾ç½® &nbsp;-pç«¯å£æ˜ å°„ å®¿ä¸»æœºç«¯å£ï¼šé•œåƒè¿è¡Œç«¯å£ &nbsp;-d é•œåƒåï¼štag ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨ -eï¼šè®¾ç½®rootå¸å·å¯†ç step6ï¼šæŸ¥çœ‹è¿è¡Œçš„é•œåƒdocker ps -astep7ï¼šè¿›å…¥é•œåƒ è¿è¡Œmysqldocker exec -it mysql8.0 /bin/bashå¤‡æ³¨ï¼šexec dockerè¿›å…¥å®¹å™¨å‘½ä»¤ &nbsp; -it å®¹å™¨ä¸­æœåŠ¡åˆ«å /bin/bash &nbsp; è¡¨ç¤ºå‘½ä»¤è¡Œæ¨¡å¼ &nbsp;ä¸ -d åå°å®ˆæŠ¤è¿›è¡Œæ¨¡å¼å¯åŠ¨ å½¢æˆä¸¤ç§è¿è¡Œæ–¹å¼ &nbsp;&nbsp;è¿›å…¥å®¹å™¨ä¸­å¦‚å›¾æ‰€ç¤ºå˜åŒ–å¦‚ä¸‹cd /usr/binmysql -u root -på¤‡æ³¨ï¼š åœ¨å®¹å™¨ä¸­è¿›å…¥ç”¨æˆ·ç›®å½•å¯åŠ¨mysql è¾“å…¥å¯†ç è¿æ¥æˆåŠŸå›› å…¶ä»–å‘½ä»¤step1ï¼šåˆ é™¤å®‰è£…åŒ…yum remove -y å®‰è£…åŒ…åstep2ï¼šåœæ­¢/å¼€å§‹æœåŠ¡systemclt stop dockersystemclt start dockerstep2ï¼šç§»é™¤å·²ç»å®‰è£…é•œåƒdocker rmi é•œåƒåï¼štag   or  é•œåƒidstep3ï¼šåœæ­¢/å¯åŠ¨/åˆ é™¤å®¹å™¨æœåŠ¡docker stop å®¹å™¨æœåŠ¡åˆ«å  or å®¹å™¨iddocker start å®¹å™¨æœåŠ¡åˆ«å  or å®¹å™¨iddocker rm å®¹å™¨æœåŠ¡åˆ«å  or å®¹å™¨id</code></pre><h2 id="åº”ç”¨éƒ¨ç½²"><a href="#åº”ç”¨éƒ¨ç½²" class="headerlink" title="åº”ç”¨éƒ¨ç½²"></a>åº”ç”¨éƒ¨ç½²</h2><h3 id="MySQLéƒ¨ç½²"><a href="#MySQLéƒ¨ç½²" class="headerlink" title="MySQLéƒ¨ç½²"></a>MySQLéƒ¨ç½²</h3><p>ï¼ˆ1ï¼‰æ‹‰å–mysqlé•œåƒ</p><pre><code>docker pull centos/mysql-57-centos7</code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨</p><pre><code>docker run -di --name=tensquare_mysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql</code></pre><p>-p ä»£è¡¨ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸º å®¿ä¸»æœºæ˜ å°„ç«¯å£:å®¹å™¨è¿è¡Œç«¯å£</p><p>-e ä»£è¡¨æ·»åŠ ç¯å¢ƒå˜é‡ MYSQL_ROOT_PASSWORD  æ˜¯rootç”¨æˆ·çš„ç™»é™†å¯†ç </p><p>ï¼ˆ3ï¼‰è¿œç¨‹ç™»å½•mysql</p><p>è¿æ¥å®¿ä¸»æœºçš„IP  ,æŒ‡å®šç«¯å£ä¸º33306 </p><h3 id="tomcatéƒ¨ç½²"><a href="#tomcatéƒ¨ç½²" class="headerlink" title="tomcatéƒ¨ç½²"></a>tomcatéƒ¨ç½²</h3><p>ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ</p><pre><code>docker pull tomcat:7-jre7</code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨</p><p>åˆ›å»ºå®¹å™¨ -pè¡¨ç¤ºåœ°å€æ˜ å°„</p><pre><code>docker run -di --name=mytomcat -p 9000:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps tomcat:7-jre7</code></pre><h3 id="Nginxéƒ¨ç½²"><a href="#Nginxéƒ¨ç½²" class="headerlink" title="Nginxéƒ¨ç½²"></a>Nginxéƒ¨ç½²</h3><p>ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ    </p><pre><code>docker pull nginx</code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºNginxå®¹å™¨</p><pre><code>docker run -di --name=mynginx -p 80:80 nginx</code></pre><h3 id="Rediséƒ¨ç½²"><a href="#Rediséƒ¨ç½²" class="headerlink" title="Rediséƒ¨ç½²"></a>Rediséƒ¨ç½²</h3><p>ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ</p><pre><code>docker pull redis</code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºå®¹å™¨</p><pre><code>docker run -di --name=myredis -p 6379:6379 redis</code></pre><h2 id="è¿ç§»ä¸å¤‡ä»½"><a href="#è¿ç§»ä¸å¤‡ä»½" class="headerlink" title="è¿ç§»ä¸å¤‡ä»½"></a>è¿ç§»ä¸å¤‡ä»½</h2><pre class=" language-shell"><code class="language-shell">å®¹å™¨ä¿å­˜ä¸ºé•œåƒæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒdocker commit mynginx mynginx_ié•œåƒå¤‡ä»½æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†é•œåƒä¿å­˜ä¸ºtar æ–‡ä»¶docker  save -o mynginx.tar mynginx_ié•œåƒæ¢å¤ä¸è¿ç§»é¦–å…ˆæˆ‘ä»¬å…ˆåˆ é™¤æ‰mynginx_imgé•œåƒ  ç„¶åæ‰§è¡Œæ­¤å‘½ä»¤è¿›è¡Œæ¢å¤docker load -i mynginx.tar-i è¾“å…¥çš„æ–‡ä»¶æ‰§è¡Œåå†æ¬¡æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°é•œåƒå·²ç»æ¢å¤</code></pre><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><h3 id="ä»€ä¹ˆæ˜¯Dockerfile"><a href="#ä»€ä¹ˆæ˜¯Dockerfile" class="headerlink" title="ä»€ä¹ˆæ˜¯Dockerfile"></a>ä»€ä¹ˆæ˜¯Dockerfile</h3><p>Dockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œè¿™äº›å‘½ä»¤åº”ç”¨äºåŸºç¡€é•œåƒå¹¶æœ€ç»ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</p><p>1ã€å¯¹äºå¼€å‘äººå‘˜ï¼šå¯ä»¥ä¸ºå¼€å‘å›¢é˜Ÿæä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒï¼›  2ã€å¯¹äºæµ‹è¯•äººå‘˜ï¼šå¯ä»¥ç›´æ¥æ‹¿å¼€å‘æ—¶æ‰€æ„å»ºçš„é•œåƒæˆ–è€…é€šè¿‡Dockerfileæ–‡ä»¶æ„å»ºä¸€ä¸ªæ–°çš„é•œåƒå¼€å§‹å·¥ä½œäº†ï¼›  3ã€å¯¹äºè¿ç»´äººå‘˜ï¼šåœ¨éƒ¨ç½²æ—¶ï¼Œå¯ä»¥å®ç°åº”ç”¨çš„æ— ç¼ç§»æ¤ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">ä½œç”¨</th></tr></thead><tbody><tr><td align="left">FROM image_name:tag</td><td align="left">å®šä¹‰äº†ä½¿ç”¨å“ªä¸ªåŸºç¡€é•œåƒå¯åŠ¨æ„å»ºæµç¨‹</td></tr><tr><td align="left">MAINTAINER user_name</td><td align="left">å£°æ˜é•œåƒçš„åˆ›å»ºè€…</td></tr><tr><td align="left">ENV key value</td><td align="left">è®¾ç½®ç¯å¢ƒå˜é‡ (å¯ä»¥å†™å¤šæ¡)</td></tr><tr><td align="left">RUN command</td><td align="left">æ˜¯Dockerfileçš„æ ¸å¿ƒéƒ¨åˆ†(å¯ä»¥å†™å¤šæ¡)</td></tr><tr><td align="left">ADD source_dir/file dest_dir/file</td><td align="left">å°†å®¿ä¸»æœºçš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå°†ä¼šåœ¨å¤åˆ¶åè‡ªåŠ¨è§£å‹</td></tr><tr><td align="left">COPY source_dir/file dest_dir/file</td><td align="left">å’ŒADDç›¸ä¼¼ï¼Œä½†æ˜¯å¦‚æœæœ‰å‹ç¼©æ–‡ä»¶å¹¶ä¸èƒ½è§£å‹</td></tr><tr><td align="left">WORKDIR path_dir</td><td align="left">è®¾ç½®å·¥ä½œç›®å½•</td></tr></tbody></table><h2 id="ä½¿ç”¨è„šæœ¬åˆ›å»ºé•œåƒ"><a href="#ä½¿ç”¨è„šæœ¬åˆ›å»ºé•œåƒ" class="headerlink" title="ä½¿ç”¨è„šæœ¬åˆ›å»ºé•œåƒ"></a>ä½¿ç”¨è„šæœ¬åˆ›å»ºé•œåƒ</h2><p>æ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰åˆ›å»ºç›®å½•</p><pre><code>mkdir â€“p /usr/local/dockerjdk8</code></pre><p>ï¼ˆ2ï¼‰ä¸‹è½½jdk-8u171-linux-x64.tar.gzå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰ä¸­çš„/usr/local/dockerjdk8ç›®å½•</p><p>ï¼ˆ3ï¼‰åˆ›å»ºæ–‡ä»¶Dockerfile  <code>vi Dockerfile</code></p><pre><code>#ä¾èµ–é•œåƒåç§°å’ŒIDFROM centos:7#æŒ‡å®šé•œåƒåˆ›å»ºè€…ä¿¡æ¯MAINTAINER ITCAST#åˆ‡æ¢å·¥ä½œç›®å½•WORKDIR /usrRUN mkdir  /usr/local/java#ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjavaæ·»åŠ åˆ°å®¹å™¨ä¸­ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/#é…ç½®javaç¯å¢ƒå˜é‡ENV JAVA_HOME /usr/local/java/jdk1.8.0_171ENV JRE_HOME $JAVA_HOME/jreENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATHENV PATH $JAVA_HOME/bin:$PATH</code></pre><p>ï¼ˆ4ï¼‰æ‰§è¡Œå‘½ä»¤æ„å»ºé•œåƒ</p><pre><code>docker build -t='jdk1.8' .</code></pre><p>æ³¨æ„åè¾¹çš„ç©ºæ ¼å’Œç‚¹ï¼Œä¸è¦çœç•¥ è¡¨ç¤ºå½“å‰ç›®å½•Dockerfile</p><p>ï¼ˆ5ï¼‰æŸ¥çœ‹é•œåƒæ˜¯å¦å»ºç«‹å®Œæˆ</p><pre><code>docker images</code></pre><h2 id="Dockerç§æœ‰ä»“åº“"><a href="#Dockerç§æœ‰ä»“åº“" class="headerlink" title="Dockerç§æœ‰ä»“åº“"></a>Dockerç§æœ‰ä»“åº“</h2><h3 id="ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®"><a href="#ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®" class="headerlink" title="ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®"></a>ç§æœ‰ä»“åº“æ­å»ºä¸é…ç½®</h3><p>ï¼ˆ1ï¼‰æ‹‰å–ç§æœ‰ä»“åº“é•œåƒï¼ˆæ­¤æ­¥çœç•¥ï¼‰</p><pre><code>docker pull registry</code></pre><p>ï¼ˆ2ï¼‰å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨</p><pre><code>docker run -di --name=registry -p 5000:5000 registry</code></pre><p>ï¼ˆ3ï¼‰æ‰“å¼€æµè§ˆå™¨ è¾“å…¥åœ°å€<a href="http://192.168.184.141:5000/v2/_catalog%E7%9C%8B%E5%88%B0%60%7B&quot;repositories&quot;:[]%7D%60">http://192.168.184.141:5000/v2/_catalogçœ‹åˆ°`{"repositories":[]}`</a> è¡¨ç¤ºç§æœ‰ä»“åº“æ­å»ºæˆåŠŸå¹¶ä¸”å†…å®¹ä¸ºç©º</p><p>ï¼ˆ4ï¼‰ä¿®æ”¹daemon.json</p><pre><code>vi /etc/docker/daemon.json</code></pre><p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜é€€å‡ºã€‚</p><pre><code>&amp;#123;"insecure-registries":["192.168.184.141:5000"]&amp;#125; </code></pre><p>æ­¤æ­¥ç”¨äºè®© dockerä¿¡ä»»ç§æœ‰ä»“åº“åœ°å€</p><p>ï¼ˆ5ï¼‰é‡å¯docker æœåŠ¡</p><pre><code>systemctl restart docker</code></pre><h2 id="é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“"><a href="#é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“" class="headerlink" title="é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“"></a>é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“</h2><p>ï¼ˆ1ï¼‰æ ‡è®°æ­¤é•œåƒä¸ºç§æœ‰ä»“åº“çš„é•œåƒ</p><pre><code>docker tag jdk1.8 192.168.184.141:5000/jdk1.8</code></pre><p>ï¼ˆ2ï¼‰å†æ¬¡å¯åŠ¨ç§æœå®¹å™¨</p><pre><code>docker start registry</code></pre><p>ï¼ˆ3ï¼‰ä¸Šä¼ æ ‡è®°çš„é•œåƒ</p><pre><code>docker push 192.168.184.141:5000/jdk1.8</code></pre><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><pre class=" language-shell"><code class="language-shell"># æ‰§è¡Œdocker-composeå‘½ä»¤$ docker-composedocker-compose: command not found# å¦‚æœæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œä¸‹è½½å®‰è£…$ sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose && sudo chmod +x /usr/local/bin/docker-compose$ docker-compose -vdocker-compose version 1.20.1, build 5d8c71b## åœ¨/usr/local åˆ›å»ºdocker ç›®å½•mkdir dockercd docker## åœ¨docker åˆ›å»ºä¸åŒåº”ç”¨çš„æ–‡ä»¶å¤¹mkdir tomcatcd tomcat## åˆ›å»ºæ‰§è¡Œè„šæœ¬vim docker-compose.yml## ç¼–è¾‘è„šæœ¬ï¼ˆymlæ–‡ä»¶ä¸èƒ½ç”¨tabé”®æ‰“ç©ºæ ¼ï¼‰version: '3'services:   tomcat:    restart: always    image: tomcat    container_name: tomcat    ports:      - 88888:8080    volums:      - /usr/local/docker/myshop/ROOT:/usr/local/tomcat/webapps/ROOT## å¯åŠ¨docker-composedocker-compose up## å…³é—­å®¹å™¨docker-compose down## å¸¦docker-compose.ymlè·¯å¾„docker-compose -f /usr/local/docker/tomcat/ up## å®ˆæŠ¤æ¨¡å¼docker-compose -d up#æŸ¥çœ‹æ—¥å¿—docker-compose logs tomcat(docker-compose.ymlèµ·çš„åå­—)#æŸ¥çœ‹æ—¥å¿—+ç›‘å¬docker-compose logs -f tomcat(docker-compose.ymlèµ·çš„åå­—)</code></pre><h3 id="docker-for-tenserflow-serving"><a href="#docker-for-tenserflow-serving" class="headerlink" title="docker for tenserflow serving"></a>docker for tenserflow serving</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">## RESTFUL api å½¢å¼</span>docker pull tensorflow/serving<span class="token function">mkdir</span> -p /tmp/tfserving<span class="token function">cd</span> /tmp/tfserving<span class="token function">git</span> clone https://github.com/tensorflow/servingdocker run -dt -p 8501:8501 -v <span class="token string">"/tmp/tfserving/serving/tensorflow_serving/servables/tensorflow/testdata/saved_model_half_plus_two_cpu:/models/half_plus_two"</span> -e MODEL_NAME<span class="token operator">=</span>half_plus_two tensorflow/servingcurl -d <span class="token string">'&amp;#123;"instances": [1.0, 2.0, 5.0]&amp;#125;'</span>  -X POST http://localhost:8501/v1/models/half_plus_two:predict <span class="token comment" spellcheck="true">## </span></code></pre><h2 id="docker-å¸¸è§é”™è¯¯"><a href="#docker-å¸¸è§é”™è¯¯" class="headerlink" title="docker å¸¸è§é”™è¯¯"></a>docker å¸¸è§é”™è¯¯</h2><p>WARNING: IPv4 forwarding is disabled. Networking will not work.<a href="https://www.cnblogs.com/Neeo/articles/12719390.html#2421676247">#</a><a href="https://www.cnblogs.com/Neeo/articles/12719390.html#top">top</a></p><p>dockerå¯åŠ¨å®¹å™¨æ—¶ï¼ŒæŠ¥<code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code>é”™è¯¯ã€‚<br>è§£å†³åŠæ³•ï¼š</p><ol><li>ç¼–è¾‘<code>vi /etc/sysctl.conf</code>æ–‡ä»¶æˆ–è€…<code>vi /usr/lib/sysctl.d/00-system.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ ï¼š</li></ol><pre><code>Copynet.ipv4.ip_forward = 1</code></pre><ol><li>é‡å¯networkæœåŠ¡ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸï¼Œè¿”å›<code>net.ipv4.ip_forward = 1</code>è¡¨ç¤ºä¿®æ”¹æˆåŠŸã€‚</li></ol><pre><code>Copy[root@C ~]# systemctl restart network[root@C ~]# sysctl net.ipv4.ip_forwardnet.ipv4.ip_forward = 1</code></pre><ol><li>åˆ é™¤ä¹‹å‰çš„å®¹å™¨ï¼Œé‡æ–°åˆ›å»ºæ–°å®¹å™¨å³å¯ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://juejin.im/post/5da1897ae51d4578110dc7a1">Dockerå®¹å™¨å¯åŠ¨æŠ¥WARNING: IPv4 forwarding is disabled. Networking will not work</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>neo4j</title>
      <link href="/2020/05/11/neo4j/"/>
      <url>/2020/05/11/neo4j/</url>
      
        <content type="html"><![CDATA[<h1 id="neo4j"><a href="#neo4j" class="headerlink" title="neo4j"></a>neo4j</h1><h2 id="å®‰è£…neo4j"><a href="#å®‰è£…neo4j" class="headerlink" title="å®‰è£…neo4j"></a>å®‰è£…neo4j</h2><h2 id="docker-å®‰è£…neo4j"><a href="#docker-å®‰è£…neo4j" class="headerlink" title="docker å®‰è£…neo4j"></a>docker å®‰è£…neo4j</h2><ol><li><code>docker pull neo4j</code></li><li><code>sudo docker run --name neo4j --detach --publish=7474:7474 --publish=7687:7687  --volume=/home/daiyizheng/docker/neo4j/data:/data  --volume=/home/daiyizheng/docker/neo4j/logs:/logs --volume=/home/daiyizheng/docker/neo4j/conf:/conf --volume=/home/daiyizheng/docker/neo4j/import:/import            --env=NEO4J_dbms_memory_pagecache_size=8G  --env=NEO4J_dbms_memory_heap_initial__size=4G --env=NEO4J_dbms_memory_heap_max__size=8G neo4j</code></li></ol><h2 id="édocker-å®‰è£…"><a href="#édocker-å®‰è£…" class="headerlink" title="édocker å®‰è£…"></a>édocker å®‰è£…</h2><p>JDKç‰ˆæœ¬ï¼š1.8</p><p>å·¥å…·ï¼šXshell6ã€Xftp6</p><p>Neo4jæ˜¯åŸºäºJavaçš„å›¾å½¢æ•°æ®åº“ï¼Œè¿è¡ŒNeo4jéœ€è¦å¯åŠ¨JVMè¿›ç¨‹ï¼Œå› æ­¤å¿…é¡»å®‰è£…JAVA SEçš„JDKã€‚</p><p>ä¸‹è½½å®‰è£…åŒ… <a href="http://doc.we-yun.com:1008/neo4j/3.5.20/">http://doc.we-yun.com:1008/neo4j/3.5.20/</a></p><p>liunxç¯å¢ƒNeo4jä¸‹è½½åœ°å€ï¼š<a href="http://neo4j.com.cn/topic/5b003eae9662eee704f31cee(%E7%A4%BE%E5%8C%BA%E7%89%88%E5%85%8D%E8%B4%B9)">http://neo4j.com.cn/topic/5b003eae9662eee704f31cee(ç¤¾åŒºç‰ˆå…è´¹)</a></p><p>æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨å‘½ä»¤ä¸‹è½½ï¼š</p><p> curl -O <a href="http://dist.neo4j.org/neo4j-community-3.4.5-unix.tar.gz">http://dist.neo4j.org/neo4j-community-3.4.5-unix.tar.gz</a></p><p>2ï¼šè§£å‹å®‰è£…</p><p>tar -axvf neo4j-community-3.4.5-unix.tar.gz</p><p>3:ä¿®æ”¹é…ç½®</p><p>åœ¨å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ°confç›®å½•ä¸‹çš„neo4j.confæ–‡ä»¶</p><p>ä¿®æ”¹ç›¸åº”é…ç½®å¦‚ä¸‹ï¼š</p><pre class=" language-shell"><code class="language-shell"># ä¿®æ”¹ç¬¬22è¡Œload csvæ—¶lè·¯å¾„ï¼Œåœ¨å‰é¢åŠ ä¸ª#ï¼Œå¯ä»ä»»æ„è·¯å¾„è¯»å–æ–‡ä»¶#dbms.directories.import=import# ä¿®æ”¹35è¡Œå’Œ36è¡Œï¼Œè®¾ç½®JVMåˆå§‹å †å†…å­˜å’ŒJVMæœ€å¤§å †å†…å­˜# ç”Ÿäº§ç¯å¢ƒç»™çš„JVMæœ€å¤§å †å†…å­˜è¶Šå¤§è¶Šå¥½ï¼Œä½†æ˜¯è¦å°äºæœºå™¨çš„ç‰©ç†å†…å­˜dbms.memory.heap.initial_size=5gdbms.memory.heap.max_size=10g# ä¿®æ”¹46è¡Œï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªæ˜¯ç¼“å­˜ï¼Œå¦‚æœæœºå™¨é…ç½®é«˜ï¼Œè¿™ä¸ªè¶Šå¤§è¶Šå¥½dbms.memory.pagecache.size=10g# ä¿®æ”¹54è¡Œï¼Œå»æ‰æ”¹è¡Œçš„#ï¼Œå¯ä»¥è¿œç¨‹é€šè¿‡ipè®¿é—®neo4jæ•°æ®åº“dbms.connectors.default_listen_address=0.0.0.0# é»˜è®¤ boltç«¯å£æ˜¯7687ï¼Œhttpç«¯å£æ˜¯7474ï¼Œhttpså…³å£æ˜¯7473ï¼Œä¸ä¿®æ”¹ä¸‹é¢3é¡¹ä¹Ÿå¯ä»¥# ä¿®æ”¹71è¡Œï¼Œå»æ‰#ï¼Œè®¾ç½®httpç«¯å£ä¸º7687ï¼Œç«¯å£å¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦ä¸å’Œå…¶ä»–ç«¯å£å†²çªå°±è¡Œ#dbms.connector.bolt.listen_address=:7687# ä¿®æ”¹75è¡Œï¼Œå»æ‰#ï¼Œè®¾ç½®httpç«¯å£ä¸º7474ï¼Œç«¯å£å¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦ä¸å’Œå…¶ä»–ç«¯å£å†²çªå°±è¡Œdbms.connector.http.listen_address=:7474# ä¿®æ”¹79è¡Œï¼Œå»æ‰#ï¼Œè®¾ç½®httpç«¯å£ä¸º7473ï¼Œç«¯å£å¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦ä¸å’Œå…¶ä»–ç«¯å£å†²çªå°±è¡Œdbms.connector.https.listen_address=:7473# ä¿®æ”¹227è¡Œï¼Œå»æ‰#ï¼Œå…è®¸ä»è¿œç¨‹urlæ¥load csvdbms.security.allow_csv_import_from_file_urls=true# ä¿®æ”¹246è¡Œï¼Œå…è®¸ä½¿ç”¨neo4j-shellï¼Œç±»ä¼¼äºmysql å‘½ä»¤è¡Œä¹‹ç±»çš„dbms.shell.enabled=true# ä¿®æ”¹235è¡Œï¼Œå»æ‰#ï¼Œè®¾ç½®è¿æ¥neo4j-shellçš„ç«¯å£ï¼Œä¸€èˆ¬éƒ½æ˜¯localhostæˆ–è€…127.0.0.1ï¼Œè¿™æ ·å®‰å…¨ï¼Œå…¶ä»–åœ°å€çš„è¯ï¼Œä¸€èˆ¬ä½¿ç”¨httpså°±è¡Œdbms.shell.host=127.0.0.1# ä¿®æ”¹250è¡Œï¼Œå»æ‰#ï¼Œè®¾ç½®neo4j-shellç«¯å£ï¼Œç«¯å£å¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦ä¸å’Œå…¶ä»–ç«¯å£å†²çªå°±è¡Œdbms.shell.port=1337# ä¿®æ”¹254è¡Œï¼Œè®¾ç½®neo4jå¯è¯»å¯å†™dbms.read_only=false</code></pre><p>4ï¼šå¯åŠ¨</p><p> è¿›å…¥binç›®å½•æ‰§è¡Œ./neo4j start</p><p>è¿›å…¥binç›®å½•æ‰§è¡Œ./neo4j stop</p><p>æŸ¥çœ‹å›¾æ•°æ®åº“çŠ¶æ€</p><p>è¿›å…¥binç›®å½•æ‰§è¡Œ./neo4j status</p><p>7ï¼šå®¢æˆ·ç«¯è®¿é—®</p><p>http://æœåŠ¡å™¨ipåœ°å€:7474/browser/</p><p>åœ¨æµè§ˆå™¨è®¿é—®å›¾æ•°æ®åº“æ‰€åœ¨çš„æœºå™¨ä¸Šçš„7474ç«¯å£ï¼ˆç¬¬ä¸€æ¬¡è®¿é—®è´¦å·neo4jï¼Œå¯†ç neo4jï¼Œä¼šæç¤ºä¿®æ”¹åˆå§‹å¯†ç ï¼‰</p><h2 id="é”™è¯¯è§£å†³"><a href="#é”™è¯¯è§£å†³" class="headerlink" title="é”™è¯¯è§£å†³"></a>é”™è¯¯è§£å†³</h2><p>è®¿é—®Neo4jéªŒè¯å¤±è´¥ï¼ˆThe client is unauthorized due to authentication failure.ï¼‰</p><p>å¤§æ¦‚æ„æ€å°±æ˜¯è¯´æœåŠ¡å™¨éªŒè¯å¤±è´¥ã€‚</p><p>å¦‚æœä½ æœ‰åœ¨æµè§ˆå™¨ä¸Šç™»å½•ä¸åŒçš„neo4jæ•°æ®åº“ï¼Œå¾ˆå¯èƒ½æ˜¯ç”±äºç¼“å­˜æ²¡æœ‰æ¸…ç†æ‰å¯¼è‡´çš„ã€‚<br>å¯ä»¥è¯•è¯•æ— ç—•æµè§ˆæ¥è®¿é—®neo4jçš„webé¡µé¢ã€‚<br>å¦å¤–æœ‰è¿˜æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><p>åœæ­¢neo4jæœåŠ¡ï¼Œå¹¶ä¸”åˆ é™¤<code>data/dbms/auth</code>ï¼Œé‡æ–°å¯åŠ¨<br>ä¿®æ”¹neo4j.confé…ç½®æ–‡ä»¶ï¼Œå–æ¶ˆéªŒè¯æœºåˆ¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š<br><code>dbms.security.auth_enabled=false</code></p><h2 id="neo4jæ•°æ®åº“è¿ç§»â€“Neo4jæ•°æ®åº“å¯¼å…¥å¯¼å‡ºçš„æ–¹æ³•"><a href="#neo4jæ•°æ®åº“è¿ç§»â€“Neo4jæ•°æ®åº“å¯¼å…¥å¯¼å‡ºçš„æ–¹æ³•" class="headerlink" title="neo4jæ•°æ®åº“è¿ç§»â€“Neo4jæ•°æ®åº“å¯¼å…¥å¯¼å‡ºçš„æ–¹æ³•"></a>neo4jæ•°æ®åº“è¿ç§»â€“Neo4jæ•°æ®åº“å¯¼å…¥å¯¼å‡ºçš„æ–¹æ³•</h2><p>Neo4jæ•°æ®è¿›è¡Œå¤‡ä»½ã€è¿˜åŸã€è¿ç§»çš„æ“ä½œæ—¶ï¼Œé¦–å…ˆè¦å…³é—­neo4j;</p><pre><code>/usr/share/neo4j/binneo4j stop</code></pre><p>å¦‚æœå‡ºç°</p><pre><code>Neo4j not running</code></pre><p>å‡ºç°è¿™ç§æƒ…å†µ, Neo4jæ²¡æœ‰è¿è¡Œ, ä½†æ˜¯æµè§ˆå™¨ä»ç„¶å¯ä»¥è®¿é—®neo4jæ•°æ®åº“çš„æƒ…å†µ, ç›´æ¥æ‰§è¡Œå¯¼å…¥æ•°æ®å,æ˜¯æ— æ³•çœ‹åˆ°å¯¼å…¥çš„æ•°æ®åº“,</p><p>å…¶å®è¿™ç§æƒ…å†µä¸‹Neo4jä»åœ¨è¿è¡Œ(å¦åˆ™æµè§ˆå™¨æ˜¯æ— æ³•ç„¶è®¿é—®çš„),</p><p>è¿™å°±éœ€è¦å¼ºåˆ¶æ€æ­»Neo4jè¿›ç¨‹,åˆ™æ‰§è¡Œå‘½ä»¤ </p><pre><code>ps -ef|grep neo4j</code></pre><p> <img src="/2020/05/11/neo4j/1.png" alt="img"></p><pre><code>kill -9 &lt;å¯¹åº”çš„pid&gt;</code></pre><p>å…³é—­Neo4jå, å†æ¬¡ç”¨æµè§ˆå™¨è®¿é—®Neo4j,æ˜¯æ— æ³•è®¿é—®çš„,è¯´æ˜Neo4jæ˜¯å…³é—­è¿è¡Œäº†,åœ¨æ­¤æƒ…å†µä¸‹,æ˜¯å¯ä»¥æ‰§è¡ŒNeo4jçš„æ•°æ®å¯¼å‡ºä¸å¯¼å…¥çš„.</p><p>æ‰§è¡Œæ•°æ®å¯¼å‡ºå‘½ä»¤</p><pre><code>./neo4j-admin  dump --database=graph.db --to=/home/robot/Neoj_data/graph.db.dump</code></pre><p>æ‰§è¡Œæ•°æ®å¯¼å…¥å‘½ä»¤</p><pre><code>neo4j-admin load --from=/home/robot/Neoj_data/graph.db.dump --database=graph.db --force  #æ•°æ®å¯¼å…¥neo4j start        </code></pre><h2 id="å¯¼å…¥csv-æ–‡ä»¶"><a href="#å¯¼å…¥csv-æ–‡ä»¶" class="headerlink" title="å¯¼å…¥csv æ–‡ä»¶"></a>å¯¼å…¥csv æ–‡ä»¶</h2><p>å°†æ–‡ä»¶å¤åˆ¶åˆ°import æ–‡ä»¶å¤¹ä¸­</p><p>åœ¨<code>http://127.0.0.1:7474/browser/</code>çª—å£ä¸­æ‰§è¡Œè„šæœ¬ï¼ˆæ³¨æ„ï¼Œæ•°æ®è¿‡å¤§å¯èƒ½æŠ¥é”™ï¼‰</p><p>å¯ä»¥åœ¨æµè§ˆå™¨ç«¯æˆ–è€…æ˜¯neo4jçš„consoleä¸‹è¿›è¡Œè¿™ç§æ–¹å¼çš„æ•°æ®å¯¼å…¥ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼åªé€‚ç”¨äº20Mä»¥å†…çš„æ•°æ®å¯¼å…¥ï¼Œå¯¹äºå¤§é‡æ•°æ®æ˜¯ä¸é€‚ç”¨çš„ã€‚</p><pre class=" language-shell"><code class="language-shell"># nodeèŠ‚ç‚¹LOAD CSV WITH HEADERS  FROM "file:///node.csv" AS line MERGE (p:Entity&#123;id:line.id,name:line.name&#125;)##æŸ¥è€ƒèŠ‚ç‚¹start n = node(*)return n# å…³ç³»LOAD CSV WITH HEADERS FROM "file:///relationship.csv" AS line match (from:Entity&#123;id:line.start_id&#125;),(to:Entity&#123;id:line.end_id&#125;)merge (from)-[r:rel&#123;property1:line.property1,property2:line.property2&#125;]->(to)</code></pre><h3 id="å‘½ä»¤è¡Œå¯¼å…¥"><a href="#å‘½ä»¤è¡Œå¯¼å…¥" class="headerlink" title="å‘½ä»¤è¡Œå¯¼å…¥"></a>å‘½ä»¤è¡Œå¯¼å…¥</h3><pre class=" language-shell"><code class="language-shell">./neo4j-admin import --database=pkubase.db --nodes "/home/daiyizheng/æ–‡æ¡£/NLP-NER-projet/CCKS -2020-ckbqa/data/pre-data/node.csv" --relationships "/home/daiyizheng/æ–‡æ¡£/NLP-NER-projet/CCKS -2020-ckbqa/data/pre-data/relation.csv" --ignore-extra-columns=true --ignore-missing-nodes=true --ignore-duplicate-nodes=true</code></pre><pre class=" language-shell"><code class="language-shell">importå¯¼å…¥csvimportè¯­æ³•neo4j-admin import [--mode=csv] [--database=<name>]                          [--additional-config=<config-file-path>]                          [--report-file=<filename>]                          [--nodes[:Label1:Label2]=<"file1,file2,...">]                          [--relationships[:RELATIONSHIP_TYPE]=<"file1,file2,...">]                          [--id-type=<STRING|INTEGER|ACTUAL>]                          [--input-encoding=<character-set>]                          [--ignore-extra-columns[=<true|false>]]                          [--ignore-duplicate-nodes[=<true|false>]]                          [--ignore-missing-nodes[=<true|false>]]                          [--multiline-fields[=<true|false>]]                          [--delimiter=<delimiter-character>]                          [--array-delimiter=<array-delimiter-character>]                          [--quote=<quotation-character>]                          [--max-memory=<max-memory-that-importer-can-use>]                          [--f=<File containing all arguments to this import>]</code></pre><pre class=" language-python"><code class="language-python">å‘½ä»¤ï¼š<span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>neo4j<span class="token operator">-</span><span class="token keyword">import</span> <span class="token operator">-</span><span class="token operator">-</span>into data<span class="token operator">/</span>databases<span class="token operator">/</span>graph_kg_merge_id<span class="token punctuation">.</span>db <span class="token operator">-</span><span class="token operator">-</span>nodes<span class="token punctuation">:</span>Persons data<span class="token operator">/</span>csv_kg_merge_id<span class="token operator">/</span>persons<span class="token punctuation">.</span>csv <span class="token operator">-</span><span class="token operator">-</span>nodes<span class="token punctuation">:</span>Industry data<span class="token operator">/</span>csv_kg_merge_id<span class="token operator">/</span>industry<span class="token punctuation">.</span>csv <span class="token operator">-</span><span class="token operator">-</span>relationships<span class="token punctuation">:</span>Director data<span class="token operator">/</span>csv_kg_merge_id<span class="token operator">/</span>director<span class="token punctuation">.</span>csv <span class="token operator">-</span><span class="token operator">-</span>multiline<span class="token operator">-</span>fields<span class="token operator">=</span>true</code></pre><pre class=" language-she"><code class="language-she">å„æ–‡ä»¶å†…å®¹ä¸€ã€èŠ‚ç‚¹name:ID è¡¨ç¤ºè¯¥åˆ—çš„å±æ€§åä¸ºnameï¼ŒID è¡¨ç¤ºè¯¥å±æ€§æ˜¯å”¯ä¸€æ ‡ç¤ºä¸€ä¸ªå®ä½“çš„å±æ€§ï¼ˆç±»ä¼¼å…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸»ç ï¼‰ï¼Œæ‹¬å·è¡¨ç¤ºä¸€ä¸ªid-groupï¼Œå³è¡¨ç¤ºè¯¥IDå”¯ä¸€è¡¨ç¤ºæ‹¬å·å†…ç§ç±»çš„å®ä½“ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å®ä½“ï¼›èŠ‚ç‚¹Persons.csvï¼šperson_name:id,name71927,ä¹œæ ‡@1963-01-0171928,å†¯æ³½èˆŸ@1954-01-0171929,å¼ å®‡é”‹@1965-01-0171930,ä¸æ¶›@1979-01-0171931,å‘¨é™å°§@1963-05-01èŠ‚ç‚¹industry.csvï¼šindustry_name:id,id,name71917,æ±Ÿè‹æ–°æ—¥æ–°èƒ½æºè½¦è¾†æœ‰é™å…¬å¸,æ±Ÿè‹æ–°æ—¥æ–°èƒ½æºè½¦è¾†æœ‰é™å…¬å¸71918,åŒ—äº¬æ–°æ³‰å¿—å’Œæ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸,åŒ—äº¬æ–°æ³‰å¿—å’Œæ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸71919,èŠœæ¹–æ–°æ³‰æ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸,èŠœæ¹–æ–°æ³‰æ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸71920,å®æ³¢æ–°æ³‰å¿—å’Œæ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸,å®æ³¢æ–°æ³‰å¿—å’Œæ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸71921,å®æ³¢æ–°æ³‰æ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸,å®æ³¢æ–°æ³‰æ±½è½¦é¥°ä»¶ç³»ç»Ÿæœ‰é™å…¬å¸äºŒã€å…³ç³»START_ID å’ŒEND_ID è¡¨ç¤ºè¾¹çš„èµ·ç‚¹å’Œç»ˆç‚¹çš„IDï¼Œå¯ä»¥åŠ ä¸Šå®ƒä»¬å„è‡ªçš„id-groupï¼›å…³ç³» director.csv:START_ID,:END_ID,position71927,16816,371928,16840,471929,16047,371930,16573,471931,16918,4</code></pre><h2 id="Neo4jå¤šåº“åˆ‡æ¢"><a href="#Neo4jå¤šåº“åˆ‡æ¢" class="headerlink" title="Neo4jå¤šåº“åˆ‡æ¢"></a><strong>Neo4jå¤šåº“åˆ‡æ¢</strong></h2><p>æ–¹æ³•ä¸€ï¼š</p><p>å› ä¸ºNeo4jçš„importå¯¼å…¥æ—¶ï¼Œåªèƒ½å¯¼å…¥ä¸€ä¸ªä¸å­˜çš„dbï¼Œè¿™å°±åœ¨æƒ³åˆ›å»ºå¤šä¸ªåº“æ—¶ï¼Œéœ€è¦å»åˆ‡æ¢ï¼ŒNeo4jé»˜è®¤çš„åº“æ˜¯graph.dbï¼Œåœ¨./conf/neo4j.confå¯ä»¥ä¿®æ”¹</p><pre class=" language-shell"><code class="language-shell"># Neo4j configuration## For more details and a complete list of settings, please see# https://neo4j.com/docs/operations-manual/current/reference/configuration-settings/#*****************************************************************# The name of the database to mount#dbms.active_database=graph.db</code></pre><p>æ–¹æ³•äºŒï¼š</p><p>åˆ‡æ¢å¤šä¸ªåº“çš„æ–¹æ³•ï¼Œå°†æ–°åº“é‡æ–°è¿æ¥åˆ°é»˜è®¤åº“graph.dbï¼Œç„¶åé‡å¯Neo4j </p><pre class=" language-shell"><code class="language-shell">//è½¯è¿æ¥>>>cd ./data/databases/>>>ln -s graph_kg.db graph.db//é‡å¯neo4j>>>cd $NEO4j_HOME/bin>>>./neo4j restart// åˆ é™¤è½¯è¿æ¥>>>ln-s test_chk  test_chk_ln>>>rm -rf  ./test_chk_ln</code></pre><h2 id="neo4j-åŸºæœ¬æ“ä½œå…ƒç´ "><a href="#neo4j-åŸºæœ¬æ“ä½œå…ƒç´ " class="headerlink" title="neo4j åŸºæœ¬æ“ä½œå…ƒç´ "></a>neo4j åŸºæœ¬æ“ä½œå…ƒç´ </h2><ul><li>neo4jå¯æ”¯æŒè¯­è¨€ï¼š**.NETã€Javaã€Springã€JavaScriptã€Pythonã€Rubyã€PHPã€Rã€Goã€C / C++ã€Clojureã€Perlã€Haskell**</li><li>å‡ ä¸ªä¸“æœ‰åè¯ï¼š<strong>å˜é‡ï¼ˆæ ‡è¯†ç¬¦ï¼‰ã€èŠ‚ç‚¹ã€å…³ç³»ã€å®ä½“ã€æ ‡ç­¾ã€å±æ€§ã€ç´¢å¼•ã€çº¦æŸ</strong></li></ul><h2 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">## æŸ¥çš„è¯­å¥æœ‰ï¼šWHEREè¯­å¥ã€ORDER BY é»˜è®¤æ˜¯å‡åºï¼Œé™åºæ·»åŠ DESCã€LIMIT è¿”å›é å‰çš„ä¸€å®šæ•°ç›®çš„æ•°æ®ã€SKIP è¿”å›é åçš„ä¸€å®šæ•°ç›®çš„æ•°æ®ã€UNION å­æŸ¥è¯¢ç»“æœåˆå¹¶</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢åŸºæœ¬ç»“æ„</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:NODENAME<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> n <span class="token comment" spellcheck="true"># LIMIT </span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:NODENAME<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> n <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token comment" spellcheck="true"># SKIP</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:NODENAME<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> n SKIP <span class="token number">5</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:NODENAME<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> n SKIP <span class="token number">1</span> <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token comment" spellcheck="true">## union</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>pp:Person<span class="token punctuation">)</span><span class="token keyword">RETURN</span> pp<span class="token punctuation">.</span>age<span class="token punctuation">,</span>pp<span class="token punctuation">.</span>name<span class="token keyword">UNION</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token number">cc</span>:Customer<span class="token punctuation">)</span><span class="token keyword">RETURN</span> <span class="token number">cc</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span><span class="token number">cc</span><span class="token punctuation">.</span>name<span class="token comment" spellcheck="true">## æŸ¥è¯¢èŠ‚ç‚¹ä¸ªæ•°ï¼š</span><span class="token keyword">match</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢æ‰€æœ‰çš„å…³ç³»ç±»å‹ï¼š</span><span class="token keyword">CALL</span> <span class="token number">db</span><span class="token punctuation">.</span>relationshipTypes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢æ‰€æœ‰çš„èŠ‚ç‚¹æ ‡ç­¾ï¼š</span><span class="token keyword">CALL</span> <span class="token number">db</span><span class="token punctuation">.</span>labels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢èŠ‚ç‚¹å…³ç³»ç§ç±»ï¼š</span><span class="token keyword">CALL</span> <span class="token number">db</span><span class="token punctuation">.</span><span class="token keyword">schema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢Nå±‚å…³ç³»çš„èŠ‚ç‚¹ï¼š</span><span class="token keyword">match</span> q<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">return</span> q <span class="token keyword">limit</span> <span class="token number">200</span> è¿™ä¸ªä¸ºæŸ¥è¯¢<span class="token number">5</span>åˆ°<span class="token number">8</span>å±‚å…³ç³»çš„<span class="token keyword">match</span> q<span class="token operator">=</span><span class="token punctuation">(</span>dh<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>jq<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>rr<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">return</span> q <span class="token keyword">limit</span> <span class="token number">400</span><span class="token comment" spellcheck="true">## æŸ¥è¯¢èŠ‚ç‚¹å…³ç³»æ•°ä¸ªæ•°</span><span class="token keyword">match</span><span class="token punctuation">(</span>dh:Person<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>jq:Teacher<span class="token punctuation">)</span> <span class="token keyword">with</span> dh<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token keyword">as</span> dhs <span class="token keyword">where</span> dhs <span class="token operator">></span> <span class="token number">2</span> <span class="token keyword">return</span> dh<span class="token comment" spellcheck="true">## return</span>è¿”å›ä¸€ä¸ªèŠ‚ç‚¹ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span>n:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"B"&amp;#125;) return n;</span>è¿”å›ä¸€ä¸ªå…³ç³»ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span>n:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;)-[r:KNOWS]->(c) return r;</span>è¿”å›ä¸€ä¸ªå±æ€§ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span>n:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;) return n.name;</span>è¿”å›æ‰€æœ‰èŠ‚ç‚¹ï¼š<span class="token keyword">match</span> p<span class="token operator">=</span><span class="token punctuation">(</span>:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;)-[r]->(b) return *;</span>åˆ—åˆ«åï¼š <span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span>:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;) return a.age as thisisage;</span>è¡¨è¾¾å¼ï¼š <span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span>:Node:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;) return a.age >30 ,â€literalâ€,(a)â€“>();</span>å”¯ä¸€ç»“æœï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span>:Node<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"A"&amp;#125;)â€“>(b) return distinct b;</span><span class="token comment" spellcheck="true">## merge-æŸ¥è¯¢</span><span class="token comment" spellcheck="true">## åœ¨mergeå­å¥ä¸­æŒ‡å®šon matchå­å¥</span><span class="token comment" spellcheck="true">## å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆæ‰§è¡Œon matchå­å¥ï¼Œä¿®æ”¹èŠ‚ç‚¹çš„å±æ€§ï¼›</span><span class="token keyword">MERGE</span> <span class="token punctuation">(</span>person:Person<span class="token punctuation">)</span><span class="token keyword">ON</span> <span class="token keyword">MATCH</span> <span class="token keyword">SET</span> person<span class="token punctuation">.</span>found <span class="token operator">=</span> <span class="token boolean">TRUE</span> <span class="token punctuation">,</span> person<span class="token punctuation">.</span>lastAccessed <span class="token operator">=</span> <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> <span class="token keyword">merge</span>å­å¥ç”¨äº<span class="token keyword">match</span>æˆ–<span class="token keyword">create</span>å¤šä¸ªå…³ç³»<span class="token comment" spellcheck="true">## mergeå­å¥ç”¨äºmatchæˆ–createå¤šä¸ªå…³ç³»</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>oliver:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Oliver Stone' &amp;#125;),(reiner:Person &amp;#123; name: 'Rob Reiner' &amp;#125;)</span><span class="token keyword">MERGE</span> <span class="token punctuation">(</span>oliver<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:DIRECTED<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">(</span>movie:Movie<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>reiner<span class="token punctuation">)</span><span class="token keyword">RETURN</span> movieé›†åˆå‡½æ•°æŸ¥è¯¢ï¼ˆ<span class="token number">1</span>ï¼‰é€šè¿‡idå‡½æ•°ï¼Œè¿”å›èŠ‚ç‚¹æˆ–å…³ç³»çš„ID<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Oliver Stone' &amp;#125;)-[r]->(movie)</span><span class="token keyword">RETURN</span> id<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>ï¼ˆ<span class="token number">2</span>ï¼‰é€šè¿‡<span class="token keyword">type</span>å‡½æ•°ï¼ŒæŸ¥è¯¢å…³ç³»çš„ç±»å‹<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Oliver Stone' &amp;#125;)-[r]->(movie)</span><span class="token keyword">RETURN</span> <span class="token keyword">type</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>ï¼ˆ<span class="token number">3</span>ï¼‰é€šè¿‡lableså‡½æ•°ï¼ŒæŸ¥è¯¢èŠ‚ç‚¹çš„æ ‡ç­¾<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Oliver Stone' &amp;#125;)-[r]->(movie)</span><span class="token keyword">RETURN</span> lables<span class="token punctuation">(</span>movie<span class="token punctuation">)</span><span class="token punctuation">;</span>ï¼ˆ<span class="token number">4</span>ï¼‰é€šè¿‡<span class="token keyword">keys</span>å‡½æ•°ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹æˆ–å…³ç³»çš„å±æ€§é”®<span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token keyword">WHERE</span> <span class="token number">a</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token keyword">RETURN</span> <span class="token keyword">keys</span><span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span>ï¼ˆ<span class="token number">5</span>ï¼‰é€šè¿‡properties<span class="token punctuation">(</span><span class="token punctuation">)</span>å‡½æ•°ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹æˆ–å…³ç³»çš„å±æ€§<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>p:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Stefan', city: 'Berlin' &amp;#125;)</span><span class="token keyword">RETURN</span> properties<span class="token punctuation">(</span>p<span class="token punctuation">)</span>ï¼ˆ<span class="token number">6</span>ï¼‰nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span>ï¼šè¿”å›pathä¸­èŠ‚ç‚¹<span class="token keyword">match</span> p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">-->(b)-->(c) where a.name='Alice' and c.name='Eskil' return nodes(p)</span>ï¼ˆ<span class="token number">7</span>ï¼‰relationships<span class="token punctuation">(</span>path<span class="token punctuation">)</span>ï¼šè¿”å›pathä¸­çš„å…³ç³»<span class="token keyword">match</span> p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">-->(b)-->(c) where a.name='Alice' and c.name='Eskil' return relationships(p)</span>è·¯å¾„æŸ¥è¯¢å¸¸è§„è·¯å¾„æŸ¥è¯¢ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'm' &amp;#125;)-->(person)</span><span class="token keyword">RETURN</span> person<span class="token punctuation">;</span>è¿”å›çš„æ˜¯:nameä¸ºmçš„è¿™ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œä¸åŒ…æ‹¬mèŠ‚ç‚¹æœ¬èº«å¯å˜é•¿åº¦è·¯å¾„ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span>:Product <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;productName:'Chai'&amp;#125; )-[*1..5]-(b:Customer&amp;#123;companyName : 'Frankenversand'&amp;#125;) return a,b</span><span class="token comment" spellcheck="true">//[*1..5]å¯å˜é•¿åº¦è·¯å¾„ï¼Œä»aåˆ°bçš„1-5æ¡è·¯å¾„ï¼›</span>é›¶é•¿åº¦è·¯å¾„<span class="token keyword">START</span> <span class="token number">a</span><span class="token operator">=</span>node<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">MATCH</span> p1<span class="token operator">=</span><span class="token number">a</span><span class="token operator">-</span><span class="token punctuation">[</span>:KNOWS<span class="token operator">*</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token number">b</span><span class="token punctuation">,</span> p2<span class="token operator">=</span><span class="token number">b</span><span class="token operator">-</span><span class="token punctuation">[</span>:BLOCKS<span class="token operator">*</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token number">c</span><span class="token keyword">RETURN</span> <span class="token number">a</span><span class="token punctuation">,</span><span class="token number">b</span><span class="token punctuation">,</span><span class="token number">c</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>p2<span class="token punctuation">)</span>è¿™ä¸ªæŸ¥è¯¢å°†è¿”å›å››ä¸ªè·¯å¾„ï¼Œå…¶ä¸­æœ‰äº›è·¯å¾„é•¿åº¦ä¸º<span class="token number">0</span><span class="token punctuation">.</span>æœ€çŸ­è·¯å¾„ä½¿ç”¨shortestPathå‡½æ•°å¯ä»¥æ‰¾å‡ºä¸€æ¡ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œå¦‚ä¸‹ã€‚æŸ¥è¯¢ï¼š<span class="token keyword">START</span> <span class="token number">d</span><span class="token operator">=</span>node<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">e</span><span class="token operator">=</span>node<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">MATCH</span> p <span class="token operator">=</span> shortestPath<span class="token punctuation">(</span> <span class="token number">d</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token number">e</span> <span class="token punctuation">)</span><span class="token keyword">RETURN</span> pè¿™æ„å‘³ç€ï¼šæ‰¾å‡ºä¸¤ç‚¹é—´çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ï¼Œæœ€å¤§å…³ç³»é•¿åº¦ä¸º<span class="token number">15</span><span class="token punctuation">.</span>åœ†æ‹¬å·å†…æ˜¯ä¸€ä¸ªç®€å•çš„è·¯å¾„è¿æ¥ï¼Œå¼€å§‹èŠ‚ç‚¹ï¼Œè¿æ¥å…³ç³»å’Œç»“æŸèŠ‚ç‚¹ã€‚å…³ç³»çš„å­—ç¬¦æè¿°åƒå…³ç³»ç±»å‹ï¼Œæœ€å¤§æ•°å’Œæ–¹å‘åœ¨å¯»æ‰¾æœ€çŸ­è·¯å¾„ä¸­éƒ½å°†è¢«ç”¨åˆ°ã€‚ä¹Ÿå¯ä»¥æ ‡è¯†è·¯å¾„ä¸ºå¯é€‰ã€‚æœ€çŸ­è·¯å¾„æ¡ˆä¾‹ä¸€ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p1:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"Jonathan Lipnicki"&amp;#125;),(p2:Person&amp;#123;name:"Joel Silver"&amp;#125;),</span>p<span class="token operator">=</span>shortestpath<span class="token punctuation">(</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> pè¿™é‡Œ<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">10</span><span class="token punctuation">]</span>è¡¨ç¤ºè·¯å¾„æ·±åº¦<span class="token number">10</span>ä»¥å†…æŸ¥æ‰¾æ‰€æœ‰å­˜åœ¨çš„å…³ç³»ä¸­çš„æœ€çŸ­è·¯å¾„å…³ç³»æœ€çŸ­è·¯å¾„æ¡ˆä¾‹äºŒï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p1:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;name:"Jonathan Lipnicki"&amp;#125;),(p2:Person&amp;#123;name:"Joel Silver"&amp;#125;),</span>p<span class="token operator">=</span>allshortestpaths<span class="token punctuation">(</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> pæ‰¾å‡ºæ‰€æœ‰æœ€çŸ­è·¯å¾„æŸ¥è¯¢å…³ç³»å±æ€§<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'matt' &amp;#125;)-[r]->( Person) RETURN r,type(r);</span>åŠŸèƒ½ï¼šæŸ¥çœ‹å§“åä¸ºmattçš„äººï¼Œåˆ°æ ‡ç­¾personä¹‹é—´ï¼Œå…³ç³»æœ‰å“ªäº›ä¸€äº›ç‰¹æ®Šçš„ç”¨æ³•ï¼š<span class="token keyword">with</span>ç”¨æ³•ï¼š<span class="token keyword">with</span>ä»å¥å¯ä»¥è¿æ¥å¤šä¸ªæŸ¥è¯¢çš„ç»“æœï¼Œå³å°†ä¸Šä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœç”¨ä½œä¸‹ä¸€ä¸ªæŸ¥è¯¢çš„å¼€å§‹ã€‚collectyç”¨æ³•ï¼šä»£è¡¨æŠŠå†…å®¹åºåˆ—åŒ–<span class="token keyword">with</span>ç”¨æ³•ã€åŒ¿åå˜é‡ï¼ˆå…·ä½“å¯ä»¥è§ã€Šå›¾æ•°æ®åº“ã€‹ï¼Œ40Pï¼‰ï¼ˆ<span class="token number">1</span>ï¼‰åŒ¿åå˜é‡<span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">-</span><span class="token punctuation">[</span>:ass<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:bss<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">b</span><span class="token punctuation">)</span>ï¼ˆ<span class="token number">2</span>ï¼‰<span class="token keyword">with</span>ç”¨æ³•ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:<span class="token keyword">work</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">b</span><span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token number">b</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">b</span><span class="token punctuation">.</span>yeah <span class="token keyword">DESC</span><span class="token keyword">RETURN</span> <span class="token number">a</span><span class="token punctuation">,</span><span class="token number">b</span>è¿‡æ»¤èšåˆå‡½æ•°çš„ç»“æœï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>david <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: â€œDavidâ€ &amp;#125;)â€“(otherPerson)â€“>() WITH otherPerson, count(*) AS foaf</span><span class="token keyword">WHERE</span> foaf <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">RETURN</span> otherPerson<span class="token punctuation">;</span>collectå‰æ’åºç»“æœï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token keyword">WITH</span> n   <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> n<span class="token punctuation">.</span>name <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">3</span>  <span class="token keyword">RETURN</span> collect<span class="token punctuation">(</span>n<span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token keyword">limit</span>æœç´¢è·¯å¾„çš„åˆ†æ”¯ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: "Anders" &amp;#125;)--(m)  WITH m  ORDER BY m.name DESC LIMIT 1  MATCH (m)--(o)  RETURN o.name;</span>UNWINDå°†ä¸€ä¸ªé›†åˆå±•å¼€ä¸ºä¸€ä¸ªå¯é€‰çš„listï¼Œæœ‰ç‚¹åƒpyä¸­çš„ç”Ÿæˆå™¨ã€‚<span class="token comment" spellcheck="true">//&amp;#123;batch: [&amp;#123;name:"Alice",age:32&amp;#125;,&amp;#123;name:"Bob",age:42&amp;#125;]&amp;#125;</span>UNWIND <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;batch&amp;#125; as row</span><span class="token keyword">CREATE</span> <span class="token punctuation">(</span>n:Label<span class="token punctuation">)</span><span class="token keyword">SET</span> n<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">row</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> n<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token keyword">row</span><span class="token punctuation">.</span>ageå…¶ä¸­<span class="token keyword">row</span>ï¼Œå°±è¢«å®šä¹‰ä¸ºä¸€ä¸ªå¯è¿­ä»£çš„Listã€‚æ¡ˆä¾‹äºŒï¼š<span class="token comment" spellcheck="true">//&amp;#123;batch: [&amp;#123;from:"alice@example.com",to:"bob@example.com",properties:&amp;#123;since:2012&amp;#125;&amp;#125;,&amp;#123;from:"alice@example.com",to:"charlie@example.com",properties:&amp;#123;since:2016&amp;#125;&amp;#125;]&amp;#125;</span>UNWIND <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;batch&amp;#125; as row</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token keyword">from</span>:Label <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;from:row.from&amp;#125;)</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token keyword">to</span>:Label <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;to:row.to&amp;#125;)</span><span class="token keyword">CREATE</span><span class="token operator">/</span><span class="token keyword">MERGE</span> <span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>rel:KNOWS<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">ON</span> <span class="token keyword">CREATE</span><span class="token punctuation">)</span> <span class="token keyword">SET</span> rel<span class="token punctuation">.</span>since <span class="token operator">=</span> <span class="token keyword">row</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>since</code></pre><h2 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">## create-åˆ›å»ºèŠ‚ç‚¹</span><span class="token keyword">create</span> <span class="token punctuation">(</span>n:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Robert Zemeckis', born: 1951 &amp;#125;) return n;</span><span class="token comment" spellcheck="true">## create-åˆ›å»ºèŠ‚ç‚¹é—´å…³ç³»</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token number">a</span>:Person<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">b</span>:Person<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'m'</span><span class="token operator">and</span> <span class="token number">b</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Andres'</span> <span class="token keyword">CREATE</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r:girl<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">b</span><span class="token punctuation">)</span> <span class="token keyword">RETURN</span> r<span class="token punctuation">;</span><span class="token comment" spellcheck="true">## create-åˆ›å»ºèŠ‚ç‚¹é—´å…³ç³» + å…³ç³»å±æ€§</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token number">a</span>:Person<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">b</span>:Person<span class="token punctuation">)</span><span class="token keyword">WHERE</span> <span class="token number">a</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'m'</span><span class="token operator">and</span> <span class="token number">b</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Andres'</span> <span class="token keyword">CREATE</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r:girl <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; roles:['friend'] &amp;#125;]->(b)</span><span class="token keyword">RETURN</span> r<span class="token punctuation">;</span><span class="token comment" spellcheck="true">##create-åˆ›å»ºå®Œæ•´è·¯å¾„path</span><span class="token keyword">CREATE</span> p <span class="token operator">=</span><span class="token punctuation">(</span>vic:Worker:Person<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name:'vic',title:"Developer" &amp;#125;)-[:WORKS_AT]->(neo)&lt;-[:WORKS_AT]-(michael:Worker:Person &amp;#123; name: 'Michael',title:"Manager" &amp;#125;)</span><span class="token keyword">RETURN</span> pé€»è¾‘ä¸ºï¼šåˆ›å»ºvicè¿™ä¸ªäººä¸å˜é‡<span class="token punctuation">(</span>neo<span class="token punctuation">)</span>çš„<span class="token punctuation">[</span>:WORKS_AT<span class="token punctuation">]</span>å…³ç³»ï¼›åˆ›å»ºmichaelè¿™ä¸ªäººä¸å˜é‡<span class="token punctuation">(</span>neo<span class="token punctuation">)</span>çš„<span class="token punctuation">[</span>:WORKS_AT<span class="token punctuation">]</span>å…³ç³»<span class="token comment" spellcheck="true">## åˆ›å»ºå”¯ä¸€æ€§èŠ‚ç‚¹ CREATE UNIQUE</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>root <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'root' &amp;#125;) </span><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:LOVES<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>someone<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> someone<span class="token comment" spellcheck="true">##  merge-on create æ–°å¢å±æ€§</span><span class="token keyword">Merge</span>å­å¥çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼šå½“æ¨¡å¼ï¼ˆPatternï¼‰å­˜åœ¨æ—¶ï¼ŒåŒ¹é…è¯¥æ¨¡å¼ï¼›å½“æ¨¡å¼ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºæ–°çš„æ¨¡å¼ï¼ˆå‚è€ƒï¼‰ã€‚å¦‚æœéœ€è¦åˆ›å»ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ‰§è¡Œ<span class="token keyword">on</span> <span class="token keyword">create</span>å­å¥ï¼Œä¿®æ”¹èŠ‚ç‚¹çš„å±æ€§<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>keanu:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Keanu Reeves' &amp;#125;)</span><span class="token keyword">ON</span> <span class="token keyword">CREATE</span> <span class="token keyword">SET</span> keanu<span class="token punctuation">.</span>created <span class="token operator">=</span> <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> keanu<span class="token punctuation">.</span>name<span class="token punctuation">,</span> keanu<span class="token punctuation">.</span>createdæ³¨æ„ï¼š<span class="token keyword">ON</span> <span class="token keyword">CREATE</span> <span class="token keyword">SET</span>åªåœ¨åˆ›å»ºä½¿ç”¨æœ‰ç”¨ï¼Œå¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤å¤±æ•ˆã€‚</code></pre><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><pre class=" language-sql"><code class="language-sql">å¤§è‡´æœ‰ä¸¤ä¸ªï¼š<span class="token keyword">DELETE</span>ä¸REMOVE<span class="token comment" spellcheck="true">## åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹ä¸å…³ç³»â€”â€”delete</span>åˆ é™¤å•ä¸ªèŠ‚ç‚¹ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Useless<span class="token punctuation">)</span> <span class="token keyword">DELETE</span> n<span class="token punctuation">;</span>åˆ é™¤å•ä¸ªèŠ‚ç‚¹å’Œè¿æ¥å®ƒçš„å…³ç³»ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Andres' &amp;#125;)-[r]-() DELETE n, r</span>åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹å’Œå…³ç³»ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> OPTIONAL <span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">DELETE</span> n<span class="token punctuation">,</span>råˆ é™¤æŸä¸€ç±»å…³ç³»ï¼š<span class="token keyword">match</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r:created<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">DELETE</span> <span class="token keyword">delete</span> r<span class="token comment" spellcheck="true">## åˆ é™¤æ ‡ç­¾ä¸å±æ€§â€”â€”remove</span>åˆ é™¤å±æ€§ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>andres <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Andres' &amp;#125;) REMOVE andres.age RETURN andres;</span>åˆ é™¤èŠ‚ç‚¹çš„æ ‡ç­¾ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Peter' &amp;#125;) REMOVE n:German RETURN n;</span>åˆ é™¤å¤šé‡æ ‡ç­¾ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Peter' &amp;#125;) REMOVE n:German:Swedish RETURN n</span><span class="token comment" spellcheck="true">##  é‡è®¾ä¸ºNULLâ€”â€”set</span>åˆ é™¤å±æ€§ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: â€˜Andresâ€™ &amp;#125;) SET n.name = NULL RETURN n</span></code></pre><h2 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">set</span>èŠ‚ç‚¹é¢å¤–åŠ å…¥æ ‡ç­¾ä¸å±æ€§<span class="token comment" spellcheck="true">// åŠ å…¥é¢å¤–æ ‡ç­¾</span><span class="token keyword">match</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token keyword">where</span> id<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">7</span><span class="token keyword">set</span> n:Company<span class="token keyword">return</span> n<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åŠ å…¥é¢å¤–å±æ€§</span><span class="token keyword">match</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token keyword">where</span> id<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">100</span><span class="token keyword">set</span> n<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'id100'</span><span class="token keyword">return</span> n<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è®¾ç½®å¤šä¸ªå±æ€§</span><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Andres' &amp;#125;) SET n.position = 'Developer', n.surname = 'Taylor'</span><span class="token comment" spellcheck="true">## é€šè¿‡setæ¥è¿›è¡Œé¢å¤–åŠ å…¥æ ‡ç­¾ä¸å±æ€§ã€‚åŒæ—¶ï¼Œå·²æœ‰çš„å…³ç³»å¯ä»¥é€šè¿‡setèµ‹å€¼ä¸Šå»ã€‚</span>åœ¨èŠ‚ç‚¹å’Œå…³ç³»ä¹‹é—´å¤åˆ¶å±æ€§ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>at <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: 'Andres' &amp;#125;),(pn &amp;#123; name: 'Peter' &amp;#125;) </span><span class="token keyword">SET</span> at <span class="token operator">=</span> pn <span class="token keyword">RETURN</span> at<span class="token punctuation">,</span> pn<span class="token punctuation">;</span><span class="token comment" spellcheck="true">## merge-on match</span><span class="token keyword">MERGE</span> <span class="token punctuation">(</span>person:Person<span class="token punctuation">)</span><span class="token keyword">ON</span> <span class="token keyword">MATCH</span> <span class="token keyword">SET</span> person<span class="token punctuation">.</span>found <span class="token operator">=</span> <span class="token boolean">TRUE</span> <span class="token punctuation">,</span> person<span class="token punctuation">.</span>lastAccessed <span class="token operator">=</span> <span class="token keyword">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> person<span class="token punctuation">.</span>name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>found<span class="token punctuation">,</span> person<span class="token punctuation">.</span>lastAccessed</code></pre><h2 id="ç»Ÿè®¡ä¸é›†åˆå‡½æ•°"><a href="#ç»Ÿè®¡ä¸é›†åˆå‡½æ•°" class="headerlink" title="ç»Ÿè®¡ä¸é›†åˆå‡½æ•°"></a>ç»Ÿè®¡ä¸é›†åˆå‡½æ•°</h2><pre class=" language-sql"><code class="language-sql">ç»Ÿè®¡å‡½æ•°å¸¸è§çš„æœ‰ï¼šabs<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œacos<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œasin<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œatan<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œatan2<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>ï¼Œcos<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œcot<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œdegree<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œ<span class="token number">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span>è¿”å›ä¸€ä¸ªå¸¸é‡ï¼Œexp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">e</span>çš„äºŒæ¬¡æ–¹ï¼Œfloor<span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0.0</span>ï¼Œhaversin<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œlog<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œlog10<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œpi<span class="token punctuation">(</span><span class="token punctuation">)</span>å¸¸é‡PIï¼Œradians<span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">)</span>ï¼Œrand<span class="token punctuation">(</span><span class="token punctuation">)</span>è¿”å›<span class="token number">0</span>åˆ°<span class="token number">1.0</span>çš„å€¼ï¼Œ<span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3.0</span>ï¼Œsign<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œsin<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œsqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼Œtan<span class="token punctuation">(</span><span class="token punctuation">)</span>countï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: â€˜Aâ€™ &amp;#125;)â€“>(x) RETURN n, count(*)</span>sumï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> <span class="token function">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>avgï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> <span class="token function">avg</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>percentileDiscï¼šè®¡ç®—ç™¾åˆ†ä½ã€‚<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> percentileDisc<span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>percentileContï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> percentileCont<span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>stdevï¼šè®¡ç®—æ ‡å‡†åå·®ã€‚<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> n<span class="token punctuation">.</span>name <span class="token operator">IN</span> <span class="token punctuation">[</span>â€˜Aâ€™<span class="token punctuation">,</span> â€˜Bâ€™<span class="token punctuation">,</span> â€˜Câ€™<span class="token punctuation">]</span> <span class="token keyword">RETURN</span> stdev<span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>stdevpï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> n<span class="token punctuation">.</span>name <span class="token operator">IN</span> <span class="token punctuation">[</span>â€˜Aâ€™<span class="token punctuation">,</span> â€˜Bâ€™<span class="token punctuation">,</span> â€˜Câ€™<span class="token punctuation">]</span> <span class="token keyword">RETURN</span> stdevp<span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>maxï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> <span class="token function">max</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>minï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span>collectï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>n:Person<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> collect<span class="token punctuation">(</span>n<span class="token punctuation">.</span>property<span class="token punctuation">)</span><span class="token keyword">distinct</span>ï¼š<span class="token keyword">MATCH</span> <span class="token punctuation">(</span><span class="token number">a</span>:Person <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; name: â€˜Aâ€™ &amp;#125;)â€“>(b) RETURN</span><span class="token keyword">coalesce</span>ï¼šè¿”å›ç¬¬ä¸€ä¸ª<span class="token operator">not</span> <span class="token boolean">null</span>å€¼ã€‚<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>name<span class="token operator">=</span>â€™Aliceâ€™ <span class="token keyword">return</span> <span class="token keyword">coalesce</span><span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">.</span>hairColor<span class="token punctuation">,</span><span class="token number">a</span><span class="token punctuation">.</span>eyes<span class="token punctuation">)</span>headï¼šè¿”å›é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>name<span class="token operator">=</span>â€™Alicâ€™ <span class="token keyword">return</span> <span class="token number">a</span><span class="token punctuation">.</span>array<span class="token punctuation">,</span>head<span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">last</span>ï¼šè¿”å›é›†åˆçš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚<span class="token keyword">match</span> <span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token number">a</span><span class="token punctuation">.</span>name<span class="token operator">=</span>â€™Alicâ€™ <span class="token keyword">return</span> <span class="token number">a</span><span class="token punctuation">.</span>array<span class="token punctuation">,</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token number">a</span><span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">timestamp</span>ï¼šè¿”å›å½“å‰æ—¶é—´çš„æ¯«ç§’startNodeï¼šè¿”å›ä¸€ä¸ªå…³ç³»çš„å¼€å§‹èŠ‚ç‚¹ã€‚<span class="token keyword">match</span> <span class="token punctuation">(</span>x:foo<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">return</span> startNode<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>endNodeï¼šè¿”å›ä¸€ä¸ªå…³ç³»çš„ç»“æŸèŠ‚ç‚¹ã€‚<span class="token keyword">match</span> <span class="token punctuation">(</span>x:foo<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">return</span> endNode<span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>toInt<span class="token punctuation">,</span>toFloat<span class="token punctuation">,</span>toString</code></pre><h2 id="py2neo"><a href="#py2neo" class="headerlink" title="py2neo"></a>py2neo</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> Node<span class="token punctuation">,</span> Relationship<span class="token punctuation">,</span> Graph<span class="token punctuation">,</span> NodeMatcher<span class="token triple-quoted-string string">"""1 åˆ›å»ºèŠ‚ç‚¹ä¸å…³ç³»"""</span>a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">"Person"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Alice"</span><span class="token punctuation">)</span>b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">"Person"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Bob"</span><span class="token punctuation">)</span>ab <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"KNOWS"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## èŠ‚ç‚¹æ·»åŠ å±æ€§</span>a<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span>b<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">34</span>ab<span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'2027/08/31'</span><span class="token comment" spellcheck="true">## é€šè¿‡ setdefault() æ–¹æ³•èµ‹å€¼é»˜è®¤å±æ€§</span>a<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'location'</span><span class="token punctuation">,</span> <span class="token string">'beijing'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## updateæ‰¹é‡æ›´æ–°</span>data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">"Amy"</span><span class="token punctuation">,</span>    <span class="token string">"age"</span> <span class="token punctuation">:</span> <span class="token number">22</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>a<span class="token punctuation">.</span>update<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print(a.labels, b, ab)</span><span class="token comment" spellcheck="true">## èŠ‚ç‚¹å…¶ä»–å±æ€§</span><span class="token triple-quoted-string string">"""  - hash   - node[key]  - node[key] = value  - del node[key]   - len(node)  - dict(node)  - wake(node)  - labels  - has_label("label")  - add_label("label")  - remove_label('label')  - clear_labels()  - update_labels('iter_label')"""</span><span class="token comment" spellcheck="true">## è¿æ¥çš„å±æ€§</span><span class="token triple-quoted-string string">"""  - hash(relationship)  - relationship[key]  - relationship[key] = value  - del relationship[key]  - len(relationship)  - dict(relationship)  - walk(relationship)  - type()"""</span><span class="token triple-quoted-string string">"""2 å­å›¾Subgraphs"""</span>s <span class="token operator">=</span> a <span class="token operator">|</span> b <span class="token operator">|</span> abs1 <span class="token operator">=</span> a <span class="token operator">|</span> b <span class="token operator">|</span> abs2 <span class="token operator">=</span> a <span class="token operator">|</span> b<span class="token keyword">print</span><span class="token punctuation">(</span>s1 <span class="token operator">&amp;</span> s2<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""3 Walkable Types"""</span>a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">)</span>b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">)</span>c <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Mike'</span><span class="token punctuation">)</span>ab <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"KNOWS"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>ac <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"KNOWS"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>w <span class="token operator">=</span> ab <span class="token operator">+</span> Relationship<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">"LIKES"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">+</span> ac<span class="token comment" spellcheck="true">## éå†</span><span class="token keyword">for</span> i <span class="token keyword">in</span> w<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## å…¶ä»–å±æ€§</span><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>start_node<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>end_node<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>nodes<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>relationships<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""4 è¿æ¥å·²æœ‰å›¾æ•°æ®åº“ - .Graph()"""</span>graph <span class="token operator">=</span> Graph<span class="token punctuation">(</span><span class="token string">"http://localhost:7474"</span><span class="token punctuation">,</span>  username<span class="token operator">=</span><span class="token string">"neo4j"</span><span class="token punctuation">,</span>  password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># test_graph,å°±è¿æ¥ä¸Šäº†ç”µè„‘ä¸­é»˜è®¤çš„å›¾æ•°æ®åº“ï¼Œå°±å¯ä»¥è¿›è¡ŒæŸ¥è¯¢äº†ã€‚</span><span class="token comment" spellcheck="true">##åˆ©ç”¨ create() æ–¹æ³•ä¼ å…¥ Subgraph å¯¹è±¡æ¥å°†å…³ç³»å›¾æ·»åŠ åˆ°æ•°æ®åº“</span><span class="token comment" spellcheck="true"># graph.create(s)</span><span class="token comment" spellcheck="true">## å•ç‹¬æ·»åŠ å•ä¸ª Node æˆ– Relationship</span><span class="token comment" spellcheck="true"># graph.create(a)</span><span class="token comment" spellcheck="true"># graph.create(b)</span><span class="token comment" spellcheck="true"># graph.create(ab)</span><span class="token triple-quoted-string string">"""å…¶ä»–åº”ç”¨"""</span><span class="token comment" spellcheck="true">## æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨èŠ‚ç‚¹ - exists(subgraph)</span><span class="token keyword">print</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""äºŒã€æŸ¥è¯¢æ–¹å¼"""</span><span class="token triple-quoted-string string">"""2.1 ç»“æœæŸ¥è¯¢-.run/.data/.match"""</span><span class="token comment" spellcheck="true">## æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼ï¼šé€šè¿‡nodesçš„IDè¿›è¡Œæ£€ç´¢</span><span class="token comment" spellcheck="true"># å…¶ä¸­çš„æ•°å­—å¯¹åº”çš„æ˜¯èŠ‚ç‚¹ï¼ŒID</span><span class="token comment" spellcheck="true"># è¿™ä¸ªIDä¸æŒ‰é¡ºåºæ¥çš„ï¼Œè¦æ³¨æ„</span>graph<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span><span class="token number">1234</span><span class="token punctuation">]</span>graph<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## matchçš„æ–¹å¼</span>data <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"MATCH (a:Person &amp;#123;name:'Alice'&amp;#125;) return a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span>data1 <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"MATCH (a:Person &amp;#123;name:'Alice'&amp;#125;) -[b:KNOWS]-> (c:Person &amp;#123;name:'Bob'&amp;#125;) return a, b, c"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## graph.run()ï¼Œä¹‹ä¸­å¡«å†™çš„æ˜¯æŸ¥è¯¢è¯­å¥ã€‚æŸ¥è¯¢çš„ç»“æœä¹Ÿå¯ä»¥è½¬æ¢ä¸ºdataframeçš„æ ¼å¼ æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ˜¯dict/listæ ¼å¼çš„ï¼Œå¹¶ä¸æ˜¯graphå‹ï¼Œäºæ˜¯ä¸èƒ½è¿›è¡Œåç»­æŸ¥è¯¢</span><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pddf <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data1<span class="token punctuation">)</span><span class="token comment" spellcheck="true">## æ ‡å‡†åŒ–æˆä¸€äº›è¡¨æ ¼çš„æ ¼å¼</span>df1 <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"MATCH (a:Person &amp;#123;name:'Alice'&amp;#125;) return a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span>  # listå‹df2 <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"MATCH (a:Person &amp;#123;name:'Alice'&amp;#125;) return a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_data_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>  # dataframeå‹df3 <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"MATCH (a:Person &amp;#123;name:'Alice'&amp;#125;) return a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_table<span class="token punctuation">(</span><span class="token punctuation">)</span>  # table<span class="token triple-quoted-string string">"""æ›´çµæ´»çš„æŸ¥è¯¢ - NodeMatcher"""</span>selector <span class="token operator">=</span> NodeMatcher<span class="token punctuation">(</span>graph<span class="token punctuation">)</span>nodematch <span class="token operator">=</span> selector<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">"Person"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>nodematch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ where() è¿›è¡Œæ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚æŸ¥æ‰¾ name æ˜¯ A å¼€å¤´çš„ Person Nodeï¼Œå®ä¾‹å¦‚ä¸‹ï¼š</span>nodematch1 <span class="token operator">=</span> list<span class="token punctuation">(</span>selector<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">"Person"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string">"_.name =~ 'B.*'"</span><span class="token punctuation">,</span> <span class="token string">"1960 &lt;= _.born &lt; 1970"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>nodematch1<span class="token punctuation">)</span>persons <span class="token operator">=</span> selector<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string">"_.name =~ 'B.*'"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>persons<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">## å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ order_by() è¿›è¡Œæ’åºï¼š</span>persons <span class="token operator">=</span> selector<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'_.age'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>persons<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">"""first()è¿”å›å•ä¸ªèŠ‚ç‚¹limit(amount)è¿”å›åº•éƒ¨èŠ‚ç‚¹çš„é™å€¼æ¡æ•°skip(amount)è¿”å›é¡¶éƒ¨èŠ‚ç‚¹çš„é™å€¼æ¡æ•°order_by(*fields)æ’åºwhere(*conditions, **properties)ç­›é€‰æ¡ä»¶"""</span><span class="token triple-quoted-string string">"""2.4 match() æˆ– match_one() æŸ¥æ‰¾Relationshipmatch åŒ¹é…å…³ç³».match_oneï¼ŒåŒ¹é…å¹¶è¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ä¸€æ¡å…³ç³»"""</span>nodematcher<span class="token operator">=</span>NodeMatcher<span class="token punctuation">(</span>graph<span class="token punctuation">)</span>findnode<span class="token operator">=</span>nodematcher<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># p = graph.match(nodes=(findnode,), r_type='KNOWS')</span><span class="token comment" spellcheck="true"># print(list(p))</span><span class="token comment" spellcheck="true"># graph.match_one(nodes=(findnode,), r_type='KNOWS')</span><span class="token triple-quoted-string string">""" åˆ é™¤ - .delete()/.delete_all()"""</span>s <span class="token operator">=</span> graph<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># graph.delete(findnode)</span><span class="token comment" spellcheck="true"># graph.delete_all()</span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/sinat_26917383/article/details/79883503">neo4jï¸±å›¾æ•°æ®åº“åŸºæœ¬æ¦‚å¿µã€æ“ä½œç½—åˆ—ä¸æ•´ç†ï¼ˆä¸€ï¼‰</a></p><p><a href="https://blog.csdn.net/sinat_26917383/article/details/79850412">neo4jï¸±Cypher æŸ¥è¯¢è¯­è¨€ç®€å•æ¡ˆä¾‹ï¼ˆäºŒï¼‰</a></p><p><a href="https://blog.csdn.net/sinat_26917383/article/details/79852596">neo4jï¸±Cypherå®Œæ•´æ¡ˆä¾‹csvå¯¼å…¥ã€å…³ç³»è”é€šã€é«˜çº§æŸ¥è¯¢ï¼ˆä¸‰ï¼‰</a></p><p><a href="https://blog.csdn.net/sinat_26917383/article/details/79901207">neo4jï¸±ä¸pythonç»“åˆçš„py2neoä½¿ç”¨æ•™ç¨‹ï¼ˆå››ï¼‰</a></p><p><a href="https://www.yuque.com/yahan/mztcmb/lszfiv">Py2neo v4 ä½¿ç”¨ç¬”è®°</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾æ•°æ® </tag>
            
            <tag> å®‰è£… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score</title>
      <link href="/2020/05/06/zhun-que-lu-jing-que-lu-zhao-hui-lu-f1-score/"/>
      <url>/2020/05/06/zhun-que-lu-jing-que-lu-zhao-hui-lu-f1-score/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score"><a href="#å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score" class="headerlink" title="å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score"></a>å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-score</h1><p>â€‹      æœºå™¨å­¦ä¹ é—®é¢˜ä¹‹ä¸­ï¼Œé€šå¸¸éœ€è¦å»ºç«‹æ¨¡å‹æ¥è§£å†³å…·ä½“é—®é¢˜ï¼Œä½†å¯¹äºæ¨¡å‹çš„å¥½åï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œå¦‚ä½•è¿›è¡Œè¯„ä¼°å‘¢?</p><h2 id="æ··æ·†çŸ©é˜µ"><a href="#æ··æ·†çŸ©é˜µ" class="headerlink" title="æ··æ·†çŸ©é˜µ"></a>æ··æ·†çŸ©é˜µ</h2><p><img src="/2020/05/06/zhun-que-lu-jing-que-lu-zhao-hui-lu-f1-score/1.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¦äº†è§£å„ä¸ªè¯„ä»·æŒ‡æ ‡ï¼Œæ··æ·†çŸ©é˜µä¸­çš„ P è¡¨ç¤º Positiveï¼Œå³æ­£ä¾‹æˆ–è€…é˜³æ€§ï¼ŒN è¡¨ç¤º Negativeï¼Œå³è´Ÿä¾‹æˆ–è€…é˜´æ€§ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠ P å’Œ N åˆ†åˆ«ç†è§£ä¸ºäºŒåˆ†ç±»ä¸­çš„ 1-0</p><ul><li><p>TPï¼šé¢„æµ‹ä¸º1ï¼Œå®é™…ä¸º1ï¼Œé¢„æµ‹æ­£ç¡®ã€‚</p></li><li><p>FPï¼šé¢„æµ‹ä¸º1ï¼Œå®é™…ä¸º0ï¼Œé¢„æµ‹é”™è¯¯ã€‚</p></li><li><p>FNï¼šé¢„æµ‹ä¸º0ï¼Œå®é™…ä¸º1ï¼Œé¢„æµ‹é”™è¯¯ã€‚</p></li><li><p>TNï¼šé¢„æµ‹ä¸º0ï¼Œå®é™…ä¸º0ï¼Œé¢„æµ‹æ­£ç¡®ã€‚</p></li><li><p>TP+FPï¼šè¡¨ç¤ºæ‰€æœ‰é¢„æµ‹ä¸ºæ­£çš„æ ·æœ¬æ•°é‡</p></li><li><p>TN+FNï¼šè¡¨ç¤ºæ‰€æœ‰é¢„æµ‹ä¸ºè´Ÿçš„æ ·æœ¬æ•°é‡</p></li><li><p>TP+FNï¼šè¡¨ç¤ºå®é™…ä¸ºæ­£çš„æ ·æœ¬æ•°é‡</p></li><li><p>TN+FPï¼šè¡¨ç¤ºå®é™…ä¸ºè´Ÿçš„æ ·æœ¬æ•°é‡</p></li></ul><h2 id="å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰"><a href="#å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰" class="headerlink" title="å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰"></a>å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰</h2><p>æ‰€æœ‰çš„é¢„æµ‹æ­£ç¡®ï¼ˆæ­£ç±»è´Ÿç±»ï¼‰çš„å æ€»çš„æ¯”é‡</p><p>$Accuracy = \frac {TP+TN}{TP+TN+FP+FN}$</p><h2 id="ç²¾ç¡®ç‡ï¼ˆä¹Ÿå«æŸ¥å‡†ç‡ï¼Œprecision"><a href="#ç²¾ç¡®ç‡ï¼ˆä¹Ÿå«æŸ¥å‡†ç‡ï¼Œprecision" class="headerlink" title="ç²¾ç¡®ç‡ï¼ˆä¹Ÿå«æŸ¥å‡†ç‡ï¼Œprecision)"></a>ç²¾ç¡®ç‡ï¼ˆä¹Ÿå«æŸ¥å‡†ç‡ï¼Œprecision)</h2><p>å³æ­£ç¡®é¢„æµ‹ä¸ºæ­£çš„å å…¨éƒ¨é¢„æµ‹ä¸ºæ­£çš„æ¯”ä¾‹ï¼Œï¼ˆçœŸæ­£æ­£ç¡®çš„å æ‰€æœ‰é¢„æµ‹ä¸ºæ­£çš„æ¯”ä¾‹ï¼‰</p><p>$Precision = \frac {TP}{TP+FP}$</p><h2 id="å¬å›ç‡ï¼ˆrecallï¼‰"><a href="#å¬å›ç‡ï¼ˆrecallï¼‰" class="headerlink" title="å¬å›ç‡ï¼ˆrecallï¼‰"></a>å¬å›ç‡ï¼ˆrecallï¼‰</h2><p>å³æ­£ç¡®é¢„æµ‹ä¸ºæ­£çš„å å…¨éƒ¨å®é™…ä¸ºæ­£çš„æ¯”ä¾‹ï¼ˆçœŸæ­£æ­£ç¡®çš„å æ‰€æœ‰å®é™…ä¸ºæ­£çš„æ¯”ä¾‹ï¼‰</p><p>$ Recall = \frac {TP}{TP+ FN}$ </p><h2 id="F1-score"><a href="#F1-score" class="headerlink" title="F1-score"></a>F1-score</h2><p>F1å€¼ä¸ºç®—æ•°å¹³å‡æ•°é™¤ä»¥å‡ ä½•å¹³å‡æ•°ï¼Œä¸”è¶Šå¤§è¶Šå¥½ï¼Œå°†Precisionå’ŒRecallçš„ä¸Šè¿°å…¬å¼å¸¦å…¥ä¼šå‘ç°ï¼Œå½“F1å€¼å°æ—¶ï¼ŒTrue Positiveç›¸å¯¹å¢åŠ ï¼Œè€Œfalseç›¸å¯¹å‡å°‘ï¼Œå³Precisionå’ŒRecalléƒ½ç›¸å¯¹å¢åŠ ï¼Œå³F1å¯¹Precisionå’ŒRecalléƒ½è¿›è¡Œäº†åŠ æƒã€‚</p><p>$\frac {2}{F _1} = \frac{1}{Precision} + \frac {1}{Recall}$</p><p>$F1 = \frac {2TP}{2TP+FP+ FN}$</p><h2 id="å„æŒ‡æ ‡ä¼˜ç¼ºç‚¹"><a href="#å„æŒ‡æ ‡ä¼˜ç¼ºç‚¹" class="headerlink" title="å„æŒ‡æ ‡ä¼˜ç¼ºç‚¹"></a>å„æŒ‡æ ‡ä¼˜ç¼ºç‚¹</h2><blockquote><p>å‡†ç¡®ç‡ æ ·æœ¬ä¸å‡è¡¡çš„æƒ…å†µä¸‹,å¹¶ä¸èƒ½ä½œä¸ºå¥½çš„æŒ‡æ ‡</p><p>ç²¾ç¡®ç‡ é’ˆå¯¹é¢„æµ‹ç»“æœè€Œè¨€  </p><p>å¬å›ç‡ æ˜¯é’ˆå¯¹åŸæ ·æœ¬è€Œè¨€,å‡†ç¡®ç‡å’Œå¬å›ç‡äº’ç›¸å½±å“,ç›¸äº’ç‰µåˆ¶.</p><p>F1  æ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ã€‚å¼•å…¥F1-Scoreä½œä¸ºç»¼åˆæŒ‡æ ‡ï¼Œå°±æ˜¯ä¸ºäº†å¹³è¡¡å‡†ç¡®ç‡å’Œå¬å›ç‡çš„å½±å“</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/Joseph__Lagrange/article/details/90813885">å‚è€ƒ1</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> nlp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯„ä¼°æŒ‡æ ‡ </tag>
            
            <tag> ç»Ÿè®¡ </tag>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo</title>
      <link href="/2020/05/05/hexo/"/>
      <url>/2020/05/05/hexo/</url>
      
        <content type="html"><![CDATA[<p>è½¬è½½æ¥è‡ªäº[<a href="https://github.com/blinkfox/hexo-theme-matery]">https://github.com/blinkfox/hexo-theme-matery]</a></p><h1 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h1><h2 id="Hexoä»‹ç»"><a href="#Hexoä»‹ç»" class="headerlink" title="Hexoä»‹ç»"></a>Hexoä»‹ç»</h2><p><a href="https://hexo.io/zh-cn/">Hexo</a>æ˜¯ä¸€æ¬¾å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åŸºäº<code>Node.js</code>çš„é™æ€åšå®¢æ¡†æ¶ï¼Œå››å¤§ç‰¹æ€§ï¼š</p><ul><li>è¶…å¿«é€Ÿåº¦ï¼š<code>Node.js</code> æ‰€å¸¦æ¥çš„è¶…å¿«ç”Ÿæˆé€Ÿåº¦ï¼Œè®©ä¸Šç™¾ä¸ªé¡µé¢åœ¨å‡ ç§’å†…ç¬é—´å®Œæˆæ¸²æŸ“ã€‚</li><li>æ”¯æŒMarkdownï¼š<code>Hexo</code> æ”¯æŒ <code>GitHub Flavored Markdown</code> çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç”šè‡³å¯ä»¥æ•´åˆ <code>Octopress</code> çš„å¤§å¤šæ•°æ’ä»¶ã€‚</li><li>ä¸€é”®éƒ¨ç½²ï¼šåªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ° <code>GitHub Pages</code>, <code>Heroku</code>æˆ–å…¶ä»–å¹³å°ã€‚</li><li>æ’ä»¶å’Œå¯æ‰©å±•æ€§ï¼šå¼ºå¤§çš„ <code>API</code> å¸¦æ¥æ— é™çš„å¯èƒ½ï¼Œä¸æ•°ç§æ¨¡æ¿å¼•æ“<code>ï¼ˆEJSï¼ŒPugï¼ŒNunjucksï¼‰</code>å’Œå·¥å…·<code>ï¼ˆBabelï¼ŒPostCSSï¼ŒLess/Sassï¼‰</code>è½»æ˜“é›†æˆã€‚</li></ul><p>è¿™ä½¿å¾—å¾ˆå¤šéç¼–ç¨‹äººå‘˜å¯ä»¥å¾ˆè½»æ¾ï¼Œå¾ˆè‡ªç”±çš„å®šåˆ¶åšå®¢ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹è¿›å…¥æ­å»ºç¯å¢ƒæŠŠã€‚</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>ç›´æ¥å‘½ä»¤è¡Œè¾“å…¥ï¼š</p><pre><code>sudo apt-get install nodejssudo apt-get install npm</code></pre><p>æˆ–è€…åˆ°<a href="http://nodejs.cn/download/">å®˜ç½‘</a>ä¸‹è½½ï¼š</p><p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œç„¶åé…ç½®ç¯å¢ƒå˜é‡ï¼ˆç›®çš„æ˜¯ä¸ºäº†åœ¨ç»ˆç«¯å¯ä»¥ä»»æ„ä½ç½®ä½¿ç”¨å®ƒï¼‰ï¼š</p><p>é¦–å…ˆæ‰“å¼€<code>~/.bashrc</code>æ–‡ä»¶</p><p>åœ¨æ–‡ä»¶çš„æœ€ä¸‹ç«¯å¡«å†™å¦‚ä¸‹ä»£ç </p><pre><code>export PATH=$&amp;#123;PATH&amp;#125;:$HOME/node-v12.13.0-linux-x64/bin/</code></pre><p>å› ä¸ºæˆ‘ä¸‹è½½çš„æ˜¯<code>64</code>ä½<code>12.13.0</code>ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ”¾åˆ°äº†æ ¹ç›®å½•<code>home</code>ä¸‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ›´æ”¹ä¸Šé¢çš„è·¯å¾„ã€‚ä¿å­˜é€€å‡ºåï¼Œæ‰§è¡Œå‘½ä»¤è®©ä¿®æ”¹ç”Ÿæ•ˆã€‚</p><pre class=" language-shell"><code class="language-shell">source ~/.bashrc</code></pre><p>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥<code>npm -v</code>å’Œ<code>node -v</code>éªŒè¯æ˜¯å¦å®‰è£…é…ç½®æˆåŠŸ</p><pre class=" language-shell"><code class="language-shell">$npm -v6.13.0$node -vv12.13.0</code></pre><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>ä¸‹è½½ç¨³å®šç‰ˆæˆ–è€…æœ€æ–°ç‰ˆéƒ½å¯ä»¥<a href="http://nodejs.cn/download/">Node.js</a>ï¼Œå®‰è£…é€‰é¡¹å…¨éƒ¨é»˜è®¤ï¼Œä¸€è·¯ç‚¹å‡»<code>Next</code>ã€‚æœ€åå®‰è£…å¥½ä¹‹åï¼ŒæŒ‰<code>Win+R</code>æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥<code>node -v</code>å’Œ<code>npm -v</code>ï¼Œå¦‚æœå‡ºç°ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆå°±å®‰è£…æˆåŠŸäº†ã€‚</p><h3 id="npmåŠ é€Ÿ"><a href="#npmåŠ é€Ÿ" class="headerlink" title="npmåŠ é€Ÿ"></a>npmåŠ é€Ÿ</h3><p>ä¸€èˆ¬å›½å†…é€šè¿‡<code>npm</code>ä¸‹è½½ä¸œè¥¿ä¼šæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ é˜¿é‡Œçš„æºè¿›è¡ŒåŠ é€Ÿã€‚</p><pre class=" language-shell"><code class="language-shell">npm config set registry https://registry.npm.taobao.org</code></pre><h3 id="å®‰è£…Git"><a href="#å®‰è£…Git" class="headerlink" title="å®‰è£…Git"></a>å®‰è£…Git</h3><p>ä¸ºäº†æŠŠæœ¬åœ°çš„ç½‘é¡µæ–‡ä»¶ä¸Šä¼ åˆ°<code>Github</code>ä¸Šé¢å»ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…· <code>git</code>ã€‚å…³äº<code>git</code>å’Œ<code>Github</code>è¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚åŒæ ·åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼š</p><h4 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h4><p>åœ¨Linuxå¹³å°æ¯”è¾ƒæ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤å°±å¯ä»¥å®‰è£…ï¼š</p><pre class=" language-shell"><code class="language-shell">sudo apt-get install git</code></pre><p>å®‰è£…å®Œæˆåå³å¯äº«ç”¨ã€‚</p><h4 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h4><p>éœ€è¦å»å®˜ç½‘ä¸‹è½½<a href="https://git-scm.com/download/win">Git</a>ï¼Œä¸‹è½½å®ŒæˆåæŒ‰ç…§å‘å¯¼å®‰è£…å³å¯ã€‚</p><blockquote><p>æ³¨æ„ï¼šåœ¨å®‰è£…çš„æœ€åä¸€æ­¥æ·»åŠ è·¯å¾„æ—¶é€‰æ‹© Use Git from the Windows Command Prompt ã€‚è¿™æ˜¯æŠŠGitæ·»åŠ åˆ°äº†ç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿å¯ä»¥åœ¨cmdä¸­ä½¿ç”¨ã€‚è€Œæœ¬äººæ¨èä½¿ç”¨ä¸‹è½½é™„å¸¦çš„git bashè¿›è¡Œæ“ä½œï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p></blockquote><p>å¯¹äºgitçš„è®²è§£å’Œä½¿ç”¨ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œåˆ°ç½‘ä¸ŠæŸ¥æ‰¾ã€‚<code>Hexo</code>æ­å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå·²ç»å°è£…å¥½ä¸€ä¸ªgitå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>hexo</code>çš„å‘½ä»¤å°†ç”Ÿæˆçš„é™æ€ç½‘ç«™ä»£ç åŒæ­¥åˆ°<code>github</code>çš„ä»“åº“é‡Œã€‚ä½†æ˜¯å¦‚æœæƒ³è¦è‡ªå·±åŒæ­¥æºç çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒæ¡ä¸€ä¸‹gitå‘½ä»¤äº†ã€‚åœ¨è¿™é‡Œæˆ‘åªåˆ—ä¸¾ä¸€ä¸‹å¸¸ç”¨çš„å‘½ä»¤ï¼š</p><pre class=" language-shell"><code class="language-shell">git init #åˆå§‹åŒ–ä¸€ä¸ªgitåº“ï¼Œç”Ÿæˆ.gitæ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯è¯¥gitåº“çš„è®°å½•å’Œé…ç½®git remote add origin è¿œç¨‹ä»“åº“åœ°å€ #å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“é“¾æ¥èµ·æ¥git pull #åŒæ­¥ä»£ç git status #æ£€æŸ¥æœ¬åœ°ä»“åº“ä¿®æ”¹çŠ¶æ€git add æ–‡ä»¶å æˆ–è€… git add .  #å°†æœ¬åœ°ä¿®æ”¹çš„æ–‡ä»¶åŠ å…¥ç¼“å­˜git commit æ–‡ä»¶å -m "æè¿°" æˆ–è€… git commit . -m "æè¿°"  #æäº¤ç¼“å­˜ï¼Œå¹¶æè¿°è¯¥æäº¤git push -u origin code # å°†æœ¬åœ°çš„æäº¤æ¨é€åˆ°è¿œç¨‹ä»“åº“.-uæ˜¯ä»£è¡¨è¾“å…¥è´¦å·å¯†ç ï¼Œå¦‚æœä½ å·²ç»é…ç½®äº†gitçš„å…¬é’¥ï¼Œé‚£ä¹ˆå¯ç›´æ¥push.</code></pre><h3 id="æ³¨å†ŒGithub"><a href="#æ³¨å†ŒGithub" class="headerlink" title="æ³¨å†ŒGithub"></a>æ³¨å†ŒGithub</h3><p><code>Git</code>å®‰è£…å®Œæˆä¹‹åå°±å¯ä»¥å»<a href="https://github.com/">Github</a>ä¸Šæ³¨å†Œè´¦å·å¹¶åˆ›å»ºä»“åº“ï¼Œ ç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„ç½‘ç«™äº†ã€‚</p><blockquote><p>Githubæ˜¯åŸºäº Git åšç‰ˆæœ¬æ§åˆ¶çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å…¨çƒæœ€å¤§çš„ä»£ï¼ˆåŒï¼‰ç ï¼ˆæ€§ï¼‰æ‰˜ï¼ˆäº¤ï¼‰ç®¡ï¼ˆå‹ï¼‰ç½‘ç«™ã€‚</p></blockquote><p>åˆ›å»ºå®Œè´¦æˆ·ä¹‹åæ–°å»ºä¸€ä¸ªé¡¹ç›®ä»“åº“<code>New repository</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p>æ¥ç€è¾“å…¥ä»“åº“åï¼Œåé¢ä¸€å®šè¦åŠ <code>.github.io</code>åç¼€ï¼ŒREADMEåˆå§‹åŒ–ä¹Ÿè¦å‹¾ä¸Šã€‚ å¦‚ä¸‹å›¾é…ç½®ï¼ˆå› ä¸ºæˆ‘çš„å·²ç»å­˜åœ¨ç›¸åŒçš„ä»“åº“ï¼Œæ‰€ä»¥æŠ¥é”™ï¼‰</p><blockquote><p>è¦åˆ›å»ºä¸€ä¸ªå’Œä½ ç”¨æˆ·åç›¸åŒçš„ä»“åº“ï¼Œåé¢åŠ .github.ioï¼Œåªæœ‰è¿™æ ·å°†æ¥è¦éƒ¨ç½²åˆ°GitHub pageçš„æ—¶å€™ï¼Œæ‰ä¼šè¢«è¯†åˆ«ï¼Œä¹Ÿå°±æ˜¯<a href="http://xxxx.github.æ¨›içŸoé‹”,æ›·xxxæœ’`ç¬‹é…€gç¾»ithubæ‘£æ‹£`èŸ/">http://xxxx.github.ioï¼Œå…¶ä¸­xxxå°±æ˜¯ä½ æ³¨å†Œ<code>GitHub</code>çš„ç”¨æˆ·å</a></p></blockquote><p>ç„¶åé¡¹ç›®å°±å»ºæˆäº†ï¼Œç‚¹å‡»<code>Settings</code>ï¼Œå‘ä¸‹æ‹‰åˆ°æœ€åæœ‰ä¸ª<code>GitHub Pages</code>ï¼Œç‚¹å‡»<code>Choose a theme</code>é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ã€‚ç„¶åç­‰ä¸€ä¼šå„¿ï¼Œå†å›åˆ°<code>GitHub Pages</code>ï¼Œç‚¹å‡»æ–°å‡ºæ¥çš„é“¾æ¥ï¼Œå°±ä¼šè¿›å…¥åˆ°<code>github page</code>çš„ç•Œé¢ã€‚çœ‹åˆ°è¿™ä¸ªç•Œé¢å°±è¯´æ˜<code>Github</code>çš„<code>page</code>å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥<code>Hexo</code>çš„æ­å»ºã€‚</p><h2 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h2><h3 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—è‡ªå–å¦‚<code>YoungBlog</code>ï¼Œç”¨æ¥å­˜æ”¾è‡ªå·±çš„åšå®¢æ–‡ä»¶ï¼Œç„¶å<code>cd</code>åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼ˆæˆ–è€…åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ç›´æ¥å³é”®<code>git bash</code>æ‰“å¼€ï¼‰ã€‚åœ¨è¯¥ç›®å½•ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤å®‰è£…<code>Hexo</code>ï¼š</p><pre class=" language-shell"><code class="language-shell">npm install -g hexo-cli</code></pre><p>æ¥ä¸‹æ¥åˆå§‹åŒ–ä¸€ä¸‹<code>hexo</code>,å³åˆå§‹åŒ–æˆ‘ä»¬çš„ç½‘ç«™ï¼Œ</p><pre class=" language-shell"><code class="language-shell">hexo init</code></pre><blockquote><p>åˆå§‹åŒ–è¦æ±‚å¿…é¡»æ˜¯ç©ºçš„ç›®å½•ä¸‹è¿›è¡Œã€‚</p></blockquote><p>æ¥ç€è¾“å…¥<code>npm install</code>å®‰è£…å¿…å¤‡çš„ç»„ä»¶ã€‚</p><p>åˆå§‹åŒ–å®Œæˆåä¼šåœ¨ç›®ä¸‹ç”Ÿæˆå‡ ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ç½‘ç«™æºç äº†ï¼š</p><ul><li><code>node_modules:</code> ä¾èµ–åŒ…ï¼Œnpmå®‰è£…çš„ä¸€äº›æ’ä»¶å­˜æ”¾çš„æ–‡ä»¶å¤¹ã€‚</li><li><code>publicï¼š</code>å­˜æ”¾ç”Ÿæˆçš„é¡µé¢ï¼Œç½‘ç«™æ­£å¼å±•ç¤ºçš„å†…å®¹ã€‚</li><li><code>scaffoldsï¼š</code>ç”Ÿæˆæ–‡ç« å’Œé¡µé¢çš„ä¸€äº›æ¨¡æ¿ã€‚</li><li><code>sourceï¼š</code>ç”¨æ¥å­˜æ”¾ä½ çš„æ–‡ç« å’Œæ•°æ®ã€‚</li><li><code>themesï¼š</code>ä¸»é¢˜å­˜æ”¾æ–‡ä»¶å¤¹ã€‚</li><li><code>_config.yml:</code> åšå®¢çš„é…ç½®æ–‡ä»¶ï¼Œéä¸»é¢˜çš„é…ç½®ã€‚</li><li><code>db.json</code>ï¼šåšå®¢çš„ç‰ˆæœ¬ä¿¡æ¯ç­‰ã€‚</li><li><code>package.json</code>å’Œ<code>package-lock.json</code>ï¼šä¾èµ–åŒ…å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚</li></ul><p>è¿™æ ·æœ¬åœ°çš„ç½‘ç«™é…ç½®ä¹Ÿå¼„å¥½å•¦ï¼Œè¾“å…¥<code>hexo g</code>ç”Ÿæˆé™æ€ç½‘é¡µï¼Œç„¶åè¾“å…¥<code>hexo s</code>æ‰“å¼€æœ¬åœ°æœåŠ¡å™¨ï¼Œç„¶åæµè§ˆå™¨æ‰“å¼€<a href="http://localhost:4000/">http://localhost:4000</a>å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åšå®¢å•¦ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p>è¿™é‡Œä»‹ç»ä¸€ä¸‹<code>Hexo</code>å¸¸ç”¨çš„å‡ ä¸ªå‘½ä»¤ï¼š</p><pre class=" language-shell"><code class="language-shell">hexo clean #æ¸…é™¤dbå’Œpublicæ–‡ä»¶ä¸‹çš„å†…å®¹ï¼Œæˆ–å¯å†™æˆhexo clhexo g #æ ¹æ®æºç ç”Ÿæˆé™æ€æ–‡ä»¶hexo s #å¼€å¯æœ¬åœ°çš„serverï¼Œè¿™æ ·å¯åœ¨æœ¬åœ°é€šè¿‡localhost:4000è®¿é—®åšå®¢ã€‚æˆ–å¯å†™æˆhexo serverhexo d #éƒ¨ç½²ç½‘ç«™çš„é™æ€æ–‡ä»¶åˆ°é…ç½®å¥½çš„æ‰˜ç®¡ç½‘ç«™ï¼Œå¦‚Githubæˆ–è€…Codingï¼Œé…ç½®åœ¨_configä¸­çš„Deployã€‚#åç»­å¦‚æœå®‰è£…äº†ä¸€äº›æ’ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç¼©å†™æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥hexo dä¹Ÿå¯ä»¥å†™æˆhexo deployã€‚</code></pre><p>çœ‹å®Œå±•ç¤ºåï¼Œå¯ä»¥æŒ‰<code>ctrl+c</code>å…³é—­æœ¬åœ°æœåŠ¡å™¨ã€‚</p><h3 id="éƒ¨ç½²åˆ°Github"><a href="#éƒ¨ç½²åˆ°Github" class="headerlink" title="éƒ¨ç½²åˆ°Github"></a>éƒ¨ç½²åˆ°Github</h3><p>é¦–å…ˆè¦å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼Œç”¨äº<code>Hexo</code>éƒ¨ç½²ä»£ç çš„ã€‚</p><pre><code>npm i hexo-deployer-git</code></pre><p>å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨<code>_config.yml</code>é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä½¿ç”¨<code>hexo d</code>çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°<code>Github</code>ä¸Šäº†ï¼Œå¦‚æœä½ æƒ³éƒ¨ç½²åˆ°å…¶ä»–å¹³å°ï¼ˆæ”¯æŒ<code>Git</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°è¿™é‡Œã€‚</p><pre><code>deploy:  type: git  repository: https://github.com/daiyizheng123/daiyizheng.github.io.git  branch: master</code></pre><blockquote><p>å¦‚æœä¸äº†è§£gité‚£ä¹ˆè¯·å…ˆè‡ªè¡Œç™¾åº¦å­¦ä¹ ä¸€ä¸‹gitçš„ç›¸å…³é…ç½®ã€‚</p></blockquote><p><code>Git</code>åˆ†ä¸ºæ— å¯†æ¨é€å’Œéœ€è¦è¾“å…¥è´¦æˆ·å¯†ç æ¨é€ã€‚æ— å¯†ç æ¨é€å°±æ˜¯éœ€è¦åœ¨æœ¬åœ°ç”Ÿæˆå…¬é’¥ï¼Œç„¶åæ·»åŠ åˆ°ä»£ç æ‰˜ç®¡å¹³å°å¦‚<code>Github</code>ï¼Œè¿™æ ·åœ¨æ¨é€æ—¶å€™å°±ä¸éœ€è¦è¾“å…¥è´¦æˆ·å¯†ç äº†ã€‚è€Œåä¹‹çš„è¯ï¼Œæ¯æ¬¡æ¨é€å°±ä¼šè¦æ±‚ä½ è¾“å…¥è´¦æˆ·å¯†ç ã€‚ä¸‹é¢è¯´ä¸€ä¸‹æ— å¯†æ¨é€çš„é…ç½®è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆæ‰“å¼€<code>Git bash</code>ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><pre class=" language-shell"><code class="language-shell">git config --global user.name "ä½ çš„ç”¨æˆ·å"git config --global user.email "ä½ çš„é‚®ç®±"</code></pre><p>ç”¨æˆ·åå’Œé‚®ç®±æ ¹æ®ä½ æ³¨å†Œ<code>github</code>çš„ä¿¡æ¯è‡ªè¡Œä¿®æ”¹ã€‚</p><p>ç„¶åç”Ÿæˆå¯†é’¥SSH keyï¼š</p><pre class=" language-shell"><code class="language-shell">ssh-keygen -t rsa -C "ä½ çš„é‚®ç®±"</code></pre><p>è¿™ä¸ªæ—¶å€™å®ƒä¼šå‘Šè¯‰ä½ å·²ç»ç”Ÿæˆäº†<code>.ssh</code>çš„æ–‡ä»¶å¤¹ã€‚åœ¨ä½ çš„ç”µè„‘ä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚æˆ–è€…<code>git bash</code>ä¸­è¾“å…¥</p><pre class=" language-shell"><code class="language-shell">cat ~/.ssh/id_rsa.pub</code></pre><p>æ‰“å¼€<a href="http://github.com/">github</a>ï¼Œåœ¨å¤´åƒä¸‹é¢ç‚¹å‡»<code>settings</code>ï¼Œå†ç‚¹å‡»<code>SSH and GPG keys</code>ï¼Œæ–°å»ºä¸€ä¸ª<code>SSH</code>ï¼Œåå­—éšä¾¿å–ä¸€ä¸ªéƒ½å¯ä»¥ï¼ŒæŠŠä½ çš„<code>id_rsa.pub</code>é‡Œé¢çš„ä¿¡æ¯å¤åˆ¶è¿›å»ã€‚</p><p>è¿™æ ·ä½ çš„ç”µè„‘å°±è·Ÿ<code>Github</code>å»ºç«‹èµ·çš„å®‰å…¨è”ç³»ï¼Œä»¥åæ¨é€ä»£ç å°±ä¸éœ€è¦è¾“å…¥å¯†ç äº†ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨hexo dæ¨é€ä»£ç ï¼Œæ¨é€çš„æ˜¯ç¼–è¯‘å®Œæˆçš„é™æ€æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„publicæ–‡ä»¶å¤¹ä¸‹çš„ä»£ç ï¼Œè€Œä¸æ˜¯ç½‘ç«™çš„æºä»£ç ã€‚</p></blockquote><h2 id="æ’å…¥éŸ³ä¹-è§†é¢‘"><a href="#æ’å…¥éŸ³ä¹-è§†é¢‘" class="headerlink" title="æ’å…¥éŸ³ä¹/è§†é¢‘"></a>æ’å…¥éŸ³ä¹/è§†é¢‘</h2><p>Hexoåšå®¢æ’å…¥è§†é¢‘ã€éŸ³é¢‘æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><h3 id="Hexoåšå®¢åˆ©ç”¨iframeæ ‡ç­¾æ’å…¥ç½‘æ˜“éŸ³ä¹æ–¹æ³•"><a href="#Hexoåšå®¢åˆ©ç”¨iframeæ ‡ç­¾æ’å…¥ç½‘æ˜“éŸ³ä¹æ–¹æ³•" class="headerlink" title="Hexoåšå®¢åˆ©ç”¨iframeæ ‡ç­¾æ’å…¥ç½‘æ˜“éŸ³ä¹æ–¹æ³•"></a>Hexoåšå®¢åˆ©ç”¨iframeæ ‡ç­¾æ’å…¥ç½‘æ˜“éŸ³ä¹æ–¹æ³•</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>no<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">marginwidth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">marginheight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span>430</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span>86</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//music.163.com/outchain/player?type<span class="token punctuation">=</span>2&amp;id<span class="token punctuation">=</span>114389&amp;auto<span class="token punctuation">=</span>0&amp;height<span class="token punctuation">=</span>66<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span></code></pre><h3 id="Hexoåšå®¢åˆ©ç”¨embed-æ ‡ç­¾æ’å…¥éŸ³ä¹å’Œè§†é¢‘"><a href="#Hexoåšå®¢åˆ©ç”¨embed-æ ‡ç­¾æ’å…¥éŸ³ä¹å’Œè§†é¢‘" class="headerlink" title="Hexoåšå®¢åˆ©ç”¨embed æ ‡ç­¾æ’å…¥éŸ³ä¹å’Œè§†é¢‘"></a>Hexoåšå®¢åˆ©ç”¨embed æ ‡ç­¾æ’å…¥éŸ³ä¹å’Œè§†é¢‘</h3><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>415<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>544<span class="token punctuation">"</span></span> <span class="token attr-name">quality</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>high<span class="token punctuation">"</span></span> <span class="token attr-name">allowfullscreen</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/x-shockwave-flash<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//static.hdslb.com/miniloader.swf<span class="token punctuation">"</span></span> <span class="token attr-name">flashvars</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aid<span class="token punctuation">=</span>8506694&amp;page<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">pluginspage</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version<span class="token punctuation">=</span>ShockwaveFlash<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>embed</span><span class="token punctuation">></span></span></code></pre><h3 id="Hexoåšå®¢åˆ©ç”¨Hexoæ’ä»¶æ’å…¥éŸ³ä¹-è§†é¢‘"><a href="#Hexoåšå®¢åˆ©ç”¨Hexoæ’ä»¶æ’å…¥éŸ³ä¹-è§†é¢‘" class="headerlink" title="Hexoåšå®¢åˆ©ç”¨Hexoæ’ä»¶æ’å…¥éŸ³ä¹/è§†é¢‘"></a>Hexoåšå®¢åˆ©ç”¨Hexoæ’ä»¶æ’å…¥éŸ³ä¹/è§†é¢‘</h3><ul><li><p>npm install hexo-tag-aplayer</p><pre class=" language-bash"><code class="language-bash"><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;% aplayer "å¥¹çš„ç«æ¯›" "å‘¨æ°ä¼¦" "http://home.ustc.edu.cn/~mmmwhy/%d6%dc%bd%dc%c2%d7%20-%20%cb%fd%b5%c4%bd%de%c3%ab.mp3"  "http://home.ustc.edu.cn/~mmmwhy/jay.jpg" "autoplay=false" %&amp;#125;</span></code></pre></li><li><p>npm install hexo-tag-dplayer</p><pre class=" language-bash"><code class="language-bash"><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;% dplayer "url=http://home.ustc.edu.cn/~mmmwhy/GEM.mp4"  "pic=http://home.ustc.edu.cn/~mmmwhy/GEM.jpg" "loop=yes" "theme=#FADFA3" "autoplay=false" "token=tokendemo" %&amp;#125;</span></code></pre></li></ul><h3 id="blibiè§†é¢‘åµŒå…¥ä»£ç "><a href="#blibiè§†é¢‘åµŒå…¥ä»£ç " class="headerlink" title="blibiè§†é¢‘åµŒå…¥ä»£ç "></a>blibiè§†é¢‘åµŒå…¥ä»£ç </h3><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>iframe src<span class="token operator">=</span><span class="token string">"//player.bilibili.com/player.html?aid=73657563&amp;bvid=BV1HE411Y7G9&amp;cid=125986571&amp;page=2"</span> scrolling<span class="token operator">=</span><span class="token string">"no"</span> border<span class="token operator">=</span><span class="token string">"0"</span> frameborder<span class="token operator">=</span><span class="token string">"no"</span> framespacing<span class="token operator">=</span><span class="token string">"0"</span> allowfullscreen<span class="token operator">=</span><span class="token string">"true"</span>  width<span class="token operator">=</span><span class="token string">"680"</span> height<span class="token operator">=</span><span class="token string">"520"</span> align<span class="token operator">=</span><span class="token string">"center"</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">/</span>iframe<span class="token operator">></span></code></pre><h3 id="åˆ‡æ¢ä¸»é¢˜"><a href="#åˆ‡æ¢ä¸»é¢˜" class="headerlink" title="åˆ‡æ¢ä¸»é¢˜"></a>åˆ‡æ¢ä¸»é¢˜</h3><p>ä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> çš„ <code>theme</code> çš„å€¼ï¼š<code>theme: hexo-theme-matery</code></p><h4 id="config-yml-æ–‡ä»¶çš„å…¶å®ƒä¿®æ”¹å»ºè®®"><a href="#config-yml-æ–‡ä»¶çš„å…¶å®ƒä¿®æ”¹å»ºè®®" class="headerlink" title="_config.yml æ–‡ä»¶çš„å…¶å®ƒä¿®æ”¹å»ºè®®:"></a><code>_config.yml</code> æ–‡ä»¶çš„å…¶å®ƒä¿®æ”¹å»ºè®®:</h4><ul><li>è¯·ä¿®æ”¹ <code>_config.yml</code> çš„ <code>url</code> çš„å€¼ä¸ºä½ çš„ç½‘ç«™ä¸» <code>URL</code>ï¼ˆå¦‚ï¼š<code>http://xxx.github.io</code>ï¼‰ã€‚</li><li>å»ºè®®ä¿®æ”¹ä¸¤ä¸ª <code>per_page</code> çš„åˆ†é¡µæ¡æ•°å€¼ä¸º <code>6</code> çš„å€æ•°ï¼Œå¦‚ï¼š<code>12</code>ã€<code>18</code> ç­‰ï¼Œè¿™æ ·æ–‡ç« åˆ—è¡¨åœ¨å„ä¸ªå±å¹•ä¸‹éƒ½èƒ½è¾ƒå¥½çš„æ˜¾ç¤ºã€‚</li><li>å¦‚æœä½ æ˜¯ä¸­æ–‡ç”¨æˆ·ï¼Œåˆ™å»ºè®®ä¿®æ”¹ <code>language</code> çš„å€¼ä¸º <code>zh-CN</code>ã€‚</li></ul><h3 id="æ–°å»ºåˆ†ç±»-categories-é¡µ"><a href="#æ–°å»ºåˆ†ç±»-categories-é¡µ" class="headerlink" title="æ–°å»ºåˆ†ç±» categories é¡µ"></a>æ–°å»ºåˆ†ç±» categories é¡µ</h3><p><code>categories</code> é¡µæ˜¯ç”¨æ¥å±•ç¤ºæ‰€æœ‰åˆ†ç±»çš„é¡µé¢ï¼Œå¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>categories/index.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hexo new page "categories"</code></pre><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/categories/index.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: categoriesdate: 2018-09-30 17:25:30type: "categories"layout: "categories"---</code></pre><h3 id="æ–°å»ºæ ‡ç­¾-tags-é¡µ"><a href="#æ–°å»ºæ ‡ç­¾-tags-é¡µ" class="headerlink" title="æ–°å»ºæ ‡ç­¾ tags é¡µ"></a>æ–°å»ºæ ‡ç­¾ tags é¡µ</h3><p><code>tags</code> é¡µæ˜¯ç”¨æ¥å±•ç¤ºæ‰€æœ‰æ ‡ç­¾çš„é¡µé¢ï¼Œå¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>tags/index.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hexo new page "tags"</code></pre><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/tags/index.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: tagsdate: 2018-09-30 18:23:38type: "tags"layout: "tags"---</code></pre><h3 id="æ–°å»ºå…³äºæˆ‘-about-é¡µ"><a href="#æ–°å»ºå…³äºæˆ‘-about-é¡µ" class="headerlink" title="æ–°å»ºå…³äºæˆ‘ about é¡µ"></a>æ–°å»ºå…³äºæˆ‘ about é¡µ</h3><p><code>about</code> é¡µæ˜¯ç”¨æ¥å±•ç¤º<strong>å…³äºæˆ‘å’Œæˆ‘çš„åšå®¢</strong>ä¿¡æ¯çš„é¡µé¢ï¼Œå¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>about/index.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hexo new page "about"</code></pre><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/about/index.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: aboutdate: 2018-09-30 17:25:30type: "about"layout: "about"---</code></pre><h3 id="æ–°å»ºç•™è¨€æ¿-contact-é¡µï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ–°å»ºç•™è¨€æ¿-contact-é¡µï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ–°å»ºç•™è¨€æ¿ contact é¡µï¼ˆå¯é€‰çš„ï¼‰"></a>æ–°å»ºç•™è¨€æ¿ contact é¡µï¼ˆå¯é€‰çš„ï¼‰</h3><p><code>contact</code> é¡µæ˜¯ç”¨æ¥å±•ç¤º<strong>ç•™è¨€æ¿</strong>ä¿¡æ¯çš„é¡µé¢ï¼Œå¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>contact/index.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hexo new page "contact"</code></pre><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/contact/index.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: contactdate: 2018-09-30 17:25:30type: "contact"layout: "contact"---</code></pre><blockquote><p><strong>æ³¨</strong>ï¼šæœ¬ç•™è¨€æ¿åŠŸèƒ½ä¾èµ–äºç¬¬ä¸‰æ–¹è¯„è®ºç³»ç»Ÿï¼Œè¯·<strong>æ¿€æ´»</strong>ä½ çš„è¯„è®ºç³»ç»Ÿæ‰æœ‰æ•ˆæœã€‚å¹¶ä¸”åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œç¬¬ <code>19</code> è‡³ <code>21</code> è¡Œçš„â€œ<strong>èœå•</strong>â€é…ç½®ï¼Œå–æ¶ˆå…³äºç•™è¨€æ¿çš„æ³¨é‡Šå³å¯ã€‚</p></blockquote><h3 id="æ–°å»ºå‹æƒ…é“¾æ¥-friends-é¡µï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ–°å»ºå‹æƒ…é“¾æ¥-friends-é¡µï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ–°å»ºå‹æƒ…é“¾æ¥ friends é¡µï¼ˆå¯é€‰çš„ï¼‰"></a>æ–°å»ºå‹æƒ…é“¾æ¥ friends é¡µï¼ˆå¯é€‰çš„ï¼‰</h3><p><code>friends</code> é¡µæ˜¯ç”¨æ¥å±•ç¤º<strong>å‹æƒ…é“¾æ¥</strong>ä¿¡æ¯çš„é¡µé¢ï¼Œå¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>friends/index.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>hexo new page "friends"</code></pre><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/friends/index.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: friendsdate: 2018-12-12 21:25:30type: "friends"layout: "friends"---</code></pre><p>åŒæ—¶ï¼Œåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹æ–°å»º <code>_data</code> ç›®å½•ï¼Œåœ¨ <code>_data</code> ç›®å½•ä¸­æ–°å»º <code>friends.json</code> æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>[&amp;#123;    "avatar": "http://image.luokangyuan.com/1_qq_27922023.jpg",    "name": "ç é…±",    "introduction": "æˆ‘ä¸æ˜¯å¤§ä½¬ï¼Œåªæ˜¯åœ¨è¿½å¯»å¤§ä½¬çš„è„šæ­¥",    "url": "http://luokangyuan.com/",    "title": "å‰å»å­¦ä¹ "&amp;#125;, &amp;#123;    "avatar": "http://image.luokangyuan.com/4027734.jpeg",    "name": "é—ªçƒä¹‹ç‹",    "introduction": "ç¼–ç¨‹ç•Œå¤§ä½¬ï¼ŒæŠ€æœ¯ç‰›ï¼Œäººè¿˜ç‰¹åˆ«å¥½ï¼Œä¸æ‡‚çš„éƒ½å¯ä»¥è¯·æ•™å¤§ä½¬",    "url": "https://blinkfox.github.io/",    "title": "å‰å»å­¦ä¹ "&amp;#125;, &amp;#123;    "avatar": "http://image.luokangyuan.com/avatar.jpg",    "name": "ja_rome",    "introduction": "å¹³å‡¡çš„è„šæ­¥ä¹Ÿå¯ä»¥èµ°å‡ºä¼Ÿå¤§çš„è¡Œç¨‹",    "url": "https://me.csdn.net/jlh912008548",    "title": "å‰å»å­¦ä¹ "&amp;#125;]</code></pre><h3 id="æ–°å»º-404-é¡µ"><a href="#æ–°å»º-404-é¡µ" class="headerlink" title="æ–°å»º 404 é¡µ"></a>æ–°å»º 404 é¡µ</h3><p>å¦‚æœåœ¨ä½ çš„åšå®¢ <code>source</code> ç›®å½•ä¸‹è¿˜æ²¡æœ‰ <code>404.md</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ–°å»ºä¸€ä¸ª</p><p>ç¼–è¾‘ä½ åˆšåˆšæ–°å»ºçš„é¡µé¢æ–‡ä»¶ <code>/source/404.md</code>ï¼Œè‡³å°‘éœ€è¦ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>---title: 404date: 2018-09-30 17:25:30type: "404"layout: "404"description: "Oopsï½ï¼Œæˆ‘å´©æºƒäº†ï¼æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„é¡µé¢ :("---</code></pre><h3 id="èœå•å¯¼èˆªé…ç½®"><a href="#èœå•å¯¼èˆªé…ç½®" class="headerlink" title="èœå•å¯¼èˆªé…ç½®"></a>èœå•å¯¼èˆªé…ç½®</h3><h4 id="é…ç½®åŸºæœ¬èœå•å¯¼èˆªçš„åç§°ã€è·¯å¾„urlå’Œå›¾æ ‡icon"><a href="#é…ç½®åŸºæœ¬èœå•å¯¼èˆªçš„åç§°ã€è·¯å¾„urlå’Œå›¾æ ‡icon" class="headerlink" title="é…ç½®åŸºæœ¬èœå•å¯¼èˆªçš„åç§°ã€è·¯å¾„urlå’Œå›¾æ ‡icon."></a>é…ç½®åŸºæœ¬èœå•å¯¼èˆªçš„åç§°ã€è·¯å¾„urlå’Œå›¾æ ‡icon.</h4><p>1.èœå•å¯¼èˆªåç§°å¯ä»¥æ˜¯ä¸­æ–‡ä¹Ÿå¯ä»¥æ˜¯è‹±æ–‡(å¦‚ï¼š<code>Index</code>æˆ–<code>ä¸»é¡µ</code>) 2.å›¾æ ‡icon å¯ä»¥åœ¨<a href="https://fontawesome.com/icons">Font Awesome</a> ä¸­æŸ¥æ‰¾</p><pre><code>menu:  Index:    url: /    icon: fas fa-home  Tags:    url: /tags    icon: fas fa-tags  Categories:    url: /categories    icon: fas fa-bookmark  Archives:    url: /archives    icon: fas fa-archive  About:    url: /about    icon: fas fa-user-circle  Friends:    url: /friends    icon: fas fa-address-book</code></pre><h4 id="äºŒçº§èœå•é…ç½®æ–¹æ³•"><a href="#äºŒçº§èœå•é…ç½®æ–¹æ³•" class="headerlink" title="äºŒçº§èœå•é…ç½®æ–¹æ³•"></a>äºŒçº§èœå•é…ç½®æ–¹æ³•</h4><p>å¦‚æœä½ éœ€è¦äºŒçº§èœå•åˆ™å¯ä»¥åœ¨åŸåŸºæœ¬èœå•å¯¼èˆªçš„åŸºç¡€ä¸Šå¦‚ä¸‹æ“ä½œ<br>1.åœ¨éœ€è¦æ·»åŠ äºŒçº§èœå•çš„ä¸€çº§èœå•ä¸‹æ·»åŠ <code>children</code>å…³é”®å­—(å¦‚:<code>About</code>èœå•ä¸‹æ·»åŠ <code>children</code>)<br>2.åœ¨<code>children</code>ä¸‹åˆ›å»ºäºŒçº§èœå•çš„ åç§°name,è·¯å¾„urlå’Œå›¾æ ‡icon.<br>3.æ³¨æ„æ¯ä¸ªäºŒçº§èœå•æ¨¡å—å‰è¦åŠ  <code>-</code>.<br>4.æ³¨æ„ç¼©è¿›æ ¼å¼</p><pre><code>menu:  Index:    url: /    icon: fas fa-home  Tags:    url: /tags    icon: fas fa-tags  Categories:    url: /categories    icon: fas fa-bookmark  Archives:    url: /archives    icon: fas fa-archive  About:    url: /about    icon: fas fa-user-circle-o  Friends:    url: /friends    icon: fas fa-address-book  Medias:    icon: fas fa-list    children:      - name: Musics        url: /musics        icon: fas fa-music      - name: Movies        url: /movies        icon: fas fa-film      - name: Books        url: /books        icon: fas fa-book      - name: Galleries        url: /galleries        icon: fas fa-image</code></pre><p>æ‰§è¡Œ <code>hexo clean &amp;&amp; hexo g</code> é‡æ–°ç”Ÿæˆåšå®¢æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥åœ¨æ–‡ç« ä¸­å¯¹åº”ä½ç½®çœ‹åˆ°ä½ ç”¨<code>emoji</code>è¯­æ³•å†™çš„è¡¨æƒ…äº†ã€‚</p><h3 id="ä»£ç é«˜äº®"><a href="#ä»£ç é«˜äº®" class="headerlink" title="ä»£ç é«˜äº®"></a>ä»£ç é«˜äº®</h3><p>ç”±äº Hexo è‡ªå¸¦çš„ä»£ç é«˜äº®ä¸»é¢˜æ˜¾ç¤ºä¸å¥½çœ‹ï¼Œæ‰€ä»¥ä¸»é¢˜ä¸­ä½¿ç”¨åˆ°äº† <a href="https://github.com/ele828/hexo-prism-plugin">hexo-prism-plugin</a> çš„ Hexo æ’ä»¶æ¥åšä»£ç é«˜äº®ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm i -S hexo-prism-plugin</code></pre><p>ç„¶åï¼Œä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹ <code>_config.yml</code> æ–‡ä»¶ä¸­ <code>highlight.enable</code> çš„å€¼ä¸º <code>false</code>ï¼Œå¹¶æ–°å¢ <code>prism</code> æ’ä»¶ç›¸å…³çš„é…ç½®ï¼Œä¸»è¦é…ç½®å¦‚ä¸‹ï¼š</p><pre><code>highlight:  enable: falseprism_plugin:  mode: 'preprocess'    # realtime/preprocess  theme: 'tomorrow'  line_number: false    # default false  custom_css:</code></pre><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><p>æœ¬ä¸»é¢˜ä¸­è¿˜ä½¿ç”¨åˆ°äº† <a href="https://github.com/wzpan/hexo-generator-search">hexo-generator-search</a> çš„ Hexo æ’ä»¶æ¥åšå†…å®¹æœç´¢ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm install hexo-generator-search --save</code></pre><p>åœ¨ Hexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä»¥ä¸‹çš„é…ç½®é¡¹ï¼š</p><pre><code>search:  path: search.xml  field: post</code></pre><h3 id="ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³ï¼ˆå»ºè®®å®‰è£…ï¼‰"><a href="#ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³ï¼ˆå»ºè®®å®‰è£…ï¼‰" class="headerlink" title="ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³ï¼ˆå»ºè®®å®‰è£…ï¼‰"></a>ä¸­æ–‡é“¾æ¥è½¬æ‹¼éŸ³ï¼ˆå»ºè®®å®‰è£…ï¼‰</h3><p>å¦‚æœä½ çš„æ–‡ç« åç§°æ˜¯ä¸­æ–‡çš„ï¼Œé‚£ä¹ˆ Hexo é»˜è®¤ç”Ÿæˆçš„æ°¸ä¹…é“¾æ¥ä¹Ÿä¼šæœ‰ä¸­æ–‡ï¼Œè¿™æ ·ä¸åˆ©äº <code>SEO</code>ï¼Œä¸” <code>gitment</code> è¯„è®ºå¯¹ä¸­æ–‡é“¾æ¥ä¹Ÿä¸æ”¯æŒã€‚æˆ‘ä»¬å¯ä»¥ç”¨ <a href="https://github.com/viko16/hexo-permalink-pinyin">hexo-permalink-pinyin</a> Hexo æ’ä»¶ä½¿åœ¨ç”Ÿæˆæ–‡ç« æ—¶ç”Ÿæˆä¸­æ–‡æ‹¼éŸ³çš„æ°¸ä¹…é“¾æ¥ã€‚</p><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm i hexo-permalink-pinyin --save</code></pre><p>åœ¨ Hexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä»¥ä¸‹çš„é…ç½®é¡¹ï¼š</p><pre><code>permalink_pinyin:  enable: true  separator: '-' # default: '-'</code></pre><blockquote><p><strong>æ³¨</strong>ï¼šé™¤äº†æ­¤æ’ä»¶å¤–ï¼Œ<a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> æ’ä»¶ä¹Ÿå¯ä»¥ç”Ÿæˆéä¸­æ–‡çš„é“¾æ¥ã€‚</p></blockquote><h3 id="æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰"><a href="#æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰" class="headerlink" title="æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰"></a>æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶ï¼ˆå»ºè®®å®‰è£…ï¼‰</h3><p>å¦‚æœä½ æƒ³è¦åœ¨æ–‡ç« ä¸­æ˜¾ç¤ºæ–‡ç« å­—æ•°ã€é˜…è¯»æ—¶é•¿ä¿¡æ¯ï¼Œå¯ä»¥å®‰è£… <a href="https://github.com/willin/hexo-wordcount">hexo-wordcount</a>æ’ä»¶ã€‚</p><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm i --save hexo-wordcount</code></pre><p>ç„¶ååªéœ€åœ¨æœ¬ä¸»é¢˜ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œå°†å„ä¸ªæ–‡ç« å­—æ•°ç›¸å…³çš„é…ç½®æ¿€æ´»å³å¯ï¼š</p><pre><code>postInfo:  date: true  update: false  wordCount: false # è®¾ç½®æ–‡ç« å­—æ•°ç»Ÿè®¡ä¸º true.  totalCount: false # è®¾ç½®ç«™ç‚¹æ–‡ç« æ€»å­—æ•°ç»Ÿè®¡ä¸º true.  min2read: false # é˜…è¯»æ—¶é•¿.  readCount: false # é˜…è¯»æ¬¡æ•°.</code></pre><h3 id="æ·»åŠ emojiè¡¨æƒ…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ·»åŠ emojiè¡¨æƒ…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ·»åŠ emojiè¡¨æƒ…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰"></a>æ·»åŠ emojiè¡¨æƒ…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰</h3><p>æœ¬ä¸»é¢˜æ–°å¢äº†å¯¹<code>emoji</code>è¡¨æƒ…çš„æ”¯æŒï¼Œä½¿ç”¨åˆ°äº† <a href="https://npm.taobao.org/package/hexo-filter-github-emojis">hexo-filter-github-emojis</a> çš„ Hexo æ’ä»¶æ¥æ”¯æŒ <code>emoji</code>è¡¨æƒ…çš„ç”Ÿæˆï¼ŒæŠŠå¯¹åº”çš„<code>markdown emoji</code>è¯­æ³•ï¼ˆ<code>::</code>,ä¾‹å¦‚ï¼š<code>:smile:</code>ï¼‰è½¬å˜æˆä¼šè·³è·ƒçš„<code>emoji</code>è¡¨æƒ…ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm install hexo-filter-github-emojis --save</code></pre><p>åœ¨ Hexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä»¥ä¸‹çš„é…ç½®é¡¹ï¼š</p><pre><code>githubEmojis:  enable: true  className: github-emoji  inject: true  styles:  customEmojis:</code></pre><h3 id="æ·»åŠ -RSS-è®¢é˜…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ·»åŠ -RSS-è®¢é˜…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ·»åŠ  RSS è®¢é˜…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰"></a>æ·»åŠ  RSS è®¢é˜…æ”¯æŒï¼ˆå¯é€‰çš„ï¼‰</h3><p>æœ¬ä¸»é¢˜ä¸­è¿˜ä½¿ç”¨åˆ°äº† <a href="https://github.com/hexojs/hexo-generator-feed">hexo-generator-feed</a> çš„ Hexo æ’ä»¶æ¥åš <code>RSS</code>ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>npm install hexo-generator-feed --save</code></pre><p>åœ¨ Hexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä»¥ä¸‹çš„é…ç½®é¡¹ï¼š</p><pre><code>feed:  type: atom  path: atom.xml  limit: 20  hub:  content:  content_limit: 140  content_limit_delim: ' '  order_by: -date</code></pre><p>æ‰§è¡Œ <code>hexo clean &amp;&amp; hexo g</code> é‡æ–°ç”Ÿæˆåšå®¢æ–‡ä»¶ï¼Œç„¶ååœ¨ <code>public</code> æ–‡ä»¶å¤¹ä¸­å³å¯çœ‹åˆ° <code>atom.xml</code> æ–‡ä»¶ï¼Œè¯´æ˜ä½ å·²ç»å®‰è£…æˆåŠŸäº†ã€‚</p><h3 id="æ·»åŠ -DaoVoice-åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ·»åŠ -DaoVoice-åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ·»åŠ  DaoVoice åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰"></a>æ·»åŠ  <a href="http://www.daovoice.io/">DaoVoice</a> åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰</h3><p>å‰å¾€ <a href="http://www.daovoice.io/">DaoVoice</a> å®˜ç½‘æ³¨å†Œå¹¶ä¸”è·å– <code>app_id</code>ï¼Œå¹¶å°† <code>app_id</code> å¡«å…¥ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ã€‚</p><h3 id="æ·»åŠ -Tidio-åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰"><a href="#æ·»åŠ -Tidio-åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="æ·»åŠ  Tidio åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰"></a>æ·»åŠ  <a href="https://www.tidio.com/">Tidio</a> åœ¨çº¿èŠå¤©åŠŸèƒ½ï¼ˆå¯é€‰çš„ï¼‰</h3><p>å‰å¾€ <a href="https://www.tidio.com/">Tidio</a> å®˜ç½‘æ³¨å†Œå¹¶ä¸”è·å– <code>Public Key</code>ï¼Œå¹¶å°† <code>Public Key</code> å¡«å…¥ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ã€‚</p><h3 id="ä¿®æ”¹é¡µè„š"><a href="#ä¿®æ”¹é¡µè„š" class="headerlink" title="ä¿®æ”¹é¡µè„š"></a>ä¿®æ”¹é¡µè„š</h3><p>é¡µè„šä¿¡æ¯å¯èƒ½éœ€è¦åšå®šåˆ¶åŒ–ä¿®æ”¹ï¼Œè€Œä¸”å®ƒä¸ä¾¿äºåšæˆé…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä½ è‡ªå·±å»å†ä¿®æ”¹å’ŒåŠ å·¥ã€‚ä¿®æ”¹çš„åœ°æ–¹åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/layout/_partial/footer.ejs</code> æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ç«™ç‚¹ã€ä½¿ç”¨çš„ä¸»é¢˜ã€è®¿é—®é‡ç­‰ã€‚</p><h3 id="ä¿®æ”¹ç¤¾äº¤é“¾æ¥"><a href="#ä¿®æ”¹ç¤¾äº¤é“¾æ¥" class="headerlink" title="ä¿®æ”¹ç¤¾äº¤é“¾æ¥"></a>ä¿®æ”¹ç¤¾äº¤é“¾æ¥</h3><p>åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æ”¯æŒ <code>QQ</code>ã€<code>GitHub</code> å’Œé‚®ç®±ç­‰çš„é…ç½®ï¼Œä½ å¯ä»¥åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/layout/_partial/social-link.ejs</code> æ–‡ä»¶ä¸­ï¼Œæ–°å¢ã€ä¿®æ”¹ä½ éœ€è¦çš„ç¤¾äº¤é“¾æ¥åœ°å€ï¼Œå¢åŠ é“¾æ¥å¯å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p><pre><code>&lt;% if (theme.socialLink.github) &amp;#123; %&gt;    &lt;a href="&lt;%= theme.socialLink.github %&gt;" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50"&gt;        &lt;i class="fab fa-github"&gt;&lt;/i&gt;    &lt;/a&gt;&lt;% &amp;#125; %&gt;</code></pre><p>å…¶ä¸­ï¼Œç¤¾äº¤å›¾æ ‡ï¼ˆå¦‚ï¼š<code>fa-github</code>ï¼‰ä½ å¯ä»¥åœ¨ <a href="https://fontawesome.com/icons">Font Awesome</a> ä¸­æœç´¢æ‰¾åˆ°ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨ç¤¾äº¤å›¾æ ‡çš„æ ‡è¯†ï¼Œä¾›ä½ å‚è€ƒï¼š</p><ul><li>Facebook: <code>fab fa-facebook</code></li><li>Twitter: <code>fab fa-twitter</code></li><li>Google-plus: <code>fab fa-google-plus</code></li><li>Linkedin: <code>fab fa-linkedin</code></li><li>Tumblr: <code>fab fa-tumblr</code></li><li>Medium: <code>fab fa-medium</code></li><li>Slack: <code>fab fa-slack</code></li><li>Sina Weibo: <code>fab fa-weibo</code></li><li>Wechat: <code>fab fa-weixin</code></li><li>QQ: <code>fab fa-qq</code></li><li>Zhihu: <code>fab fa-zhihu</code></li></ul><blockquote><p><strong>æ³¨æ„</strong>: æœ¬ä¸»é¢˜ä¸­ä½¿ç”¨çš„ <code>Font Awesome</code> ç‰ˆæœ¬ä¸º <code>5.11.0</code>ã€‚</p></blockquote><h3 id="ä¿®æ”¹æ‰“èµçš„äºŒç»´ç å›¾ç‰‡"><a href="#ä¿®æ”¹æ‰“èµçš„äºŒç»´ç å›¾ç‰‡" class="headerlink" title="ä¿®æ”¹æ‰“èµçš„äºŒç»´ç å›¾ç‰‡"></a>ä¿®æ”¹æ‰“èµçš„äºŒç»´ç å›¾ç‰‡</h3><p>åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>source/medias/reward</code> æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æ›¿æ¢æˆä½ çš„çš„å¾®ä¿¡å’Œæ”¯ä»˜å®çš„æ‰“èµäºŒç»´ç å›¾ç‰‡ã€‚</p><h3 id="é…ç½®éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå¯é€‰çš„ï¼‰"><a href="#é…ç½®éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå¯é€‰çš„ï¼‰" class="headerlink" title="é…ç½®éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå¯é€‰çš„ï¼‰"></a>é…ç½®éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå¯é€‰çš„ï¼‰</h3><p>è¦æ”¯æŒéŸ³ä¹æ’­æ”¾ï¼Œåœ¨ä¸»é¢˜çš„ <code>_config.yml</code> é…ç½®æ–‡ä»¶ä¸­æ¿€æ´»musicé…ç½®å³å¯ï¼š</p><pre><code># æ˜¯å¦åœ¨é¦–é¡µæ˜¾ç¤ºéŸ³ä¹music:  enable: true  title:             # éå¸åº•æ¨¡å¼æœ‰æ•ˆ    enable: true    show: å¬å¬éŸ³ä¹  server: netease   # require music platform: netease, tencent, kugou, xiami, baidu  type: playlist    # require song, playlist, album, search, artist  id: 503838841     # require song id / playlist id / album id / search keyword  fixed: false      # å¼€å¯å¸åº•æ¨¡å¼  autoplay: false   # æ˜¯å¦è‡ªåŠ¨æ’­æ”¾  theme: '#42b983'  loop: 'all'       # éŸ³é¢‘å¾ªç¯æ’­æ”¾, å¯é€‰å€¼: 'all', 'one', 'none'  order: 'random'   # éŸ³é¢‘å¾ªç¯é¡ºåº, å¯é€‰å€¼: 'list', 'random'  preload: 'auto'   # é¢„åŠ è½½ï¼Œå¯é€‰å€¼: 'none', 'metadata', 'auto'  volume: 0.7       # é»˜è®¤éŸ³é‡ï¼Œè¯·æ³¨æ„æ’­æ”¾å™¨ä¼šè®°å¿†ç”¨æˆ·è®¾ç½®ï¼Œç”¨æˆ·æ‰‹åŠ¨è®¾ç½®éŸ³é‡åé»˜è®¤éŸ³é‡å³å¤±æ•ˆ  listFolded: true  # åˆ—è¡¨é»˜è®¤æŠ˜å </code></pre><blockquote><p><code>server</code>å¯é€‰<code>netease</code>ï¼ˆç½‘æ˜“äº‘éŸ³ä¹ï¼‰ï¼Œ<code>tencent</code>ï¼ˆQQéŸ³ä¹ï¼‰ï¼Œ<code>kugou</code>ï¼ˆé…·ç‹—éŸ³ä¹ï¼‰ï¼Œ<code>xiami</code>ï¼ˆè™¾ç±³éŸ³ä¹ï¼‰ï¼Œ</p><p><code>baidu</code>ï¼ˆç™¾åº¦éŸ³ä¹ï¼‰ã€‚</p><p><code>type</code>å¯é€‰<code>song</code>ï¼ˆæ­Œæ›²ï¼‰ï¼Œ<code>playlist</code>ï¼ˆæ­Œå•ï¼‰ï¼Œ<code>album</code>ï¼ˆä¸“è¾‘ï¼‰ï¼Œ<code>search</code>ï¼ˆæœç´¢å…³é”®å­—ï¼‰ï¼Œ<code>artist</code>ï¼ˆæ­Œæ‰‹ï¼‰</p><pre><code>id`è·å–æ–¹æ³•ç¤ºä¾‹: æµè§ˆå™¨æ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹ï¼Œç‚¹å‡»æˆ‘å–œæ¬¢çš„éŸ³ä¹æ­Œå•ï¼Œæµè§ˆå™¨åœ°å€æ åé¢ä¼šæœ‰ä¸€ä¸²æ•°å­—ï¼Œ`playlist`çš„`id</code></pre><p>å³ä¸ºè¿™ä¸²æ•°å­—ã€‚</p></blockquote><h2 id="æ–‡ç« -Front-matter-ä»‹ç»"><a href="#æ–‡ç« -Front-matter-ä»‹ç»" class="headerlink" title="æ–‡ç«  Front-matter ä»‹ç»"></a>æ–‡ç«  Front-matter ä»‹ç»</h2><h3 id="Front-matter-é€‰é¡¹è¯¦è§£"><a href="#Front-matter-é€‰é¡¹è¯¦è§£" class="headerlink" title="Front-matter é€‰é¡¹è¯¦è§£"></a>Front-matter é€‰é¡¹è¯¦è§£</h3><p><code>Front-matter</code> é€‰é¡¹ä¸­çš„æ‰€æœ‰å†…å®¹å‡ä¸º<strong>éå¿…å¡«</strong>çš„ã€‚ä½†æˆ‘ä»ç„¶å»ºè®®è‡³å°‘å¡«å†™ <code>title</code> å’Œ <code>date</code> çš„å€¼ã€‚</p><table><thead><tr><th>é…ç½®é€‰é¡¹</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> çš„æ–‡ä»¶æ ‡é¢˜</td><td>æ–‡ç« æ ‡é¢˜ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹</td></tr><tr><td>date</td><td>æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¥æœŸæ—¶é—´</td><td>å‘å¸ƒæ—¶é—´ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹ï¼Œä¸”æœ€å¥½ä¿è¯å…¨å±€å”¯ä¸€</td></tr><tr><td>author</td><td>æ ¹ <code>_config.yml</code> ä¸­çš„ <code>author</code></td><td>æ–‡ç« ä½œè€…</td></tr><tr><td>img</td><td><code>featureImages</code> ä¸­çš„æŸä¸ªå€¼</td><td>æ–‡ç« ç‰¹å¾å›¾ï¼Œæ¨èä½¿ç”¨å›¾åºŠ(è…¾è®¯äº‘ã€ä¸ƒç‰›äº‘ã€åˆæ‹äº‘ç­‰)æ¥åšå›¾ç‰‡çš„è·¯å¾„.å¦‚: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>æ¨èæ–‡ç« ï¼ˆæ–‡ç« æ˜¯å¦ç½®é¡¶ï¼‰ï¼Œå¦‚æœ <code>top</code> å€¼ä¸º <code>true</code>ï¼Œåˆ™ä¼šä½œä¸ºé¦–é¡µæ¨èæ–‡ç« </td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« æ˜¯å¦éœ€è¦åŠ å…¥åˆ°é¦–é¡µè½®æ’­å°é¢ä¸­</td></tr><tr><td>coverImg</td><td>æ— </td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« åœ¨é¦–é¡µè½®æ’­å°é¢éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ–‡ç« çš„ç‰¹è‰²å›¾ç‰‡</td></tr><tr><td>password</td><td>æ— </td><td>æ–‡ç« é˜…è¯»å¯†ç ï¼Œå¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„è¯ï¼Œå°±å¯ä»¥è®¾ç½® <code>password</code> çš„å€¼ï¼Œè¯¥å€¼å¿…é¡»æ˜¯ç”¨ <code>SHA256</code> åŠ å¯†åçš„å¯†ç ï¼Œé˜²æ­¢è¢«ä»–äººè¯†ç ´ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>verifyPassword</code> é€‰é¡¹</td></tr><tr><td>toc</td><td><code>true</code></td><td>æ˜¯å¦å¼€å¯ TOCï¼Œå¯ä»¥é’ˆå¯¹æŸç¯‡æ–‡ç« å•ç‹¬å…³é—­ TOC çš„åŠŸèƒ½ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>toc</code> é€‰é¡¹</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>æ˜¯å¦å¼€å¯æ•°å­¦å…¬å¼æ”¯æŒ ï¼Œæœ¬æ–‡ç« æ˜¯å¦å¼€å¯ <code>mathjax</code>ï¼Œä¸”éœ€è¦åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å¼€å¯æ‰è¡Œ</td></tr><tr><td>summary</td><td>æ— </td><td>æ–‡ç« æ‘˜è¦ï¼Œè‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦</td></tr><tr><td>categories</td><td>æ— </td><td>æ–‡ç« åˆ†ç±»ï¼Œæœ¬ä¸»é¢˜çš„åˆ†ç±»è¡¨ç¤ºå®è§‚ä¸Šå¤§çš„åˆ†ç±»ï¼Œåªå»ºè®®ä¸€ç¯‡æ–‡ç« ä¸€ä¸ªåˆ†ç±»</td></tr><tr><td>tags</td><td>æ— </td><td>æ–‡ç« æ ‡ç­¾ï¼Œä¸€ç¯‡æ–‡ç« å¯ä»¥å¤šä¸ªæ ‡ç­¾</td></tr><tr><td>keywords</td><td>æ–‡ç« æ ‡é¢˜</td><td>æ–‡ç« å…³é”®å­—ï¼ŒSEO æ—¶éœ€è¦</td></tr><tr><td>reprintPolicy</td><td>cc_by</td><td>æ–‡ç« è½¬è½½è§„åˆ™ï¼Œ å¯ä»¥æ˜¯ cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint æˆ– pay ä¸­çš„ä¸€ä¸ª</td></tr></tbody></table><blockquote><p><strong>æ³¨æ„</strong>:</p><ol><li>å¦‚æœ <code>img</code> å±æ€§ä¸å¡«å†™çš„è¯ï¼Œæ–‡ç« ç‰¹è‰²å›¾ä¼šæ ¹æ®æ–‡ç« æ ‡é¢˜çš„ <code>hashcode</code> çš„å€¼å–ä½™ï¼Œç„¶åé€‰å–ä¸»é¢˜ä¸­å¯¹åº”çš„ç‰¹è‰²å›¾ç‰‡ï¼Œä»è€Œè¾¾åˆ°è®©æ‰€æœ‰æ–‡ç« éƒ½çš„ç‰¹è‰²å›¾<strong>å„æœ‰ç‰¹è‰²</strong>ã€‚</li><li><code>date</code> çš„å€¼å°½é‡ä¿è¯æ¯ç¯‡æ–‡ç« æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºæœ¬ä¸»é¢˜ä¸­ <code>Gitalk</code> å’Œ <code>Gitment</code> è¯†åˆ« <code>id</code> æ˜¯é€šè¿‡ <code>date</code> çš„å€¼æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„ã€‚</li><li>å¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„åŠŸèƒ½ï¼Œä¸ä»…è¦åœ¨ Front-matter ä¸­è®¾ç½®é‡‡ç”¨äº† SHA256 åŠ å¯†çš„ password çš„å€¼ï¼Œè¿˜éœ€è¦åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> ä¸­æ¿€æ´»äº†é…ç½®ã€‚æœ‰äº›åœ¨çº¿çš„ SHA256 åŠ å¯†çš„åœ°å€ï¼Œå¯ä¾›ä½ ä½¿ç”¨ï¼š<a href="http://tool.oschina.net/encrypt?type=2">å¼€æºä¸­å›½åœ¨çº¿å·¥å…·</a>ã€<a href="http://encode.chahuo.com/">chahuo</a>ã€<a href="http://tool.chinaz.com/tools/hash.aspx">ç«™é•¿å·¥å…·</a>ã€‚</li><li>æ‚¨å¯ä»¥åœ¨æ–‡ç« mdæ–‡ä»¶çš„ front-matter ä¸­æŒ‡å®š reprintPolicy æ¥ç»™å•ä¸ªæ–‡ç« é…ç½®è½¬è½½è§„åˆ™</li></ol></blockquote><p>ä»¥ä¸‹ä¸ºæ–‡ç« çš„ <code>Front-matter</code> ç¤ºä¾‹ã€‚</p><h3 id="æœ€ç®€ç¤ºä¾‹"><a href="#æœ€ç®€ç¤ºä¾‹" class="headerlink" title="æœ€ç®€ç¤ºä¾‹"></a>æœ€ç®€ç¤ºä¾‹</h3><pre><code>---title: typora-vue-themeä¸»é¢˜ä»‹ç»date: 2018-09-07 09:25:00---</code></pre><h3 id="æœ€å…¨ç¤ºä¾‹"><a href="#æœ€å…¨ç¤ºä¾‹" class="headerlink" title="æœ€å…¨ç¤ºä¾‹"></a>æœ€å…¨ç¤ºä¾‹</h3><pre><code>---title: typora-vue-themeä¸»é¢˜ä»‹ç»date: 2018-09-07 09:25:00author: èµµå¥‡img: /source/images/xxx.jpgtop: truecover: truecoverImg: /images/1.jpgpassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92toc: falsemathjax: falsesummary: è¿™æ˜¯ä½ è‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦categories: Markdowntags:  - Typora  - Markdown---</code></pre><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><h3 id="å›¾ç‰‡æ’ä»¶"><a href="#å›¾ç‰‡æ’ä»¶" class="headerlink" title="å›¾ç‰‡æ’ä»¶"></a>å›¾ç‰‡æ’ä»¶</h3><h4 id="ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ’ä»¶ï¼Œåœ¨hexoæ ¹ç›®å½•æ‰“å¼€Git-Bash-æ‰§è¡Œ"><a href="#ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ’ä»¶ï¼Œåœ¨hexoæ ¹ç›®å½•æ‰“å¼€Git-Bash-æ‰§è¡Œ" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ’ä»¶ï¼Œåœ¨hexoæ ¹ç›®å½•æ‰“å¼€Git Bash,æ‰§è¡Œ"></a>ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ’ä»¶ï¼Œåœ¨hexoæ ¹ç›®å½•æ‰“å¼€Git Bash,æ‰§è¡Œ</h4><pre class=" language-javascript"><code class="language-javascript">npm install hexo<span class="token operator">-</span>asset<span class="token operator">-</span>image <span class="token operator">--</span>save</code></pre><h4 id="ç¬¬äºŒæ­¥ï¼šæ‰“å¼€hexoçš„é…ç½®æ–‡ä»¶-config-yml"><a href="#ç¬¬äºŒæ­¥ï¼šæ‰“å¼€hexoçš„é…ç½®æ–‡ä»¶-config-yml" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šæ‰“å¼€hexoçš„é…ç½®æ–‡ä»¶_config.yml"></a>ç¬¬äºŒæ­¥ï¼šæ‰“å¼€hexoçš„é…ç½®æ–‡ä»¶_config.yml</h4><pre class=" language-shell"><code class="language-shell">æ‰¾åˆ° post_asset_folderï¼ŒæŠŠè¿™ä¸ªé€‰é¡¹ä»falseæ”¹æˆtrue</code></pre><h4 id="ç¬¬ä¸‰æ­¥ï¼šæ‰“å¼€"><a href="#ç¬¬ä¸‰æ­¥ï¼šæ‰“å¼€" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šæ‰“å¼€"></a>ç¬¬ä¸‰æ­¥ï¼šæ‰“å¼€</h4><p>ä¿®æ”¹ /node_modules/hexo-asset-image/index.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">var</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">getPosition</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> m<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> version <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>hexo<span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'after_post_render'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> config <span class="token operator">=</span> hexo<span class="token punctuation">.</span>config<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>post_asset_folder<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> link <span class="token operator">=</span> data<span class="token punctuation">.</span>permalink<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>version<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">Number</span><span class="token punctuation">(</span>version<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>       <span class="token keyword">var</span> beginPos <span class="token operator">=</span> <span class="token function">getPosition</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>       <span class="token keyword">var</span> beginPos <span class="token operator">=</span> <span class="token function">getPosition</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> endPos <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    link <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>beginPos<span class="token punctuation">,</span> endPos<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> toprocess <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'excerpt'</span><span class="token punctuation">,</span> <span class="token string">'more'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> toprocess<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> key <span class="token operator">=</span> toprocess<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">var</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        ignoreWhitespace<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        xmlMode<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        lowerCaseTags<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        decodeEntities<span class="token punctuation">:</span> <span class="token boolean">false</span>      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> src <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex">/http[s]*.*|\/\/.*/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>               <span class="token operator">!</span><span class="token regex">/^\s*\//</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>              <span class="token keyword">var</span> linkArray <span class="token operator">=</span> link<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> elem <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">;</span>              <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">var</span> srcArray <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> elem <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> elem <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">;</span>              <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">if</span><span class="token punctuation">(</span>srcArray<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>                srcArray<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              src <span class="token operator">=</span> srcArray<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>root <span class="token operator">+</span> link <span class="token operator">+</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>              console<span class="token punctuation">.</span>info<span class="token operator">&amp;&amp;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"update link as:-->"</span><span class="token operator">+</span>config<span class="token punctuation">.</span>root <span class="token operator">+</span> link <span class="token operator">+</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span>info<span class="token operator">&amp;&amp;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"no src attr, skipped..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span>info<span class="token operator">&amp;&amp;</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¿®æ”¹ä»£ç è§- è¡¥å……æ–‡ä»¶å¤¹ä¸‹çš„images_file.js</p><h4 id="ç¬¬å››æ­¥ï¼šç°åœ¨å°±å¯ä»¥æ’å…¥å›¾ç‰‡äº†"><a href="#ç¬¬å››æ­¥ï¼šç°åœ¨å°±å¯ä»¥æ’å…¥å›¾ç‰‡äº†" class="headerlink" title="ç¬¬å››æ­¥ï¼šç°åœ¨å°±å¯ä»¥æ’å…¥å›¾ç‰‡äº†"></a>ç¬¬å››æ­¥ï¼šç°åœ¨å°±å¯ä»¥æ’å…¥å›¾ç‰‡äº†</h4><p>æ¯”å¦‚hexo new  photoä¹‹åå°±åœ¨source/_postsç”Ÿæˆphoto.mdæ–‡ä»¶å’Œphotoæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æŠŠè¦æ’å…¥çš„å›¾ç‰‡å¤åˆ¶åˆ°photoæ–‡ä»¶å¤¹å†…ï¼Œ åœ¨photo.mdæ–‡ä»¶é‡Œé¢æŒ‰markdownçš„æ ‡å‡†å†™,ï¼ˆæˆ‘çš„æ–‡ä»¶åæ˜¯head.jpegï¼‰æ¯”å¦‚</p><pre class=" language-bash"><code class="language-bash"><span class="token operator">!</span><span class="token punctuation">[</span>è¿™æ˜¯ä»£æ›¿å›¾ç‰‡çš„æ–‡å­—ï¼Œéšä¾¿å†™<span class="token punctuation">]</span><span class="token punctuation">(</span>head.jpeg<span class="token punctuation">)</span></code></pre><h3 id="è¯„è®ºç³»ç»Ÿ"><a href="#è¯„è®ºç³»ç»Ÿ" class="headerlink" title="è¯„è®ºç³»ç»Ÿ"></a>è¯„è®ºç³»ç»Ÿ</h3><h4 id="æ³¨å†Œ"><a href="#æ³¨å†Œ" class="headerlink" title="æ³¨å†Œ"></a>æ³¨å†Œ</h4><p>â€‹       å…ˆå»æ³¨å†Œï¼Œvalineä¾é™„äºLeanCloudï¼Œå…ˆå»æ³¨å†Œï¼Œå¹¶å®Œæˆ<em>å®åè®¤è¯</em> <a href="https://links.jianshu.com/go?to=https://leancloud.cn/">LeanCloudæ³¨å†Œ</a></p><h4 id="å®åè®¤è¯"><a href="#å®åè®¤è¯" class="headerlink" title="å®åè®¤è¯"></a>å®åè®¤è¯</h4><p>â€‹       æ³¨å†ŒæˆåŠŸåˆ‡è®°<strong>å®åè®¤è¯</strong>ï¼Œåæ­£ä»–ä¼šè‡ªå·±æé†’çš„ï¼Œä¸å®Œæˆä¹Ÿåšä¸äº†ä¸‹ä¸€æ­¥</p><p>â€‹       å®åè®¤è¯ååˆ›å»ºåº”ç”¨ï¼Œåº”ç”¨åå­—å•¥çš„éšä¾¿å–ã€‚</p><p>####appid</p><p>ç„¶åè·å¾—appidï¼Œå’Œkeysï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/Users/daiyizheng/Desktop/daiyz/source/_posts/hexo/valine1.webp" alt="appidå’Œappkeys"></p><p>â€‹       ç„¶åä¸‹ä¸€æ­¥æŠŠä½ çš„åšå®¢åŸŸåå†™åˆ°å®‰å…¨ä¸­å¿ƒã€‚</p><p><img src="/Users/daiyizheng/Desktop/daiyz/source/_posts/hexo/valine2.webp" alt="å®‰å…¨ä¸­å¿ƒ"></p><h4 id="valineé…ç½®"><a href="#valineé…ç½®" class="headerlink" title="valineé…ç½®"></a>valineé…ç½®</h4><p>â€‹      æ‰“å¼€nextä¸»é¢˜çš„configæ–‡ä»¶ï¼Œæ‰¾åˆ°valineé…ç½®ï¼ŒæŠŠä½ çš„appidå’Œappkeyå¡«è¿›å»ï¼Œé‡æ–°hexo gï¼Œhexo dï¼Œä¸€ä¸‹ï¼Œä¸‰åˆ†é’Ÿåï¼Œçœ‹çœ‹ä½ çš„æ–‡ç« åº•éƒ¨ï¼Œç®€çº¦è€Œä¸ç®€å•çš„è¯„è®ºå‡ºæ¥äº†ã€‚</p><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># Valine.</span><span class="token comment" spellcheck="true"># You can get your appid and appkey from https://leancloud.cn</span><span class="token comment" spellcheck="true"># more info please open https://valine.js.org</span><span class="token key atrule">valine</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">appid</span><span class="token punctuation">:</span>  æ‰‹åŠ¨æ‰“ç   <span class="token key atrule">appkey</span><span class="token punctuation">:</span>  æ‰‹åŠ¨æ‰“ç   <span class="token key atrule">notify</span><span class="token punctuation">:</span> <span class="token boolean important">false </span><span class="token comment" spellcheck="true"># mail notifier , https://github.com/xCss/Valine/wiki</span>  <span class="token key atrule">verify</span><span class="token punctuation">:</span> <span class="token boolean important">false </span><span class="token comment" spellcheck="true"># Verification code</span>  <span class="token key atrule">placeholder</span><span class="token punctuation">:</span> come on baby <span class="token comment" spellcheck="true"># æ¥å•Šï¼Œå¿«æ´»å•Š</span>  <span class="token key atrule">avatar</span><span class="token punctuation">:</span> mm <span class="token comment" spellcheck="true"># gravatar style</span>  <span class="token key atrule">guest_info</span><span class="token punctuation">:</span> nick<span class="token punctuation">,</span>mail<span class="token punctuation">,</span>link <span class="token comment" spellcheck="true"># custom comment header</span>  <span class="token key atrule">pageSize</span><span class="token punctuation">:</span> <span class="token number">10 </span><span class="token comment" spellcheck="true"># pagination size</span></code></pre><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="æ•°å­¦å…¬å¼ä¸æ˜¾ç¤º"><a href="#æ•°å­¦å…¬å¼ä¸æ˜¾ç¤º" class="headerlink" title="æ•°å­¦å…¬å¼ä¸æ˜¾ç¤º"></a>æ•°å­¦å…¬å¼ä¸æ˜¾ç¤º</h3><p>åœ¨Hexoä¸­æ¸²æŸ“MathJaxæ•°å­¦å…¬å¼</p><p>åœ¨ç”¨markdownå†™æŠ€æœ¯æ–‡æ¡£æ—¶ï¼Œå…ä¸äº†ä¼šç¢°åˆ°æ•°å­¦å…¬å¼ã€‚å¸¸ç”¨çš„Markdownç¼–è¾‘å™¨éƒ½ä¼šé›†æˆ<a href="https://link.jianshu.com/?t=https://www.mathjax.org/">Mathjax</a>ï¼Œç”¨æ¥æ¸²æŸ“æ–‡æ¡£ä¸­çš„ç±»Latexæ ¼å¼ä¹¦å†™çš„æ•°å­¦å…¬å¼ã€‚åŸºäºHexoæ­å»ºçš„ä¸ªäººåšå®¢ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¸²æŸ“æ•°å­¦å…¬å¼å´ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ã€‚</p><h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>Hexoé»˜è®¤ä½¿ç”¨â€hexo-renderer-markedâ€å¼•æ“æ¸²æŸ“ç½‘é¡µï¼Œè¯¥å¼•æ“ä¼šæŠŠä¸€äº›ç‰¹æ®Šçš„markdownç¬¦å·è½¬æ¢ä¸ºç›¸åº”çš„htmlæ ‡ç­¾ï¼Œæ¯”å¦‚åœ¨markdownè¯­æ³•ä¸­ï¼Œä¸‹åˆ’çº¿â€™_â€™ä»£è¡¨æ–œä½“ï¼Œä¼šè¢«æ¸²æŸ“å¼•æ“å¤„ç†ä¸º``æ ‡ç­¾ã€‚</p><p>å› ä¸ºç±»Latexæ ¼å¼ä¹¦å†™çš„æ•°å­¦å…¬å¼ä¸‹åˆ’çº¿ â€˜_â€™ è¡¨ç¤ºä¸‹æ ‡ï¼Œæœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œå¦‚æœè¢«å¼ºåˆ¶è½¬æ¢ä¸º<code>æ ‡ç­¾ï¼Œé‚£ä¹ˆMathJaxå¼•æ“åœ¨æ¸²æŸ“æ•°å­¦å…¬å¼çš„æ—¶å€™å°±ä¼šå‡ºé”™ã€‚ä¾‹å¦‚ï¼Œ$x_i$åœ¨å¼€å§‹è¢«æ¸²æŸ“çš„æ—¶å€™ï¼Œå¤„ç†ä¸º$x</code>i``$ï¼Œè¿™æ ·MathJaxå¼•æ“å°±è®¤ä¸ºè¯¥å…¬å¼æœ‰è¯­æ³•é”™è¯¯ï¼Œå› ä¸ºä¸ä¼šæ¸²æŸ“ã€‚</p><p>ç±»ä¼¼çš„è¯­ä¹‰å†²çªçš„ç¬¦å·è¿˜åŒ…æ‹¬â€™*â€™, â€˜{â€˜, â€˜}â€™, â€˜'ç­‰ã€‚</p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œå¯ä»¥ç½‘ä¸Šæœä¸‹ï¼Œä¸ºäº†èŠ‚çœå¤§å®¶çš„æ—¶é—´ï¼Œè¿™é‡Œåªæä¾›äº²èº«æµ‹è¯•è¿‡çš„æœ€é è°±çš„æ–¹æ³•ã€‚</p><p>æ›´æ¢Hexoçš„markdownæ¸²æŸ“å¼•æ“ï¼Œ<a href="https://link.jianshu.com/?t=https://github.com/sun11/hexo-renderer-kramed">hexo-renderer-kramed</a>å¼•æ“æ˜¯åœ¨é»˜è®¤çš„æ¸²æŸ“å¼•æ“<a href="https://link.jianshu.com/?t=https://github.com/hexojs/hexo-renderer-marked">hexo-renderer-marked</a>çš„åŸºç¡€ä¸Šä¿®æ”¹äº†ä¸€äº›bugï¼Œä¸¤è€…æ¯”è¾ƒæ¥è¿‘ï¼Œä¹Ÿæ¯”è¾ƒè½»é‡çº§ã€‚</p><pre class=" language-undefined"><code class="language-undefined">npm uninstall hexo-renderer-marked --savenpm install hexo-renderer-kramed --save</code></pre><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤å³å¯ï¼Œå…ˆå¸è½½åŸæ¥çš„æ¸²æŸ“å¼•æ“ï¼Œå†å®‰è£…æ–°çš„ã€‚</p><p>ç„¶åï¼Œè·Ÿæ¢å¼•æ“åè¡Œé—´å…¬å¼å¯ä»¥æ­£ç¡®æ¸²æŸ“äº†ï¼Œä½†æ˜¯è¿™æ ·è¿˜æ²¡æœ‰å®Œå…¨è§£å†³é—®é¢˜ï¼Œè¡Œå†…å…¬å¼çš„æ¸²æŸ“è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå› ä¸º<a href="https://link.jianshu.com/?t=https://github.com/sun11/hexo-renderer-kramed">hexo-renderer-kramed</a>å¼•æ“ä¹Ÿæœ‰è¯­ä¹‰å†²çªçš„é—®é¢˜ã€‚æ¥ä¸‹æ¥åˆ°åšå®¢æ ¹ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°node_modules\kramed\lib\rules\inline.jsï¼ŒæŠŠç¬¬11è¡Œçš„escapeå˜é‡çš„å€¼åšç›¸åº”çš„ä¿®æ”¹ï¼š</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//  escape: /^\\([\\`*&amp;#123;&amp;#125;\[\]()#$+\-.!_>])/,</span>  escape<span class="token punctuation">:</span> <span class="token regex">/^\\([`*\[\]()#$+\-.!_>])/</span></code></pre><p>è¿™ä¸€æ­¥æ˜¯åœ¨åŸåŸºç¡€ä¸Šå–æ¶ˆäº†å¯¹,{,}çš„è½¬ä¹‰(escape)ã€‚<br> åŒæ—¶æŠŠç¬¬20è¡Œçš„emå˜é‡ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹ã€‚</p><pre class=" language-ruby"><code class="language-ruby"><span class="token operator">/</span><span class="token operator">/</span>  em<span class="token punctuation">:</span> <span class="token regex">/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span><span class="token punctuation">,</span>  em<span class="token punctuation">:</span> <span class="token regex">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span></code></pre><p>é‡æ–°å¯åŠ¨hexoï¼ˆå…ˆcleanå†generateï¼‰,é—®é¢˜å®Œç¾è§£å†³ã€‚å“¦ï¼Œå¦‚æœä¸å¹¸è¿˜æ²¡è§£å†³çš„è¯ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿˜éœ€è¦åœ¨ä½¿ç”¨çš„ä¸»é¢˜ä¸­é…ç½®mathjaxå¼€å…³ã€‚</p><h4 id="åœ¨ä¸»é¢˜ä¸­å¼€å¯mathjaxå¼€å…³"><a href="#åœ¨ä¸»é¢˜ä¸­å¼€å¯mathjaxå¼€å…³" class="headerlink" title="åœ¨ä¸»é¢˜ä¸­å¼€å¯mathjaxå¼€å…³"></a>åœ¨ä¸»é¢˜ä¸­å¼€å¯mathjaxå¼€å…³</h4><p>å¦‚ä½•ä½¿ç”¨äº†ä¸»é¢˜äº†ï¼Œåˆ«å¿˜äº†åœ¨ä¸»é¢˜ï¼ˆThemeï¼‰ä¸­å¼€å¯mathjaxå¼€å…³ï¼Œä¸‹é¢ä»¥nextä¸»é¢˜ä¸ºä¾‹ï¼Œä»‹ç»ä¸‹å¦‚ä½•æ‰“å¼€mathjaxå¼€å…³ã€‚</p><p>è¿›å…¥åˆ°ä¸»é¢˜ç›®å½•ï¼Œæ‰¾åˆ°_config.ymlé…ç½®é—®é¢˜ï¼ŒæŠŠmathjaxé»˜è®¤çš„falseä¿®æ”¹ä¸ºtrueï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># MathJax Support</span>mathjax:  enable: <span class="token boolean">true</span>  per_page: <span class="token boolean">true</span></code></pre><p>åˆ«ç€æ€¥ï¼Œè¿™æ ·è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦åœ¨æ–‡ç« çš„Front-matteré‡Œæ‰“å¼€mathjaxå¼€å…³ï¼Œå¦‚ä¸‹ï¼š</p><pre class=" language-css"><code class="language-css"><span class="token property">title</span><span class="token punctuation">:</span> index<span class="token number">.</span>html<span class="token property">date</span><span class="token punctuation">:</span> <span class="token number">2016</span>-<span class="token number">12</span>-<span class="token number">28</span> <span class="token property">21</span><span class="token punctuation">:</span><span class="token property">01</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token property">tags</span><span class="token punctuation">:</span><span class="token property">mathjax</span><span class="token punctuation">:</span> true</code></pre><p>ä¸è¦å«Œéº»çƒ¦ï¼Œä¹‹æ‰€ä»¥è¦åœ¨æ–‡ç« å¤´é‡Œè®¾ç½®å¼€å…³ï¼Œæ˜¯å› ä¸ºè€ƒè™‘åªæœ‰åœ¨ç”¨åˆ°å…¬å¼çš„é¡µé¢æ‰åŠ è½½ Mathjaxï¼Œè¿™æ ·ä¸éœ€è¦æ¸²æŸ“æ•°å­¦å…¬å¼çš„é¡µé¢çš„è®¿é—®é€Ÿåº¦å°±ä¸ä¼šå—åˆ°å½±å“äº†</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é™æ€å»ºç«™ </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
