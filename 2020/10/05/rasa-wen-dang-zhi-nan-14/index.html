<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Rasa文档指南(14), 呆小症日记">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Rasa文档指南(14) | 呆小症日记</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="呆小症日记" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">呆小症日记</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">呆小症日记</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/9.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Rasa文档指南(14)</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Rasa/">
                                <span class="chip bg-color">Rasa</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/nlp/" class="post-category">
                                nlp
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-10-05
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Rasa核心对话引擎"><a href="#Rasa核心对话引擎" class="headerlink" title="Rasa核心对话引擎"></a>Rasa核心对话引擎</h1><h1 id="stories"><a href="#stories" class="headerlink" title="stories"></a>stories</h1><ul>
<li><a href="#">格式</a><ul>
<li><a href="#">stories是由什么组成的？</a></li>
<li><a href="#">用户留言</a></li>
<li><a href="#">动作</a></li>
<li><a href="#">大事件</a><ul>
<li><a href="#">slot事件</a></li>
<li><a href="#">表单事件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#">checkpoints和or_statements</a><ul>
<li><a href="#">checkpoints</a></li>
<li><a href="#">statements</a></li>
</ul>
</li>
<li><a href="#">端到端story评估格式</a></li>
</ul>
<p>Rasa story是一种用于训练Rasa对话管理模型的训练数据。</p>
<p>story是用户与AI助手之间对话的表示，已转换为特定格式，其中用户输入表示为相应的意图（必要时包括实体），而助手的响应表示为相应的动作名称。</p>
<p>Rasa Core对话系统的训练示例称为<strong>story</strong>。这是story数据格式的指南。</p>
<blockquote>
<p>注意</p>
<p>您还可以<strong>将story分布在多个文件中，</strong>并为大多数脚本（例如，培训，可视化）指定包含文件的文件夹。这些story将被视为一个大文件的一部分。</p>
</blockquote>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>这是Rasa story格式的对话示例：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> greet + location/price + cuisine + num people    </span><span class="token comment" spellcheck="true">&lt;!-- name of the story - just for debugging --></span>
<span class="token list punctuation">*</span> greet
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>howcanhelp
<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"location": "rome", "price": "cheap"<span class="token entity" title="&#125;">&amp;#125;</span>  <span class="token comment" spellcheck="true">&lt;!-- user utterance, in format intent&amp;#123;entities&amp;#125; --></span>
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>on<span class="token punctuation">_</span></span>it
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine
<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"cuisine": "spanish"<span class="token entity" title="&#125;">&amp;#125;</span>
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>numpeople        <span class="token comment" spellcheck="true">&lt;!-- action that the bot should execute --></span>
<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "six"<span class="token entity" title="&#125;">&amp;#125;</span>
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ack<span class="token punctuation">_</span></span>dosearch</code></pre>
<h3 id="story"><a href="#story" class="headerlink" title="story"></a>story</h3><ul>
<li>story以一个名字开头，后面带有两个哈希。您可以根据自己的喜好来命名该story，但是对于调试来说，为它们指定描述性名称可能非常有用！<code>## story_03248462</code></li>
<li>story的结尾用换行符表示，然后新的story再次以开头<code>##</code>。</li>
<li>用户发送的消息<code>*</code> 以格式开头以行开头。<code>intent{"entity1": "value", "entity2": "value"}</code></li>
<li>机器人执行的动作以以开头的行显示，<code>-</code> 并包含动作的名称。</li>
<li>动作返回的事件在该动作之后立即在线。例如，如果一个操作返回一个<code>SlotSet</code>事件，则显示为 。<code>slot{"slot_name": "value"}</code></li>
</ul>
<h3 id="用户消息"><a href="#用户消息" class="headerlink" title="用户消息"></a>用户消息</h3><p>在编写story时，您不必处理用户发送的消息的特定内容。相反，您可以利用NLU管道的输出，该输出使您可以仅使用意图和实体的组合来引用用户可以发送的所有可能的消息，表示同一件事。</p>
<p>在此处也包含实体也很重要，因为策略会根据意图和实体的<em>组合</em>来学习预测下一个动作（但是，您可以使用<a href="#">use_entities</a>属性更改此行为 ）。</p>
<blockquote>
<p>警告</p>
<p><code>/</code>符号保留为分隔符，用于将检索意图与响应文本标识符分开。有关此格式的更多详细信息，请参阅“<a href="#">检索操作”</a>部分。如果任何意图名称包含分隔符，则包含这些stories的文件将被视为<a href="#">ResponseSelector</a>模型的训练文件，而对于Core模型的训练将被忽略。`Training Data Format</p>
</blockquote>
<h3 id="动作"><a href="#动作" class="headerlink" title="动作"></a>动作</h3><p>在编写stories时，您会遇到两种类型的动作：发声动作和自定义动作。话语操作是机器人可以响应的硬编码消息。另一方面，自定义操作涉及正在执行的自定义代码。</p>
<p>机器人执行的所有动作（话语动作和自定义动作）均以行开头，<code>-</code>后跟动作名称。</p>
<p>语音操作的响应必须以前缀开头<code>utter_</code>，并且必须与域中定义的响应名称匹配。</p>
<p>对于自定义操作，操作名称是您选择从<code>name</code>自定义操作类的方法返回的字符串。尽管对自定义动作（与话语动作不同）进行命名没有限制，但是最佳做法是在名称前加上<code>action_</code>。</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>诸如设置槽位或激活/取消激活表格之类的事件必须作为stories的一部分明确地写出。当自定义动作已经成为stories的一部分时，必须单独包含自定义动作返回的事件，这似乎是多余的。但是，由于Rasa在训练期间无法确定这一事实，因此此步骤是必需的。</p>
<p>您可以<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/api/events/#events">在此处</a>阅读有关事件的更多信息。</p>
<h4 id="slot事件"><a href="#slot事件" class="headerlink" title="slot事件"></a>slot事件</h4><p>广告位事件记为。如果在自定义动作中设置了该插槽，则会在自定义动作事件之后立即将其写入行中。如果您的自定义操作将广告位值重置为“无”，则对应的事件将是。<code>- slot{"slot_name": "value"}``-slot{"slot_name": null}</code></p>
<h4 id="表单事件"><a href="#表单事件" class="headerlink" title="表单事件"></a>表单事件</h4><p>处理stories中的表单时，需要牢记三种事件。</p>
<ul>
<li>表单动作事件（例如）在第一次启动表单时就开始使用，并且在表单已经处于活动状态时又继续使用表单动作。<code>- restaurant_form</code></li>
<li>在第一个表单操作事件之后立即使用表单激活事件（例如）。<code>- form{"name": "restaurant_form"}</code></li>
<li>表单停用事件（例如），用于停用表单。<code>- form{"name": null}</code></li>
</ul>
<blockquote>
<p>注意</p>
<p>为了解决忘记添加事件的陷阱，建议编写这些故事的方法是使用<a href="#">交互式学习</a>。</p>
</blockquote>
<h3 id="checkpoints和OR-statements"><a href="#checkpoints和OR-statements" class="headerlink" title="checkpoints和OR statements"></a>checkpoints和OR statements</h3><p>如果有检查点和OR语句，都应谨慎使用。通常，有更好的方法可以通过使用表单和/或检索操作来实现所需的功能。</p>
<h4 id="checkpoints"><a href="#checkpoints" class="headerlink" title="checkpoints"></a>checkpoints</h4><p>您可以用来模块化和简化您的训练数据。检查点可能有用，但<strong>不要过度使用它们</strong>。使用大量检查点可以迅速使您的示例故事难以理解。如果经常在不同的故事中重复执行故事块，则使用它们很有意义，但是<em>没有</em>检查点的故事更易于阅读和编写。这是一个包含检查点的示例故事文件（请注意，您一次可以附加多个检查点）：<code>&gt; checkpoints</code></p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> first story</span>
<span class="token list punctuation">*</span> greet
   <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>user_question
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question

<span class="token title important"><span class="token punctuation">##</span> user affirms question</span>
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question
<span class="token list punctuation">*</span> affirm
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation

<span class="token title important"><span class="token punctuation">##</span> user denies question</span>
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>asked<span class="token punctuation">_</span></span>question
<span class="token list punctuation">*</span> deny
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>denial
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial

<span class="token title important"><span class="token punctuation">##</span> user leaves</span>
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>denial
<span class="token blockquote punctuation">></span> check<span class="token italic"><span class="token punctuation">_</span>handled<span class="token punctuation">_</span></span>affirmation
<span class="token list punctuation">*</span> goodbye
  <span class="token list punctuation">-</span> utter_goodbye</code></pre>
<blockquote>
<p>注意</p>
<p>与常规故事不同，检查点不限于从用户输入开始。只要在主要故事中的正确位置插入检查点，第一个事件就可以是自定义动作或响应动作。</p>
</blockquote>
<h4 id="OR-Statements"><a href="#OR-Statements" class="headerlink" title="OR Statements"></a>OR Statements</h4><p>编写简短故事或以相同方式处理多个意图的另一种方法是使用<code>OR</code>语句。例如，如果您要求用户确认某件事，并且您想以相同的方式对待<code>affirm</code> 和<code>thankyou</code>意图。以下故事将在培训时转换为两个故事：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> story</span>
...
  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>confirm
<span class="token list punctuation">*</span> affirm OR thankyou
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>handle<span class="token punctuation">_</span></span>affirmation</code></pre>
<p>就像检查点一样，<code>OR</code>语句可能会很有用，但是如果您使用了很多检查点，则重组域和/或意图可能会更好。</p>
<blockquote>
<p>警告</p>
<p>过度使用这些功能（checkpoints和OR statements）会减慢训练速度。</p>
</blockquote>
<h3 id="端到端stories评估格式"><a href="#端到端stories评估格式" class="headerlink" title="端到端stories评估格式"></a>端到端stories评估格式</h3><p>端到端故事格式是一种将NLU和Core培训数据都合并到一个文件中以进行评估的格式。阅读有关<a href="#">测试助手的</a>更多信息</p>
<blockquote>
<p>警告</p>
<p>此格式仅用于端到端评估，而不能用于训练。</p>
</blockquote>
<h2 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h2><p>该<code>Domain</code>定义了你的助手工作的宇宙。它规定了<code>intents</code>，<code>entities</code>，<code>slots</code>和<code>actions</code> 你的机器人应该知道。（可选）它还可以包含<code>responses</code> 机器人可以说的内容。</p>
<ul>
<li><a href="#">Domain的示例</a></li>
<li><a href="#">自定义动作和slot</a></li>
<li><a href="#">响应</a></li>
<li><a href="#">图像和按钮</a></li>
<li><a href="#">自定义输出有效负载</a></li>
<li><a href="#">特定通道的响应</a></li>
<li><a href="#">因素</a></li>
<li><a href="#">变体</a></li>
<li><a href="#">忽略某些意图实体</a></li>
<li><a href="#">会话配置</a></li>
</ul>
<h3 id="domain例子"><a href="#domain例子" class="headerlink" title="domain例子"></a>domain例子</h3><p>例如，由创建的域具有以下yaml定义：<code>rasa init</code></p>
<pre class=" language-markdown"><code class="language-markdown">intents:
  <span class="token list punctuation">-</span> greet
  <span class="token list punctuation">-</span> goodbye
  <span class="token list punctuation">-</span> affirm
  <span class="token list punctuation">-</span> deny
  <span class="token list punctuation">-</span> mood_great
  <span class="token list punctuation">-</span> mood_unhappy
  <span class="token list punctuation">-</span> bot_challenge

responses:
  utter_greet:
  <span class="token list punctuation">-</span> text: "Hey! How are you?"

  utter<span class="token italic"><span class="token punctuation">_</span>cheer<span class="token punctuation">_</span></span>up:
  <span class="token list punctuation">-</span> text: "Here is something to cheer you up:"
<span class="token code keyword">    image: "https://i.imgur.com/nGF1K8f.jpg"</span>

  utter<span class="token italic"><span class="token punctuation">_</span>did<span class="token punctuation">_</span></span>that_help:
  <span class="token list punctuation">-</span> text: "Did that help you?"

  utter_happy:
  <span class="token list punctuation">-</span> text: "Great, carry on!"

  utter_goodbye:
  <span class="token list punctuation">-</span> text: "Bye"

  utter_iamabot:
  <span class="token list punctuation">-</span> text: "I am a bot, powered by Rasa."

session<span class="token italic"><span class="token punctuation">_</span>config:
  session<span class="token punctuation">_</span></span>expiration<span class="token italic"><span class="token punctuation">_</span>time: 60
  carry<span class="token punctuation">_</span></span>over<span class="token italic"><span class="token punctuation">_</span>slots<span class="token punctuation">_</span></span>to<span class="token italic"><span class="token punctuation">_</span>new<span class="token punctuation">_</span></span>session: true</code></pre>
<p><strong>这是什么意思？</strong></p>
<p>您的NLU模型将定义<code>intents</code>和<code>entities</code>，您需要将其包括在域中。本<code>entities</code>节列出了您的NLU管道中任何<a href="#">实体提取器</a>提取的所有<a href="#">实体</a>。</p>
<p>例如：</p>
<pre class=" language-markdown"><code class="language-markdown">entities:
   <span class="token list punctuation">-</span> PERSON          # entity extracted by SpacyEntityExtractor
   <span class="token list punctuation">-</span> time            # entity extracted by DucklingHTTPExtractor
   <span class="token list punctuation">-</span> membership_type # custom entity extracted by CRFEntityExtractor
   <span class="token list punctuation">-</span> priority        # custom entity extracted by CRFEntityExtractor</code></pre>
<p><a href="#">slot中包含</a>您要在对话期间跟踪的信息。称为类别slot的<code>risk_level</code>定义如下：</p>
<pre class=" language-markdown"><code class="language-markdown">slots:
   risk_level:
<span class="token code keyword">      type: categorical</span>
<span class="token code keyword">      values:</span>
<span class="token code keyword">      - low</span>
<span class="token code keyword">      - medium</span>
<span class="token code keyword">      - high</span></code></pre>
<p><a href="#">在这里，</a>您可以找到Rasa Core定义的插槽类型的完整列表，以及将其包含在域文件中的语法。</p>
<p><a href="#">动作</a>是您的机器人实际上可以做的事情。例如，一个动作可以：</p>
<ul>
<li>回应用户</li>
<li>进行外部API调用，</li>
<li>查询数据库，或</li>
<li>几乎任何东西！</li>
</ul>
<h3 id="自定义动作和槽位"><a href="#自定义动作和槽位" class="headerlink" title="自定义动作和槽位"></a>自定义动作和槽位</h3><p>要引用您域中的插槽，您需要按其<strong>模块路径</strong>对其进行引用。要引用自定义操作，请使用其<strong>名称</strong>。举例来说，如果你有一个名为模块<code>my_actions</code>包含一个类<code>MyAwesomeAction</code>和模块<code>my_slots</code>包含 <code>MyAwesomeSlot</code>，将添加这些行到域文件：</p>
<pre class=" language-markdown"><code class="language-markdown">actions:
  <span class="token list punctuation">-</span> my<span class="token italic"><span class="token punctuation">_</span>custom<span class="token punctuation">_</span></span>action
  ...

slots:
  <span class="token list punctuation">-</span> my_slots.MyAwesomeSlot</code></pre>
<p>在此示例<code>name</code>中<code>MyAwesomeAction</code>需要返回 的功能<code>my_custom_action</code>（有关更多详细信息，请参见<a href="#">Custom Actions</a>）。</p>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>响应是机器人将发回给用户的消息。有两种使用这些响应的方法：</p>
<ol>
<li><p>如果响应的名称以开头<code>utter_</code>，则该响应可以直接用作操作。您可以将响应添加到域中：</p>
<pre class=" language-markdown"><code class="language-markdown">responses:
  utter_greet:
  <span class="token list punctuation">-</span> text: "Hey! How are you?"</code></pre>
<p>之后，您可以将响应用作故事中的动作：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> greet the user</span>
<span class="token list punctuation">*</span> intent_greet
  <span class="token list punctuation">-</span> utter_greet</code></pre>
<p>当<code>utter_greet</code>作为操作运行时，它将把响应中的消息发送回用户。</p>
</li>
<li><p>您可以使用响应，使用调度程序从您的自定义操作生成响应消息： <code>dispatcher.utter_message(template="utter_greet")</code>。这使您可以从实际副本中分离出生成消息的逻辑。在您的自定义操作代码中，您可以根据以下响应发送消息：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>actions <span class="token keyword">import</span> Action

<span class="token keyword">class</span> <span class="token class-name">ActionGreet</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token string">'action_greet'</span>

  <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>
      dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_greet"</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
</li>
</ol>
<h3 id="图像和按钮"><a href="#图像和按钮" class="headerlink" title="图像和按钮"></a>图像和按钮</h3><p>Domain的yaml文件中定义的响应也可以包含图像和按钮：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">responses</span><span class="token punctuation">:</span>
  <span class="token key atrule">utter_greet</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Hey! How are you?"</span>
    <span class="token key atrule">buttons</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"great"</span>
      <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token string">"great"</span>
    <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"super sad"</span>
      <span class="token key atrule">payload</span><span class="token punctuation">:</span> <span class="token string">"super sad"</span>
  <span class="token key atrule">utter_cheer_up</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Here is something to cheer you up:"</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"https://i.imgur.com/nGF1K8f.jpg"</span></code></pre>
<blockquote>
<p>注意</p>
<p>请记住，如何显示定义的按钮取决于输出通道的实现。例如，命令行无法显示按钮或图像，而是尝试通过打印选项来模仿它们。</p>
</blockquote>
<h3 id="自定义输出有效载荷"><a href="#自定义输出有效载荷" class="headerlink" title="自定义输出有效载荷"></a>自定义输出有效载荷</h3><p>您也可以使用<code>custom:</code>键将任意输出发送到输出通道 。请注意，由于域为yaml格式，因此json有效负载应首先转换为yaml格式。</p>
<p>例如，尽管日期选择器不是响应中定义的参数，因为大多数渠道不支持它们，但是可以像这样发送Slack日期选择器：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">responses</span><span class="token punctuation">:</span>
  <span class="token key atrule">utter_take_bet</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">custom</span><span class="token punctuation">:</span>
      <span class="token key atrule">blocks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> section
        <span class="token key atrule">text</span><span class="token punctuation">:</span>
          <span class="token key atrule">text</span><span class="token punctuation">:</span> <span class="token string">"Make a bet on when the world will end:"</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> mrkdwn
        <span class="token key atrule">accessory</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> datepicker
          <span class="token key atrule">initial_date</span><span class="token punctuation">:</span> <span class="token string">'2019-05-21'</span>
          <span class="token key atrule">placeholder</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> plain_text
            <span class="token key atrule">text</span><span class="token punctuation">:</span> Select a date</code></pre>
<h3 id="通道特异性应答"><a href="#通道特异性应答" class="headerlink" title="通道特异性应答"></a>通道特异性应答</h3><p>对于每个响应，您可以有多个<strong>响应模板</strong>（请参阅<a href="#">变体</a>）。如果您有某些仅希望发送到特定频道的响应模板，则可以使用<code>channel:</code>键指定此模板。该值应与<code>name()</code>通道<code>OutputChannel</code> 类的方法中定义的名称匹配。如果创建仅在某些通道中起作用的自定义输出有效负载，则特定于通道的响应特别有用。</p>
<pre class=" language-markdown"><code class="language-markdown">responses:
  utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>game:
  <span class="token list punctuation">-</span> text: "Which game would you like to play?"
<span class="token code keyword">    channel: "slack"</span>
<span class="token code keyword">    custom:</span>
<span class="token code keyword">      - # payload for Slack dropdown menu to choose a game</span>
  <span class="token list punctuation">-</span> text: "Which game would you like to play?"
<span class="token code keyword">    buttons:</span>
<span class="token code keyword">    - title: "Chess"</span>
<span class="token code keyword">      payload: '/inform&amp;#123;"game": "chess"&amp;#125;'</span>
<span class="token code keyword">    - title: "Checkers"</span>
<span class="token code keyword">      payload: '/inform&amp;#123;"game": "checkers"&amp;#125;'</span>
<span class="token code keyword">    - title: "Fortnite"</span>
<span class="token code keyword">      payload: '/inform&amp;#123;"game": "fortnite"&amp;#125;'</span></code></pre>
<p>每次您的漫游器寻找响应时，它将首先检查以查看所连接通道是否有任何特定于通道的响应模板。如果有，它将<strong>仅从</strong>这些响应模板中进行选择。如果未找到特定于通道的响应模板，它将从任何未定义的响应模板中进行选择<code>channel</code>。因此，优良作法是始终为每个未<code>channel</code>指定的响应至少拥有一个响应模板，以便您的机器人可以在所有环境中做出响应，包括在Shell和交互式学习中。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a><a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/domains/#id9">变量</a></h2><p>您还可以在响应中使用<strong>变量</strong>来插入对话期间收集的信息。您可以在自定义python代码中执行此操作，也可以使用自动插槽填充机制执行此操作。例如，如果您有这样的答复：</p>
<pre><code>responses:
  utter_greet:
  - text: "Hey, &amp;#123;name&amp;#125;. How are you?"</code></pre>
<p>Rasa会自动使用在名为的插槽中找到的值填充该变量 <code>name</code>。</p>
<p>在自定义代码中，可以使用以下方法检索响应：</p>
<pre><code>class ActionCustom(Action):
   def name(self):
      return "action_custom"

   def run(self, dispatcher, tracker, domain):
      # send utter default response to user
      dispatcher.utter_message(template="utter_default")
      # ... other code
      return []</code></pre>
<p>如果响应包含用表示的变量，则<code>{my_variable}</code> 可以通过将它们作为关键字参数传递给来提供字段的值<code>utter_message</code>：</p>
<pre><code>dispatcher.utter_message(template="utter_greet", my_variable="my text")</code></pre>
<h3 id="变体"><a href="#变体" class="headerlink" title="变体"></a>变体</h3><p>如果要随机更改发送给用户的响应，则可以列出多个<strong>响应模板</strong>，Rasa会随机选择其中之一，例如：</p>
<pre class=" language-markdown"><code class="language-markdown">responses:
  utter_greeting:
  <span class="token list punctuation">-</span> text: "Hey, <span class="token entity" title="&#123;">&amp;#123;</span>name<span class="token entity" title="&#125;">&amp;#125;</span>. How are you?"
  <span class="token list punctuation">-</span> text: "Hey, <span class="token entity" title="&#123;">&amp;#123;</span>name<span class="token entity" title="&#125;">&amp;#125;</span>. How is your day going?"</code></pre>
<h3 id="忽略某些意图的实体"><a href="#忽略某些意图的实体" class="headerlink" title="忽略某些意图的实体"></a>忽略某些意图的实体</h3><p>如果希望某些意图忽略所有实体，则可以将参数添加到域文件中的意图中，如下所示：<code>use_entities: []</code></p>
<pre><code>intents:
  - greet:
      use_entities: []</code></pre>
<p>要忽略某些实体或明确地只考虑某些实体，可以使用以下语法：</p>
<pre><code>intents:
- greet:
    use_entities:
      - name
      - first_name
    ignore_entities:
      - location
      - age</code></pre>
<p>这意味着针对这些意图的排除实体将不具有功能，因此不会影响下一个动作预测。当您有意不在意要拾取的实体时，这很有用。如果您在没有此参数的情况下按常规列出您的意图，则实体将正常化。</p>
<blockquote>
<p>注意</p>
<p>如果您确实希望这些实体不影响动作预测，建议您使用相同的type名称制作广告位<code>unfeaturized</code>。</p>
</blockquote>
<h3 id="会话配置"><a href="#会话配置" class="headerlink" title="会话配置"></a>会话配置</h3><p>对话会话代表助手和用户之间的对话。会话会话可以通过三种方式开始：</p>
<blockquote>
<ol>
<li>用户开始与助手进行对话，</li>
<li>用户在一段可配置的不活动时间后发送第一条消息，或者</li>
<li>手动会话开始由<code>/session_start</code>意图消息触发。</li>
</ol>
</blockquote>
<p>您可以在<code>session_config</code>密钥下的域中定义闲置时间段，之后在该闲置时间段内触发新的会话会话。 <code>session_expiration_time</code>定义闲置时间（以分钟为单位），之后新会话将开始。<code>carry_over_slots_to_new_session</code>确定是否应将现有设置的时隙转入新会话。</p>
<p>默认会话配置如下所示：</p>
<pre class=" language-markdown"><code class="language-markdown">session<span class="token italic"><span class="token punctuation">_</span>config:
  session<span class="token punctuation">_</span></span>expiration<span class="token italic"><span class="token punctuation">_</span>time: 60  # value in minutes, 0 means infinitely long
  carry<span class="token punctuation">_</span></span>over<span class="token italic"><span class="token punctuation">_</span>slots<span class="token punctuation">_</span></span>to<span class="token italic"><span class="token punctuation">_</span>new<span class="token punctuation">_</span></span>session: true  # set to false to forget slots between sessions</code></pre>
<p>这意味着，如果用户在闲置60分钟后发送了他们的第一条消息，则会触发一个新的会话会话，并且所有现有的时隙都将被带入新的会话中。将值设置<code>session_expiration_time</code>为0意味着会话将不会结束（请注意，该<code>action_session_start</code>操作仍将在会话开始时触发）。</p>
<blockquote>
<p>注意</p>
<p>会话开始会触发默认操作<code>action_session_start</code>。它的默认实现将所有现有的插槽移到新会话中。请注意，所有对话均以开头<code>action_session_start</code>。覆盖此操作可以例如用于使用来自外部API调用的插槽初始化跟踪器，或使用漫游器消息开始对话。有关<a href="#">自定义会话开始操作</a>的文档 向您展示了如何执行此操作。</p>
</blockquote>
<h2 id="响应-1"><a href="#响应-1" class="headerlink" title="响应"></a>响应</h2><p>如果您希望助手响应用户消息，则需要管理这些响应。在您的机器人的训练数据中，您的故事中，您指定了机器人应该执行的动作。这些操作可以使用响应将消息发送回用户。</p>
<p>有三种方法可以管理这些响应：</p>
<ol>
<li>回复通常存储在您的域文件中，请参见<a href="#">此处</a></li>
<li>检索动作响应是训练数据的一部分，请参见<a href="#">此处</a></li>
<li>您还可以创建自定义NLG服务以生成响应，请参见<a href="#">此处</a></li>
</ol>
<h3 id="在域中包括响应"><a href="#在域中包括响应" class="headerlink" title="在域中包括响应"></a>在域中包括响应</h3><p>默认格式是将响应包含在域文件中。然后，该文件包含对所有自定义操作，可用实体，插槽和意图的引用。</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> all hashtags are comments :)</span>
intents:
 <span class="token list punctuation">-</span> greet
 <span class="token list punctuation">-</span> default
 <span class="token list punctuation">-</span> goodbye
 <span class="token list punctuation">-</span> affirm
 <span class="token list punctuation">-</span> thank_you
 <span class="token list punctuation">-</span> change<span class="token italic"><span class="token punctuation">_</span>bank<span class="token punctuation">_</span></span>details
 <span class="token list punctuation">-</span> simple
 <span class="token list punctuation">-</span> hello
 <span class="token list punctuation">-</span> why
 <span class="token list punctuation">-</span> next_intent

entities:
 <span class="token list punctuation">-</span> name

slots:
  name:
<span class="token code keyword">    type: text</span>

responses:
  utter_greet:
<span class="token code keyword">    - text: "hey there &amp;#123;name&amp;#125;!"  # &amp;#123;name&amp;#125; will be filled by slot (same name) or by custom action</span>
  utter_channel:
<span class="token code keyword">    - text: "this is a default channel"</span>
<span class="token code keyword">    - text: "you're talking to me on slack!"  # if you define channel-specific utterances, the bot will pick</span>
<span class="token code keyword">      channel: "slack"                        # from those when talking on that specific channel</span>
  utter_goodbye:
<span class="token code keyword">    - text: "goodbye 😢"   # multiple responses - bot will randomly pick one of them</span>
<span class="token code keyword">    - text: "bye bye 😢"</span>
  utter<span class="token italic"><span class="token punctuation">_</span>default:   # utterance sent by action<span class="token punctuation">_</span></span>default_fallback
<span class="token code keyword">    - text: "sorry, I didn't get that, can you rephrase it?"</span></code></pre>
<p>在此示例域文件中，该部分<code>responses</code>包含助手用于向用户发送消息的响应。</p>
<blockquote>
<p>注意</p>
<p>如果要更改文本或漫游器响应的任何其他部分，则需要重新培训助手，然后才能接受这些更改。</p>
</blockquote>
<blockquote>
<p>注意</p>
<p>故事中使用的响应应<code>stories</code> 在domain.yml文件的部分中列出。在此示例中，<code>utter_channel</code> 故事中未使用响应，因此该部分中未列出该响应。</p>
</blockquote>
<p>有关这些响应格式的更多详细信息，请参见有关域文件格式的文档：<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/domains/#domain-responses">Responses</a>。</p>
<h3 id="为机器人响应创建自己的NLG服务"><a href="#为机器人响应创建自己的NLG服务" class="headerlink" title="为机器人响应创建自己的NLG服务"></a>为机器人响应创建自己的NLG服务</h3><p>在某些工作流程中，仅对机器人进行再培训以更改文本副本可能不是最佳选择。因此，Core还允许您将响应生成外包并将其与对话学习区分开。</p>
<p>助手仍将学习预测动作并根据过去的对话对用户输入做出反应，但是助手发送回用户的响应是在Rasa Core之外生成的。</p>
<p>如果助手想向用户发送消息，它将通过<code>POST</code>请求调用外部HTTP服务器。要配置此端点，您需要创建一个<code>endpoints.yml</code>并将其传递给<code>run</code> 或<code>server</code>脚本。的内容<code>endpoints.yml</code>应为</p>
<pre class=" language-markdown"><code class="language-markdown">nlg:
  url: http://localhost:5055/nlg    # url of the nlg endpoint
  <span class="token title important"><span class="token punctuation">#</span> you can also specify additional parameters, if you need them:</span>
  <span class="token title important"><span class="token punctuation">#</span> headers:</span>
  <span class="token title important"><span class="token punctuation">#</span>   my-custom-header: value</span>
  <span class="token title important"><span class="token punctuation">#</span> token: "my_authentication_token"    # will be passed as a get parameter</span>
  <span class="token title important"><span class="token punctuation">#</span> basic_auth:</span>
  <span class="token title important"><span class="token punctuation">#</span>   username: user</span>
  <span class="token title important"><span class="token punctuation">#</span>   password: pass</span>
<span class="token title important"><span class="token punctuation">#</span> example of redis external tracker store config</span>
tracker<span class="token italic"><span class="token punctuation">_</span>store:
  type: redis
  url: localhost
  port: 6379
  db: 0
  password: password
  record<span class="token punctuation">_</span></span>exp: 30000
<span class="token title important"><span class="token punctuation">#</span> example of mongoDB external tracker store config</span>
<span class="token title important"><span class="token punctuation">#</span>tracker_store:</span>
  <span class="token title important"><span class="token punctuation">#</span>type: mongod</span>
  <span class="token title important"><span class="token punctuation">#</span>url: mongodb://localhost:27017</span>
  <span class="token title important"><span class="token punctuation">#</span>db: rasa</span>
  <span class="token title important"><span class="token punctuation">#</span>user: username</span>
  <span class="token title important"><span class="token punctuation">#</span>password: password</span></code></pre>
<p>然后在启动服务器时将<code>enable-api</code>标志传递给命令：<code>rasa run</code></p>
<pre class=" language-shell"><code class="language-shell">rasa run \
   --enable-api \
   -m examples/babi/models \
   --log-file out.log \
   --endpoints endpoints.yml</code></pre>
<p><code>POST</code>发送到端点的请求的主体将如下所示：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token property">"tracker"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"latest_message"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span><span class="token punctuation">,</span>
      <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
          <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>
      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token property">"sender_id"</span><span class="token operator">:</span> <span class="token string">"22ae96a6-85cd-11e8-b1c3-f40f241f6547"</span><span class="token punctuation">,</span>
    <span class="token property">"paused"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"latest_event_time"</span><span class="token operator">:</span> <span class="token number">1531397673.293572</span><span class="token punctuation">,</span>
    <span class="token property">"slots"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token null">null</span>
    &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token property">"events"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1531397673.291998</span><span class="token punctuation">,</span>
        <span class="token property">"event"</span><span class="token operator">:</span> <span class="token string">"action"</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"action_listen"</span>
      &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1531397673.293572</span><span class="token punctuation">,</span>
        <span class="token property">"parse_data"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span><span class="token punctuation">,</span>
          <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
              <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
              <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>
            &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>
          &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
          <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token property">"event"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
        <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"/greet"</span>
      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span>
  &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  <span class="token property">"arguments"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  <span class="token property">"template"</span><span class="token operator">:</span> <span class="token string">"utter_greet"</span><span class="token punctuation">,</span>
  <span class="token property">"channel"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"collector"</span>
  &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>然后，端点需要使用生成的响应进行响应：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"hey there"</span><span class="token punctuation">,</span>
    <span class="token property">"buttons"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"image"</span><span class="token operator">:</span> <span class="token null">null</span><span class="token punctuation">,</span>
    <span class="token property">"elements"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"attachments"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>然后，Rasa将使用此响应并将其发送回用户。</p>
<h2 id="主动通过外部事件与用户联系"><a href="#主动通过外部事件与用户联系" class="headerlink" title="主动通过外部事件与用户联系"></a>主动通过外部事件与用户联系</h2><p>您可能希望主动与用户联系，例如显示长时间运行的后台操作的输出或将外部事件通知给用户。要了解更多信息，请<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa/tree/master/examples/reminderbot/README.md">reminderbot</a>在莎例子目录或可考虑<a href="#">提醒和外部事件</a>。</p>
<h2 id="动作-1"><a href="#动作-1" class="headerlink" title="动作"></a>动作</h2><p>动作是您的机器人根据用户输入运行的东西。Rasa中有四种动作：</p>
<blockquote>
<ol>
<li><strong>话语操作</strong>：从开始<code>utter_</code>并向用户发送特定消息。</li>
<li><strong>检索动作</strong>：<code>respond_</code>以检索模型选择的消息开头并发送消息。</li>
<li><strong>自定义操作</strong>：运行任意代码并发送任意数量的消息（或不发送任何消息）。</li>
<li><strong>默认动作</strong>：例如<code>action_listen</code>，<code>action_restart</code>， <code>action_default_fallback</code>。</li>
</ol>
</blockquote>
<ul>
<li><a href="#">话语动作</a></li>
<li><a href="#">检索动作</a></li>
<li><a href="#">自定义动作</a><ul>
<li><a href="#">用Python编写的自定义动作</a></li>
</ul>
</li>
<li><a href="#">用其他代码执行动作</a></li>
<li><a href="#">默认动作</a></li>
</ul>
<h3 id="话语动作"><a href="#话语动作" class="headerlink" title="话语动作"></a>话语动作</h3><p>要定义语音操作（<code>ActionUtterTemplate</code>），请向以以下内容开头的域文件添加响应<code>utter_</code>：</p>
<pre><code>responses:
  utter_my_message:
    - "this is what I want my action to say!"</code></pre>
<p>通常用来开头发声动作的名称<code>utter_</code>。如果缺少此前缀，您仍然可以在自定义操作中使用响应，但是不能将响应直接预测为它自己的操作。有关更多详细信息，请参见<a href="#">响应</a>。</p>
<p>如果使用外部NLG服务，则无需在域中指定响应，但仍需要将话语名称添加到域的操作列表中。</p>
<h3 id="检索操作"><a href="#检索操作" class="headerlink" title="检索操作"></a>检索操作</h3><p>检索操作使处理诸如chitchat和FAQ之类的大量相似意图变得更加容易。请参阅<a href="#">检索操作</a>以了解更多信息。</p>
<h3 id="自定义动作"><a href="#自定义动作" class="headerlink" title="自定义动作"></a>自定义动作</h3><p>一个动作可以运行您想要的任何代码。自定义操作可以打开灯，将事件添加到日历，检查用户的银行余额，或者您可以想象的其他任何事情。</p>
<p>当预测到自定义操作时，Rasa会调用您可以指定的端点。该终结点应该是响应此调用，运行代码并有选择地返回信息以修改对话状态的Web服务器。</p>
<p>要指定，您的动作服务器使用<code>endpoints.yml</code>：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">action_endpoint</span><span class="token punctuation">:</span>
  <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"http://localhost:5055/webhook"</span></code></pre>
<p>并使用将其传递给脚本。<code>--endpoints endpoints.yml</code></p>
<p>您可以使用node.js，.NET，java或任何其他语言创建动作服务器，并在其中定义您的动作-但是我们提供了一个小型python SDK，可以使在那里的开发更加轻松。</p>
<blockquote>
<p>注意</p>
<p>Rasa使用票证锁定机制来确保来自相同对话ID的传入消息不会互相干扰，并且会以正确的顺序进行处理。如果您希望您的自定义操作需要60秒钟以上才能运行，请将<code>TICKET_LOCK_LIFETIME</code>环境变量设置为您的期望值。</p>
</blockquote>
<h4 id="用Python编写的自定义动作"><a href="#用Python编写的自定义动作" class="headerlink" title="用Python编写的自定义动作"></a>用Python编写的自定义动作</h4><p>对于用python编写的动作，我们有一个方便的<a href="#">Rasa SDK</a>，可为您启动该动作服务器。</p>
<h3 id="用其他代码执行动作"><a href="#用其他代码执行动作" class="headerlink" title="用其他代码执行动作"></a>用其他代码执行动作</h3><p>Rasa会将HTTP<code>POST</code>请求发送到您的服务器，其中包含有关要运行的操作的信息。此外，此请求将包含有关对话的所有信息。<a href="#">Action Server</a>显示了详细的API规范。</p>
<p>作为对来自Rasa的操作调用的响应，您可以修改跟踪器，例如通过设置插槽并将响应发送回用户。所有修改都是使用事件完成的。在<a href="#">Events</a>中有所有可能的事件类型的列表。</p>
<h3 id="默认动作"><a href="#默认动作" class="headerlink" title="默认动作"></a>默认动作</h3><p>可用的默认操作是：</p>
<table>
<thead>
<tr>
<th><code>action_listen</code></th>
<th>停止预测更多动作并等待用户输入。</th>
</tr>
</thead>
<tbody><tr>
<td><code>action_restart</code></td>
<td>重设整个对话。可以在对话期间通过输入<code>/restart</code> 是否在策略配置中包括<a href="#">映射策略</a>来触发。</td>
</tr>
<tr>
<td><code>action_session_start</code></td>
<td>开始一个新的对话会话。占用所有已设置的时段，标记新对话会话的开始并重新应用现有<code>SlotSet</code> 事件。<code>session_expiration_time</code>在域的“<a href="#">会话”配置中</a>的参数定义的不活动时间过后，将自动触发此操作 。可以在通话过程中通过输入手动触发<code>/session_start</code>。所有对话均以开头<code>action_session_start</code>。</td>
</tr>
<tr>
<td><code>action_default_fallback</code></td>
<td>撤消上一条用户消息（好像用户未发送该消息，并且漫游器未做出反应），并说出漫游器不理解的消息。请参阅<a href="#">后备操作</a>。</td>
</tr>
<tr>
<td><code>action_deactivate_form</code></td>
<td>停用活动表格并重置请求的插槽。另请参阅<a href="#">处理不愉快的道路</a>。</td>
</tr>
<tr>
<td><code>action_revert_fallback_events</code></td>
<td>还原在TwoStageFallbackPolicy期间发生的事件。请参阅<a href="#">后备操作</a>。</td>
</tr>
<tr>
<td><code>action_default_ask_affirmation</code></td>
<td>要求用户确认其意图。建议使用自定义操作覆盖此默认操作，以获取更有意义的提示。</td>
</tr>
<tr>
<td><code>action_default_ask_rephrase</code></td>
<td>要求用户重新表达自己的意图。</td>
</tr>
<tr>
<td><code>action_back</code></td>
<td>撤消上一条用户消息（好像用户未发送该消息，并且漫游器未做出反应）。可以在对话期间通过输入<code>/back</code>是否在策略配置中包含MappingPolicy来触发。</td>
</tr>
</tbody></table>
<p>可以覆盖所有默认操作。为此，请将操作名称添加到您域中的操作列表中：</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">actions</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> action_default_ask_affirmation</code></pre>
<p>然后，Rasa将调用您的操作终结点，并将其视为其他所有自定义操作。</p>
<h2 id="提醒和外部事件"><a href="#提醒和外部事件" class="headerlink" title="提醒和外部事件"></a>提醒和外部事件</h2><p>该<code>ReminderScheduled</code>事件和 <a href="#">trigger_intent端点</a>使您的助手可以在给定时间段内提醒您有关事物的信息，或响应外部事件（其他应用程序，传感器等）。您可以<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa/tree/master/examples/reminderbot/README.md">在此处</a>找到实现这些功能的完整示例助手 。</p>
<ul>
<li><a href="#">提醒事项</a><ul>
<li><a href="#">安排提醒</a></li>
<li><a href="#">取消提醒</a></li>
</ul>
</li>
<li><a href="#">外部活动</a><ul>
<li><a href="#">获取对话ID</a></li>
<li><a href="#">应对外部事件</a></li>
</ul>
</li>
</ul>
<h3 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h3><p>可能需要在一段时间后提醒您一些事情，而不是使用外部传感器。为此，Rasa提供了特殊事件<code>ReminderScheduled</code>和另一个事件<code>ReminderCancelled</code>，以取消安排提醒时间。</p>
<h3 id="计划提醒"><a href="#计划提醒" class="headerlink" title="计划提醒"></a>计划提醒</h3><p>假设您希望助手提醒您在5秒钟内打电话给朋友。（您可能需要更长的时间跨度，但是为了进行测试，将其设为5秒。）因此，我们<code>ask_remind_call</code>使用一些NLU数据定义了一个意图，</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:ask_remind_call</span>
<span class="token list punctuation">-</span> remind me to call <span class="token url">[Albert](name)</span>
<span class="token list punctuation">-</span> remind me to call <span class="token url">[Susan](name)</span>
<span class="token list punctuation">-</span> later I have to call <span class="token url">[Daksh](name)</span>
<span class="token list punctuation">-</span> later I have to call <span class="token url">[Anna](name)</span>
...</code></pre>
<p>并将此意图与新的自定义操作相关联<code>action_set_reminder</code>。我们可以通过提供培训故事（推荐给更复杂的助手）或使用<a href="#">Mapping Policy建立联系</a>。</p>
<p>自定义操作<code>action_set_reminder</code>应安排一个提醒，该提醒在5秒钟后触发<code>EXTERNAL_reminder</code>用户在其上一条消息中提供的所有实体的意图（类似于外部事件）：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionSetReminder</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Schedules a reminder, supplied with the last message's entities."""</span>

    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"action_set_reminder"</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>
        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>
        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span><span class="token string">"I will remind you in 5 seconds."</span><span class="token punctuation">)</span>

        date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        entities <span class="token operator">=</span> tracker<span class="token punctuation">.</span>latest_message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"entities"</span><span class="token punctuation">)</span>

        reminder <span class="token operator">=</span> ReminderScheduled<span class="token punctuation">(</span>
            <span class="token string">"EXTERNAL_reminder"</span><span class="token punctuation">,</span>
            trigger_date_time<span class="token operator">=</span>date<span class="token punctuation">,</span>
            entities<span class="token operator">=</span>entities<span class="token punctuation">,</span>
            name<span class="token operator">=</span><span class="token string">"my_reminder"</span><span class="token punctuation">,</span>
            kill_on_user_message<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span>reminder<span class="token punctuation">]</span></code></pre>
<p>请注意，这需要<code>datetime</code>和<code>rasa_sdk.events</code>软件包。</p>
<p>最后，我们定义另一个自定义动作<code>action_react_to_reminder</code>并将其链接到<code>EXTERNAL_reminder</code>意图：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">-</span> EXTERNAL<span class="token italic"><span class="token punctuation">_</span>reminder:
  triggers: action<span class="token punctuation">_</span></span>react<span class="token italic"><span class="token punctuation">_</span>to<span class="token punctuation">_</span></span>reminder</code></pre>
<p>其中，<code>action_react_to_reminder</code>为</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionReactToReminder</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Reminds the user to call someone."""</span>

    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"action_react_to_reminder"</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>
        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>
        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        name <span class="token operator">=</span> next<span class="token punctuation">(</span>tracker<span class="token punctuation">.</span>get_latest_entity_values<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"someone"</span><span class="token punctuation">)</span>
        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Remember to call &amp;#123;name&amp;#125;!"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>除了自定义操作，我们还可以使用简单的响应模板。但是在这里，我们要利用提醒可以携带实体的事实，并且我们可以在此自定义操作中处理实体。</p>
<blockquote>
<p>警告</p>
<p>每当您关闭Rasa服务器时，提醒都会被取消。</p>
</blockquote>
<blockquote>
<p>警告</p>
<p>当前提醒（Rasa 1.8）不适用于rasa shell。您必须使用<a href="#">正在运行的Rasa X服务器</a>来测试它们 。</p>
</blockquote>
<blockquote>
<p>注意</p>
<p>主动联系用户取决于渠道的能力，因此并非每个渠道都支持。如果您的频道不支持它，请考虑使用<a href="#">CallbackInput</a>频道将消息发送到<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Webhook">webhook</a>。</p>
</blockquote>
<h3 id="取消提醒"><a href="#取消提醒" class="headerlink" title="取消提醒"></a>取消提醒</h3><p>有时，用户可能想取消他之前已安排的提醒。向助手添加此功能的一种简单方法是创建一个意图，<code>ask_forget_reminders</code>然后让助手通过自定义操作（例如</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ForgetReminders</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Cancels all reminders."""</span>

    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"action_forget_reminders"</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Okay, I'll cancel all your reminders."</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Cancel all reminders</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>ReminderCancelled<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>
<p>在这里，<code>ReminderCancelled()</code>只需取消当前预定的所有提醒。或者，您可以提供一些参数来缩小要取消的提醒的类型。例如，</p>
<ul>
<li><code>ReminderCancelled(intent="greet")</code> 故意取消所有提醒 <code>greet</code></li>
<li><code>ReminderCancelled(entities={...})</code> 取消给定实体的所有提醒</li>
<li><code>ReminderCancelled("...")</code>取消<code>...</code>您在创建过程中提供的具有给定名称“ ”的唯一提醒</li>
</ul>
<h3 id="外部事件"><a href="#外部事件" class="headerlink" title="外部事件"></a>外部事件</h3><p>假设您要从其他设备发送消息以更改正在进行的对话的过程。例如，连接到Raspberry Pi的一些湿度传感器应通知您的私人助理您最喜欢的植物需要浇水，然后您的助理应将此消息转发给您。</p>
<p>为此，您的Raspberry Pi需要向对话的<a href="#">trigger_intent端点</a>发送一条消息。顾名思义，这将用户意图（可能与实体）注入到您的对话中。因此，对于Rasa来说，几乎就像您输入的消息一样，根据此意图和这些实体进行了分类。然后，Rasa需要使用诸如的操作来响应此输入<code>action_warn_dry</code>。将此操作与意图联系起来的最简单，最可靠的方法是通过“<a href="#">映射策略”</a>。</p>
<h3 id="获取会话"><a href="#获取会话" class="headerlink" title="获取会话"></a>获取会话</h3><p>我们需要的第一件事是传感器应向其发送通知的会话的会话ID。一种简单的方法是定义一个自定义动作（请参阅<a href="#">Custom Actions</a>），该<a href="#">动作</a>在对话中显示ID。例如：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionTellID</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Informs the user about the conversation ID."""</span>

    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"action_tell_id"</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span> domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        conversation_id <span class="token operator">=</span> tracker<span class="token punctuation">.</span>sender_id

        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>
            f<span class="token string">"The ID of this conversation is: "</span> f<span class="token string">"&amp;#123;conversation_id&amp;#125;."</span>
        <span class="token punctuation">)</span>

        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>
            f<span class="token string">"Trigger an intent with "</span>
            f<span class="token string">'curl -H "Content-Type: application/json" '</span>
            f<span class="token string">'-X POST -d \'&amp;#123;&amp;#123;"name": "EXTERNAL_dry_plant", '</span>
            f'<span class="token string">"entities"</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#123;"plant": "Orchid"&amp;#125;&amp;#125;&amp;#125;&amp;#125;\' '</span>
            f<span class="token string">"http://localhost:5005/conversations/&amp;#123;conversation_id&amp;#125;/"</span>
            f<span class="token string">"trigger_intent"</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>另外，我们还声明一个intent <code>ask_id</code>，为其定义一些NLU数据，并将两者<code>action_tell_id</code>和 添加<code>ask_id</code>到域文件中，在该文件中我们指定一个应触发另一个：</p>
<pre class=" language-markdown"><code class="language-markdown">intents:
  <span class="token list punctuation">-</span> ask_id:
<span class="token code keyword">    triggers: action_tell_id</span></code></pre>
<p>现在，当您询问“此对话的ID是什么？”时，助手将回答“该对话的ID为：38cc25d7e23e4dde800353751b7c2d3e”。</p>
<p>如果您希望助手自动链接到Raspberry Pi，则必须编写一个自定义操作，以在对话开始时通知Pi有关对话的ID（请参阅<a href="#">自定义会话开始操作</a>）。</p>
<h3 id="响应外部事件"><a href="#响应外部事件" class="headerlink" title="响应外部事件"></a>响应外部事件</h3><p>现在我们有了会话ID，我们需要准备助手，以便助手响应来自传感器的消息。为此，我们定义了一个<code>EXTERNAL_dry_plant</code>没有任何NLU数据的新意图。此意图稍后将由外部传感器触发。在这里，我们以意图名称开头，<code>EXTERNAL_</code>以表明这不是用户要说的，但是您可以随意命名该意图。</p>
<p>在域文件中，我们现在将意图<code>EXTERNAL_dry_plant</code>与另一个自定义操作<code>action_warn_dry</code>（例如，</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionWarnDry</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Informs the user that a plant needs water."""</span>

    <span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"action_warn_dry"</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>
        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>
        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        plant <span class="token operator">=</span> next<span class="token punctuation">(</span>tracker<span class="token punctuation">.</span>get_latest_entity_values<span class="token punctuation">(</span><span class="token string">"plant"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"someone"</span><span class="token punctuation">)</span>
        dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>f<span class="token string">"Your &amp;#123;plant&amp;#125; needs some water!"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>现在，当您与id进行对话时<code>38cc25d7e23e4dde800353751b7c2d3e</code>，然后运行</p>
<pre class=" language-shell"><code class="language-shell">curl -H "Content-Type: application/json" -X POST -d '&#123;"name": "EXTERNAL_dry_plant", "entities": &#123;"plant": "Orchid"&#125;&#125;' http://localhost:5005/conversations/38cc25d7e23e4dde800353751b7c2d3e/trigger_intent</code></pre>
<p>在终端上，您的助手会说：“您的兰花需要一些水！”。</p>
<h2 id="Policies"><a href="#Policies" class="headerlink" title="Policies"></a>Policies</h2><ul>
<li><a href="#">配置策略</a><ul>
<li><a href="%EF%BC%83">最大历史</a></li>
<li><a href="#">数据扩充</a></li>
</ul>
</li>
<li><a href="#">动作选择</a></li>
<li><a href="#">凯拉斯政策</a></li>
<li><a href="#">词向量策略</a></li>
<li><a href="#">TED策略</a></li>
<li><a href="#">映射策略</a></li>
<li><a href="#">记忆策略</a></li>
<li><a href="#">增强记忆策略</a></li>
<li><a href="#">回退策略</a></li>
<li><a href="#">两阶段回退策略</a></li>
<li><a href="#">表格策略</a></li>
</ul>
<h3 id="配置策略"><a href="#配置策略" class="headerlink" title="配置策略"></a>配置策略</h3><p>该<code>rasa.core.policies.Policy</code>班决定采取在谈话的每一步何种行动。</p>
<p>有多种策略可供选择，您可以在一个中包含多个策略<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/api/agent/#rasa.core.agent.Agent"><code>rasa.core.agent.Agent</code></a>。</p>
<blockquote>
<p>注意</p>
<p>默认情况下，代理在每条用户消息之后最多可以预测10个下一步操作。要更新此值，可以将环境变量<code>MAX_NUMBER_OF_PREDICTIONS</code> 设置为所需的最大预测数。</p>
</blockquote>
<p>项目的<code>config.yml</code>文件带有一个<code>policies</code>密钥，您可以使用该密钥来自定义助手使用的策略。在下面的示例中，最后两行显示了如何使用自定义策略类并将参数传递给它。</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: "KerasPolicy"
<span class="token code keyword">    featurizer:</span>
<span class="token code keyword">    - name: MaxHistoryTrackerFeaturizer</span>
<span class="token code keyword">      max_history: 5</span>
<span class="token code keyword">      state_featurizer:</span>
<span class="token code keyword">        - name: BinarySingleStateFeaturizer</span>
  <span class="token list punctuation">-</span> name: "MemoizationPolicy"
<span class="token code keyword">    max_history: 5</span>
  <span class="token list punctuation">-</span> name: "FallbackPolicy"
<span class="token code keyword">    nlu_threshold: 0.4</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_action_name: "my_fallback_action"</span>
  <span class="token list punctuation">-</span> name: "path.to.your.policy.class"
<span class="token code keyword">    arg1: "..."</span></code></pre>
<h4 id="最大历史"><a href="#最大历史" class="headerlink" title="最大历史"></a>最大历史</h4><p>Rasa核心策略的一个重要超参数是<code>max_history</code>。这可控制模型查看多少对话历史记录，以决定下一步应采取的行动。</p>
<p>您可以<code>max_history</code>通过将其传递到<code>Featurizer</code> 策略配置yaml文件中的策略来进行设置。</p>
<blockquote>
<p>注意</p>
<p>仅会<code>MaxHistoryTrackerFeaturizer</code>使用最长历史记录，而<code>FullDialogueTrackerFeaturizer</code>总是会查看完整的对话历史记录。有关详细信息，请参见<a href="#">会话</a>功能化。</p>
</blockquote>
<p>举例来说，假设您有一个<code>out_of_scope</code>描述离题用户消息的意图。如果您的机器人连续多次看到此意图，则可能要告诉用户您可以提供哪些帮助。因此您的故事可能如下所示：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope
   <span class="token list punctuation">-</span> utter_default
<span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope
   <span class="token list punctuation">-</span> utter_default
<span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope
   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>help<span class="token punctuation">_</span></span>message</code></pre>
<p>为了使Rasa Core学习这种模式，<code>max_history</code> 必须至少为4。</p>
<p>如果增加<code>max_history</code>，您的模型将变得更大，并且训练将花费更长的时间。如果您掌握一些将来可能会影响对话的信息，则应将其存储为插槽。插槽信息始终可用于每个功能块。</p>
<h4 id="数据扩充"><a href="#数据扩充" class="headerlink" title="数据扩充"></a>数据扩充</h4><p>训练模型时，默认情况下，Rasa Core将通过随机将故事文件中的故事粘合在一起来创建更长的故事。这是因为如果您有以下故事：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> thanks</span>
<span class="token list punctuation">*</span> thankyou
   <span class="token list punctuation">-</span> utter_youarewelcome

<span class="token title important"><span class="token punctuation">#</span> bye</span>
<span class="token list punctuation">*</span> goodbye
   <span class="token list punctuation">-</span> utter_goodbye</code></pre>
<p>实际上，您实际上想教自己的策略在不相关时<strong>忽略</strong>对话历史记录，而无论以前发生了什么，都只需以相同的动作进行响应即可。</p>
<p>您可以使用<code>--augmentation</code>标志更改此行为。允许您设置<code>augmentation_factor</code>。该<code>augmentation_factor</code>决定许多增强的故事是如何训练中的子采样。扩增后的故事在训练之前会进行二次抽样，因为它们的数量会很快变得非常大，我们希望对其进行限制。样本故事的数量是<code>augmentation_factor</code>x10。默认情况下，扩充设置为20，最多可生成200个扩充故事。</p>
<p><code>--augmentation 0</code>禁用所有增强行为。基于备忘录的策略不受扩充的影响（与无关<code>augmentation_factor</code>），并且会自动忽略所有扩充的故事。</p>
<h3 id="行动选择"><a href="#行动选择" class="headerlink" title="行动选择"></a>行动选择</h3><p>在任何时候，配置中定义的每个策略都会以一定的置信度预测下一个动作。有关每个策略如何做出决策的更多信息，请阅读下面的策略说明。然后，机器人的下一个动作由具有最高置信度的预测策略决定。</p>
<p>在两个策略以相同的置信度进行预测的情况下（例如，“备忘和映射策略”始终以0或1的置信度进行预测），将考虑策略的优先级。Rasa策略具有默认优先级，这些默认优先级被设置为确保平局时的预期结果。它们看起来像这样，数字越高优先级越高：</p>
<p>5， <code>FormPolicy</code></p>
<p>4.<code>FallbackPolicy</code>和<code>TwoStageFallbackPolicy</code></p>
<p>3.<code>MemoizationPolicy</code>和<code>AugmentedMemoizationPolicy</code></p>
<p>2。 <code>MappingPolicy</code></p>
<p>1.<code>TEDPolicy</code>，<code>EmbeddingPolicy</code>，<code>KerasPolicy</code>，和<code>SklearnPolicy</code></p>
<p>此优先级层次结构可确保，例如，如果有意图与映射的动作，但NLU置信度不在之上<code>nlu_threshold</code>，则该漫游器仍将回退。通常，不建议每个优先级使用一个以上的策略，并且某些优先级相同的策略（例如两个后备策略）严格不能一并使用。</p>
<p>如果您创建自己的策略，请使用这些优先级作为确定策略优先级的指南。如果您的策略是机器学习策略，则它很可能应该具有优先级1，与Rasa机器学习策略相同。</p>
<blockquote>
<p>警告</p>
<p>所有策略优先级都可以通过配置中的<code>priority:</code>参数进行配置，但是我们<strong>不建议</strong>在特定情况（例如自定义策略）之外更改它们。这样做可能会导致意想不到的机器人行为。</p>
</blockquote>
<h3 id="Keras政策"><a href="#Keras政策" class="headerlink" title="Keras政策"></a>Keras政策</h3><p>在<code>KerasPolicy</code>使用中实现的神经网络 <a target="_blank" rel="noopener" href="http://keras.io/">Keras</a>选择下一个动作。默认体系结构基于LSTM，但是您可以覆盖该 <code>KerasPolicy.model_architecture</code>方法以实现自己的体系结构。</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">model_architecture</span><span class="token punctuation">(</span>
    self<span class="token punctuation">,</span> input_shape<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> int<span class="token punctuation">]</span><span class="token punctuation">,</span> output_shape<span class="token punctuation">:</span> Tuple<span class="token punctuation">[</span>int<span class="token punctuation">,</span> Optional<span class="token punctuation">[</span>int<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>Sequential<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Build a keras model and return a compiled model."""</span>

    <span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
    <span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> <span class="token punctuation">(</span>
        Masking<span class="token punctuation">,</span>
        LSTM<span class="token punctuation">,</span>
        Dense<span class="token punctuation">,</span>
        TimeDistributed<span class="token punctuation">,</span>
        Activation<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># Build Model</span>
    model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># the shape of the y vector of the labels,</span>
    <span class="token comment" spellcheck="true"># determines which output from rnn will be used</span>
    <span class="token comment" spellcheck="true"># to calculate the loss</span>
    <span class="token keyword">if</span> len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># y is (num examples, num features) so</span>
        <span class="token comment" spellcheck="true"># only the last output from the rnn is used to</span>
        <span class="token comment" spellcheck="true"># calculate the loss</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Masking<span class="token punctuation">(</span>mask_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span>input_shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span>input_dim<span class="token operator">=</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> units<span class="token operator">=</span>output_shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># y is (num examples, max_dialogue_len, num features) so</span>
        <span class="token comment" spellcheck="true"># all the outputs from the rnn are used to</span>
        <span class="token comment" spellcheck="true"># calculate the loss, therefore a sequence is returned and</span>
        <span class="token comment" spellcheck="true"># time distributed layer is used</span>

        <span class="token comment" spellcheck="true"># the first value in input_shape is max dialogue_len,</span>
        <span class="token comment" spellcheck="true"># it is set to None, to allow dynamic_rnn creation</span>
        <span class="token comment" spellcheck="true"># during prediction</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Masking<span class="token punctuation">(</span>mask_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span> input_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rnn_size<span class="token punctuation">,</span> return_sequences<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>TimeDistributed<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span>units<span class="token operator">=</span>output_shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>
            <span class="token string">"Cannot construct the model because"</span>
            <span class="token string">"length of output_shape = &amp;#123;&amp;#125; "</span>
            <span class="token string">"should be 1 or 2."</span>
            <span class="token string">""</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>output_shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Activation<span class="token punctuation">(</span><span class="token string">"softmax"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>
        loss<span class="token operator">=</span><span class="token string">"categorical_crossentropy"</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span><span class="token string">"rmsprop"</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"accuracy"</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">if</span> common_utils<span class="token punctuation">.</span>obtain_verbosity<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model</code></pre>
<p>训练在这里进行：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>
    self<span class="token punctuation">,</span>
    training_trackers<span class="token punctuation">:</span> List<span class="token punctuation">[</span>DialogueStateTracker<span class="token punctuation">]</span><span class="token punctuation">,</span>
    domain<span class="token punctuation">:</span> Domain<span class="token punctuation">,</span>
    <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Any<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> None<span class="token punctuation">:</span>

    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>self<span class="token punctuation">.</span>random_seed<span class="token punctuation">)</span>
    tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>set_seed<span class="token punctuation">(</span>self<span class="token punctuation">.</span>random_seed<span class="token punctuation">)</span>

    training_data <span class="token operator">=</span> self<span class="token punctuation">.</span>featurize_for_training<span class="token punctuation">(</span>training_trackers<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># noinspection PyPep8Naming</span>
    shuffled_X<span class="token punctuation">,</span> shuffled_y <span class="token operator">=</span> training_data<span class="token punctuation">.</span>shuffled_X_y<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> self<span class="token punctuation">.</span>model <span class="token keyword">is</span> None<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> self<span class="token punctuation">.</span>model_architecture<span class="token punctuation">(</span>
            shuffled_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shuffled_y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>

    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>
        f<span class="token string">"Fitting model with &amp;#123;training_data.num_examples()&amp;#125; total samples and a "</span>
        f<span class="token string">"validation split of &amp;#123;self.validation_split&amp;#125;."</span>
    <span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># filter out kwargs that cannot be passed to fit</span>
    self<span class="token punctuation">.</span>_train_params <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_valid_params<span class="token punctuation">(</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>_train_params
    <span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>
        shuffled_X<span class="token punctuation">,</span>
        shuffled_y<span class="token punctuation">,</span>
        epochs<span class="token operator">=</span>self<span class="token punctuation">.</span>epochs<span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>
        shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        verbose<span class="token operator">=</span>common_utils<span class="token punctuation">.</span>obtain_verbosity<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">**</span>self<span class="token punctuation">.</span>_train_params<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>current_epoch <span class="token operator">=</span> self<span class="token punctuation">.</span>epochs

    logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">"Done fitting Keras Policy model."</span><span class="token punctuation">)</span></code></pre>
<p>您可以通过覆盖这些方法来实现您选择的模型，或者<code>KerasPolicy</code>使用pre-defined进行初始化。<code>keras model</code></p>
<p>为了获得相同输入的可重复训练结果，您可以将的<code>random_seed</code>属性设置<code>KerasPolicy</code>为任何整数。</p>
<h3 id="嵌入策略"><a href="#嵌入策略" class="headerlink" title="嵌入策略"></a>嵌入策略</h3><blockquote>
<p>警告</p>
<p><code>EmbeddingPolicy</code>已重命名为<code>TEDPolicy</code>。请使用<a href="#">TED策略，</a>而不要<code>EmbeddingPolicy</code> 在策略配置中使用。该策略的功能保持不变。</p>
</blockquote>
<h3 id="TED策略"><a href="#TED策略" class="headerlink" title="TED策略"></a>TED策略</h3><p>该变压器嵌入对话（TED）的政策是在描述 <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1910.00486">我们的论文</a>。</p>
<p>该策略具有预定义的体系结构，包括以下步骤：</p>
<blockquote>
<ul>
<li>将每个时间步骤的用户输入（用户意图和实体），先前的系统动作，时隙和活动形式连接到输入向量中，以传递给预变压器嵌入层；</li>
<li>馈入变压器；</li>
<li>在变压器的输出上施加一个密集层，以便在每个时间步长中嵌入对话；</li>
<li>在每个时间步骤应用密集层为系统操作创建嵌入；</li>
<li>计算对话嵌入和嵌入式系统动作之间的相似度。此步骤基于<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1709.03856">StarSpace的</a>想法。</li>
</ul>
</blockquote>
<p>建议使用<code>state_featurizer=LabelTokenizerSingleStateFeaturizer(...)</code> （有关详细信息，请参见<a href="#">对话</a>功能）。</p>
<p><strong>组态：</strong></p>
<p>可以将配置参数作为参数传递到<code>TEDPolicy</code>配置文件中。如果要调整模型，请首先修改以下参数：</p>
<ul>
<li><code>epochs</code>：此参数设置算法查看训练数据的次数（默认值：）<code>1</code>。一个<code>epoch</code>是等于一个直传和所有的训练例子之一向通行。有时，模型需要更多的时期才能正确学习。有时更多的时期不会影响性能。时期数越少，模型训练越快。</li>
<li><code>hidden_layers_sizes</code>：此参数允许您定义对话和意图的前馈层数及其输出尺寸（默认值：）。列表中的每个条目都对应一个前馈层。例如，如果设置，我们将在变压器前面添加两个前馈层。输入令牌的矢量（来自对话）将传递到这些层。第一层的输出尺寸为256，第二层的输出尺寸为128。如果使用空列表（默认行为），则不会添加前馈层。确保仅使用正整数。通常，使用2的幂数。同样，通常的做法是在列表中减小值：下一个值小于或等于前一个值。<code>dialogue: [], label: []  dialogue: [256, 128]</code></li>
<li><code>number_of_transformer_layers</code>：此参数设置要使用的变压器层数（默认值：）<code>1</code>。变压器层的数量与要用于模型的变压器块相对应。</li>
<li><code>transformer_size</code>：此参数设置变压器中的单位数（默认值：）<code>128</code>。从变压器出来的矢量将具有给定的<code>transformer_size</code>。</li>
<li><code>weight_sparsity</code>：此参数定义了模型中所有前馈层的内核权重的分数，将其设置为0（默认值：）<code>0.8</code>。该值应介于0和1之间。如果设置<code>weight_sparsity</code> 为0，则没有内核权重将设置为0，该层将充当标准前馈层。您不应将其设置<code>weight_sparsity</code>为1，因为这将导致所有内核权重均为0，即模型无法学习。</li>
</ul>
<blockquote>
<p>警告</p>
<p>将适当的数字（例如50）<code>epochs</code>传递给<code>TEDPolicy</code>，否则该策略将仅针对<code>1</code>时代进行训练。</p>
</blockquote>
<blockquote>
<p>警告</p>
<p><code>max_history</code>此政策的默认设置为<code>None</code>，它将使用 <code>FullDialogueTrackerFeaturizer</code>。我们建议将<code>max_history</code>值设置为一定的值，以便<code>MaxHistoryTrackerFeaturizer</code>用于<strong>更快的训练</strong>。有关详细信息，请参见<a href="#">会话</a>功能化。我们建议增加<code>batch_size</code>的<code>MaxHistoryTrackerFeaturizer</code> （例如）`”batch_size”: [32, 64]</p>
</blockquote>
<p>上面的配置参数是您应该配置的参数，以使模型适合数据。但是，存在可以调整的其他参数。</p>
<h3 id="映射策略"><a href="#映射策略" class="headerlink" title="映射策略"></a>映射策略</h3><p>该<code>MappingPolicy</code>可用于直接映射到意图动作。通过给意图赋予属性来分配映射<code>triggers</code>，例如：</p>
<pre class=" language-markdown"><code class="language-markdown">intents:
 <span class="token list punctuation">-</span> ask<span class="token italic"><span class="token punctuation">_</span>is<span class="token punctuation">_</span></span>bot:
<span class="token code keyword">     triggers: action_is_bot</span></code></pre>
<p>一个意图最多只能映射到一个动作。一旦机器人收到触发意图的消息，它将运行映射的动作。之后，它将监听下一条消息。随着下一条用户消息，将恢复正常预测。</p>
<p>如果您不希望意图动作映射影响对话历史记录，则映射动作必须返回一个<code>UserUtteranceReverted()</code> 事件。这将从对话历史记录中删除用户的最新消息及其后发生的任何事件。这意味着您不应在故事中包括意图-行动互动。</p>
<p>例如，如果用户问“您是机器人吗？” 在流程中间偏离主题的情况下，您可能想要回答而不会影响下一动作预测的交互作用。触发的自定义操作可以执行任何操作，但这是一个简单的示例，该示例调度机器人的话语，然后还原交互：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ActionIsBot</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">"""Revertible mapped action for utter_is_bot"""</span>

<span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"action_is_bot"</span>

<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dispatcher<span class="token punctuation">,</span> tracker<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dispatcher<span class="token punctuation">.</span>utter_template<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_is_bot"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>UserUtteranceReverted<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>
<blockquote>
<p>注意</p>
<p>如果您<code>MappingPolicy</code>直接使用（例如）来预测机器人说话的行为 ，则这些交互必须进入您的故事，因为在这种情况下，没有交互作用，并且意图和映射的响应动作将出现在对话历史记录中。<code>triggers: utter_{} UserUtteranceReverted()</code></p>
</blockquote>
<blockquote>
<p>注意</p>
<p>该MappingPolicy还负责执行默认操作<code>action_back</code> 和<code>action_restart</code>响应<code>/back</code>和<code>/restart</code>。如果您的策略示例中未包含此内容，则这些意图将无效。</p>
</blockquote>
<h3 id="记忆政策"><a href="#记忆政策" class="headerlink" title="记忆政策"></a>记忆政策</h3><p>在<code>MemoizationPolicy</code>刚刚记住在你的训练数据的谈话。它预测有信心下一个动作<code>1.0</code> ，如果在训练数据中存在这一确切的谈话，否则预测<code>None</code>充满信心<code>0.0</code>。</p>
<h3 id="增强记忆策略"><a href="#增强记忆策略" class="headerlink" title="增强记忆策略"></a>增强记忆策略</h3><p>该<code>AugmentedMemoizationPolicy</code>记得从训练的故事长达例子<code>max_history</code>转弯，就像<code>MemoizationPolicy</code>。此外，它具有遗忘机制，可以遗忘对话历史记录中的某些步骤，并尝试在历史减少的故事中找到匹配项。它预测有信心下一个动作<code>1.0</code> ，如果发现匹配，否则就预测<code>None</code>有信心<code>0.0</code>。</p>
<blockquote>
<p>注意</p>
<p>如果您在对话中无法在训练故事中设置在预测时间内设置的某些时段（例如，在以提醒开头的训练故事中，未设置所有先前的时段），请确保将没有插槽的相关故事添加到训练数据中也一样。</p>
</blockquote>
<h3 id="后备政策"><a href="#后备政策" class="headerlink" title="后备政策"></a>后备政策</h3><p>所述<code>FallbackPolicy</code>A调用<a href="#">回退操作</a>，如果发生以下情况中的至少一个：</p>
<ol>
<li>意图识别在下面有信心<code>nlu_threshold</code>。</li>
<li>排名最高的意图的置信度与排名第二的意图相差小于<code>ambiguity_threshold</code>。</li>
<li>没有一项对话政策能够预测采取高于信心的行动<code>core_threshold</code>。</li>
</ol>
<p><strong>组态：</strong></p>
<p>阈值和回退操作可以在策略配置文件中作为以下参数进行调整<code>FallbackPolicy</code>：</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: "FallbackPolicy"
<span class="token code keyword">    nlu_threshold: 0.3</span>
<span class="token code keyword">    ambiguity_threshold: 0.1</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_action_name: 'action_default_fallback'</span></code></pre>
<table>
<thead>
<tr>
<th><code>nlu_threshold</code></th>
<th>接受NLU预测所需的最低置信度</th>
</tr>
</thead>
<tbody><tr>
<td><code>ambiguity_threshold</code></td>
<td>最高意图的置信度必须超过第二高意图的置信度的最小数量。</td>
</tr>
<tr>
<td><code>core_threshold</code></td>
<td>接受Rasa Core的动作预测所需的最低置信度</td>
</tr>
<tr>
<td><code>fallback_action_name</code></td>
<td>如果意图或操作的置信度低于各自的阈值，则调用<a href="#">后备操作的</a>名称</td>
</tr>
</tbody></table>
<p>您还可以<code>FallbackPolicy</code>在python代码中配置：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>fallback <span class="token keyword">import</span> FallbackPolicy
<span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>policies<span class="token punctuation">.</span>keras_policy <span class="token keyword">import</span> KerasPolicy
<span class="token keyword">from</span> rasa<span class="token punctuation">.</span>core<span class="token punctuation">.</span>agent <span class="token keyword">import</span> Agent

fallback <span class="token operator">=</span> FallbackPolicy<span class="token punctuation">(</span>fallback_action_name<span class="token operator">=</span><span class="token string">"action_default_fallback"</span><span class="token punctuation">,</span>
                          core_threshold<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                          nlu_threshold<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
                          ambiguity_threshold<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

agent <span class="token operator">=</span> Agent<span class="token punctuation">(</span><span class="token string">"domain.yml"</span><span class="token punctuation">,</span> policies<span class="token operator">=</span><span class="token punctuation">[</span>KerasPolicy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fallback<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<blockquote>
<p>注意</p>
<p>您可以在配置中包含<code>FallbackPolicy</code>或 <code>TwoStageFallbackPolicy</code>，但不能同时包含两者。</p>
</blockquote>
<h3 id="两阶段回退策略"><a href="#两阶段回退策略" class="headerlink" title="两阶段回退策略"></a>两阶段回退策略</h3><p>该<code>TwoStageFallbackPolicy</code>手柄低NLU信心多个阶段，试图澄清对用户输入。</p>
<ul>
<li>如果NLU预测的置信度得分低或不明显高于排名第二的预测，则要求用户确认意图的分类。<ul>
<li>如果他们肯定了，那么故事将继续，就好像从一开始就对意图进行了高度自信的分类。</li>
<li>如果他们拒绝，则要求用户重新表达他们的消息。</li>
</ul>
</li>
<li>改写<ul>
<li>如果重新表达意图的分类是确定的，则故事将继续，就好像用户从一开始就具有此意图。</li>
<li>如果措辞的意图没有被高可信度分类，则要求用户确认分类的意图。</li>
</ul>
</li>
<li>第二次确认<ul>
<li>如果用户确认了此意图，则故事将继续，就像用户从一开始就具有此意图一样。</li>
<li>如果用户拒绝，则将原始意图分类为指定的 <code>deny_suggestion_intent_name</code>，并触发最终的后备操作（例如，移交给人类）。</li>
</ul>
</li>
</ul>
<p><strong>组态：</strong></p>
<p>要使用<code>TwoStageFallbackPolicy</code>，请在您的策略配置中包括以下内容。</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: TwoStageFallbackPolicy
<span class="token code keyword">    nlu_threshold: 0.3</span>
<span class="token code keyword">    ambiguity_threshold: 0.1</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_core_action_name: "action_default_fallback"</span>
<span class="token code keyword">    fallback_nlu_action_name: "action_default_fallback"</span>
<span class="token code keyword">    deny_suggestion_intent_name: "out_of_scope"</span></code></pre>
<table>
<thead>
<tr>
<th><code>nlu_threshold</code></th>
<th>接受NLU预测所需的最低置信度</th>
</tr>
</thead>
<tbody><tr>
<td><code>ambiguity_threshold</code></td>
<td>最高意图的置信度必须超过第二高意图的置信度的最小数量。</td>
</tr>
<tr>
<td><code>core_threshold</code></td>
<td>接受Rasa Core的动作预测所需的最低置信度</td>
</tr>
<tr>
<td><code>fallback_core_action_name</code></td>
<td>如果Rasa Core动作预测的可信度低于，则调用 的<a href="#">后备动作的</a>名称<code>core_threshold</code>。该行动是为了提出公认的意图</td>
</tr>
<tr>
<td><code>fallback_nlu_action_name</code></td>
<td>如果Rasa NLU意向分类的置信度低于，则调用 的<a href="#">后备操作的</a>名称<code>nlu_threshold</code>。用户第二次拒绝时调用此操作</td>
</tr>
<tr>
<td><code>deny_suggestion_intent_name</code></td>
<td>意向的名称，用于检测用户是否拒绝建议的意向</td>
</tr>
</tbody></table>
<blockquote>
<p>注意</p>
<p>您可以在配置中包含<code>FallbackPolicy</code>或 <code>TwoStageFallbackPolicy</code>，但不能同时包含两者。</p>
</blockquote>
<h3 id="表单策略"><a href="#表单策略" class="headerlink" title="表单策略"></a>表单策略</h3><p>的<code>FormPolicy</code>是的一个扩展<code>MemoizationPolicy</code>，其处理的形式填充。一旦<code>FormAction</code>被调用时， <code>FormPolicy</code>将不断预测<code>FormAction</code>，直到表格中的所有必需的槽分配。有关更多信息，请参见<a href="#">Forms</a>。</p>
<h2 id="槽位"><a href="#槽位" class="headerlink" title="槽位"></a>槽位</h2><ul>
<li><a href="#">什么是槽位？</a></li>
<li><a href="#">Rasa如何使用槽位</a></li>
<li><a href="#">槽位如何设置</a><ul>
<li><a href="#">从NLU设置的槽位</a></li>
<li><a href="#">点击按钮槽位设置</a></li>
<li><a href="#">动作设定的槽位</a></li>
</ul>
</li>
<li><a href="#">槽位类型</a><ul>
<li><a href="#">文字槽位</a></li>
<li><a href="#">布尔槽位</a></li>
<li><a href="#">分类槽位</a></li>
<li><a href="#">浮点槽位</a></li>
<li><a href="#">数组槽位</a></li>
<li><a href="#">Unfeaturized槽位</a></li>
</ul>
</li>
<li><a href="#">自定义广告位类型</a></li>
</ul>
<h3 id="什么是槽位？"><a href="#什么是槽位？" class="headerlink" title="什么是槽位？"></a>什么是槽位？</h3><p><strong>插槽是您的机器人的记忆。</strong>它们充当键值存储，可用于存储用户提供的信息（例如，他们的家乡城市）以及有关外界的信息（例如，数据库查询的结果）。</p>
<p>在大多数情况下，您希望广告位影响对话的进行方式。对于不同的行为，有不同的插槽类型。</p>
<p>例如，如果您的用户提供了他们的居住城市，则您可能有一个<code>text</code>名为的广告位<code>home_city</code>。如果用户要求天气，而您<em>不</em>知道他们的家乡，则必须向他们询问。一个<code>text</code>插槽只告诉莎核心的插槽是否具有价值。广告位的具体值<code>text</code>（例如班加罗尔，纽约或香港）没有任何区别。</p>
<p>如果该值本身很重要，请使用<code>categorical</code>或<code>bool</code>插槽。也有<code>float</code>和<code>list</code>插槽。如果您只想存储一些数据，但又不想影响对话的流程，请使用<code>unfeaturized</code>插槽。</p>
<h3 id="Rasa如何使用槽位"><a href="#Rasa如何使用槽位" class="headerlink" title="Rasa如何使用槽位"></a>Rasa如何使用槽位</h3><p>在<code>Policy</code>没有访问您的插槽的价值。它收到一个特征化的表示。如上所述，对于<code>text</code>插槽，该值无关紧要。该策略只会显示一个<code>1</code>或<code>0</code>取决于它是否设置。</p>
<p><strong>您应该仔细选择槽位类型！</strong></p>
<h4 id="槽位如何设置"><a href="#槽位如何设置" class="headerlink" title="槽位如何设置"></a>槽位如何设置</h4><p>您可以为域文件中的广告位提供初始值：</p>
<pre class=" language-markdown"><code class="language-markdown">slots:
  name:
<span class="token code keyword">    type: text</span>
<span class="token code keyword">    initial_value: "human"</span></code></pre>
<p>您可以使用<code>.get_slot()</code>inside<code>actions.py</code>获取插槽的值，例如：</p>
<pre class=" language-markdown"><code class="language-markdown">data = tracker.get_slot("slot-name")</code></pre>
<p>在对话期间可以使用多种方式设置广告位：</p>
<h4 id="NLU设置的槽位"><a href="#NLU设置的槽位" class="headerlink" title="NLU设置的槽位"></a>NLU设置的槽位</h4><p>如果您的NLU模型选择一个实体，并且您的域中包含一个具有相同名称的插槽，则该插槽将自动设置。例如：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> story_01</span>
<span class="token list punctuation">*</span> greet<span class="token entity" title="&#123;">&amp;#123;</span>"name": "Ali"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"name": "Ali"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> utter_greet</code></pre>
<p>在这种情况下，您不必在故事中包括该零件，因为它是自动拾取的。<code>- slot{}</code></p>
<p>要为特定插槽禁用此行为，可以在域文件中将<code>auto_fill</code>属性设置为 <code>False</code>：</p>
<pre class=" language-markdown"><code class="language-markdown">slots:
  name:
<span class="token code keyword">    type: text</span>
<span class="token code keyword">    auto_fill: False</span></code></pre>
<h4 id="点击按钮槽位设置"><a href="#点击按钮槽位设置" class="headerlink" title="点击按钮槽位设置"></a>点击按钮槽位设置</h4><p>您可以将按钮用作快捷方式。Rasa Core将以开头的消息发送<code>/</code>到 <code>RegexInterpreter</code>，期望NLU输入的格式与故事文件中的格式相同，例如<code>/intent{entities}</code>。例如，如果让用户通过单击按钮来选择颜色，则按钮的有效载荷可能是和。<code>/choose{"color": "blue"}``/choose{"color": "red"}</code></p>
<p>您可以在域文件中指定以下内容：（请参阅<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/domains/#domains">Domains中的</a>详细信息）</p>
<pre class=" language-markdown"><code class="language-markdown">utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>color:
<span class="token list punctuation">-</span> text: "what color would you like?"
  buttons:
  <span class="token list punctuation">-</span> title: "blue"
<span class="token code keyword">    payload: '/choose&amp;#123;"color": "blue"&amp;#125;'</span>
  <span class="token list punctuation">-</span> title: "red"
<span class="token code keyword">    payload: '/choose&amp;#123;"color": "red"&amp;#125;'</span></code></pre>
<h4 id="动作槽位设置"><a href="#动作槽位设置" class="headerlink" title="动作槽位设置"></a>动作槽位设置</h4><p>第二种方法是通过返回<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/actions/#custom-actions">自定义操作中的</a>事件来设置广告位。在这种情况下，您的故事需要包含广告位。例如，您有一个自定义操作来获取用户的个人资料，并且有一个<code>categorical</code>名为的广告位<code>account_type</code>。当<code>fetch_profile</code>运行动作，它返回一个 <a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/api/events/#rasa.core.events.SlotSet"><code>rasa.core.events.SlotSet</code></a>事件：</p>
<pre class=" language-markdown"><code class="language-markdown">slots:
   account_type:
<span class="token code keyword">      type: categorical</span>
<span class="token code keyword">      values:</span>
<span class="token code keyword">      - premium</span>
<span class="token code keyword">      - basic</span>
from rasa<span class="token italic"><span class="token punctuation">_</span>sdk.actions import Action
from rasa<span class="token punctuation">_</span></span>sdk.events import SlotSet
import requests

class FetchProfileAction(Action):
<span class="token code keyword">    def name(self):</span>
<span class="token code keyword">        return "fetch_profile"</span>

<span class="token code keyword">    def run(self, dispatcher, tracker, domain):</span>
<span class="token code keyword">        url = "http://myprofileurl.com"</span>
<span class="token code keyword">        data = requests.get(url).json</span>
<span class="token code keyword">        return [SlotSet("account_type", data["account_type"])]</span>
<span class="token title important"><span class="token punctuation">#</span> story_01</span>
<span class="token list punctuation">*</span> greet
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>fetch<span class="token punctuation">_</span></span>profile
  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"account_type" : "premium"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>welcome<span class="token punctuation">_</span></span>premium

<span class="token title important"><span class="token punctuation">#</span> story_02</span>
<span class="token list punctuation">*</span> greet
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>fetch<span class="token punctuation">_</span></span>profile
  <span class="token list punctuation">-</span> slot<span class="token entity" title="&#123;">&amp;#123;</span>"account_type" : "basic"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>welcome<span class="token punctuation">_</span></span>basic</code></pre>
<p>在这种情况下，你<strong>就</strong>必须包括在你的故事的一部分。Rasa Core将学习使用此信息来决定要采取的正确措施（在本例中为或）。<code>- slot{}``utter_welcome_premium``utter_welcome_basic</code></p>
<blockquote>
<p>注意</p>
<p>如果您手动编写故事，则<strong>很容易</strong>忘记插槽。我们强烈建议您使用<a href="#">带表单的交互式学习</a>来构建这些故事<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/interactive-learning/#section-interactive-learning-forms">，</a>而不要编写它们。</p>
</blockquote>
<h3 id="插槽类型"><a href="#插槽类型" class="headerlink" title="插槽类型"></a>插槽类型</h3><p><strong>text</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>您只关心是否已指定用户首选项的位置。</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:    <br>     cuisine:      <br>            type: text</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td><code>1</code>如果设置了任何值，则将插槽的功能设置为。否则，功能将设置为<code>0</code>（未设置任何值）。</td>
</tr>
</tbody></table>
<p><strong>bool</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>您只关心是否已指定用户首选项的位置。</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:    <br>     cuisine:      <br>            type: text</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td><code>1</code>如果设置了任何值，则将插槽的功能设置为。否则，功能将设置为<code>0</code>（未设置任何值）。</td>
</tr>
</tbody></table>
<p><strong>categorical</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>插槽可以采用N个值之一</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:    <br>    risk_level:      <br>          type: categorical     <br>           values:       <br>            - low  <br>            - medium <br>            - high</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>创建一个单编码，描述哪个<code>values</code>匹配。默认值<code>__other__</code>会自动添加到用户定义的值中。遇到的所有未在域中明确定义的值都将映射到<code>__other__</code>特征。该值 <code>__other__</code>不应用作用户定义的值；如果是这样，它将仍然是所有未显示值映射到的默认值。</td>
</tr>
</tbody></table>
<p><strong>float</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>连续值</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:   <br>     temperature:  <br>              type: float  <br>              min_value: -100.0 <br>              max_value:  100.0</td>
</tr>
<tr>
<td><strong>Defaults</strong></td>
<td>max_value=1.0<code>， </code>min_value=0.0</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>下面的所有值都<code>min_value</code>将被视为<code>min_value</code>，上面的值也一样<code>max_value</code>。因此，如果<code>max_value</code>将其设置为 <code>1</code>，则插槽值之间<code>2</code>和<code>3.5</code>在功能化方面没有区别（例如，两个值将以相同的方式影响对话，并且模型无法学会区分它们）。</td>
</tr>
</tbody></table>
<p><strong>list</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>值清单</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:   <br>     shopping_items:      <br>              type: list</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td><code>1</code>如果设置了带有列表的值（列表不为空），则设置此插槽的功能。如果未设置任何值，或者空白列表为设置值，则该功能将为<code>0</code>。<strong>存储在插槽中的列表</strong>的<strong>长度不影响对话</strong>。</td>
</tr>
</tbody></table>
<p><strong>unfeaturized</strong></p>
<table>
<thead>
<tr>
<th><strong>Use For</strong></th>
<th>您要存储的数据不应影响对话流程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Example</strong></td>
<td>slots:    <br>      internal_user_id:     <br>               type: unfeaturized</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>该插槽不会具有任何特征，因此其值不会影响对话流程，在预测机器人应执行的下一个动作时会被忽略。</td>
</tr>
</tbody></table>
<h3 id="自定义插槽类型"><a href="#自定义插槽类型" class="headerlink" title="自定义插槽类型"></a>自定义插槽类型</h3><p>也许您的餐厅预订系统最多只能处理6人的预订。在这种情况下，您希望广告位的<em>值</em>影响下一个选定的操作（而不只是影响是否已指定）。您可以通过定义自定义插槽类来实现。</p>
<p>在下面的代码中，我们定义了一个名为的插槽类<code>NumberOfPeopleSlot</code>。功能化定义了如何将此插槽的值转换为向量以供我们的机器学习模型处理。我们的广告位有三个可能的“值”，我们可以用length的向量表示它们<code>2</code>。</p>
<table>
<thead>
<tr>
<th><code>(0,0)</code></th>
<th>尚未设定</th>
</tr>
</thead>
<tbody><tr>
<td><code>(1,0)</code></td>
<td>1至6</td>
</tr>
<tr>
<td><code>(0,1)</code></td>
<td>超过6</td>
</tr>
</tbody></table>
<pre class=" language-markdown"><code class="language-markdown">from rasa.core.slots import Slot

class NumberOfPeopleSlot(Slot):

<span class="token code keyword">    def feature_dimensionality(self):</span>
<span class="token code keyword">        return 2</span>

<span class="token code keyword">    def as_feature(self):</span>
<span class="token code keyword">        r = [0.0] * self.feature_dimensionality()</span>
<span class="token code keyword">        if self.value:</span>
<span class="token code keyword">            if self.value &lt;= 6:</span>
<span class="token code keyword">                r[0] = 1.0</span>
<span class="token code keyword">            else:</span>
<span class="token code keyword">                r[1] = 1.0</span>
<span class="token code keyword">        return r</span></code></pre>
<p>现在我们还需要一些培训故事，以便Rasa Core可以从中学习如何处理不同情况：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> story1</span>
...
<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "3"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>book<span class="token punctuation">_</span></span>table
...
<span class="token title important"><span class="token punctuation">#</span> story2</span>
<span class="token list punctuation">*</span> inform<span class="token entity" title="&#123;">&amp;#123;</span>"people": "9"<span class="token entity" title="&#125;">&amp;#125;</span>
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>explain<span class="token punctuation">_</span></span>table_limit</code></pre>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><blockquote>
<p>注意</p>
<p>有一个深入的教程<a href="#">点击这里</a>了解如何使用莎形式的槽分配。</p>
</blockquote>
<ul>
<li><a href="#">配置文件</a></li>
<li><a href="#">表格基础</a></li>
<li><a href="#">自定义插槽映射</a></li>
<li><a href="#">验证用户输入</a></li>
<li><a href="#">处理不愉快路径</a></li>
<li><a href="#">request_slot槽位</a></li>
<li><a href="#">处理条件时隙逻辑</a></li>
<li><a href="#">调试</a></li>
</ul>
<p>最常见的对话模式之一是从用户那里收集一些信息，以便做某事（预订餐厅，调用API，搜索数据库等）。这也称为<strong>插槽填充</strong>。</p>
<p>如果您需要连续收集多条信息，建议您创建一个<code>FormAction</code>。这是一个单一操作，包含循环遍历所需插槽并要求用户提供此信息的逻辑。在<code>examples/formbot</code>Rasa Core目录中有一个使用表单的完整示例。</p>
<p>定义表单时，需要将其添加到域文件中。如果您的表单名称为<code>restaurant_form</code>，则您的域将如下所示：</p>
<pre class=" language-markdown"><code class="language-markdown">forms:
  <span class="token list punctuation">-</span> restaurant_form
actions:
  ...</code></pre>
<p>请参阅<code>examples/formbot/domain.yml</code>示例。</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>要使用表格，您还需要<code>FormPolicy</code>在策略配置文件中包含。例如：</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: "FormPolicy"</code></pre>
<p>请参阅<code>examples/formbot/config.yml</code>示例。</p>
<h3 id="表格基础知识"><a href="#表格基础知识" class="headerlink" title="表格基础知识"></a>表格基础知识</h3><p>使用<code>FormAction</code>，您可以用一个故事描述<em>所有</em>快乐的道路。所谓“幸福之路”，是指每当您向用户询问某些信息时，他们都会用您所要求的信息进行响应。</p>
<p>如果我们以餐厅机器人为例，那么这个单一的故事将描述所有快乐的道路。</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> happy path</span>
<span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre>
<p>在这个故事中，用户的意图是<code>request_restaurant</code>，其次是表单动作<code>restaurant_form</code>。随着形式被激活，并与形式再次激活。如<a href="#">处理不愉快路径</a>部分中所示，当表单仍处于活动状态时，机器人可以在表单外执行任何类型的操作。在用户合作良好且系统正确理解用户输入的“快乐之路”上，表格将不间断地填写所有请求的空位。<code>form{"name": "restaurant_form"}  form{"name": null}</code></p>
<p>在<code>FormAction</code>将仅请求已尚未设置槽。如果用户与我想要一家8人素食的中餐馆开始对话 ，则不会询问他们有关<code>cuisine</code>和的信息<code>num_people</code>。</p>
<p>请注意，要使该故事正常运行，您的广告位应未设置<a href="#">特色</a>。如果这些位置中的任何一个处于正常状态，则您的故事需要包括<code>slot{}</code>事件以显示已设置的这些位置。在这种情况下，创建有效故事的最简单方法是使用“<a href="#">交互式学习”</a>。</p>
<p>在上面的故事中，<code>restaurant_form</code>是我们表单动作的名称。这是一个看起来像的例子。您需要定义三种方法：</p>
<ul>
<li><code>name</code>：此操作的名称</li>
<li><code>required_slots</code>：要使用该<code>submit</code>方法，必须填写的插槽列表。</li>
<li><code>submit</code>：填写完所有广告位后，表格末尾的操作。</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Text<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Unique identifier of the form"""</span>

    <span class="token keyword">return</span> <span class="token string">"restaurant_form"</span>
@staticmethod
<span class="token keyword">def</span> <span class="token function">required_slots</span><span class="token punctuation">(</span>tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""A list of required slots that the form has to fill"""</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span> <span class="token string">"outdoor_seating"</span><span class="token punctuation">,</span> <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">submit</span><span class="token punctuation">(</span>
    self<span class="token punctuation">,</span>
    dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>
    tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>
    domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Define what the form has to do
        after all required slots are filled"""</span>

    <span class="token comment" spellcheck="true"># utter submit template</span>
    dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_submit"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre>
<p>第一次调用表单动作后，表单将被激活并<code>FormPolicy</code>跳转。<code>FormPolicy</code>极其简单，它总是可以预测表单动作。请参阅<a href="#">处理不满意的路径</a>以了解如何<a href="#">处理</a>意外的用户输入。</p>
<p>每次调用表单操作时，它将询问用户<code>required_slots</code>尚未设置的下一个插槽 。它通过查找名为的响应来完成此操作<code>utter_ask_{slot_name}</code>，因此您需要在域文件中为每个所需的插槽定义它们。</p>
<p>一旦所有插槽都装满，<code>submit()</code>便会调用方法，您可以在其中使用所收集的信息为用户做某事，例如查询餐厅API。如果您不希望表单最后做任何事情，只需将其 用作您的Submit方法。调用Submit方法之后，将停用表单，并将使用Core模型中的其他策略来预测下一步操作。<code>return []</code></p>
<h3 id="自定义插槽映射"><a href="#自定义插槽映射" class="headerlink" title="自定义插槽映射"></a>自定义插槽映射</h3><p>如果未定义插槽映射，则插槽将仅由与从用户输入中拾取的插槽名称相同的实体填充。某些槽位（例如<code>cuisine</code>）可以使用单个实体获取，但是 <code>FormAction</code>也可以支持是/否问题和自由文本输入。该<code>slot_mappings</code>方法定义了如何从用户响应中提取广告位值。</p>
<p>这是餐厅机器人的示例：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">slot_mappings</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Union<span class="token punctuation">[</span>Dict<span class="token punctuation">,</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""A dictionary to map required slots to
        - an extracted entity
        - intent: value pairs
        - a whole message
        or a list of them, where a first match will be picked"""</span>

    <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token string">"cuisine"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> not_intent<span class="token operator">=</span><span class="token string">"chitchat"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"num_people"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>
                entity<span class="token operator">=</span><span class="token string">"number"</span><span class="token punctuation">,</span> intent<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"inform"</span><span class="token punctuation">,</span> <span class="token string">"request_restaurant"</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"outdoor_seating"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"seating"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"affirm"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"deny"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"preferences"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            self<span class="token punctuation">.</span>from_intent<span class="token punctuation">(</span>intent<span class="token operator">=</span><span class="token string">"deny"</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token string">"no additional preferences"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>from_text<span class="token punctuation">(</span>not_intent<span class="token operator">=</span><span class="token string">"affirm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"feedback"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>from_entity<span class="token punctuation">(</span>entity<span class="token operator">=</span><span class="token string">"feedback"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>from_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre>
<p>预定义的功能如下：</p>
<ul>
<li><code>self.from_entity(entity=entity_name, intent=intent_name, role=role_name, group=group_name)</code> 将查找称为实体<code>entity_name</code>，以填补插槽 <code>slot_name</code>，无论用户的意图，如果<code>intent_name</code>是<code>None</code> 其他人只有意向的用户是<code>intent_name</code>。如果提供<code>role_name</code>和/或<code>group_name</code> ，则实体的角色/组标签也需要匹配给定的值。</li>
<li><code>self.from_intent(intent=intent_name, value=value)</code> 将填补缝隙<code>slot_name</code>用<code>value</code>，如果用户意图<code>intent_name</code>。要创建一个布尔型插槽，请看<code>outdoor_seating</code> 上面的定义。注意：插槽不会填充触发表单操作的消息的用户意图。<code>self.from_trigger_intent</code>在下面使用。</li>
<li><code>self.from_trigger_intent(intent=intent_name, value=value)</code> 将填补缝隙<code>slot_name</code>用<code>value</code>，如果形式与用户意图触发<code>intent_name</code>。</li>
<li><code>self.from_text(intent=intent_name)</code>将使用下一个使用者说话填写文本插槽<code>slot_name</code>，无论用户的意图，如果<code>intent_name</code>是<code>None</code>其他人只有当用户意图<code>intent_name</code>。</li>
<li>如果要允许这些组合，请像上面的示例一样将它们提供为列表。</li>
</ul>
<h3 id="验证用户输入"><a href="#验证用户输入" class="headerlink" title="验证用户输入"></a>验证用户输入</h3><p>从用户输入中提取广告位值后，表单将尝试验证广告位的值。请注意，默认情况下，仅在用户输入后立即执行表单操作时才进行验证。可以在Rasa SDK<code>_validate_if_required()</code>中的<code>FormAction</code>类的函数中对此进行更改 。激活表单后，还将验证在表单初次激活之前填写的所有必需插槽。</p>
<p>默认情况下，验证仅检查请求的插槽是否成功从插槽映射中提取。如果要添加自定义验证（例如，针对数据库检查值），可以通过编写名称为helper的验证函数来实现<code>validate_{slot-name}</code>。</p>
<p>这是一个示例，该示例<code>validate_cuisine()</code>检查提取的美食插槽是否属于受支持美食列表。</p>
<pre class=" language-python"><code class="language-python">    @staticmethod
    <span class="token keyword">def</span> <span class="token function">cuisine_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Database of supported cuisines"""</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string">"caribbean"</span><span class="token punctuation">,</span>
            <span class="token string">"chinese"</span><span class="token punctuation">,</span>
            <span class="token string">"french"</span><span class="token punctuation">,</span>
            <span class="token string">"greek"</span><span class="token punctuation">,</span>
            <span class="token string">"indian"</span><span class="token punctuation">,</span>
            <span class="token string">"italian"</span><span class="token punctuation">,</span>
            <span class="token string">"mexican"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">validate_cuisine</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> Text<span class="token punctuation">,</span>
        dispatcher<span class="token punctuation">:</span> CollectingDispatcher<span class="token punctuation">,</span>
        tracker<span class="token punctuation">:</span> Tracker<span class="token punctuation">,</span>
        domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Validate cuisine value."""</span>

        <span class="token keyword">if</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>cuisine_db<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># validation succeeded, set the value of the "cuisine" slot to value</span>
            <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"cuisine": value&amp;#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>template<span class="token operator">=</span><span class="token string">"utter_wrong_cuisine"</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># validation failed, set this slot to None, meaning the</span>
            <span class="token comment" spellcheck="true"># user will be asked for the slot again</span>
            <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"cuisine": None&amp;#125;</span></code></pre>
<p>当帮助程序验证功能返回要设置的插槽名称和值的字典时，您可以设置的插槽比在帮助程序验证方法中要验证的插槽要多。但是，您有责任确保这些额外的插槽值有效。</p>
<p>如果插槽中充满了您确定无法处理的东西，并且您想直接停用表单，则可以覆盖此<code>request_next_slot()</code>方法。下面的示例<code>cuisine</code>直接检查插槽的值，但是您可以使用任何想要触发停用的逻辑：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">request_next_slot</span><span class="token punctuation">(</span>
    self<span class="token punctuation">,</span>
    dispatcher<span class="token punctuation">:</span> <span class="token string">"CollectingDispatcher"</span><span class="token punctuation">,</span>
    tracker<span class="token punctuation">:</span> <span class="token string">"Tracker"</span><span class="token punctuation">,</span>
    domain<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span>Text<span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Optional<span class="token punctuation">[</span>List<span class="token punctuation">[</span>EventType<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Request the next slot and utter template if needed,
        else return None"""</span>
    <span class="token keyword">for</span> slot <span class="token keyword">in</span> self<span class="token punctuation">.</span>required_slots<span class="token punctuation">(</span>tracker<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_should_request_slot<span class="token punctuation">(</span>tracker<span class="token punctuation">,</span> slot<span class="token punctuation">)</span><span class="token punctuation">:</span>

            <span class="token comment" spellcheck="true">## Condition of validated slot that triggers deactivation</span>
            <span class="token keyword">if</span> slot <span class="token operator">==</span> <span class="token string">"cuisine"</span> <span class="token operator">and</span> tracker<span class="token punctuation">.</span>get_slot<span class="token punctuation">(</span><span class="token string">"cuisine"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"caribbean"</span><span class="token punctuation">:</span>
                dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"Sorry, I can't help you with that"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> self<span class="token punctuation">.</span>deactivate<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment" spellcheck="true">## For all other slots, continue as usual</span>
            logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>f<span class="token string">"Request next slot '&amp;#123;slot&amp;#125;'"</span><span class="token punctuation">)</span>
            dispatcher<span class="token punctuation">.</span>utter_message<span class="token punctuation">(</span>
                template<span class="token operator">=</span>f<span class="token string">"utter_ask_&amp;#123;slot&amp;#125;"</span><span class="token punctuation">,</span> <span class="token operator">**</span>tracker<span class="token punctuation">.</span>slots
            <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>SlotSet<span class="token punctuation">(</span>REQUESTED_SLOT<span class="token punctuation">,</span> slot<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> None</code></pre>
<p>如果对于任何所需的时间段，从用户的发言中未提取任何内容， <code>ActionExecutionRejection</code>则会引发错误，这意味着操作执行被拒绝，因此Core将退回到其他策略上以预测其他操作。</p>
<h3 id="处理不愉快路径"><a href="#处理不愉快路径" class="headerlink" title="处理不愉快路径"></a>处理不愉快路径</h3><p>当然，您的用户将不会总是用您要求他们提供的信息来回应。通常，用户会问问题，打招呼，改变主意或以其他方式偏离幸福的道路。表单的工作方式是，<code>ActionExecutionRejection</code>如果用户未提供所请求的信息，表单将引发。您需要处理可能导致<code>ActionExecutionRejection</code>故事出错的事件。例如，如果您希望您的用户选择与您的机器人聊天，则可以添加如下故事：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span>
<span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token list punctuation">*</span> chitchat
<span class="token code keyword">    - utter_chitchat</span>
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre>
<p>在某些情况下，用户可能会在表单操作过程中改变主意，并决定不继续其最初的请求。在这种情况下，助手应停止询问所请求的时段。您可以使用默认操作<code>action_deactivate_form</code>来优雅地处理此类情况，该操作将停用表单并重置请求的插槽。此类对话的一个示例故事如下所示：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span>
<span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token list punctuation">*</span> stop
<span class="token code keyword">    - utter_ask_continue</span>
<span class="token list punctuation">*</span> deny
<span class="token code keyword">    - action_deactivate_form</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre>
<p>这是<strong>强烈</strong>建议你建立一个使用交互式学习这些故事。如果您用手写这些故事，您可能会错过重要的事情。请阅读“<a href="#">通过表单</a> 进行<a href="#">交互式学习”，</a>以了解如何在<a href="#">表单</a>中使用交互式学习。</p>
<h3 id="request-slot槽位"><a href="#request-slot槽位" class="headerlink" title="request_slot槽位"></a>request_slot槽位</h3><p>该插槽<code>requested_slot</code>将作为未完成的插槽自动添加到域中。如果要使其具有特色，则需要将其作为分类插槽添加到域文件中。如果要根据用户当前要求的插槽来不同地处理不愉快的路径，则可能需要执行此操作。例如，假设您的用户用另一个问题回答了机器人的一个问题，例如<em>您为什么需要知道这一点？</em> 对这一<code>explain</code>意图的反应取决于我们在故事中所处的位置。在餐厅的情况下，您的故事将如下所示：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> explain cuisine slot</span>
<span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"requested_slot": "cuisine"&amp;#125;</span>
<span class="token list punctuation">*</span> explain
<span class="token code keyword">    - utter_explain_cuisine</span>
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - slot&amp;#123;"cuisine": "greek"&amp;#125;</span>
<span class="token code keyword">    ( ... all other slots the form set ... )</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span>

<span class="token title important"><span class="token punctuation">##</span> explain num_people slot</span>
<span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"requested_slot": "num_people"&amp;#125;</span>
<span class="token list punctuation">*</span> explain
<span class="token code keyword">    - utter_explain_num_people</span>
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - slot&amp;#123;"cuisine": "greek"&amp;#125;</span>
<span class="token code keyword">    ( ... all other slots the form set ... )</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span></code></pre>
<p>同样，<strong>强烈</strong>建议您使用交互式学习来构建这些故事。请阅读“<a href="#">通过表单</a> 进行<a href="#">交互式学习”，</a>以了解如何在<a href="#">表单</a>中使用交互式学习。</p>
<h3 id="处理条件时隙逻辑"><a href="#处理条件时隙逻辑" class="headerlink" title="处理条件时隙逻辑"></a>处理条件时隙逻辑</h3><p>除了请求字段列表之外，许多表单还需要更多的逻辑。例如，如果有人要求<code>greek</code>作为他们的菜，您可能想问他们是否正在寻找带户外座位的地方。</p>
<p>您可以通过将一些逻辑写入<code>required_slots()</code>方法来实现此目的，例如：</p>
<pre class=" language-python"><code class="language-python">@staticmethod
<span class="token keyword">def</span> <span class="token function">required_slots</span><span class="token punctuation">(</span>tracker<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span>Text<span class="token punctuation">]</span><span class="token punctuation">:</span>
   <span class="token triple-quoted-string string">"""A list of required slots that the form has to fill"""</span>

   <span class="token keyword">if</span> tracker<span class="token punctuation">.</span>get_slot<span class="token punctuation">(</span><span class="token string">'cuisine'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'greek'</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span> <span class="token string">"outdoor_seating"</span><span class="token punctuation">,</span>
             <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"cuisine"</span><span class="token punctuation">,</span> <span class="token string">"num_people"</span><span class="token punctuation">,</span>
             <span class="token string">"preferences"</span><span class="token punctuation">,</span> <span class="token string">"feedback"</span><span class="token punctuation">]</span></code></pre>
<p>这种机制非常通用，您可以使用它在表单中构建许多不同种类的逻辑。</p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>首先尝试用<code>--debug</code>标志运行您的机器人，有关详细信息，请参见<a href="#">命令行界面</a>。如果您只是入门，则可能只有几个手写的故事。这是一个很好的起点，但你应该给你的机器人给人以测试<strong>尽快</strong>。Rasa Core的指导原则之一是：</p>
<p>​       从真实的对话中学习比设计假设的对话更为重要</p>
<p>因此，在将其提供给测试人员之前，请勿尝试覆盖手写故事中的所有可能性。真实的用户行为将永远让您感到惊讶！</p>
<h2 id="检索操作-1"><a href="#检索操作-1" class="headerlink" title="检索操作"></a>检索操作</h2><blockquote>
<p>警告</p>
<p>此功能是实验性的。我们引入实验性功能以获取社区的反馈，因此我们鼓励您尝试一下！但是，将来可能会更改或删除功能。如果您有任何反馈（正面或负面），请在<a target="_blank" rel="noopener" href="https://forum.rasa.com/">论坛</a>上与我们分享。另外，如果您的训练数据包含检索动作，当前我们不支持在Rasa X中添加新的注释。一旦收集到足够的反馈并且对培训数据格式感到满意，我们将在Rasa X中添加对培训响应检索模型的支持。</p>
</blockquote>
<blockquote>
<p>注意</p>
<p>这里有一篇深入的博客文章<a target="_blank" rel="noopener" href="https://blog.rasa.com/response-retrieval-models/">，</a>介绍如何使用检索动作来处理单回合互动。</p>
</blockquote>
<ul>
<li><a href="#">关于</a></li>
<li><a href="#">训练数据</a></li>
<li><a href="#">配置文件</a></li>
<li><a href="#">域</a></li>
<li><a href="#">多个检索动作</a></li>
<li><a href="#">解析响应选择器输出</a></li>
</ul>
<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><p>检索动作旨在简化使用<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/dialogue-elements/small-talk/#small-talk">闲聊</a>和<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/dialogue-elements/completing-tasks/#simple-questions">简单问题的工作</a>。例如，如果您的助手可以处理100个FAQ和50个不同的闲聊意图，则可以使用一个检索操作来覆盖所有这些内容。从对话的角度来看，这些单回合的交流都可以得到同等对待，因此可以简化您的故事。</p>
<p>而不是像这样的很多故事：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> weather</span>
<span class="token list punctuation">*</span> ask_weather
   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>weather

<span class="token title important"><span class="token punctuation">##</span> introduction</span>
<span class="token list punctuation">*</span> ask_name
   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>introduce<span class="token punctuation">_</span></span>myself

...</code></pre>
<p>您可以通过一个故事来涵盖所有这些内容，其中上述意图归为一个共同的<code>chitchat</code>意图：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> chitchat</span>
<span class="token list punctuation">*</span> chitchat
   <span class="token list punctuation">-</span> respond_chitchat</code></pre>
<p>检索动作使用NLU的<a href="#">ResponseSelector</a>组件的输出，该组件学习检索模型以从给定用户消息文本的候选响应列表中预测正确的响应。</p>
<h3 id="训练数据"><a href="#训练数据" class="headerlink" title="训练数据"></a>训练数据</h3><p>顾名思义，检索动作将学习从候选列表中选择正确的答案。与其他NLU数据一样，您需要在用户的NLU文件中包括一些示例：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent: chitchat/ask_name</span>
<span class="token list punctuation">-</span> what's your name
<span class="token list punctuation">-</span> who are you?
<span class="token list punctuation">-</span> what are you called?

<span class="token title important"><span class="token punctuation">##</span> intent: chitchat/ask_weather</span>
<span class="token list punctuation">-</span> how's weather?
<span class="token list punctuation">-</span> is it sunny where you are?</code></pre>
<p>首先，所有这些示例都将合并为<code>chitchat</code>NLU将预测的单个检索意图。在上面的示例-<code>ask_name</code>和中，所有检索意图都有一个后缀，该后缀标识了您助手的特定响应文本<code>ask_weather</code>。后缀由<code>/</code>定界符与意图名称分隔</p>
<p>接下来，将所有检索意图的响应文本包含在<strong>单独的</strong>训练数据文件中，如下所示<code>responses.md</code>：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> ask name</span>
<span class="token list punctuation">*</span> chitchat/ask_name
<span class="token code keyword">    - my name is Sara, Rasa's documentation bot!</span>

<span class="token title important"><span class="token punctuation">##</span> ask weather</span>
<span class="token list punctuation">*</span> chitchat/ask_weather
<span class="token code keyword">    - it's always sunny where I live</span></code></pre>
<p>检索模型作为NLU训练流水线的一部分进行单独训练，以选择正确的响应。要记住的重要一件事是，检索模型使用响应消息的文本来选择正确的消息。如果更改这些响应的文本，则必须重新训练您的检索模型！这是您域文件中响应模板的主要区别。</p>
<blockquote>
<p>注意</p>
<p>包含响应文本的文件必须作为单独的文件存在于传递给训练过程的训练数据目录中。它的内容不能是包含NLU其他组件的训练数据的文件的一部分。</p>
</blockquote>
<blockquote>
<p>注意</p>
<p>如以上示例所示，<code>/</code>保留符号作为分隔符，以将检索意图与响应文本标识符分开。确保不要以您的意图的名义使用它。</p>
</blockquote>
<h3 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h3><p>您需要在配置中包括<a href="#">ResponseSelector</a>组件。该组件需要标记器，功能化器和意图分类器才能对用户消息进行操作，然后才能预测响应，因此应将这些组件放在<code>ResponseSelector</code>NLU配置中。一个例子：</p>
<pre class=" language-markdown"><code class="language-markdown">language: "en"

pipeline:
<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"
  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"
<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"
<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"
<span class="token list punctuation">-</span> name: "ResponseSelector"</code></pre>
<h3 id="Domain-1"><a href="#Domain-1" class="headerlink" title="Domain"></a>Domain</h3><p>Rasa使用命名约定将意图名称<code>chitchat/ask_name</code> 与检索动作进行匹配。在这种情况下，正确的操作名称是<code>respond_chitchat</code>。前缀<code>respond_</code>是强制性的，以将其标识为检索动作。另一个示例-正确的操作名称<code>faq/ask_policy</code>将是<code>respond_faq</code> 要将其包括在您的域中，请将其添加到操作列表中：</p>
<pre class=" language-markdown"><code class="language-markdown">actions:
  ...
  <span class="token list punctuation">-</span> respond_chitchat
  <span class="token list punctuation">-</span> respond_faq</code></pre>
<p>确保在选择意图后可以预测检索动作的一种简单方法是使用“<a href="#">映射策略”</a>。但是，您也可以在您的故事中包括此操作。例如，如果您想在处理chitchat之后重复一个问题（请参阅<a href="#">不快乐的路径</a>）</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> interruption</span>
<span class="token list punctuation">*</span> search_restaurant
   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine
<span class="token list punctuation">*</span> chitchat
   <span class="token list punctuation">-</span> respond_chitchat
   <span class="token list punctuation">-</span> utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>cuisine</code></pre>
<h3 id="多个检索动作"><a href="#多个检索动作" class="headerlink" title="多个检索动作"></a>多个检索动作</h3><p>如果您的助手同时包含FAQ<strong>和</strong>chitchat，则可以将它们分为单独的检索操作，例如，具有诸如<code>chitchat/ask_weather</code>和的意图<code>faq/returns_policy</code>。Rasa支持添加多个<code>RetrievalActions</code>like<code>respond_chitchat</code>和<code>respond_returns_policy</code> 若要为每种目的训练单独的检索模型，您需要<code>ResponseSelector</code> 在配置中包括一个单独的组件：</p>
<pre class=" language-markdown"><code class="language-markdown">language: "en"

pipeline:
<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"
  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"
<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"
<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"
<span class="token list punctuation">-</span> name: "ResponseSelector"
  retrieval_intent: chitchat
<span class="token list punctuation">-</span> name: "ResponseSelector"
  retrieval_intent: faq</code></pre>
<ul>
<li><p>您仍然可以有两个单独的检索动作，但是两个动作可以通过指定一个来共享相同的检索模型</p>
<p><code>ResponseSelector</code>组件并将其保留<code>retrieval_intent</code>为默认值（无）：</p>
</li>
</ul>
<pre class=" language-markdown"><code class="language-markdown">language: "en"

pipeline:
<span class="token list punctuation">-</span> name: "WhitespaceTokenizer"
  intent<span class="token italic"><span class="token punctuation">_</span>split<span class="token punctuation">_</span></span>symbol: "_"
<span class="token list punctuation">-</span> name: "CountVectorsFeaturizer"
<span class="token list punctuation">-</span> name: "EmbeddingIntentClassifier"
<span class="token list punctuation">-</span> name: "ResponseSelector"</code></pre>
<p>在这种情况下，将对来自两个示例的响应选择器进行训练<code>chitchat/{x}</code>，<code>faq/{x}</code>并<code>default</code>以NLU解析输出的名称进行标识。</p>
<p>在我们的实验中，到目前为止，具有独立的检索模型并<strong>没有</strong>做出检索每一个动作的准确性任何区别。因此，为简单起见，我们建议您对chitchat和FAQ使用单一的检索模型。如果获得不同的结果，请在<a target="_blank" rel="noopener" href="https://forum.rasa.com/">论坛中</a>告诉我们！</p>
<h3 id="解析响应选择器输出"><a href="#解析响应选择器输出" class="headerlink" title="解析响应选择器输出"></a>解析响应选择器输出</h3><p>来自NLU的解析输出将具有一个名为属性，<code>response_selector</code>其中包含每个响应选择器的输出。每个响应选择器均由<code>retrieval_intent</code>该响应选择器的参数标识，并存储两个属性-</p>
<ul>
<li><code>response</code>：预测的响应文本和预测的置信度。</li>
<li><code>ranking</code>：以十大候选答案的信心排名。</li>
</ul>
<p>结果示例：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"What is the recommend python version to install?"</span><span class="token punctuation">,</span>
    <span class="token property">"entities"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"intent"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"faq"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token property">"intent_ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.6485910906220309</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"faq"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.1416153159565678</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"greet"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"response_selector"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
      <span class="token property">"faq"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token property">"response"</span><span class="token operator">:</span> &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.7356462617</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Supports 3.5, 3.6 and 3.7, recommended version is 3.6"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token property">"ranking"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.7356462617</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Supports 3.5, 3.6 and 3.7, recommended version is 3.6"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
            &amp;#<span class="token number">123</span><span class="token punctuation">;</span><span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">0.2134543431</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"You can ask me about how to get started"</span>&amp;#<span class="token number">125</span><span class="token punctuation">;</span>
        <span class="token punctuation">]</span>
      &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
    &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>如果将<code>retrieval_intent</code>特定响应选择器的参数保留为其默认值，则将<code>default</code>在返回的输出中标识相应的响应选择器。</p>
<h2 id="交互学习"><a href="#交互学习" class="headerlink" title="交互学习"></a>交互学习</h2><p>此页面显示了如何在命令行上使用交互式学习。</p>
<p>在交互式学习模式下，您可以在与机器人聊天时向其提供反馈。这是探索您的机器人可以做什么的有力方法，并且是修正其错误的最简单方法。基于机器学习的对话的一个优势是，当您的机器人还不知道如何做时，您可以教它！有人将此<a target="_blank" rel="noopener" href="https://medium.com/@karpathy/software-2-0-a64152b37c35">软件</a>称为<a target="_blank" rel="noopener" href="https://medium.com/@karpathy/software-2-0-a64152b37c35">2.0</a>。</p>
<blockquote>
<p>注意</p>
<p>Rasa X提供了用于交互式学习的UI，您可以使用任何用户对话作为起点。请参阅 Rasa X文档中的与<a href="#">机器人对话</a>。</p>
</blockquote>
<ul>
<li><a href="#">进行互动学习</a></li>
<li><a href="#">提供有关错误的反馈</a></li>
<li><a href="#">对话可视化</a></li>
<li><a href="#">表格互动学习</a><ul>
<li><a href="#">该<code>form:</code>前缀</a></li>
<li><a href="#">输入验证</a></li>
</ul>
</li>
</ul>
<h3 id="运行互动学习"><a href="#运行互动学习" class="headerlink" title="运行互动学习"></a>运行互动学习</h3><p>运行以下命令以开始交互式学习：</p>
<pre class=" language-shell"><code class="language-shell">rasa run actions --actions actions&

rasa interactive \
  -m models/20190515-135859.tar.gz \
  --endpoints endpoints.yml</code></pre>
<p>第一条命令启动动作服务器（请参阅<a href="#">自定义动作</a>）。</p>
<p>第二个命令启动交互式学习模式。</p>
<p>在交互模式下，Rasa将要求您确认NLU和Core所做的每个预测，然后再继续。这是一个例子：</p>
<pre class=" language-text"><code class="language-text">Bot loaded. Type a message and press enter (use '/stop' to exit).

? Next user input:  hello

? Is the NLU classification for 'hello' with intent 'hello' correct?  Yes

------
Chat History

 #    Bot                        You
────────────────────────────────────────────
 1    action_listen
────────────────────────────────────────────
 2                                    hello
                         intent: hello 1.00
------

? The bot wants to run 'utter_greet', correct?  (Y/n)        </code></pre>
<p>聊天历史记录和时段值会打印到屏幕上，这应该是决定正确的下一步操作所需的全部信息。</p>
<p>在这种情况下，机器人选择了正确的操作（<code>utter_greet</code>），因此我们键入<code>y</code>。然后我们<code>y</code>再次键入，因为<code>action_listen</code>问候语之后的操作是正确的。我们继续该循环，与机器人聊天，直到机器人选择了错误的操作。</p>
<h3 id="提供了对错误的反馈"><a href="#提供了对错误的反馈" class="headerlink" title="提供了对错误的反馈"></a>提供了对错误的反馈</h3><p>对于本示例，我们将使用该<code>concertbot</code>示例，因此请确保您具有该域和数据。您可以从我们的<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa/tree/master/examples/concertbot">github repo</a>下载数据。</p>
<p>如果您询问<code>/search_concerts</code>，则漫游器应提出建议 <code>action_search_concerts</code>，然后<code>action_listen</code>（该策略将在操作名称旁边显示该策略选择其下一个操作的置信度）。现在，让我们输入<code>/compare_reviews</code>下一条用户消息。机器人<em>可能会</em>从两种可能性中选择错误的一种（取决于训练的运行，它可能也是正确的）：</p>
<pre class=" language-latex"><code class="language-latex">------
Chat History

 #    Bot                                           You
───────────────────────────────────────────────────────────────
 1    action_listen
───────────────────────────────────────────────────────────────
 2                                            /search_concerts
                                  intent: search_concerts 1.00
───────────────────────────────────────────────────────────────
 3    action_search_concerts 0.72
      action_listen 0.78
───────────────────────────────────────────────────────────────
 4                                            /compare_reviews
                                  intent: compare_reviews 1.00


Current slots:
  concerts: None, venues: None

------
? The bot wants to run 'action_show_concert_reviews', correct?  No</code></pre>
<p>现在，我们键入<code>n</code>，因为它选择了错误的操作，然后出现一个新的提示，要求正确的操作。这也显示了模型分配给每个动作的概率：</p>
<pre class=" language-text"><code class="language-text">? What is the next action of the bot?  (Use arrow keys)
 ❯ 0.53 action_show_venue_reviews
   0.46 action_show_concert_reviews
   0.00 utter_goodbye
   0.00 action_search_concerts
   0.00 utter_greet
   0.00 action_search_venues
   0.00 action_listen
   0.00 utter_youarewelcome
   0.00 utter_default
   0.00 action_default_fallback
   0.00 action_restart</code></pre>
<p>在这种情况下，机器人应该<code>action_show_concert_reviews</code>（而不是场地评论！）来选择该动作。</p>
<p>现在，只要我们愿意进行更长的对话，我们就可以继续与机器人对话。您可以随时按<code>Ctrl-C</code>，该bot会为您提供退出选项。您可以将新创建的故事和NLU数据写入文件。如果提供反馈时出错，也可以返回上一步。</p>
<p>确保将转储的故事和NLU示例与您的原始培训数据结合起来，以进行下一次训练。</p>
<h3 id="对话的可视化"><a href="#对话的可视化" class="headerlink" title="对话的可视化"></a>对话的可视化</h3><p>在交互式学习期间，Rasa将从训练数据中绘制当前对话和一些类似对话，以帮助您跟踪自己的位置。</p>
<p>开始交互式学习后，您可以在<a target="_blank" rel="noopener" href="http://localhost:5005/visualization.html">http：// localhost：5005 / visualization.html上</a>查看可视化。</p>
<p>要跳过可视化，请运行。<code>rasa interactive --skip-visualization</code></p>
<p><img src="/2020/10/05/rasa-wen-dang-zhi-nan-14/1.gif"></p>
<h3 id="表单互动学习"><a href="#表单互动学习" class="headerlink" title="表单互动学习"></a>表单互动学习</h3><p>如果您使用的是FormAction，则在使用交互式学习时还需要记住一些其他事项。</p>
<h4 id="form-前缀"><a href="#form-前缀" class="headerlink" title="form:前缀"></a><code>form:</code>前缀</h4><p>表单逻辑是由您的<code>FormAction</code>班级而不是故事来描述的。机器学习策略应该不必学习这种行为，并且如果以后要更改表单操作（例如，通过添加或删除所需的插槽）也不要感到困惑。当您使用交互式学习生成包含表单的故事时，表单处理的对话步骤会获得<code>form:</code>前缀。这告诉Rasa Core在训练其他策略时忽略这些步骤。您不必在这里做任何特别的事情，<a target="_blank" rel="noopener" href="https://legacy-docs-v1.rasa.com/core/forms/#forms">Forms</a>给出的基本故事仍然涵盖了表单的所有快乐路径。</p>
<p>这是一个例子：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token list punctuation">*</span> request_restaurant
<span class="token code keyword">    - restaurant_form</span>
<span class="token code keyword">    - form&amp;#123;"name": "restaurant_form"&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"requested_slot": "cuisine"&amp;#125;</span>
<span class="token list punctuation">*</span> form: inform<span class="token entity" title="&#123;">&amp;#123;</span>"cuisine": "mexican"<span class="token entity" title="&#125;">&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"cuisine": "mexican"&amp;#125;</span>
<span class="token code keyword">    - form: restaurant_form</span>
<span class="token code keyword">    - slot&amp;#123;"cuisine": "mexican"&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"requested_slot": "num_people"&amp;#125;</span>
<span class="token list punctuation">*</span> form: inform<span class="token entity" title="&#123;">&amp;#123;</span>"number": "2"<span class="token entity" title="&#125;">&amp;#125;</span>
<span class="token code keyword">    - form: restaurant_form</span>
<span class="token code keyword">    - slot&amp;#123;"num_people": "2"&amp;#125;</span>
<span class="token code keyword">    - form&amp;#123;"name": null&amp;#125;</span>
<span class="token code keyword">    - slot&amp;#123;"requested_slot": null&amp;#125;</span>
<span class="token code keyword">    - utter_slots_values</span></code></pre>
<h4 id="输入验证"><a href="#输入验证" class="headerlink" title="输入验证"></a>输入验证</h4><p>每次用户使用请求的插槽或任何所需的插槽以外的<em>其他内容进行</em>响应时，系统都会询问您是否要让表单操作在返回表单时尝试从用户消息中提取一个插槽。最好用和示例来解释：</p>
<pre class=" language-text"><code class="language-text"> 7    restaurant_form 1.00
      slot&#123;"num_people": "3"&#125;
      slot&#123;"requested_slot": "outdoor_seating"&#125;
      do you want to sit outside?
      action_listen 1.00
─────────────────────────────────────────────────────────────────────────────────────
 8                                                                             /stop
                                                                   intent: stop 1.00
─────────────────────────────────────────────────────────────────────────────────────
 9    utter_ask_continue 1.00
      do you want to continue?
      action_listen 1.00
─────────────────────────────────────────────────────────────────────────────────────
 10                                                                          /affirm
                                                                 intent: affirm 1.00


Current slots:
    cuisine: greek, feedback: None, num_people: 3, outdoor_seating: None,
  preferences: None, requested_slot: outdoor_seating

------
2018-11-05 21:36:53 DEBUG    rasa.core.tracker_store  - Recreating tracker for id 'default'
? The bot wants to run 'restaurant_form', correct?  Yes
2018-11-05 21:37:08 DEBUG    rasa.core.tracker_store  - Recreating tracker for id 'default'
? Should 'restaurant_form' validate user input to fill the slot 'outdoor_seating'?  (Y/n)</code></pre>
<p>在这里，用户要求停止表单，而漫游器则询问用户是否确定不想继续。用户说他们想继续（<code>/affirm</code>意图）。这里<code>outdoor_seating</code>有一个<code>from_intent</code>插槽映射（<code>/affirm</code>意图映射到<code>True</code>），因此可以使用此用户输入来填充该插槽。但是，在这种情况下，用户只是在回答“您要继续吗？” 问题，因此选择<code>n</code>，则不应验证用户输入。机器人随后将继续要求该 <code>outdoor_seating</code>插槽。</p>
<blockquote>
<p>警告</p>
<p>如果您的训练数据中有一个矛盾的故事，即您只是选择验证输入（意味着它将以<code>forms:</code>前缀打印），但是您的故事文件中包含了您不验证输入的相同故事（意味着没有输入）该<code>forms:</code>前缀），你将需要确保消除这种冲突的故事。发生这种情况时，会出现警告提示，提醒您执行以下操作：</p>
<p><strong>警告：FormPolicy根据以前的培训经验预测不会进行表单验证。确保从训练数据中删除矛盾的故事</strong></p>
<p>删除该故事后，您可以按Enter键并继续进行交互式学习</p>
</blockquote>
<h2 id="Fallback动作"><a href="#Fallback动作" class="headerlink" title="Fallback动作"></a>Fallback动作</h2><p>有时您想恢复为备用操作，例如回答 “对不起，我不明白”。您可以通过添加无论是处理回退的情况下<code>FallbackPolicy</code>或<code>TwoStageFallbackPolicy</code>您的保单合奏。</p>
<h2 id="Fallback策略"><a href="#Fallback策略" class="headerlink" title="Fallback策略"></a>Fallback策略</h2><p>该<code>FallbackPolicy</code>有一个回退操作，如果意图识别下方有信心，这将被执行<code>nlu_threshold</code> 或者如果没有对话政策的预测有信心的作用大于<code>core_threshold</code>。</p>
<p>阈值和回退操作可以在策略配置文件中作为的参数进行调整<code>FallbackPolicy</code>。</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: "FallbackPolicy"
<span class="token code keyword">    nlu_threshold: 0.4</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_action_name: "action_default_fallback"</span></code></pre>
<p><code>action_default_fallback</code>是Rasa Core中的默认操作，它将<code>utter_default</code>响应发送 给用户。确保<code>utter_default</code>在您的域文件中指定。它还将还原到导致回退的用户消息之前的会话状态，从而不会影响对未来操作的预测。您可以查看以下操作的来源：</p>
<ul>
<li><p><em>类</em><code>rasa.core.actions.action.``ActionDefaultFallback</code></p>
<p>执行后备操作并返回到对话的先前状态</p>
</li>
</ul>
<p>您还可以创建自己的自定义操作以用作后备广告（有关<a href="#">自定义操作</a>的更多信息，请参见 <a href="#">自</a>定义操作）。如果这样做，请确保将自定义后备操作传递到<code>FallbackPolicy</code>策略配置文件中。例如：</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: "FallbackPolicy"
<span class="token code keyword">    nlu_threshold: 0.4</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_action_name: "my_fallback_action"</span></code></pre>
<blockquote>
<p>注意</p>
<p>如果您的自定义后备操作未返回<code>UserUtteranceReverted</code>事件，则机器人的下一个预测可能会变得不准确，因为您的故事中很可能没有后备操作。</p>
</blockquote>
<p>如果您有一个特定的意图（假设它称为）<code>out_of_scope</code>，它应该始终触发后备操作，则应将其添加为故事：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> fallback story</span>
<span class="token list punctuation">*</span> out<span class="token italic"><span class="token punctuation">_</span>of<span class="token punctuation">_</span></span>scope
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>default<span class="token punctuation">_</span></span>fallback</code></pre>
<h3 id="两阶段回退策略-1"><a href="#两阶段回退策略-1" class="headerlink" title="两阶段回退策略"></a>两阶段回退策略</h3><p>所述<code>TwoStageFallbackPolicy</code>手柄低NLU信心在多个阶段中通过尝试来消除歧义所述用户输入（低芯的信心在相同的方式处理<code>FallbackPolicy</code>）。</p>
<ul>
<li>如果NLU预测的置信度得分低，则要求用户确认意图的分类。（默认操作： <code>action_default_ask_affirmation</code>）<ul>
<li>如果他们肯定了，那么故事将继续，就好像从一开始就对意图进行了高度自信的分类。</li>
<li>如果他们拒绝，则要求用户重新表达他们的消息。</li>
</ul>
</li>
<li>改写（默认操作：<code>action_default_ask_rephrase</code>）<ul>
<li>如果重新表达意图的分类是确定的，则故事将继续，就好像用户从一开始就具有此意图。</li>
<li>如果措辞的意图没有被高可信度分类，则要求用户确认分类的意图。</li>
</ul>
</li>
<li>其次肯定（默认操作：<code>action_default_ask_affirmation</code>）<ul>
<li>如果用户确认了此意图，则故事将继续，就像用户从一开始就具有此意图一样。</li>
<li>如果用户拒绝，则将原始意图分类为指定的 <code>deny_suggestion_intent_name</code>，并<code>fallback_nlu_action_name</code>触发最终的后备操作 （例如，移交给人类）。</li>
</ul>
</li>
</ul>
<p>莎核心提供了默认的实现 <code>action_default_ask_affirmation</code>和<code>action_default_ask_rephrase</code>。操作的默认实现会<code>action_default_ask_rephrase</code>发出响应<code>utter_ask_rephrase</code>，因此请确保在域文件中指定此响应。这两个动作的实现都可以用<a href="#">自定义动作</a>覆盖。</p>
<p>您可以<code>TwoStageFallbackPolicy</code>在策略配置文件中将核心回退操作以及最终的NLU回退操作指定为参数。</p>
<pre class=" language-markdown"><code class="language-markdown">policies:
  <span class="token list punctuation">-</span> name: TwoStageFallbackPolicy
<span class="token code keyword">    nlu_threshold: 0.3</span>
<span class="token code keyword">    core_threshold: 0.3</span>
<span class="token code keyword">    fallback_core_action_name: "action_default_fallback"</span>
<span class="token code keyword">    fallback_nlu_action_name: "action_default_fallback"</span>
<span class="token code keyword">    deny_suggestion_intent_name: "out_of_scope"</span></code></pre>
<h2 id="知识库操作"><a href="#知识库操作" class="headerlink" title="知识库操作"></a>知识库操作</h2><blockquote>
<p>警告</p>
<p>此功能是实验性的。我们引入实验性功能以获取社区的反馈，因此我们鼓励您尝试一下！但是，将来可能会更改或删除功能。如果您有任何反馈（正面或负面），请在<a target="_blank" rel="noopener" href="https://forum.rasa.com/">论坛</a>上与我们分享。</p>
</blockquote>
<ul>
<li><a href="#">使用 <code>ActionQueryKnowledgeBase</code></a><ul>
<li><a href="#">建立知识库</a></li>
<li><a href="#">定义NLU数据</a></li>
<li><a href="#">创建一个操作来查询您的知识库</a></li>
</ul>
</li>
<li><a href="#">怎么运行的</a><ul>
<li><a href="#">在知识库中查询对象</a></li>
<li><a href="#">在知识库中查询对象的属性</a></li>
<li><a href="#">解决提及</a></li>
</ul>
</li>
<li><a href="#">客制化</a><ul>
<li><a href="#">客制化 <code>ActionQueryKnowledgeBase</code></a></li>
<li><a href="#">创建自己的知识库操作</a></li>
<li><a href="#">自定义 <code>InMemoryKnowledgeBase</code></a></li>
<li><a href="#">创建自己的知识库</a></li>
</ul>
</li>
</ul>
<p>知识库操作使您能够处理以下类型的对话：</p>
<p><img src="/2020/10/05/rasa-wen-dang-zhi-nan-14/12.png"></p>
<p>会话式AI中的一个常见问题是，用户不仅通过名称来引用某些对象，而且还使用诸如“第一个”或“它”之类的引用术语。我们需要跟踪提供的信息，以解决对正确对象的这些提及。</p>
<p>此外，用户可能希望在对话过程中获取有关对象的详细信息，例如，餐厅是否有户外座位，或有多昂贵。为了响应那些用户请求，需要有关餐厅域的知识。由于信息随时可能更改，因此硬编码信息不是解决方案。</p>
<p>为了应对上述挑战，Rasa可以与知识库集成。要使用这种集成，您可以创建一个继承自的自定义操作<code>ActionQueryKnowledgeBase</code>，该预写的自定义操作包含用于查询知识库中对象及其属性的逻辑。</p>
<p>您可以在<code>examples/knowledgebasebot</code> （<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/">知识库bot</a>）中找到完整的示例，以及下面有关实现此自定义操作的说明。</p>
<h3 id="使用ActionQueryKnowledgeBase"><a href="#使用ActionQueryKnowledgeBase" class="headerlink" title="使用ActionQueryKnowledgeBase"></a>使用<code>ActionQueryKnowledgeBase</code></h3><h4 id="创建知识库"><a href="#创建知识库" class="headerlink" title="创建知识库"></a>创建知识库</h4><p>用于回答用户请求的数据将存储在知识库中。知识库可用于存储复杂的数据结构。建议您开始使用<code>InMemoryKnowledgeBase</code>。一旦要开始处理大量数据，就可以切换到自定义知识库（请参阅<a href="#">创建自己的知识库</a>）。</p>
<p>要初始化<code>InMemoryKnowledgeBase</code>，您需要在json文件中提供数据。以下示例包含有关餐厅和酒店的数据。json结构应包含每个对象类型（即<code>"restaurant"</code>和）的键<code>"hotel"</code>。每个对象类型都映射到对象列表–在这里，我们有3家餐厅的列表和3家酒店的列表。</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"restaurant"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Donath"</span><span class="token punctuation">,</span>
            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>
            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Berlin Burrito Company"</span><span class="token punctuation">,</span>
            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Mexican"</span><span class="token punctuation">,</span>
            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"cheap"</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"I due forni"</span><span class="token punctuation">,</span>
            <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>
            <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"hotel"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hilton"</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"expensive"</span><span class="token punctuation">,</span>
            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>
            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">true</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hilton"</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"expensive"</span><span class="token punctuation">,</span>
            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Frankfurt am Main"</span><span class="token punctuation">,</span>
            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
        &amp;#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"B&amp;B"</span><span class="token punctuation">,</span>
            <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span><span class="token punctuation">,</span>
            <span class="token property">"breakfast-included"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Berlin"</span><span class="token punctuation">,</span>
            <span class="token property">"free-wifi"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"star-rating"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"swimming-pool"</span><span class="token operator">:</span> <span class="token boolean">false</span>
        &amp;#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>一旦在json文件（例如）中定义了数据<code>data.json</code>，您就可以使用此数据文件来创建您的<code>InMemoryKnowledgeBase</code>，该文件 将传递给查询知识库的操作。</p>
<p>知识库中的每个对象都应至少具有<code>"name"</code>和<code>"id"</code>字段以使用默认实现。如果不是，则必须<a href="#">自定义InMemoryKnowledgeBase</a>。</p>
<h4 id="定义NLU数据"><a href="#定义NLU数据" class="headerlink" title="定义NLU数据"></a>定义NLU数据</h4><p>在这个部分：</p>
<ul>
<li>我们将介绍一个新的意图， <code>query_knowledge_base</code></li>
<li>我们将对<code>mention</code>实体进行注释，以便我们的模型能够检测到诸如“第一个”之类的对象的间接提及</li>
<li>我们将广泛使用<a href="#">同义词</a></li>
</ul>
<p>为了使机器人理解用户想要从知识库中检索信息，您需要定义一个新的意图。我们称之为<code>query_knowledge_base</code>。</p>
<p>我们可以将<code>ActionQueryKnowledgeBase</code>可以处理的请求分为两类：（1）用户想要获取特定类型的对象的列表，或者（2）用户想要了解对象的特定属性。该意图应包含这两个请求的许多变体：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> intent:query_knowledge_base</span>
<span class="token list punctuation">-</span> what <span class="token url">[restaurants](object_type:restaurant)</span> can you recommend?
<span class="token list punctuation">-</span> list some <span class="token url">[restaurants](object_type:restaurant)</span>
<span class="token list punctuation">-</span> can you name some <span class="token url">[restaurants](object_type:restaurant)</span> please?
<span class="token list punctuation">-</span> can you show me some <span class="token url">[restaurant](object_type:restaurant)</span> options
<span class="token list punctuation">-</span> list <span class="token url">[German](cuisine)</span> <span class="token url">[restaurants](object_type:restaurant)</span>
<span class="token list punctuation">-</span> do you have any <span class="token url">[mexican](cuisine)</span> <span class="token url">[restaurants](object_type:restaurant)</span>?
<span class="token list punctuation">-</span> do you know the <span class="token url">[price range](attribute:price-range)</span> of <span class="token url">[that one](mention)</span>?
<span class="token list punctuation">-</span> what <span class="token url">[cuisine](attribute)</span> is <span class="token url">[it](mention)</span>?
<span class="token list punctuation">-</span> do you know what <span class="token url">[cuisine](attribute)</span> the <span class="token url">[last one](mention:LAST)</span> has?
<span class="token list punctuation">-</span> does the <span class="token url">[first one](mention:1)</span> have <span class="token url">[outside seating](attribute:outside-seating)</span>?
<span class="token list punctuation">-</span> what is the <span class="token url">[price range](attribute:price-range)</span> of <span class="token url">[Berlin Burrito Company](restaurant)</span>?
<span class="token list punctuation">-</span> what about <span class="token url">[I due forni](restaurant)</span>?
<span class="token list punctuation">-</span> can you tell me the <span class="token url">[price range](attribute)</span> of <span class="token url">[that restaurant](mention)</span>?
<span class="token list punctuation">-</span> what <span class="token url">[cuisine](attribute)</span> do <span class="token url">[they](mention)</span> have?
 ...</code></pre>
<p>上面的示例仅显示了与餐厅域相关的示例。您应该针对相同的<code>query_knowledge_base</code>意图为知识库中存在的每种对象类型添加示例。</p>
<p>除了为每种查询类型添加各种训练示例外，您还需要在训练示例中指定和注释以下实体：</p>
<ul>
<li><code>object_type</code>注意：每当训练示例从您的知识库中引用特定的对象类型时，都应将对象类型标记为实体。使用<a href="#">同义词</a>将例如映射<code>restaurants</code>为<code>restaurant</code>，作为正确的对象类型作为知识库中的键列出。</li>
<li><code>mention</code>：如果用户通过“第一个”，“那个”或“它”来引用对象，则应将这些术语标记为<code>mention</code>。我们还使用同义词将某些提及内容映射到符号。您可以通过<a href="#">解决提及</a>来了解有关内容。</li>
<li><code>attribute</code>注意：知识库中定义的所有属性名称应<code>attribute</code>与NLU数据中的名称相同。同样，使用同义词将属性名称的变体映射到知识库中使用的变体。</li>
</ul>
<p>请记住将这些实体添加到您的域文件中（作为实体和插槽）：</p>
<pre class=" language-markdown"><code class="language-markdown">entities:
  <span class="token list punctuation">-</span> object_type
  <span class="token list punctuation">-</span> mention
  <span class="token list punctuation">-</span> attribute

slots:
  object_type:
<span class="token code keyword">    type: unfeaturized</span>
  mention:
<span class="token code keyword">    type: unfeaturized</span>
  attribute:
<span class="token code keyword">    type: unfeaturized</span></code></pre>
<h4 id="创建一个操作来查询您的知识库"><a href="#创建一个操作来查询您的知识库" class="headerlink" title="创建一个操作来查询您的知识库"></a>创建一个操作来查询您的知识库</h4><p>要创建自己的知识库操作，您需要继承<code>ActionQueryKnowledgeBase</code>知识库并将其传递给的构造函数<code>ActionQueryKnowledgeBase</code>。</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>knowledge_base<span class="token punctuation">.</span>storage <span class="token keyword">import</span> InMemoryKnowledgeBase
<span class="token keyword">from</span> rasa_sdk<span class="token punctuation">.</span>knowledge_base<span class="token punctuation">.</span>actions <span class="token keyword">import</span> ActionQueryKnowledgeBase

<span class="token keyword">class</span> <span class="token class-name">MyKnowledgeBaseAction</span><span class="token punctuation">(</span>ActionQueryKnowledgeBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        knowledge_base <span class="token operator">=</span> InMemoryKnowledgeBase<span class="token punctuation">(</span><span class="token string">"data.json"</span><span class="token punctuation">)</span>
        super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>knowledge_base<span class="token punctuation">)</span></code></pre>
<p>每当创建时<code>ActionQueryKnowledgeBase</code>，都需要将传递<code>KnowledgeBase</code>给构造函数。它可以是<code>InMemoryKnowledgeBase</code>或您自己的实现<code>KnowledgeBase</code> （请参阅<a href="#">创建自己的知识库</a>）。您只能从一个知识库中提取信息，因为不支持同时使用多个知识库。</p>
<p>这是此操作的全部代码！动作的名称是<code>action_query_knowledge_base</code>。不要忘记将其添加到您的域文件中：</p>
<pre class=" language-markdown"><code class="language-markdown">actions:
<span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>query<span class="token punctuation">_</span></span>knowledge_base</code></pre>
<p>注意</p>
<p>如果覆盖了默认的动作名称<code>action_query_knowledge_base</code>，你需要以下三个unfeaturized插槽添加到您的域文件：<code>knowledge_base_objects</code>，<code>knowledge_base_last_object</code>，和 <code>knowledge_base_last_object_type</code>。插槽由内部使用<code>ActionQueryKnowledgeBase</code>。如果保留默认操作名称，这些插槽将自动为您添加。</p>
<p>您还需要确保将一个故事添加到您的故事文件中，其中包括意图<code>query_knowledge_base</code>和动作<code>action_query_knowledge_base</code>。例如：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> Happy Path</span>
<span class="token list punctuation">*</span> greet
  <span class="token list punctuation">-</span> utter_greet
<span class="token list punctuation">*</span> query<span class="token italic"><span class="token punctuation">_</span>knowledge<span class="token punctuation">_</span></span>base
  <span class="token list punctuation">-</span> action<span class="token italic"><span class="token punctuation">_</span>query<span class="token punctuation">_</span></span>knowledge_base
<span class="token list punctuation">*</span> goodbye
  <span class="token list punctuation">-</span> utter_goodbye</code></pre>
<p>您需要做的最后一件事是<code>utter_ask_rephrase</code>在域文件中定义响应。如果该操作不知道如何处理用户的请求，它将使用此响应来要求用户重新措辞。例如，将以下响应添加到您的域文件中：</p>
<pre class=" language-markdown"><code class="language-markdown">utter<span class="token italic"><span class="token punctuation">_</span>ask<span class="token punctuation">_</span></span>rephrase:
<span class="token list punctuation">-</span> text: "Sorry, I'm not sure I understand. Could you rephrase it?"
<span class="token list punctuation">-</span> text: "Could you please rephrase your message? I didn't quite get that."</code></pre>
<p>添加所有相关部分后，该操作现在可以查询知识库。</p>
<h3 id="如何工作"><a href="#如何工作" class="headerlink" title="如何工作"></a>如何工作</h3><p><code>ActionQueryKnowledgeBase</code> 查看在请求中选取的实体以及先前设置的广告位，以决定要查询的内容。</p>
<h4 id="在知识库中查询对象"><a href="#在知识库中查询对象" class="headerlink" title="在知识库中查询对象"></a>在知识库中查询对象</h4><p>为了查询知识库中的任何类型的对象，用户的请求都需要包括对象类型。让我们看一个例子：</p>
<ul>
<li>你能说出一些餐厅的名字吗？</li>
</ul>
<p>这个问题包括感兴趣的对象类型：“餐厅”。机器人需要拾取该实体才能提出查询-否则操作将不知道用户感兴趣的对象。</p>
<p>当用户说出类似的内容时：</p>
<ul>
<li>我在柏林有哪些意大利餐厅选择？</li>
</ul>
<p>用户想要获得（1）有意大利美食和（2）位于柏林的餐厅列表。如果NER在用户请求中检测到那些属性，则该操作将使用那些属性来过滤在知识库中找到的餐馆。</p>
<p>为了使机器人能够检测到这些属性，您需要在NLU数据中将“ Italian”和“ Berlin”标记为实体：</p>
<pre class=" language-markdown"><code class="language-markdown">What <span class="token url">[Italian](cuisine)</span> <span class="token url">[restaurant](object_type)</span> options in <span class="token url">[Berlin](city)</span> do I have?.</code></pre>
<p>属性的名称“美食”和“城市”应与知识库中使用的名称相同。您还需要将它们作为实体和插槽添加到域文件中。</p>
<h4 id="在知识库中查询对象的属性"><a href="#在知识库中查询对象的属性" class="headerlink" title="在知识库中查询对象的属性"></a>在知识库中查询对象的属性</h4><p>如果用户希望获取有关某个对象的特定信息，则请求应同时包含该对象和感兴趣的属性。例如，如果用户问类似：</p>
<ul>
<li>柏林卷饼公司的菜是什么？</li>
</ul>
<p>用户想要获得餐厅“柏林煎饼店公司”（感兴趣的对象）的“美食”（感兴趣的属性）。</p>
<p>NLU训练数据中应将感兴趣的属性和对象标记为实体：</p>
<pre class=" language-markdown"><code class="language-markdown">What is the <span class="token url">[cuisine](attribute)</span> of <span class="token url">[Berlin Burrito Company](restaurant)</span>?</code></pre>
<p>确保将对象类型“餐厅”作为实体和插槽添加到域文件中。</p>
<h4 id="解决提及"><a href="#解决提及" class="headerlink" title="解决提及"></a>解决提及</h4><p>根据上面的示例，用户可能并不总是用他们的名字来指代餐馆。用户可以通过其名称引用感兴趣的对象，例如“ Berlin Burrito Company”（对象的表示字符串），也可以通过提及来引用先前列出的对象，例如：</p>
<blockquote>
<p>您提到的第二家餐厅的菜是什么？</p>
</blockquote>
<p>我们的行动能够将这些提及解决为知识库中的实际对象。更具体地说，它可以解决两种提及类型：（1）顺序提及，例如“第一个”，以及（2）提及，例如“ it”或“那个”。</p>
<p><strong>顺序提及</strong></p>
<p>当用户通过对象在列表中的位置引用对象时，称为序贯提及。这是一个例子：</p>
<ul>
<li>用户：您知道柏林的哪些餐馆？</li>
<li>Bot：找到了以下类型的“餐厅”对象：1：我应得2：PastaBar 3：柏林玉米煎饼公司</li>
<li>使用者：第一个有户外座位吗？</li>
</ul>
<p>用户用术语“第一个”来称呼“我应得”。其他顺序提及的内容可能包括“第二个”，“最后一个”，“任何”或“ 3”。</p>
<p>当向用户展示对象列表时，通常会使用序言提及。为了解决对实际对象的提及，我们使用在<code>KnowledgeBase</code>类中设置的顺序提及映射 。默认映射如下所示：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"1"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"2"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"3"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"4"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"5"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"6"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"7"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"8"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"9"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"10"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"ANY"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> random.choice(l<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token property">"LAST"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span>-<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>顺序提及映射将字符串（例如“ 1”）映射到列表中的对象，例如，表示索引处的对象。<code>lambda l: l[0]``0</code></p>
<p>例如，由于序号提及映射不包含“第一个”条目，因此使用<a href="#">实体同义词</a>将NLU数据中的“第一个”映射到“ 1”非常重要：</p>
<pre class=" language-markdown"><code class="language-markdown">Does the <span class="token url">[first one](mention:1)</span> have <span class="token url">[outside seating](attribute:outside-seating)</span>?</code></pre>
<p>NER将“第一个”检测为一个<code>mention</code>实体，但将“ 1”放入<code>mention</code>插槽。因此，我们的操作可以将<code>mention</code>空档和顺序提及映射一起使用，以将“第一个”解析为实际对象“ I due forni”。</p>
<p>您可以通过<code>set_ordinal_mention_mapping()</code>在<code>KnowledgeBase</code>实现上 调用该函数来覆盖顺序提及映射（请参阅<a href="#">自定义InMemoryKnowledgeBase</a>）。</p>
<p><strong>其他提及</strong></p>
<p>看一下下面的对话：</p>
<ul>
<li>用户：PastaBar的菜是什么？</li>
<li>Bot：PastaBar提供意大利美食。</li>
<li>用户：它有wifi吗？</li>
<li>Bot：是的。</li>
<li>用户：你能给我一个地址吗？</li>
</ul>
<p>在“是否有wifi吗？”问题中，用户使用“ it”一词来指代“ PastaBar”。如果NER将“ it”检测为实体<code>mention</code>，则知识库操作会将其解析为对话中最后提到的对象“ PastaBar”。</p>
<p>在下一个输入中，用户间接引用对象“ PastaBar”，而不是明确提及它。知识库操作将检测到用户想要获取特定属性的值，在这种情况下为地址。如果NER未检测到任何提及或对象，则该操作将假定用户正在引用最近提及的对象“ PastaBar”。</p>
<p>您可以通过在初始化操作时将设置<code>use_last_object_mention</code>为来禁用此行为<code>False</code>。</p>
<h3 id="定制"><a href="#定制" class="headerlink" title="定制"></a>定制</h3><h4 id="定制ActionQueryKnowledgeBase"><a href="#定制ActionQueryKnowledgeBase" class="headerlink" title="定制ActionQueryKnowledgeBase"></a>定制<code>ActionQueryKnowledgeBase</code></h4><p><code>ActionQueryKnowledgeBase</code>如果要自定义漫游器对用户说的话，可以覆盖以下两个功能：</p>
<ul>
<li><code>utter_objects()</code></li>
<li><code>utter_attribute_value()</code></li>
</ul>
<p><code>utter_objects()</code>当用户请求对象列表时使用。一旦机器人从知识库中检索了对象，它将默认以一条消息响应用户，其格式如下：</p>
<ul>
<li>找到以下类型的餐厅类型的对象： 1：我应得的 2：PastaBar 3：Berlin Burrito Company</li>
</ul>
<p>或者，如果找不到任何对象，</p>
<ul>
<li>我找不到“餐厅”类型的任何对象。</li>
</ul>
<p>如果要更改发话格式，则可以<code>utter_objects()</code>在操作中覆盖该方法。</p>
<p>该功能<code>utter_attribute_value()</code>确定当用户要求有关对象的特定信息时，机器人会说些什么。</p>
<p>如果在知识库中找到了感兴趣的属性，则漫游器将以以下方式回应：</p>
<ul>
<li>“柏林玉米煎饼公司”的属性“烹饪”的值为“墨西哥”。</li>
</ul>
<p>如果未找到所请求属性的值，则漫游器将以响应</p>
<ul>
<li>找不到对象“ Berlin Burrito Company”的属性“ cuisine”的有效值。</li>
</ul>
<p>如果要更改自动发声，可以覆盖方法<code>utter_attribute_value()</code>。</p>
<blockquote>
<p>注意</p>
<p>我们的博客上有一个<a href="#">教程</a>，介绍如何在自定义操作中使用知识库。本教程详细解释了后面的实现 <code>ActionQueryKnowledgeBase</code>。</p>
</blockquote>
<h4 id="创建自己的知识库操作"><a href="#创建自己的知识库操作" class="headerlink" title="创建自己的知识库操作"></a>创建自己的知识库操作</h4><p><code>ActionQueryKnowledgeBase</code>应该可以让您轻松地开始将知识库集成到您的操作中。但是，该操作只能处理两种用户请求：</p>
<ul>
<li>用户希望从知识库中获取对象列表</li>
<li>用户想要获取特定对象的属性值</li>
</ul>
<p>该操作无法在知识库中比较对象或考虑对象之间的关系。此外，解决对话中对最后提到的对象的任何提及可能并不总是最佳的。</p>
<p>如果要处理更复杂的用例，则可以编写自己的自定义操作。我们在<code>rasa_sdk.knowledge_base.utils</code> （<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">链接到代码</a>）中添加了一些帮助程序功能，以在实现自己的解决方案时为您提供帮助。我们建议使用<code>KnowledgeBase</code>接口，以便您仍可以在<code>ActionQueryKnowledgeBase</code> 新的自定义操作旁边使用。</p>
<p>如果您编写了解决上述用例之一或新用例的知识库操作，请务必在<a target="_blank" rel="noopener" href="https://forum.rasa.com/">论坛</a>上告诉我们！</p>
<h4 id="自定义InMemoryKnowledgeBase"><a href="#自定义InMemoryKnowledgeBase" class="headerlink" title="自定义InMemoryKnowledgeBase"></a>自定义<code>InMemoryKnowledgeBase</code></h4><p>该类<code>InMemoryKnowledgeBase</code>继承<code>KnowledgeBase</code>。您可以<code>InMemoryKnowledgeBase</code>通过覆盖以下功能来自定义您的：</p>
<ul>
<li><p><code>get_key_attribute_of_object()</code>：为了跟踪用户最近在谈论什么对象，我们将key属性的值存储在特定的插槽中。每个对象都应具有唯一的键属性，类似于关系数据库中的主键。默认情况下，每种对象类型的key属性的名称都设置为<code>id</code>。您可以通过调用覆盖特定对象类型的key属性名称 <code>set_key_attribute_of_object()</code>。</p>
</li>
<li><p><code>get_representation_function_of_object()</code>：让我们专注于以下餐厅：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Donath"</span><span class="token punctuation">,</span>
    <span class="token property">"cuisine"</span><span class="token operator">:</span> <span class="token string">"Italian"</span><span class="token punctuation">,</span>
    <span class="token property">"outside-seating"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"price-range"</span><span class="token operator">:</span> <span class="token string">"mid-range"</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>当用户要求漫游器列出任何意大利餐厅时，它不需要餐厅的所有详细信息。相反，您想提供一个有意义的名称来标识餐厅-在大多数情况下，对象的名称即可。该函数<code>get_representation_function_of_object()</code>返回一个lambda函数，该函数将上述餐厅对象映射为其名称。</p>
<pre><code>lambda obj: obj["name"]</code></pre>
<p>机器人在谈论特定对象时都会使用此功能，以便向用户显示该对象的有意义的名称。</p>
<p>默认情况下，lambda函数返回<code>"name"</code>对象属性的值。如果您的对象没有<code>"name"</code>属性，或者该<code>"name"</code>对象的模棱两可，则应通过调用为该对象类型设置一个新的lambda函数 <code>set_representation_function_of_object()</code>。</p>
</li>
<li><p><code>set_ordinal_mention_mapping()</code>：需要顺序提及映射才能将顺序提及（例如“第二个”）解析为列表中的对象。默认情况下，序数提及映射如下所示：</p>
<pre class=" language-json"><code class="language-json">&amp;#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token property">"1"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"2"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"3"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"4"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"5"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"6"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"7"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"8"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"9"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"10"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"ANY"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> random.choice(l<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token property">"LAST"</span><span class="token operator">:</span> lambda l<span class="token operator">:</span> l<span class="token punctuation">[</span>-<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
&amp;#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>
<p>您可以通过调用函数将其覆盖<code>set_ordinal_mention_mapping()</code>。如果您想了解有关如何使用此映射的更多信息，请查看<a href="#">解决问题</a>。</p>
</li>
</ul>
<p>有关使用的方法的示例实现，请参见<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/actions.py">示例bot</a>，该示例<code>InMemoryKnowledgeBase</code>使用该方法<code>set_representation_function_of_object()</code> 覆盖对象类型“ hotel”的默认表示。<code>InMemoryKnowledgeBase</code>本身的实现可以在 <a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">rasa-sdk</a>包中找到。</p>
<h4 id="创建自己的知识库"><a href="#创建自己的知识库" class="headerlink" title="创建自己的知识库"></a>创建自己的知识库</h4><p>如果您有更多数据，或者想要使用更复杂的数据结构（例如，涉及不同对象之间的关系），则可以创建自己的知识库实现。只是继承<code>KnowledgeBase</code>和实施方法<code>get_objects()</code>，<code>get_object()</code>以及 <code>get_attributes_of_object()</code>。该<a target="_blank" rel="noopener" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">知识基础代码</a> 提供什么这些方法应该做的更多信息。</p>
<p>您还可以通过调整“<a href="#">自定义InMemoryKnowledgeBase</a> ”部分中提到的方法，进一步自定义知识库 。</p>
<blockquote>
<p>注意</p>
<p>我们写了<a href="#">一篇博客文章</a> ，解释了如何建立自己的知识库。</p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">daiyizheng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://yoursite.com/2020/10/05/rasa-wen-dang-zhi-nan-14/">http://yoursite.com/2020/10/05/rasa-wen-dang-zhi-nan-14/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">daiyizheng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Rasa/">
                                    <span class="chip bg-color">Rasa</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: '4UATY1Wl6PiOAJtLDeI11JPG-9Nh9j0Va',
        appKey: 'm8JJMe4Ok7crFRmTthEbo48R',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/10/07/ben-di-duan-kou-ying-she-dao-gong-wang-jupyter-wei-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="本地端口映射到公网(jupyter为例)">
                        
                        <span class="card-title">本地端口映射到公网(jupyter为例)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            内网穿透
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-10-07
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BF%90%E7%BB%B4/" class="post-category">
                                    运维
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ngork/">
                        <span class="chip bg-color">ngork</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/10/05/chatito-shi-yong-jian-dan-dsl-sheng-cheng-rasa-shu-ju-ji/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="Chatito-使用简单DSL生成Rasa数据集">
                        
                        <span class="card-title">Chatito-使用简单DSL生成Rasa数据集</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Chatito数据生成工具
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-10-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/nlp/" class="post-category">
                                    nlp
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Rasa/">
                        <span class="chip bg-color">Rasa</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="song"
                   id="1297742167"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">daiyizheng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
